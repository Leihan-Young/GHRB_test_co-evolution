[
  {
    "repository": {
      "pullRequest": {
        "title": "[feat][txn] Support for idempotent commit and abort, Solution1.",
        "url": "https://github.com/apache/pulsar/pull/19662",
        "resourcePath": "/apache/pulsar/pull/19662",
        "createdAt": "2023-02-28T09:06:50Z",
        "number": 19662,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/transaction/TransactionTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/transaction/buffer/TransactionLowWaterMarkTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/transaction/recover/TransactionRecoverTrackerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/TransactionEndToEndTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/transaction/TransactionImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-transaction/coordinator/src/main/java/org/apache/pulsar/transaction/coordinator/TransactionMetadataStore.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-transaction/coordinator/src/main/java/org/apache/pulsar/transaction/coordinator/TransactionRecoverTracker.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-transaction/coordinator/src/main/java/org/apache/pulsar/transaction/coordinator/impl/InMemTransactionMetadataStore.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-transaction/coordinator/src/main/java/org/apache/pulsar/transaction/coordinator/impl/MLTransactionMetadataStore.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-transaction/coordinator/src/test/java/org/apache/pulsar/transaction/coordinator/MLTransactionMetadataStoreTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5K6F_42gAoMmM1YTZhMDI4NGEwYzljZjQzYzljMmY1Y2NhNThmNWEyYzMxZjIxNw",
                "url": "https://github.com/apache/pulsar/pull/19662/commits/2c5a6a0284a0c9cf43c9c2f5cca58f5a2c31f217"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19629,
                "url": "https://github.com/apache/pulsar/issues/19629",
                "title": "[Bug] Throw exception though transaction committed successfully.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.9</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">transactional produce 100 million messages, and restart brokers every 120s for 50 times.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">we expect that there is no any message duplication.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">there exists message duplication.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">i find some reasons accounting for this problem.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Commit transaction failed with exception :\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.transaction.TransactionCoordinatorClientException$InvalidTxnStatusException: Expect Txn `(7,24726)` to be in COMMITTING status but it is in COMMITTED status\"><pre class=\"notranslate\"><code class=\"notranslate\">Commit transaction failed with exception :\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.transaction.TransactionCoordinatorClientException$InvalidTxnStatusException: Expect Txn `(7,24726)` to be in COMMITTING status but it is in COMMITTED status\n</code></pre></div>\n<p dir=\"auto\">when producer commit transaction to broker, the broker throw exceptions though the transaction have been committed successfully.<br>\nThen the producer receive the exception and thought that it fail to commit the transaction, as a result producer resend the messages in the transaction, which account for the message duplication.</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/52550727/221130309-d34ed94f-173b-459a-a3f5-194bd74441cb.png\"><img width=\"645\" alt=\"image\" src=\"https://user-images.githubusercontent.com/52550727/221130309-d34ed94f-173b-459a-a3f5-194bd74441cb.png\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/52550727/221130477-2e0c7abd-ec70-4771-98cd-e4e66a9532f8.png\"><img width=\"640\" alt=\"image\" src=\"https://user-images.githubusercontent.com/52550727/221130477-2e0c7abd-ec70-4771-98cd-e4e66a9532f8.png\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/52550727/221130554-521a3586-0d49-49b1-af1f-2c0bee721fb6.png\"><img width=\"915\" alt=\"image\" src=\"https://user-images.githubusercontent.com/52550727/221130554-521a3586-0d49-49b1-af1f-2c0bee721fb6.png\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">whole log in broker as follow:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-02-28T11:14:48,237+0800 [pulsar-transaction-timer-46-1] ERROR org.apache.pulsar.broker.TransactionMetadataStoreService - End transaction fail! TxnId : (1,50425), TxnAction : 0\norg.apache.pulsar.transaction.coordinator.exceptions.CoordinatorException$CoordinatorNotFoundException: Transaction coordinator with id 1 not found!\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.getTxnMeta(TransactionMetadataStoreService.java:343) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.endTransaction(TransactionMetadataStoreService.java:391) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.lambda$null$16(TransactionMetadataStoreService.java:416) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at io.netty.util.HashedWheelTimer$HashedWheelTimeout.run(HashedWheelTimer.java:715) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.concurrent.ImmediateExecutor.execute(ImmediateExecutor.java:34) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.HashedWheelTimer$HashedWheelTimeout.expire(HashedWheelTimer.java:703) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.HashedWheelTimer$HashedWheelBucket.expireTimeouts(HashedWheelTimer.java:790) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.HashedWheelTimer$Worker.run(HashedWheelTimer.java:503) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_92]\n\n2023-02-28T11:15:14,441+0800 [BookKeeperClientWorker-OrderedExecutor-3-0] ERROR **org.apache.pulsar.transaction.coordinator.impl.MLTransactionMetadataStore - TxnID : (1,50425) add update txn status error with TxnStatus : COMMITTED**\norg.apache.pulsar.transaction.coordinator.exceptions.CoordinatorException$InvalidTxnStatusException: Expect Txn `(1,50425)` to be in COMMITTING status but it is in COMMITTED status\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.checkTxnStatus(TxnMetaImpl.java:96) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.updateTxnStatus(TxnMetaImpl.java:145) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.updateTxnStatus(TxnMetaImpl.java:37) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.**MLTransactionMetadataStore.lambda$null$12(MLTransactionMetadataStore.java:392)** ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:656) ~[?:1.8.0_92]\n    at java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:632) ~[?:1.8.0_92]\n    at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_92]\n    at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1962) ~[?:1.8.0_92]\n    at org.apache.pulsar.transaction.coordinator.impl.MLTransactionLogImpl$3.addComplete(MLTransactionLogImpl.java:186) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.TxnLogBufferedWriter$DisabledBatchCallback.addComplete(TxnLogBufferedWriter.java:642) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.bookkeeper.mledger.impl.OpAddEntry.safeRun(OpAddEntry.java:228) ~[org.apache.pulsar-managed-ledger-2.9.4.jar:2.9.4]\n    at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) ~[org.apache.bookkeeper-bookkeeper-common-4.14.5.jar:4.14.5]\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_92]\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_92]\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_92]\n\n2023-02-28T11:15:14,442+0800 [BookKeeperClientWorker-OrderedExecutor-3-0] ERROR org.apache.pulsar.broker.TransactionMetadataStoreService - End transaction fail! TxnId : (1,50425), TxnAction : 0\norg.apache.pulsar.transaction.coordinator.exceptions.CoordinatorException$InvalidTxnStatusException: Expect Txn `(1,50425)` to be in COMMITTING status but it is in COMMITTED status\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.checkTxnStatus(TxnMetaImpl.java:96) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.updateTxnStatus(TxnMetaImpl.java:145) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.updateTxnStatus(TxnMetaImpl.java:37) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.MLTransactionMetadataStore.lambda$null$12(MLTransactionMetadataStore.java:392) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n\n\n2023-02-28T11:15:14,442+0800 [BookKeeperClientWorker-OrderedExecutor-3-0] ERROR org.apache.pulsar.broker.service.ServerCnx - Send response error for END_TXN request 4236144793649783193.\norg.apache.pulsar.transaction.coordinator.exceptions.CoordinatorException$InvalidTxnStatusException: Expect Txn `(1,50425)` to be in COMMITTING status but it is in COMMITTED status\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.checkTxnStatus(TxnMetaImpl.java:96) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.updateTxnStatus(TxnMetaImpl.java:145) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.updateTxnStatus(TxnMetaImpl.java:37) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-02-28T11:14:48,237+0800 [pulsar-transaction-timer-46-1] ERROR org.apache.pulsar.broker.TransactionMetadataStoreService - End transaction fail! TxnId : (1,50425), TxnAction : 0\norg.apache.pulsar.transaction.coordinator.exceptions.CoordinatorException$CoordinatorNotFoundException: Transaction coordinator with id 1 not found!\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.getTxnMeta(TransactionMetadataStoreService.java:343) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.endTransaction(TransactionMetadataStoreService.java:391) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.lambda$null$16(TransactionMetadataStoreService.java:416) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at io.netty.util.HashedWheelTimer$HashedWheelTimeout.run(HashedWheelTimer.java:715) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.concurrent.ImmediateExecutor.execute(ImmediateExecutor.java:34) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.HashedWheelTimer$HashedWheelTimeout.expire(HashedWheelTimer.java:703) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.HashedWheelTimer$HashedWheelBucket.expireTimeouts(HashedWheelTimer.java:790) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.HashedWheelTimer$Worker.run(HashedWheelTimer.java:503) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_92]\n\n2023-02-28T11:15:14,441+0800 [BookKeeperClientWorker-OrderedExecutor-3-0] ERROR **org.apache.pulsar.transaction.coordinator.impl.MLTransactionMetadataStore - TxnID : (1,50425) add update txn status error with TxnStatus : COMMITTED**\norg.apache.pulsar.transaction.coordinator.exceptions.CoordinatorException$InvalidTxnStatusException: Expect Txn `(1,50425)` to be in COMMITTING status but it is in COMMITTED status\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.checkTxnStatus(TxnMetaImpl.java:96) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.updateTxnStatus(TxnMetaImpl.java:145) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.updateTxnStatus(TxnMetaImpl.java:37) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.**MLTransactionMetadataStore.lambda$null$12(MLTransactionMetadataStore.java:392)** ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:656) ~[?:1.8.0_92]\n    at java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:632) ~[?:1.8.0_92]\n    at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:474) ~[?:1.8.0_92]\n    at java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1962) ~[?:1.8.0_92]\n    at org.apache.pulsar.transaction.coordinator.impl.MLTransactionLogImpl$3.addComplete(MLTransactionLogImpl.java:186) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.TxnLogBufferedWriter$DisabledBatchCallback.addComplete(TxnLogBufferedWriter.java:642) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.bookkeeper.mledger.impl.OpAddEntry.safeRun(OpAddEntry.java:228) ~[org.apache.pulsar-managed-ledger-2.9.4.jar:2.9.4]\n    at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) ~[org.apache.bookkeeper-bookkeeper-common-4.14.5.jar:4.14.5]\n    at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1142) ~[?:1.8.0_92]\n    at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:617) ~[?:1.8.0_92]\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_92]\n\n2023-02-28T11:15:14,442+0800 [BookKeeperClientWorker-OrderedExecutor-3-0] ERROR org.apache.pulsar.broker.TransactionMetadataStoreService - End transaction fail! TxnId : (1,50425), TxnAction : 0\norg.apache.pulsar.transaction.coordinator.exceptions.CoordinatorException$InvalidTxnStatusException: Expect Txn `(1,50425)` to be in COMMITTING status but it is in COMMITTED status\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.checkTxnStatus(TxnMetaImpl.java:96) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.updateTxnStatus(TxnMetaImpl.java:145) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.updateTxnStatus(TxnMetaImpl.java:37) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.MLTransactionMetadataStore.lambda$null$12(MLTransactionMetadataStore.java:392) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n\n\n2023-02-28T11:15:14,442+0800 [BookKeeperClientWorker-OrderedExecutor-3-0] ERROR org.apache.pulsar.broker.service.ServerCnx - Send response error for END_TXN request 4236144793649783193.\norg.apache.pulsar.transaction.coordinator.exceptions.CoordinatorException$InvalidTxnStatusException: Expect Txn `(1,50425)` to be in COMMITTING status but it is in COMMITTED status\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.checkTxnStatus(TxnMetaImpl.java:96) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.updateTxnStatus(TxnMetaImpl.java:145) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.transaction.coordinator.impl.TxnMetaImpl.updateTxnStatus(TxnMetaImpl.java:37) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n</code></pre></div>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/52550727/221806812-7efe1633-ccc0-494d-83e4-3c1c012a82e1.png\"><img width=\"873\" alt=\"image\" src=\"https://user-images.githubusercontent.com/52550727/221806812-7efe1633-ccc0-494d-83e4-3c1c012a82e1.png\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">exception is throw by line 392. Though line 374 check out whether the current state of transaction is <code class=\"notranslate\">Committed</code>, there may be such a situation that, both two commit request pass the check in line 374, and the first request change the state of transaction to <code class=\"notranslate\">Committed</code> successfully, so the second request will throw exceptions above when executing</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"txnMetaListPair.getLeft().updateTxnStatus(newStatus, expectedStatus);\"><pre class=\"notranslate\"><code class=\"notranslate\">txnMetaListPair.getLeft().updateTxnStatus(newStatus, expectedStatus);\n</code></pre></div>\n<p dir=\"auto\">Exceptions above can be fixed by <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1602635085\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19662\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19662/hovercard\" href=\"https://github.com/apache/pulsar/pull/19662\">#19662</a> .</p>\n<p dir=\"auto\">But, there are other situations. exceptions throw as follows:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-02-28T13:13:09,100+0800 [pulsar-transaction-timer-46-1] ERROR org.apache.pulsar.broker.TransactionMetadataStoreService - End transaction fail! TxnId : (4,57640), TxnAction : 0\norg.apache.pulsar.transaction.coordinator.exceptions.CoordinatorException$CoordinatorNotFoundException: Transaction coordinator with id 4 not found!\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.getTxnMeta(TransactionMetadataStoreService.java:343) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.endTransaction(TransactionMetadataStoreService.java:391) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.lambda$null$16(TransactionMetadataStoreService.java:416) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at io.netty.util.HashedWheelTimer$HashedWheelTimeout.run(HashedWheelTimer.java:715) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.concurrent.ImmediateExecutor.execute(ImmediateExecutor.java:34) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.HashedWheelTimer$HashedWheelTimeout.expire(HashedWheelTimer.java:703) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.HashedWheelTimer$HashedWheelBucket.expireTimeouts(HashedWheelTimer.java:790) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.HashedWheelTimer$Worker.run(HashedWheelTimer.java:503) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_92]\n\n2023-02-28T13:13:34,111+0800 [pulsar-io-8-3] ERROR org.apache.pulsar.broker.TransactionMetadataStoreService - End transaction fail! TxnId : (4,57640), TxnAction : 0\norg.apache.pulsar.transaction.coordinator.exceptions.CoordinatorException$TransactionNotFoundException: The transaction with this txdID `(4,57640)`not found\n    at org.apache.pulsar.transaction.coordinator.impl.MLTransactionMetadataStore.getTxnMeta(MLTransactionMetadataStore.java:219) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.getTxnMeta(TransactionMetadataStoreService.java:345) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.endTransaction(TransactionMetadataStoreService.java:391) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.endTransaction(TransactionMetadataStoreService.java:370) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.service.ServerCnx.handleEndTxn(ServerCnx.java:2187) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:408) ~[org.apache.pulsar-pulsar-common-2.9.4.jar:2.9.4]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.handler.flow.FlowControlHandler.dequeue(FlowControlHandler.java:200) ~[io.netty-netty-handler-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.handler.flow.FlowControlHandler.channelRead(FlowControlHandler.java:162) ~[io.netty-netty-handler-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n\n\n2023-02-28T13:13:34,113+0800 [pulsar-io-8-3] ERROR org.apache.pulsar.broker.service.ServerCnx - Send response error for END_TXN request 2533659891027037444.\norg.apache.pulsar.transaction.coordinator.exceptions.CoordinatorException$TransactionNotFoundException: The transaction with this txdID `(4,57640)`not found\n    at org.apache.pulsar.transaction.coordinator.impl.MLTransactionMetadataStore.getTxnMeta(MLTransactionMetadataStore.java:219) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.getTxnMeta(TransactionMetadataStoreService.java:345) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.endTransaction(TransactionMetadataStoreService.java:391) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.endTransaction(TransactionMetadataStoreService.java:370) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.service.ServerCnx.handleEndTxn(ServerCnx.java:2187) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:408) ~[org.apache.pulsar-pulsar-common-2.9.4.jar:2.9.4]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.handler.flow.FlowControlHandler.dequeue(FlowControlHandler.java:200) ~[io.netty-netty-handler-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.handler.flow.FlowControlHandler.channelRead(FlowControlHandler.java:162) ~[io.netty-netty-handler-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-02-28T13:13:09,100+0800 [pulsar-transaction-timer-46-1] ERROR org.apache.pulsar.broker.TransactionMetadataStoreService - End transaction fail! TxnId : (4,57640), TxnAction : 0\norg.apache.pulsar.transaction.coordinator.exceptions.CoordinatorException$CoordinatorNotFoundException: Transaction coordinator with id 4 not found!\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.getTxnMeta(TransactionMetadataStoreService.java:343) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.endTransaction(TransactionMetadataStoreService.java:391) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.lambda$null$16(TransactionMetadataStoreService.java:416) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at io.netty.util.HashedWheelTimer$HashedWheelTimeout.run(HashedWheelTimer.java:715) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.concurrent.ImmediateExecutor.execute(ImmediateExecutor.java:34) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.HashedWheelTimer$HashedWheelTimeout.expire(HashedWheelTimer.java:703) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.HashedWheelTimer$HashedWheelBucket.expireTimeouts(HashedWheelTimer.java:790) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.HashedWheelTimer$Worker.run(HashedWheelTimer.java:503) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.77.Final.jar:4.1.77.Final]\n    at java.lang.Thread.run(Thread.java:745) ~[?:1.8.0_92]\n\n2023-02-28T13:13:34,111+0800 [pulsar-io-8-3] ERROR org.apache.pulsar.broker.TransactionMetadataStoreService - End transaction fail! TxnId : (4,57640), TxnAction : 0\norg.apache.pulsar.transaction.coordinator.exceptions.CoordinatorException$TransactionNotFoundException: The transaction with this txdID `(4,57640)`not found\n    at org.apache.pulsar.transaction.coordinator.impl.MLTransactionMetadataStore.getTxnMeta(MLTransactionMetadataStore.java:219) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.getTxnMeta(TransactionMetadataStoreService.java:345) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.endTransaction(TransactionMetadataStoreService.java:391) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.endTransaction(TransactionMetadataStoreService.java:370) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.service.ServerCnx.handleEndTxn(ServerCnx.java:2187) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:408) ~[org.apache.pulsar-pulsar-common-2.9.4.jar:2.9.4]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.handler.flow.FlowControlHandler.dequeue(FlowControlHandler.java:200) ~[io.netty-netty-handler-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.handler.flow.FlowControlHandler.channelRead(FlowControlHandler.java:162) ~[io.netty-netty-handler-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n\n\n2023-02-28T13:13:34,113+0800 [pulsar-io-8-3] ERROR org.apache.pulsar.broker.service.ServerCnx - Send response error for END_TXN request 2533659891027037444.\norg.apache.pulsar.transaction.coordinator.exceptions.CoordinatorException$TransactionNotFoundException: The transaction with this txdID `(4,57640)`not found\n    at org.apache.pulsar.transaction.coordinator.impl.MLTransactionMetadataStore.getTxnMeta(MLTransactionMetadataStore.java:219) ~[org.apache.pulsar-pulsar-transaction-coordinator-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.getTxnMeta(TransactionMetadataStoreService.java:345) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.endTransaction(TransactionMetadataStoreService.java:391) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.TransactionMetadataStoreService.endTransaction(TransactionMetadataStoreService.java:370) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.broker.service.ServerCnx.handleEndTxn(ServerCnx.java:2187) ~[org.apache.pulsar-pulsar-broker-2.9.4.jar:2.9.4]\n    at org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:408) ~[org.apache.pulsar-pulsar-common-2.9.4.jar:2.9.4]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.handler.flow.FlowControlHandler.dequeue(FlowControlHandler.java:200) ~[io.netty-netty-handler-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.handler.flow.FlowControlHandler.channelRead(FlowControlHandler.java:162) ~[io.netty-netty-handler-4.1.77.Final.jar:4.1.77.Final]\n    at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[io.netty-netty-transport-4.1.77.Final.jar:4.1.77.Final]\n</code></pre></div>\n<p dir=\"auto\">At such situation, the first commit request may have completed the execution and remove the <code class=\"notranslate\">txnMeta</code> from <code class=\"notranslate\">txnMetaMap</code>. As a result, the second commit request will throw <code class=\"notranslate\">TransactionNotFoundException</code>. To fix this problem, i think that we should hold the <code class=\"notranslate\">txnMeta</code> for <code class=\"notranslate\">transaction timeout</code>, or we can't know the state of terminated transactions. I think we need a PIP to design this.</p>\n<p dir=\"auto\">Finally, the analysis above do not explain why there are two commit request arrive to broker. I will explain this following.<br>\nNote that the first log is executed in the pulsar-transaction-time-46-1 thread,  which means it is a timer task arranged by  the previous call of method <code class=\"notranslate\">TransactionMetadataStoreService#endTransaction</code>.<br>\nThen we get the whole picture. First of all, the first commit request arrive to broker, which change the state of transaction to <code class=\"notranslate\">Committing</code>. when the broker try to commit the transaction next, the broker restarts, which close many resources. As a result,  exception that can be retry judged by method <code class=\"notranslate\">TransactionMetadataStoreService#isRetryableException</code> is throw and a timer task trying to commit again is arranged in <code class=\"notranslate\">HashedWheelTimer</code>.<br>\nSecondly, when the timer task is executed, the tc have been closed, which result into the first error log above, that is <code class=\"notranslate\">CoordinatorException$CoordinatorNotFoundException</code>. <strong>When the client receive this exceptions, it decide to resend the commit request internally due to method <code class=\"notranslate\">TransactionMetaStoreHandler#checkIfNeedRetryByError</code>. So the second commit request is issued to broker.</strong></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19629",
                "createdAt": "2023-02-24T08:32:28Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve] [broker] Support expose metadataStore zookeeper client metrics.",
        "url": "https://github.com/apache/pulsar/pull/19702",
        "resourcePath": "/apache/pulsar/pull/19702",
        "createdAt": "2023-03-03T09:41:30Z",
        "number": 19702,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/ManagedLedgerClientFactory.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/PrometheusMetricsGenerator.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/common/naming/ServiceConfigurationTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/main/java/org/apache/pulsar/metadata/api/MetadataStoreConfig.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/main/java/org/apache/pulsar/metadata/bookkeeper/AbstractMetadataDriver.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/main/java/org/apache/pulsar/metadata/bookkeeper/PulsarMetadataBookieDriver.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/main/java/org/apache/pulsar/metadata/bookkeeper/PulsarMetadataClientDriver.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/main/java/org/apache/pulsar/metadata/impl/ZKMetadataStore.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5LNRHJ2gAoOWVlYzk2OWZlNjNhMjhlNjQ5MGQwMDZkMDFiNzZlMzY0N2YzYzhkZg",
                "url": "https://github.com/apache/pulsar/pull/19702/commits/9eec969fe63a28e6490d006d01b76e3647f3c8df"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19713,
                "url": "https://github.com/apache/pulsar/issues/19713",
                "title": "Expose zookeeper client metric in BookkeeperMetadataDrivers.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Current <code class=\"notranslate\">ZKMetadataStore</code> will create an instance of <code class=\"notranslate\">PulsarZooKeeperClient</code> but without setting statsLogger.</p>\n<p dir=\"auto\">the MetadataStore will be:</p>\n<ol dir=\"auto\">\n<li>pulsar broker instance.</li>\n<li>bookie instance. (by MetadataBookieDriver)</li>\n<li>bookkeeper autorecovery (by MetadataClientDriver)</li>\n</ol>\n<p dir=\"auto\">if the zookeeper relate metric can be expose. at least these component can benefit from those zk client metrics.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19713",
                "createdAt": "2023-03-04T06:33:02Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test]testRedirectOfGetCoordinatorInternalStats",
        "url": "https://github.com/apache/pulsar/pull/19715",
        "resourcePath": "/apache/pulsar/pull/19715",
        "createdAt": "2023-03-05T08:28:07Z",
        "number": 19715,
        "mergeCommit": {
          "oid": "42a65aaa55e03c147adabac55ad5227fc8c8f596",
          "message": "[fix][test]testRedirectOfGetCoordinatorInternalStats (#19715)\n\nFix https://github.com/apache/pulsar/issues/18600\r\n\r\n### Motivation\r\n\r\nReason for test failure:\r\n1. Create 16 brokers and 3 transaction coordinator topics. \r\n2. The 3 transaction coordinator topics are assigned to broker-0.\r\n3. Because the admin is connected to broker-0, we do not hope the topics are assigned to broker-0.\r\n4. Recreate the 3 transaction coordinator topics.\r\n5. The topics are assigned to broker-0 again.\r\n6. Repeat execute steps 3,4,5\r\n7. Timeout\r\n\r\n### Modifications\r\nDo not recreate the transaction coordinator topics.\r\nRecreate an admin connect the broker which is not the owner of the transaction coordinator topics.",
          "commitUrl": "https://github.com/apache/pulsar/commit/42a65aaa55e03c147adabac55ad5227fc8c8f596",
          "parents": {
            "nodes": [
              {
                "oid": "7d5d2df0f0caf7630e89e4aab79a87e632475ab8",
                "message": "[fix][doc] Update the comment of the method of OwnershipCache (#19553)\n\nCo-authored-by: huangzegui <huangzegui@didiglobal.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/v3/AdminApiTransactionMultiBrokerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5LTPDk2gAoNDRhMjljNTc5OTZjNjlmMDk2MTMwZjZmY2E4NTdkZTJkNzllOThhMA",
                "url": "https://github.com/apache/pulsar/pull/19715/commits/44a29c57996c69f096130f6fca857de2d79e98a0"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 18600,
                "url": "https://github.com/apache/pulsar/issues/18600",
                "title": "Flaky-test: AdminApiTransactionMultiBrokerTest.testRedirectOfGetCoordinatorInternalStats",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/3539262113/jobs/5941141801#step:10:1363\">https://github.com/apache/pulsar/actions/runs/3539262113/jobs/5941141801#step:10:1363</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<details>\n<summary>Full exception stacktrace</summary>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"\norg.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.broker.admin.v3.AdminApiTransactionMultiBrokerTest.testRedirectOfGetCoordinatorInternalStats() didn't finish within the time-out 300000\n  \tat java.base@17.0.4.1/jdk.internal.misc.Unsafe.park(Native Method)\n  \tat java.base@17.0.4.1/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:252)\n  \tat java.base@17.0.4.1/java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1866)\n  \tat java.base@17.0.4.1/java.util.concurrent.ForkJoinPool.unmanagedBlock(ForkJoinPool.java:3463)\n  \tat java.base@17.0.4.1/java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3434)\n  \tat java.base@17.0.4.1/java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1939)\n  \tat java.base@17.0.4.1/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2095)\n  \tat app//org.apache.pulsar.broker.resources.BaseResources.create(BaseResources.java:128)\n  \tat app//org.apache.pulsar.broker.resources.NamespaceResources$PartitionedTopicResources.createPartitionedTopic(NamespaceResources.java:243)\n  \tat app//org.apache.pulsar.broker.admin.v3.AdminApiTransactionMultiBrokerTest.testRedirectOfGetCoordinatorInternalStats(AdminApiTransactionMultiBrokerTest.java:61)\n  \tat java.base@17.0.4.1/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base@17.0.4.1/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base@17.0.4.1/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base@17.0.4.1/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat app//org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base@17.0.4.1/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base@17.0.4.1/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base@17.0.4.1/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base@17.0.4.1/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">\norg.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.broker.admin.v3.AdminApiTransactionMultiBrokerTest.testRedirectOfGetCoordinatorInternalStats() didn't finish within the time-out 300000\n  \tat java.base@17.0.4.1/jdk.internal.misc.Unsafe.park(Native Method)\n  \tat java.base@17.0.4.1/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:252)\n  \tat java.base@17.0.4.1/java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1866)\n  \tat java.base@17.0.4.1/java.util.concurrent.ForkJoinPool.unmanagedBlock(ForkJoinPool.java:3463)\n  \tat java.base@17.0.4.1/java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3434)\n  \tat java.base@17.0.4.1/java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1939)\n  \tat java.base@17.0.4.1/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2095)\n  \tat app//org.apache.pulsar.broker.resources.BaseResources.create(BaseResources.java:128)\n  \tat app//org.apache.pulsar.broker.resources.NamespaceResources$PartitionedTopicResources.createPartitionedTopic(NamespaceResources.java:243)\n  \tat app//org.apache.pulsar.broker.admin.v3.AdminApiTransactionMultiBrokerTest.testRedirectOfGetCoordinatorInternalStats(AdminApiTransactionMultiBrokerTest.java:61)\n  \tat java.base@17.0.4.1/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base@17.0.4.1/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base@17.0.4.1/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base@17.0.4.1/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat app//org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base@17.0.4.1/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base@17.0.4.1/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base@17.0.4.1/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base@17.0.4.1/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n</details>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/18600",
                "createdAt": "2022-11-24T10:21:46Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve] Allow download link with basic auth",
        "url": "https://github.com/apache/pulsar/pull/19750",
        "resourcePath": "/apache/pulsar/pull/19750",
        "createdAt": "2023-03-08T10:10:50Z",
        "number": 19750,
        "mergeCommit": {
          "oid": "ef18bab1badbe6ce537254b3ff8fd288da1e7d4d",
          "message": "[improve] Allow download link with basic auth (#19750)\n\nCo-authored-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/ef18bab1badbe6ce537254b3ff8fd288da1e7d4d",
          "parents": {
            "nodes": [
              {
                "oid": "2b4a3c14458f564e7e0178f71979a41e7b7a42b7",
                "message": "[fix][broker] Fix RetentionPolicies constructor (#19777)\n\nSigned-off-by: Zixuan Liu <nodeces@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/auth/AuthenticationDataBasic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/FunctionCommon.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/utils/src/test/java/org/apache/pulsar/functions/utils/FunctionCommonTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5LjsVN2gAoYWE1OTI3NDJlZGYxZmUxZGI3ZDQyZWQ1N2Q1YzIyZWU5YmYwNGI5NA",
                "url": "https://github.com/apache/pulsar/pull/19750/commits/aa592742edf1fe1db7d42ed57d5c22ee9bf04b94"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 7354,
                "url": "https://github.com/apache/pulsar/issues/7354",
                "title": "Support basic-authentication in function jar urls when registering/updating functions via REST API",
                "bodyHTML": "<p dir=\"auto\"><strong>Is your feature request related to a problem? Please describe.</strong></p>\n<p dir=\"auto\">When registering or updating a function via the REST API using a jar url that has the <code class=\"notranslate\">user:pass</code> basic auth scheme is unsupported.</p>\n<p dir=\"auto\">Currently when a jar url with basic-auth credentials is used an error like the following is returned and the register/update call to the REST API returns a <code class=\"notranslate\">400 - Bad Request</code></p>\n<p dir=\"auto\"><code class=\"notranslate\">Bad Request - {\"reason\":\"Encountered error \\\"Server returned HTTP response code: 401 for URL: &lt;JAR_URL_HERE&gt;\" when getting Function package from &lt;JAR_URL_HERE&gt;\"}</code></p>\n<p dir=\"auto\"><strong>Describe the solution you'd like</strong><br>\nThe basic-auth credentials in the jar url should be forwarded along to the destination url and used to download the function jar</p>\n<p dir=\"auto\"><strong>Describe alternatives you've considered</strong><br>\nThe only alternative is to manually hit the jar url and download the jar to the server where the application that's hitting the API is running and using the <code class=\"notranslate\">file://</code> url type. Though, this approach won't work in many cases and is why the remote jar url option is provided.</p>\n<p dir=\"auto\"><strong>Additional context</strong><br>\nHitting the same jar url with basic-auth credentials in a browser prompts a download of the jar, so the url is valid.</p>",
                "resourcePath": "/apache/pulsar/issues/7354",
                "createdAt": "2020-06-24T17:33:56Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/feature"
                      }
                    },
                    {
                      "node": {
                        "name": "area/function"
                      }
                    },
                    {
                      "node": {
                        "name": "lifecycle/stale"
                      }
                    }
                  ]
                }
              }
            },
            {
              "node": {
                "number": 19910,
                "url": "https://github.com/apache/pulsar/issues/19910",
                "title": "Support basic-authentication in function url",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">reopen for <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"644788653\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/7354\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/7354/hovercard\" href=\"https://github.com/apache/pulsar/issues/7354\">#7354</a></p>\n<p dir=\"auto\">When registering or updating a function via the REST API using a jar url that has the user:pass basic auth scheme is unsupported.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">The basic-auth credentials in the jar url should be forwarded along to the destination url and used to download the function jar</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19910",
                "createdAt": "2023-03-23T10:17:59Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [test] fix flaky test BucketDelayedDeliveryTrackerTest. testWithBkException",
        "url": "https://github.com/apache/pulsar/pull/19751",
        "resourcePath": "/apache/pulsar/pull/19751",
        "createdAt": "2023-03-08T13:12:43Z",
        "number": 19751,
        "mergeCommit": {
          "oid": "bfc620bf6f2586b099fe423d7b07cc88754ef312",
          "message": "[fix] [test] fix flaky test BucketDelayedDeliveryTrackerTest. testWithBkException (#19751)\n\nThis test sets the maximum number of buckets to 10, then creates multiple buckets by writing, then uses the merge mechanism to make the final number of buckets less than or equal to 10.\r\n\r\nBut `BucketDelayedDeliveryTracker` doesn't guarantee that every merger operation will work, these cases will make the operation fail:\r\n- the last persistention of the bucket has not finished.\r\n- all buckets are full.\r\n\r\nSo remove this validation",
          "commitUrl": "https://github.com/apache/pulsar/commit/bfc620bf6f2586b099fe423d7b07cc88754ef312",
          "parents": {
            "nodes": [
              {
                "oid": "90b0f0a17579d22d413853ed4941d81debbe0cbe",
                "message": "[fix][io] KCA: Option to use kafka connector's SourceConnector class to create task and task config (#19772)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/delayed/bucket/BucketDelayedDeliveryTrackerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5LkfJr2gAoNjU3NTIzOTQ4YThlYTVmMzU4YjI1YjBhMTAzOTlmMzM4YjcxYzUyYg",
                "url": "https://github.com/apache/pulsar/pull/19751/commits/657523948a8ea5f358b25b0a10399f338b71c52b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19720,
                "url": "https://github.com/apache/pulsar/issues/19720",
                "title": "Flaky-test: BucketDelayedDeliveryTrackerTest. testWithBkException",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4339230785/jobs/7579423655#step:11:1190\">https://github.com/apache/pulsar/actions/runs/4339230785/jobs/7579423655#step:11:1190</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 28, Failures: 1, Errors: 0, Skipped: 7, Time elapsed: 6.132 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.delayed.bucket.BucketDelayedDeliveryTrackerTest\n  Error:  testWithBkException(org.apache.pulsar.broker.delayed.bucket.BucketDelayedDeliveryTrackerTest)  Time elapsed: 0.035 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [14] but found [10]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1413)\n  \tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n  \tat org.testng.Assert.assertEquals(Assert.java:131)\n  \tat org.testng.Assert.assertEquals(Assert.java:1240)\n  \tat org.testng.Assert.assertEquals(Assert.java:1274)\n  \tat org.apache.pulsar.broker.delayed.bucket.BucketDelayedDeliveryTrackerTest.testWithBkException(BucketDelayedDeliveryTrackerTest.java:313)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 28, Failures: 1, Errors: 0, Skipped: 7, Time elapsed: 6.132 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.delayed.bucket.BucketDelayedDeliveryTrackerTest\n  Error:  testWithBkException(org.apache.pulsar.broker.delayed.bucket.BucketDelayedDeliveryTrackerTest)  Time elapsed: 0.035 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [14] but found [10]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1413)\n  \tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n  \tat org.testng.Assert.assertEquals(Assert.java:131)\n  \tat org.testng.Assert.assertEquals(Assert.java:1240)\n  \tat org.testng.Assert.assertEquals(Assert.java:1274)\n  \tat org.apache.pulsar.broker.delayed.bucket.BucketDelayedDeliveryTrackerTest.testWithBkException(BucketDelayedDeliveryTrackerTest.java:313)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19720",
                "createdAt": "2023-03-06T07:21:00Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][meta] Fix busy-loop causes watcher can't acquire lock.",
        "url": "https://github.com/apache/pulsar/pull/19769",
        "resourcePath": "/apache/pulsar/pull/19769",
        "createdAt": "2023-03-09T15:39:23Z",
        "number": 19769,
        "mergeCommit": {
          "oid": "5caca1a995d316b73e3d6a9ba2ab4fdcc02211da",
          "message": "[improve][meta] Fix busy-loop causes watcher can't acquire lock. (#19769)",
          "commitUrl": "https://github.com/apache/pulsar/commit/5caca1a995d316b73e3d6a9ba2ab4fdcc02211da",
          "parents": {
            "nodes": [
              {
                "oid": "eb3169937e93d87d7587331aab18077849e14ca7",
                "message": "[fix][admin] Filter pending ack topic while deleting the namespace (#19719)\n\n### Motivation\r\n\r\nA transaction system topic not found exception may occur while deleting the namespace.\r\n\r\n**How to happen?**\r\n1. Make sure the topic has a pending ack system topic(`public/default/test-delete-ns-sub__transaction_pending_ack`).\r\n2. Delete the namespace `public/default`.\r\n3. Namespace deletion operation will try to delete the user-created topic `public/default/test-delete-ns` first, at this step, the topic will unsubscribe from all subscriptions, and delete the corresponding pending ack system topic.\r\n4. After the namespace deletion operation delete all user-created topics, it will try to delete all system topics, which contain the pending ack topic `public/default/test-delete-ns-sub__transaction_pending_ack`.\r\n5. The topicNotFound exception occurs.\r\n\r\nThere are two ways to fix this problem.\r\n1. Remove the pending ack topics from the pre-delete topic list.\r\n2. Ignore the topicNotFound exception while deleting the namespace.\r\n\r\n~~I think ignoring the exception is better because we don't know if there are other similar topics in the future.~~\r\n\r\nAfter discussion, we decide to filter the pending ack topics while deleting the namespace.\r\n\r\n### Modifications\r\n\r\nIgnore the topicNotFound exception while deleting the namespace."
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/main/java/org/apache/pulsar/metadata/impl/ZKSessionWatcher.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/pulsar/metadata/ZKSessionTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5LsHns2gAoZjI1MGQxMDBjMTk1N2I1ZTQ1MmZhZWI5ZTM5MDRhNzg2N2UyMzBhZg",
                "url": "https://github.com/apache/pulsar/pull/19769/commits/f250d100c1957b5e452faeb9e3904a7867e230af"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 11032,
                "url": "https://github.com/apache/pulsar/issues/11032",
                "title": "Flaky-test: ZKSessionTest.testReacquireLeadershipAfterSessionLost",
                "bodyHTML": "<p dir=\"auto\">ZKSessionTest is flaky. The testReacquireLeadershipAfterSessionLost test method fails sporadically.</p>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/pull/11026/checks?check_run_id=2889407530#step:9:4861\">example failure</a></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error:  Tests run: 6, Failures: 1, Errors: 0, Skipped: 4, Time elapsed: 31.46 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.metadata.ZKSessionTest\nError:  testReacquireLeadershipAfterSessionLost(org.apache.pulsar.metadata.ZKSessionTest)  Time elapsed: 15.396 s  &lt;&lt;&lt; FAILURE!\norg.awaitility.core.ConditionTimeoutException: Assertion condition defined as a lambda expression in org.apache.pulsar.metadata.ZKSessionTest that uses org.apache.pulsar.metadata.api.coordination.LeaderElection expected [Leading] but found [NoLeader] within 10 seconds.\n\tat org.awaitility.core.ConditionAwaiter.await(ConditionAwaiter.java:165)\n\tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:119)\n\tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:31)\n\tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:895)\n\tat org.awaitility.core.ConditionFactory.untilAsserted(ConditionFactory.java:679)\n\tat org.apache.pulsar.metadata.ZKSessionTest.testReacquireLeadershipAfterSessionLost(ZKSessionTest.java:174)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:132)\n\tat org.testng.internal.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:45)\n\tat org.testng.internal.InvokeMethodRunnable.call(InvokeMethodRunnable.java:73)\n\tat org.testng.internal.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat java.base/java.lang.Thread.run(Thread.java:829)\nCaused by: java.lang.AssertionError: expected [Leading] but found [NoLeader]\n\tat org.testng.Assert.fail(Assert.java:99)\n\tat org.testng.Assert.failNotEquals(Assert.java:1037)\n\tat org.testng.Assert.assertEqualsImpl(Assert.java:140)\n\tat org.testng.Assert.assertEquals(Assert.java:122)\n\tat org.testng.Assert.assertEquals(Assert.java:617)\n\tat org.apache.pulsar.metadata.ZKSessionTest.lambda$testReacquireLeadershipAfterSessionLost$1(ZKSessionTest.java:175)\n\tat org.awaitility.core.AssertionCondition.lambda$new$0(AssertionCondition.java:53)\n\tat org.awaitility.core.ConditionAwaiter$ConditionPoller.call(ConditionAwaiter.java:222)\n\tat org.awaitility.core.ConditionAwaiter$ConditionPoller.call(ConditionAwaiter.java:209)\n\t... 4 more\"><pre class=\"notranslate\"><code class=\"notranslate\">Error:  Tests run: 6, Failures: 1, Errors: 0, Skipped: 4, Time elapsed: 31.46 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.metadata.ZKSessionTest\nError:  testReacquireLeadershipAfterSessionLost(org.apache.pulsar.metadata.ZKSessionTest)  Time elapsed: 15.396 s  &lt;&lt;&lt; FAILURE!\norg.awaitility.core.ConditionTimeoutException: Assertion condition defined as a lambda expression in org.apache.pulsar.metadata.ZKSessionTest that uses org.apache.pulsar.metadata.api.coordination.LeaderElection expected [Leading] but found [NoLeader] within 10 seconds.\n\tat org.awaitility.core.ConditionAwaiter.await(ConditionAwaiter.java:165)\n\tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:119)\n\tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:31)\n\tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:895)\n\tat org.awaitility.core.ConditionFactory.untilAsserted(ConditionFactory.java:679)\n\tat org.apache.pulsar.metadata.ZKSessionTest.testReacquireLeadershipAfterSessionLost(ZKSessionTest.java:174)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\n\tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:132)\n\tat org.testng.internal.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:45)\n\tat org.testng.internal.InvokeMethodRunnable.call(InvokeMethodRunnable.java:73)\n\tat org.testng.internal.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n\tat java.base/java.lang.Thread.run(Thread.java:829)\nCaused by: java.lang.AssertionError: expected [Leading] but found [NoLeader]\n\tat org.testng.Assert.fail(Assert.java:99)\n\tat org.testng.Assert.failNotEquals(Assert.java:1037)\n\tat org.testng.Assert.assertEqualsImpl(Assert.java:140)\n\tat org.testng.Assert.assertEquals(Assert.java:122)\n\tat org.testng.Assert.assertEquals(Assert.java:617)\n\tat org.apache.pulsar.metadata.ZKSessionTest.lambda$testReacquireLeadershipAfterSessionLost$1(ZKSessionTest.java:175)\n\tat org.awaitility.core.AssertionCondition.lambda$new$0(AssertionCondition.java:53)\n\tat org.awaitility.core.ConditionAwaiter$ConditionPoller.call(ConditionAwaiter.java:222)\n\tat org.awaitility.core.ConditionAwaiter$ConditionPoller.call(ConditionAwaiter.java:209)\n\t... 4 more\n</code></pre></div>",
                "resourcePath": "/apache/pulsar/issues/11032",
                "createdAt": "2021-06-23T05:42:57Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [Perf] PerformanceProducer do not produce expected number of messages.",
        "url": "https://github.com/apache/pulsar/pull/19775",
        "resourcePath": "/apache/pulsar/pull/19775",
        "createdAt": "2023-03-10T02:37:51Z",
        "number": 19775,
        "mergeCommit": {
          "oid": "f7c453760a4a37578445212e1ee333b09097e1bf",
          "message": "[fix] [Perf] PerformanceProducer do not produce expected number of messages. (#19775)\n\nCo-authored-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/f7c453760a4a37578445212e1ee333b09097e1bf",
          "parents": {
            "nodes": [
              {
                "oid": "bad231e198e61b218e2265b351c658370d8845b8",
                "message": "[improve][broker] Handle get owned namespaces admin API in ExtensibleLoadManager (#20552)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/main/java/org/apache/pulsar/testclient/PerformanceProducer.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Luvlt2gAoODdiOWM4NzhiYTc5OTIyNDFhODQzMDI4ZmI1OThmODk0OWE5ZDRkNA",
                "url": "https://github.com/apache/pulsar/pull/19775/commits/87b9c878ba7992241a843028fb598f8949a9d4d4"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19774,
                "url": "https://github.com/apache/pulsar/issues/19774",
                "title": "[Bug] [Perf] PerformanceProducer do not produce expected number of messages.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.9.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Use PerformanceProducer with <code class=\"notranslate\">--num-messages</code> to determine the number of messages that i want to produce, and with <code class=\"notranslate\">--num-test-threads</code> to start multiple threads to working.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-perf produce --num-messages 10000000 --num-test-threads 4 ...\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-perf produce --num-messages 10000000 --num-test-threads 4 ...\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I want to produce exactly 100000 messages to be produced.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Less than 10000000 messages are produced.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The root reason is as follows:<br>\nWhen we use configuration <code class=\"notranslate\">--num-messages 100000 --num-test-threads 4</code> to start perf process, process will divide the total messages with threads count, that is <code class=\"notranslate\">100000/4=25000</code>, the result of which will be assign as the total messages to be produced by each threads.<br>\nSo, each thread need to 25000 messages.<br>\nBut, when one of threads produce 25000 messages, it will call <code class=\"notranslate\">PerfClientUtils.exit(0);</code> to terminates the currently running Java Virtual Machine, which will result into that other threads is terminated but do not produce enough messages yet.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/52550727/224208449-d656e0ec-15dd-4bc4-93df-423a8053a88b.png\"><img src=\"https://user-images.githubusercontent.com/52550727/224208449-d656e0ec-15dd-4bc4-93df-423a8053a88b.png\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">The test code bellow can simulate this process:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    public static void main(String[] args) throws InterruptedException {\n        ExecutorService executor = Executors\n                .newCachedThreadPool(new DefaultThreadFactory(&quot;pulsar-perf-producer-exec&quot;));\n        CountDownLatch doneLatch = new CountDownLatch(2);\n        executor.submit(()-&gt;{\n            try {\n                Thread.sleep(10000);\n            } catch (InterruptedException e) {\n                throw new RuntimeException(e);\n            }\n            System.out.println(&quot;thread1: need to be printed.&quot;);\n            doneLatch.countDown();\n        });\n        executor.submit(()-&gt;{\n            System.out.println(&quot;thread2: call system.exit(0).&quot;);\n            doneLatch.countDown();\n            System.exit(0);\n        });\n        while (true) {\n            if (doneLatch.getCount() &lt;= 0) {\n                break;\n            }\n            Thread.sleep(10000);\n        }\n    }\"><pre class=\"notranslate\"><code class=\"notranslate\">    public static void main(String[] args) throws InterruptedException {\n        ExecutorService executor = Executors\n                .newCachedThreadPool(new DefaultThreadFactory(\"pulsar-perf-producer-exec\"));\n        CountDownLatch doneLatch = new CountDownLatch(2);\n        executor.submit(()-&gt;{\n            try {\n                Thread.sleep(10000);\n            } catch (InterruptedException e) {\n                throw new RuntimeException(e);\n            }\n            System.out.println(\"thread1: need to be printed.\");\n            doneLatch.countDown();\n        });\n        executor.submit(()-&gt;{\n            System.out.println(\"thread2: call system.exit(0).\");\n            doneLatch.countDown();\n            System.exit(0);\n        });\n        while (true) {\n            if (doneLatch.getCount() &lt;= 0) {\n                break;\n            }\n            Thread.sleep(10000);\n        }\n    }\n</code></pre></div>\n<p dir=\"auto\">the output as follows:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/52550727/224208661-a1e75fda-0226-4b79-a23d-7167ec28c5c0.png\"><img width=\"278\" alt=\"image\" src=\"https://user-images.githubusercontent.com/52550727/224208661-a1e75fda-0226-4b79-a23d-7167ec28c5c0.png\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19774",
                "createdAt": "2023-03-10T02:35:13Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix RetentionPolicies constructor",
        "url": "https://github.com/apache/pulsar/pull/19777",
        "resourcePath": "/apache/pulsar/pull/19777",
        "createdAt": "2023-03-10T04:27:49Z",
        "number": 19777,
        "mergeCommit": {
          "oid": "2b4a3c14458f564e7e0178f71979a41e7b7a42b7",
          "message": "[fix][broker] Fix RetentionPolicies constructor (#19777)\n\nSigned-off-by: Zixuan Liu <nodeces@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/2b4a3c14458f564e7e0178f71979a41e7b7a42b7",
          "parents": {
            "nodes": [
              {
                "oid": "329e80b847bd6584cbb031a96d5416d4df488432",
                "message": "[improve][broker] Clear delayed message when unsubscribe &  Make clear operation asynchronous (#19901)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/ManagedLedgerConfig.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/ConsumedLedgersTrimTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin-api/src/main/java/org/apache/pulsar/common/policies/data/RetentionPolicies.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Lu_Np2gAoMTVjNzlhYTEyNWUwZGVmYzA4ZjMzMWI1YzM5NjAzZTY5MWU1MGQ2Mg",
                "url": "https://github.com/apache/pulsar/pull/19777/commits/15c79aa125e0defc08f331b5c39603e691e50d62"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 18112,
                "url": "https://github.com/apache/pulsar/issues/18112",
                "title": "[Bug] RetentionPolicies types mismatch",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\"><code class=\"notranslate\">master</code> branch.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">retentionSizeInMB</code> field has <code class=\"notranslate\">long</code> type here:</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/7404e0d77d98c2ec4fab9a111b8ced38d33dcd5a/pulsar-client-admin-api/src/main/java/org/apache/pulsar/common/policies/data/RetentionPolicies.java#L32\">pulsar/pulsar-client-admin-api/src/main/java/org/apache/pulsar/common/policies/data/RetentionPolicies.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 32\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/7404e0d77d98c2ec4fab9a111b8ced38d33dcd5a\">7404e0d</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L32\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"32\"></td>\n          <td id=\"LC32\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">private</span> <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">retentionSizeInMB</span>; </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">But it is an <code class=\"notranslate\">int</code> type in the constructor:</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/7404e0d77d98c2ec4fab9a111b8ced38d33dcd5a/pulsar-client-admin-api/src/main/java/org/apache/pulsar/common/policies/data/RetentionPolicies.java#L38\">pulsar/pulsar-client-admin-api/src/main/java/org/apache/pulsar/common/policies/data/RetentionPolicies.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 38\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/7404e0d77d98c2ec4fab9a111b8ced38d33dcd5a\">7404e0d</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L38\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"38\"></td>\n          <td id=\"LC38\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">public</span> <span class=\"pl-smi\">RetentionPolicies</span>(<span class=\"pl-smi\">int</span> <span class=\"pl-s1\">retentionTimeInMinutes</span>, <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">retentionSizeInMB</span>) { </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I expect the same types for the private field and the constructor.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">It's not a user-faced bug.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/18112",
                "createdAt": "2022-10-19T09:45:14Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[feat][cli] Support for transaction consistence test with PerformanceProducer.",
        "url": "https://github.com/apache/pulsar/pull/19781",
        "resourcePath": "/apache/pulsar/pull/19781",
        "createdAt": "2023-03-10T07:07:38Z",
        "number": 19781,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-testclient/src/main/java/org/apache/pulsar/testclient/IncrementedNumberMessageFormatter.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/main/java/org/apache/pulsar/testclient/PerformanceProducer.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Lvauq2gAoYmRjMWMyNDIzZDU3MDRlMTQxY2QyY2JjMzNlNjc5NTYyZTdhMTRhOA",
                "url": "https://github.com/apache/pulsar/pull/19781/commits/bdc1c2423d5704e141cd2cbc33e679562e7a14a8"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19780,
                "url": "https://github.com/apache/pulsar/issues/19780",
                "title": "[feat] [perf] Support for transaction consistence test with PerformanceProducer.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Currently, <code class=\"notranslate\">bin/pulsar-perf</code> do not support for verify the exactly-once semantics. Like Kafka, Pulsar only support for exactly-once semantics in specific working pattern, that is <code class=\"notranslate\">consume-transform-produce</code>, while i try to achieve exactly-once semantics in other working pattern.  the detailed info see <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1614594311\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19744\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/19744/hovercard\" href=\"https://github.com/apache/pulsar/issues/19744\">#19744</a>.<br>\nThis tool is to verify the transaction consistence with producer-only working pattern. We can use this tool to generate messages with or without transaction, and do the experiment in any disturbing environment, for example, we can restart brokers hundreds of times, unload topics hundreds of times or use <code class=\"notranslate\">tc qdisc</code> to drop the packet. Finally, we consume the messages produced <strong>without interference</strong> and check for the data integrity, that is no message lost or duplication.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Implement the logic into <code class=\"notranslate\">PerformanceProducer</code>.</p>\n<h2 dir=\"auto\">Message Format</h2>\n<p dir=\"auto\">For the convenience of checking for the data integrity, <strong>we define the message format as number incrementing from 0 to N</strong>. For example, we start the perf process with configuration <code class=\"notranslate\">--num-messages 100000000</code>, then we read the content produced to broker successfully and <strong>verify whether the content constitute a range <code class=\"notranslate\">[0,100000000)</code></strong>, which can be implemented easily with <code class=\"notranslate\">RangeSet</code>.</p>\n<h2 dir=\"auto\">Client-Side Persistence Scheme</h2>\n<p dir=\"auto\">Client may corrupt and restart when produce messages in transaction, it need to persist the messages that have been sent in transaction to avoid message lost or duplication.<br>\nI adopt a simper way to persist the messages, that is to persist every messages in a local file <code class=\"notranslate\">tmpX.data</code> when producer send it in transaction. <strong>If the transaction is committed successfully, the content of local file <code class=\"notranslate\">tmpX.data</code> will be cleared. If the transaction is aborted or committed failed, we will resend messages in this aborted transaction with a new transaction.</strong><br>\n<strong>We assign every transaction with a tmp file, such as <code class=\"notranslate\">tmp0.data</code></strong>, to persist the messages have been sent in this transaction. As there will be many transaction running concurrently, we will create many tmp files for persistence, and add concurrent control to these files.<br>\nWhen client is shutdown, it will take a snapshot of current number of message generator <code class=\"notranslate\">IncrementedNumberMessageFormatter</code>. When the client is restarted, it will read the value from snapshot and continue generate number from the state before shutdown.</p>\n<p dir=\"auto\">the detailed implementation see <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1618471944\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19781\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19781/hovercard\" href=\"https://github.com/apache/pulsar/pull/19781\">#19781</a>.<br>\nI will show my experiment result following.</p>\n<h2 dir=\"auto\">Usage</h2>\n<h3 dir=\"auto\">Non-transactional produce with topic unload</h3>\n<p dir=\"auto\">Produce 100 million messages, unload topics every 80 seconds for 50 times.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-perf produce --num-messages 100000000 --rate 100000 --format-class org.apache.pulsar.testclient.IncrementedNumberMessageFormatter --send-timeout 30 --resend-on-failure  persistent://test/test/testTxn10\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-perf produce --num-messages 100000000 --rate 100000 --format-class org.apache.pulsar.testclient.IncrementedNumberMessageFormatter --send-timeout 30 --resend-on-failure  persistent://test/test/testTxn10\n</code></pre></div>\n<p dir=\"auto\">the script for unloading topics:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"#!/bin/bash\n# script for restarting broker.\n\ninterval=80  # interval in second to restart broker.\nunloadCount=50  # total restart times.\ntopic=&quot;persistent://test/test/testTxn10&quot;\n\nwhile true\ndo\n  if test $unloadCount -ne 0\n  then\n    echo &quot;unload topic:&quot;$topic\n    bin/pulsar-admin topics unload $topic\n    unloadCount=$(expr $unloadCount - 1)\n  else\n    break\n  fi\n  sleep $interval\ndone\"><pre class=\"notranslate\"><code class=\"notranslate\">#!/bin/bash\n# script for restarting broker.\n\ninterval=80  # interval in second to restart broker.\nunloadCount=50  # total restart times.\ntopic=\"persistent://test/test/testTxn10\"\n\nwhile true\ndo\n  if test $unloadCount -ne 0\n  then\n    echo \"unload topic:\"$topic\n    bin/pulsar-admin topics unload $topic\n    unloadCount=$(expr $unloadCount - 1)\n  else\n    break\n  fi\n  sleep $interval\ndone\n</code></pre></div>\n<p dir=\"auto\">Result as follows:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/52550727/224249248-1346f535-3981-47f5-b56a-4dfc2b782708.png\"><img src=\"https://user-images.githubusercontent.com/52550727/224249248-1346f535-3981-47f5-b56a-4dfc2b782708.png\" alt=\"image\" style=\"max-width: 100%;\"></a><br>\n<a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/52550727/224249287-eb569774-7d84-44ce-ae47-2eae875bcbbc.png\"><img src=\"https://user-images.githubusercontent.com/52550727/224249287-eb569774-7d84-44ce-ae47-2eae875bcbbc.png\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"09:59:54.250 [main] INFO  org.example.utils.PulsarCommonUtils - only one range exists. RangeSet:[[0..100000000)]\n09:59:54.254 [main] INFO  org.example.utils.PulsarCommonUtils - duplicate message count:11317, total message count:100011317, duplicate rate:0.011315719400035498%\"><pre class=\"notranslate\"><code class=\"notranslate\">09:59:54.250 [main] INFO  org.example.utils.PulsarCommonUtils - only one range exists. RangeSet:[[0..100000000)]\n09:59:54.254 [main] INFO  org.example.utils.PulsarCommonUtils - duplicate message count:11317, total message count:100011317, duplicate rate:0.011315719400035498%\n</code></pre></div>\n<p dir=\"auto\">There are 11317 messages are duplicated.</p>\n<h3 dir=\"auto\">Transactional produce with broker restarting hundreds of times.</h3>\n<p dir=\"auto\">Produce 100 million messages, restarting brokers every 120 seconds for 50 times.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"nohup bin/pulsar-perf produce --producer-name &quot;txnProducer&quot; -txn -nmt 800 --num-messages 100000000 --txn-test-enabled --max-txn 20 --rate 100000 --format-class org.apache.pulsar.testclient.IncrementedNumberMessageFormatter --send-timeout 0 persistent://test/test/testTxn10 &gt; produce.txt &amp;\"><pre class=\"notranslate\"><code class=\"notranslate\">nohup bin/pulsar-perf produce --producer-name \"txnProducer\" -txn -nmt 800 --num-messages 100000000 --txn-test-enabled --max-txn 20 --rate 100000 --format-class org.apache.pulsar.testclient.IncrementedNumberMessageFormatter --send-timeout 0 persistent://test/test/testTxn10 &gt; produce.txt &amp;\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"#!/bin/bash\n# script for restarting broker.\n\ninterval=120  # interval in second to restart broker.\nrestartCount=50  # total restart times.\n\nwhile true\ndo\n  if test $restartCount -ne 0\n  then\n    bin/pulsar-daemon restart broker\n    restartCount=$(expr $restartCount - 1)\n  else\n    break\n  fi\n  sleep $interval\ndone\"><pre class=\"notranslate\"><code class=\"notranslate\">#!/bin/bash\n# script for restarting broker.\n\ninterval=120  # interval in second to restart broker.\nrestartCount=50  # total restart times.\n\nwhile true\ndo\n  if test $restartCount -ne 0\n  then\n    bin/pulsar-daemon restart broker\n    restartCount=$(expr $restartCount - 1)\n  else\n    break\n  fi\n  sleep $interval\ndone\n</code></pre></div>\n<p dir=\"auto\">The result is as follows:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"19:21:23.507 [main] INFO  org.example.utils.PulsarCommonUtils - only one range exists. RangeSet:[[0..100000000)]\n19:21:23.510 [main] INFO  org.example.utils.PulsarCommonUtils - duplicate message count:800, total message count:100000800, duplicate rate:7.999936000511996E-4%\"><pre class=\"notranslate\"><code class=\"notranslate\">19:21:23.507 [main] INFO  org.example.utils.PulsarCommonUtils - only one range exists. RangeSet:[[0..100000000)]\n19:21:23.510 [main] INFO  org.example.utils.PulsarCommonUtils - duplicate message count:800, total message count:100000800, duplicate rate:7.999936000511996E-4%\n</code></pre></div>\n<p dir=\"auto\">There are 800 messages duplicated, which is resulted by one transaction, as we produce 800 messages in a transaction. So, we can see that <strong>exactly-once semantics is not guaranteed in producer-only working pattern!</strong><br>\nThe reason accounting for duplication see <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1598170958\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19629\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/19629/hovercard\" href=\"https://github.com/apache/pulsar/issues/19629\">#19629</a>, and I have fixed them in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1614594311\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19744\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/19744/hovercard\" href=\"https://github.com/apache/pulsar/issues/19744\">#19744</a>.</p>\n<p dir=\"auto\">Following I will show the experiment result after i merge the PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1602635085\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19662\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19662/hovercard\" href=\"https://github.com/apache/pulsar/pull/19662\">#19662</a>, and you can repeat my experiment with these two PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1602635085\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19662\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19662/hovercard\" href=\"https://github.com/apache/pulsar/pull/19662\">#19662</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1618471944\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19781\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19781/hovercard\" href=\"https://github.com/apache/pulsar/pull/19781\">#19781</a>.</p>\n<h3 dir=\"auto\">Transactional produce with broker restarting hundreds of times (PR merged).</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"nohup bin/pulsar-perf produce --producer-name &quot;txnProducer&quot; -txn -nmt 800 --num-messages 100000000 --txn-test-enabled --max-txn 30 --rate 200000 --format-class org.apache.pulsar.testclient.IncrementedNumberMessageFormatter --send-timeout 0 -threads 4 persistent://test/test/testTxn10 &gt; produce.txt &amp;\"><pre class=\"notranslate\"><code class=\"notranslate\">nohup bin/pulsar-perf produce --producer-name \"txnProducer\" -txn -nmt 800 --num-messages 100000000 --txn-test-enabled --max-txn 30 --rate 200000 --format-class org.apache.pulsar.testclient.IncrementedNumberMessageFormatter --send-timeout 0 -threads 4 persistent://test/test/testTxn10 &gt; produce.txt &amp;\n</code></pre></div>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/52550727/224252058-524a55d1-6b5c-4ed8-95ba-8757b162481a.png\"><img width=\"892\" alt=\"image\" src=\"https://user-images.githubusercontent.com/52550727/224252058-524a55d1-6b5c-4ed8-95ba-8757b162481a.png\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/52550727/224252159-b0397d27-3fd6-46e6-b717-2cd472b2f73c.png\"><img width=\"648\" alt=\"image\" src=\"https://user-images.githubusercontent.com/52550727/224252159-b0397d27-3fd6-46e6-b717-2cd472b2f73c.png\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/52550727/224252201-74be1b35-1405-4dcf-b20a-545fc2718b30.png\"><img width=\"643\" alt=\"image\" src=\"https://user-images.githubusercontent.com/52550727/224252201-74be1b35-1405-4dcf-b20a-545fc2718b30.png\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/52550727/224252270-597cb40c-8ba8-4e6d-a955-2548c189713c.png\"><img width=\"1196\" alt=\"image\" src=\"https://user-images.githubusercontent.com/52550727/224252270-597cb40c-8ba8-4e6d-a955-2548c189713c.png\" style=\"max-width: 100%;\"></a></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"13:17:03.543 [main] INFO  org.example.utils.PulsarCommonUtils - only one range exists. RangeSet:[[0..100000000)]\n13:17:03.546 [main] INFO  org.example.utils.PulsarCommonUtils - duplicate message count:0, total message count:100000000, duplicate rate:0.0%\"><pre class=\"notranslate\"><code class=\"notranslate\">13:17:03.543 [main] INFO  org.example.utils.PulsarCommonUtils - only one range exists. RangeSet:[[0..100000000)]\n13:17:03.546 [main] INFO  org.example.utils.PulsarCommonUtils - duplicate message count:0, total message count:100000000, duplicate rate:0.0%\n</code></pre></div>\n<p dir=\"auto\">We can see that there is no message duplication or lost.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19780",
                "createdAt": "2023-03-10T07:01:57Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [test] Fix flaky test `MetadataStoreStatsTest.testBatchMetadataStoreMetrics`",
        "url": "https://github.com/apache/pulsar/pull/19793",
        "resourcePath": "/apache/pulsar/pull/19793",
        "createdAt": "2023-03-11T12:48:44Z",
        "number": 19793,
        "mergeCommit": {
          "oid": "4e48cc30bfa6bf4d01659aac34d510f8b1492a10",
          "message": "[fix] [test] Fix flaky test `MetadataStoreStatsTest.testBatchMetadataStoreMetrics` (#19793)\n\nCo-authored-by: wangjinlong <wangjinlong@zhihu.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/4e48cc30bfa6bf4d01659aac34d510f8b1492a10",
          "parents": {
            "nodes": [
              {
                "oid": "11cfaea0deefc3c5d32f6504d266f84d12f89641",
                "message": "[improve][doc] enhancement of link (#19819)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/zookeeper/MultiBrokerMetadataConsistencyTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5L0cQN2gAoOTQwZDAxOTBjZWU5M2Y2Mjc1ZDNhYTUzZmRmYmEwMzkzMzQ3NzUyMA",
                "url": "https://github.com/apache/pulsar/pull/19793/commits/940d0190cee93f6275d3aa53fdfba03933477520"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19792,
                "url": "https://github.com/apache/pulsar/issues/19792",
                "title": "Flaky-test: org.apache.pulsar.broker.stats.MetadataStoreStatsTest.testBatchMetadataStoreMetrics",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4383540966/jobs/7674179427\">https://github.com/apache/pulsar/actions/runs/4383540966/jobs/7674179427</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<p dir=\"auto\">i don't known where to find unit test fail stacktrace. please let me know.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19792",
                "createdAt": "2023-03-11T12:06:46Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[wip][feat][io] Debezium DB2 source connector for Pulsar",
        "url": "https://github.com/apache/pulsar/pull/19821",
        "resourcePath": "/apache/pulsar/pull/19821",
        "createdAt": "2023-03-15T11:30:27Z",
        "number": 19821,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/docker-images/debezium-db2-test-image/Dockerfile"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/docker-images/debezium-db2-test-image/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/docker-images/latest-version-image/Dockerfile"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/docker-images/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/containers/DebeziumDB2DbContainer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/sources/SourceTester.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/sources/debezium/DebeziumDB2DbSourceTester.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/sources/debezium/PulsarDebeziumSourcesTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/sources/debezium/PulsarIODebeziumSourceRunner.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5MGLxI2gAoNDVmMmZkZTk3OTllNTc1MTViYTkwZmFmN2Y0YjllMTg1MDI0YWUxYQ",
                "url": "https://github.com/apache/pulsar/pull/19821/commits/45f2fde9799e57515ba90faf7f4b9e185024ae1a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 7837,
                "url": "https://github.com/apache/pulsar/issues/7837",
                "title": "DB2 Connector for Pulsar",
                "bodyHTML": "<p dir=\"auto\"><strong>Is your enhancement request related to a problem? Please describe.</strong><br>\nWe want to receive events in Pulsar for any changes done to the DB2 (in AS400 IBM machine) database,</p>\n<p dir=\"auto\"><strong>Describe the solution you'd like</strong><br>\nA new connector for pulsar</p>\n<p dir=\"auto\"><strong>Describe alternatives you've considered</strong><br>\nUsing the incubating version of debezium API for kafka</p>",
                "resourcePath": "/apache/pulsar/issues/7837",
                "createdAt": "2020-08-18T09:24:04Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "help wanted"
                      }
                    },
                    {
                      "node": {
                        "name": "lifecycle/stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] OpFindNewest#readEntryComplete, condition.apply(entry) is executed twice.",
        "url": "https://github.com/apache/pulsar/pull/19823",
        "resourcePath": "/apache/pulsar/pull/19823",
        "createdAt": "2023-03-15T12:03:15Z",
        "number": 19823,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/OpFindNewest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5MGXSa2gAoZDYzOGJiMmNmZTExNGU1YWNkNDViZjI3YzI4OGZhZWQyNWJkNzE5Zg",
                "url": "https://github.com/apache/pulsar/pull/19823/commits/d638bb2cfe114e5acd45bf27c288faed25bd719f"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19808,
                "url": "https://github.com/apache/pulsar/issues/19808",
                "title": "[Bug]  org.apache.bookkeeper.mledger.impl.OpFindNewest#readEntryComplete ",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.11<br>\norg.apache.bookkeeper.mledger.impl.OpFindNewest#readEntryComplete</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/38995810/225040223-5f4a081e-b0a9-443c-9fd4-6d637729a915.png\"><img src=\"https://user-images.githubusercontent.com/38995810/225040223-5f4a081e-b0a9-443c-9fd4-6d637729a915.png\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">1.state = checkFirst, condition.apply(entry) = true<br>\nThe following code is executed:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"lastMatchedPosition = position;\n                // check last entry\n                state = State.checkLast;\n                PositionImpl lastPosition = ledger.getLastPosition();\n                searchPosition = ledger.getPositionAfterN(searchPosition, max, PositionBound.startExcluded);\n                if (lastPosition.compareTo(searchPosition) &lt; 0) {\n                    if (log.isDebugEnabled()) {\n                        log.debug(&quot;first position {} matches, last should be {}, but moving to lastPos {}&quot;, position,\n                                searchPosition, lastPosition);\n                    }\n                    searchPosition = lastPosition;\n                }\n                find();\"><pre class=\"notranslate\"><code class=\"notranslate\">lastMatchedPosition = position;\n                // check last entry\n                state = State.checkLast;\n                PositionImpl lastPosition = ledger.getLastPosition();\n                searchPosition = ledger.getPositionAfterN(searchPosition, max, PositionBound.startExcluded);\n                if (lastPosition.compareTo(searchPosition) &lt; 0) {\n                    if (log.isDebugEnabled()) {\n                        log.debug(\"first position {} matches, last should be {}, but moving to lastPos {}\", position,\n                                searchPosition, lastPosition);\n                    }\n                    searchPosition = lastPosition;\n                }\n                find();\n</code></pre></div>\n<p dir=\"auto\">crux of the problem\uff1a<br>\nThe calculated searchPosition may be equal to the current entry position, then, after calling find(), state=checkLast is executed the next time, this causes condition.apply(entry) to be called twice, and with the same entry.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I'd like to add a check code, for example:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"if (position.equals(searchPosition)) {\n                    callback.findEntryComplete(position, OpFindNewest.this.ctx);\n                    return;\n                }\"><pre class=\"notranslate\"><code class=\"notranslate\">if (position.equals(searchPosition)) {\n                    callback.findEntryComplete(position, OpFindNewest.this.ctx);\n                    return;\n                }\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"        case checkFirst:\n            if (!condition.apply(entry)) {\n                // If no entry is found that matches the condition, it is expected to pass null to the callback.\n                // Otherwise, a message before the expiration date will be deleted due to message TTL.\n                // cf. https://github.com/apache/pulsar/issues/5579\n                callback.findEntryComplete(null, OpFindNewest.this.ctx);\n                return;\n            } else {\n                lastMatchedPosition = position;\n                // check last entry\n                state = State.checkLast;\n                PositionImpl lastPosition = ledger.getLastPosition();\n                searchPosition = ledger.getPositionAfterN(searchPosition, max, PositionBound.startExcluded);\n                if (position.equals(searchPosition)) {\n                    callback.findEntryComplete(position, OpFindNewest.this.ctx);\n                    return;\n                }\n                if (lastPosition.compareTo(searchPosition) &lt; 0) {\n                    if (log.isDebugEnabled()) {\n                        log.debug(&quot;first position {} matches, last should be {}, but moving to lastPos {}&quot;, position,\n                                searchPosition, lastPosition);\n                    }\n                    searchPosition = lastPosition;\n                }\n                find();\n            }\n            break;\"><pre class=\"notranslate\"><code class=\"notranslate\">        case checkFirst:\n            if (!condition.apply(entry)) {\n                // If no entry is found that matches the condition, it is expected to pass null to the callback.\n                // Otherwise, a message before the expiration date will be deleted due to message TTL.\n                // cf. https://github.com/apache/pulsar/issues/5579\n                callback.findEntryComplete(null, OpFindNewest.this.ctx);\n                return;\n            } else {\n                lastMatchedPosition = position;\n                // check last entry\n                state = State.checkLast;\n                PositionImpl lastPosition = ledger.getLastPosition();\n                searchPosition = ledger.getPositionAfterN(searchPosition, max, PositionBound.startExcluded);\n                if (position.equals(searchPosition)) {\n                    callback.findEntryComplete(position, OpFindNewest.this.ctx);\n                    return;\n                }\n                if (lastPosition.compareTo(searchPosition) &lt; 0) {\n                    if (log.isDebugEnabled()) {\n                        log.debug(\"first position {} matches, last should be {}, but moving to lastPos {}\", position,\n                                searchPosition, lastPosition);\n                    }\n                    searchPosition = lastPosition;\n                }\n                find();\n            }\n            break;\n</code></pre></div>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">condition.apply(entry) is executed twice</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">no</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19808",
                "createdAt": "2023-03-14T15:10:54Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [broker] Fix wrong logic of method TopicName.getPartition(int index)",
        "url": "https://github.com/apache/pulsar/pull/19841",
        "resourcePath": "/apache/pulsar/pull/19841",
        "createdAt": "2023-03-16T14:24:45Z",
        "number": 19841,
        "mergeCommit": {
          "oid": "6e585acd7d788c0979c113a92e341364c987cbe4",
          "message": "[fix] [broker] Fix wrong logic of method TopicName.getPartition(int index) (#19841)",
          "commitUrl": "https://github.com/apache/pulsar/commit/6e585acd7d788c0979c113a92e341364c987cbe4",
          "parents": {
            "nodes": [
              {
                "oid": "963260abfa142b8cf9ffe372d85d470a78c17235",
                "message": "[fix] [broker] Make `LeastResourceUsageWithWeight` thread safe (#20159)\n\nFix #20160\r\n\r\n### Motivation\r\nLeastResourceUsageWithWeight is an stateful object and current code will be accessed by multithread.\r\nthread 1: is execute https://github.com/apache/pulsar/blob/2b41e4eafb1cba0e548dd90df60e8cdbb24cd490/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/strategy/LeastResourceUsageWithWeight.java#L89-L91\r\nand thread 2: is execute https://github.com/apache/pulsar/blob/2b41e4eafb1cba0e548dd90df60e8cdbb24cd490/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/strategy/LeastResourceUsageWithWeight.java#L147-L150\r\nso an IndexOutOfBound occurs.\r\n\r\n### Modifications\r\n\r\nchange the state to `ThreadLocal`"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PartitionKeywordCompatibilityTest.java"
              }
            },
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TopicNameForInfiniteHttpCallGetSubscriptionsTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/naming/TopicName.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/test/java/org/apache/pulsar/common/naming/TopicNameTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5MN6X_2gAoNzNjYjgwNjM0OTQ5NjAwODQzMmNhNTQ3MTNkNTU4NDcyMWZhYzUwNw",
                "url": "https://github.com/apache/pulsar/pull/19841/commits/73cb806349496008432ca54713d5584721fac507"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 18149,
                "url": "https://github.com/apache/pulsar/issues/18149",
                "title": "[Bug] Partitioned DLQ topic with topic name contains -partition- may cause broker crash",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Version: Pulsar 2.9.3</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">broker set config as follow:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{\n    allowAutoTopicCreation: true,\n    allowAutoTopicCreationType: &quot;partitioned&quot;,\n    defaultNumPartitions: 1\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">{\n    allowAutoTopicCreation: true,\n    allowAutoTopicCreationType: \"partitioned\",\n    defaultNumPartitions: 1\n}\n</code></pre></div>\n<p dir=\"auto\">Client consume a partitioned topic with default DLQ policy.<br>\nWhen client trigger DLQ topic auto creation, a topic with name like <code class=\"notranslate\">persistent://public/default/test-partition-0-sub-DLQ</code> will be created.</p>\n<p dir=\"auto\">Call admin api to get subscriptions or create subsction for this DLQ topic.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Broker works fine.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Owner broker of the DLQ topic will hande the get subscriptions request. Broker send another nested get subscriptions request to itself in a very high frequency.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/65590138/197104645-f25360f2-deae-410a-9f98-57b63b39d994.png\"><img src=\"https://user-images.githubusercontent.com/65590138/197104645-f25360f2-deae-410a-9f98-57b63b39d994.png\" alt=\"image\" style=\"max-width: 100%;\"></a><br>\nBroker become very slow to handle other request, and after about 1 or 2 hours broker disconnected from zookeeper and restart.<br>\nThe DLQ topic will unload to another broker and cause another broker meet same problem.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">For the partitioned DLQ topic with topic name contains <code class=\"notranslate\">-partition-</code>, in <code class=\"notranslate\">internalGetSubscriptions</code> </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/639393d43e36bd26112866a00b0cff98fae9d0ac/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java#L1140\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 1140\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/639393d43e36bd26112866a00b0cff98fae9d0ac\">639393d</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L1140\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1140\"></td>\n          <td id=\"LC1140\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">partitionMetadata</span>.<span class=\"pl-s1\">partitions</span> &gt; <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\nSince partitions = 1, another getSubscriptions request with same topic name will send to the broker itself. <div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/639393d43e36bd26112866a00b0cff98fae9d0ac/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java#L1166\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 1166\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/639393d43e36bd26112866a00b0cff98fae9d0ac\">639393d</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L1166\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1166\"></td>\n          <td id=\"LC1166\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> .<span class=\"pl-en\">topics</span>().<span class=\"pl-en\">getSubscriptionsAsync</span>(<span class=\"pl-s1\">topic</span>); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1184299423\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/14920\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/14920/hovercard\" href=\"https://github.com/apache/pulsar/pull/14920\">#14920</a> Reject auto create partitioned topic when topic name contains <code class=\"notranslate\">-partition-</code>, but <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1271544531\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/16066\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/16066/hovercard\" href=\"https://github.com/apache/pulsar/pull/16066\">#16066</a> revert this change.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/18149",
                "createdAt": "2022-10-21T03:45:39Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] : PulsarStandaloneTest.testMetadataInitialization",
        "url": "https://github.com/apache/pulsar/pull/19842",
        "resourcePath": "/apache/pulsar/pull/19842",
        "createdAt": "2023-03-16T14:55:34Z",
        "number": 19842,
        "mergeCommit": {
          "oid": "a50ecda11f947e5120cfb01adbfd46f22b76f1f2",
          "message": "[fix][test] PulsarStandaloneTest.testMetadataInitialization (#19842)",
          "commitUrl": "https://github.com/apache/pulsar/commit/a50ecda11f947e5120cfb01adbfd46f22b76f1f2",
          "parents": {
            "nodes": [
              {
                "oid": "905e8ef730c96cbb43ad5c892f1dbfc3cd1521cc",
                "message": "[improve][meta] Make session notification to be async. (#19869)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/resources/configurations/standalone_no_client_auth.conf"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5MOJCj2gAoNGMzNmJlZTJlZGU4ZDM2YzM3MDZkMDg4Y2NkOThiZmFkMDY0YTYwNA",
                "url": "https://github.com/apache/pulsar/pull/19842/commits/4c36bee2ede8d36c3706d088ccd98bfad064a604"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19838,
                "url": "https://github.com/apache/pulsar/issues/19838",
                "title": "Flaky-test: PulsarStandaloneTest.testMetadataInitialization",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<p dir=\"auto\"><strong>Issue:</strong></p>\n<ul dir=\"auto\">\n<li>Running test-case locally failed with below stack-trace.</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"org.apache.pulsar.broker.PulsarServerException: java.lang.IllegalStateException: Unable to read VM NIC speed. You must set [loadBalancerOverrideBrokerNicSpeedGbps] to override it when load balancer is enabled.\n\n\tat org.apache.pulsar.broker.PulsarService.start(PulsarService.java:919)\n\tat org.apache.pulsar.PulsarStandalone.start(PulsarStandalone.java:349)\n\tat org.apache.pulsar.PulsarStandaloneTest.testMetadataInitialization(PulsarStandaloneTest.java:94)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:677)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n\tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n\tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n\tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n\tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n\tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n\tat org.testng.TestRunner.run(TestRunner.java:602)\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n\tat org.testng.TestNG.runSuites(TestNG.java:1099)\n\tat org.testng.TestNG.run(TestNG.java:1067)\n\tat com.intellij.rt.testng.IDEARemoteTestNG.run(IDEARemoteTestNG.java:66)\n\tat com.intellij.rt.testng.RemoteTestNGStarter.main(RemoteTestNGStarter.java:109)\nCaused by: java.lang.IllegalStateException: Unable to read VM NIC speed. You must set [loadBalancerOverrideBrokerNicSpeedGbps] to override it when load balancer is enabled.\n\tat org.apache.pulsar.broker.PulsarService.start(PulsarService.java:724)\"><pre class=\"notranslate\"><code class=\"notranslate\">org.apache.pulsar.broker.PulsarServerException: java.lang.IllegalStateException: Unable to read VM NIC speed. You must set [loadBalancerOverrideBrokerNicSpeedGbps] to override it when load balancer is enabled.\n\n\tat org.apache.pulsar.broker.PulsarService.start(PulsarService.java:919)\n\tat org.apache.pulsar.PulsarStandalone.start(PulsarStandalone.java:349)\n\tat org.apache.pulsar.PulsarStandaloneTest.testMetadataInitialization(PulsarStandaloneTest.java:94)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:677)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n\tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n\tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n\tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n\tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n\tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n\tat org.testng.TestRunner.run(TestRunner.java:602)\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n\tat org.testng.TestNG.runSuites(TestNG.java:1099)\n\tat org.testng.TestNG.run(TestNG.java:1067)\n\tat com.intellij.rt.testng.IDEARemoteTestNG.run(IDEARemoteTestNG.java:66)\n\tat com.intellij.rt.testng.RemoteTestNGStarter.main(RemoteTestNGStarter.java:109)\nCaused by: java.lang.IllegalStateException: Unable to read VM NIC speed. You must set [loadBalancerOverrideBrokerNicSpeedGbps] to override it when load balancer is enabled.\n\tat org.apache.pulsar.broker.PulsarService.start(PulsarService.java:724)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19838",
                "createdAt": "2023-03-16T11:10:57Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [test] Fix flaky test MetadataStoreStatsTest.testBatchMetadataStoreMetrics",
        "url": "https://github.com/apache/pulsar/pull/19854",
        "resourcePath": "/apache/pulsar/pull/19854",
        "createdAt": "2023-03-18T03:18:03Z",
        "number": 19854,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/stats/prometheus/PrometheusMetricsGeneratorUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/PrometheusMetricsGenerator.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/stats/MetadataStoreStatsTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/main/java/org/apache/pulsar/metadata/impl/stats/BatchMetadataStoreStats.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/main/java/org/apache/pulsar/metadata/impl/stats/MetadataStoreStats.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5MWTSM2gAoNTcxMzgzMTc3ZDYwZDY2MGM5NWY3OGUzNjUyMGQzMDlkMWFkMGY2Mg",
                "url": "https://github.com/apache/pulsar/pull/19854/commits/571383177d60d660c95f78e36520d309d1ad0f62"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19792,
                "url": "https://github.com/apache/pulsar/issues/19792",
                "title": "Flaky-test: org.apache.pulsar.broker.stats.MetadataStoreStatsTest.testBatchMetadataStoreMetrics",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4383540966/jobs/7674179427\">https://github.com/apache/pulsar/actions/runs/4383540966/jobs/7674179427</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<p dir=\"auto\">i don't known where to find unit test fail stacktrace. please let me know.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19792",
                "createdAt": "2023-03-11T12:06:46Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Fix function update error",
        "url": "https://github.com/apache/pulsar/pull/19895",
        "resourcePath": "/apache/pulsar/pull/19895",
        "createdAt": "2023-03-22T07:50:30Z",
        "number": 19895,
        "mergeCommit": {
          "oid": "563a573168ba51b60f060a993416d7ea642cc27b",
          "message": "[fix][fn] Fix function update error (#19895)",
          "commitUrl": "https://github.com/apache/pulsar/commit/563a573168ba51b60f060a993416d7ea642cc27b",
          "parents": {
            "nodes": [
              {
                "oid": "f92011762deea79040fb006fab0d0f297fae9e1f",
                "message": "[improve][broker] Change limitStatsLogging config default value to true (#20409)\n\nCo-authored-by: fanjianye <fanjianye@bigo.sg>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/rest/api/FunctionsImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/rest/api/SinksImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/rest/api/SourcesImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarFunctionsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5MnXnf2gAoZWZlMDk2OTY3YjlmMDQ5MWFhMmUzOWJjYjIxZTI0NTYyOWY1MTEwMA",
                "url": "https://github.com/apache/pulsar/pull/19895/commits/efe096967b9f0491aa2e39bcb21e245629f51100"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19721,
                "url": "https://github.com/apache/pulsar/issues/19721",
                "title": "[Bug] Cannot update Pulsar function in Pulsar standalone",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\"><strong>OS version:</strong> Ubuntu 22.04<br>\n<strong>Pulsar version:</strong> 2.11.0 (using apachepulsar/pulsar-all:2.11.0 Docker image)</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Run 2.11.0 standalone:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ docker run -it apachepulsar/pulsar:2.11.0 bin/pulsar standalone\"><pre class=\"notranslate\"><code class=\"notranslate\">$ docker run -it apachepulsar/pulsar:2.11.0 bin/pulsar standalone\n</code></pre></div>\n<p dir=\"auto\">Go into the container and create an arbitrary Pulsar function <code class=\"notranslate\">test_function.py</code>.</p>\n<p dir=\"auto\">Then register it:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ bin/pulsar-admin functions create \\\n  --py test_function.py \\\n  --classname test_function.ExamplePulsarFunction \\\n  --tenant public \\\n  --namespace default \\\n  --name test-function \\\n  --inputs persistent://public/default/test-input-topic \\\n  --output persistent://public/default/test-output-topic\nCreated successfully\"><pre class=\"notranslate\"><code class=\"notranslate\">$ bin/pulsar-admin functions create \\\n  --py test_function.py \\\n  --classname test_function.ExamplePulsarFunction \\\n  --tenant public \\\n  --namespace default \\\n  --name test-function \\\n  --inputs persistent://public/default/test-input-topic \\\n  --output persistent://public/default/test-output-topic\nCreated successfully\n</code></pre></div>\n<p dir=\"auto\">Now try to update it:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ bin/pulsar-admin functions update \\\n  --py test_function.py \\\n  --classname test_function.ExamplePulsarFunction \\\n  --tenant public \\\n  --namespace default \\\n  --name test-function \\\n  --inputs persistent://public/default/test-input-topic \\\n  --output persistent://public/default/test-output-topic\"><pre class=\"notranslate\"><code class=\"notranslate\">$ bin/pulsar-admin functions update \\\n  --py test_function.py \\\n  --classname test_function.ExamplePulsarFunction \\\n  --tenant public \\\n  --namespace default \\\n  --name test-function \\\n  --inputs persistent://public/default/test-input-topic \\\n  --output persistent://public/default/test-output-topic\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I'd expect to see the <code class=\"notranslate\">Updated successfully</code> message from updating a Pulsar function.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">I get the error</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Package 'function://public/default/test-function@0' metadata already exists`.\"><pre class=\"notranslate\"><code class=\"notranslate\">Package 'function://public/default/test-function@0' metadata already exists`.\n</code></pre></div>\n<p dir=\"auto\">The logs look a bit like this:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-03-06T06:34:58,426+0000 [pulsar-web-38-2] ERROR org.apache.pulsar.functions.worker.rest.api.FunctionsImpl - Failed process Function public/default/test-function package: \norg.apache.pulsar.client.admin.PulsarAdminException$NotFoundException: Package 'function://public/default/test-function@0' metadata already exists\n        at org.apache.pulsar.client.admin.PulsarAdminException.wrap(PulsarAdminException.java:252) ~[org.apache.pulsar-pulsar-client-admin-api-2.11.0.jar:2.11.0]\n        at org.apache.pulsar.client.admin.internal.BaseResource.sync(BaseResource.java:316) ~[org.apache.pulsar-pulsar-client-admin-original-2.11.0.jar:2.11.0]\n        at org.apache.pulsar.client.admin.internal.PackagesImpl.upload(PackagesImpl.java:90) ~[org.apache.pulsar-pulsar-client-admin-original-2.11.0.jar:2.11.0]\n        at org.apache.pulsar.functions.worker.rest.api.ComponentImpl.getFunctionPackageLocation(ComponentImpl.java:411) ~[org.apache.pulsar-pulsar-functions-worker-2.11.0.jar:2.11.0]\n        at org.apache.pulsar.functions.worker.rest.api.FunctionsImpl.updateFunction(FunctionsImpl.java:459) ~[org.apache.pulsar-pulsar-functions-worker-2.11.0.jar:2.11.0]\n        at org.apache.pulsar.broker.admin.impl.FunctionsBase.updateFunction(FunctionsBase.java:326) ~[org.apache.pulsar-pulsar-broker-2.11.0.jar:2.11.0]\n        at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n        at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n        ...\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-03-06T06:34:58,426+0000 [pulsar-web-38-2] ERROR org.apache.pulsar.functions.worker.rest.api.FunctionsImpl - Failed process Function public/default/test-function package: \norg.apache.pulsar.client.admin.PulsarAdminException$NotFoundException: Package 'function://public/default/test-function@0' metadata already exists\n        at org.apache.pulsar.client.admin.PulsarAdminException.wrap(PulsarAdminException.java:252) ~[org.apache.pulsar-pulsar-client-admin-api-2.11.0.jar:2.11.0]\n        at org.apache.pulsar.client.admin.internal.BaseResource.sync(BaseResource.java:316) ~[org.apache.pulsar-pulsar-client-admin-original-2.11.0.jar:2.11.0]\n        at org.apache.pulsar.client.admin.internal.PackagesImpl.upload(PackagesImpl.java:90) ~[org.apache.pulsar-pulsar-client-admin-original-2.11.0.jar:2.11.0]\n        at org.apache.pulsar.functions.worker.rest.api.ComponentImpl.getFunctionPackageLocation(ComponentImpl.java:411) ~[org.apache.pulsar-pulsar-functions-worker-2.11.0.jar:2.11.0]\n        at org.apache.pulsar.functions.worker.rest.api.FunctionsImpl.updateFunction(FunctionsImpl.java:459) ~[org.apache.pulsar-pulsar-functions-worker-2.11.0.jar:2.11.0]\n        at org.apache.pulsar.broker.admin.impl.FunctionsBase.updateFunction(FunctionsBase.java:326) ~[org.apache.pulsar-pulsar-broker-2.11.0.jar:2.11.0]\n        at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n        at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n        ...\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">As far as I can tell <code class=\"notranslate\">ComponentImpl.getFunctionPackageLocation()</code> is getting called when updating the Pulsar function, but when non-BookKeeper package management is being used (which is the case for standalone) it looks like <code class=\"notranslate\">PackagesManagementImpl.upload()</code> happens, and that checks whether metadata exists or not + throws an error if it doesn't...</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19721",
                "createdAt": "2023-03-06T07:26:21Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Fix JavaInstanceStarter inferring type class name error",
        "url": "https://github.com/apache/pulsar/pull/19896",
        "resourcePath": "/apache/pulsar/pull/19896",
        "createdAt": "2023-03-22T07:58:31Z",
        "number": 19896,
        "mergeCommit": {
          "oid": "05e57dd3a443c5b99c21054c56a1b497455fa867",
          "message": "[fix][fn] Fix JavaInstanceStarter inferring type class name error (#19896)",
          "commitUrl": "https://github.com/apache/pulsar/commit/05e57dd3a443c5b99c21054c56a1b497455fa867",
          "parents": {
            "nodes": [
              {
                "oid": "946acc551da55d69a6d26d4696b4954cf89a88d2",
                "message": "[improve][monitor] Add JVM start time metric (#20381)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/JavaInstanceStarter.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/thread/ThreadRuntime.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/thread/ThreadRuntimeFactory.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5MnZdl2gAoNWZmODhmYmVmN2E4MjUyOGY4YjIyN2FlNTQxNDJmNjRkNWUwODI1OA",
                "url": "https://github.com/apache/pulsar/pull/19896/commits/5ff88fbef7a82528f8b227ae54142f64d5e08258"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19885,
                "url": "https://github.com/apache/pulsar/issues/19885",
                "title": "[Bug] Function Java Instance failed to infer type class name",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.11.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>start a pulsar docker container:</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"docker run -td --name temp apachepulsar/pulsar-all:2.11.0 bin/pulsar standalone\"><pre class=\"notranslate\"><code class=\"notranslate\">docker run -td --name temp apachepulsar/pulsar-all:2.11.0 bin/pulsar standalone\n</code></pre></div>\n<ol start=\"2\" dir=\"auto\">\n<li>start java instance directly</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"docker exec -it temp bash\n\njava -cp /pulsar/instances/java-instance.jar -Dpulsar.functions.instance.classpath=/pulsar/lib/* -Dlog4j.configurationFile=/pulsar/conf/java-log/java_instance_log4j.xml -Dpulsar.function.log.dir=logs/functions -Dpulsar.function.log.file=function-download-sample-inferring-type-0  -Xmx1G  org.apache.pulsar.functions.instance.JavaInstanceMain --jar examples/api-examples.jar --instance_id 0 --function_id 0-cb240a82-ebaa-46b7-9357-199867704176 --function_version 0 --function_details '{&quot;tenant&quot;:&quot;public&quot;,&quot;namespace&quot;:&quot;default&quot;,&quot;name&quot;:&quot;function-download-sample-inferring-type&quot;,&quot;className&quot;:&quot;org.apache.pulsar.functions.api.examples.ExclamationFunction&quot;,&quot;logTopic&quot;:&quot;persistent://public/default/logging-function-logs&quot;,&quot;secretsMap&quot;:&quot;{\\&quot;name\\&quot;:{\\&quot;path\\&quot;:\\&quot;test-secret\\&quot;,\\&quot;key\\&quot;:\\&quot;username\\&quot;},\\&quot;pwd\\&quot;:{\\&quot;path\\&quot;:\\&quot;test-secret\\&quot;,\\&quot;key\\&quot;:\\&quot;password\\&quot;}}&quot;,&quot;autoAck&quot;:true,&quot;parallelism&quot;:1,&quot;source&quot;:{&quot;inputSpecs&quot;:{&quot;persistent://public/default/input-download-java-topic&quot;:{}},&quot;subscriptionPosition&quot;:&quot;EARLIEST&quot;},&quot;sink&quot;:{&quot;topic&quot;:&quot;persistent://public/default/output-download-java-topic&quot;,&quot;forwardSourceMessageProperty&quot;:true},&quot;resources&quot;:{&quot;cpu&quot;:1,&quot;ram&quot;:&quot;1000000000&quot;},&quot;componentType&quot;:&quot;FUNCTION&quot;}' --pulsar_serviceurl pulsar://localhost:6650 --max_buffered_tuples 100 --port 9093 --metrics_port 9094 --expected_healthcheck_interval -1 --cluster_name test --use_tls false --secrets_provider org.apache.pulsar.functions.secretsprovider.EnvironmentBasedSecretsProvider --pending_async_requests 1000\"><pre class=\"notranslate\"><code class=\"notranslate\">docker exec -it temp bash\n\njava -cp /pulsar/instances/java-instance.jar -Dpulsar.functions.instance.classpath=/pulsar/lib/* -Dlog4j.configurationFile=/pulsar/conf/java-log/java_instance_log4j.xml -Dpulsar.function.log.dir=logs/functions -Dpulsar.function.log.file=function-download-sample-inferring-type-0  -Xmx1G  org.apache.pulsar.functions.instance.JavaInstanceMain --jar examples/api-examples.jar --instance_id 0 --function_id 0-cb240a82-ebaa-46b7-9357-199867704176 --function_version 0 --function_details '{\"tenant\":\"public\",\"namespace\":\"default\",\"name\":\"function-download-sample-inferring-type\",\"className\":\"org.apache.pulsar.functions.api.examples.ExclamationFunction\",\"logTopic\":\"persistent://public/default/logging-function-logs\",\"secretsMap\":\"{\\\"name\\\":{\\\"path\\\":\\\"test-secret\\\",\\\"key\\\":\\\"username\\\"},\\\"pwd\\\":{\\\"path\\\":\\\"test-secret\\\",\\\"key\\\":\\\"password\\\"}}\",\"autoAck\":true,\"parallelism\":1,\"source\":{\"inputSpecs\":{\"persistent://public/default/input-download-java-topic\":{}},\"subscriptionPosition\":\"EARLIEST\"},\"sink\":{\"topic\":\"persistent://public/default/output-download-java-topic\",\"forwardSourceMessageProperty\":true},\"resources\":{\"cpu\":1,\"ram\":\"1000000000\"},\"componentType\":\"FUNCTION\"}' --pulsar_serviceurl pulsar://localhost:6650 --max_buffered_tuples 100 --port 9093 --metrics_port 9094 --expected_healthcheck_interval -1 --cluster_name test --use_tls false --secrets_provider org.apache.pulsar.functions.secretsprovider.EnvironmentBasedSecretsProvider --pending_async_requests 1000\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">instance start successfully</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Exception in thread &quot;main&quot; java.lang.reflect.InvocationTargetException\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.apache.pulsar.functions.instance.JavaInstanceMain.main(JavaInstanceMain.java:104)\nCaused by: java.lang.NullPointerException: Cannot invoke &quot;java.util.Map.containsKey(Object)&quot; because &quot;userConfigs&quot; is null\n\tat org.apache.pulsar.functions.runtime.JavaInstanceStarter.inferringMissingTypeClassName(JavaInstanceStarter.java:313)\n\tat org.apache.pulsar.functions.runtime.JavaInstanceStarter.start(JavaInstanceStarter.java:178)\n\t... 5 more\"><pre class=\"notranslate\"><code class=\"notranslate\">Exception in thread \"main\" java.lang.reflect.InvocationTargetException\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.apache.pulsar.functions.instance.JavaInstanceMain.main(JavaInstanceMain.java:104)\nCaused by: java.lang.NullPointerException: Cannot invoke \"java.util.Map.containsKey(Object)\" because \"userConfigs\" is null\n\tat org.apache.pulsar.functions.runtime.JavaInstanceStarter.inferringMissingTypeClassName(JavaInstanceStarter.java:313)\n\tat org.apache.pulsar.functions.runtime.JavaInstanceStarter.start(JavaInstanceStarter.java:178)\n\t... 5 more\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19885",
                "createdAt": "2023-03-22T01:31:15Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Make pulsar-admin support update py/go with package url",
        "url": "https://github.com/apache/pulsar/pull/19897",
        "resourcePath": "/apache/pulsar/pull/19897",
        "createdAt": "2023-03-22T08:30:30Z",
        "number": 19897,
        "mergeCommit": {
          "oid": "fb9c4d034bfdcfdf256720ec2490c737cae53839",
          "message": "[fix][fn] Make pulsar-admin support update py/go with package url (#19897)",
          "commitUrl": "https://github.com/apache/pulsar/commit/fb9c4d034bfdcfdf256720ec2490c737cae53839",
          "parents": {
            "nodes": [
              {
                "oid": "f04252b84a8b594ea371645e367c491aa8e2dd80",
                "message": "[fix][fn] Support multiple input topics for Go runtime (#20000)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdFunctions.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Mnh2x2gAoNjc0MDdmZWZkNTgwNTZiYTQ4MzliYjMxNGE4NDVjNTU3Mzg4MTMyYg",
                "url": "https://github.com/apache/pulsar/pull/19897/commits/67407fefd58056ba4839bb314a845c557388132b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 18966,
                "url": "https://github.com/apache/pulsar/issues/18966",
                "title": "[Bug] Cannot update functions with Package URL",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar v2.10.2</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Enable package service</li>\n<li>build a go function (maybe works with python or java too, don't know)</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"pulsar-admin packages upload function://public/default/myfunction@1.0 --path /full/path/to/function_binary --description &quot;my function&quot;\nThe package 'function://public/default/myfunction@1.0' uploaded from path '/full/path/to/function_binary' successfully\n\npulsar-admin functions create --tenant public --namespace default --name myfunc --go &quot;function://public/default/myfunction@1.0&quot; --inputs persistent://public/default/test\nCreated successfully\n\npulsar-admin packages upload function://public/default/myfunction@2.0 --path /full/path/to/function_binary_v2 --description &quot;my function, but newer&quot;\nThe package 'function://public/default/myfunction@2.0' uploaded from path '/full/path/to/function_binary_v2' successfully\n\npulsar-admin functions update --go &quot;function://public/default/myfunction@2.0&quot; --tenant public --namespace default --name myfunc\nnull\n\nReason: java.lang.IllegalArgumentException: File is not a normal file /Users/me/pulsar/function:/public/default/myfunction@2.0\"><pre class=\"notranslate\"><code class=\"notranslate\">pulsar-admin packages upload function://public/default/myfunction@1.0 --path /full/path/to/function_binary --description \"my function\"\nThe package 'function://public/default/myfunction@1.0' uploaded from path '/full/path/to/function_binary' successfully\n\npulsar-admin functions create --tenant public --namespace default --name myfunc --go \"function://public/default/myfunction@1.0\" --inputs persistent://public/default/test\nCreated successfully\n\npulsar-admin packages upload function://public/default/myfunction@2.0 --path /full/path/to/function_binary_v2 --description \"my function, but newer\"\nThe package 'function://public/default/myfunction@2.0' uploaded from path '/full/path/to/function_binary_v2' successfully\n\npulsar-admin functions update --go \"function://public/default/myfunction@2.0\" --tenant public --namespace default --name myfunc\nnull\n\nReason: java.lang.IllegalArgumentException: File is not a normal file /Users/me/pulsar/function:/public/default/myfunction@2.0\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Updated successfully\"><pre class=\"notranslate\"><code class=\"notranslate\">Updated successfully\n</code></pre></div>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Reason: java.lang.IllegalArgumentException: File is not a normal file /Users/me/pulsar/function:/public/default/myfunction@2.0\"><pre class=\"notranslate\"><code class=\"notranslate\">Reason: java.lang.IllegalArgumentException: File is not a normal file /Users/me/pulsar/function:/public/default/myfunction@2.0\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">Unlike <code class=\"notranslate\">functions create</code>, <code class=\"notranslate\">functions update</code> does not seem to understand package URLs, and attempts to access a local file. Since packages have built in versioning, it only makes sense that you would be able to create a new package version and update the function to use it. This would be emanently useful for testing and/or staging upgrades to running functions, so it feels like it should work, however documentation on the subject is kind of hazy.  In any case, it should be supported if it's not.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/18966",
                "createdAt": "2022-12-17T05:34:40Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][admin] Fix delete tenant",
        "url": "https://github.com/apache/pulsar/pull/19925",
        "resourcePath": "/apache/pulsar/pull/19925",
        "createdAt": "2023-03-25T11:51:21Z",
        "number": 19925,
        "mergeCommit": {
          "oid": "32ad90606062c1eda660037e6277253b35d4a1e6",
          "message": "[fix][admin] Delete tenant local policy only if exist (#19925)\n\nSigned-off-by: nodece <nodeces@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/32ad90606062c1eda660037e6277253b35d4a1e6",
          "parents": {
            "nodes": [
              {
                "oid": "cda2827acbe62ba6c5a4dd98dbee7c9a82548339",
                "message": "[fix][fn] Revert change to deprecation since it broke the master branch (#19904)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/resources/LocalPoliciesResources.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTenantTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5M5AIs2gAoYWFmZDdlOWRkMzdjMGU5MTE5NDk4ZjA4MDU4Nzc5OGVhMDFiN2IyNg",
                "url": "https://github.com/apache/pulsar/pull/19925/commits/aafd7e9dd37c0e9119498f080587798ea01b7b26"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19921,
                "url": "https://github.com/apache/pulsar/issues/19921",
                "title": "[Bug] Deleting a tenant results in a HTTP 500 error, but deletes the tenant",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar 2.11.0<br>\nmacOS Ventura 13.2.1<br>\nRunning Pulsar standalone</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"pulsar-admin tenants list\npulsar-admin tenants create newtenant\npulsar-admin tenants list\npulsar-admin tenants delete newtenant\npulsar-admin tenants list\"><pre class=\"notranslate\"><code class=\"notranslate\">pulsar-admin tenants list\npulsar-admin tenants create newtenant\npulsar-admin tenants list\npulsar-admin tenants delete newtenant\npulsar-admin tenants list\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"dameiss@myhost bin % ./pulsar-admin tenants list\npublic\npulsar\ndameiss@myhost bin % ./pulsar-admin tenants create newtenant\ndameiss@myhost bin % ./pulsar-admin tenants list\nnewtenant\npublic\npulsar\ndameiss@myhost bin % ./pulsar-admin tenants delete newtenant\ndameiss@myhost bin % ./pulsar-admin tenants list\npublic\npulsar\"><pre class=\"notranslate\"><code class=\"notranslate\">dameiss@myhost bin % ./pulsar-admin tenants list\npublic\npulsar\ndameiss@myhost bin % ./pulsar-admin tenants create newtenant\ndameiss@myhost bin % ./pulsar-admin tenants list\nnewtenant\npublic\npulsar\ndameiss@myhost bin % ./pulsar-admin tenants delete newtenant\ndameiss@myhost bin % ./pulsar-admin tenants list\npublic\npulsar\n</code></pre></div>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"dameiss@myhost bin % ./pulsar-admin tenants list\npublic\npulsar\ndameiss@myhost bin % ./pulsar-admin tenants create newtenant\ndameiss@myhost bin % ./pulsar-admin tenants list\nnewtenant\npublic\npulsar\ndameiss@myhost bin % ./pulsar-admin tenants delete newtenant\n2023-03-24T11:56:42,486-0500 [AsyncHttpClient-7-1] WARN  org.apache.pulsar.client.admin.internal.BaseResource - [http://localhost:8080/admin/v2/tenants/newtenant?force=false] Failed to perform http delete request: javax.ws.rs.InternalServerErrorException: HTTP 500 path /admin/local-policies/newtenant not found.\n\n --- An unexpected error occurred in the server ---\n\nMessage: path /admin/local-policies/newtenant not found.\n\nStacktrace:\n\norg.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: path /admin/local-policies/newtenant not found.\n\tat org.apache.pulsar.metadata.impl.RocksdbMetadataStore.storeDelete(RocksdbMetadataStore.java:504)\n\tat org.apache.pulsar.metadata.impl.AbstractMetadataStore.deleteInternal(AbstractMetadataStore.java:333)\n\tat org.apache.pulsar.metadata.impl.AbstractMetadataStore.delete(AbstractMetadataStore.java:327)\n\tat org.apache.pulsar.metadata.cache.impl.MetadataCacheImpl.delete(MetadataCacheImpl.java:248)\n\tat org.apache.pulsar.broker.resources.BaseResources.deleteAsync(BaseResources.java:153)\n\tat org.apache.pulsar.broker.resources.LocalPoliciesResources.deleteLocalPoliciesTenantAsync(LocalPoliciesResources.java:88)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.lambda$internalDeleteTenantAsync$33(TenantsBase.java:240)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2341)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.internalDeleteTenantAsync(TenantsBase.java:239)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.internalDeleteTenant(TenantsBase.java:223)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.lambda$deleteTenant$24(TenantsBase.java:205)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2341)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.deleteTenant(TenantsBase.java:205)\n\tat java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:578)\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:52)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:124)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:167)\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:159)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:79)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:475)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:397)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:81)\n\tat org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:255)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:292)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:274)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:244)\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:265)\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:234)\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:680)\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:394)\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:346)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:366)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:319)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:205)\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:799)\n\tat org.eclipse.jetty.servlet.ServletHandler$ChainEnd.doFilter(ServletHandler.java:1656)\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:67)\n\tat org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193)\n\tat org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626)\n\tat org.eclipse.jetty.servlets.QoSFilter.doFilter(QoSFilter.java:202)\n\tat org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193)\n\tat org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:552)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1624)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1440)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:505)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1594)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1355)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:234)\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146)\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:181)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:516)\n\tat org.eclipse.jetty.server.HttpChannel.lambda$handle$1(HttpChannel.java:487)\n\tat org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:732)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:479)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:277)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105)\n\tat org.eclipse.jetty.io.ChannelEndPoint$1.run(ChannelEndPoint.java:104)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:338)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:315)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:173)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:131)\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:409)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1589)\n\n\nReason:\n --- An unexpected error occurred in the server ---\n\nMessage: path /admin/local-policies/newtenant not found.\n\nStacktrace:\n\norg.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: path /admin/local-policies/newtenant not found.\n\tat org.apache.pulsar.metadata.impl.RocksdbMetadataStore.storeDelete(RocksdbMetadataStore.java:504)\n\tat org.apache.pulsar.metadata.impl.AbstractMetadataStore.deleteInternal(AbstractMetadataStore.java:333)\n\tat org.apache.pulsar.metadata.impl.AbstractMetadataStore.delete(AbstractMetadataStore.java:327)\n\tat org.apache.pulsar.metadata.cache.impl.MetadataCacheImpl.delete(MetadataCacheImpl.java:248)\n\tat org.apache.pulsar.broker.resources.BaseResources.deleteAsync(BaseResources.java:153)\n\tat org.apache.pulsar.broker.resources.LocalPoliciesResources.deleteLocalPoliciesTenantAsync(LocalPoliciesResources.java:88)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.lambda$internalDeleteTenantAsync$33(TenantsBase.java:240)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2341)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.internalDeleteTenantAsync(TenantsBase.java:239)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.internalDeleteTenant(TenantsBase.java:223)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.lambda$deleteTenant$24(TenantsBase.java:205)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2341)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.deleteTenant(TenantsBase.java:205)\n\tat java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:578)\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:52)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:124)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:167)\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:159)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:79)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:475)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:397)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:81)\n\tat org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:255)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:292)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:274)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:244)\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:265)\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:234)\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:680)\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:394)\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:346)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:366)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:319)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:205)\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:799)\n\tat org.eclipse.jetty.servlet.ServletHandler$ChainEnd.doFilter(ServletHandler.java:1656)\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:67)\n\tat org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193)\n\tat org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626)\n\tat org.eclipse.jetty.servlets.QoSFilter.doFilter(QoSFilter.java:202)\n\tat org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193)\n\tat org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:552)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1624)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1440)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:505)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1594)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1355)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:234)\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146)\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:181)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:516)\n\tat org.eclipse.jetty.server.HttpChannel.lambda$handle$1(HttpChannel.java:487)\n\tat org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:732)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:479)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:277)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105)\n\tat org.eclipse.jetty.io.ChannelEndPoint$1.run(ChannelEndPoint.java:104)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:338)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:315)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:173)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:131)\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:409)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1589)\n\ndameiss@myhost bin % ./pulsar-admin tenants list\npublic\npulsar\"><pre class=\"notranslate\"><code class=\"notranslate\">dameiss@myhost bin % ./pulsar-admin tenants list\npublic\npulsar\ndameiss@myhost bin % ./pulsar-admin tenants create newtenant\ndameiss@myhost bin % ./pulsar-admin tenants list\nnewtenant\npublic\npulsar\ndameiss@myhost bin % ./pulsar-admin tenants delete newtenant\n2023-03-24T11:56:42,486-0500 [AsyncHttpClient-7-1] WARN  org.apache.pulsar.client.admin.internal.BaseResource - [http://localhost:8080/admin/v2/tenants/newtenant?force=false] Failed to perform http delete request: javax.ws.rs.InternalServerErrorException: HTTP 500 path /admin/local-policies/newtenant not found.\n\n --- An unexpected error occurred in the server ---\n\nMessage: path /admin/local-policies/newtenant not found.\n\nStacktrace:\n\norg.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: path /admin/local-policies/newtenant not found.\n\tat org.apache.pulsar.metadata.impl.RocksdbMetadataStore.storeDelete(RocksdbMetadataStore.java:504)\n\tat org.apache.pulsar.metadata.impl.AbstractMetadataStore.deleteInternal(AbstractMetadataStore.java:333)\n\tat org.apache.pulsar.metadata.impl.AbstractMetadataStore.delete(AbstractMetadataStore.java:327)\n\tat org.apache.pulsar.metadata.cache.impl.MetadataCacheImpl.delete(MetadataCacheImpl.java:248)\n\tat org.apache.pulsar.broker.resources.BaseResources.deleteAsync(BaseResources.java:153)\n\tat org.apache.pulsar.broker.resources.LocalPoliciesResources.deleteLocalPoliciesTenantAsync(LocalPoliciesResources.java:88)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.lambda$internalDeleteTenantAsync$33(TenantsBase.java:240)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2341)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.internalDeleteTenantAsync(TenantsBase.java:239)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.internalDeleteTenant(TenantsBase.java:223)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.lambda$deleteTenant$24(TenantsBase.java:205)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2341)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.deleteTenant(TenantsBase.java:205)\n\tat java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:578)\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:52)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:124)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:167)\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:159)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:79)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:475)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:397)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:81)\n\tat org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:255)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:292)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:274)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:244)\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:265)\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:234)\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:680)\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:394)\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:346)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:366)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:319)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:205)\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:799)\n\tat org.eclipse.jetty.servlet.ServletHandler$ChainEnd.doFilter(ServletHandler.java:1656)\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:67)\n\tat org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193)\n\tat org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626)\n\tat org.eclipse.jetty.servlets.QoSFilter.doFilter(QoSFilter.java:202)\n\tat org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193)\n\tat org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:552)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1624)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1440)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:505)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1594)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1355)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:234)\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146)\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:181)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:516)\n\tat org.eclipse.jetty.server.HttpChannel.lambda$handle$1(HttpChannel.java:487)\n\tat org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:732)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:479)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:277)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105)\n\tat org.eclipse.jetty.io.ChannelEndPoint$1.run(ChannelEndPoint.java:104)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:338)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:315)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:173)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:131)\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:409)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1589)\n\n\nReason:\n --- An unexpected error occurred in the server ---\n\nMessage: path /admin/local-policies/newtenant not found.\n\nStacktrace:\n\norg.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: path /admin/local-policies/newtenant not found.\n\tat org.apache.pulsar.metadata.impl.RocksdbMetadataStore.storeDelete(RocksdbMetadataStore.java:504)\n\tat org.apache.pulsar.metadata.impl.AbstractMetadataStore.deleteInternal(AbstractMetadataStore.java:333)\n\tat org.apache.pulsar.metadata.impl.AbstractMetadataStore.delete(AbstractMetadataStore.java:327)\n\tat org.apache.pulsar.metadata.cache.impl.MetadataCacheImpl.delete(MetadataCacheImpl.java:248)\n\tat org.apache.pulsar.broker.resources.BaseResources.deleteAsync(BaseResources.java:153)\n\tat org.apache.pulsar.broker.resources.LocalPoliciesResources.deleteLocalPoliciesTenantAsync(LocalPoliciesResources.java:88)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.lambda$internalDeleteTenantAsync$33(TenantsBase.java:240)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2341)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.internalDeleteTenantAsync(TenantsBase.java:239)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.internalDeleteTenant(TenantsBase.java:223)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.lambda$deleteTenant$24(TenantsBase.java:205)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2341)\n\tat org.apache.pulsar.broker.admin.impl.TenantsBase.deleteTenant(TenantsBase.java:205)\n\tat java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:104)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:578)\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:52)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:124)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:167)\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:159)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:79)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:475)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:397)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:81)\n\tat org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:255)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:292)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:274)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:244)\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:265)\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:234)\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:680)\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:394)\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:346)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:366)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:319)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:205)\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:799)\n\tat org.eclipse.jetty.servlet.ServletHandler$ChainEnd.doFilter(ServletHandler.java:1656)\n\tat org.apache.pulsar.broker.web.ResponseHandlerFilter.doFilter(ResponseHandlerFilter.java:67)\n\tat org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193)\n\tat org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626)\n\tat org.eclipse.jetty.servlets.QoSFilter.doFilter(QoSFilter.java:202)\n\tat org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193)\n\tat org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:552)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1624)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1440)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:505)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1594)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1355)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:234)\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146)\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:181)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:516)\n\tat org.eclipse.jetty.server.HttpChannel.lambda$handle$1(HttpChannel.java:487)\n\tat org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:732)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:479)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:277)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105)\n\tat org.eclipse.jetty.io.ChannelEndPoint$1.run(ChannelEndPoint.java:104)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:338)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:315)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:173)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:131)\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:409)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:1589)\n\ndameiss@myhost bin % ./pulsar-admin tenants list\npublic\npulsar\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The error also occurs when deleting via the REST API, e.g.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"DELETE http://localhost:8080/admin/v2/tenants/newtenant\"><pre class=\"notranslate\"><code class=\"notranslate\">DELETE http://localhost:8080/admin/v2/tenants/newtenant\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19921",
                "createdAt": "2023-03-24T17:06:20Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Cache empty schema version in ProducerImpl schemaCache.",
        "url": "https://github.com/apache/pulsar/pull/19929",
        "resourcePath": "/apache/pulsar/pull/19929",
        "createdAt": "2023-03-26T09:44:41Z",
        "number": 19929,
        "mergeCommit": {
          "oid": "cff3f9baa03f166697d31ff517f234ecf0fc702d",
          "message": "[fix][client] Cache empty schema version in ProducerImpl schemaCache. (#19929)\n\nCo-authored-by: wangjinlong <wangjinlong@zhihu.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/cff3f9baa03f166697d31ff517f234ecf0fc702d",
          "parents": {
            "nodes": [
              {
                "oid": "18ccd9ef22bb44d952875460fbacad45c8d8d26a",
                "message": "[fix] Upgrade Vertx to match BK's version (otherwise BK does not work) (#20070)\n\n### Motivation\r\n\r\nBK deployed with Pulsar fail on start with\r\n```\r\nERROR org.apache.bookkeeper.common.component.AbstractLifecycleComponent - Failed to start Component: http-service\r\njava.lang.NoSuchMethodError: 'io.vertx.core.Future io.vertx.core.Vertx.deployVerticle(io.vertx.core.Verticle)'\r\n\tat org.apache.bookkeeper.http.vertx.VertxHttpServer.startServer(VertxHttpServer.java:93) ~[org.apache.bookkeeper.http-vertx-http-server-4.16.0.jar:4.16.0]\r\n\tat org.apache.bookkeeper.server.service.HttpService.doStart(HttpService.java:62) ~[org.apache.bookkeeper-bookkeeper-server-4.16.0.jar:4.16.0]\r\n\tat org.apache.bookkeeper.common.component.AbstractLifecycleComponent.start(AbstractLifecycleComponent.java:83) ~[org.apache.bookkeeper-bookkeeper-common-4.16.0.jar:4.16.0]\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.lambda$start$4(LifecycleComponentStack.java:144) ~[org.apache.bookkeeper-bookkeeper-common-4.16.0.jar:4.16.0]\r\n\tat com.google.common.collect.ImmutableList.forEach(ImmutableList.java:422) ~[com.google.guava-guava-31.0.1-jre.jar:?]\r\n\tat org.apache.bookkeeper.common.component.LifecycleComponentStack.start(LifecycleComponentStack.java:144) ~[org.apache.bookkeeper-bookkeeper-common-4.16.0.jar:4.16.0]\r\n\tat org.apache.bookkeeper.common.component.ComponentStarter.startComponent(ComponentStarter.java:84) ~[org.apache.bookkeeper-bookkeeper-common-4.16.0.jar:4.16.0]\r\n\tat org.apache.bookkeeper.server.Main.doMain(Main.java:224) ~[org.apache.bookkeeper-bookkeeper-server-4.16.0.jar:4.16.0]\r\n\tat org.apache.bookkeeper.server.Main.main(Main.java:199) ~[org.apache.bookkeeper-bookkeeper-server-4.16.0.jar:4.16.0]\r\n\r\n```\r\n\r\nThe root cause is that BK upgraded to 4.16.0 and needs newer version of vertx that introduced API changes https://github.com/apache/bookkeeper/pull/3435\r\n\r\nPulsar forces older version of dependency.\r\n\r\n### Modifications\r\n\r\nUpgrade Vertx to the same version as BK"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/MockBrokerService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/MockBrokerServiceHooks.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/ProducerEmptySchemaCacheTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5M6EPE2gAoY2VjMTA0YmIzMzE0YWY1Mzc4NzA5MGM4N2MzNzg2YTI5Y2E5ZTBlNA",
                "url": "https://github.com/apache/pulsar/pull/19929/commits/cec104bb3314af53787090c87c3786a29ca9e0e4"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19928,
                "url": "https://github.com/apache/pulsar/issues/19928",
                "title": "[Bug] Retry & DLQ Producer keeps sending GET_OR_CREATE_SCHEMA when send message.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">current master.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>enable debug log of pulsar client.</li>\n<li>use below code. set <code class=\"notranslate\">maxRedeliverCount</code> just to make message fast to go to DLQ</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"package org.apache.pulsar.client;\n\nimport org.apache.pulsar.client.api.Consumer;\nimport org.apache.pulsar.client.api.DeadLetterPolicy;\nimport org.apache.pulsar.client.api.Message;\nimport org.apache.pulsar.client.api.MessageListener;\nimport org.apache.pulsar.client.api.PulsarClient;\nimport org.apache.pulsar.client.api.PulsarClientException;\n\nimport java.util.concurrent.TimeUnit;\n\npublic class H {\n    public static void main(String[] args) throws PulsarClientException, InterruptedException {\n        PulsarClient client = PulsarClient.builder()\n                .serviceUrl(&quot;pulsar://localhost:6650&quot;)\n                .build();\n\n        Consumer&lt;byte[]&gt; hello = client.newConsumer()\n                .topic(&quot;hello&quot;)\n                .subscriptionName(&quot;sub&quot;)\n                .enableRetry(true)\n                .deadLetterPolicy(DeadLetterPolicy.builder().maxRedeliverCount(1).build())\n                .messageListener(new MessageListener&lt;byte[]&gt;() {\n                    @Override\n                    public void received(Consumer&lt;byte[]&gt; consumer, Message&lt;byte[]&gt; msg) {\n                        try {\n                            consumer.reconsumeLater(msg, 1, TimeUnit.SECONDS);\n                        } catch (PulsarClientException e) {\n                            throw new RuntimeException(e);\n                        }\n                    }\n                })\n                .subscribe();\n\n        Thread.sleep(10000);\n    }\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">package org.apache.pulsar.client;\n\nimport org.apache.pulsar.client.api.Consumer;\nimport org.apache.pulsar.client.api.DeadLetterPolicy;\nimport org.apache.pulsar.client.api.Message;\nimport org.apache.pulsar.client.api.MessageListener;\nimport org.apache.pulsar.client.api.PulsarClient;\nimport org.apache.pulsar.client.api.PulsarClientException;\n\nimport java.util.concurrent.TimeUnit;\n\npublic class H {\n    public static void main(String[] args) throws PulsarClientException, InterruptedException {\n        PulsarClient client = PulsarClient.builder()\n                .serviceUrl(\"pulsar://localhost:6650\")\n                .build();\n\n        Consumer&lt;byte[]&gt; hello = client.newConsumer()\n                .topic(\"hello\")\n                .subscriptionName(\"sub\")\n                .enableRetry(true)\n                .deadLetterPolicy(DeadLetterPolicy.builder().maxRedeliverCount(1).build())\n                .messageListener(new MessageListener&lt;byte[]&gt;() {\n                    @Override\n                    public void received(Consumer&lt;byte[]&gt; consumer, Message&lt;byte[]&gt; msg) {\n                        try {\n                            consumer.reconsumeLater(msg, 1, TimeUnit.SECONDS);\n                        } catch (PulsarClientException e) {\n                            throw new RuntimeException(e);\n                        }\n                    }\n                })\n                .subscribe();\n\n        Thread.sleep(10000);\n    }\n}\n</code></pre></div>\n<p dir=\"auto\">you can see a lot <code class=\"notranslate\">GET_OR_CREATE_SCHEMA_RESPONSE</code> rpc is send before each message resend to broker.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"17:27:25.489 [main] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema request\n17:27:25.489 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd GET_OR_CREATE_SCHEMA_RESPONSE\n17:27:25.489 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema succeed\n17:27:25.490 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Re-Sending message in cnx [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650], sequenceId 995\n17:27:25.492 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd SEND_RECEIPT\n17:27:25.492 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ClientCnx - [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650] Got receipt for producer: 0 -- msg: 995 -- id: 0:3197\n17:27:25.492 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Received ack for msg 995 \n17:27:25.492 [main] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema request\n17:27:25.492 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd GET_OR_CREATE_SCHEMA_RESPONSE\n17:27:25.492 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema succeed\n17:27:25.492 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Re-Sending message in cnx [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650], sequenceId 996\n17:27:25.494 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd SEND_RECEIPT\n17:27:25.494 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ClientCnx - [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650] Got receipt for producer: 0 -- msg: 996 -- id: 0:3198\n17:27:25.494 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Received ack for msg 996 \n17:27:25.494 [main] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema request\n17:27:25.495 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd GET_OR_CREATE_SCHEMA_RESPONSE\n17:27:25.495 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema succeed\n17:27:25.495 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Re-Sending message in cnx [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650], sequenceId 997\n17:27:25.497 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd SEND_RECEIPT\n17:27:25.497 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ClientCnx - [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650] Got receipt for producer: 0 -- msg: 997 -- id: 0:3199\n17:27:25.497 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Received ack for msg 997 \n17:27:25.497 [main] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema request\n17:27:25.498 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd GET_OR_CREATE_SCHEMA_RESPONSE\n17:27:25.498 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema succeed\n17:27:25.498 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Re-Sending message in cnx [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650], sequenceId 998\n17:27:25.500 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd SEND_RECEIPT\n17:27:25.500 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ClientCnx - [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650] Got receipt for producer: 0 -- msg: 998 -- id: 0:3200\n17:27:25.500 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Received ack for msg 998 \n17:27:25.500 [main] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema request\n17:27:25.500 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd GET_OR_CREATE_SCHEMA_RESPONSE\n17:27:25.500 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema succeed\n17:27:25.500 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Re-Sending message in cnx [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650], sequenceId 999\"><pre class=\"notranslate\"><code class=\"notranslate\">17:27:25.489 [main] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema request\n17:27:25.489 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd GET_OR_CREATE_SCHEMA_RESPONSE\n17:27:25.489 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema succeed\n17:27:25.490 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Re-Sending message in cnx [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650], sequenceId 995\n17:27:25.492 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd SEND_RECEIPT\n17:27:25.492 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ClientCnx - [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650] Got receipt for producer: 0 -- msg: 995 -- id: 0:3197\n17:27:25.492 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Received ack for msg 995 \n17:27:25.492 [main] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema request\n17:27:25.492 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd GET_OR_CREATE_SCHEMA_RESPONSE\n17:27:25.492 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema succeed\n17:27:25.492 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Re-Sending message in cnx [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650], sequenceId 996\n17:27:25.494 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd SEND_RECEIPT\n17:27:25.494 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ClientCnx - [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650] Got receipt for producer: 0 -- msg: 996 -- id: 0:3198\n17:27:25.494 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Received ack for msg 996 \n17:27:25.494 [main] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema request\n17:27:25.495 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd GET_OR_CREATE_SCHEMA_RESPONSE\n17:27:25.495 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema succeed\n17:27:25.495 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Re-Sending message in cnx [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650], sequenceId 997\n17:27:25.497 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd SEND_RECEIPT\n17:27:25.497 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ClientCnx - [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650] Got receipt for producer: 0 -- msg: 997 -- id: 0:3199\n17:27:25.497 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Received ack for msg 997 \n17:27:25.497 [main] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema request\n17:27:25.498 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd GET_OR_CREATE_SCHEMA_RESPONSE\n17:27:25.498 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema succeed\n17:27:25.498 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Re-Sending message in cnx [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650], sequenceId 998\n17:27:25.500 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd SEND_RECEIPT\n17:27:25.500 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ClientCnx - [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650] Got receipt for producer: 0 -- msg: 998 -- id: 0:3200\n17:27:25.500 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Received ack for msg 998 \n17:27:25.500 [main] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema request\n17:27:25.500 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.common.protocol.PulsarDecoder - [localhost/127.0.0.1:6650] Received cmd GET_OR_CREATE_SCHEMA_RESPONSE\n17:27:25.500 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] GetOrCreateSchema succeed\n17:27:25.500 [pulsar-client-io-1-3] DEBUG org.apache.pulsar.client.impl.ProducerImpl - [hello] [standalone-0-16] Re-Sending message in cnx [id: 0x014f6bed, L:/127.0.0.1:61200 - R:localhost/127.0.0.1:6650], sequenceId 999\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">the current code double the rpc send to broker when using retry and dlq feature. this should not happen and have pressure to  the backend service.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">only send GetOrCreateSchema once.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19928",
                "createdAt": "2023-03-26T09:35:21Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Fix DeadLetterProducer creation callback blocking client io thread.",
        "url": "https://github.com/apache/pulsar/pull/19930",
        "resourcePath": "/apache/pulsar/pull/19930",
        "createdAt": "2023-03-26T10:15:33Z",
        "number": 19930,
        "mergeCommit": {
          "oid": "836f03202dacd078c77dbe9dd2bcbf35f1d1a99e",
          "message": "[fix][client] Fix DeadLetterProducer creation callback blocking client io thread. (#19930)",
          "commitUrl": "https://github.com/apache/pulsar/commit/836f03202dacd078c77dbe9dd2bcbf35f1d1a99e",
          "parents": {
            "nodes": [
              {
                "oid": "f568c8f49828be42b8a7e81abea45a80cf4f93f4",
                "message": "[improve][sql] Remove unnecessary future encapsulation (#19959)\n\nSigned-off-by: tison <wander4096@gmail.com>\r\nCo-authored-by: tison <wander4096@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5M6GDK2gAoNTRlZjVjZTRjYjQ3ZjFiYTQzMDA0OTU4MGYwZmI5YzU3MjNkOTVmZg",
                "url": "https://github.com/apache/pulsar/pull/19930/commits/54ef5ce4cb47f1ba430049580f0fb9c5723d95ff"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19784,
                "url": "https://github.com/apache/pulsar/issues/19784",
                "title": "[Bug] Deadlock on Pulsar Java client side",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">The broker version is <a href=\"https://pulsar.apache.org/release-notes/versioned/pulsar-2.10.1/\" rel=\"nofollow\">https://pulsar.apache.org/release-notes/versioned/pulsar-2.10.1/</a><br>\nAnd the client is : <a href=\"https://javadoc.io/doc/org.apache.pulsar/pulsar-client-api/2.10.3/index.html\" rel=\"nofollow\">https://javadoc.io/doc/org.apache.pulsar/pulsar-client-api/2.10.3/index.html</a></p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">We are currently facing what seems to be a deadlock issue on our testing environment.<br>\nWe are working with the Java SDK.<br>\nIn my thread dump I can see 24 threads stuck on this line :<br>\nfinal Transaction txn = this.getClient().newTransaction().withTransactionTimeout(1, TimeUnit.MINUTES).build().get();<br>\nWhere getClient returns an instance of PulsarClient.<br>\nat jdk.internal.misc.Unsafe.park(java.base@17.0.2/Native Method)</p>\n<ul dir=\"auto\">\n<li>parking to wait for &lt;0x00000000ad73c838&gt; (a java.util.concurrent.CompletableFuture$Signaller)<br>\nat java.util.concurrent.locks.LockSupport.park(java.base@17.0.2/LockSupport.java:211)<br>\nat java.util.concurrent.CompletableFuture$Signaller.block(java.base@17.0.2/CompletableFuture.java:1864)<br>\nat java.util.concurrent.ForkJoinPool.unmanagedBlock(java.base@17.0.2/ForkJoinPool.java:3463)<br>\nat java.util.concurrent.ForkJoinPool.managedBlock(java.base@17.0.2/ForkJoinPool.java:3434)<br>\nat java.util.concurrent.CompletableFuture.waitingGet(java.base@17.0.2/CompletableFuture.java:1898)<br>\nat java.util.concurrent.CompletableFuture.get(java.base@17.0.2/CompletableFuture.java:2072)<br>\nat <a href=\"http://com.taketurns.es/\" rel=\"nofollow\">com.taketurns.es</a>.pulsar.controller.EntityPulsarController.publishEvents(EntityPulsarController.java:75)<br>\nThose threads are waiting for a CompletableFuture that never complete.<br>\nI can also see that pulsar-timer-9-1 thread is blocked.<br>\njava.lang.Thread.State: BLOCKED (on object monitor)<br>\nat org.apache.pulsar.client.impl.ProducerImpl.run(ProducerImpl.java:1876)</li>\n<li>waiting to lock &lt;0x00000000ad6fd530&gt; (a org.apache.pulsar.client.impl.ProducerImpl)<br>\nat <a href=\"http://org.apache.pulsar.shade.io/\" rel=\"nofollow\">org.apache.pulsar.shade.io</a>.netty.util.HashedWheelTimer$HashedWheelTimeout.run(HashedWheelTimer.java:715)<br>\nat <a href=\"http://org.apache.pulsar.shade.io/\" rel=\"nofollow\">org.apache.pulsar.shade.io</a>.netty.util.concurrent.ImmediateExecutor.execute(ImmediateExecutor.java:34)<br>\nat <a href=\"http://org.apache.pulsar.shade.io/\" rel=\"nofollow\">org.apache.pulsar.shade.io</a>.netty.util.HashedWheelTimer$HashedWheelTimeout.expire(HashedWheelTimer.java:703)<br>\nat <a href=\"http://org.apache.pulsar.shade.io/\" rel=\"nofollow\">org.apache.pulsar.shade.io</a>.netty.util.HashedWheelTimer$HashedWheelBucket.expireTimeouts(HashedWheelTimer.java:790)<br>\nat <a href=\"http://org.apache.pulsar.shade.io/\" rel=\"nofollow\">org.apache.pulsar.shade.io</a>.netty.util.HashedWheelTimer$Worker.run(HashedWheelTimer.java:503)<br>\nat <a href=\"http://org.apache.pulsar.shade.io/\" rel=\"nofollow\">org.apache.pulsar.shade.io</a>.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)<br>\nat java.lang.Thread.run(java.base@17.0.2/Thread.java:833)<br>\nLocked ownable synchronizers:</li>\n<li>None<br>\nAnd the thread holding the lock on &lt;0x00000000ad6fd530&gt; is the following.<br>\npulsar-client-io-1-1<br>\nStack Trace is:<br>\njava.lang.Thread.State: WAITING (parking)<br>\nat jdk.internal.misc.Unsafe.park(java.base@17.0.2/Native Method)</li>\n<li>parking to wait for &lt;0x00000000ad6fd400&gt; (a java.util.concurrent.CompletableFuture$Signaller)<br>\nat java.util.concurrent.locks.LockSupport.park(java.base@17.0.2/LockSupport.java:211)<br>\nat java.util.concurrent.CompletableFuture$Signaller.block(java.base@17.0.2/CompletableFuture.java:1864)<br>\nat java.util.concurrent.ForkJoinPool.unmanagedBlock(java.base@17.0.2/ForkJoinPool.java:3463)<br>\nat java.util.concurrent.ForkJoinPool.managedBlock(java.base@17.0.2/ForkJoinPool.java:3434)<br>\nat java.util.concurrent.CompletableFuture.waitingGet(java.base@17.0.2/CompletableFuture.java:1898)<br>\nat java.util.concurrent.CompletableFuture.get(java.base@17.0.2/CompletableFuture.java:2072)<br>\nat org.apache.pulsar.client.impl.schema.AbstractStructSchema.atSchemaVersion(AbstractStructSchema.java:100)<br>\nat org.apache.pulsar.client.impl.MessageImpl.getReaderSchema(MessageImpl.java:400)<br>\nat org.apache.pulsar.client.impl.ConsumerImpl.lambda$doReconsumeLater$11(ConsumerImpl.java:657)<br>\nat org.apache.pulsar.client.impl.ConsumerImpl$$Lambda$4185/0x0000000801ee43e0.accept(Unknown Source)<br>\nat java.util.concurrent.CompletableFuture$UniAccept.tryFire(java.base@17.0.2/CompletableFuture.java:718)<br>\nat java.util.concurrent.CompletableFuture.postComplete(java.base@17.0.2/CompletableFuture.java:510)<br>\nat java.util.concurrent.CompletableFuture.complete(java.base@17.0.2/CompletableFuture.java:2147)<br>\nat org.apache.pulsar.client.impl.ProducerImpl.lambda$resendMessages$18(ProducerImpl.java:1795)</li>\n<li>locked &lt;0x00000000ad6fd530&gt; (a org.apache.pulsar.client.impl.ProducerImpl)<br>\nat org.apache.pulsar.client.impl.ProducerImpl$$Lambda$2248/0x0000000801b24440.run(Unknown Source)<br>\nat <a href=\"http://org.apache.pulsar.shade.io/\" rel=\"nofollow\">org.apache.pulsar.shade.io</a>.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:174)<br>\nat <a href=\"http://org.apache.pulsar.shade.io/\" rel=\"nofollow\">org.apache.pulsar.shade.io</a>.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:167)<br>\nat <a href=\"http://org.apache.pulsar.shade.io/\" rel=\"nofollow\">org.apache.pulsar.shade.io</a>.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470)<br>\nat <a href=\"http://org.apache.pulsar.shade.io/\" rel=\"nofollow\">org.apache.pulsar.shade.io</a>.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:403)<br>\nat <a href=\"http://org.apache.pulsar.shade.io/\" rel=\"nofollow\">org.apache.pulsar.shade.io</a>.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)<br>\nat <a href=\"http://org.apache.pulsar.shade.io/\" rel=\"nofollow\">org.apache.pulsar.shade.io</a>.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)<br>\nat <a href=\"http://org.apache.pulsar.shade.io/\" rel=\"nofollow\">org.apache.pulsar.shade.io</a>.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)<br>\nat java.lang.Thread.run(java.base@17.0.2/Thread.java:833)<br>\nLocked ownable synchronizers:<br>\nWhich is also waiting for a CompletableFuture that never completes.</li>\n</ul>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">No deadlock</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">A deadlock</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">Here is the thread dump.<br>\nPlease tell me if you would need anything else.<br>\n<a href=\"https://github.com/apache/pulsar/files/10942445/dump-2023-03-08.txt\">dump-2023-03-08.txt</a></p>\n<p dir=\"auto\">Thanks for your help,</p>\n<p dir=\"auto\">Thomas</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19784",
                "createdAt": "2023-03-10T13:24:11Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][client] Exclude log4j-slf4j-impl from compile dep in pulsar-client-all",
        "url": "https://github.com/apache/pulsar/pull/19937",
        "resourcePath": "/apache/pulsar/pull/19937",
        "createdAt": "2023-03-27T13:38:39Z",
        "number": 19937,
        "mergeCommit": {
          "oid": "d14e43ed9bd079b76301f10dc1c039cafd43e1cf",
          "message": "[improve][client] Exclude log4j-slf4j-impl from compile dep in pulsar-client-all (#19937)\n\nSigned-off-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/d14e43ed9bd079b76301f10dc1c039cafd43e1cf",
          "parents": {
            "nodes": [
              {
                "oid": "32ad90606062c1eda660037e6277253b35d4a1e6",
                "message": "[fix][admin] Delete tenant local policy only if exist (#19925)\n\nSigned-off-by: nodece <nodeces@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-all/pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5M-H4J2gAoODE2NjU1ZTE2ZTVjZDgwZDIxZDhjNzk2MmVkYTAyNGFhYzE0ZGRhMQ",
                "url": "https://github.com/apache/pulsar/pull/19937/commits/816655e16e5cd80d21d8c7962eda024aac14dda1"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19484,
                "url": "https://github.com/apache/pulsar/issues/19484",
                "title": "[Bug] pulsar-client-all 2.11.0 transitively bringing in log4j2 implementation",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<ul dir=\"auto\">\n<li><strong>OS:</strong> <code class=\"notranslate\">&lt;not applicable&gt;</code></li>\n<li><strong>Pulsar:</strong> <code class=\"notranslate\">2.11.0</code></li>\n</ul>\n<h3 dir=\"auto\">Details</h3>\n<h4 dir=\"auto\">Problem</h4>\n<p dir=\"auto\">The <code class=\"notranslate\">pulsar-client-all:2.11.0</code> dependency transitively includes Log4j2 (see <a href=\"https://mvnrepository.com/artifact/org.apache.pulsar/pulsar-client-all/2.11.0\" rel=\"nofollow\"> here</a>) rather than just the SLF4J api and logging bridge.<br>\nWhereas the <code class=\"notranslate\">pulsar-client-all:2.10.3</code> does <strong>NOT</strong> bring a logging impl in (see <a href=\"https://mvnrepository.com/artifact/org.apache.pulsar/pulsar-client-all/2.10.3\" rel=\"nofollow\">here</a>).</p>\n<h4 dir=\"auto\">Symptoms</h4>\n<p dir=\"auto\">If the consuming app is already using a logger impl then a conflict can occur at startup (when using SLF4J) telling user to pick one or the other.</p>\n<p dir=\"auto\">If the consuming application is not already using a logger impl then <code class=\"notranslate\">pulsar-client-all</code> effectively chooses LOG4J2 for the app.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Adding the dependency <code class=\"notranslate\">org.apache.pulsar:pulsar-client-all:2.11.0</code> should <strong>NOT</strong> transitively bring in the log4j2 implementation.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Adding the dependency <code class=\"notranslate\">org.apache.pulsar:pulsar-client-all:2.11.0</code> transitively <strong>DID</strong> bring in the log4j2 implementation.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19484",
                "createdAt": "2023-02-10T14:03:31Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[feat][client] Support configure MessageCrypto in ProducerBuilder",
        "url": "https://github.com/apache/pulsar/pull/19939",
        "resourcePath": "/apache/pulsar/pull/19939",
        "createdAt": "2023-03-27T14:44:23Z",
        "number": 19939,
        "mergeCommit": {
          "oid": "02147454c425b92f0cd1caefa73b9339db6a0269",
          "message": "[feat][client] Support configure MessageCrypto in ProducerBuilder (#19939)\n\nSigned-off-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/02147454c425b92f0cd1caefa73b9339db6a0269",
          "parents": {
            "nodes": [
              {
                "oid": "68c10eed7604aa3dcc3a6d8b548575e99b94dca2",
                "message": "[feat][broker][PIP-195] Add metrics for bucket delayed message tracker (#19716)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/ProducerBuilder.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerBuilderImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/ProducerBuilderImplTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5M-qpp2gAoZTczYWQzNTIyNTJiZWFiNjE3Y2VmYmY0ZmY3MGI4NGU4MjA2YjcxYw",
                "url": "https://github.com/apache/pulsar/pull/19939/commits/e73ad352252beab617cefbf4ff70b84e8206b71c"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19139,
                "url": "https://github.com/apache/pulsar/issues/19139",
                "title": "[Client] Add `MessageCrypto` setting in `ProducerBuilder`",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.10.2</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Pulsar add the <code class=\"notranslate\">MessageCrypto</code> support, add enabled it in <code class=\"notranslate\">ProducerConfigurationData</code>, but Pulsar didn't expose it in <code class=\"notranslate\">ProducerBuilder</code> as the <code class=\"notranslate\">ConsumerBuilder.messageCrypto(MessageCrypto messageCrypto)</code></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Add a new method for setting the <code class=\"notranslate\">MessageCrypto</code> in <code class=\"notranslate\">ProducerBuilder</code>.</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"/**\n * Sets a {@link MessageCrypto}.\n *\n * &lt;p&gt;Contains methods to encrypt/decrypt message for End to End Encryption.\n *\n * @param messageCrypto\n *            MessageCrypto object\n * @return the consumer builder instance\n */\nProducerBuilder&lt;T&gt; messageCrypto(MessageCrypto messageCrypto);\"><pre class=\"notranslate\"><span class=\"pl-c\">/**</span>\n<span class=\"pl-c\"> * Sets a {@link MessageCrypto}.</span>\n<span class=\"pl-c\"> *</span>\n<span class=\"pl-c\"> * &lt;p&gt;Contains methods to encrypt/decrypt message for End to End Encryption.</span>\n<span class=\"pl-c\"> *</span>\n<span class=\"pl-c\"> * @param messageCrypto</span>\n<span class=\"pl-c\"> *            MessageCrypto object</span>\n<span class=\"pl-c\"> * @return the consumer builder instance</span>\n<span class=\"pl-c\"> */</span>\n<span class=\"pl-s1\">ProducerBuilder</span>&lt;<span class=\"pl-s1\">T</span>&gt; <span class=\"pl-en\">messageCrypto</span>(<span class=\"pl-smi\">MessageCrypto</span> <span class=\"pl-s1\">messageCrypto</span>);</pre></div>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@Override\npublic ProducerBuilder&lt;T&gt; messageCrypto(MessageCrypto messageCrypto) {\n    conf.setMessageCrypto(messageCrypto);\n    return this;\n}\"><pre class=\"notranslate\"><span class=\"pl-c1\">@</span><span class=\"pl-c1\">Override</span>\n<span class=\"pl-k\">public</span> <span class=\"pl-smi\">ProducerBuilder</span>&lt;<span class=\"pl-smi\">T</span>&gt; <span class=\"pl-s1\">messageCrypto</span>(<span class=\"pl-smi\">MessageCrypto</span> <span class=\"pl-s1\">messageCrypto</span>) {\n    <span class=\"pl-s1\">conf</span>.<span class=\"pl-en\">setMessageCrypto</span>(<span class=\"pl-s1\">messageCrypto</span>);\n    <span class=\"pl-k\">return</span> <span class=\"pl-smi\">this</span>;\n}</pre></div>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Not applicable.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19139",
                "createdAt": "2023-01-05T12:53:15Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][build] Dump Jacoco coverage data to file with JMX interface in TestNG listener",
        "url": "https://github.com/apache/pulsar/pull/19947",
        "resourcePath": "/apache/pulsar/pull/19947",
        "createdAt": "2023-03-28T08:12:40Z",
        "number": 19947,
        "mergeCommit": {
          "oid": "83f6ea74e7a47927402d8f1de4200c4ad02e6147",
          "message": "[fix][build] Dump Jacoco coverage data to file with JMX interface in TestNG listener (#19947)",
          "commitUrl": "https://github.com/apache/pulsar/commit/83f6ea74e7a47927402d8f1de4200c4ad02e6147",
          "parents": {
            "nodes": [
              {
                "oid": "7a99e74220bdff7a0dff3dbbf3befb2316f3a6c8",
                "message": "[fix][doc] fix typo in ConsumerConfigurationData and ServiceConfiguration. (#19936)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "buildtools/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "buildtools/src/main/java/org/apache/pulsar/tests/JacocoDumpListener.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5NCqO52gAoYzU2NzJlMTgwNDYzZmIzZjQ1Nzc4Njk0NTMzN2FhMDY2MjZjMTFkMw",
                "url": "https://github.com/apache/pulsar/pull/19947/commits/c5672e180463fb3f457786945337aa06626c11d3"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19931,
                "url": "https://github.com/apache/pulsar/issues/19931",
                "title": "Please create a coverage file, many PRs failed because of this.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4507586495/jobs/7968960455?pr=19906\">https://github.com/apache/pulsar/actions/runs/4507586495/jobs/7968960455?pr=19906</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Codecov report uploader 0.4.0\n[2023-03-26T14:20:49.486Z] ['info'] =&gt; Project root located at: /home/runner/work/pulsar/pulsar\n[2023-03-26T14:20:49.490Z] ['info'] -&gt; No token specified or token is empty\n[2023-03-26T14:20:49.490Z] ['verbose'] Start of network processing...\n[2023-03-26T14:20:49.491Z] ['verbose'] Searching for files in /home/runner/work/pulsar/pulsar\n[2023-03-26T14:20:49.503Z] ['verbose'] coveragepy is not installed\n[2023-03-26T14:20:49.503Z] ['info'] Searching for coverage files...\n[2023-03-26T14:20:49.976Z] ['info'] Warning: Some files located via search were excluded from upload.\n[2023-03-26T14:20:49.977Z] ['info'] If Codecov did not locate your files, please review https://docs.codecov.com/docs/supported-report-formats\n**[2023-03-26T14:20:49.977Z] ['error'] There was an error running the uploader: No coverage files located, please try use `-f`, or change the project root with `-R`**\n[2023-03-26T14:20:49.978Z] ['verbose'] The error stack is: Error: No coverage files located, please try use `-f`, or change the project root with `-R`\n    at main (/snapshot/repo/dist/src/index.js)\n[2023-03-26T14:20:49.978Z] ['verbose'] End of uploader: 501 milliseconds\nError: Codecov: Failed to properly upload: The process '/home/runner/work/_actions/codecov/codecov-action/v3/dist/codecov' failed with exit code 255\"><pre class=\"notranslate\"><code class=\"notranslate\">  Codecov report uploader 0.4.0\n[2023-03-26T14:20:49.486Z] ['info'] =&gt; Project root located at: /home/runner/work/pulsar/pulsar\n[2023-03-26T14:20:49.490Z] ['info'] -&gt; No token specified or token is empty\n[2023-03-26T14:20:49.490Z] ['verbose'] Start of network processing...\n[2023-03-26T14:20:49.491Z] ['verbose'] Searching for files in /home/runner/work/pulsar/pulsar\n[2023-03-26T14:20:49.503Z] ['verbose'] coveragepy is not installed\n[2023-03-26T14:20:49.503Z] ['info'] Searching for coverage files...\n[2023-03-26T14:20:49.976Z] ['info'] Warning: Some files located via search were excluded from upload.\n[2023-03-26T14:20:49.977Z] ['info'] If Codecov did not locate your files, please review https://docs.codecov.com/docs/supported-report-formats\n**[2023-03-26T14:20:49.977Z] ['error'] There was an error running the uploader: No coverage files located, please try use `-f`, or change the project root with `-R`**\n[2023-03-26T14:20:49.978Z] ['verbose'] The error stack is: Error: No coverage files located, please try use `-f`, or change the project root with `-R`\n    at main (/snapshot/repo/dist/src/index.js)\n[2023-03-26T14:20:49.978Z] ['verbose'] End of uploader: 501 milliseconds\nError: Codecov: Failed to properly upload: The process '/home/runner/work/_actions/codecov/codecov-action/v3/dist/codecov' failed with exit code 255\n</code></pre></div>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/25130182/227785298-ac3f9add-97a1-4ed1-a92c-861ceff1696d.png\"><img src=\"https://user-images.githubusercontent.com/25130182/227785298-ac3f9add-97a1-4ed1-a92c-861ceff1696d.png\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19931",
                "createdAt": "2023-03-26T15:17:03Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][ci] Extend cache action timeout to 10 minutes",
        "url": "https://github.com/apache/pulsar/pull/19955",
        "resourcePath": "/apache/pulsar/pull/19955",
        "createdAt": "2023-03-29T02:34:55Z",
        "number": 19955,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": ".github/workflows/ci-maven-cache-update.yaml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": ".github/workflows/ci-owasp-dependency-check.yaml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": ".github/workflows/pulsar-ci-flaky.yaml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": ".github/workflows/pulsar-ci.yaml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5NHt_L2gAoNzgyY2ZlNjAwMjUwZDBmYmM4N2U2ODBhNjQzNGNhOWJmOGY4NTU1ZQ",
                "url": "https://github.com/apache/pulsar/pull/19955/commits/782cfe600250d0fbc87e680a6434ca9bf8f8555e"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19953,
                "url": "https://github.com/apache/pulsar/issues/19953",
                "title": "Flaky-test: CI - Integration - Standalone, cache not found for input keys",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/devinbost/pulsar/actions/runs/4547247024/jobs/8019335994\">https://github.com/devinbost/pulsar/actions/runs/4547247024/jobs/8019335994</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<p dir=\"auto\">Warning: Failed to restore: The operation cannot be completed in timeout.<br>\nCache not found for input keys: Linux-m2-dependencies-core-modules-9a40a8425648109ba46c545b035b6c8eaa0d988ecad26f356b8a56f2a992fdaf, Linux-m2-dependencies-core-modules-</p>\n<p dir=\"auto\">More context:</p>\n<p dir=\"auto\">##[debug]Cache Result:<br>\n##[debug]{\"scope\":\"refs/pull/15/merge\",\"cacheKey\":\"Linux-m2-dependencies-core-modules-9a40a8425648109ba46c545b035b6c8eaa0d988ecad26f356b8a56f2a992fdaf\",\"cacheVersion\":\"2e1ac70454fd0cabdfd450387b61ab767e8274b896d4ca9074b9a2feace654a0\",\"creationTime\":\"2023-03-28T22:45:47.5866667Z\",\"archiveLocation\":\"***\"}<br>\n##[debug]Archive Path: /home/runner/work/_temp/779b9bd5-1716-4dc3-8bd9-29ca90f81a62/cache.tzst<br>\n##[debug]Use Azure SDK: true<br>\n##[debug]Download concurrency: 8<br>\n##[debug]Request timeout (ms): 30000<br>\n##[debug]Cache segment download timeout mins env var: undefined<br>\n##[debug]Segment download timeout (ms): 600000<br>\n##[debug]Lookup only: false<br>\n##[debug]Downloading segment at offset 0 with length 134217728...<br>\nReceived 41943040 of 927695887 (4.5%), 40.0 MBs/sec<br>\nReceived 125829120 of 927695887 (13.6%), 60.0 MBs/sec<br>\n##[debug]Downloading segment at offset 134217728 with length 134217728...<br>\nReceived 163577856 of 927695887 (17.6%), 52.0 MBs/sec<br>\nReceived 255852544 of 927695887 (27.6%), 61.0 MBs/sec<br>\n##[debug]Downloading segment at offset 268435456 with length 134217728...<br>\nReceived 314572800 of 927695887 (33.9%), 60.0 MBs/sec<br>\nReceived 398458880 of 927695887 (43.0%), 63.3 MBs/sec<br>\n##[debug]Downloading segment at offset 402653184 with length 134217728...<br>\nReceived 452984832 of 927695887 (48.8%), 61.7 MBs/sec<br>\n##[debug]Downloading segment at offset 536870912 with length 134217728...<br>\nReceived 536870912 of 927695887 (57.9%), 63.0 MBs/sec<br>\nReceived 599785472 of 927695887 (64.7%), 62.7 MBs/sec<br>\nReceived 658505728 of 927695887 (71.0%), 62.0 MBs/sec<br>\n##[debug]Downloading segment at offset 671088640 with length 134217728...<br>\nReceived 696254464 of 927695887 (75.1%), 59.7 MBs/sec<br>\nReceived 9<a href=\"https://github.com/devinbost/pulsar/actions/runs/4547247024/jobs/8019335994#step:6:236\">235</a>01583 of 927695887 (99.5%), 14.4 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 14.2 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 13.9 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 13.7 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 13.5 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 13.3 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 13.1 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 12.9 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 12.7 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 12.5 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 12.4 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 12.2 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 12.0 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 11.9 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 11.7 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 11.6 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 11.4 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 11.3 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 11.1 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 11.0 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 10.8 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 10.7 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 10.6 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 10.5 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 10.3 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 10.2 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 10.1 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 10.0 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 9.9 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 9.8 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 9.7 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 9.5 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 9.4 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 9.3 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 9.2 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 9.2 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 9.1 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 9.0 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 8.9 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 8.8 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 8.7 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 8.6 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 8.5 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 8.4 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 8.4 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 8.3 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 8.2 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 8.1 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 8.1 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 8.0 MBs/sec<br>\nReceived 92<a href=\"https://github.com/devinbost/pulsar/actions/runs/4547247024/jobs/8019335994#step:6:351\">350</a>1583 of 927695887 (99.5%), 7.9 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 7.8 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 7.8 MBs/sec<br>\nReceived 923501583 of 927695887 (99.5%), 7.7 MBs/sec<br>\nWarning: Failed to restore: The operation cannot be completed in timeout.<br>\nCache not found for input keys: Linux-m2-dependencies-core-modules-9a40a8425648109ba46c545b035b6c8eaa0d988ecad26f356b8a56f2a992fdaf, Linux-m2-dependencies-core-modules-<br>\n##[debug]Save intra-action state CACHE_KEY = Linux-m2-dependencies-core-modules-9a40a8425648109ba46c545b035b6c8eaa0d988ecad26f<a href=\"https://github.com/devinbost/pulsar/actions/runs/4547247024/jobs/8019335994#step:6:357\">356</a>b8a56f2a992fdaf<br>\nError: The action has timed out.<br>\n##[debug]Finishing: Cache Maven dependencies</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19953",
                "createdAt": "2023-03-28T23:16:10Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][build] Create source jar for pulsar-client-all shaded jar",
        "url": "https://github.com/apache/pulsar/pull/19956",
        "resourcePath": "/apache/pulsar/pull/19956",
        "createdAt": "2023-03-29T02:57:24Z",
        "number": 19956,
        "mergeCommit": {
          "oid": "38485e09ce1b01803bd6d5ab95901f6284428685",
          "message": "[improve][build] Create source jar for pulsar-client-all shaded jar (#19956)\n\nSigned-off-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/38485e09ce1b01803bd6d5ab95901f6284428685",
          "parents": {
            "nodes": [
              {
                "oid": "ee5ac8607ebd7f90843789d4eead48de8600c1f0",
                "message": "[improve][broker] PIP-192 Improved Auto Unload Logic (#19813)\n\nMaster Issue: Master Issue: https://github.com/apache/pulsar/issues/16691, https://github.com/apache/pulsar/issues/18099\r\n\r\n### Motivation\r\n\r\nRaising a PR to implement Master Issue: https://github.com/apache/pulsar/issues/16691, https://github.com/apache/pulsar/issues/18099\r\n\r\nWe want to reduce unload frequencies from flaky traffic.\r\n\r\n### Modifications\r\nThis PR \r\n- Introduced a config `loadBalancerSheddingConditionHitCountThreshold` to further restrict shedding conditions based on the hit count.\r\n- Normalized offload traffic\r\n- Lowered the default `loadBalanceSheddingDelayInSeconds` value from 600 to 180, as 10 mins are too long. 3 mins can be long enough to catch the new load after unloads.\r\n- Changed the config `loadBalancerBundleLoadReportPercentage` to `loadBalancerMaxNumberOfBundlesInBundleLoadReport` to make the topk bundle count absolute instead of relative.\r\n- Renamed `loadBalancerNamespaceBundleSplitConditionThreshold` to `loadBalancerNamespaceBundleSplitConditionHitCountThreshold` to be consistent with `*ConditionHitCountThreshold`.\r\n- Renamed `loadBalancerMaxNumberOfBrokerTransfersPerCycle ` to `loadBalancerMaxNumberOfBrokerSheddingPerCycle`.\r\n- Added LoadDataStore cleanup logic in BSC monitor.\r\n- Added `msgThroughputEMA` in BrokerLoadData to smooth the broker throughput info.\r\n- Updated Topk bundles sorted in a ascending order (instead of descending)\r\n- Update some info logs to only show in the debug mode.\r\n- Added load data tombstone upon Own, Releasing, Splitting\r\n- Added the bundle ownership(isOwned) check upon split and unload.\r\n- Added swap unload logic"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-all/pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5NHw_L2gAoM2MxNmRmYTNiZjQyMzE0MzA5MzNiNzI4Mzg2ZGY4YTI0NTIwY2EzNA",
                "url": "https://github.com/apache/pulsar/pull/19956/commits/3c16dfa3bf4231430933b728386df8a24520ca34"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19918,
                "url": "https://github.com/apache/pulsar/issues/19918",
                "title": "[Bug] Current maven pulsar-client source jar empty",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.10.3, 2.11.0 I didn't test other versions</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">down load source jar from central maven repository.<br>\npulsar-client-2.11.0-sources.jar <a href=\"https://repo1.maven.org/maven2/org/apache/pulsar/pulsar-client/2.11.0/pulsar-client-2.11.0-sources.jar\" rel=\"nofollow\">https://repo1.maven.org/maven2/org/apache/pulsar/pulsar-client/2.11.0/pulsar-client-2.11.0-sources.jar</a> download this jar  decompress it no source code is found.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">in IDE we need source code to debug problems.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">source code.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19918",
                "createdAt": "2023-03-24T09:03:53Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker]: validation for at least one TlsUrl / nonTlsUrl is present for cluster creation/update",
        "url": "https://github.com/apache/pulsar/pull/19965",
        "resourcePath": "/apache/pulsar/pull/19965",
        "createdAt": "2023-03-29T14:52:40Z",
        "number": 19965,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyWithAuthorizationTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyWithJwtAuthorizationTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyWithoutServiceDiscoveryTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/SuperUserAuthedAdminProxyHandlerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-sql/presto-pulsar/src/test/java/org/apache/pulsar/sql/presto/TestCacheSizeAllocator.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-sql/presto-pulsar/src/test/java/org/apache/pulsar/sql/presto/TestPulsarAuth.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-sql/presto-pulsar/src/test/java/org/apache/pulsar/sql/presto/TestReadChunkedMessages.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/test/java/org/apache/pulsar/testclient/Oauth2PerformanceTransactionTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/test/java/org/apache/pulsar/testclient/PerformanceProducerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/test/java/org/apache/pulsar/testclient/PerformanceTransactionTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5NLRVi2gAoODcxOTkwZGI1ZWVhYjQ4YTFhZGJjNzE1NmQ3N2M0OTM2MzVlYzFlMg",
                "url": "https://github.com/apache/pulsar/pull/19965/commits/871990db5eeab48a1adbc7156d77c493635ec1e2"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19866,
                "url": "https://github.com/apache/pulsar/issues/19866",
                "title": "Verify at least one URL is present for cluster creation",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">With <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1522254755\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19151\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19151/hovercard\" href=\"https://github.com/apache/pulsar/pull/19151\">#19151</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1616756289\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19762\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19762/hovercard\" href=\"https://github.com/apache/pulsar/pull/19762\">#19762</a>, we verify that cluster urls are valid. It seems like we could also verify that there is at least one <code class=\"notranslate\">serviceUrl</code>/<code class=\"notranslate\">serviceUrlTls</code> and at least one <code class=\"notranslate\">brokerServiceUrl</code>/<code class=\"notranslate\">brokerServiceUrlTls</code> set.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Update the following code to add a check that some of those variables are set:</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/e829672b84c15a596574da25205d32ae7b1abf4b/pulsar-common/src/main/java/org/apache/pulsar/common/policies/data/ClusterDataImpl.java#L412-L430\">pulsar/pulsar-common/src/main/java/org/apache/pulsar/common/policies/data/ClusterDataImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 412 to 430\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/e829672b84c15a596574da25205d32ae7b1abf4b\">e829672</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L412\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"412\"></td>\n          <td id=\"LC412\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">checkPropertiesIfPresent</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">IllegalArgumentException</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L413\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"413\"></td>\n          <td id=\"LC413\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">URIPreconditions</span>.<span class=\"pl-en\">checkURIIfPresent</span>(<span class=\"pl-en\">getServiceUrl</span>(), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L414\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"414\"></td>\n          <td id=\"LC414\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">uri</span> -&gt; <span class=\"pl-smi\">Objects</span>.<span class=\"pl-en\">equals</span>(<span class=\"pl-s1\">uri</span>.<span class=\"pl-en\">getScheme</span>(), <span class=\"pl-s\">\"http\"</span>), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L415\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"415\"></td>\n          <td id=\"LC415\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s\">\"Illegal service url, example: http://pulsar.example.com:8080\"</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L416\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"416\"></td>\n          <td id=\"LC416\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">URIPreconditions</span>.<span class=\"pl-en\">checkURIIfPresent</span>(<span class=\"pl-en\">getServiceUrlTls</span>(), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L417\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"417\"></td>\n          <td id=\"LC417\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">uri</span> -&gt; <span class=\"pl-smi\">Objects</span>.<span class=\"pl-en\">equals</span>(<span class=\"pl-s1\">uri</span>.<span class=\"pl-en\">getScheme</span>(), <span class=\"pl-s\">\"https\"</span>), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L418\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"418\"></td>\n          <td id=\"LC418\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s\">\"Illegal service tls url, example: https://pulsar.example.com:8443\"</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L419\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"419\"></td>\n          <td id=\"LC419\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">URIPreconditions</span>.<span class=\"pl-en\">checkURIIfPresent</span>(<span class=\"pl-en\">getBrokerServiceUrl</span>(), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L420\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"420\"></td>\n          <td id=\"LC420\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">uri</span> -&gt; <span class=\"pl-smi\">Objects</span>.<span class=\"pl-en\">equals</span>(<span class=\"pl-s1\">uri</span>.<span class=\"pl-en\">getScheme</span>(), <span class=\"pl-s\">\"pulsar\"</span>), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L421\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"421\"></td>\n          <td id=\"LC421\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s\">\"Illegal broker service url, example: pulsar://pulsar.example.com:6650\"</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L422\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"422\"></td>\n          <td id=\"LC422\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">URIPreconditions</span>.<span class=\"pl-en\">checkURIIfPresent</span>(<span class=\"pl-en\">getBrokerServiceUrlTls</span>(), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L423\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"423\"></td>\n          <td id=\"LC423\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">uri</span> -&gt; <span class=\"pl-smi\">Objects</span>.<span class=\"pl-en\">equals</span>(<span class=\"pl-s1\">uri</span>.<span class=\"pl-en\">getScheme</span>(), <span class=\"pl-s\">\"pulsar+ssl\"</span>), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L424\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"424\"></td>\n          <td id=\"LC424\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s\">\"Illegal broker service tls url, example: pulsar+ssl://pulsar.example.com:6651\"</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L425\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"425\"></td>\n          <td id=\"LC425\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">URIPreconditions</span>.<span class=\"pl-en\">checkURIIfPresent</span>(<span class=\"pl-en\">getProxyServiceUrl</span>(), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L426\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"426\"></td>\n          <td id=\"LC426\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">uri</span> -&gt; <span class=\"pl-smi\">Objects</span>.<span class=\"pl-en\">equals</span>(<span class=\"pl-s1\">uri</span>.<span class=\"pl-en\">getScheme</span>(), <span class=\"pl-s\">\"pulsar\"</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L427\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"427\"></td>\n          <td id=\"LC427\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     || <span class=\"pl-smi\">Objects</span>.<span class=\"pl-en\">equals</span>(<span class=\"pl-s1\">uri</span>.<span class=\"pl-en\">getScheme</span>(), <span class=\"pl-s\">\"pulsar+ssl\"</span>), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L428\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"428\"></td>\n          <td id=\"LC428\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s\">\"Illegal proxy service url, example: pulsar+ssl://ats-proxy.example.com:4443 \"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L429\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"429\"></td>\n          <td id=\"LC429\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     + <span class=\"pl-s\">\"or pulsar://ats-proxy.example.com:4080\"</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L430\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"430\"></td>\n          <td id=\"LC430\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19866",
                "createdAt": "2023-03-20T18:21:20Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "good first issue"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][build] Client modules should be built with Java 8",
        "url": "https://github.com/apache/pulsar/pull/19991",
        "resourcePath": "/apache/pulsar/pull/19991",
        "createdAt": "2023-04-01T06:48:43Z",
        "number": 19991,
        "mergeCommit": {
          "oid": "5ef3a21a068b837a56a432361aa4b33732a13cfb",
          "message": "[fix][build] Client modules should be built with Java 8 (#19991)",
          "commitUrl": "https://github.com/apache/pulsar/commit/5ef3a21a068b837a56a432361aa4b33732a13cfb",
          "parents": {
            "nodes": [
              {
                "oid": "67eb0fb4e830f2fb7affc9b3ab77b5423b4ec4ce",
                "message": "[cleanup][proxy] ProxyConnection should not call super.exceptionCaught (#19990)\n\n### Motivation\r\n\r\nWhile debugging an issue, I noticed that we call `super.exceptionCaught(ctx, cause);` in the `ProxyConnection` class. This leads to the following log line:\r\n\r\n> An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception. io.netty.channel.unix.Errors$NativeIoException: recvAddress(..) failed: Connection reset by peer\r\n\r\nBecause we always handle exceptions, there is no need to forward them to the next handler.\r\n\r\n### Modifications\r\n\r\n* Remove a single method call\r\n\r\n### Verifying this change\r\n\r\nThis is a trivial change. Note that we do not call the super method in any other handler implementations in the project.\r\n\r\n### Documentation\r\n\r\n- [x] `doc-not-needed` <!-- Your PR changes do not impact docs -->\r\n\r\n### Matching PR in forked repository\r\n\r\nPR in forked repository: skipping PR for this trivial change"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-auth-athenz/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-auth-sasl/pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5NZv7R2gAoMjlmOTlhODEwMTU0OWNmOTA1ZGFjN2ViNWJkMmNlZmNiOWE2YjdmYw",
                "url": "https://github.com/apache/pulsar/pull/19991/commits/29f99a8101549cf905dac7eb5bd2cefcb9a6b7fc"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19982,
                "url": "https://github.com/apache/pulsar/issues/19982",
                "title": "[Bug] Pulsar2-11.0 pulsar-client AuthenticationSasl.class can not be used in java8",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">pulsar version : 2.11.0<br>\njava version : 1.8</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">My purpose is to use flink to consume the topic data set in pulsar, because our cluster uses kerberos for authentication, so when I use \uff1a<br>\n<code class=\"notranslate\">configuration.set(PulsarOptions.PULSAR_AUTH_PLUGIN_CLASS_NAME, org.apache.pulsar.client.impl.auth.AuthenticationSasl .class.getName());, </code></p>\n<p dir=\"auto\">a compilation error occurs:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Cannot access org.apache.pulsar.client.impl.auth.AuthenticationSasl - Stack Overflow\n   Bad class file: /C:/Users/admin/.m2/repository/org/apache/pulsar/pulsar-client-auth-sasl/2.11.0/pulsar-client-auth-sasl-2.11.0.jar! /org/apache/pulsar/client/impl/auth/AuthenticationSasl.class\n     Class file has wrong version 61.0, should be 52.0\n     Please delete the file or make sure the file is in the correct classpath subdirectory.\"><pre class=\"notranslate\"><code class=\"notranslate\">Cannot access org.apache.pulsar.client.impl.auth.AuthenticationSasl - Stack Overflow\n   Bad class file: /C:/Users/admin/.m2/repository/org/apache/pulsar/pulsar-client-auth-sasl/2.11.0/pulsar-client-auth-sasl-2.11.0.jar! /org/apache/pulsar/client/impl/auth/AuthenticationSasl.class\n     Class file has wrong version 61.0, should be 52.0\n     Please delete the file or make sure the file is in the correct classpath subdirectory.\n</code></pre></div>\n<p dir=\"auto\">But when I use the 2.10.0 version of pulsar, it will be compiled normally, so I think that the compilation of pulsar2.11 version is carried out using java17, and it is not available in pulsar-client as the official website said compile with java8</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I think in version 2.11 of pulsar I can still use java8 to compile</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Cannot access org.apache.pulsar.client.impl.auth.AuthenticationSasl - Stack Overflow<br>\nBad class file: /C:/Users/admin/.m2/repository/org/apache/pulsar/pulsar-client-auth-sasl/2.11.0/pulsar-client-auth-sasl-2.11.0.jar! /org/apache/pulsar/client/impl/auth/AuthenticationSasl.class<br>\nClass file has wrong version 61.0, should be 52.0<br>\nPlease delete the file or make sure the file is in the correct classpath subdirectory.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19982",
                "createdAt": "2023-03-31T09:25:45Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Support multiple input topics for Go runtime",
        "url": "https://github.com/apache/pulsar/pull/20000",
        "resourcePath": "/apache/pulsar/pull/20000",
        "createdAt": "2023-04-03T08:43:30Z",
        "number": 20000,
        "mergeCommit": {
          "oid": "f04252b84a8b594ea371645e367c491aa8e2dd80",
          "message": "[fix][fn] Support multiple input topics for Go runtime (#20000)",
          "commitUrl": "https://github.com/apache/pulsar/commit/f04252b84a8b594ea371645e367c491aa8e2dd80",
          "parents": {
            "nodes": [
              {
                "oid": "c32caba54a5ab2c01c092ab952343f4ac405da35",
                "message": "[fix][broker] Fix default bundle size used while setting bookie affinity (#20250)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/instance.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/instanceConf.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/go/GoInstanceConfig.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/resources/findbugsExclude.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/RuntimeUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarFunctionsTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarFunctionsTestBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/go/PulsarFunctionsGoTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/java/PulsarFunctionsJavaTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/python/PulsarFunctionsPythonTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Nd05i2gAoNTcwNjk5MTE5NjIyODY5ZWMyYTlmNTU1MmJkYmIwYWMwZjI4N2QyOA",
                "url": "https://github.com/apache/pulsar/pull/20000/commits/570699119622869ec2a9f5552bdbb0ac0f287d28"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19981,
                "url": "https://github.com/apache/pulsar/issues/19981",
                "title": "[Bug] Go Pulsar functions recieves message from only one topic even when provided multiple input  topics",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">OS: Ubuntu 20.04(LTS)<br>\nPulsar: 2.10.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Create a pulsar function in golang:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"package main\n\nimport (\n\t&quot;context&quot;\n\t&quot;fmt&quot;\n\n\t&quot;github.com/apache/pulsar/pulsar-function-go/pf&quot;\n)\n\nfunc HandleResponse(ctx context.Context, in []byte) error {\n\tfmt.Printf(&quot;Processed: %s&quot;, string(in))\n\treturn nil\n}\n\nfunc main() {\n\tpf.Start(HandleResponse)\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">package main\n\nimport (\n\t\"context\"\n\t\"fmt\"\n\n\t\"github.com/apache/pulsar/pulsar-function-go/pf\"\n)\n\nfunc HandleResponse(ctx context.Context, in []byte) error {\n\tfmt.Printf(\"Processed: %s\", string(in))\n\treturn nil\n}\n\nfunc main() {\n\tpf.Start(HandleResponse)\n}\n</code></pre></div>\n<p dir=\"auto\">Build and pass the file to pulsar-admin:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"./pulsar-admin functions localrun \\\n     --go /pulsar/bin/pulsarFuncGolang \\\n     --inputs persistent://public/default/sourcetopic1,persistent://public/default/sourcetopic2 \\\n     --tenant public \\\n     --namespace default \\\n     --name flogoPulsarFunction\"><pre class=\"notranslate\"><code class=\"notranslate\">./pulsar-admin functions localrun \\\n     --go /pulsar/bin/pulsarFuncGolang \\\n     --inputs persistent://public/default/sourcetopic1,persistent://public/default/sourcetopic2 \\\n     --tenant public \\\n     --namespace default \\\n     --name flogoPulsarFunction\n</code></pre></div>\n<p dir=\"auto\">Publish message on both the topics, we could only see the function logs of recieved messages on the last topic mentioned (which is sourcetopic2 in the example above)</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Pulsar function should listen to all the topics mentioned</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Pulsar function listens to only the last topic mentioned</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19981",
                "createdAt": "2023-03-31T07:48:49Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test]Fix flaky test produceCommitTest",
        "url": "https://github.com/apache/pulsar/pull/20006",
        "resourcePath": "/apache/pulsar/pull/20006",
        "createdAt": "2023-04-04T06:10:03Z",
        "number": 20006,
        "mergeCommit": {
          "oid": "653271e8d8aeb361ec260780ba88ccf3a880f403",
          "message": "[fix][test]Fix flaky test produceCommitTest (#20006)\n\nFixes https://github.com/apache/pulsar/issues/18466\r\n### Motivation\r\nThere are two main goals in solving this issue:\r\n\r\n1. Fix the unstable tests in `produceCommitTest`.\r\n2. Prevent transaction timeouts created by other tests from affecting the `testTxnTimeoutAtTransactionMetadataStore` test during its execution.\r\n\r\n\r\n### Modification\r\n1. Change the message-sending method to synchronous. (fix `produceCommitTest`)\r\n2. Increase the transaction timeout to 10 minutes (fix `testTxnTimeoutAtTransactionMetadataStore`).",
          "commitUrl": "https://github.com/apache/pulsar/commit/653271e8d8aeb361ec260780ba88ccf3a880f403",
          "parents": {
            "nodes": [
              {
                "oid": "4d8156fca0582a350d30557d9243c851c4a45830",
                "message": "[improve][ci]Add branch-3.0 to owasp checks (#20081)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/TransactionEndToEndTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5NjVho2gAoYjgxMjFhODNkMzE5YWMyODg5NGE5NTE3ZTI0ZDY2YjdhNjM0NDYzMQ",
                "url": "https://github.com/apache/pulsar/pull/20006/commits/b8121a83d319ac28894a9517e24d66b7a6344631"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 18466,
                "url": "https://github.com/apache/pulsar/issues/18466",
                "title": "Flaky-test: TransactionEndToEndTest.produceCommitTest",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137\">https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error:  Tests run: 52, Failures: 22, Errors: 0, Skipped: 27, Time elapsed: 617.386 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.client.impl.TransactionEndToEndTest\n[1386](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1387)\n  Error:  produceCommitTest(org.apache.pulsar.client.impl.TransactionEndToEndTest)  Time elapsed: 300.015 s  &lt;&lt;&lt; FAILURE!\n[1387](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1388)\n  org.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.client.impl.TransactionEndToEndTest.produceCommitTest() didn't finish within the time-out 300000\n[1388](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1389)\n  \tat org.testng.internal.MethodInvocationHelper.invokeWithTimeoutWithNewExecutor(MethodInvocationHelper.java:371)\n[1389](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1390)\n  \tat org.testng.internal.MethodInvocationHelper.invokeWithTimeout(MethodInvocationHelper.java:282)\n[1390](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1391)\n  \tat org.testng.internal.TestInvoker.invokeMethod(TestInvoker.java:605)\n[1391](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1392)\n  \tat org.testng.internal.TestInvoker.retryFailed(TestInvoker.java:214)\n[1392](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1393)\n  \tat org.testng.internal.MethodRunner.runInSequence(MethodRunner.java:58)\n[1393](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1394)\n  \tat org.testng.internal.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:822)\n[1394](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1395)\n  \tat org.testng.internal.TestInvoker.invokeTestMethods(TestInvoker.java:147)\n[1395](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1396)\n  \tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:146)\n[1396](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1397)\n  \tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:128)\n[1397](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1398)\n  \tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n[1398](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1399)\n  \tat org.testng.TestRunner.privateRun(TestRunner.java:764)\n[1399](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1400)\n  \tat org.testng.TestRunner.run(TestRunner.java:585)\n[1400](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1401)\n  \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:384)\n[1401](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1402)\n  \tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:378)\n[1402](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1403)\n  \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:337)\n[1403](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1404)\n  \tat org.testng.SuiteRunner.run(SuiteRunner.java:286)\n[1404](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1405)\n  \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:53)\n[1405](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1406)\n  \tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:96)\n[1406](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1407)\n  \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1218)\n[1407](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1408)\n  \tat org.testng.TestNG.runSuitesLocally(TestNG.java:1140)\n[1408](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1409)\n  \tat org.testng.TestNG.runSuites(TestNG.java:1069)\n[1409](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1410)\n  \tat org.testng.TestNG.run(TestNG.java:1037)\n[1410](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1411)\n  \tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:135)\n[1411](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1412)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:112)\n[1412](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1413)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:123)\n[1413](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1414)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:90)\n[1414](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1415)\n  \tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:146)\n[1415](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1416)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)\n[1416](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1417)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)\n[1417](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1418)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)\n[1418](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1419)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)\"><pre class=\"notranslate\"><code class=\"notranslate\">Error:  Tests run: 52, Failures: 22, Errors: 0, Skipped: 27, Time elapsed: 617.386 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.client.impl.TransactionEndToEndTest\n[1386](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1387)\n  Error:  produceCommitTest(org.apache.pulsar.client.impl.TransactionEndToEndTest)  Time elapsed: 300.015 s  &lt;&lt;&lt; FAILURE!\n[1387](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1388)\n  org.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.client.impl.TransactionEndToEndTest.produceCommitTest() didn't finish within the time-out 300000\n[1388](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1389)\n  \tat org.testng.internal.MethodInvocationHelper.invokeWithTimeoutWithNewExecutor(MethodInvocationHelper.java:371)\n[1389](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1390)\n  \tat org.testng.internal.MethodInvocationHelper.invokeWithTimeout(MethodInvocationHelper.java:282)\n[1390](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1391)\n  \tat org.testng.internal.TestInvoker.invokeMethod(TestInvoker.java:605)\n[1391](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1392)\n  \tat org.testng.internal.TestInvoker.retryFailed(TestInvoker.java:214)\n[1392](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1393)\n  \tat org.testng.internal.MethodRunner.runInSequence(MethodRunner.java:58)\n[1393](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1394)\n  \tat org.testng.internal.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:822)\n[1394](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1395)\n  \tat org.testng.internal.TestInvoker.invokeTestMethods(TestInvoker.java:147)\n[1395](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1396)\n  \tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:146)\n[1396](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1397)\n  \tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:128)\n[1397](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1398)\n  \tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n[1398](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1399)\n  \tat org.testng.TestRunner.privateRun(TestRunner.java:764)\n[1399](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1400)\n  \tat org.testng.TestRunner.run(TestRunner.java:585)\n[1400](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1401)\n  \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:384)\n[1401](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1402)\n  \tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:378)\n[1402](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1403)\n  \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:337)\n[1403](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1404)\n  \tat org.testng.SuiteRunner.run(SuiteRunner.java:286)\n[1404](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1405)\n  \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:53)\n[1405](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1406)\n  \tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:96)\n[1406](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1407)\n  \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1218)\n[1407](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1408)\n  \tat org.testng.TestNG.runSuitesLocally(TestNG.java:1140)\n[1408](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1409)\n  \tat org.testng.TestNG.runSuites(TestNG.java:1069)\n[1409](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1410)\n  \tat org.testng.TestNG.run(TestNG.java:1037)\n[1410](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1411)\n  \tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:135)\n[1411](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1412)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:112)\n[1412](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1413)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:123)\n[1413](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1414)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:90)\n[1414](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1415)\n  \tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:146)\n[1415](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1416)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)\n[1416](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1417)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)\n[1417](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1418)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)\n[1418](https://github.com/apache/pulsar/actions/runs/3461842392/jobs/5780214137#step:10:1419)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/18466",
                "createdAt": "2022-11-15T02:23:14Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "help wanted"
                      }
                    },
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[Fix][Doc] Update docs for Partition increase command",
        "url": "https://github.com/apache/pulsar/pull/20012",
        "resourcePath": "/apache/pulsar/pull/20012",
        "createdAt": "2023-04-04T23:44:33Z",
        "number": 20012,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/PersistentTopics.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin-api/src/main/java/org/apache/pulsar/client/admin/Topics.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdPersistentTopics.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdTopics.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5NoRvq2gAoNDlkY2NiNTIxZjQwMGZmNWUzNWQyMThhNGRmYTE0OWNlNTE5ZTYyZA",
                "url": "https://github.com/apache/pulsar/pull/20012/commits/49dccb521f400ff5e35d218a4dfa149ce519e62d"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 17878,
                "url": "https://github.com/apache/pulsar/issues/17878",
                "title": "[Doc] Fix Admin Interface docs for Managing partitioned topics",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">What issue do you find in Pulsar docs?</h3>\n<p dir=\"auto\">The pulsar docs for updating partitioned topics states that it works only for non-global topics. This seems to be incorrect as per the below pull request:<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"501811447\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/5306\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/5306/hovercard\" href=\"https://github.com/apache/pulsar/pull/5306\">#5306</a></p>\n<h3 dir=\"auto\">What is your suggestion?</h3>\n<p dir=\"auto\">Please can we remove this statement from the explanation provided for the Update Partitioned topic piece:<br>\n\"if the topic is non-global\"</p>\n<h3 dir=\"auto\">Any reference?</h3>\n<p dir=\"auto\"><a href=\"https://pulsar.apache.org/docs/next/admin-api-topics/#update\" rel=\"nofollow\">https://pulsar.apache.org/docs/next/admin-api-topics/#update</a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/17878",
                "createdAt": "2022-09-28T21:00:13Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "doc-required"
                      }
                    },
                    {
                      "node": {
                        "name": "good first issue"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Recover batch deleted Index when cursor recover from metadataStore.",
        "url": "https://github.com/apache/pulsar/pull/20018",
        "resourcePath": "/apache/pulsar/pull/20018",
        "createdAt": "2023-04-05T12:29:40Z",
        "number": 20018,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedCursorTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5NrBEA2gAoYmZmNDQyNmI2NjBmNjNjNTgzN2NmYzcxYWFhMjRkYzY4ODk2NWMwYg",
                "url": "https://github.com/apache/pulsar/pull/20018/commits/bff4426b660f63c5837cfc71aaa24dc688965c0b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20585,
                "url": "https://github.com/apache/pulsar/issues/20585",
                "title": "[Bug] Batch deleted Index lost when cursor recover from metadataStore",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master code.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">see code<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/bbf52736f7542423b9699387eb9521c35e187816/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java#L597-L606\">pulsar/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 597 to 606\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/bbf52736f7542423b9699387eb9521c35e187816\">bbf5273</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L597\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"597\"></td>\n          <td id=\"LC597\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-smi\">PositionImpl</span> <span class=\"pl-s1\">position</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">PositionImpl</span>(<span class=\"pl-s1\">positionInfo</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L598\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"598\"></td>\n          <td id=\"LC598\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">positionInfo</span>.<span class=\"pl-en\">getIndividualDeletedMessagesCount</span>() &gt; <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L599\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"599\"></td>\n          <td id=\"LC599\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-en\">recoverIndividualDeletedMessages</span>(<span class=\"pl-s1\">positionInfo</span>.<span class=\"pl-en\">getIndividualDeletedMessagesList</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L600\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"600\"></td>\n          <td id=\"LC600\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L601\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"601\"></td>\n          <td id=\"LC601\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">config</span>.<span class=\"pl-en\">isDeletionAtBatchIndexLevelEnabled</span>() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L602\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"602\"></td>\n          <td id=\"LC602\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     &amp;&amp; <span class=\"pl-s1\">positionInfo</span>.<span class=\"pl-en\">getBatchedEntryDeletionIndexInfoCount</span>() &gt; <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L603\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"603\"></td>\n          <td id=\"LC603\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-en\">recoverBatchDeletedIndexes</span>(<span class=\"pl-s1\">positionInfo</span>.<span class=\"pl-en\">getBatchedEntryDeletionIndexInfoList</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L604\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"604\"></td>\n          <td id=\"LC604\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L605\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"605\"></td>\n          <td id=\"LC605\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">recoveredCursor</span>(<span class=\"pl-s1\">position</span>, <span class=\"pl-s1\">recoveredProperties</span>, <span class=\"pl-s1\">cursorProperties</span>, <span class=\"pl-s1\">lh</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L606\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"606\"></td>\n          <td id=\"LC606\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">callback</span>.<span class=\"pl-en\">operationComplete</span>(); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">the logic should the same as </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/bbf52736f7542423b9699387eb9521c35e187816/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java#L465-L510\">pulsar/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 465 to 510\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/bbf52736f7542423b9699387eb9521c35e187816\">bbf5273</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L465\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"465\"></td>\n          <td id=\"LC465\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">recover</span>(<span class=\"pl-k\">final</span> <span class=\"pl-smi\">VoidCallback</span> <span class=\"pl-s1\">callback</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L466\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"466\"></td>\n          <td id=\"LC466\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-c\">// Read the meta-data ledgerId from the store</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L467\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"467\"></td>\n          <td id=\"LC467\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"[{}] Recovering from bookkeeper ledger cursor: {}\"</span>, <span class=\"pl-s1\">ledger</span>.<span class=\"pl-en\">getName</span>(), <span class=\"pl-s1\">name</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L468\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"468\"></td>\n          <td id=\"LC468\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">ledger</span>.<span class=\"pl-en\">getStore</span>().<span class=\"pl-en\">asyncGetCursorInfo</span>(<span class=\"pl-s1\">ledger</span>.<span class=\"pl-en\">getName</span>(), <span class=\"pl-s1\">name</span>, <span class=\"pl-k\">new</span> <span class=\"pl-smi\">MetaStoreCallback</span>&lt;<span class=\"pl-smi\">ManagedCursorInfo</span>&gt;() { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L469\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"469\"></td>\n          <td id=\"LC469\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Override</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L470\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"470\"></td>\n          <td id=\"LC470\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">operationComplete</span>(<span class=\"pl-smi\">ManagedCursorInfo</span> <span class=\"pl-s1\">info</span>, <span class=\"pl-smi\">Stat</span> <span class=\"pl-s1\">stat</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L471\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"471\"></td>\n          <td id=\"LC471\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L472\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"472\"></td>\n          <td id=\"LC472\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-en\">updateCursorLedgerStat</span>(<span class=\"pl-s1\">info</span>, <span class=\"pl-s1\">stat</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L473\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"473\"></td>\n          <td id=\"LC473\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">lastActive</span> = <span class=\"pl-s1\">info</span>.<span class=\"pl-en\">getLastActive</span>() != <span class=\"pl-c1\">0</span> ? <span class=\"pl-s1\">info</span>.<span class=\"pl-en\">getLastActive</span>() : <span class=\"pl-s1\">lastActive</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L474\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"474\"></td>\n          <td id=\"LC474\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L475\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"475\"></td>\n          <td id=\"LC475\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">log</span>.<span class=\"pl-en\">isDebugEnabled</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L476\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"476\"></td>\n          <td id=\"LC476\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">debug</span>(<span class=\"pl-s\">\"[{}] [{}] Recover cursor last active to [{}]\"</span>, <span class=\"pl-s1\">ledger</span>.<span class=\"pl-en\">getName</span>(), <span class=\"pl-s1\">name</span>, <span class=\"pl-s1\">lastActive</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L477\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"477\"></td>\n          <td id=\"LC477\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L478\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"478\"></td>\n          <td id=\"LC478\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L479\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"479\"></td>\n          <td id=\"LC479\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">String</span>&gt; <span class=\"pl-s1\">recoveredCursorProperties</span> = <span class=\"pl-smi\">Collections</span>.<span class=\"pl-en\">emptyMap</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L480\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"480\"></td>\n          <td id=\"LC480\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">info</span>.<span class=\"pl-en\">getCursorPropertiesCount</span>() &gt; <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L481\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"481\"></td>\n          <td id=\"LC481\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-c\">// Recover properties map</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L482\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"482\"></td>\n          <td id=\"LC482\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">recoveredCursorProperties</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">HashMap</span>&lt;&gt;(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L483\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"483\"></td>\n          <td id=\"LC483\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">int</span> <span class=\"pl-s1\">i</span> = <span class=\"pl-c1\">0</span>; <span class=\"pl-s1\">i</span> &lt; <span class=\"pl-s1\">info</span>.<span class=\"pl-en\">getCursorPropertiesCount</span>(); <span class=\"pl-s1\">i</span>++) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L484\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"484\"></td>\n          <td id=\"LC484\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-smi\">StringProperty</span> <span class=\"pl-s1\">property</span> = <span class=\"pl-s1\">info</span>.<span class=\"pl-en\">getCursorProperties</span>(<span class=\"pl-s1\">i</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L485\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"485\"></td>\n          <td id=\"LC485\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-s1\">recoveredCursorProperties</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s1\">property</span>.<span class=\"pl-en\">getName</span>(), <span class=\"pl-s1\">property</span>.<span class=\"pl-en\">getValue</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L486\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"486\"></td>\n          <td id=\"LC486\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L487\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"487\"></td>\n          <td id=\"LC487\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L488\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"488\"></td>\n          <td id=\"LC488\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">cursorProperties</span> = <span class=\"pl-s1\">recoveredCursorProperties</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L489\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"489\"></td>\n          <td id=\"LC489\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L490\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"490\"></td>\n          <td id=\"LC490\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">info</span>.<span class=\"pl-en\">getCursorsLedgerId</span>() == -<span class=\"pl-c1\">1L</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L491\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"491\"></td>\n          <td id=\"LC491\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-c\">// There is no cursor ledger to read the last position from. It means the cursor has been properly</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L492\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"492\"></td>\n          <td id=\"LC492\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-c\">// closed and the last mark-delete position is stored in the ManagedCursorInfo itself.</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L493\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"493\"></td>\n          <td id=\"LC493\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-smi\">PositionImpl</span> <span class=\"pl-s1\">recoveredPosition</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">PositionImpl</span>(<span class=\"pl-s1\">info</span>.<span class=\"pl-en\">getMarkDeleteLedgerId</span>(), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L494\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"494\"></td>\n          <td id=\"LC494\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">info</span>.<span class=\"pl-en\">getMarkDeleteEntryId</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L495\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"495\"></td>\n          <td id=\"LC495\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">info</span>.<span class=\"pl-en\">getIndividualDeletedMessagesCount</span>() &gt; <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L496\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"496\"></td>\n          <td id=\"LC496\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-en\">recoverIndividualDeletedMessages</span>(<span class=\"pl-s1\">info</span>.<span class=\"pl-en\">getIndividualDeletedMessagesList</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L497\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"497\"></td>\n          <td id=\"LC497\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L498\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"498\"></td>\n          <td id=\"LC498\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L499\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"499\"></td>\n          <td id=\"LC499\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Long</span>&gt; <span class=\"pl-s1\">recoveredProperties</span> = <span class=\"pl-smi\">Collections</span>.<span class=\"pl-en\">emptyMap</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L500\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"500\"></td>\n          <td id=\"LC500\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">info</span>.<span class=\"pl-en\">getPropertiesCount</span>() &gt; <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L501\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"501\"></td>\n          <td id=\"LC501\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-c\">// Recover properties map</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L502\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"502\"></td>\n          <td id=\"LC502\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-s1\">recoveredProperties</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">HashMap</span>&lt;&gt;(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L503\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"503\"></td>\n          <td id=\"LC503\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">int</span> <span class=\"pl-s1\">i</span> = <span class=\"pl-c1\">0</span>; <span class=\"pl-s1\">i</span> &lt; <span class=\"pl-s1\">info</span>.<span class=\"pl-en\">getPropertiesCount</span>(); <span class=\"pl-s1\">i</span>++) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L504\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"504\"></td>\n          <td id=\"LC504\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-smi\">LongProperty</span> <span class=\"pl-s1\">property</span> = <span class=\"pl-s1\">info</span>.<span class=\"pl-en\">getProperties</span>(<span class=\"pl-s1\">i</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L505\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"505\"></td>\n          <td id=\"LC505\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">recoveredProperties</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s1\">property</span>.<span class=\"pl-en\">getName</span>(), <span class=\"pl-s1\">property</span>.<span class=\"pl-en\">getValue</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L506\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"506\"></td>\n          <td id=\"LC506\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L507\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"507\"></td>\n          <td id=\"LC507\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L508\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"508\"></td>\n          <td id=\"LC508\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L509\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"509\"></td>\n          <td id=\"LC509\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-en\">recoveredCursor</span>(<span class=\"pl-s1\">recoveredPosition</span>, <span class=\"pl-s1\">recoveredProperties</span>, <span class=\"pl-s1\">recoveredCursorProperties</span>, <span class=\"pl-c1\">null</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L510\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"510\"></td>\n          <td id=\"LC510\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">callback</span>.<span class=\"pl-en\">operationComplete</span>(); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<ul dir=\"auto\">\n<li></li>\n</ul>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20585",
                "createdAt": "2023-06-15T14:18:28Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] check user metric len before iterating",
        "url": "https://github.com/apache/pulsar/pull/20021",
        "resourcePath": "/apache/pulsar/pull/20021",
        "createdAt": "2023-04-05T18:49:43Z",
        "number": 20021,
        "mergeCommit": {
          "oid": "52e8144587548a692e550a8538f4d2667b5499d6",
          "message": "[fix][fn] check user metric len before iterating (#20021)\n\nCo-authored-by: Andy Walker <andy@andy.dev>",
          "commitUrl": "https://github.com/apache/pulsar/commit/52e8144587548a692e550a8538f4d2667b5499d6",
          "parents": {
            "nodes": [
              {
                "oid": "547d792439e7b8bfefb0236b078ed145731da658",
                "message": "[fix] [broker] error TimeUnit to record publish latency (#20074)\n\nCo-authored-by: fanjianye <fanjianye@bigo.sg>\r\nCo-authored-by: tison <wander4096@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/instance.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/instanceControlServicer_test.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/stats_test.go"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Ns_Kr2gAoYmU2NzI5MzI1MDI4NjNhNDFmMjE0NjI0MjViOTlkOWI5OGIwNDVkZA",
                "url": "https://github.com/apache/pulsar/pull/20021/commits/be672932502863a41f21462425b99d9b98b045dd"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20020,
                "url": "https://github.com/apache/pulsar/issues/20020",
                "title": "[Bug] [pulsar-function-go] - bounds check issue on user metrics causing go function crash for `stats` command",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">issuing a <code class=\"notranslate\">pulsar-admin functions stats</code> check on a go function will cause it to crash if no user metrics are defined. This is because it makes a similar assumption to the other metrics calls that the result of <code class=\"notranslate\">gi.getFilteredMetricFamilies</code> will have a <code class=\"notranslate\">len</code> of at least 1. If there are no user metrics, it will not, and it will cause the agent to restart.</p>\n<p dir=\"auto\">PR incoming</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>create go function w/o user metrics</li>\n<li><code class=\"notranslate\">pulsar-admin functions stats --fqfn tenant/namespace/functionname</code></li>\n<li>function will crash/restart</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Actual stats</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">stats of zero. function restart</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<p dir=\"auto\">Considering as this is basically my fault, yes I am willing to submit a PR.</p>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20020",
                "createdAt": "2023-04-05T16:22:38Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [broker] Remove the repl cursor if the creation fails and the replication is turned off",
        "url": "https://github.com/apache/pulsar/pull/20025",
        "resourcePath": "/apache/pulsar/pull/20025",
        "createdAt": "2023-04-06T04:56:54Z",
        "number": 20025,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PersistentTopicTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Nuxzm2gAoMzk1ZjQwYzA1NzI4MjliZmM3MDBiNWU1N2UyOTk1MWFkYzA4Y2NmNQ",
                "url": "https://github.com/apache/pulsar/pull/20025/commits/395f40c0572829bfc700b5e57e29951adc08ccf5"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20010,
                "url": "https://github.com/apache/pulsar/issues/20010",
                "title": "Flaky-test: PersistentTopicTest.testCreateTopicWithZombieReplicatorCursor",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4604351215/jobs/8140558256?pr=20005#step:11:1177\">https://github.com/apache/pulsar/actions/runs/4604351215/jobs/8140558256?pr=20005#step:11:1177</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 82, Failures: 1, Errors: 0, Skipped: 77, Time elapsed: 48.113 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.persistent.PersistentTopicTest\n  Error:  testCreateTopicWithZombieReplicatorCursor(org.apache.pulsar.broker.service.persistent.PersistentTopicTest)  Time elapsed: 0.367 s  &lt;&lt;&lt; FAILURE!\n  java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: remote\n  \tat java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:396)\n  \tat java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2096)\n  \tat org.apache.pulsar.broker.service.persistent.PersistentTopicTest.testCreateTopicWithZombieReplicatorCursor(PersistentTopicTest.java:587)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: java.lang.RuntimeException: org.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: remote\n  \tat org.apache.pulsar.broker.service.BrokerService.lambda$getReplicationClient$47(BrokerService.java:1347)\n  \tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.put(ConcurrentOpenHashMap.java:409)\n  \tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.computeIfAbsent(ConcurrentOpenHashMap.java:243)\n  \tat org.apache.pulsar.broker.service.BrokerService.getReplicationClient(BrokerService.java:1271)\n  \tat org.apache.pulsar.broker.service.persistent.PersistentTopic.lambda$addReplicationCluster$65(PersistentTopic.java:1719)\n  \tat java.base/java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:646)\n  \tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleGetResult(ZKMetadataStore.java:269)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:219)\n  \tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\n  \tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:103)\n  \tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n  \tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\n  \tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \t... 1 more\n  Caused by: org.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: remote\n  \tat org.apache.pulsar.broker.service.BrokerService.lambda$getReplicationClient$46(BrokerService.java:1274)\n  \tat java.base/java.util.Optional.orElseThrow(Optional.java:403)\n  \tat org.apache.pulsar.broker.service.BrokerService.lambda$getReplicationClient$47(BrokerService.java:1274)\n  \t... 21 more\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 82, Failures: 1, Errors: 0, Skipped: 77, Time elapsed: 48.113 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.persistent.PersistentTopicTest\n  Error:  testCreateTopicWithZombieReplicatorCursor(org.apache.pulsar.broker.service.persistent.PersistentTopicTest)  Time elapsed: 0.367 s  &lt;&lt;&lt; FAILURE!\n  java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: remote\n  \tat java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:396)\n  \tat java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2096)\n  \tat org.apache.pulsar.broker.service.persistent.PersistentTopicTest.testCreateTopicWithZombieReplicatorCursor(PersistentTopicTest.java:587)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: java.lang.RuntimeException: org.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: remote\n  \tat org.apache.pulsar.broker.service.BrokerService.lambda$getReplicationClient$47(BrokerService.java:1347)\n  \tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.put(ConcurrentOpenHashMap.java:409)\n  \tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.computeIfAbsent(ConcurrentOpenHashMap.java:243)\n  \tat org.apache.pulsar.broker.service.BrokerService.getReplicationClient(BrokerService.java:1271)\n  \tat org.apache.pulsar.broker.service.persistent.PersistentTopic.lambda$addReplicationCluster$65(PersistentTopic.java:1719)\n  \tat java.base/java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:646)\n  \tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleGetResult(ZKMetadataStore.java:269)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:219)\n  \tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\n  \tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:103)\n  \tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n  \tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\n  \tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \t... 1 more\n  Caused by: org.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: remote\n  \tat org.apache.pulsar.broker.service.BrokerService.lambda$getReplicationClient$46(BrokerService.java:1274)\n  \tat java.base/java.util.Optional.orElseThrow(Optional.java:403)\n  \tat org.apache.pulsar.broker.service.BrokerService.lambda$getReplicationClient$47(BrokerService.java:1274)\n  \t... 21 more\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20010",
                "createdAt": "2023-04-04T11:15:11Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][cli] Add `--cleanupSubscription` to pulsar-admin",
        "url": "https://github.com/apache/pulsar/pull/20028",
        "resourcePath": "/apache/pulsar/pull/20028",
        "createdAt": "2023-04-06T09:06:34Z",
        "number": 20028,
        "mergeCommit": {
          "oid": "795d60acc7a27a2d6bddfc60ffd7c9cf52a91cb4",
          "message": "[improve][cli] Add `--cleanupSubscription` to pulsar-admin (#20028)\n\nCo-authored-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/795d60acc7a27a2d6bddfc60ffd7c9cf52a91cb4",
          "parents": {
            "nodes": [
              {
                "oid": "d3d36bdbd22a1b1fa6cee41a91acd9ec8a4c9341",
                "message": "[fix][meta] deadlock of zkSessionWatcher when zkConnection loss (#20122)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdFunctions.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdSinks.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/SinkConfigUtils.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5NvyI82gAoZTM1ZjQyNzZkZTFiZGYxMTE3YmEzMTA0OTU3NGIzNjEzZjhmNzJiYQ",
                "url": "https://github.com/apache/pulsar/pull/20028/commits/e35f4276de1bdf1117ba31049574b3613f8f72ba"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20027,
                "url": "https://github.com/apache/pulsar/issues/20027",
                "title": "Add `cleanupSubscription` to CmdFunction and CmdSink",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Although there is a <code class=\"notranslate\">cleanupSubscription</code> field in <code class=\"notranslate\">FunctionConfig</code> and <code class=\"notranslate\">SinkConfig</code>, users cannot set this field via <code class=\"notranslate\">pulsar-admin</code>(default value is true)</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Add a <code class=\"notranslate\">--cleanupSubscription</code> parameter to pulsar-admin</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20027",
                "createdAt": "2023-04-06T09:02:12Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[Fix][Doc] Update docs for Partition increase command",
        "url": "https://github.com/apache/pulsar/pull/20035",
        "resourcePath": "/apache/pulsar/pull/20035",
        "createdAt": "2023-04-06T21:30:16Z",
        "number": 20035,
        "mergeCommit": {
          "oid": "1e9c7f5236866d07105421c566241e3798f63097",
          "message": "[Fix][Doc] Update docs for Partition increase command (#20035)\n\nCo-authored-by: Apurva Telang <atelang@paypal.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/1e9c7f5236866d07105421c566241e3798f63097",
          "parents": {
            "nodes": [
              {
                "oid": "cff3f9baa03f166697d31ff517f234ecf0fc702d",
                "message": "[fix][client] Cache empty schema version in ProducerImpl schemaCache. (#19929)\n\nCo-authored-by: wangjinlong <wangjinlong@zhihu.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v1/PersistentTopics.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/PersistentTopics.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin-api/src/main/java/org/apache/pulsar/client/admin/Topics.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdPersistentTopics.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdTopics.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5NzU4L2gAoNDlkY2NiNTIxZjQwMGZmNWUzNWQyMThhNGRmYTE0OWNlNTE5ZTYyZA",
                "url": "https://github.com/apache/pulsar/pull/20035/commits/49dccb521f400ff5e35d218a4dfa149ce519e62d"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 17878,
                "url": "https://github.com/apache/pulsar/issues/17878",
                "title": "[Doc] Fix Admin Interface docs for Managing partitioned topics",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">What issue do you find in Pulsar docs?</h3>\n<p dir=\"auto\">The pulsar docs for updating partitioned topics states that it works only for non-global topics. This seems to be incorrect as per the below pull request:<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"501811447\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/5306\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/5306/hovercard\" href=\"https://github.com/apache/pulsar/pull/5306\">#5306</a></p>\n<h3 dir=\"auto\">What is your suggestion?</h3>\n<p dir=\"auto\">Please can we remove this statement from the explanation provided for the Update Partitioned topic piece:<br>\n\"if the topic is non-global\"</p>\n<h3 dir=\"auto\">Any reference?</h3>\n<p dir=\"auto\"><a href=\"https://pulsar.apache.org/docs/next/admin-api-topics/#update\" rel=\"nofollow\">https://pulsar.apache.org/docs/next/admin-api-topics/#update</a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/17878",
                "createdAt": "2022-09-28T21:00:13Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "doc-required"
                      }
                    },
                    {
                      "node": {
                        "name": "good first issue"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky testCreateTopicWithZombieReplicatorCursor",
        "url": "https://github.com/apache/pulsar/pull/20037",
        "resourcePath": "/apache/pulsar/pull/20037",
        "createdAt": "2023-04-07T03:27:05Z",
        "number": 20037,
        "mergeCommit": {
          "oid": "f2076b44764ffbbf39e01b3873a6735a90bc3d47",
          "message": "[fix][test] Fix flaky testCreateTopicWithZombieReplicatorCursor (#20037)",
          "commitUrl": "https://github.com/apache/pulsar/commit/f2076b44764ffbbf39e01b3873a6735a90bc3d47",
          "parents": {
            "nodes": [
              {
                "oid": "4f503fd886cd25670b6344defb8feb1ff2a6e816",
                "message": "[fix] [cli] Fix Broker crashed by too much memory usage of pulsar tools (#20031)\n\n### Motivation\r\nAfter #15868, we allow `PULSAR_MEM` & `PULSAR_GC` to be overridden in `pulsar_tool_env.sh`.\r\n\r\nMany users set `-Xms` to `2G` or larger in `PULSAR_MEM`, this will make the tools(such as `pulsar-admin`) cost a lot of memory, and if users execute `pulsar-admin` or another tool on the machine where the Broker is deployed, the current device will not have enough memory to allocate, resulting in a broker crash.\r\n\r\n### Modifications\r\n\r\nWhen `PULSAR_MEM` is overridden  in `pulsar_tool_env.sh`, delete parameter `-Xms`"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PersistentTopicTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5N0FVr2gAoYmIyNTRmMTdkMWVhZTlkYjYwZjk4ZjM1OTIwNTJlOGU3YTMwOTFhNw",
                "url": "https://github.com/apache/pulsar/pull/20037/commits/bb254f17d1eae9db60f98f3592052e8e7a3091a7"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20010,
                "url": "https://github.com/apache/pulsar/issues/20010",
                "title": "Flaky-test: PersistentTopicTest.testCreateTopicWithZombieReplicatorCursor",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4604351215/jobs/8140558256?pr=20005#step:11:1177\">https://github.com/apache/pulsar/actions/runs/4604351215/jobs/8140558256?pr=20005#step:11:1177</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 82, Failures: 1, Errors: 0, Skipped: 77, Time elapsed: 48.113 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.persistent.PersistentTopicTest\n  Error:  testCreateTopicWithZombieReplicatorCursor(org.apache.pulsar.broker.service.persistent.PersistentTopicTest)  Time elapsed: 0.367 s  &lt;&lt;&lt; FAILURE!\n  java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: remote\n  \tat java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:396)\n  \tat java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2096)\n  \tat org.apache.pulsar.broker.service.persistent.PersistentTopicTest.testCreateTopicWithZombieReplicatorCursor(PersistentTopicTest.java:587)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: java.lang.RuntimeException: org.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: remote\n  \tat org.apache.pulsar.broker.service.BrokerService.lambda$getReplicationClient$47(BrokerService.java:1347)\n  \tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.put(ConcurrentOpenHashMap.java:409)\n  \tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.computeIfAbsent(ConcurrentOpenHashMap.java:243)\n  \tat org.apache.pulsar.broker.service.BrokerService.getReplicationClient(BrokerService.java:1271)\n  \tat org.apache.pulsar.broker.service.persistent.PersistentTopic.lambda$addReplicationCluster$65(PersistentTopic.java:1719)\n  \tat java.base/java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:646)\n  \tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleGetResult(ZKMetadataStore.java:269)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:219)\n  \tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\n  \tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:103)\n  \tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n  \tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\n  \tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \t... 1 more\n  Caused by: org.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: remote\n  \tat org.apache.pulsar.broker.service.BrokerService.lambda$getReplicationClient$46(BrokerService.java:1274)\n  \tat java.base/java.util.Optional.orElseThrow(Optional.java:403)\n  \tat org.apache.pulsar.broker.service.BrokerService.lambda$getReplicationClient$47(BrokerService.java:1274)\n  \t... 21 more\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 82, Failures: 1, Errors: 0, Skipped: 77, Time elapsed: 48.113 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.persistent.PersistentTopicTest\n  Error:  testCreateTopicWithZombieReplicatorCursor(org.apache.pulsar.broker.service.persistent.PersistentTopicTest)  Time elapsed: 0.367 s  &lt;&lt;&lt; FAILURE!\n  java.util.concurrent.ExecutionException: java.lang.RuntimeException: org.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: remote\n  \tat java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:396)\n  \tat java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2096)\n  \tat org.apache.pulsar.broker.service.persistent.PersistentTopicTest.testCreateTopicWithZombieReplicatorCursor(PersistentTopicTest.java:587)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: java.lang.RuntimeException: org.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: remote\n  \tat org.apache.pulsar.broker.service.BrokerService.lambda$getReplicationClient$47(BrokerService.java:1347)\n  \tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.put(ConcurrentOpenHashMap.java:409)\n  \tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.computeIfAbsent(ConcurrentOpenHashMap.java:243)\n  \tat org.apache.pulsar.broker.service.BrokerService.getReplicationClient(BrokerService.java:1271)\n  \tat org.apache.pulsar.broker.service.persistent.PersistentTopic.lambda$addReplicationCluster$65(PersistentTopic.java:1719)\n  \tat java.base/java.util.concurrent.CompletableFuture$UniApply.tryFire(CompletableFuture.java:646)\n  \tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleGetResult(ZKMetadataStore.java:269)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:219)\n  \tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\n  \tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:103)\n  \tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n  \tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\n  \tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \t... 1 more\n  Caused by: org.apache.pulsar.metadata.api.MetadataStoreException$NotFoundException: remote\n  \tat org.apache.pulsar.broker.service.BrokerService.lambda$getReplicationClient$46(BrokerService.java:1274)\n  \tat java.base/java.util.Optional.orElseThrow(Optional.java:403)\n  \tat org.apache.pulsar.broker.service.BrokerService.lambda$getReplicationClient$47(BrokerService.java:1274)\n  \t... 21 more\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20010",
                "createdAt": "2023-04-04T11:15:11Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][client] PIP-224: Add getLastMessageIds API",
        "url": "https://github.com/apache/pulsar/pull/20040",
        "resourcePath": "/apache/pulsar/pull/20040",
        "createdAt": "2023-04-07T11:11:48Z",
        "number": 20040,
        "mergeCommit": {
          "oid": "a91865140893f7e9737f6ce9ffc052584c721884",
          "message": "[improve][client] PIP-224: Add getLastMessageIds API (#20040)\n\nCo-authored-by: Baodi Shi <wudixiaolongbao@icloud.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/a91865140893f7e9737f6ce9ffc052584c721884",
          "parents": {
            "nodes": [
              {
                "oid": "bafecb2a9c0e73942de6a38df72dd5888d5afd66",
                "message": "[improve] Removed usages of SafeRun (#20060)\n\n### Motivation\r\n\r\nWith BK 4.16, we don't need to pass `SafeRunnable` instances to the `OrderedExecutor` anymore. The executor has embedded the logic of checking and logging exceptions.\r\n\r\nRemoving the SafeRun will avoid extra allocations in critical path and clutter of the code\r\n\r\n### Verifying this change\r\n\r\n- [ ] Make sure that the change passes the CI checks.\r\n\r\n*(Please pick either of the following options)*\r\n\r\nThis change is a trivial rework / code cleanup without any test coverage.\r\n\r\n*(or)*\r\n\r\nThis change is already covered by existing tests, such as *(please describe tests)*.\r\n\r\n*(or)*\r\n\r\nThis change added tests and can be verified as follows:\r\n\r\n*(example:)*\r\n  - *Added integration tests for end-to-end deployment with large payloads (10MB)*\r\n  - *Extended integration test for recovery after broker failure*\r\n\r\n### Does this pull request potentially affect one of the following parts:\r\n\r\n<!-- DO NOT REMOVE THIS SECTION. CHECK THE PROPER BOX ONLY. -->\r\n\r\n*If the box was checked, please highlight the changes*\r\n\r\n- [ ] Dependencies (add or upgrade a dependency)\r\n- [ ] The public API\r\n- [ ] The schema\r\n- [ ] The default values of configurations\r\n- [ ] The threading model\r\n- [ ] The binary protocol\r\n- [ ] The REST endpoints\r\n- [ ] The admin CLI options\r\n- [ ] The metrics\r\n- [ ] Anything that affects deployment\r\n\r\n### Documentation\r\n\r\n<!-- DO NOT REMOVE THIS SECTION. CHECK THE PROPER BOX ONLY. -->\r\n\r\n- [ ] `doc` <!-- Your PR contains doc changes. -->\r\n- [ ] `doc-required` <!-- Your PR changes impact docs and you will update later -->\r\n- [x] `doc-not-needed` <!-- Your PR changes do not impact docs -->\r\n- [ ] `doc-complete` <!-- Docs have been already added -->\r\n\r\n### Matching PR in forked repository\r\n\r\nPR in forked repository: (https://github.com/merlimat/pulsar/pull/6)\r\n\r\n<!--\r\nAfter opening this PR, the build in apache/pulsar will fail and instructions will\r\nbe provided for opening a PR in the PR author's forked repository.\r\n\r\napache/pulsar pull requests should be first tested in your own fork since the \r\napache/pulsar CI based on GitHub Actions has constrained resources and quota.\r\nGitHub Actions provides separate quota for pull requests that are executed in \r\na forked repository.\r\n\r\nThe tests will be run in the forked repository until all PR review comments have\r\nbeen handled, the tests pass and the PR is approved by a reviewer.\r\n-->"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TopicReaderTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/TopicsConsumerImplTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/Consumer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiMessageIdImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5N1QuT2gAoZTg5MmU2M2ViYWQ1MmNlN2U4YTkzNTE2MDEzZGQ1ZTQwM2JkMzU1Mg",
                "url": "https://github.com/apache/pulsar/pull/20040/commits/e892e63ebad52ce7e8a93516013dd5e403bd3552"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 4940,
                "url": "https://github.com/apache/pulsar/issues/4940",
                "title": "Serialization and Deserialization for MultiMessageIdImpl",
                "bodyHTML": "<p dir=\"auto\">In PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"477929033\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/4911\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/4911/hovercard\" href=\"https://github.com/apache/pulsar/pull/4911\">#4911</a>, we added MultiMessageIdImpl, which contains a Map of &lt;topic, MessageId&gt;, that could be used for partition/multi-topics/pattern consumer methods, e.g. seek(), ackCumulative(), getLastMessageId().</p>\n<p dir=\"auto\">In streaming applications, they tends to store messageId along with the state. so that the streaming applications can restore the state back. we need to provide a consistent behavior for how to serialize and deserialize different message id implementations.</p>\n<p dir=\"auto\">This issue is to track and discuss uniforming the serialization and deserialization of message id implementations (basically we need the ability to deserialize the message ids from the byte array in a consistent way).</p>",
                "resourcePath": "/apache/pulsar/issues/4940",
                "createdAt": "2019-08-12T15:19:18Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "help wanted"
                      }
                    },
                    {
                      "node": {
                        "name": "area/client"
                      }
                    },
                    {
                      "node": {
                        "name": "type/feature"
                      }
                    },
                    {
                      "node": {
                        "name": "lifecycle/stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Use scheduled executor in BinaryProtoLookupService",
        "url": "https://github.com/apache/pulsar/pull/20043",
        "resourcePath": "/apache/pulsar/pull/20043",
        "createdAt": "2023-04-07T15:04:05Z",
        "number": 20043,
        "mergeCommit": {
          "oid": "25dea3dc9dd6f5c2956cb7b9376450515f225a6b",
          "message": "[fix] Use scheduled executor in BinaryProtoLookupService (#20043)\n\nMotivation: PulsarClient using ExecutorService as ScheduledExecutorService\r\n\r\nModifications: Use exactly ScheduledExecutorService",
          "commitUrl": "https://github.com/apache/pulsar/commit/25dea3dc9dd6f5c2956cb7b9376450515f225a6b",
          "parents": {
            "nodes": [
              {
                "oid": "a91865140893f7e9737f6ce9ffc052584c721884",
                "message": "[improve][client] PIP-224: Add getLastMessageIds API (#20040)\n\nCo-authored-by: Baodi Shi <wudixiaolongbao@icloud.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5N197c2gAoYmY0NzlmNTAzZWUzMjA5OTQwZmU3MWRjMTBkMmIyMjczNzEzM2FlNg",
                "url": "https://github.com/apache/pulsar/pull/20043/commits/bf479f503ee3209940fe71dc10d2b22737133ae6"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20042,
                "url": "https://github.com/apache/pulsar/issues/20042",
                "title": "[Bug][java-client] No Retry when subscribing to topic via pattern",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">v2.9.3 is working,<br>\nv2.9.4, v2.10.x, v2.11.x aren't</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Here is a sample main code that illustrate issue:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"import org.apache.pulsar.client.api.PulsarClient;\nimport org.apache.pulsar.client.api.PulsarClientException;\n\npublic class Main {\n    public static void main(String[] args) throws PulsarClientException {\n\n        PulsarClient client =  PulsarClient.builder()\n                .serviceUrl(&quot;pulsar://unresolvable.service:6650&quot;)\n                .build();\n\n        client.newConsumer().topicsPattern(&quot;public/default/.*&quot;).subscriptionName(&quot;test&quot;).subscribe();\n\n    }\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-s1\">client</span>.<span class=\"pl-s1\">api</span>.<span class=\"pl-s1\">PulsarClient</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-s1\">client</span>.<span class=\"pl-s1\">api</span>.<span class=\"pl-s1\">PulsarClientException</span>;\n\n<span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-smi\">Main</span> {\n    <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">main</span>(<span class=\"pl-smi\">String</span>[] <span class=\"pl-s1\">args</span>) <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">PulsarClientException</span> {\n\n        <span class=\"pl-smi\">PulsarClient</span> <span class=\"pl-s1\">client</span> =  <span class=\"pl-smi\">PulsarClient</span>.<span class=\"pl-en\">builder</span>()\n                .<span class=\"pl-en\">serviceUrl</span>(<span class=\"pl-s\">\"pulsar://unresolvable.service:6650\"</span>)\n                .<span class=\"pl-en\">build</span>();\n\n        <span class=\"pl-s1\">client</span>.<span class=\"pl-en\">newConsumer</span>().<span class=\"pl-en\">topicsPattern</span>(<span class=\"pl-s\">\"public/default/.*\"</span>).<span class=\"pl-en\">subscriptionName</span>(<span class=\"pl-s\">\"test\"</span>).<span class=\"pl-en\">subscribe</span>();\n\n    }\n}</pre></div>\n<p dir=\"auto\">With client in version 2.9.3, you will see <a href=\"https://github.com/apache/pulsar/blob/aafba1ac18dc729b10de62eca0e2df91025e5bce/pulsar-client/src/main/java/org/apache/pulsar/client/impl/BinaryProtoLookupService.java#L310\">theses logs</a></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Failed to open connection to unresolvable.service:6650 : org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext$SearchDomainUnknownHostException: Failed to resolve 'unresolvable.service' and search domain query for configured domains failed as well: [.]\n...\n[namespace: public/default] Could not get connection while getTopicsUnderNamespace -- Will try again in 1459 ms\nmultiple retry until timeout\"><pre class=\"notranslate\"><code class=\"notranslate\">Failed to open connection to unresolvable.service:6650 : org.apache.pulsar.shade.io.netty.resolver.dns.DnsResolveContext$SearchDomainUnknownHostException: Failed to resolve 'unresolvable.service' and search domain query for configured domains failed as well: [.]\n...\n[namespace: public/default] Could not get connection while getTopicsUnderNamespace -- Will try again in 1459 ms\nmultiple retry until timeout\n</code></pre></div>\n<p dir=\"auto\">With 2.9.4, you only have the first error, the future is never resolved, and the scheduled runnable is never run.</p>\n<p dir=\"auto\">The behavior is different with non pattern subscription, that retry until address resolves.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Same behavior as in v2.9.3</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">See minimal step, uncompleted future when subscribing a multiple topic consumer.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">I've read commits between v2.9.3 and v2.9.4 and my guess is that <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/apache/pulsar/commit/d9211c97776fe61baddb4d9b3c4049dfd37b48c7/hovercard\" href=\"https://github.com/apache/pulsar/commit/d9211c97776fe61baddb4d9b3c4049dfd37b48c7\"><tt>d9211c9</tt></a> may be responsible</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20042",
                "createdAt": "2023-04-07T14:55:57Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][pulsar-shell] Use singleton custom command factories",
        "url": "https://github.com/apache/pulsar/pull/20064",
        "resourcePath": "/apache/pulsar/pull/20064",
        "createdAt": "2023-04-10T23:58:35Z",
        "number": 20064,
        "mergeCommit": {
          "oid": "3efdc9af3bede77b018146caf1cd11730701ba4f",
          "message": "[improve][pulsar-shell] Use singleton custom command factories (#20064)",
          "commitUrl": "https://github.com/apache/pulsar/commit/3efdc9af3bede77b018146caf1cd11730701ba4f",
          "parents": {
            "nodes": [
              {
                "oid": "a332fead21390b3fbbb86c2d17a161717a170161",
                "message": "Upgrade the RocksDB version to 7.9.2 to keep sync with BookKeeper's RocksDB dependency (#20072)\n\n### Motivation\r\nBookKeeper has upgraded the RocksDB dependency to 7.9.2, related discussion:\r\nhttps://lists.apache.org/thread/8j90y4vrvgz1nvt5pb0xdjjy3o8z57z7\r\n\r\nhttps://github.com/apache/bookkeeper/issues/3734\r\n\r\nHowever, Pulsar also has the RocksDB dependency and it will override the BookKeeper's RocksDB dependency version. It will lead to the release package still using the old RocksDB version (6.29.4.1)\r\n\r\n### Modifications\r\nUpgrade the Pulsar's RocksDB dependency to 7.9.2 to keep sync with the BookKeeper's RocksDB dependency."
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools-test/src/test/java/org/apache/pulsar/admin/cli/PulsarAdminToolTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/PulsarAdminTool.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5N-dOR2gAoNDU4NzE0NjI3M2UzZDYzYzI0MjM3MGNkNDdiODNhMzA3MGU4Mzc0MQ",
                "url": "https://github.com/apache/pulsar/pull/20064/commits/4587146273e3d63c242370cd47b83a3070e83741"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20061,
                "url": "https://github.com/apache/pulsar/issues/20061",
                "title": "[pulsar-shell] Load custom command NARs only once",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Pulsar-shell would attempt to load the NAR files every time a new custom/extention command is invoked (see <a href=\"https://github.com/apache/pulsar/issues/17155\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/17155/hovercard\">PIP-201</a> for context regarding Pulsar Admin CLI Extensions).</p>\n<p dir=\"auto\">This works fine with caveats:</p>\n<ul dir=\"auto\">\n<li>Multiple NAR loading seems redundant. It is fair to expect the user to restart the shell session if the underlying NAR is updated.</li>\n<li>It has some interesting consequences when the the extensions command has a runtime dependency on a class that is available on the parent class loader.</li>\n</ul>\n<p dir=\"auto\">For example, I ran into a scenario where the extension/custom command has a dependency on <code class=\"notranslate\">netty-common</code> - the command would load on the NAR class loader, but the netty dependency will load on the parent class loader (the admin's AppClassLoader). Between shell commands invocations, the classes in the NAR class loader are recycled, but the netty classes are not. This lead to any \"static\" state to appear as \"leaking\" when the CLI is invoked for the second time.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Implementing \"singleton\" custom command bootstrapping (the NAR class loader and other necessary initialization) would do, at least in theory.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\">Switch the order by which class loader work (child then parent) although this seems unnecessarily complex.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20061",
                "createdAt": "2023-04-10T19:31:37Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][proxy] Refresh auth data if ProxyLookupRequests",
        "url": "https://github.com/apache/pulsar/pull/20067",
        "resourcePath": "/apache/pulsar/pull/20067",
        "createdAt": "2023-04-11T03:54:10Z",
        "number": 20067,
        "mergeCommit": {
          "oid": "075b625993746a6c2d72343cb969845aed2cd28a",
          "message": "[fix][proxy] Refresh auth data if ProxyLookupRequests (#20067)\n\nFixes: https://github.com/apache/pulsar/issues/10816\r\nPIP: #19771\r\nSupersedes: https://github.com/apache/pulsar/pull/19026\r\nDepends on: https://github.com/apache/pulsar/pull/20062\r\n\r\n### Motivation\r\n\r\nThe Pulsar Proxy does not properly handle authentication data refresh when in state `ProxyLookupRequests`. The consequence is described in https://github.com/apache/pulsar/issues/10816. Essentially, the problem is that the proxy caches stale authentication data and sends it to the broker leading to connection failures.\r\n\r\nhttps://github.com/apache/pulsar/pull/17831 attempted to fix the underlying problem, but it missed an important edge cases. Specifically, it missed the case that the `ConnectionPool` will have multiple connections when a lookup gets redirected. As such, the following problem exists (and is fixed by this PR):\r\n\r\n1. Client opens connection to perform lookups.\r\n2. Proxy connects to broker 1 to get the topic ownership info.\r\n3. Time passes.\r\n4. Client does an additional lookup, and this topic is on a newly created broker 2. In this case, the proxy opens a new connection with the stale client auth data.\r\n5. Broker 2 rejects the connection because it fails with expired authentication.\r\n\r\n### Modifications\r\n\r\n* Remove some of the implementation from https://github.com/apache/pulsar/pull/17831. This new implementation still allows a broker to challenge the client through the proxy, but notably, it limits the number of challenges sent to the client. Further, the proxy does not challenge the client when the auth data is not expired.\r\n* Introduce authentication refresh in the proxy so that the proxy challenges the client any time the auth data is expired.\r\n* Update the `ProxyClientCnx` to get the `clientAuthData` from the `ProxyConnection` to ensure that it gets new authentication data.\r\n* Add clock skew to the `AuthenticationProviderToken`. This is necessary to make some of the testing not flaky and it will also be necessary for users to configure in their clusters.\r\n\r\n### Verifying this change\r\n\r\nThe `ProxyRefreshAuthTest` covers the existing behavior and I expanded it to cover the edge case described above.\r\n\r\nAdditionally, testing this part of the code will be much easier to test once we implement #19624.\r\n\r\n### Documentation\r\n\r\n- [x] `doc-not-needed`\r\n\r\n### Matching PR in forked repository\r\n\r\nPR in forked repository: the relevant tests pass locally, so I am going to skip the forked tests.",
          "commitUrl": "https://github.com/apache/pulsar/commit/075b625993746a6c2d72343cb969845aed2cd28a",
          "parents": {
            "nodes": [
              {
                "oid": "15453964f6e6086b0c5e34736958cf749f16f5e1",
                "message": "[feat][proxy] PIP-250: Add proxyVersion to CommandConnect (#19618)\n\nPIP #19623 \r\nRelates to https://github.com/apache/pulsar/pull/19540\r\n\r\n### Motivation\r\n\r\nIn order to get more information about connections, it is helpful for the proxy to supply its version to the broker.\r\n\r\n### Modifications\r\n\r\n* Add `proxy_version` field to the `CommandConnect` protobuf message \r\n* Update proxy and broker to handle this new field\r\n\r\n### Verifying this change\r\n\r\nNew tests are added with this PR.\r\n\r\n### Does this pull request potentially affect one of the following parts:\r\n\r\n- [x] The binary protocol\r\n\r\nThis will be submitted as part of a PIP.\r\n\r\n### Documentation\r\n\r\n- [x] `doc-not-needed`"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authentication/AuthenticationProviderToken.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyClientCnx.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyConfiguration.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyConnection.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyRefreshAuthTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5N-_Dm2gAoZWQzN2RiNjQwNmQxZDc4NDFkMzE3OTI2NjExYmEzNDZmZDVmOGRkMQ",
                "url": "https://github.com/apache/pulsar/pull/20067/commits/ed37db6406d1d7841d317926611ba346fd5f8dd1"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 10816,
                "url": "https://github.com/apache/pulsar/issues/10816",
                "title": "PulsarProxy does not always refresh authentication tokens received from client",
                "bodyHTML": "<p dir=\"auto\"><strong>Describe the bug</strong><br>\nWe have Pulsar deployed as a single cluster with a Pulsar Proxy, 3 brokers, 3 bookies and 3 zookeepers.</p>\n<p dir=\"auto\">We use token authentication. Tokens expire every 5 minutes and they are refreshed 1 minute before they expire. We use <code class=\"notranslate\">Supplier </code> interface in <code class=\"notranslate\">PulsarClient</code> to provide a valid token.</p>\n<p dir=\"auto\">The thing is that if we connect directly to brokers token refreshing works perfectly (we use a Docker Swarm and deploy broker as a service with multiple instances, so swarm manages balancing of connections). No <code class=\"notranslate\">ClientCnx</code> erros are displayed (see <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"762347696\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/8922\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/8922/hovercard\" href=\"https://github.com/apache/pulsar/issues/8922\">#8922</a>) and new <code class=\"notranslate\">Reader</code>, <code class=\"notranslate\">Consumer</code> or <code class=\"notranslate\">Producer</code> can be created from same client instance.</p>\n<p dir=\"auto\">Te problem comes when we use Pulsar Proxy. It seems that Pulsar Proxy keeps a connection pool against the broker while it manages connections from Pulsar Client. Connection pool against brokers eventually requires creating new connections, same as connections between Client and Proxy. Connection between Client and Proxy always has valid tokens, since when a new connection in pool is required <code class=\"notranslate\">Supplier</code> in <code class=\"notranslate\">PulsarClient</code> returns a currently valid token.</p>\n<p dir=\"auto\">The connection between the proxy and the brokers seems to be another story as when at least 5 minutes have elapsed since first token was used for first <code class=\"notranslate\">Producer</code>, <code class=\"notranslate\">Reader</code> or <code class=\"notranslate\">Consumer</code> new connections may fail between Proxy and brokers.  But not in all cases.</p>\n<p dir=\"auto\">Below are some logs from a custom test that consumes data from a topic using a <code class=\"notranslate\">Reader</code> and produces data every 30 seconds (using a new <code class=\"notranslate\">Producer</code> each time). The token is refreshed 2 times but after second one creating new <code class=\"notranslate\">Producer</code> fails.</p>\n<p dir=\"auto\">Look at <code class=\"notranslate\">RefreshableCredentialsSupplier </code>logs that inform when a token is refreshed and after it is destroyed when was it last accessed by <code class=\"notranslate\">PulsarClient</code>.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2021-06-03 12:36:50.014  INFO 12076 --- [subscriptionMessageSender-1] k.o.d.a.s.RefreshableCredentialsSupplier : New credentials: {clientId: etx, tokenHash: 2746ae06dde51c721854154092a1dab1, exp: 2021-06-03T10:40:57Z, life: PT4M6.986S}\n2021-06-03 12:36:50.819  INFO 12076 --- [pulsar-client-io-8-1] o.a.pulsar.client.impl.ConnectionPool    : [[id: 0xd7e45848, L:/172.19.5.106:62072 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]] Connected to server\n2021-06-03 12:36:51.140  INFO 12076 --- [pulsar-client-io-8-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : Starting Pulsar consumer status recorder with config: {\n2021-06-03 12:36:51.145  INFO 12076 --- [pulsar-client-io-8-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:36:51.400  INFO 12076 --- [pulsar-client-io-8-1] o.a.pulsar.client.impl.ConnectionPool    : [[id: 0x6c2f57c6, L:/172.19.5.106:62073 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]] Connected to server\n2021-06-03 12:36:51.401  INFO 12076 --- [pulsar-client-io-8-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0x6c2f57c6, L:/172.19.5.106:62073 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Connected through proxy to target broker at broker2:6650\n2021-06-03 12:36:51.531  INFO 12076 --- [pulsar-client-io-8-1] o.a.pulsar.client.impl.ConsumerImpl      : [persistent://dbus/test/dummy-objects][reader-8d798953a5] Subscribing to topic on cnx [id: 0x6c2f57c6, L:/172.19.5.106:62073 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650], consumerId 0\n2021-06-03 12:36:51.675  INFO 12076 --- [pulsar-client-io-8-1] o.a.pulsar.client.impl.ConsumerImpl      : [persistent://dbus/test/dummy-objects][reader-8d798953a5] Subscribed to topic on bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650 -- consumer: 0\n2021-06-03 12:36:54.541  INFO 12076 --- [pulsar-client-io-8-1] o.a.pulsar.client.impl.ConsumerImpl      : [persistent://dbus/test/dummy-objects] [reader-8d798953a5] Closed consumer\n2021-06-03 12:37:57.990  INFO 12076 --- [XNIO-1 task-9] o.a.pulsar.client.impl.PulsarClientImpl  : Client closing. URL: pulsar://bio-qa-demo.ktc-onelab.lcl:6650\n2021-06-03 12:37:57.998  INFO 12076 --- [pulsar-client-io-8-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0x6c2f57c6, L:/172.19.5.106:62073 ! R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Disconnected\n2021-06-03 12:37:58.002  INFO 12076 --- [pulsar-client-io-8-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xd7e45848, L:/172.19.5.106:62072 ! R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Disconnected\n2021-06-03 12:38:08.872  INFO 12076 --- [subscriptionMessageSender-2] k.o.d.a.s.RefreshableCredentialsSupplier : New credentials: {clientId: etx, tokenHash: 9a099eaee9325f97f332f8b83200bae5, exp: 2021-06-03T10:42:55Z, life: PT4M46.128S}\n2021-06-03 12:38:09.057  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ConnectionPool    : [[id: 0xf2df9fcd, L:/172.19.5.106:62137 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]] Connected to server\n2021-06-03 12:38:09.299  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : Starting Pulsar consumer status recorder with config: {\n2021-06-03 12:38:09.303  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:38:09.543  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ConnectionPool    : [[id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]] Connected to server\n2021-06-03 12:38:09.543  INFO 12076 --- [pulsar-client-io-12-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Connected through proxy to target broker at broker1:6650\n2021-06-03 12:38:09.675  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ConsumerImpl      : [persistent://dbus/test/dummy-objects][reader-bda41b7606] Subscribing to topic on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650], consumerId 0\n2021-06-03 12:38:09.796  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ConsumerImpl      : [persistent://dbus/test/dummy-objects][reader-bda41b7606] Subscribed to topic on bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650 -- consumer: 0\n2021-06-03 12:38:14.242  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:38:14.244  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:38:14.360  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:38:14.489  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1417] Created producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:38:14.550  WARN 12076 --- [pulsar-client-io-12-1] c.s.circe.checksum.Crc32cIntChecksum     : Failed to load Circe JNI library. Falling back to Java based CRC32c provider\n2021-06-03 12:38:14.783  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1417] Closed Producer\n2021-06-03 12:38:46.093  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:38:46.096  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:38:46.209  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:38:46.325  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1421] Created producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:38:46.556  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1421] Closed Producer\n2021-06-03 12:39:09.307  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:39:17.831  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:39:17.835  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:39:17.948  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:39:18.064  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1422] Created producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:39:18.296  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1422] Closed Producer\n2021-06-03 12:39:49.608  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:39:49.610  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:39:49.723  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:39:49.843  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1423] Created producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:39:50.069  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1423] Closed Producer\n2021-06-03 12:40:09.309  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:40:21.639  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:40:21.642  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:40:21.754  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:40:21.870  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1424] Created producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:40:22.109  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1424] Closed Producer\n2021-06-03 12:40:53.392  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:40:53.395  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:40:53.507  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:40:53.625  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1425] Created producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:40:53.855  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1425] Closed Producer\n2021-06-03 12:41:09.311  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:41:25.219  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:41:25.223  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:41:25.346  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:41:25.466  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1429] Created producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:41:25.699  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1429] Closed Producer\n2021-06-03 12:41:56.976  INFO 12076 --- [XNIO-1 task-19] k.o.d.a.s.RefreshableCredentialsSupplier : New credentials: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: 2021-06-03T10:46:56Z, life: PT4M59.024S}\n2021-06-03 12:41:57.161  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ConnectionPool    : [[id: 0x570ca8a3, L:/172.19.5.106:59319 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]] Connected to server\n2021-06-03 12:41:57.547  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:41:57.550  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:41:57.785  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ConnectionPool    : [[id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]] Connected to server\n2021-06-03 12:41:57.786  INFO 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Connected through proxy to target broker at broker1:6650\n2021-06-03 12:41:57.917  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:41:58.036  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1431] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:41:58.267  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1431] Closed Producer\n2021-06-03 12:41:58.699  INFO 12076 --- [clientInboundChannel-33] k.o.d.a.s.RefreshableCredentialsSupplier : Credentials refreshed: {old: {clientId: etx, tokenHash: 9a099eaee9325f97f332f8b83200bae5, exp: 2021-06-03T10:42:55Z, life: PT56.301S}, new: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT4M57.301S}}\n2021-06-03 12:41:58.700  INFO 12076 --- [clientInboundChannel-33] k.o.d.a.s.RefreshableCredentialsSupplier : Supplier deleted: {lastSupply: {moment: 2021-06-03T10:41:57.786Z, creds: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT4M57.3S}}, curCreds: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT4M57.3S}, prevCreds: &lt;NONE&gt;}\n2021-06-03 12:42:09.313  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:42:29.547  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:42:29.549  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:42:29.661  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:42:29.776  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1432] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:42:30.002  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1432] Closed Producer\n2021-06-03 12:43:01.166  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:43:01.168  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:43:01.286  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:43:01.401  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1433] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:43:01.627  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1433] Closed Producer\n2021-06-03 12:43:09.316  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:43:32.866  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:43:32.868  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:43:32.980  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:43:33.095  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1434] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:43:33.329  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1434] Closed Producer\n2021-06-03 12:44:04.632  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:44:04.636  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:44:04.751  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:44:04.867  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1435] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:44:05.103  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1435] Closed Producer\n2021-06-03 12:44:09.318  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:44:36.616  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:44:36.618  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:44:36.732  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:44:36.849  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1440] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:44:37.079  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1440] Closed Producer\n2021-06-03 12:45:08.346  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:45:08.353  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:45:08.465  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:45:08.580  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1441] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:45:08.804  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1441] Closed Producer\n2021-06-03 12:45:09.321  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:45:40.071  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:45:40.073  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:45:40.185  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:45:40.301  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1442] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:45:40.524  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1442] Closed Producer\n2021-06-03 12:45:59.301  INFO 12076 --- [clientInboundChannel-35] k.o.d.a.s.RefreshableCredentialsSupplier : Credentials refreshed: {old: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT56.699S}, new: {clientId: etx, tokenHash: 92730944006c9c39aa8ff5026c7c4090, exp: 2021-06-03T10:50:59Z, life: PT4M59.699S}}\n2021-06-03 12:45:59.302  INFO 12076 --- [clientInboundChannel-35] k.o.d.a.s.RefreshableCredentialsSupplier : Supplier deleted: {lastSupply: {moment: 2021-06-03T10:43:38.762Z, creds: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT56.699S}}, curCreds: {clientId: etx, tokenHash: 92730944006c9c39aa8ff5026c7c4090, exp: 2021-06-03T10:50:59Z, life: PT4M59.698S}, prevCreds: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT56.698S}}\n2021-06-03 12:46:09.322  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,02 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:46:11.809  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:46:11.811  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:46:11.923  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:46:12.042  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1443] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:46:12.274  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1443] Closed Producer\n2021-06-03 12:46:43.532  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:46:43.535  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:46:43.647  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:46:43.761  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1448] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:46:43.991  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1448] Closed Producer\n2021-06-03 12:47:09.324  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:47:15.302  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:47:15.305  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  &quot;serviceUrl&quot; : &quot;pulsar://bio-qa-demo.ktc-onelab.lcl:6650&quot;,\n2021-06-03 12:47:15.419  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:47:15.537  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1449] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:47:15.773  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1449] Closed Producer\n2021-06-03 12:47:38.882  WARN 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Received error from server: Failed to authentication token: JWT expired at **2021-06-03T10:46:56Z**. Current time: 2021-06-03T10:47:38Z, a difference of 42823 milliseconds.  Allowed clock skew: 0 milliseconds.\n2021-06-03 12:47:38.883 ERROR 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Failed to authenticate the client\n2021-06-03 12:47:38.883  WARN 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Received unknown request id from server: -1\n2021-06-03 12:47:38.883  INFO 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb64f1099, L:/172.19.5.106:59320 ! R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Disconnected\n2021-06-03 12:47:46.913  WARN 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0x570ca8a3, L:/172.19.5.106:59319 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Received error from server: Disconnected from server at broker1/10.0.4.44:6650\n2021-06-03 12:47:46.919  WARN 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.BinaryProtoLookupService    : [persistent://dbus/test/dummy-objects] failed to get schema : org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker1/10.0.4.44:6650\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker1/10.0.4.44:6650\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:655) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:197) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:324) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:296) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[pulsar-client-2.7.2.jar:2.7.2]\nCaused by: org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker1/10.0.4.44:6650\n\tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:1033) ~[pulsar-client-2.7.2.jar:2.7.2]\n2021-06-03 12:47:47.048  WARN 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0x570ca8a3, L:/172.19.5.106:59319 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Received error from server: Disconnected from server at broker2/10.0.4.45:6650\n2021-06-03 12:47:47.048  WARN 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.BinaryProtoLookupService    : [persistent://dbus/test/dummy-objects] failed to get schema : org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker2/10.0.4.45:6650\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker2/10.0.4.45:6650\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:655) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:197) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:324) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:296) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[pulsar-client-2.7.2.jar:2.7.2]\nCaused by: org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker2/10.0.4.45:6650\n\tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:1033) ~[pulsar-client-2.7.2.jar:2.7.2]\n2021-06-03 12:47:47.170  WARN 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0x570ca8a3, L:/172.19.5.106:59319 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Received error from server: Disconnected from server at broker3/10.0.4.46:6650\n2021-06-03 12:47:47.172  WARN 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.BinaryProtoLookupService    : [persistent://dbus/test/dummy-objects] failed to get schema : org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker3/10.0.4.46:6650\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker3/10.0.4.46:6650\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:655) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:197) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:324) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:296) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[pulsar-client-2.7.2.jar:2.7.2]\nCaused by: org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker3/10.0.4.46:6650\n\tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:1033) ~[pulsar-client-2.7.2.jar:2.7.2]\n    CAUSE   &gt;&gt;&gt;&gt; org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker3/10.0.4.46:6650\n2021-06-03 12:47:47.373  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ConsumerImpl      : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] Closed consumer\n2021-06-03 12:50:51.503  INFO 12076 --- [MessageBroker-8] k.o.d.a.s.RefreshableCredentialsSupplier : Supplier deleted: {lastSupply: {moment: 2021-06-03T10:47:38.760Z, creds: {clientId: etx, tokenHash: 92730944006c9c39aa8ff5026c7c4090, exp: 2021-06-03T10:50:59Z, life: PT7.497S}}, curCreds: {clientId: etx, tokenHash: 92730944006c9c39aa8ff5026c7c4090, exp: 2021-06-03T10:50:59Z, life: PT7.497S}, prevCreds: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT-3M-55.503S}}\n2021-06-03 12:50:51.503  INFO 12076 --- [MessageBroker-8] o.a.pulsar.client.impl.PulsarClientImpl  : Client closing. URL: pulsar://bio-qa-demo.ktc-onelab.lcl:6650\n2021-06-03 12:50:51.505  INFO 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0x570ca8a3, L:/172.19.5.106:59319 ! R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Disconnected\n2021-06-03 12:51:38.882  WARN 12076 --- [pulsar-client-io-12-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Received error from server: Failed to authentication token: JWT expired at 2021-06-03T10:50:59Z. Current time: 2021-06-03T10:51:38Z, a difference of 39827 milliseconds.  Allowed clock skew: 0 milliseconds.\n2021-06-03 12:51:38.884 ERROR 12076 --- [pulsar-client-io-12-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Failed to authenticate the client\n2021-06-03 12:51:38.885  WARN 12076 --- [pulsar-client-io-12-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Received unknown request id from server: -1\n2021-06-03 12:51:38.885  INFO 12076 --- [pulsar-client-io-12-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb5aa0fd1, L:/172.19.5.106:62138 ! R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Disconnected\"><pre class=\"notranslate\"><code class=\"notranslate\">2021-06-03 12:36:50.014  INFO 12076 --- [subscriptionMessageSender-1] k.o.d.a.s.RefreshableCredentialsSupplier : New credentials: {clientId: etx, tokenHash: 2746ae06dde51c721854154092a1dab1, exp: 2021-06-03T10:40:57Z, life: PT4M6.986S}\n2021-06-03 12:36:50.819  INFO 12076 --- [pulsar-client-io-8-1] o.a.pulsar.client.impl.ConnectionPool    : [[id: 0xd7e45848, L:/172.19.5.106:62072 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]] Connected to server\n2021-06-03 12:36:51.140  INFO 12076 --- [pulsar-client-io-8-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : Starting Pulsar consumer status recorder with config: {\n2021-06-03 12:36:51.145  INFO 12076 --- [pulsar-client-io-8-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:36:51.400  INFO 12076 --- [pulsar-client-io-8-1] o.a.pulsar.client.impl.ConnectionPool    : [[id: 0x6c2f57c6, L:/172.19.5.106:62073 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]] Connected to server\n2021-06-03 12:36:51.401  INFO 12076 --- [pulsar-client-io-8-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0x6c2f57c6, L:/172.19.5.106:62073 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Connected through proxy to target broker at broker2:6650\n2021-06-03 12:36:51.531  INFO 12076 --- [pulsar-client-io-8-1] o.a.pulsar.client.impl.ConsumerImpl      : [persistent://dbus/test/dummy-objects][reader-8d798953a5] Subscribing to topic on cnx [id: 0x6c2f57c6, L:/172.19.5.106:62073 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650], consumerId 0\n2021-06-03 12:36:51.675  INFO 12076 --- [pulsar-client-io-8-1] o.a.pulsar.client.impl.ConsumerImpl      : [persistent://dbus/test/dummy-objects][reader-8d798953a5] Subscribed to topic on bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650 -- consumer: 0\n2021-06-03 12:36:54.541  INFO 12076 --- [pulsar-client-io-8-1] o.a.pulsar.client.impl.ConsumerImpl      : [persistent://dbus/test/dummy-objects] [reader-8d798953a5] Closed consumer\n2021-06-03 12:37:57.990  INFO 12076 --- [XNIO-1 task-9] o.a.pulsar.client.impl.PulsarClientImpl  : Client closing. URL: pulsar://bio-qa-demo.ktc-onelab.lcl:6650\n2021-06-03 12:37:57.998  INFO 12076 --- [pulsar-client-io-8-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0x6c2f57c6, L:/172.19.5.106:62073 ! R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Disconnected\n2021-06-03 12:37:58.002  INFO 12076 --- [pulsar-client-io-8-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xd7e45848, L:/172.19.5.106:62072 ! R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Disconnected\n2021-06-03 12:38:08.872  INFO 12076 --- [subscriptionMessageSender-2] k.o.d.a.s.RefreshableCredentialsSupplier : New credentials: {clientId: etx, tokenHash: 9a099eaee9325f97f332f8b83200bae5, exp: 2021-06-03T10:42:55Z, life: PT4M46.128S}\n2021-06-03 12:38:09.057  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ConnectionPool    : [[id: 0xf2df9fcd, L:/172.19.5.106:62137 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]] Connected to server\n2021-06-03 12:38:09.299  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : Starting Pulsar consumer status recorder with config: {\n2021-06-03 12:38:09.303  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:38:09.543  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ConnectionPool    : [[id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]] Connected to server\n2021-06-03 12:38:09.543  INFO 12076 --- [pulsar-client-io-12-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Connected through proxy to target broker at broker1:6650\n2021-06-03 12:38:09.675  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ConsumerImpl      : [persistent://dbus/test/dummy-objects][reader-bda41b7606] Subscribing to topic on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650], consumerId 0\n2021-06-03 12:38:09.796  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ConsumerImpl      : [persistent://dbus/test/dummy-objects][reader-bda41b7606] Subscribed to topic on bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650 -- consumer: 0\n2021-06-03 12:38:14.242  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:38:14.244  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:38:14.360  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:38:14.489  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1417] Created producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:38:14.550  WARN 12076 --- [pulsar-client-io-12-1] c.s.circe.checksum.Crc32cIntChecksum     : Failed to load Circe JNI library. Falling back to Java based CRC32c provider\n2021-06-03 12:38:14.783  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1417] Closed Producer\n2021-06-03 12:38:46.093  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:38:46.096  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:38:46.209  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:38:46.325  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1421] Created producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:38:46.556  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1421] Closed Producer\n2021-06-03 12:39:09.307  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:39:17.831  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:39:17.835  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:39:17.948  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:39:18.064  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1422] Created producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:39:18.296  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1422] Closed Producer\n2021-06-03 12:39:49.608  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:39:49.610  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:39:49.723  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:39:49.843  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1423] Created producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:39:50.069  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1423] Closed Producer\n2021-06-03 12:40:09.309  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:40:21.639  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:40:21.642  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:40:21.754  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:40:21.870  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1424] Created producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:40:22.109  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1424] Closed Producer\n2021-06-03 12:40:53.392  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:40:53.395  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:40:53.507  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:40:53.625  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1425] Created producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:40:53.855  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1425] Closed Producer\n2021-06-03 12:41:09.311  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:41:25.219  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:41:25.223  INFO 12076 --- [pulsar-client-io-12-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:41:25.346  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:41:25.466  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1429] Created producer on cnx [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:41:25.699  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1429] Closed Producer\n2021-06-03 12:41:56.976  INFO 12076 --- [XNIO-1 task-19] k.o.d.a.s.RefreshableCredentialsSupplier : New credentials: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: 2021-06-03T10:46:56Z, life: PT4M59.024S}\n2021-06-03 12:41:57.161  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ConnectionPool    : [[id: 0x570ca8a3, L:/172.19.5.106:59319 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]] Connected to server\n2021-06-03 12:41:57.547  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:41:57.550  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:41:57.785  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ConnectionPool    : [[id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]] Connected to server\n2021-06-03 12:41:57.786  INFO 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Connected through proxy to target broker at broker1:6650\n2021-06-03 12:41:57.917  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:41:58.036  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1431] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:41:58.267  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1431] Closed Producer\n2021-06-03 12:41:58.699  INFO 12076 --- [clientInboundChannel-33] k.o.d.a.s.RefreshableCredentialsSupplier : Credentials refreshed: {old: {clientId: etx, tokenHash: 9a099eaee9325f97f332f8b83200bae5, exp: 2021-06-03T10:42:55Z, life: PT56.301S}, new: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT4M57.301S}}\n2021-06-03 12:41:58.700  INFO 12076 --- [clientInboundChannel-33] k.o.d.a.s.RefreshableCredentialsSupplier : Supplier deleted: {lastSupply: {moment: 2021-06-03T10:41:57.786Z, creds: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT4M57.3S}}, curCreds: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT4M57.3S}, prevCreds: &lt;NONE&gt;}\n2021-06-03 12:42:09.313  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:42:29.547  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:42:29.549  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:42:29.661  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:42:29.776  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1432] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:42:30.002  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1432] Closed Producer\n2021-06-03 12:43:01.166  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:43:01.168  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:43:01.286  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:43:01.401  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1433] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:43:01.627  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1433] Closed Producer\n2021-06-03 12:43:09.316  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:43:32.866  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:43:32.868  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:43:32.980  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:43:33.095  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1434] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:43:33.329  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1434] Closed Producer\n2021-06-03 12:44:04.632  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:44:04.636  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:44:04.751  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:44:04.867  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1435] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:44:05.103  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1435] Closed Producer\n2021-06-03 12:44:09.318  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:44:36.616  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:44:36.618  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:44:36.732  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:44:36.849  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1440] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:44:37.079  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1440] Closed Producer\n2021-06-03 12:45:08.346  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:45:08.353  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:45:08.465  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:45:08.580  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1441] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:45:08.804  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1441] Closed Producer\n2021-06-03 12:45:09.321  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:45:40.071  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:45:40.073  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:45:40.185  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:45:40.301  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1442] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:45:40.524  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1442] Closed Producer\n2021-06-03 12:45:59.301  INFO 12076 --- [clientInboundChannel-35] k.o.d.a.s.RefreshableCredentialsSupplier : Credentials refreshed: {old: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT56.699S}, new: {clientId: etx, tokenHash: 92730944006c9c39aa8ff5026c7c4090, exp: 2021-06-03T10:50:59Z, life: PT4M59.699S}}\n2021-06-03 12:45:59.302  INFO 12076 --- [clientInboundChannel-35] k.o.d.a.s.RefreshableCredentialsSupplier : Supplier deleted: {lastSupply: {moment: 2021-06-03T10:43:38.762Z, creds: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT56.699S}}, curCreds: {clientId: etx, tokenHash: 92730944006c9c39aa8ff5026c7c4090, exp: 2021-06-03T10:50:59Z, life: PT4M59.698S}, prevCreds: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT56.698S}}\n2021-06-03 12:46:09.322  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,02 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:46:11.809  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:46:11.811  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:46:11.923  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:46:12.042  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1443] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:46:12.274  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1443] Closed Producer\n2021-06-03 12:46:43.532  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:46:43.535  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:46:43.647  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:46:43.761  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1448] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:46:43.991  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1448] Closed Producer\n2021-06-03 12:47:09.324  INFO 12076 --- [pulsar-timer-15-1] o.a.p.c.impl.ConsumerStatsRecorderImpl   : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] [11266] Prefetched messages: 0 --- Consume throughput received: 0,03 msgs/s --- 0,00 Mbit/s --- Ack sent rate: 0,00 ack/s --- Failed messages: 0 --- batch messages: 0 ---Failed acks: 0\n2021-06-03 12:47:15.302  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Starting Pulsar producer perf with config: {\n2021-06-03 12:47:15.305  INFO 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.ProducerStatsRecorderImpl   : Pulsar client config: {\n  \"serviceUrl\" : \"pulsar://bio-qa-demo.ktc-onelab.lcl:6650\",\n2021-06-03 12:47:15.419  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [null] Creating producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:47:15.537  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1449] Created producer on cnx [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650]\n2021-06-03 12:47:15.773  INFO 12076 --- [pulsar-client-io-16-1] o.a.pulsar.client.impl.ProducerImpl      : [persistent://dbus/test/dummy-objects] [databus-75-1449] Closed Producer\n2021-06-03 12:47:38.882  WARN 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Received error from server: Failed to authentication token: JWT expired at **2021-06-03T10:46:56Z**. Current time: 2021-06-03T10:47:38Z, a difference of 42823 milliseconds.  Allowed clock skew: 0 milliseconds.\n2021-06-03 12:47:38.883 ERROR 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Failed to authenticate the client\n2021-06-03 12:47:38.883  WARN 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb64f1099, L:/172.19.5.106:59320 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Received unknown request id from server: -1\n2021-06-03 12:47:38.883  INFO 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb64f1099, L:/172.19.5.106:59320 ! R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Disconnected\n2021-06-03 12:47:46.913  WARN 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0x570ca8a3, L:/172.19.5.106:59319 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Received error from server: Disconnected from server at broker1/10.0.4.44:6650\n2021-06-03 12:47:46.919  WARN 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.BinaryProtoLookupService    : [persistent://dbus/test/dummy-objects] failed to get schema : org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker1/10.0.4.44:6650\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker1/10.0.4.44:6650\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:655) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:197) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:324) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:296) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[pulsar-client-2.7.2.jar:2.7.2]\nCaused by: org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker1/10.0.4.44:6650\n\tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:1033) ~[pulsar-client-2.7.2.jar:2.7.2]\n2021-06-03 12:47:47.048  WARN 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0x570ca8a3, L:/172.19.5.106:59319 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Received error from server: Disconnected from server at broker2/10.0.4.45:6650\n2021-06-03 12:47:47.048  WARN 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.BinaryProtoLookupService    : [persistent://dbus/test/dummy-objects] failed to get schema : org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker2/10.0.4.45:6650\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker2/10.0.4.45:6650\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:655) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:197) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:324) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:296) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[pulsar-client-2.7.2.jar:2.7.2]\nCaused by: org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker2/10.0.4.45:6650\n\tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:1033) ~[pulsar-client-2.7.2.jar:2.7.2]\n2021-06-03 12:47:47.170  WARN 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0x570ca8a3, L:/172.19.5.106:59319 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Received error from server: Disconnected from server at broker3/10.0.4.46:6650\n2021-06-03 12:47:47.172  WARN 12076 --- [pulsar-client-io-16-1] o.a.p.c.impl.BinaryProtoLookupService    : [persistent://dbus/test/dummy-objects] failed to get schema : org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker3/10.0.4.46:6650\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker3/10.0.4.46:6650\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:655) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:197) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:324) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:296) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:719) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:655) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:581) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:493) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[pulsar-client-2.7.2.jar:2.7.2]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[pulsar-client-2.7.2.jar:2.7.2]\nCaused by: org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker3/10.0.4.46:6650\n\tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:1033) ~[pulsar-client-2.7.2.jar:2.7.2]\n    CAUSE   &gt;&gt;&gt;&gt; org.apache.pulsar.client.api.PulsarClientException$LookupException: Disconnected from server at broker3/10.0.4.46:6650\n2021-06-03 12:47:47.373  INFO 12076 --- [pulsar-client-io-12-1] o.a.pulsar.client.impl.ConsumerImpl      : [persistent://dbus/test/dummy-objects] [reader-bda41b7606] Closed consumer\n2021-06-03 12:50:51.503  INFO 12076 --- [MessageBroker-8] k.o.d.a.s.RefreshableCredentialsSupplier : Supplier deleted: {lastSupply: {moment: 2021-06-03T10:47:38.760Z, creds: {clientId: etx, tokenHash: 92730944006c9c39aa8ff5026c7c4090, exp: 2021-06-03T10:50:59Z, life: PT7.497S}}, curCreds: {clientId: etx, tokenHash: 92730944006c9c39aa8ff5026c7c4090, exp: 2021-06-03T10:50:59Z, life: PT7.497S}, prevCreds: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT-3M-55.503S}}\n2021-06-03 12:50:51.503  INFO 12076 --- [MessageBroker-8] o.a.pulsar.client.impl.PulsarClientImpl  : Client closing. URL: pulsar://bio-qa-demo.ktc-onelab.lcl:6650\n2021-06-03 12:50:51.505  INFO 12076 --- [pulsar-client-io-16-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0x570ca8a3, L:/172.19.5.106:59319 ! R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Disconnected\n2021-06-03 12:51:38.882  WARN 12076 --- [pulsar-client-io-12-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Received error from server: Failed to authentication token: JWT expired at 2021-06-03T10:50:59Z. Current time: 2021-06-03T10:51:38Z, a difference of 39827 milliseconds.  Allowed clock skew: 0 milliseconds.\n2021-06-03 12:51:38.884 ERROR 12076 --- [pulsar-client-io-12-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Failed to authenticate the client\n2021-06-03 12:51:38.885  WARN 12076 --- [pulsar-client-io-12-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb5aa0fd1, L:/172.19.5.106:62138 - R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Received unknown request id from server: -1\n2021-06-03 12:51:38.885  INFO 12076 --- [pulsar-client-io-12-1] org.apache.pulsar.client.impl.ClientCnx  : [id: 0xb5aa0fd1, L:/172.19.5.106:62138 ! R:bio-qa-demo.ktc-onelab.lcl/172.24.9.126:6650] Disconnected\n</code></pre></div>\n<p dir=\"auto\">If we look at corresponding broker logs (broker3) we see that connection is being stablished using an expired token (at a time AFTER the refresh):</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"12:47:47.109 [pulsar-io-23-8] INFO  org.apache.pulsar.broker.service.ServerCnx - New connection from /10.0.4.50:41828\n12:47:47.114 [pulsar-io-23-8] ERROR org.apache.pulsar.broker.authentication.AuthenticationProviderList - Failed to initialize a new auth state from /10.0.4.50:41828\njavax.naming.AuthenticationException: Failed to authentication token: JWT expired at **2021-06-03T10:46:56Z**. Current time: 2021-06-03T10:47:47Z, a difference of 51114 milliseconds.  Allowed clock skew: 0 milliseconds.\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderToken.authenticateToken(AuthenticationProviderToken.java:223) ~[org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderToken.access$100(AuthenticationProviderToken.java:48) ~[org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderToken$TokenAuthenticationState.authenticate(AuthenticationProviderToken.java:321) ~[org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderToken$TokenAuthenticationState.&lt;init&gt;(AuthenticationProviderToken.java:309) ~[org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderToken.newAuthState(AuthenticationProviderToken.java:155) ~[org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderList.lambda$newAuthState$1(AuthenticationProviderList.java:173) ~[org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderList.applyAuthProcessor(AuthenticationProviderList.java:50) ~[org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderList.newAuthState(AuthenticationProviderList.java:170) [org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.service.ServerCnx.handleConnect(ServerCnx.java:754) [org.apache.pulsar-pulsar-broker-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:185) [org.apache.pulsar-pulsar-common-2.7.2.jar:2.7.2]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.handler.flow.FlowControlHandler.dequeue(FlowControlHandler.java:200) [io.netty-netty-handler-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.handler.flow.FlowControlHandler.channelRead(FlowControlHandler.java:162) [io.netty-netty-handler-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:324) [io.netty-netty-codec-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:296) [io.netty-netty-codec-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:795) [io.netty-netty-transport-native-epoll-4.1.60.Final-linux-x86_64.jar:4.1.60.Final]\n  at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:480) [io.netty-netty-transport-native-epoll-4.1.60.Final-linux-x86_64.jar:4.1.60.Final]\n  at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:378) [io.netty-netty-transport-native-epoll-4.1.60.Final-linux-x86_64.jar:4.1.60.Final]\n  at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989) [io.netty-netty-common-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) [io.netty-netty-common-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.60.Final.jar:4.1.60.Final]\n  at java.lang.Thread.run(Thread.java:748) [?:1.8.0_282]\n12:47:47.115 [pulsar-io-23-8] WARN  org.apache.pulsar.broker.service.ServerCnx - [/10.0.4.50:41828] Unable to authenticate: Failed to authentication token: JWT expired at **2021-06-03T10:46:56Z**. Current time: 2021-06-03T10:47:47Z, a difference of 51114 milliseconds.  Allowed clock skew: 0 milliseconds.\n12:47:47.115 [pulsar-io-23-8] INFO  org.apache.pulsar.broker.service.ServerCnx - Closed connection from /10.0.4.50:41828\n\"><pre class=\"notranslate\"><code class=\"notranslate\">12:47:47.109 [pulsar-io-23-8] INFO  org.apache.pulsar.broker.service.ServerCnx - New connection from /10.0.4.50:41828\n12:47:47.114 [pulsar-io-23-8] ERROR org.apache.pulsar.broker.authentication.AuthenticationProviderList - Failed to initialize a new auth state from /10.0.4.50:41828\njavax.naming.AuthenticationException: Failed to authentication token: JWT expired at **2021-06-03T10:46:56Z**. Current time: 2021-06-03T10:47:47Z, a difference of 51114 milliseconds.  Allowed clock skew: 0 milliseconds.\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderToken.authenticateToken(AuthenticationProviderToken.java:223) ~[org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderToken.access$100(AuthenticationProviderToken.java:48) ~[org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderToken$TokenAuthenticationState.authenticate(AuthenticationProviderToken.java:321) ~[org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderToken$TokenAuthenticationState.&lt;init&gt;(AuthenticationProviderToken.java:309) ~[org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderToken.newAuthState(AuthenticationProviderToken.java:155) ~[org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderList.lambda$newAuthState$1(AuthenticationProviderList.java:173) ~[org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderList.applyAuthProcessor(AuthenticationProviderList.java:50) ~[org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.authentication.AuthenticationProviderList.newAuthState(AuthenticationProviderList.java:170) [org.apache.pulsar-pulsar-broker-common-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.broker.service.ServerCnx.handleConnect(ServerCnx.java:754) [org.apache.pulsar-pulsar-broker-2.7.2.jar:2.7.2]\n  at org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:185) [org.apache.pulsar-pulsar-common-2.7.2.jar:2.7.2]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.handler.flow.FlowControlHandler.dequeue(FlowControlHandler.java:200) [io.netty-netty-handler-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.handler.flow.FlowControlHandler.channelRead(FlowControlHandler.java:162) [io.netty-netty-handler-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:324) [io.netty-netty-codec-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:296) [io.netty-netty-codec-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) [io.netty-netty-transport-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:795) [io.netty-netty-transport-native-epoll-4.1.60.Final-linux-x86_64.jar:4.1.60.Final]\n  at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:480) [io.netty-netty-transport-native-epoll-4.1.60.Final-linux-x86_64.jar:4.1.60.Final]\n  at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:378) [io.netty-netty-transport-native-epoll-4.1.60.Final-linux-x86_64.jar:4.1.60.Final]\n  at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:989) [io.netty-netty-common-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) [io.netty-netty-common-4.1.60.Final.jar:4.1.60.Final]\n  at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.60.Final.jar:4.1.60.Final]\n  at java.lang.Thread.run(Thread.java:748) [?:1.8.0_282]\n12:47:47.115 [pulsar-io-23-8] WARN  org.apache.pulsar.broker.service.ServerCnx - [/10.0.4.50:41828] Unable to authenticate: Failed to authentication token: JWT expired at **2021-06-03T10:46:56Z**. Current time: 2021-06-03T10:47:47Z, a difference of 51114 milliseconds.  Allowed clock skew: 0 milliseconds.\n12:47:47.115 [pulsar-io-23-8] INFO  org.apache.pulsar.broker.service.ServerCnx - Closed connection from /10.0.4.50:41828\n\n</code></pre></div>\n<p dir=\"auto\">Notice the time <strong>2021-06-03T10:46:56Z</strong> that is the expiration time of the <strong>second token</strong>. First refresh worked OK as broker did not fail past first 5 minutes. Error occurs on broker at <code class=\"notranslate\">12:47:47.109</code> reporting an expired token at <strong>2021-06-03T10:46:56Z</strong>. However that token had already been refreshed one minute before at <code class=\"notranslate\">2021-06-03 12:45:59.301</code> (local time is CEST or GMT+2):</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2021-06-03 12:45:59.301  INFO 12076 --- [clientInboundChannel-35] k.o.d.a.s.RefreshableCredentialsSupplier : Credentials refreshed: {old: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT56.699S}, new: {clientId: etx, tokenHash: 92730944006c9c39aa8ff5026c7c4090, exp: 2021-06-03T10:50:59Z, life: PT4M59.699S}}\"><pre class=\"notranslate\"><code class=\"notranslate\">2021-06-03 12:45:59.301  INFO 12076 --- [clientInboundChannel-35] k.o.d.a.s.RefreshableCredentialsSupplier : Credentials refreshed: {old: {clientId: etx, tokenHash: 5b90493918766fa0b23fcc63aa93455b, exp: **2021-06-03T10:46:56Z**, life: PT56.699S}, new: {clientId: etx, tokenHash: 92730944006c9c39aa8ff5026c7c4090, exp: 2021-06-03T10:50:59Z, life: PT4M59.699S}}\n</code></pre></div>\n<p dir=\"auto\">After that moment following producers were created at following moments (using <strong>third token</strong>) <code class=\"notranslate\">2021-06-03 12:46:11.809</code>, <code class=\"notranslate\">2021-06-03 12:46:43.532</code>, <code class=\"notranslate\">2021-06-03 12:47:15.302</code>. However at <code class=\"notranslate\">2021-06-03 12:47:38.882</code> client reported connection failed (using <strong>second token</strong>) for error occurring on broker at <code class=\"notranslate\">12:47:47.109</code>.</p>\n<p dir=\"auto\"><strong>Expected behavior</strong></p>\n<p dir=\"auto\"><strong>All previous tokens</strong> belonging to <strong>same client</strong> must be refreshed at proxy connection pool once they are obtained through connections from client.</p>\n<p dir=\"auto\">This is a <strong>blocker issue</strong> that prevents us from using Pulsar Proxy on our clusters.</p>",
                "resourcePath": "/apache/pulsar/issues/10816",
                "createdAt": "2021-06-03T14:53:03Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix tenant admin authorization bug.",
        "url": "https://github.com/apache/pulsar/pull/20068",
        "resourcePath": "/apache/pulsar/pull/20068",
        "createdAt": "2023-04-11T04:35:30Z",
        "number": 20068,
        "mergeCommit": {
          "oid": "fc17c1d98a3c1edd975c131d174a9ef69887d9cd",
          "message": "[fix][broker] Fix tenant admin authorization bug. (#20068)\n\nCo-authored-by: druidliu <druidliu@tencent.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/fc17c1d98a3c1edd975c131d174a9ef69887d9cd",
          "parents": {
            "nodes": [
              {
                "oid": "9b723022436cc1a150af765103e8d343679f92ce",
                "message": "[improve][broker] Make timer execute immediately after load index (#20126)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/AuthorizationService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/auth/AuthorizationTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/AuthorizationProducerConsumerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/websocket/proxy/ProxyAuthorizationTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5N_E312gAoNDRiZjlmZWJiOTc5MjVlZTRmMjkyMDdjMTgwNmNlZmFmYjBmYzA5OA",
                "url": "https://github.com/apache/pulsar/pull/20068/commits/44bf9febb97925ee4f29207c1806cefafb0fc098"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20066,
                "url": "https://github.com/apache/pulsar/issues/20066",
                "title": "[Bug] [broker] Producer and consumer will all be disconnected while using tenant admin to produce/consume",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar 2.9.3</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Set up a pulsar cluster with <code class=\"notranslate\">topicLevelPoliciesEnabled=true</code>.</li>\n<li>Create a namespace <code class=\"notranslate\">t1/n1</code> and set admin role <code class=\"notranslate\">tenant_admin</code> as the admin of tenant <code class=\"notranslate\">t1</code>.</li>\n<li>Create topic <code class=\"notranslate\">t1/n1/t1</code> and use role <code class=\"notranslate\">tenant_admin</code> to produce/consumer this topic. DO NOT GRANT the permissions of <code class=\"notranslate\">tenant_admin</code> to the topic/namespace.</li>\n<li>Update the namespace/topic policy, such as grant another role <code class=\"notranslate\">role1</code> with produce to topic <code class=\"notranslate\">t1/n1/t1</code>.</li>\n<li>We can see the producers/consumers of role <code class=\"notranslate\">tenant_admin</code> will all first disconnect and then reconnect.</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">All producers and consumers should be stable.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The producers/consumers of role <code class=\"notranslate\">tenant_admin</code> will all first disconnect and then reconnect.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">According to the logic in <code class=\"notranslate\">org.apache.pulsar.broker.service.ServerCnx</code>, all permission check will go to <code class=\"notranslate\">org.apache.pulsar.broker.authorization.PulsarAuthorizationProvider#allowTopicOperationAsync</code>, which means the tenant admin should be the super user of all namespace/topic under specific tenant.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20066",
                "createdAt": "2023-04-11T03:45:49Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][build] Upgrade snakeyaml version to 2.0",
        "url": "https://github.com/apache/pulsar/pull/20085",
        "resourcePath": "/apache/pulsar/pull/20085",
        "createdAt": "2023-04-13T02:54:18Z",
        "number": 20085,
        "mergeCommit": {
          "oid": "93fb4f8eb6bd12872f05d7c5ec6c00b719d53009",
          "message": "[improve][build] Upgrade snakeyaml version to 2.0 (#20085)",
          "commitUrl": "https://github.com/apache/pulsar/commit/93fb4f8eb6bd12872f05d7c5ec6c00b719d53009",
          "parents": {
            "nodes": [
              {
                "oid": "b7eab9469177eda2c56e36bb9871aab48a17d4ec",
                "message": "[fix][doc] ConnectorDocGenerator support Java 9+ (#20100)\n\nSigned-off-by: tison <wander4096@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/auth/KubernetesSecretsTokenAuthProvider.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/kubernetes/KubernetesRuntime.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/kubernetes/KubernetesRuntimeFactory.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/test/java/org/apache/pulsar/functions/auth/KubernetesSecretsTokenAuthProviderTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/test/java/org/apache/pulsar/functions/runtime/kubernetes/KubernetesRuntimeFactoryTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/secrets/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/kafka-connect-adaptor/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-sql/presto-distribution/LICENSE"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "src/owasp-dependency-check-suppressions.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5OMFzV2gAoODczMzgzNTQwYmU1Njk5OTI0ZTJlY2E2ZWY1ZGI0MjFhYTYwYjM1ZQ",
                "url": "https://github.com/apache/pulsar/pull/20085/commits/873383540be5699924e2eca6ef5db421aa60b35e"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20013,
                "url": "https://github.com/apache/pulsar/issues/20013",
                "title": "CVE-2022-1471 identified on pulsar client for snakeyaml's SafeConstructor usage mandate",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.10.3</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Run the security scan</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Upgrade the snake yaml to latest version</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Vulnerability identified on client modules .</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20013",
                "createdAt": "2023-04-05T04:09:06Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Harden non-null checker",
        "url": "https://github.com/apache/pulsar/pull/20096",
        "resourcePath": "/apache/pulsar/pull/20096",
        "createdAt": "2023-04-14T03:59:09Z",
        "number": 20096,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5OSWjj2gAoNzgxY2E5MjQ1Nzg1ZTI5NjQ4ZmZmYmUwYmM3NzliZWZjOTE2YmIyNg",
                "url": "https://github.com/apache/pulsar/pull/20096/commits/781ca9245785e29648fffbe0bc779befc916bb26"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 17107,
                "url": "https://github.com/apache/pulsar/issues/17107",
                "title": "NPE when persistPositionToLedger ",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Master branch</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">ReplicatorTest#testReplicatorWithFailedAck</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">No NEP.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"org.apache.bookkeeper.mledger.ManagedLedgerException: java.lang.NullPointerException\nCaused by: java.lang.NullPointerException\n\tat java.util.Objects.requireNonNull(Objects.java:208) ~[?:?]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.persistPositionToLedger(ManagedCursorImpl.java:2814) ~[classes/:?]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.internalMarkDelete(ManagedCursorImpl.java:1968) ~[classes/:?]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.internalAsyncMarkDelete(ManagedCursorImpl.java:1911) ~[classes/:?]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncDelete(ManagedCursorImpl.java:2226) ~[classes/:?]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncDelete(ManagedCursorImpl.java:2030) ~[classes/:?]\n\tat org.apache.pulsar.broker.service.persistent.PersistentReplicator.lambda$deleteFailed$4(PersistentReplicator.java:645) ~[classes/:?]\"><pre class=\"notranslate\"><code class=\"notranslate\">org.apache.bookkeeper.mledger.ManagedLedgerException: java.lang.NullPointerException\nCaused by: java.lang.NullPointerException\n\tat java.util.Objects.requireNonNull(Objects.java:208) ~[?:?]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.persistPositionToLedger(ManagedCursorImpl.java:2814) ~[classes/:?]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.internalMarkDelete(ManagedCursorImpl.java:1968) ~[classes/:?]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.internalAsyncMarkDelete(ManagedCursorImpl.java:1911) ~[classes/:?]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncDelete(ManagedCursorImpl.java:2226) ~[classes/:?]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncDelete(ManagedCursorImpl.java:2030) ~[classes/:?]\n\tat org.apache.pulsar.broker.service.persistent.PersistentReplicator.lambda$deleteFailed$4(PersistentReplicator.java:645) ~[classes/:?]\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/17107",
                "createdAt": "2022-08-16T03:11:28Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][schema] Apply Schema for GenericJsonRecord if present",
        "url": "https://github.com/apache/pulsar/pull/20104",
        "resourcePath": "/apache/pulsar/pull/20104",
        "createdAt": "2023-04-14T10:51:08Z",
        "number": 20104,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericJsonReader.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericJsonRecord.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/JsonRecordBuilderImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5OULzH2gAoNGNiMDg4ZDQ3YzIwMzUxZDdkYzVjMGU3YjJjYjI3Mjc2NGVhMGRhNQ",
                "url": "https://github.com/apache/pulsar/pull/20104/commits/4cb088d47c20351d7dc5c0e7b2cb272764ea0da5"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20092,
                "url": "https://github.com/apache/pulsar/issues/20092",
                "title": "[Bug] Pulsar client AUTO_CONSUME \"double\" as \"BigDecimal\" in JSON schemas",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar client 2.10.3, 2.10.2, 2.10.1. Please note the behavior was correct with 2.8.3 and 2.10.0 and regressed starting with 2.10.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Run the below program to create a topic with a JSON schema that has an optional double field. <strong>Please note the behavior is correct if the field is not optional</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"public static void main(String[] args) throws PulsarClientException {\n        final PulsarClient client = PulsarClient.builder()\n                //.serviceUrl(&quot;pulsar://localhost:65093&quot;)\n                .serviceUrl(&quot;pulsar://localhost:6650&quot;)\n                .build();\n\n        RecordSchemaBuilder schemaBuilder = SchemaBuilder.record(&quot;myrecord&quot;);\n        schemaBuilder.field(&quot;xdouble&quot;).type(SchemaType.DOUBLE).optional();\n        SchemaInfo schemaInfo = schemaBuilder.build(SchemaType.JSON);\n        GenericSchema&lt;GenericRecord&gt; schema = Schema.generic(schemaInfo);\n        GenericRecordBuilder builder = schema.newRecordBuilder();\n        builder.set(&quot;xdouble&quot;, 1.0d);\n        GenericRecord record = builder.build();\n\n        Producer&lt;GenericRecord&gt; producer = client.newProducer(schema)\n                .topic(&quot;persistent://public/default/json-topic3&quot;)\n                .create();\n        producer.send(record);\n\n        Consumer&lt;GenericRecord&gt; consumer = client.newConsumer(Schema.AUTO_CONSUME())\n                .topic(&quot;persistent://public/default/json-topic3&quot;)\n                .subscriptionName(&quot;my-subscription2&quot;)\n                .subscriptionInitialPosition(SubscriptionInitialPosition.Earliest)\n                .subscribe();\n\n        var message = consumer.receive();\n        var value = ((JsonNode)message.getValue().getNativeObject()).get(&quot;xdouble&quot;).numberValue();\n        assertTrue(&quot;expected double, got &quot; + value.getClass() , value instanceof Double);\n        //consumer.acknowledge(message);\n\n        client.close();\n    }\"><pre class=\"notranslate\"><code class=\"notranslate\">public static void main(String[] args) throws PulsarClientException {\n        final PulsarClient client = PulsarClient.builder()\n                //.serviceUrl(\"pulsar://localhost:65093\")\n                .serviceUrl(\"pulsar://localhost:6650\")\n                .build();\n\n        RecordSchemaBuilder schemaBuilder = SchemaBuilder.record(\"myrecord\");\n        schemaBuilder.field(\"xdouble\").type(SchemaType.DOUBLE).optional();\n        SchemaInfo schemaInfo = schemaBuilder.build(SchemaType.JSON);\n        GenericSchema&lt;GenericRecord&gt; schema = Schema.generic(schemaInfo);\n        GenericRecordBuilder builder = schema.newRecordBuilder();\n        builder.set(\"xdouble\", 1.0d);\n        GenericRecord record = builder.build();\n\n        Producer&lt;GenericRecord&gt; producer = client.newProducer(schema)\n                .topic(\"persistent://public/default/json-topic3\")\n                .create();\n        producer.send(record);\n\n        Consumer&lt;GenericRecord&gt; consumer = client.newConsumer(Schema.AUTO_CONSUME())\n                .topic(\"persistent://public/default/json-topic3\")\n                .subscriptionName(\"my-subscription2\")\n                .subscriptionInitialPosition(SubscriptionInitialPosition.Earliest)\n                .subscribe();\n\n        var message = consumer.receive();\n        var value = ((JsonNode)message.getValue().getNativeObject()).get(\"xdouble\").numberValue();\n        assertTrue(\"expected double, got \" + value.getClass() , value instanceof Double);\n        //consumer.acknowledge(message);\n\n        client.close();\n    }\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">The assertion should pass</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Exception in thread &quot;main&quot; java.lang.AssertionError: expected double, got class java.math.BigDecimal\n\tat org.junit.Assert.fail(Assert.java:89)\n\tat org.junit.Assert.assertTrue(Assert.java:42)\n\tat org.example.SimpleConsumer.main(SimpleConsumer.java:63)\"><pre class=\"notranslate\"><code class=\"notranslate\">Exception in thread \"main\" java.lang.AssertionError: expected double, got class java.math.BigDecimal\n\tat org.junit.Assert.fail(Assert.java:89)\n\tat org.junit.Assert.assertTrue(Assert.java:42)\n\tat org.example.SimpleConsumer.main(SimpleConsumer.java:63)\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20092",
                "createdAt": "2023-04-14T01:38:49Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][admin] Add javax.xml.bind:jaxb-api to shade",
        "url": "https://github.com/apache/pulsar/pull/20106",
        "resourcePath": "/apache/pulsar/pull/20106",
        "createdAt": "2023-04-14T17:40:07Z",
        "number": 20106,
        "mergeCommit": {
          "oid": "78cf5a6097fe4b70e51724921ce174bcac919a77",
          "message": "[fix][admin] Add javax.xml.bind:jaxb-api to shade (#20106)\n\nSigned-off-by: nodece <nodeces@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/78cf5a6097fe4b70e51724921ce174bcac919a77",
          "parents": {
            "nodes": [
              {
                "oid": "6c89467c74bf7e4bc7de06ed5e287643819118ca",
                "message": "[improve][fn] Upgrade Kotlin version to1.8.20 (#20114)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin-shaded/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-all/pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5OWVYS2gAoYzMwY2I3MzQwNDk3YzE2M2Q4OTM0OTBlYjI4NDZkOTExNjZiMDBkMw",
                "url": "https://github.com/apache/pulsar/pull/20106/commits/c30cb7340497c163d893490eb2846d91166b00d3"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19856,
                "url": "https://github.com/apache/pulsar/issues/19856",
                "title": "Update jaxb and jax-rs libs",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Is there any plan to update Jaxb and JaxRS libs (from javax.* to jakarta.*)?</p>\n<p dir=\"auto\">When using the Pulsar admin client <code class=\"notranslate\">2.11.0</code> in a modern application that is using the more recent versions of Jaxb and JaxRS, the recent versions are the ones used. This may lead to confusion. The only reason it is working in this case is because the elder<code class=\"notranslate\"> jaxb-api</code> is still carried along that has the old annotations.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">BUMP jakarta.ws.rs:jakarta.ws.rs-api from 2.1.6\tto 3.1.0<br>\nBUMP jakarta.xml.bind:jakarta.xml.bind-api from\t2.3.3 4.0.0<br>\nRemove javax.xml.bind:jaxb-api:2.3.1</p>\n<p dir=\"auto\">Update all code references from javax.* to jakarta.*</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19856",
                "createdAt": "2023-03-19T20:06:20Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][fn] Upgrade Kotlin version from 1.4.32 to 1.8.20. (targeted for master)",
        "url": "https://github.com/apache/pulsar/pull/20114",
        "resourcePath": "/apache/pulsar/pull/20114",
        "createdAt": "2023-04-17T09:10:15Z",
        "number": 20114,
        "mergeCommit": {
          "oid": "6c89467c74bf7e4bc7de06ed5e287643819118ca",
          "message": "[improve][fn] Upgrade Kotlin version to1.8.20 (#20114)",
          "commitUrl": "https://github.com/apache/pulsar/commit/6c89467c74bf7e4bc7de06ed5e287643819118ca",
          "parents": {
            "nodes": [
              {
                "oid": "6cfa4683a44e7cce39fa6cb70e0fe1fb3d5eae56",
                "message": "[improve][broker] Fix ServiceUnitStateCompactionStrategy to cover fast-forward cursor behavior after compaction (#20110)\n\nMaster Issue: https://github.com/apache/pulsar/issues/16691\r\n\r\n### Motivation\r\n\r\nRaising a PR to implement: https://github.com/apache/pulsar/issues/16691\r\n\r\nAfter the compaction, the cursor can fast-forward to the compacted horizon when a large number of messages are compacted before the next read. Hence, ServiceUnitStateCompactionStrategy also needs to cover this case. Currently, the existing and slow(their states are far behind) tableviews with ServiceUnitStateCompactionStrategy could not accept those compacted messages. In the load balance extension context, this means the ownership data could be inconsistent among brokers.\r\n\r\n### Modifications\r\nThis PR \r\n  - fixes ServiceUnitStateCompactionStrategy to accept the state data if its version is bigger than the current version +1.\r\n  - (minor fix) does not repeatedly update the replication_clusters in the policies when creating the system namespace. This update redundantly triggers ZK watchers when restarting brokers.\r\n  -  sets closeWithoutWaitingClientDisconnect=true, upon unload(following the same setting as the modular LM's)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "distribution/server/src/assemble/LICENSE.bin.txt"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5OdFL02gAoYzdmYTZiOTQ2YWYxZWEzMTA1ZTc1MTkzZWFjYTkzYjUyMDg2NWVmMA",
                "url": "https://github.com/apache/pulsar/pull/20114/commits/c7fa6b946af1ea3105e75193eaca93b520865ef0"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20088,
                "url": "https://github.com/apache/pulsar/issues/20088",
                "title": "Upgrade Kotlin version from 1.4.32 to 1.8.20.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">While evaluating Pulsar Functions for our data transformation purposes we ran into an issue where the Kotlin runtime of the function clashed with the runtime provided by Pulsar which is a bit outdated (1.4.32).</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">I propose raising the Kotlin runtime version to 1.8.20 as it seemingly does not break the okio library that is dependent upon such rintime.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20088",
                "createdAt": "2023-04-13T11:53:40Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][fn] Use functions classloader in TopicSchema.newSchemaInstance() to fix ClassNotFoundException when using custom SerDe classes. (targeted for master)",
        "url": "https://github.com/apache/pulsar/pull/20115",
        "resourcePath": "/apache/pulsar/pull/20115",
        "createdAt": "2023-04-17T09:23:41Z",
        "number": 20115,
        "mergeCommit": {
          "oid": "43a989862f548fa3f67708a5fff62eb764af878c",
          "message": "[improve][fn] Use functions classloader in TopicSchema.newSchemaInstance() to fix ClassNotFoundException when using custom SerDe classes. (targeted for master) (#20115)",
          "commitUrl": "https://github.com/apache/pulsar/commit/43a989862f548fa3f67708a5fff62eb764af878c",
          "parents": {
            "nodes": [
              {
                "oid": "d0d626be8f59107d9de624f813dd0d5012cc1311",
                "message": "[improve][cli] Allow pulser-client consume create a replicated subscription (#20316)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/sink/PulsarSink.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/PulsarSource.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/SingleConsumerPulsarSource.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/TopicSchema.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/test/java/org/apache/pulsar/functions/source/TopicSchemaTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarFunctionsTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarFunctionsTestBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/java/PulsarFunctionsJavaTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/java/PulsarWorkerRebalanceDrainTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/utils/CommandGenerator.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5OdJ852gAoMzE1MDM3MGJkZjliY2Y2MDg2NTJiMjQ5Yjk2MmY5ZDE3YmE3MDdjZg",
                "url": "https://github.com/apache/pulsar/pull/20115/commits/3150370bdf9bcf608652b249b962f9d17ba707cf"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 5350,
                "url": "https://github.com/apache/pulsar/issues/5350",
                "title": "Pulsar can't load the customized SerDe",
                "bodyHTML": "<p dir=\"auto\"><strong>Describe the bug</strong></p>\n<p dir=\"auto\">Pulsar couldn't find deployed SerDe class. But it exists in my fat jar</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"12:59:00.903 [t1/n1/JournalBatchParseFunction-0] ERROR org.apache.pulsar.functions.instance.JavaInstanceRunnable - [t1/n1/JournalBatchParseFunction:0] Uncaught exception in Java Instance\njava.lang.RuntimeException: User class must be in class path\n        at org.apache.pulsar.functions.utils.Reflections.createInstance(Reflections.java:67) ~[org.apache.pulsar-pulsar-functions-utils-2.4.1.jar:2.4.1]\n        at org.apache.pulsar.functions.instance.InstanceUtils.createInstance(InstanceUtils.java:84) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\n        at org.apache.pulsar.functions.instance.InstanceUtils.initializeSerDe(InstanceUtils.java:43) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\n        at org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(TopicSchema.java:197) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:2.4.1]\n        at org.apache.pulsar.functions.source.TopicSchema.lambda$getSchema$0(TopicSchema.java:66) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:2.4.1]\n        at java.util.HashMap.computeIfAbsent(HashMap.java:1127) ~[?:1.8.0_212]\n        at org.apache.pulsar.functions.source.TopicSchema.getSchema(TopicSchema.java:66) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:2.4.1]\n        at org.apache.pulsar.functions.sink.PulsarSink.initializeSchema(PulsarSink.java:330) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:2.4.1]\n        at org.apache.pulsar.functions.sink.PulsarSink.open(PulsarSink.java:255) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:2.4.1]\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupOutput(JavaInstanceRunnable.java:769) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupJavaInstance(JavaInstanceRunnable.java:203) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:234) [org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\nCaused by: java.lang.ClassNotFoundException: ru.alfabank.api.utils.JournalBatchSerde\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:382) ~[?:1.8.0_212]\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:424) ~[?:1.8.0_212]\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:357) ~[?:1.8.0_212]\n        at java.lang.Class.forName0(Native Method) ~[?:1.8.0_212]\n        at java.lang.Class.forName(Class.java:348) ~[?:1.8.0_212]\n        at org.apache.pulsar.functions.utils.Reflections.createInstance(Reflections.java:65) ~[org.apache.pulsar-pulsar-functions-utils-2.4.1.jar:2.4.1]\n        ... 12 more\"><pre class=\"notranslate\"><code class=\"notranslate\">12:59:00.903 [t1/n1/JournalBatchParseFunction-0] ERROR org.apache.pulsar.functions.instance.JavaInstanceRunnable - [t1/n1/JournalBatchParseFunction:0] Uncaught exception in Java Instance\njava.lang.RuntimeException: User class must be in class path\n        at org.apache.pulsar.functions.utils.Reflections.createInstance(Reflections.java:67) ~[org.apache.pulsar-pulsar-functions-utils-2.4.1.jar:2.4.1]\n        at org.apache.pulsar.functions.instance.InstanceUtils.createInstance(InstanceUtils.java:84) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\n        at org.apache.pulsar.functions.instance.InstanceUtils.initializeSerDe(InstanceUtils.java:43) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\n        at org.apache.pulsar.functions.source.TopicSchema.newSchemaInstance(TopicSchema.java:197) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:2.4.1]\n        at org.apache.pulsar.functions.source.TopicSchema.lambda$getSchema$0(TopicSchema.java:66) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:2.4.1]\n        at java.util.HashMap.computeIfAbsent(HashMap.java:1127) ~[?:1.8.0_212]\n        at org.apache.pulsar.functions.source.TopicSchema.getSchema(TopicSchema.java:66) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:2.4.1]\n        at org.apache.pulsar.functions.sink.PulsarSink.initializeSchema(PulsarSink.java:330) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:2.4.1]\n        at org.apache.pulsar.functions.sink.PulsarSink.open(PulsarSink.java:255) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:2.4.1]\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupOutput(JavaInstanceRunnable.java:769) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.setupJavaInstance(JavaInstanceRunnable.java:203) ~[org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\n        at org.apache.pulsar.functions.instance.JavaInstanceRunnable.run(JavaInstanceRunnable.java:234) [org.apache.pulsar-pulsar-functions-instance-2.4.1.jar:?]\n        at java.lang.Thread.run(Thread.java:748) [?:1.8.0_212]\nCaused by: java.lang.ClassNotFoundException: ru.alfabank.api.utils.JournalBatchSerde\n        at java.net.URLClassLoader.findClass(URLClassLoader.java:382) ~[?:1.8.0_212]\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:424) ~[?:1.8.0_212]\n        at java.lang.ClassLoader.loadClass(ClassLoader.java:357) ~[?:1.8.0_212]\n        at java.lang.Class.forName0(Native Method) ~[?:1.8.0_212]\n        at java.lang.Class.forName(Class.java:348) ~[?:1.8.0_212]\n        at org.apache.pulsar.functions.utils.Reflections.createInstance(Reflections.java:65) ~[org.apache.pulsar-pulsar-functions-utils-2.4.1.jar:2.4.1]\n        ... 12 more\n</code></pre></div>\n<p dir=\"auto\">The command used to submit the function</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-admin --admin-url http://corpint4:6680 functions create --retain-ordering --jar http://binary/artifactory/libs-release-local/ru/alfabank/api/utils/pulsar-util-function-api-pack/0.10.2/pulsar-util-function-api-pack-0.10.2-all.jar --classname ru.alfabank.api.utils.JournalBatchParseFunction --inputs persistent://t1/n1/queue_1 --output persistent://t1/n1/queue_journal --output-serde-classname ru.alfabank.api.utils.JournalBatchSerde --tenant t1 --namespace n1\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-admin --admin-url http://corpint4:6680 functions create --retain-ordering --jar http://binary/artifactory/libs-release-local/ru/alfabank/api/utils/pulsar-util-function-api-pack/0.10.2/pulsar-util-function-api-pack-0.10.2-all.jar --classname ru.alfabank.api.utils.JournalBatchParseFunction --inputs persistent://t1/n1/queue_1 --output persistent://t1/n1/queue_journal --output-serde-classname ru.alfabank.api.utils.JournalBatchSerde --tenant t1 --namespace n1\n</code></pre></div>",
                "resourcePath": "/apache/pulsar/issues/5350",
                "createdAt": "2019-10-09T19:21:54Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "lifecycle/stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix deadlock in `ExtensibleLoadManagerImplTest.initializeState`",
        "url": "https://github.com/apache/pulsar/pull/20130",
        "resourcePath": "/apache/pulsar/pull/20130",
        "createdAt": "2023-04-18T15:33:02Z",
        "number": 20130,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": []
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Ol9cC2gAoYWVjNDVmNjI3YjJmY2I3MjhjMjU5MjUyZDZjYTA3NjRlZGJhMWYyYg",
                "url": "https://github.com/apache/pulsar/pull/20130/commits/aec45f627b2fcb728c259252d6ca0764edba1f2b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20157,
                "url": "https://github.com/apache/pulsar/issues/20157",
                "title": "Flaky-test: ExtensibleLoadManagerImplTest.initializeState",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4755217144/jobs/8449646027\">https://github.com/apache/pulsar/actions/runs/4755217144/jobs/8449646027</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<p dir=\"auto\">don't know how to find stacktrace.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20157",
                "createdAt": "2023-04-20T15:43:18Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Producer/Consumer should call allowTopicOperationAsync",
        "url": "https://github.com/apache/pulsar/pull/20142",
        "resourcePath": "/apache/pulsar/pull/20142",
        "createdAt": "2023-04-19T16:12:14Z",
        "number": 20142,
        "mergeCommit": {
          "oid": "dc5e497b2a42910146690c6b4e922e0a80bf1587",
          "message": "[fix][broker] Producer/Consumer should call allowTopicOperationAsync (#20142)\n\nFixes: https://github.com/apache/pulsar/issues/20066\r\n\r\n### Motivation\r\n\r\nIn https://github.com/apache/pulsar/pull/20068 we changed the way that the `AuthorizationService` is implemented. I think we should change the `Consumer` and the `Producer` logic to call the correct `AuthorizationService` method.\r\n\r\nGiven that our goal is to deprecate the `AuthorizationService` methods for `canProduce` and `canConsume`, this change helps us move in the right direction.\r\n\r\n### Modifications\r\n\r\n* Update `Producer` and `Consumer` in broker to call the `AuthorizationService#allowTopicOperationAsync` method.\r\n\r\n### Verifying this change\r\n\r\nThis change is trivial.\r\n\r\n### Documentation\r\n\r\n- [x] `doc-not-needed`\r\n\r\n### Matching PR in forked repository\r\n\r\nPR in forked repository: Skipping PR as I ran tests locally.",
          "commitUrl": "https://github.com/apache/pulsar/commit/dc5e497b2a42910146690c6b4e922e0a80bf1587",
          "parents": {
            "nodes": [
              {
                "oid": "d3fa998aa7c0a7a9452079ef2ff05bccf6b273cf",
                "message": "[improve][broker] Cache LedgerHandle in BookkeeperBucketSnapshotStorage (#20117)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Consumer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Producer.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5OsHaQ2gAoZjc1NzQxOWZkMmY5N2Q2YjRjM2RiMDhiZTYzNDIwNWVlZjRjOTQ1ZA",
                "url": "https://github.com/apache/pulsar/pull/20142/commits/f757419fd2f97d6b4c3db08be634205eef4c945d"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20066,
                "url": "https://github.com/apache/pulsar/issues/20066",
                "title": "[Bug] [broker] Producer and consumer will all be disconnected while using tenant admin to produce/consume",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar 2.9.3</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Set up a pulsar cluster with <code class=\"notranslate\">topicLevelPoliciesEnabled=true</code>.</li>\n<li>Create a namespace <code class=\"notranslate\">t1/n1</code> and set admin role <code class=\"notranslate\">tenant_admin</code> as the admin of tenant <code class=\"notranslate\">t1</code>.</li>\n<li>Create topic <code class=\"notranslate\">t1/n1/t1</code> and use role <code class=\"notranslate\">tenant_admin</code> to produce/consumer this topic. DO NOT GRANT the permissions of <code class=\"notranslate\">tenant_admin</code> to the topic/namespace.</li>\n<li>Update the namespace/topic policy, such as grant another role <code class=\"notranslate\">role1</code> with produce to topic <code class=\"notranslate\">t1/n1/t1</code>.</li>\n<li>We can see the producers/consumers of role <code class=\"notranslate\">tenant_admin</code> will all first disconnect and then reconnect.</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">All producers and consumers should be stable.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The producers/consumers of role <code class=\"notranslate\">tenant_admin</code> will all first disconnect and then reconnect.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">According to the logic in <code class=\"notranslate\">org.apache.pulsar.broker.service.ServerCnx</code>, all permission check will go to <code class=\"notranslate\">org.apache.pulsar.broker.authorization.PulsarAuthorizationProvider#allowTopicOperationAsync</code>, which means the tenant admin should be the super user of all namespace/topic under specific tenant.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20066",
                "createdAt": "2023-04-11T03:45:49Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Move superuser/tenantAdmin checks to AuthorizationService from PulsarAuthorizationProvider",
        "url": "https://github.com/apache/pulsar/pull/20145",
        "resourcePath": "/apache/pulsar/pull/20145",
        "createdAt": "2023-04-19T19:29:31Z",
        "number": 20145,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/AuthorizationService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/PulsarAuthorizationProvider.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5OtCrX2gAoZjI3ZjM4YjQ1YWIzZWQxNDIwYjkyOTFiMjg4MThjNmE4MDAxMzViNw",
                "url": "https://github.com/apache/pulsar/pull/20145/commits/f27f38b45ab3ed1420b9291b28818c6a800135b7"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20066,
                "url": "https://github.com/apache/pulsar/issues/20066",
                "title": "[Bug] [broker] Producer and consumer will all be disconnected while using tenant admin to produce/consume",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar 2.9.3</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Set up a pulsar cluster with <code class=\"notranslate\">topicLevelPoliciesEnabled=true</code>.</li>\n<li>Create a namespace <code class=\"notranslate\">t1/n1</code> and set admin role <code class=\"notranslate\">tenant_admin</code> as the admin of tenant <code class=\"notranslate\">t1</code>.</li>\n<li>Create topic <code class=\"notranslate\">t1/n1/t1</code> and use role <code class=\"notranslate\">tenant_admin</code> to produce/consumer this topic. DO NOT GRANT the permissions of <code class=\"notranslate\">tenant_admin</code> to the topic/namespace.</li>\n<li>Update the namespace/topic policy, such as grant another role <code class=\"notranslate\">role1</code> with produce to topic <code class=\"notranslate\">t1/n1/t1</code>.</li>\n<li>We can see the producers/consumers of role <code class=\"notranslate\">tenant_admin</code> will all first disconnect and then reconnect.</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">All producers and consumers should be stable.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The producers/consumers of role <code class=\"notranslate\">tenant_admin</code> will all first disconnect and then reconnect.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">According to the logic in <code class=\"notranslate\">org.apache.pulsar.broker.service.ServerCnx</code>, all permission check will go to <code class=\"notranslate\">org.apache.pulsar.broker.authorization.PulsarAuthorizationProvider#allowTopicOperationAsync</code>, which means the tenant admin should be the super user of all namespace/topic under specific tenant.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20066",
                "createdAt": "2023-04-11T03:45:49Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][bk] Add integration test with bookie http server enabled",
        "url": "https://github.com/apache/pulsar/pull/20149",
        "resourcePath": "/apache/pulsar/pull/20149",
        "createdAt": "2023-04-20T07:08:21Z",
        "number": 20149,
        "mergeCommit": {
          "oid": "3f2978d32223d61f04db1de330f5b167a63925ae",
          "message": "[improve][bk] Add integration test with bookie http server enabled (#20149)\n\nSigned-off-by: tison <wander4096@gmail.com>\r\nCo-authored-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/3f2978d32223d61f04db1de330f5b167a63925ae",
          "parents": {
            "nodes": [
              {
                "oid": "05e57dd3a443c5b99c21054c56a1b497455fa867",
                "message": "[fix][fn] Fix JavaInstanceStarter inferring type class name error (#19896)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/bookkeeper/BookkeeperInstallWithHttpServerEnabledTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/topologies/PulsarCluster.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/topologies/PulsarClusterSpec.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/topologies/PulsarClusterTestBase.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5OvKBQ2gAoYTkyYzBkZmI5OTZmMTQxZjQxYmNlNjFiNzdmZmJiYWY0MDE2MzhhMA",
                "url": "https://github.com/apache/pulsar/pull/20149/commits/a92c0dfb996f141f41bce61b77ffbbaf401638a0"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20071,
                "url": "https://github.com/apache/pulsar/issues/20071",
                "title": "CI: pulsar does not run tests with httpServer enabled",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Problem found in private tests, hot-fixed <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1663284043\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20070\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20070/hovercard\" href=\"https://github.com/apache/pulsar/pull/20070\">#20070</a> (which does not add proper tests)</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">some of the e2e integration tests should enable httpServer, possibly other options to provide better coverage</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20071",
                "createdAt": "2023-04-11T22:13:32Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [broker] Make `LeastResourceUsageWithWeight` thread safe",
        "url": "https://github.com/apache/pulsar/pull/20159",
        "resourcePath": "/apache/pulsar/pull/20159",
        "createdAt": "2023-04-20T16:31:45Z",
        "number": 20159,
        "mergeCommit": {
          "oid": "963260abfa142b8cf9ffe372d85d470a78c17235",
          "message": "[fix] [broker] Make `LeastResourceUsageWithWeight` thread safe (#20159)\n\nFix #20160\r\n\r\n### Motivation\r\nLeastResourceUsageWithWeight is an stateful object and current code will be accessed by multithread.\r\nthread 1: is execute https://github.com/apache/pulsar/blob/2b41e4eafb1cba0e548dd90df60e8cdbb24cd490/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/strategy/LeastResourceUsageWithWeight.java#L89-L91\r\nand thread 2: is execute https://github.com/apache/pulsar/blob/2b41e4eafb1cba0e548dd90df60e8cdbb24cd490/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/strategy/LeastResourceUsageWithWeight.java#L147-L150\r\nso an IndexOutOfBound occurs.\r\n\r\n### Modifications\r\n\r\nchange the state to `ThreadLocal`",
          "commitUrl": "https://github.com/apache/pulsar/commit/963260abfa142b8cf9ffe372d85d470a78c17235",
          "parents": {
            "nodes": [
              {
                "oid": "d3158bfebf9565ea9422a9116749628648e9f90d",
                "message": "[fix][broker] Fix getPartitionedStats miss subscription's messageAckRate (#19870)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/strategy/LeastResourceUsageWithWeight.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5OyRZW2gAoMWM5MDY1YWMwMjhjY2RhNDVjYTI2ZDY4OTQ3ODAzNmY5YmUwOWMyOA",
                "url": "https://github.com/apache/pulsar/pull/20159/commits/1c9065ac028ccda45ca26d689478036f9be09c28"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20160,
                "url": "https://github.com/apache/pulsar/issues/20160",
                "title": "[Bug] Unload namespace throw Exception when enable ExtensibleLoadManager",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master code</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">standalone</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"loadManagerClassName=org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl\nloadBalancerEnabled=true\"><pre class=\"notranslate\">loadManagerClassName=org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl\nloadBalancerEnabled=true</pre></div>\n<ol dir=\"auto\">\n<li>create one namespace with as much as posible bundles</li>\n<li>trigger namespace unload by admin-cli many times.</li>\n<li>maybe you can see one exception like  <code class=\"notranslate\">java.lang.IndexOutOfBoundsException: Index 0 out of bounds for length 0</code></li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">no exception</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Reason:\n --- An unexpected error occurred in the server ---\n\nMessage: Index 0 out of bounds for length 0\n\nStacktrace:\n\njava.lang.IndexOutOfBoundsException: Index 0 out of bounds for length 0\n\tat java.base/jdk.internal.util.Preconditions.outOfBounds(Preconditions.java:64)\n\tat java.base/jdk.internal.util.Preconditions.outOfBoundsCheckIndex(Preconditions.java:70)\n\tat java.base/jdk.internal.util.Preconditions.checkIndex(Preconditions.java:266)\n\tat java.base/java.util.Objects.checkIndex(Objects.java:359)\n\tat java.base/java.util.ArrayList.get(ArrayList.java:427)\n\tat org.apache.pulsar.broker.loadbalance.extensions.strategy.LeastResourceUsageWithWeight.select(LeastResourceUsageWithWeight.java:149)\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl.lambda$selectAsync$12(ExtensibleLoadManagerImpl.java:409)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2309)\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl.selectAsync(ExtensibleLoadManagerImpl.java:385)\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl.lambda$assign$6(ExtensibleLoadManagerImpl.java:336)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2309)\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl.lambda$assign$10(ExtensibleLoadManagerImpl.java:333)\n\tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.put(ConcurrentOpenHashMap.java:409)\n\tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.computeIfAbsent(ConcurrentOpenHashMap.java:243)\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl.assign(ExtensibleLoadManagerImpl.java:327)\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerWrapper.findBrokerServiceUrl(ExtensibleLoadManagerWrapper.java:66)\n\tat org.apache.pulsar.broker.namespace.NamespaceService.lambda$internalGetWebServiceUrl$9(NamespaceService.java:302)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2309)\n\tat org.apache.pulsar.broker.namespace.NamespaceService.internalGetWebServiceUrl(NamespaceService.java:285)\n\tat org.apache.pulsar.broker.namespace.NamespaceService.getWebServiceUrlAsync(NamespaceService.java:265)\n\tat org.apache.pulsar.broker.web.PulsarWebResource.isBundleOwnedByAnyBroker(PulsarWebResource.java:614)\n\tat org.apache.pulsar.broker.admin.impl.NamespacesBase.lambda$internalUnloadNamespaceBundleAsync$125(NamespacesBase.java:1047)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2309)\n\tat org.apache.pulsar.broker.admin.impl.NamespacesBase.internalUnloadNamespaceBundleAsync(NamespacesBase.java:1046)\n\tat org.apache.pulsar.broker.admin.v2.Namespaces.unloadNamespaceBundle(Namespaces.java:811)\n\"><pre class=\"notranslate\">Reason:\n --- An unexpected error occurred <span class=\"pl-k\">in</span> the server ---\n\nMessage: Index 0 out of bounds <span class=\"pl-k\">for</span> length 0\n\nStacktrace:\n\njava.lang.IndexOutOfBoundsException: Index 0 out of bounds <span class=\"pl-k\">for</span> length 0\n\tat java.base/jdk.internal.util.Preconditions.outOfBounds(Preconditions.java:64)\n\tat java.base/jdk.internal.util.Preconditions.outOfBoundsCheckIndex(Preconditions.java:70)\n\tat java.base/jdk.internal.util.Preconditions.checkIndex(Preconditions.java:266)\n\tat java.base/java.util.Objects.checkIndex(Objects.java:359)\n\tat java.base/java.util.ArrayList.get(ArrayList.java:427)\n\tat org.apache.pulsar.broker.loadbalance.extensions.strategy.LeastResourceUsageWithWeight.select(LeastResourceUsageWithWeight.java:149)\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl.lambda<span class=\"pl-smi\">$selectAsync</span><span class=\"pl-smi\">$1</span>2(ExtensibleLoadManagerImpl.java:409)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2309)\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl.selectAsync(ExtensibleLoadManagerImpl.java:385)\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl.lambda<span class=\"pl-smi\">$assign</span><span class=\"pl-smi\">$6</span>(ExtensibleLoadManagerImpl.java:336)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2309)\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl.lambda<span class=\"pl-smi\">$assign</span><span class=\"pl-smi\">$1</span>0(ExtensibleLoadManagerImpl.java:333)\n\tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap<span class=\"pl-smi\">$Section</span>.put(ConcurrentOpenHashMap.java:409)\n\tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.computeIfAbsent(ConcurrentOpenHashMap.java:243)\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl.assign(ExtensibleLoadManagerImpl.java:327)\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerWrapper.findBrokerServiceUrl(ExtensibleLoadManagerWrapper.java:66)\n\tat org.apache.pulsar.broker.namespace.NamespaceService.lambda<span class=\"pl-smi\">$internalGetWebServiceUrl</span><span class=\"pl-smi\">$9</span>(NamespaceService.java:302)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2309)\n\tat org.apache.pulsar.broker.namespace.NamespaceService.internalGetWebServiceUrl(NamespaceService.java:285)\n\tat org.apache.pulsar.broker.namespace.NamespaceService.getWebServiceUrlAsync(NamespaceService.java:265)\n\tat org.apache.pulsar.broker.web.PulsarWebResource.isBundleOwnedByAnyBroker(PulsarWebResource.java:614)\n\tat org.apache.pulsar.broker.admin.impl.NamespacesBase.lambda<span class=\"pl-smi\">$internalUnloadNamespaceBundleAsync</span><span class=\"pl-smi\">$1</span>25(NamespacesBase.java:1047)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2309)\n\tat org.apache.pulsar.broker.admin.impl.NamespacesBase.internalUnloadNamespaceBundleAsync(NamespacesBase.java:1046)\n\tat org.apache.pulsar.broker.admin.v2.Namespaces.unloadNamespaceBundle(Namespaces.java:811)\n</pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20160",
                "createdAt": "2023-04-20T16:35:33Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Make python install dependencies from requirements.txt",
        "url": "https://github.com/apache/pulsar/pull/20174",
        "resourcePath": "/apache/pulsar/pull/20174",
        "createdAt": "2023-04-24T09:31:41Z",
        "number": 20174,
        "mergeCommit": {
          "oid": "187e0cf5708b358b844a8b3575ae6e350a39238b",
          "message": "[fix][fn] Make python install dependencies from requirements.txt (#20174)\n\nCo-authored-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/187e0cf5708b358b844a8b3575ae6e350a39238b",
          "parents": {
            "nodes": [
              {
                "oid": "1b2a9915c461c4357eb34d14c509963fb6cb47cd",
                "message": "[improve][client] Add `REAL_SUBSCRIPTION` when produces msg to DLQ (#21369)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/python/python_instance_main.py"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5O-vGC2gAoMjRkOWIxOWQxMjQ3MjMxMmMwODRjNDFmYmNlOTBmYjI1ZTJlMmM3Mw",
                "url": "https://github.com/apache/pulsar/pull/20174/commits/24d9b19d12472312c084c41fbce90fb25e2e2c73"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20173,
                "url": "https://github.com/apache/pulsar/issues/20173",
                "title": "[Bug] Python instance doesn't install dependency from requirements.txt",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master, commit id: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/apache/pulsar/commit/35e9897742b7db4bd29349940075a819b2ad6999/hovercard\" href=\"https://github.com/apache/pulsar/commit/35e9897742b7db4bd29349940075a819b2ad6999\"><tt>35e9897</tt></a></p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>package a python function in zip:</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"\u276f tree func\nfunc\n\u251c\u2500\u2500 requirements.txt\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 exclamation.py\n\n\u276f cat func/requirements.txt\nrequests==2.28.2\n\n\u276f cat func/src/exclamation.py\nimport requests # just check dependencies is installed\n\ndef process(input):\n  return str(input) + '!'\n\n\u276f zip -r func.zip func\nupdating: func/ (stored 0%)\nupdating: func/requirements.txt (stored 0%)\nupdating: func/src/ (stored 0%)\nupdating: func/src/exclamation.py (deflated 16%)\"><pre class=\"notranslate\"><code class=\"notranslate\">\u276f tree func\nfunc\n\u251c\u2500\u2500 requirements.txt\n\u2514\u2500\u2500 src\n    \u2514\u2500\u2500 exclamation.py\n\n\u276f cat func/requirements.txt\nrequests==2.28.2\n\n\u276f cat func/src/exclamation.py\nimport requests # just check dependencies is installed\n\ndef process(input):\n  return str(input) + '!'\n\n\u276f zip -r func.zip func\nupdating: func/ (stored 0%)\nupdating: func/requirements.txt (stored 0%)\nupdating: func/src/ (stored 0%)\nupdating: func/src/exclamation.py (deflated 16%)\n</code></pre></div>\n<ol start=\"2\" dir=\"auto\">\n<li>create some required dir and file:</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"mkdir -p /pulsar/conf/python-log/ logs/functions &amp;&amp; echo &quot;[loggers]\n      keys=root\n\n      [handlers]\n      keys=stream_handler\n\n      [formatters]\n      keys=formatter\n\n      [logger_root]\n      level=INFO\n      handlers=stream_handler\n\n      [handler_stream_handler]\n      class=StreamHandler\n      level=INFO\n      formatter=formatter\n      args=(sys.stdout,)\n\n      [formatter_formatter]\n      format=[%(asctime)s] [%(levelname)s] %(filename)s: %(message)s\n      datefmt=%Y-%m-%d %H:%M:%S %z&quot; &gt; /pulsar/conf/python-log/python_instance_logging.ini\"><pre class=\"notranslate\"><code class=\"notranslate\">mkdir -p /pulsar/conf/python-log/ logs/functions &amp;&amp; echo \"[loggers]\n      keys=root\n\n      [handlers]\n      keys=stream_handler\n\n      [formatters]\n      keys=formatter\n\n      [logger_root]\n      level=INFO\n      handlers=stream_handler\n\n      [handler_stream_handler]\n      class=StreamHandler\n      level=INFO\n      formatter=formatter\n      args=(sys.stdout,)\n\n      [formatter_formatter]\n      format=[%(asctime)s] [%(levelname)s] %(filename)s: %(message)s\n      datefmt=%Y-%m-%d %H:%M:%S %z\" &gt; /pulsar/conf/python-log/python_instance_logging.ini\n</code></pre></div>\n<ol start=\"3\" dir=\"auto\">\n<li>run python instance directly</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"python /pulsar/instances/python-instance/python_instance_main.py --py /pulsar/download/pulsar_functions/func.zip --logging_directory logs/functions --logging_file exclamation-py-9e1f170e-0 --logging_config_file /pulsar/conf/python-log/python_instance_logging.ini --install_usercode_dependencies true --instance_id 0 --function_id 0-74a988f8-6711-4a9c-9030-a07a54eb2fc4 --function_version 0 --function_details '{&quot;tenant&quot;:&quot;public&quot;,&quot;namespace&quot;:&quot;default&quot;,&quot;name&quot;:&quot;exclamation-py-9e1f170e&quot;,&quot;className&quot;:&quot;exclamation&quot;,&quot;userConfig&quot;:&quot;{}&quot;,&quot;runtime&quot;:&quot;PYTHON&quot;,&quot;autoAck&quot;:true,&quot;parallelism&quot;:1,&quot;source&quot;:{&quot;typeClassName&quot;:&quot;[B&quot;,&quot;inputSpecs&quot;:{&quot;persistent://public/default/test-py-input&quot;:{}},&quot;cleanupSubscription&quot;:true},&quot;sink&quot;:{&quot;typeClassName&quot;:&quot;[B&quot;,&quot;topic&quot;:&quot;persistent://public/default/test-py-output&quot;,&quot;producerSpec&quot;:{},&quot;forwardSourceMessageProperty&quot;:true},&quot;resources&quot;:{&quot;cpu&quot;:1,&quot;ram&quot;:&quot;1073741824&quot;},&quot;componentType&quot;:&quot;FUNCTION&quot;}' --pulsar_serviceurl pulsar://localhost:6650 --max_buffered_tuples 100 --port 39093 --metrics_port 39094 --expected_healthcheck_interval -1 --cluster_name sn-platform-pulsar --use_tls false\"><pre class=\"notranslate\"><code class=\"notranslate\">python /pulsar/instances/python-instance/python_instance_main.py --py /pulsar/download/pulsar_functions/func.zip --logging_directory logs/functions --logging_file exclamation-py-9e1f170e-0 --logging_config_file /pulsar/conf/python-log/python_instance_logging.ini --install_usercode_dependencies true --instance_id 0 --function_id 0-74a988f8-6711-4a9c-9030-a07a54eb2fc4 --function_version 0 --function_details '{\"tenant\":\"public\",\"namespace\":\"default\",\"name\":\"exclamation-py-9e1f170e\",\"className\":\"exclamation\",\"userConfig\":\"{}\",\"runtime\":\"PYTHON\",\"autoAck\":true,\"parallelism\":1,\"source\":{\"typeClassName\":\"[B\",\"inputSpecs\":{\"persistent://public/default/test-py-input\":{}},\"cleanupSubscription\":true},\"sink\":{\"typeClassName\":\"[B\",\"topic\":\"persistent://public/default/test-py-output\",\"producerSpec\":{},\"forwardSourceMessageProperty\":true},\"resources\":{\"cpu\":1,\"ram\":\"1073741824\"},\"componentType\":\"FUNCTION\"}' --pulsar_serviceurl pulsar://localhost:6650 --max_buffered_tuples 100 --port 39093 --metrics_port 39094 --expected_healthcheck_interval -1 --cluster_name sn-platform-pulsar --use_tls false\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">python instance run successfully</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">[2023-04-24 09:25:45 +0000] [INFO] util.py: Failed to import class exclamation from path download/pulsar_functions<br>\n[2023-04-24 09:25:45 +0000] [INFO] util.py: No module named 'requests'<br>\nTraceback (most recent call last):<br>\nFile \"/pulsar/instances/python-instance/util.py\", line 40, in import_class<br>\nreturn import_class_from_path(from_path, full_class_name)<br>\nFile \"/pulsar/instances/python-instance/util.py\", line 60, in import_class_from_path<br>\nmod = importlib.import_module(class_name)<br>\nFile \"/usr/lib/python3.8/importlib/<strong>init</strong>.py\", line 127, in import_module<br>\nreturn _bootstrap._gcd_import(name[level:], package, level)<br>\nFile \"\", line 1014, in _gcd_import<br>\nFile \"\", line 991, in _find_and_load<br>\nFile \"\", line 975, in _find_and_load_unlocked<br>\nFile \"\", line 671, in _load_unlocked<br>\nFile \"\", line 848, in exec_module<br>\nFile \"\", line 219, in _call_with_frames_removed<br>\nFile \"/pulsar/download/pulsar_functions/exclamation/src/exclamation.py\", line 1, in <br>\nimport requests # just check dependencies is installed<br>\nModuleNotFoundError: No module named 'requests'</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20173",
                "createdAt": "2023-04-24T09:26:57Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] SchemaDefinition handle JSR310_CONVERSION_ENABLED property",
        "url": "https://github.com/apache/pulsar/pull/20201",
        "resourcePath": "/apache/pulsar/pull/20201",
        "createdAt": "2023-04-29T11:32:01Z",
        "number": 20201,
        "mergeCommit": {
          "oid": "a22700df665a9ea0a8db98334b6d4337e5e490f3",
          "message": "[fix][client] SchemaDefinition handle JSR310_CONVERSION_ENABLED property (#20201)\n\nSigned-off-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/a22700df665a9ea0a8db98334b6d4337e5e490f3",
          "parents": {
            "nodes": [
              {
                "oid": "e8d63952a40b79499eb3fd524f80db6bc986ed34",
                "message": "[fix][docs] Remove old template inlined (#20208)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/KeyValueSchemaTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/TopicSchema.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5PcAMi2gAoZDE0ZDkwMzA3NTVjZjg0ZmIyOTY4ZjYyOWJkNDMyYmU4YmRkY2QzZA",
                "url": "https://github.com/apache/pulsar/pull/20201/commits/d14d9030755cf84fb2968f629bd432be8bddcd3d"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20093,
                "url": "https://github.com/apache/pulsar/issues/20093",
                "title": "[BUG] Use correct property when determine if jsr310 enabled",
                "bodyHTML": "<p dir=\"auto\">It looks like this issue remains unfixed <a href=\"https://github.com/apache/pulsar/blob/master/pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/SchemaDefinitionBuilderImpl.java#L132\">in master</a>.</p>\n<p dir=\"auto\"><em>Originally posted by <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/dhermanson/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/dhermanson\">@dhermanson</a> in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1029811728\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/12411\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/12411/hovercard?comment_id=1507691633&amp;comment_type=issue_comment\" href=\"https://github.com/apache/pulsar/pull/12411#issuecomment-1507691633\">#12411 (comment)</a></em></p>\n<p dir=\"auto\">When defining a schema using the SchemaDefinitionBuilderImpl, the code was inspecting the incorrect property to determine whether JSR310 should be enabled. This commit changes the builder to inspect the correct property when making this JSR310 enablement determination.</p>",
                "resourcePath": "/apache/pulsar/issues/20093",
                "createdAt": "2023-04-14T02:35:31Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "area/schema"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix Return value of getPartitionedStats doesn't contain subscription type",
        "url": "https://github.com/apache/pulsar/pull/20209",
        "resourcePath": "/apache/pulsar/pull/20209",
        "createdAt": "2023-04-30T17:07:39Z",
        "number": 20209,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/policies/data/stats/SubscriptionStatsImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5PdZIM2gAoYmEwOTI1MzkxYTVlYmY2NDhkZDJiMzgzNDhjY2YwZTQ5OWRkYzljNQ",
                "url": "https://github.com/apache/pulsar/pull/20209/commits/ba0925391a5ebf648dd2b38348ccf0e499ddc9c5"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19970,
                "url": "https://github.com/apache/pulsar/issues/19970",
                "title": "[Bug] Return value of getPartitionedStats doesn't contain subscription type",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar version - 2.10.3<br>\nOS - Ubuntu Linux</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">I am using Pulsar admin client's Java version and creates only partitioned topics. I have created subscriptions also using Java admin api client. In order to get all the details of the topic, I am using PartitionedStats (getTopics().getPartitionedStats()). The subscription section in the response doesn't return \"type\". Subscription type is returned only for TopicStats (getTopics().getStats()). I would like to get all details using PartitionedStats instead of adding a call for TopicStats.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Subscription type returned in getTopics().getPartitionedStats() call.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Subscription type is not returned in getTopics().getPartitionedStats() call.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19970",
                "createdAt": "2023-03-30T14:56:25Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "help wanted"
                      }
                    },
                    {
                      "node": {
                        "name": "good first issue"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix Return value of getPartitionedStats doesn't contain subscription type",
        "url": "https://github.com/apache/pulsar/pull/20210",
        "resourcePath": "/apache/pulsar/pull/20210",
        "createdAt": "2023-04-30T18:06:01Z",
        "number": 20210,
        "mergeCommit": {
          "oid": "4ac117ffc86111e7c38ddadbf933c8be0749f507",
          "message": "[fix][broker] Fix Return value of getPartitionedStats doesn't contain subscription type (#20210)",
          "commitUrl": "https://github.com/apache/pulsar/commit/4ac117ffc86111e7c38ddadbf933c8be0749f507",
          "parents": {
            "nodes": [
              {
                "oid": "0dd238abf3798ba1f5b83182c1c4fb36e6ba6511",
                "message": "[cleanup][build] Bumped version to 3.1.0-SNAPSHOT (#20216)\n\nSigned-off-by: Zike Yang <zike@apache.org>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/policies/data/stats/SubscriptionStatsImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5PddOf2gAoMzkwMTI5MGNjN2UwNGVjZDY4NWNkNWJkMDZlNDRiNDlmYWExZTJlMQ",
                "url": "https://github.com/apache/pulsar/pull/20210/commits/3901290cc7e04ecd685cd5bd06e44b49faa1e2e1"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19970,
                "url": "https://github.com/apache/pulsar/issues/19970",
                "title": "[Bug] Return value of getPartitionedStats doesn't contain subscription type",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar version - 2.10.3<br>\nOS - Ubuntu Linux</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">I am using Pulsar admin client's Java version and creates only partitioned topics. I have created subscriptions also using Java admin api client. In order to get all the details of the topic, I am using PartitionedStats (getTopics().getPartitionedStats()). The subscription section in the response doesn't return \"type\". Subscription type is returned only for TopicStats (getTopics().getStats()). I would like to get all details using PartitionedStats instead of adding a call for TopicStats.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Subscription type returned in getTopics().getPartitionedStats() call.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Subscription type is not returned in getTopics().getPartitionedStats() call.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19970",
                "createdAt": "2023-03-30T14:56:25Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "help wanted"
                      }
                    },
                    {
                      "node": {
                        "name": "good first issue"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][sec] Update dependencies to use snakeyaml 2.0",
        "url": "https://github.com/apache/pulsar/pull/20222",
        "resourcePath": "/apache/pulsar/pull/20222",
        "createdAt": "2023-05-04T17:52:45Z",
        "number": 20222,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "distribution/server/src/assemble/LICENSE.bin.txt"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "distribution/shell/src/assemble/LICENSE.bin.txt"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/conf/ClientConfigurationDataTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/conf/ConsumerConfigurationDataTest.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/conf/ProducerConfigurationDataTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/schema/SchemaInfoTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/FieldParser.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-sql/presto-distribution/LICENSE"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5PzR2j2gAoNTUyNzk5NjI0ODg1ZDJkMDY0ZjliMmJmNjNiNDgzYzcyM2YxNWRmOQ",
                "url": "https://github.com/apache/pulsar/pull/20222/commits/552799624885d2d064f9b2bf63b483c723f15df9"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20224,
                "url": "https://github.com/apache/pulsar/issues/20224",
                "title": "[Security] Pulsar client uses snakeyaml version and dependent on it libraries that have CVE-2022-1471",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Snakeyaml v1.32 used in jackson.dataformat.yaml, prometheus and direct pulsar dependencies has a security vulnerability described in <a href=\"https://avd.aquasec.com/nvd/cve-2022-1471\" rel=\"nofollow\">https://avd.aquasec.com/nvd/cve-2022-1471</a></p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Update prometheus to 0.18.0, jackson libs to 2.15.0 and snakeyaml to 2.0</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20224",
                "createdAt": "2023-05-04T18:18:55Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix the behavior of delayed message in Key_Shared mode",
        "url": "https://github.com/apache/pulsar/pull/20233",
        "resourcePath": "/apache/pulsar/pull/20233",
        "createdAt": "2023-05-05T18:14:00Z",
        "number": 20233,
        "mergeCommit": {
          "oid": "00f17e88ad8fa9a4ead78d78a181c03fdee8e4df",
          "message": "[fix][broker] Fix the behavior of delayed message in Key_Shared mode (#20233)",
          "commitUrl": "https://github.com/apache/pulsar/commit/00f17e88ad8fa9a4ead78d78a181c03fdee8e4df",
          "parents": {
            "nodes": [
              {
                "oid": "03dc3db0a6357dcde294e55c1933bd13275f3f73",
                "message": "[feat][ws] Use async auth method to support OIDC (#20238)\n\nFixes #20236 \r\nPIP: #19409 \r\n\r\n### Motivation\r\n\r\nIn the `AuthenticationService`, we are currently using the deprecated `authenticate` methods. As a result, we hit the `Not Implemented` exception when using the `AuthenticationProviderOpenID`. This PR updates the implementation so that we're able \r\n\r\nThis solution isn't ideal for two reasons.\r\n\r\n1. We are not using the `authenticationHttpRequest` method, which seems like the right method for the WebSocket proxy. However, this is not a viable option, as I documented in #20237.\r\n2. We are calling `.get()` on a future. However, it is expected that the `AuthenticationProvider` not block forever, so I think this is acceptable for now. Please let me know if you disagree.\r\n\r\n### Modifications\r\n\r\n* Replace `authenticate` with `authenticateAsync`.\r\n\r\n### Verifying this change\r\n\r\nThis change is a trivial rework / code cleanup without any test coverage.\r\n\r\n### Documentation\r\n\r\n- [x] `doc-not-needed`\r\n\r\nNote that I do have documentation showing that 3.0.x does not support OIDC in the WebSocket Proxy. The `next` docs don't need that limitation since this PR fixes that and targets 3.1.0. https://github.com/apache/pulsar-site/pull/558\r\n\r\n### Matching PR in forked repository\r\n\r\nPR in forked repository: skipping for this trivial PR"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentDispatcherMultipleConsumers.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/KeySharedSubscriptionTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5P4kRq2gAoZjQwNDBkMGJjYzFiNzVlYzkyYTBkODM4Y2RhNDU5MmFiMjJmZTA0ZA",
                "url": "https://github.com/apache/pulsar/pull/20233/commits/f4040d0bcc1b75ec92a0d838cda4592ab22fe04d"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 8703,
                "url": "https://github.com/apache/pulsar/issues/8703",
                "title": "Delayed messages + Key_Shared causes blocked consumers",
                "bodyHTML": "<p dir=\"auto\"><strong>Describe the bug</strong></p>\n<p dir=\"auto\">When combining Key_Shared subscriptions and delayed messages, consumers fail to receive messages.</p>\n<p dir=\"auto\"><strong>To Reproduce</strong></p>\n<p dir=\"auto\">Steps to reproduce the behavior:</p>\n<ol dir=\"auto\">\n<li>Create a topic + Key_Shared subscription</li>\n<li>Send 40 delayed messages</li>\n<li>Send 40 messages</li>\n<li>Create subscription with <code class=\"notranslate\">receiverQueueSize=10</code></li>\n<li>Create another subscription with <code class=\"notranslate\">receiverQueueSize=10</code></li>\n<li>Receive messages on each subscription until exhaustion</li>\n<li>See that subscription 1 receives ~13 messages and subscription 2 receives none</li>\n</ol>\n<p dir=\"auto\">Here's a test case:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    @Test\n    public void testContinueDispatchMessagesWhenMessageDelayed() throws Exception {\n        int totalMessages = 40;\n        int sum = 0;\n        final String topic = &quot;persistent://public/default/key_shared-&quot; + UUID.randomUUID();\n        final String subName = &quot;my-sub&quot;;\n\n        @Cleanup\n        Consumer&lt;Integer&gt; consumer1 = pulsarClient.newConsumer(Schema.INT32)\n                .topic(topic)\n                .subscriptionName(subName)\n                .receiverQueueSize(10)\n                .subscriptionType(SubscriptionType.Key_Shared)\n                .subscribe();\n\n        @Cleanup\n        Producer&lt;Integer&gt; producer = pulsarClient.newProducer(Schema.INT32)\n                .topic(topic)\n                .create();\n\n        for (int i = 0; i &lt; totalMessages; i++) {\n            producer.newMessage()\n                    .key(String.valueOf(random.nextInt(NUMBER_OF_KEYS)))\n                    .value(100 + i)\n                    .deliverAfter(10, TimeUnit.SECONDS)\n                    .send();\n        }\n\n        for (int i = 0; i &lt; totalMessages; i++) {\n            producer.newMessage()\n                    .key(String.valueOf(random.nextInt(NUMBER_OF_KEYS)))\n                    .value(i)\n                    .send();\n        }\n\n        @Cleanup\n        Consumer&lt;Integer&gt; consumer2 = pulsarClient.newConsumer(Schema.INT32)\n                .topic(topic)\n                .subscriptionName(subName)\n                .receiverQueueSize(10)\n                .subscriptionType(SubscriptionType.Key_Shared)\n                .subscribe();\n\n        for (int i = 0; i &lt; 100; i++) {\n            Message&lt;Integer&gt; msg = consumer1.receive(1, TimeUnit.SECONDS);\n            if (msg != null) {\n                log.info(&quot;c1 message: {}&quot;, msg.getValue());\n                consumer1.acknowledge(msg);\n            } else {\n                break;\n            }\n            sum++;\n        }\n\n        log.info(&quot;Got {} messages...&quot;, sum);\n\n        for (int i = 0; i &lt; 100; i++) {\n            Message&lt;Integer&gt; msg = consumer2.receive(1, TimeUnit.SECONDS);\n            if (msg != null) {\n                log.info(&quot;c2 message: {}&quot;, msg.getValue());\n                consumer2.acknowledge(msg);\n            } else {\n                break;\n            }\n            sum++;\n        }\n\n        log.info(&quot;Got {} other messages...&quot;, sum);\n\n        Assert.assertEquals(sum, totalMessages);\n    }\"><pre class=\"notranslate\">    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Test</span>\n    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">testContinueDispatchMessagesWhenMessageDelayed</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-s1\">Exception</span> {\n        <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">totalMessages</span> = <span class=\"pl-c1\">40</span>;\n        <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">sum</span> = <span class=\"pl-c1\">0</span>;\n        <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">topic</span> = <span class=\"pl-s\">\"persistent://public/default/key_shared-\"</span> + <span class=\"pl-smi\">UUID</span>.<span class=\"pl-en\">randomUUID</span>();\n        <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">subName</span> = <span class=\"pl-s\">\"my-sub\"</span>;\n\n        <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Cleanup</span>\n        <span class=\"pl-smi\">Consumer</span>&lt;<span class=\"pl-smi\">Integer</span>&gt; <span class=\"pl-s1\">consumer1</span> = <span class=\"pl-s1\">pulsarClient</span>.<span class=\"pl-en\">newConsumer</span>(<span class=\"pl-smi\">Schema</span>.<span class=\"pl-c1\">INT32</span>)\n                .<span class=\"pl-en\">topic</span>(<span class=\"pl-s1\">topic</span>)\n                .<span class=\"pl-en\">subscriptionName</span>(<span class=\"pl-s1\">subName</span>)\n                .<span class=\"pl-en\">receiverQueueSize</span>(<span class=\"pl-c1\">10</span>)\n                .<span class=\"pl-en\">subscriptionType</span>(<span class=\"pl-smi\">SubscriptionType</span>.<span class=\"pl-s1\">Key_Shared</span>)\n                .<span class=\"pl-en\">subscribe</span>();\n\n        <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Cleanup</span>\n        <span class=\"pl-smi\">Producer</span>&lt;<span class=\"pl-smi\">Integer</span>&gt; <span class=\"pl-s1\">producer</span> = <span class=\"pl-s1\">pulsarClient</span>.<span class=\"pl-en\">newProducer</span>(<span class=\"pl-smi\">Schema</span>.<span class=\"pl-c1\">INT32</span>)\n                .<span class=\"pl-en\">topic</span>(<span class=\"pl-s1\">topic</span>)\n                .<span class=\"pl-en\">create</span>();\n\n        <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">int</span> <span class=\"pl-s1\">i</span> = <span class=\"pl-c1\">0</span>; <span class=\"pl-s1\">i</span> &lt; <span class=\"pl-s1\">totalMessages</span>; <span class=\"pl-s1\">i</span>++) {\n            <span class=\"pl-s1\">producer</span>.<span class=\"pl-en\">newMessage</span>()\n                    .<span class=\"pl-en\">key</span>(<span class=\"pl-smi\">String</span>.<span class=\"pl-en\">valueOf</span>(<span class=\"pl-s1\">random</span>.<span class=\"pl-en\">nextInt</span>(<span class=\"pl-c1\">NUMBER_OF_KEYS</span>)))\n                    .<span class=\"pl-en\">value</span>(<span class=\"pl-c1\">100</span> + <span class=\"pl-s1\">i</span>)\n                    .<span class=\"pl-en\">deliverAfter</span>(<span class=\"pl-c1\">10</span>, <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">SECONDS</span>)\n                    .<span class=\"pl-en\">send</span>();\n        }\n\n        <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">int</span> <span class=\"pl-s1\">i</span> = <span class=\"pl-c1\">0</span>; <span class=\"pl-s1\">i</span> &lt; <span class=\"pl-s1\">totalMessages</span>; <span class=\"pl-s1\">i</span>++) {\n            <span class=\"pl-s1\">producer</span>.<span class=\"pl-en\">newMessage</span>()\n                    .<span class=\"pl-en\">key</span>(<span class=\"pl-smi\">String</span>.<span class=\"pl-en\">valueOf</span>(<span class=\"pl-s1\">random</span>.<span class=\"pl-en\">nextInt</span>(<span class=\"pl-c1\">NUMBER_OF_KEYS</span>)))\n                    .<span class=\"pl-en\">value</span>(<span class=\"pl-s1\">i</span>)\n                    .<span class=\"pl-en\">send</span>();\n        }\n\n        <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Cleanup</span>\n        <span class=\"pl-smi\">Consumer</span>&lt;<span class=\"pl-smi\">Integer</span>&gt; <span class=\"pl-s1\">consumer2</span> = <span class=\"pl-s1\">pulsarClient</span>.<span class=\"pl-en\">newConsumer</span>(<span class=\"pl-smi\">Schema</span>.<span class=\"pl-c1\">INT32</span>)\n                .<span class=\"pl-en\">topic</span>(<span class=\"pl-s1\">topic</span>)\n                .<span class=\"pl-en\">subscriptionName</span>(<span class=\"pl-s1\">subName</span>)\n                .<span class=\"pl-en\">receiverQueueSize</span>(<span class=\"pl-c1\">10</span>)\n                .<span class=\"pl-en\">subscriptionType</span>(<span class=\"pl-smi\">SubscriptionType</span>.<span class=\"pl-s1\">Key_Shared</span>)\n                .<span class=\"pl-en\">subscribe</span>();\n\n        <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">int</span> <span class=\"pl-s1\">i</span> = <span class=\"pl-c1\">0</span>; <span class=\"pl-s1\">i</span> &lt; <span class=\"pl-c1\">100</span>; <span class=\"pl-s1\">i</span>++) {\n            <span class=\"pl-smi\">Message</span>&lt;<span class=\"pl-smi\">Integer</span>&gt; <span class=\"pl-s1\">msg</span> = <span class=\"pl-s1\">consumer1</span>.<span class=\"pl-en\">receive</span>(<span class=\"pl-c1\">1</span>, <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">SECONDS</span>);\n            <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">msg</span> != <span class=\"pl-c1\">null</span>) {\n                <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"c1 message: {}\"</span>, <span class=\"pl-s1\">msg</span>.<span class=\"pl-en\">getValue</span>());\n                <span class=\"pl-s1\">consumer1</span>.<span class=\"pl-en\">acknowledge</span>(<span class=\"pl-s1\">msg</span>);\n            } <span class=\"pl-k\">else</span> {\n                <span class=\"pl-k\">break</span>;\n            }\n            <span class=\"pl-s1\">sum</span>++;\n        }\n\n        <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"Got {} messages...\"</span>, <span class=\"pl-s1\">sum</span>);\n\n        <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">int</span> <span class=\"pl-s1\">i</span> = <span class=\"pl-c1\">0</span>; <span class=\"pl-s1\">i</span> &lt; <span class=\"pl-c1\">100</span>; <span class=\"pl-s1\">i</span>++) {\n            <span class=\"pl-smi\">Message</span>&lt;<span class=\"pl-smi\">Integer</span>&gt; <span class=\"pl-s1\">msg</span> = <span class=\"pl-s1\">consumer2</span>.<span class=\"pl-en\">receive</span>(<span class=\"pl-c1\">1</span>, <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">SECONDS</span>);\n            <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">msg</span> != <span class=\"pl-c1\">null</span>) {\n                <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"c2 message: {}\"</span>, <span class=\"pl-s1\">msg</span>.<span class=\"pl-en\">getValue</span>());\n                <span class=\"pl-s1\">consumer2</span>.<span class=\"pl-en\">acknowledge</span>(<span class=\"pl-s1\">msg</span>);\n            } <span class=\"pl-k\">else</span> {\n                <span class=\"pl-k\">break</span>;\n            }\n            <span class=\"pl-s1\">sum</span>++;\n        }\n\n        <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"Got {} other messages...\"</span>, <span class=\"pl-s1\">sum</span>);\n\n        <span class=\"pl-smi\">Assert</span>.<span class=\"pl-en\">assertEquals</span>(<span class=\"pl-s1\">sum</span>, <span class=\"pl-s1\">totalMessages</span>);\n    }</pre></div>\n<details>\n<summary>Logs</summary>\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - c1 message: 0\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - c1 message: 1\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - c1 message: 2\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - c1 message: 3\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - c1 message: 4\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - c1 message: 5\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - c1 message: 6\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - c1 message: 7\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - c1 message: 8\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - c1 message: 9\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - c1 message: 11\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - c1 message: 12\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - c1 message: 16\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - Got 13 messages...\norg.apache.pulsar.client.api.KeySharedSubscriptionTest - Got 13 other messages...\n</details>\n<p dir=\"auto\"><strong>Expected behavior</strong><br>\nAll 40 messages should have been received.</p>\n<p dir=\"auto\"><strong>Desktop (please complete the following information):</strong></p>\n<ul dir=\"auto\">\n<li>OS: macOS</li>\n<li>Pulsar: v2.6.2</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/8703",
                "createdAt": "2020-11-25T16:29:50Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "deprecated/question"
                      }
                    },
                    {
                      "node": {
                        "name": "area/broker"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[feat][ws] Use async auth method to support OIDC",
        "url": "https://github.com/apache/pulsar/pull/20238",
        "resourcePath": "/apache/pulsar/pull/20238",
        "createdAt": "2023-05-05T20:48:43Z",
        "number": 20238,
        "mergeCommit": {
          "oid": "03dc3db0a6357dcde294e55c1933bd13275f3f73",
          "message": "[feat][ws] Use async auth method to support OIDC (#20238)\n\nFixes #20236 \r\nPIP: #19409 \r\n\r\n### Motivation\r\n\r\nIn the `AuthenticationService`, we are currently using the deprecated `authenticate` methods. As a result, we hit the `Not Implemented` exception when using the `AuthenticationProviderOpenID`. This PR updates the implementation so that we're able \r\n\r\nThis solution isn't ideal for two reasons.\r\n\r\n1. We are not using the `authenticationHttpRequest` method, which seems like the right method for the WebSocket proxy. However, this is not a viable option, as I documented in #20237.\r\n2. We are calling `.get()` on a future. However, it is expected that the `AuthenticationProvider` not block forever, so I think this is acceptable for now. Please let me know if you disagree.\r\n\r\n### Modifications\r\n\r\n* Replace `authenticate` with `authenticateAsync`.\r\n\r\n### Verifying this change\r\n\r\nThis change is a trivial rework / code cleanup without any test coverage.\r\n\r\n### Documentation\r\n\r\n- [x] `doc-not-needed`\r\n\r\nNote that I do have documentation showing that 3.0.x does not support OIDC in the WebSocket Proxy. The `next` docs don't need that limitation since this PR fixes that and targets 3.1.0. https://github.com/apache/pulsar-site/pull/558\r\n\r\n### Matching PR in forked repository\r\n\r\nPR in forked repository: skipping for this trivial PR",
          "commitUrl": "https://github.com/apache/pulsar/commit/03dc3db0a6357dcde294e55c1933bd13275f3f73",
          "parents": {
            "nodes": [
              {
                "oid": "e956db729f5098ff319237fd4220dbfb234c1b18",
                "message": "[improve] Make subscriptions on NonPersistentTopic non-durable (#19741)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authentication/AuthenticationService.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5P5KpA2gAoNjY1ZjQzOWY4OTc1NDZhZTIwMGY5NDgwOWRkZDRhMDc5NjRjYTJlNA",
                "url": "https://github.com/apache/pulsar/pull/20238/commits/665f439f897546ae200f94809ddd4a07964ca2e4"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20236,
                "url": "https://github.com/apache/pulsar/issues/20236",
                "title": "Add support for OpenID Connect in WebSocket Proxy",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">With <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1628704988\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19849\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19849/hovercard\" href=\"https://github.com/apache/pulsar/pull/19849\">#19849</a>, we have support for OpenID Connect Authentication. That feature is not yet available in the WebSocket proxy because PIP 97 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1001413077\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/12105\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/12105/hovercard\" href=\"https://github.com/apache/pulsar/issues/12105\">#12105</a> has not yet been implemented for the WebSocket Proxy's code path.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Implement PIP 97 <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1001413077\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/12105\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/12105/hovercard\" href=\"https://github.com/apache/pulsar/issues/12105\">#12105</a> in the websocket proxy. Here is the problematic code:</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/516437e370a711d48fe1d444a0c47e64e7cf2f4b/pulsar-websocket/src/main/java/org/apache/pulsar/websocket/AbstractWebSocketHandler.java#L102-L107\">pulsar/pulsar-websocket/src/main/java/org/apache/pulsar/websocket/AbstractWebSocketHandler.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 102 to 107\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/516437e370a711d48fe1d444a0c47e64e7cf2f4b\">516437e</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L102\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"102\"></td>\n          <td id=\"LC102\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">authenticationState</span> != <span class=\"pl-c1\">null</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L103\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"103\"></td>\n          <td id=\"LC103\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">authRole</span> = <span class=\"pl-s1\">service</span>.<span class=\"pl-en\">getAuthenticationService</span>() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L104\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"104\"></td>\n          <td id=\"LC104\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             .<span class=\"pl-en\">authenticateHttpRequest</span>(<span class=\"pl-s1\">request</span>, <span class=\"pl-s1\">authenticationState</span>.<span class=\"pl-en\">getAuthDataSource</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L105\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"105\"></td>\n          <td id=\"LC105\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L106\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"106\"></td>\n          <td id=\"LC106\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">authRole</span> = <span class=\"pl-s1\">service</span>.<span class=\"pl-en\">getAuthenticationService</span>().<span class=\"pl-en\">authenticateHttpRequest</span>(<span class=\"pl-s1\">request</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L107\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"107\"></td>\n          <td id=\"LC107\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">I plan on working to implement this soon.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20236",
                "createdAt": "2023-05-05T19:53:26Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "area/authn"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[feat][client] PIP-253 Expose ProducerStats for DeadLetter and RetryLetter producers in ConsumerStats",
        "url": "https://github.com/apache/pulsar/pull/20239",
        "resourcePath": "/apache/pulsar/pull/20239",
        "createdAt": "2023-05-05T23:21:11Z",
        "number": 20239,
        "mergeCommit": {
          "oid": "bd86e4e9d8dc2fe75ac8e29d628ffc5f7f9aab8c",
          "message": "[feat][client] PIP-253 Expose ProducerStats for DeadLetter and RetryLetter producers in ConsumerStats (#20239)",
          "commitUrl": "https://github.com/apache/pulsar/commit/bd86e4e9d8dc2fe75ac8e29d628ffc5f7f9aab8c",
          "parents": {
            "nodes": [
              {
                "oid": "e55de39e358e18a72b4156c7cd4ac4831a573864",
                "message": "[fix][test] Fix thread leaks related to unclosed WebSocketService (#21453)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerStatTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/ConsumerStats.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerStatsDisabled.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerStatsRecorder.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerStatsRecorderImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicConsumerStatsRecorderImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/resources/findbugsExclude.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5P5k9T2gAoYjc0ZDIxYjAzZWEyZTgzODYyYTQ0NjJjMjYzOTgxNGRmMmM2MGU2Nw",
                "url": "https://github.com/apache/pulsar/pull/20239/commits/b74d21b03ea2e83862a4462c2639814df2c60e67"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19698,
                "url": "https://github.com/apache/pulsar/issues/19698",
                "title": "PIP-253: Expose `ProducerStats` for `deadLetterProducer` & `retryLetterProducer` in java client",
                "bodyHTML": "<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">Consumer</code> and <code class=\"notranslate\">Producer</code> interfaces both have <code class=\"notranslate\">getStats</code> methods, allowing the user to access metrics directly. However, when a <code class=\"notranslate\">deadLetterPolicy</code> or <code class=\"notranslate\">retryPolicy</code> is used, <code class=\"notranslate\">ConsumerImpl</code> creates additional producers that are <a href=\"https://github.com/apache/pulsar/blob/master/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java#L184-L186\">private to that class</a>.</p>\n<p dir=\"auto\">This implementation does not allow the user any access to the producer stats for those producers. I would like to propose a change that would allow public access to the <code class=\"notranslate\">ProducerStats</code> objects for the retry letter &amp; dead letter producers.</p>\n<h3 dir=\"auto\">Goal</h3>\n<p dir=\"auto\">I would like to propose a change that would allow public access to the <code class=\"notranslate\">ProducerStats</code> objects for the retry letter &amp; dead letter producers.</p>\n<h3 dir=\"auto\">API Changes</h3>\n<p dir=\"auto\">Addition of 2 new methods to <code class=\"notranslate\">ConsumerStats.java</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"ProducerStats getDeadLetterProducerStats();\n\nProducerStats getRetryLetterProducerStats();\"><pre class=\"notranslate\"><code class=\"notranslate\">ProducerStats getDeadLetterProducerStats();\n\nProducerStats getRetryLetterProducerStats();\n</code></pre></div>\n<h3 dir=\"auto\">Implementation</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"@Override\n    public ProducerStatsRecorder getDeadLetterProducerStats() {\n        if (deadLetterProducer == null) { return null; }\n        return deadLetterProducer.get().getStats();\n    }\n\n@Override\n    public ProducerStatsRecorder getRetryLetterProducerStats() {\n        if (retryLetterProducer == null) { return null; }\n        return retryLetterProducer.getStats();\n    }\"><pre class=\"notranslate\"><code class=\"notranslate\">@Override\n    public ProducerStatsRecorder getDeadLetterProducerStats() {\n        if (deadLetterProducer == null) { return null; }\n        return deadLetterProducer.get().getStats();\n    }\n\n@Override\n    public ProducerStatsRecorder getRetryLetterProducerStats() {\n        if (retryLetterProducer == null) { return null; }\n        return retryLetterProducer.getStats();\n    }\n</code></pre></div>\n<p dir=\"auto\">In <code class=\"notranslate\">ConsumerImpl.java</code>, we will need to add a setter to <code class=\"notranslate\">ConsumerStats</code> whenever a <code class=\"notranslate\">deadLetterProducer</code> or <code class=\"notranslate\">retryLetterProducer</code> is initialized.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\">Another approach could be to add the producer stats as a field on <code class=\"notranslate\">Consumer.java</code>.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>",
                "resourcePath": "/apache/pulsar/issues/19698",
                "createdAt": "2023-03-02T23:09:19Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/PIP"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Java Client's Seek Logic Not Threadsafe #1",
        "url": "https://github.com/apache/pulsar/pull/20242",
        "resourcePath": "/apache/pulsar/pull/20242",
        "createdAt": "2023-05-06T05:08:33Z",
        "number": 20242,
        "mergeCommit": {
          "oid": "bc1764f9ef71dd31e8cd61c7571e493442bc6395",
          "message": "[fix][client] Seek should be thread-safe (#20242)",
          "commitUrl": "https://github.com/apache/pulsar/commit/bc1764f9ef71dd31e8cd61c7571e493442bc6395",
          "parents": {
            "nodes": [
              {
                "oid": "3c80af2df9c33c11bd30434c187a7dc23b93572b",
                "message": "[improve][sql] Reuse factory and replace if-else with switch (#19027)\n\nSigned-off-by: tison <wander4096@gmail.com>\r\nCo-authored-by: tison <wander4096@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/ConsumerImplTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5P6EOx2gAoNDA3NWEzOWMyNWI3YWJjNTAzNzE0OTgwZGE4YjMzZTZjNWQxMTZjNg",
                "url": "https://github.com/apache/pulsar/pull/20242/commits/4075a39c25b7abc503714980da8b33e6c5d116c6"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19671,
                "url": "https://github.com/apache/pulsar/issues/19671",
                "title": "[Bug] Java Client's Seek Logic Not Threadsafe",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Review the usage of the <code class=\"notranslate\">duringSeek</code> atomic boolean, and it is clear that if a client were to execute two concurrent seek async calls, the client would not handle the logic correctly.</p>\n<p dir=\"auto\">See:</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/e0b50c9ec5f12d0fb8275f235d8ac00e87a9099e/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java#L2141\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 2141\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/e0b50c9ec5f12d0fb8275f235d8ac00e87a9099e\">e0b50c9</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L2141\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2141\"></td>\n          <td id=\"LC2141\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">duringSeek</span>.<span class=\"pl-en\">set</span>(<span class=\"pl-c1\">true</span>); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/e0b50c9ec5f12d0fb8275f235d8ac00e87a9099e/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java#L924-L925\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 924 to 925\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/e0b50c9ec5f12d0fb8275f235d8ac00e87a9099e\">e0b50c9</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L924\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"924\"></td>\n          <td id=\"LC924\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">duringSeek</span>.<span class=\"pl-en\">compareAndSet</span>(<span class=\"pl-c1\">true</span>, <span class=\"pl-c1\">false</span>)) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L925\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"925\"></td>\n          <td id=\"LC925\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-s1\">seekMessageId</span>; </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">The first seek will likely return first and reset the subscription, but the second will silently fail.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I expect the client to either cancel the first operation or to fail the second operation due to an illegal call.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Unexpected state would occur.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19671",
                "createdAt": "2023-03-01T04:19:17Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "help wanted"
                      }
                    },
                    {
                      "node": {
                        "name": "good first issue"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Fix  where the function getMsgNumInReceiverQueue always returns 0 when using message listener",
        "url": "https://github.com/apache/pulsar/pull/20245",
        "resourcePath": "/apache/pulsar/pull/20245",
        "createdAt": "2023-05-06T16:55:11Z",
        "number": 20245,
        "mergeCommit": {
          "oid": "2dec2677743a6c517deb6976718fbe3a9eef0644",
          "message": "[fix][client] Fix  where the function getMsgNumInReceiverQueue always returns 0 when using message listener (#20245)",
          "commitUrl": "https://github.com/apache/pulsar/commit/2dec2677743a6c517deb6976718fbe3a9eef0644",
          "parents": {
            "nodes": [
              {
                "oid": "43b3622cc7e7f746ca9920fdc704dc7448767ac7",
                "message": "[improve][broker] Add `topic_load_failed` metric (#19236)\n\nCo-authored-by: daojun <jmtao@streamnative.io>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerStatsRecorderImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5P631a2gAoMzE2YWQyZjFkNGNkNDg3MzkwNjFlMGVkMGQ5OTJhN2FlMmJiNDZlYg",
                "url": "https://github.com/apache/pulsar/pull/20245/commits/316ad2f1d4cd48739061e0ed0d992a7ae2bb46eb"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20076,
                "url": "https://github.com/apache/pulsar/issues/20076",
                "title": "[Bug] When consuming messages using messageListener, the ConsumerStats#getMsgNumInReceiverQueue method always returns 0.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">all version</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"                .messageListener(new MessageListener&lt;byte[]&gt;() {\n                    @SneakyThrows\n                    @Override\n                    public void received(Consumer&lt;byte[]&gt; consumer, Message&lt;byte[]&gt; msg) {\n                        TimeUnit.SECONDS.sleep(100);\n                        consumer.acknowledge(msg);\n                    }\n                })\n\nInteger msgNumInReceiverQueue = consumer.getStats().getMsgNumInReceiverQueue();\"><pre class=\"notranslate\">                .<span class=\"pl-en\">messageListener</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">MessageListener</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt;() {\n                    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">SneakyThrows</span>\n                    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Override</span>\n                    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">received</span>(<span class=\"pl-smi\">Consumer</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">consumer</span>, <span class=\"pl-smi\">Message</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">msg</span>) {\n                        <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">SECONDS</span>.<span class=\"pl-en\">sleep</span>(<span class=\"pl-c1\">100</span>);\n                        <span class=\"pl-s1\">consumer</span>.<span class=\"pl-en\">acknowledge</span>(<span class=\"pl-s1\">msg</span>);\n                    }\n                })\n\n<span class=\"pl-smi\">Integer</span> <span class=\"pl-s1\">msgNumInReceiverQueue</span> = <span class=\"pl-s1\">consumer</span>.<span class=\"pl-en\">getStats</span>().<span class=\"pl-en\">getMsgNumInReceiverQueue</span>();</pre></div>\n<p dir=\"auto\">When consuming messages using messageListener, the <code class=\"notranslate\">msgNumInReceiverQueue</code> is always 0.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\"><code class=\"notranslate\">consumer.getStats().getMsgNumInReceiverQueue()</code> returns the actual number of messages that are blocking.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">the <code class=\"notranslate\">msgNumInReceiverQueue</code> is always 0.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/15684156/231387925-4c5326d7-5745-4639-8271-7184a1d47df9.png\"><img src=\"https://user-images.githubusercontent.com/15684156/231387925-4c5326d7-5745-4639-8271-7184a1d47df9.png\" alt=\"image\" style=\"max-width: 100%;\"></a><br>\nAs all messages are written to an unbounded queue in <code class=\"notranslate\">externalPinnedExecutor</code>, should we consider adding a counter here to record the number of unconsumed messages?</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20076",
                "createdAt": "2023-04-12T07:43:41Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix default bundle size used while setting bookie affinity",
        "url": "https://github.com/apache/pulsar/pull/20250",
        "resourcePath": "/apache/pulsar/pull/20250",
        "createdAt": "2023-05-08T06:16:06Z",
        "number": 20250,
        "mergeCommit": {
          "oid": "c32caba54a5ab2c01c092ab952343f4ac405da35",
          "message": "[fix][broker] Fix default bundle size used while setting bookie affinity (#20250)",
          "commitUrl": "https://github.com/apache/pulsar/commit/c32caba54a5ab2c01c092ab952343f4ac405da35",
          "parents": {
            "nodes": [
              {
                "oid": "ea56197d18d8d1f5b06c26246d920cb736d4e6a6",
                "message": "[fix][monitor] topic with double quote breaks the prometheus format (#20230)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/NamespacesBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerBookieIsolationTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5P9zf72gAoMGJiNjRjMmM0MTVjY2Q0MDVhYjllNDIwZmRhNGQ2ZDRkMzRmYjkyYQ",
                "url": "https://github.com/apache/pulsar/pull/20250/commits/0bb64c2c415ccd405ab9e420fda4d6d4d34fb92a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20194,
                "url": "https://github.com/apache/pulsar/issues/20194",
                "title": "[Bug] While Setting BookieAffinity group, not using the broker config to set the default number of bundles",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">branch: master<br>\ncommitId: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/apache/pulsar/commit/eedf7026ae60f39bcf74ce67728b47d966fe237f/hovercard\" href=\"https://github.com/apache/pulsar/commit/eedf7026ae60f39bcf74ce67728b47d966fe237f\"><tt>eedf702</tt></a></p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Create a namespace under a tenant<br>\nSet bookie-affinity group for the namespace</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Pulsar should read the number of bundles('defaultNumberOfNamespaceBundles') data from the broker config file and use that instead of using a single bundle while creating the affinity group.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Broker is calling the default bundle method in PoliciesUtil and setting the bundle size as 1</p>\n<p dir=\"auto\"><strong>NamespacesBase.java</strong><br>\ngetLocalPolicies().setLocalPoliciesWithCreate(namespaceName, oldPolicies -&gt; {<br>\nLocalPolicies localPolicies = oldPolicies.map(<br>\npolicies -&gt; new LocalPolicies(policies.bundles,<br>\nbookieAffinityGroup,<br>\npolicies.namespaceAntiAffinityGroup))<br>\n.orElseGet(() -&gt; new LocalPolicies(<strong>defaultBundle()</strong>,<br>\nbookieAffinityGroup,<br>\nnull));<br>\nlog.info(\"[{}] Successfully updated local-policies configuration: namespace={}, map={}\", clientAppId(),<br>\nnamespaceName, localPolicies);</p>\n<p dir=\"auto\"><strong>PoliciesUtil.java</strong><br>\npublic static BundlesData defaultBundle() {<br>\nList boundaries = new ArrayList&lt;&gt;();<br>\nboundaries.add(FIRST_BOUNDARY);<br>\nboundaries.add(LAST_BOUNDARY);<br>\nreturn BundlesData.builder()<br>\n.numBundles(1)<br>\n.boundaries(boundaries)<br>\n.build();<br>\n}</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20194",
                "createdAt": "2023-04-27T07:05:44Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[feat][broker] ns-isolation-policy support hostport pattern",
        "url": "https://github.com/apache/pulsar/pull/20256",
        "resourcePath": "/apache/pulsar/pull/20256",
        "createdAt": "2023-05-08T11:44:43Z",
        "number": 20256,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdNamespaceIsolationPolicy.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/policies/impl/NamespaceIsolationPolicyImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/test/java/org/apache/pulsar/common/policies/impl/NamespaceIsolationPolicyImplTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5P_e6_2gAoMjQ4ZjMxZGU0OTlhY2M3ZGViMDg4MDFjMDhlM2RlYmI1YWMxZWE4MQ",
                "url": "https://github.com/apache/pulsar/pull/20256/commits/248f31de499acc7deb08801c08e3debb5ac1ea81"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 15795,
                "url": "https://github.com/apache/pulsar/issues/15795",
                "title": "\u5728\u914d\u7f6ens-isolation-policy \u7684\u65f6\u5019broker\u7684\u914d\u7f6e\u4e0d\u80fd\u91c7\u7528hostname:\u7aef\u53e3",
                "bodyHTML": "<p dir=\"auto\">1  \u7528\u547d\u4ee4\u884c\u5217\u51fabroker\u7684\u65f6\u5019<br>\nbin/pulsar-admin brokers list</p>\n<p dir=\"auto\">\u201chostname1:8080\u201d<br>\n\u201chostname2:8080\u201d<br>\n\u201chostname3:8080\u201d</p>\n<p dir=\"auto\">bin/pulsar-admin   ns-isolation-policy  brokers<br>\n{<br>\n\"brokerName\" : \"hostname1:8080\",<br>\n\"namespaceRegex\" : [ ],<br>\n\"primary\" : false<br>\n}<br>\n{<br>\n\"brokerName\" : \"hostname2:8080\",<br>\n\"namespaceRegex\" : [ ],<br>\n\"primary\" : false<br>\n}<br>\n{<br>\n\"brokerName\" : \"hostname3:8080\",<br>\n\"namespaceRegex\" : [ ],<br>\n\"primary\" : false<br>\n}</p>\n<p dir=\"auto\">2 bin/pulsar-admin ns-isolation-policy set \u7701\u7565\u5176\u4ed6\u53c2\u6570 --primary hostname1:8080  --secondary  hostname2:8080<br>\n\u53ef\u4ee5\u8bbe\u7f6e \u4f46\u662f\u65e0\u6548</p>\n<p dir=\"auto\">3 bin/pulsar-admin ns-isolation-policy set \u7701\u7565\u5176\u4ed6\u53c2\u6570 --primary hostname1  --secondary  hostname2<br>\n\u53ef\u4ee5\u8bbe\u7f6e \u6709\u6548</p>\n<p dir=\"auto\">\u5efa\u8bae1\uff1a\u7edf\u4e00broker list\u7684\u683c\u5f0f<br>\n5\u6708\u4efd\u7684\u5f00\u53d1\u7ec4\u6c9f\u901a\u4f1a\u4e0a\u786e\u8ba4\uff0c\u8bbe\u7f6e\u4e0d\u8bc6\u522b\uff1a8080 \u4f46\u662f \u8fd9\u4e2a\u5374\u5728 bin/pulsar-admin brokers list \u548c bin/pulsar-admin   ns-isolation-policy  brokers \u51fa\u73b0\uff0c\u8fd9\u4e2a\u5c31\u4f1a\u5f88\u5927\u7684\u8bef\u5bfc\u7528\u6237\uff0c\u6211\u4e00\u76f4\u4ee5\u4e3apulsar\u8ba4\u53ef\u7684broker\u53ea\u662f\u548c\u81ea\u5df1list\u51fa\u6765\u7684broker\u7684\u5f62\u5f0f\u662f\u4e00\u6837\uff0c\u5efa\u8baelist\u4e5f\u4e0d\u8981\u6709\u7aef\u53e3 \u6216\u8005\u652f\u6301\u7aef\u53e3\u5f62\u5f0f\u7684ns-isolation-policy</p>\n<p dir=\"auto\">\u5efa\u8bae2\uff1a\u81f3\u5c11\u6821\u9a8cprimary \u7684broker \u53c2\u6570\u662f\u5426\u80fd\u5339\u914d\u5230broker \u4e0d\u80fd\u5339\u914d\u5e94\u8be5\u62a5\u9519\u3002<br>\n\u6821\u9a8c \u5982\u679c\u6211\u8bbe\u7f6e\u7684--primary  \u683c\u5f0f\u4e0d\u6b63\u786e\u6216\u8005\u96c6\u7fa4\u91cc\u9762\u5339\u914d\u4e0d\u5230\u4e00\u53f0broker \u5e94\u8be5\u62a5\u9519\uff0c\u5982\u679c\u8fd9\u4e0d\u62a5\u9519 \u975e\u8981\u7b49\u5230\u547d\u4e2d\u89c4\u5219\u62a5\u9519\uff0c\u90a3\u547d\u4e2d\u89c4\u5219\u662f\u6211\u521b\u5efa\u4e86\u4e00\u4e2atopic \u8fd9\u4e2atopic\u65e0\u6cd5\u5206\u914d \u7136\u540e cannot lookup \u8fd9\u4e2a\u5c31\u5982\u679c\u662f\u4e00\u4e2a\u4eba\u914d\u7f6e\u7684\u8fd8\u597d \u591a\u4eba\u914d\u7f6e\u90a3\u67e5\u8d77\u6765\u5c31\u8499\u5708\u4e86\u3002</p>",
                "resourcePath": "/apache/pulsar/issues/15795",
                "createdAt": "2022-05-26T02:16:14Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "help wanted"
                      }
                    },
                    {
                      "node": {
                        "name": "good first issue"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][io] add protobuf ByteString to pulsar-io jdbc core",
        "url": "https://github.com/apache/pulsar/pull/20259",
        "resourcePath": "/apache/pulsar/pull/20259",
        "createdAt": "2023-05-08T14:38:57Z",
        "number": 20259,
        "mergeCommit": {
          "oid": "849cbf3a46cc7e85fca6500c08ab6efb8697f12e",
          "message": "[fix][io] add protobuf ByteString to pulsar-io jdbc core (#20259)\n\nSigned-off-by: tison <wander4096@gmail.com>\r\nCo-authored-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/849cbf3a46cc7e85fca6500c08ab6efb8697f12e",
          "parents": {
            "nodes": [
              {
                "oid": "16b08984c87920d381ddc941de16cf551f66185f",
                "message": "[improve][doc] Add haProxyProtocolEnabled  more description (#19967)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/jdbc/core/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/jdbc/core/src/main/java/org/apache/pulsar/io/jdbc/BaseJdbcAutoSchemaSink.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5QAc_Y2gAoZDNjM2NkMGYyMjQxNzE5ZTQxYmJhMTc5ZjQzZGViYmU4OTQwOTk3YQ",
                "url": "https://github.com/apache/pulsar/pull/20259/commits/d3c3cd0f2241719e41bba179f43debbe8940997a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20247,
                "url": "https://github.com/apache/pulsar/issues/20247",
                "title": "[Bug] Pulsar IO JDBC Clickhouse and Protobuf native with \"ByteString\" throws exception",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Rocky Linux 8<br>\nPulsar 2.11.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ul dir=\"auto\">\n<li>Add ProtobufNative Schema to topic with \"bytes\" field.</li>\n<li>Use Pulsar IO JDBC Clickhouse Sink</li>\n</ul>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Event is sinked/inserted to clickhouse.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-05-07T13:06:54,039+0200 [pool-2-thread-1] ERROR org.apache.pulsar.io.jdbc.JdbcAbstractSink - Update count 0 not match total number of records 1005\n2023-05-07T13:06:54,098+0200 [pool-2-thread-1] ERROR org.apache.pulsar.io.jdbc.JdbcAbstractSink - Got exception \njava.lang.Exception: Not support value type, need to add it. class com.google.protobuf.ByteString$LiteralByteString\n        at org.apache.pulsar.io.jdbc.BaseJdbcAutoSchemaSink.setColumnValue(BaseJdbcAutoSchemaSink.java:186) ~[pulsar-io-jdbc-core-2.11.1.jar:?]\n        at org.apache.pulsar.io.jdbc.BaseJdbcAutoSchemaSink.bindValue(BaseJdbcAutoSchemaSink.java:81) ~[pulsar-io-jdbc-core-2.11.1.jar:?]\n        at org.apache.pulsar.io.jdbc.JdbcAbstractSink.flush(JdbcAbstractSink.java:247) ~[pulsar-io-jdbc-core-2.11.1.jar:?]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539) ~[?:?]\n        at java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[?:?]\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[?:?]\n        at java.lang.Thread.run(Thread.java:833) ~[?:?]\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-05-07T13:06:54,039+0200 [pool-2-thread-1] ERROR org.apache.pulsar.io.jdbc.JdbcAbstractSink - Update count 0 not match total number of records 1005\n2023-05-07T13:06:54,098+0200 [pool-2-thread-1] ERROR org.apache.pulsar.io.jdbc.JdbcAbstractSink - Got exception \njava.lang.Exception: Not support value type, need to add it. class com.google.protobuf.ByteString$LiteralByteString\n        at org.apache.pulsar.io.jdbc.BaseJdbcAutoSchemaSink.setColumnValue(BaseJdbcAutoSchemaSink.java:186) ~[pulsar-io-jdbc-core-2.11.1.jar:?]\n        at org.apache.pulsar.io.jdbc.BaseJdbcAutoSchemaSink.bindValue(BaseJdbcAutoSchemaSink.java:81) ~[pulsar-io-jdbc-core-2.11.1.jar:?]\n        at org.apache.pulsar.io.jdbc.JdbcAbstractSink.flush(JdbcAbstractSink.java:247) ~[pulsar-io-jdbc-core-2.11.1.jar:?]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539) ~[?:?]\n        at java.util.concurrent.FutureTask.run(FutureTask.java:264) ~[?:?]\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[?:?]\n        at java.lang.Thread.run(Thread.java:833) ~[?:?]\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">As i'm aware of, clickhouse supports \"ByteString\": <a href=\"https://clickhouse.com/docs/en/sql-reference/data-types/fixedstring\" rel=\"nofollow\">https://clickhouse.com/docs/en/sql-reference/data-types/fixedstring</a></p>\n<p dir=\"auto\">Maybe adding <code class=\"notranslate\">.setBytes</code> does the job, but i'm not aware how to build the pulsar io <code class=\"notranslate\">.nar</code> files to test it. How do I build the connectors?</p>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/blob/master/pulsar-io/jdbc/core/src/main/java/org/apache/pulsar/io/jdbc/BaseJdbcAutoSchemaSink.java#L170\">https://github.com/apache/pulsar/blob/master/pulsar-io/jdbc/core/src/main/java/org/apache/pulsar/io/jdbc/BaseJdbcAutoSchemaSink.java#L170</a></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"        } else if (value instanceof ByteString) {\n            statement.setBytes(index, ((ByteString) value)).toByteArray();\"><pre class=\"notranslate\"><code class=\"notranslate\">        } else if (value instanceof ByteString) {\n            statement.setBytes(index, ((ByteString) value)).toByteArray();\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20247",
                "createdAt": "2023-05-07T11:14:15Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[cleanup] Remove Streaming Dispatcher Code",
        "url": "https://github.com/apache/pulsar/pull/20279",
        "resourcePath": "/apache/pulsar/pull/20279",
        "createdAt": "2023-05-09T17:33:04Z",
        "number": 20279,
        "mergeCommit": {
          "oid": "09e646f72eb640987ca9162988b6b146c485cd31",
          "message": "[cleanup] Remove Streaming Dispatcher Code (#20279)\n\nDiscussed on mailing list here: https://lists.apache.org/thread/ky2bkzlz93njx3ntnvkpd0l77qzzgcmv\r\n\r\nFixes: https://github.com/apache/pulsar/issues/19088\r\nFixes: https://github.com/apache/pulsar/issues/16450\r\nFixes: https://github.com/apache/pulsar/issues/15422\r\nFixes: https://github.com/apache/pulsar/issues/11428\r\n\r\n### Motivation\r\n\r\nI am putting this PR together to move the mailing list conversation along.\r\n\r\nCopied from @eolivelli on the mailing list thread:\r\n\r\n> There are many flaky tests about that feature and I believe that it\r\nhas never been used in Production by anyone, because it happened a few\r\ntimes that we did some changes in the regular Dispatcher and\r\nintroduced bugs on the StreamingDispacther (usually manifested as\r\nflaky tests)\r\n\r\n### Modifications\r\n\r\n* Remove all `StreamingDispatcher` code, tests, and configuration.\r\n\r\n### Verifying this change\r\n\r\nIt should be sufficient to see the tests pass.\r\n\r\n### Does this pull request potentially affect one of the following parts:\r\n\r\nThis affects configuration.\r\n\r\n### Documentation\r\n\r\n- [x] `doc-not-needed`\r\n\r\nThere are no references to \"streaming dispatcher\" or \"streamingdispatcher\" in our github `pulsar-site` repo, which indicates to me that no docs need to be updated.\r\n\r\n### Matching PR in forked repository\r\n\r\nPR in forked repository: https://github.com/michaeljmarshall/pulsar/pull/46",
          "commitUrl": "https://github.com/apache/pulsar/commit/09e646f72eb640987ca9162988b6b146c485cd31",
          "parents": {
            "nodes": [
              {
                "oid": "d92010c00e30199c5cd53021e20ba5d7bb36701c",
                "message": "[feat] OIDC: support JWKS refresh for missing Key ID (#20338)\n\n### Motivation\r\n\r\nWhen the `AuthenticationProviderOpenID` encounters an unknown Key ID (known as the `kid` in the JWT) for a trusted token issuer, the token is rejected with the following error `java.lang.IllegalArgumentException: No JWK found for Key ID <kid>`. This behavior is technically valid, but it isn't ideal because it is possible that the Identity Provider has issued new signing keys and started using them before the Pulsar authentication provider has refreshed its cache. This PR introduces a behavior to retrieve \r\n\r\nThis PR adds a configuration called `openIDKeyIdCacheMissRefreshSeconds` that represents the length of time that must pass before the provider will reload the JWKS from the Identity Provider. The `openIDKeyIdCacheMissRefreshSeconds` setting limits the impact of an attacker invalidating the JWKS cache.\r\n\r\nWhen `openIDKeyIdCacheMissRefreshSeconds <= 0`, the JWKS will be refreshed for any missing key id when the issuer is trusted. This is only meant for testing.\r\n\r\n### Modifications\r\n\r\n* Add `openIDKeyIdCacheMissRefreshSeconds` setting and default it to 5 minutes.\r\n* Add functionality to invalidate and refresh the cache when a token has an unknown `kid` for a trusted issuer.\r\n\r\n### Verifying this change\r\n\r\nNew tests are added.\r\n\r\n### Does this pull request potentially affect one of the following parts:\r\n\r\nThis adds a new configuration, but it is very minor.\r\n\r\n### Documentation\r\n\r\n- [x] `doc-required`\r\n\r\n### Matching PR in forked repository\r\n\r\nPR in forked repository: Skipping since tests passed already on my local machine"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/streamingdispatch/package-info.java"
              }
            },
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PersistentDispatcherFailoverConsumerStreamingDispatcherTest.java"
              }
            },
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PersistentFailoverStreamingDispatcherE2ETest.java"
              }
            },
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PersistentStreamingDispatcherBlockConsumerTest.java"
              }
            },
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PersistentSubscriptionMessageDispatchStreamingDispatcherThrottlingTest.java"
              }
            },
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PersistentTopicStreamingDispatcherE2ETest.java"
              }
            },
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PersistentTopicStreamingDispatcherTest.java"
              }
            },
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/SimpleProducerConsumerTestStreamingDispatcherTest.java"
              }
            },
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/streamingdispatch/StreamingEntryReaderTests.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/MessageDispatchThrottlingTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5QHa_M2gAoNDA5OWI4YjFhMWJkMjdhNTg1ZjYxNDQwM2ZjNDAyZjIyOThmNDczMw",
                "url": "https://github.com/apache/pulsar/pull/20279/commits/4099b8b1a1bd27a585f614403fc402f2298f4733"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 11428,
                "url": "https://github.com/apache/pulsar/issues/11428",
                "title": "Flaky-test: StreamingEntryReaderTests.testCanCancelReadEntryRequestAndResumeReading",
                "bodyHTML": "<p dir=\"auto\">StreamingEntryReaderTests is flaky. The testCanCancelReadEntryRequestAndResumeReading test method fails sporadically.</p>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/pull/11407/checks?check_run_id=3130789624#step:10:392\">example failure</a></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  testCanCancelReadEntryRequestAndResumeReading(org.apache.pulsar.broker.service.streamingdispatch.StreamingEntryReaderTests)  Time elapsed: 10.165 s  &lt;&lt;&lt; FAILURE!\n  org.awaitility.core.ConditionTimeoutException: Condition with lambda expression in org.apache.pulsar.broker.service.streamingdispatch.StreamingEntryReaderTests that uses org.apache.pulsar.broker.service.streamingdispatch.StreamingEntryReader was not fulfilled within 10 seconds.\n  \tat org.awaitility.core.ConditionAwaiter.await(ConditionAwaiter.java:165)\n  \tat org.awaitility.core.CallableCondition.await(CallableCondition.java:78)\n  \tat org.awaitility.core.CallableCondition.await(CallableCondition.java:26)\n  \tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:895)\n  \tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:864)\n  \tat org.apache.pulsar.broker.service.streamingdispatch.StreamingEntryReaderTests.testCanCancelReadEntryRequestAndResumeReading(StreamingEntryReaderTests.java:323)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\n  \tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:132)\n  \tat org.testng.internal.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:45)\n  \tat org.testng.internal.InvokeMethodRunnable.call(InvokeMethodRunnable.java:73)\n  \tat org.testng.internal.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n  \tat java.base/java.lang.Thread.run(Thread.java:829)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  testCanCancelReadEntryRequestAndResumeReading(org.apache.pulsar.broker.service.streamingdispatch.StreamingEntryReaderTests)  Time elapsed: 10.165 s  &lt;&lt;&lt; FAILURE!\n  org.awaitility.core.ConditionTimeoutException: Condition with lambda expression in org.apache.pulsar.broker.service.streamingdispatch.StreamingEntryReaderTests that uses org.apache.pulsar.broker.service.streamingdispatch.StreamingEntryReader was not fulfilled within 10 seconds.\n  \tat org.awaitility.core.ConditionAwaiter.await(ConditionAwaiter.java:165)\n  \tat org.awaitility.core.CallableCondition.await(CallableCondition.java:78)\n  \tat org.awaitility.core.CallableCondition.await(CallableCondition.java:26)\n  \tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:895)\n  \tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:864)\n  \tat org.apache.pulsar.broker.service.streamingdispatch.StreamingEntryReaderTests.testCanCancelReadEntryRequestAndResumeReading(StreamingEntryReaderTests.java:323)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\n  \tat org.testng.internal.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:132)\n  \tat org.testng.internal.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:45)\n  \tat org.testng.internal.InvokeMethodRunnable.call(InvokeMethodRunnable.java:73)\n  \tat org.testng.internal.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628)\n  \tat java.base/java.lang.Thread.run(Thread.java:829)\n</code></pre></div>",
                "resourcePath": "/apache/pulsar/issues/11428",
                "createdAt": "2021-07-22T07:26:32Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "lifecycle/stale"
                      }
                    }
                  ]
                }
              }
            },
            {
              "node": {
                "number": 15422,
                "url": "https://github.com/apache/pulsar/issues/15422",
                "title": "Flaky-test: SimpleProducerConsumerTestStreamingDispatcherTest.testRedeliveryFailOverConsumer",
                "bodyHTML": "<p dir=\"auto\">SimpleProducerConsumerTestStreamingDispatcherTest.testRedeliveryFailOverConsumer is flaky. It fails sporadically.</p>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/pull/15414/checks?check_run_id=6260684559\">example failure</a></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Failed test found in:\n  TEST-org.apache.pulsar.broker.service.persistent.SimpleProducerConsumerTestStreamingDispatcherTest.xml.~1~.xml\nError:\n      org.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.client.api.SimpleProducerConsumerTest.testRedeliveryFailOverConsumer() didn't finish within the time-out 300000\nat org.testng.internal.MethodInvocationHelper.invokeWithTimeoutWithNewExecutor(MethodInvocationHelper.java:371)\nat org.testng.internal.MethodInvocationHelper.invokeWithTimeout(MethodInvocationHelper.java:282)\nat org.testng.internal.TestInvoker.invokeMethod(TestInvoker.java:605)\nat org.testng.internal.TestInvoker.retryFailed(TestInvoker.java:214)\nat org.testng.internal.MethodRunner.runInSequence(MethodRunner.java:58)\nat org.testng.internal.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:822)\nat org.testng.internal.TestInvoker.invokeTestMethods(TestInvoker.java:147)\nat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:146)\nat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:128)\nat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\nat org.testng.TestRunner.privateRun(TestRunner.java:764)\nat org.testng.TestRunner.run(TestRunner.java:585)\nat org.testng.SuiteRunner.runTest(SuiteRunner.java:384)\nat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:378)\nat org.testng.SuiteRunner.privateRun(SuiteRunner.java:337)\nat org.testng.SuiteRunner.run(SuiteRunner.java:286)\nat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:53)\nat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:96)\nat org.testng.TestNG.runSuitesSequentially(TestNG.java:1218)\nat org.testng.TestNG.runSuitesLocally(TestNG.java:1140)\nat org.testng.TestNG.runSuites(TestNG.java:1069)\nat org.testng.TestNG.run(TestNG.java:1037)\nat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:135)\nat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:112)\nat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:123)\nat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:90)\nat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:146)\nat org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)\nat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)\nat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)\nat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)\"><pre class=\"notranslate\"><code class=\"notranslate\">Failed test found in:\n  TEST-org.apache.pulsar.broker.service.persistent.SimpleProducerConsumerTestStreamingDispatcherTest.xml.~1~.xml\nError:\n      org.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.client.api.SimpleProducerConsumerTest.testRedeliveryFailOverConsumer() didn't finish within the time-out 300000\nat org.testng.internal.MethodInvocationHelper.invokeWithTimeoutWithNewExecutor(MethodInvocationHelper.java:371)\nat org.testng.internal.MethodInvocationHelper.invokeWithTimeout(MethodInvocationHelper.java:282)\nat org.testng.internal.TestInvoker.invokeMethod(TestInvoker.java:605)\nat org.testng.internal.TestInvoker.retryFailed(TestInvoker.java:214)\nat org.testng.internal.MethodRunner.runInSequence(MethodRunner.java:58)\nat org.testng.internal.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:822)\nat org.testng.internal.TestInvoker.invokeTestMethods(TestInvoker.java:147)\nat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:146)\nat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:128)\nat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\nat org.testng.TestRunner.privateRun(TestRunner.java:764)\nat org.testng.TestRunner.run(TestRunner.java:585)\nat org.testng.SuiteRunner.runTest(SuiteRunner.java:384)\nat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:378)\nat org.testng.SuiteRunner.privateRun(SuiteRunner.java:337)\nat org.testng.SuiteRunner.run(SuiteRunner.java:286)\nat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:53)\nat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:96)\nat org.testng.TestNG.runSuitesSequentially(TestNG.java:1218)\nat org.testng.TestNG.runSuitesLocally(TestNG.java:1140)\nat org.testng.TestNG.runSuites(TestNG.java:1069)\nat org.testng.TestNG.run(TestNG.java:1037)\nat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:135)\nat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:112)\nat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:123)\nat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:90)\nat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:146)\nat org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)\nat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)\nat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)\nat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)\n</code></pre></div>\n",
                "resourcePath": "/apache/pulsar/issues/15422",
                "createdAt": "2022-05-04T07:17:28Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            },
            {
              "node": {
                "number": 16450,
                "url": "https://github.com/apache/pulsar/issues/16450",
                "title": "Flaky-test: PersistentSubscriptionMessageDispatchStreamingDispatcherThrottlingTest. testDispatchRateCompatibility2",
                "bodyHTML": "<p dir=\"auto\">org.apache.pulsar.broker.service.persistent.PersistentSubscriptionMessageDispatchStreamingDispatcherThrottlingTest is flaky. The testDispatchRateCompatibility2 test method fails sporadically.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.util.concurrent.ExecutionException: org.apache.pulsar.broker.service.BrokerServiceException$TopicFencedException: Topic is already fenced\n\tat java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:396)\n\tat java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2073)\n\tat org.apache.pulsar.client.api.MessageDispatchThrottlingTest.testDispatchRateCompatibility2(MessageDispatchThrottlingTest.java:1094)\"><pre class=\"notranslate\"><code class=\"notranslate\">java.util.concurrent.ExecutionException: org.apache.pulsar.broker.service.BrokerServiceException$TopicFencedException: Topic is already fenced\n\tat java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:396)\n\tat java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2073)\n\tat org.apache.pulsar.client.api.MessageDispatchThrottlingTest.testDispatchRateCompatibility2(MessageDispatchThrottlingTest.java:1094)\n</code></pre></div>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/runs/6830374279?check_suite_focus=true#step:10:5696\">example failure 2022-06-10T12:29:11.2963739Z</a></p>",
                "resourcePath": "/apache/pulsar/issues/16450",
                "createdAt": "2022-07-07T15:41:04Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            },
            {
              "node": {
                "number": 19088,
                "url": "https://github.com/apache/pulsar/issues/19088",
                "title": "Flaky-test: SimpleProducerConsumerTestStreamingDispatcherTest.testBackoffAndReconnect",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/3791285394/jobs/6446689017#step:10:1222\">https://github.com/apache/pulsar/actions/runs/3791285394/jobs/6446689017#step:10:1222</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  testBackoffAndReconnect(org.apache.pulsar.broker.service.persistent.SimpleProducerConsumerTestStreamingDispatcherTest)  Time elapsed: 12.346 s  &lt;&lt;&lt; FAILURE!\n  java.lang.NullPointerException: Cannot invoke &quot;org.apache.pulsar.client.api.Message.getData()&quot; because &quot;msg&quot; is null\n  \tat org.apache.pulsar.client.api.SimpleProducerConsumerTest.testBackoffAndReconnect(SimpleProducerConsumerTest.java:605)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  testBackoffAndReconnect(org.apache.pulsar.broker.service.persistent.SimpleProducerConsumerTestStreamingDispatcherTest)  Time elapsed: 12.346 s  &lt;&lt;&lt; FAILURE!\n  java.lang.NullPointerException: Cannot invoke \"org.apache.pulsar.client.api.Message.getData()\" because \"msg\" is null\n  \tat org.apache.pulsar.client.api.SimpleProducerConsumerTest.testBackoffAndReconnect(SimpleProducerConsumerTest.java:605)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19088",
                "createdAt": "2022-12-28T08:29:26Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Flaky-test: SimpleProducerConsumerTestStreamingDispatcherTest. rest",
        "url": "https://github.com/apache/pulsar/pull/20286",
        "resourcePath": "/apache/pulsar/pull/20286",
        "createdAt": "2023-05-10T02:06:52Z",
        "number": 20286,
        "mergeCommit": {
          "oid": "c5ceec72d6d9362c680c08c3ecb5b1f3e9cc682a",
          "message": "[fix][test] Flaky-test: SimpleProducerConsumerTestStreamingDispatcherTest. rest (#20286)",
          "commitUrl": "https://github.com/apache/pulsar/commit/c5ceec72d6d9362c680c08c3ecb5b1f3e9cc682a",
          "parents": {
            "nodes": [
              {
                "oid": "7e54e9b0463f5c69846dc44892d88281d5508466",
                "message": "[fix][broker] Fix class name typo `PrecisPublishLimiter` to \"Precise\" (#20310)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5QJOyi2gAoZWE0ZjAxYzU0NTBhMzZhMzdmNTExNmQ4ZDY2NGMyYjNjZTk2NzkyNw",
                "url": "https://github.com/apache/pulsar/pull/20286/commits/ea4f01c5450a36a37f5116d8d664c2b3ce967927"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20285,
                "url": "https://github.com/apache/pulsar/issues/20285",
                "title": "Flaky-test: SimpleProducerConsumerTestStreamingDispatcherTest. rest",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4915081747/jobs/8794230217?pr=20257\">https://github.com/apache/pulsar/actions/runs/4915081747/jobs/8794230217?pr=20257</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\" Error:  Tests run: 105, Failures: 1, Errors: 0, Skipped: 16, Time elapsed: 427.419 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.persistent.SimpleProducerConsumerTestStreamingDispatcherTest\n  Error:  rest(org.apache.pulsar.broker.service.persistent.SimpleProducerConsumerTestStreamingDispatcherTest)  Time elapsed: 2.628 s  &lt;&lt;&lt; FAILURE!\n  java.lang.NullPointerException: Cannot invoke &quot;org.apache.pulsar.broker.PulsarService.getConfiguration()&quot; because &quot;this.pulsar&quot; is null\n  \tat org.apache.pulsar.client.api.SimpleProducerConsumerTest.rest(SimpleProducerConsumerTest.java:142)\n  \tat jdk.internal.reflect.GeneratedMethodAccessor1098.invoke(Unknown Source)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n  \tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n  \tat org.testng.internal.invokers.TestInvoker.runAfterConfigurations(TestInvoker.java:792)\n  \tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:768)\"><pre class=\"notranslate\"><code class=\"notranslate\"> Error:  Tests run: 105, Failures: 1, Errors: 0, Skipped: 16, Time elapsed: 427.419 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.persistent.SimpleProducerConsumerTestStreamingDispatcherTest\n  Error:  rest(org.apache.pulsar.broker.service.persistent.SimpleProducerConsumerTestStreamingDispatcherTest)  Time elapsed: 2.628 s  &lt;&lt;&lt; FAILURE!\n  java.lang.NullPointerException: Cannot invoke \"org.apache.pulsar.broker.PulsarService.getConfiguration()\" because \"this.pulsar\" is null\n  \tat org.apache.pulsar.client.api.SimpleProducerConsumerTest.rest(SimpleProducerConsumerTest.java:142)\n  \tat jdk.internal.reflect.GeneratedMethodAccessor1098.invoke(Unknown Source)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n  \tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n  \tat org.testng.internal.invokers.TestInvoker.runAfterConfigurations(TestInvoker.java:792)\n  \tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:768)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20285",
                "createdAt": "2023-05-10T02:03:50Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky test ConnectionPoolTest.testSetProxyToTargetBrokerAddress",
        "url": "https://github.com/apache/pulsar/pull/20293",
        "resourcePath": "/apache/pulsar/pull/20293",
        "createdAt": "2023-05-10T13:20:05Z",
        "number": 20293,
        "mergeCommit": {
          "oid": "b07f2a9b85a0f22b89fed5b51ee8625b00b7262e",
          "message": "[fix][test] Fix flaky test ConnectionPoolTest.testSetProxyToTargetBrokerAddress (#20293)",
          "commitUrl": "https://github.com/apache/pulsar/commit/b07f2a9b85a0f22b89fed5b51ee8625b00b7262e",
          "parents": {
            "nodes": [
              {
                "oid": "96367e1c2bfd64ec0f72602321ae6ede4bed96cd",
                "message": "[cleanup] Deduplicate test certificates to simplify management (#20289)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/ConnectionPoolTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5QMXd42gAoNDY4NWRmMzdlZWExNGZlYTA2MzA5ZDRjMDA2MTZmZDkyY2JlNTM0Yg",
                "url": "https://github.com/apache/pulsar/pull/20293/commits/4685df37eea14fea06309d4c00616fd92cbe534b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20290,
                "url": "https://github.com/apache/pulsar/issues/20290",
                "title": "Flaky-test: ConnectionPoolTest.testSetProxyToTargetBrokerAddress",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4933518332/jobs/8817664984?pr=20289#step:10:747\">https://github.com/apache/pulsar/actions/runs/4933518332/jobs/8817664984?pr=20289#step:10:747</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"   Error:  org.apache.pulsar.client.impl.ConnectionPoolTest.testSetProxyToTargetBrokerAddress  Time elapsed: 0.085 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [broker] but found [proxy]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n  \tat org.testng.Assert.assertEquals(Assert.java:131)\n  \tat org.testng.Assert.assertEquals(Assert.java:655)\n  \tat org.testng.Assert.assertEquals(Assert.java:665)\n  \tat org.apache.pulsar.client.impl.ConnectionPoolTest.testSetProxyToTargetBrokerAddress(ConnectionPoolTest.java:219)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">   Error:  org.apache.pulsar.client.impl.ConnectionPoolTest.testSetProxyToTargetBrokerAddress  Time elapsed: 0.085 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [broker] but found [proxy]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n  \tat org.testng.Assert.assertEquals(Assert.java:131)\n  \tat org.testng.Assert.assertEquals(Assert.java:655)\n  \tat org.testng.Assert.assertEquals(Assert.java:665)\n  \tat org.apache.pulsar.client.impl.ConnectionPoolTest.testSetProxyToTargetBrokerAddress(ConnectionPoolTest.java:219)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20290",
                "createdAt": "2023-05-10T06:07:31Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix NPE cause by topic publish rate limiter.",
        "url": "https://github.com/apache/pulsar/pull/20302",
        "resourcePath": "/apache/pulsar/pull/20302",
        "createdAt": "2023-05-11T09:23:12Z",
        "number": 20302,
        "mergeCommit": {
          "oid": "4b24c9e85ad534c2087063e7873eded4f9ab7a21",
          "message": "[fix][broker] Fix NPE cause by topic publish rate limiter. (#20302)\n\nCo-authored-by: druidliu <druidliu@tencent.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/4b24c9e85ad534c2087063e7873eded4f9ab7a21",
          "parents": {
            "nodes": [
              {
                "oid": "b07f2a9b85a0f22b89fed5b51ee8625b00b7262e",
                "message": "[fix][test] Fix flaky test ConnectionPoolTest.testSetProxyToTargetBrokerAddress (#20293)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5QRZto2gAoYmNkM2E0MTdiNDY5MWEwZWY5OWU2MTJkNWM0MThhODAxNjg1NTNkZA",
                "url": "https://github.com/apache/pulsar/pull/20302/commits/bcd3a417b4691a0ef99e612d5c418a80168553dd"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20301,
                "url": "https://github.com/apache/pulsar/issues/20301",
                "title": "[Bug] [broker] Broker get NPE caused by topic publisher throttling",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.10.4</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Set up a pulsar cluster with configuration <code class=\"notranslate\">maxPublishRatePerTopicInBytes&gt;0</code></li>\n<li>When topic unload, there is a chance to trigger this bug and show NPE error log.</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">No error log and all topics go well.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\"><code class=\"notranslate\">java.lang.NullPointerException</code> and the topic become unwritable.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">broker log:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-05-11T14:18:10,366+0800 [pulsar-topic-publish-rate-limiter-monitor-39-1] ERROR org.apache.bookkeeper.common.util.SafeRunnable - Unexpected throwable caught \njava.lang.NullPointerException: null\n        at org.apache.pulsar.broker.service.AbstractTopic.checkTopicPublishThrottlingRate(AbstractTopic.java:843) ~[org.apache.pulsar-pulsar-broker-2.10.4.jar:2.10.4]\n        at java.util.Optional.ifPresent(Optional.java:183) ~[?:?]\n        at org.apache.pulsar.broker.service.BrokerService.lambda$forEachTopic$80(BrokerService.java:1874) ~[org.apache.pulsar-pulsar-broker-2.10.4.jar:2.10.4]\n        at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.forEach(ConcurrentOpenHashMap.java:544) ~[org.apache.pulsar-pulsar-common-2.10.4.jar:2.10.4]\n        at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.forEach(ConcurrentOpenHashMap.java:272) ~[org.apache.pulsar-pulsar-common-2.10.4.jar:2.10.4]\n        at org.apache.pulsar.broker.service.BrokerService.forEachTopic(BrokerService.java:1872) ~[org.apache.pulsar-pulsar-broker-2.10.4.jar:2.10.4]\n        at org.apache.pulsar.broker.service.BrokerService.checkTopicPublishThrottlingRate(BrokerService.java:1849) ~[org.apache.pulsar-pulsar-broker-2.10.4.jar:2.10.4]\n        at org.apache.pulsar.broker.service.BrokerService.lambda$setupTopicPublishRateLimiterMonitor$7(BrokerService.java:620) ~[org.apache.pulsar-pulsar-broker-2.10.4.jar:2.10.4]\n        at org.apache.bookkeeper.mledger.util.SafeRun$1.safeRun(SafeRun.java:32) ~[org.apache.pulsar-managed-ledger-2.10.4.jar:2.10.4]\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) ~[org.apache.bookkeeper-bookkeeper-common-4.14.7.gemini.0.jar:4.14.7.gemini.0]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) ~[?:?]\n        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305) ~[?:?]\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.87.Final.jar:4.1.87.Final]\n        at java.lang.Thread.run(Thread.java:829) ~[?:?]\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-05-11T14:18:10,366+0800 [pulsar-topic-publish-rate-limiter-monitor-39-1] ERROR org.apache.bookkeeper.common.util.SafeRunnable - Unexpected throwable caught \njava.lang.NullPointerException: null\n        at org.apache.pulsar.broker.service.AbstractTopic.checkTopicPublishThrottlingRate(AbstractTopic.java:843) ~[org.apache.pulsar-pulsar-broker-2.10.4.jar:2.10.4]\n        at java.util.Optional.ifPresent(Optional.java:183) ~[?:?]\n        at org.apache.pulsar.broker.service.BrokerService.lambda$forEachTopic$80(BrokerService.java:1874) ~[org.apache.pulsar-pulsar-broker-2.10.4.jar:2.10.4]\n        at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.forEach(ConcurrentOpenHashMap.java:544) ~[org.apache.pulsar-pulsar-common-2.10.4.jar:2.10.4]\n        at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.forEach(ConcurrentOpenHashMap.java:272) ~[org.apache.pulsar-pulsar-common-2.10.4.jar:2.10.4]\n        at org.apache.pulsar.broker.service.BrokerService.forEachTopic(BrokerService.java:1872) ~[org.apache.pulsar-pulsar-broker-2.10.4.jar:2.10.4]\n        at org.apache.pulsar.broker.service.BrokerService.checkTopicPublishThrottlingRate(BrokerService.java:1849) ~[org.apache.pulsar-pulsar-broker-2.10.4.jar:2.10.4]\n        at org.apache.pulsar.broker.service.BrokerService.lambda$setupTopicPublishRateLimiterMonitor$7(BrokerService.java:620) ~[org.apache.pulsar-pulsar-broker-2.10.4.jar:2.10.4]\n        at org.apache.bookkeeper.mledger.util.SafeRun$1.safeRun(SafeRun.java:32) ~[org.apache.pulsar-managed-ledger-2.10.4.jar:2.10.4]\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) ~[org.apache.bookkeeper-bookkeeper-common-4.14.7.gemini.0.jar:4.14.7.gemini.0]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) ~[?:?]\n        at java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305) ~[?:?]\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.87.Final.jar:4.1.87.Final]\n        at java.lang.Thread.run(Thread.java:829) ~[?:?]\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20301",
                "createdAt": "2023-05-11T08:57:54Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix skip message API when hole messages exists",
        "url": "https://github.com/apache/pulsar/pull/20326",
        "resourcePath": "/apache/pulsar/pull/20326",
        "createdAt": "2023-05-15T10:57:14Z",
        "number": 20326,
        "mergeCommit": {
          "oid": "c35b820bb323c8e52bd9cd8ccd29565c23764117",
          "message": "[fix][broker] Fix skip message API when hole messages exists (#20326)",
          "commitUrl": "https://github.com/apache/pulsar/commit/c35b820bb323c8e52bd9cd8ccd29565c23764117",
          "parents": {
            "nodes": [
              {
                "oid": "242758d5770de46e506855ff881472cbc274cedb",
                "message": "[fix][test] Fix flaky PersistentSubscriptionTest (#20434)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5QgBqy2gAoMjAwNGJmODdlNzViNGFhZTI1ZGM5ZTZiY2Q4MDc3ZTk0NzdlNmM1Yw",
                "url": "https://github.com/apache/pulsar/pull/20326/commits/2004bf87e75b4aae25dc9e6bcd8077e9477e6c5c"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20262,
                "url": "https://github.com/apache/pulsar/issues/20262",
                "title": "[Bug] When using the admin.topics().skipMessages API, the actual number of skipped messages may be less than the expected number when the value of skipNumber is greater than 8.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">latest version</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    @Test(dataProvider = &quot;topicName&quot;)\n    public void testSkipMessages(String topicName) throws Exception {\n        final String subName = topicName;\n        assertEquals(admin.topics().getList(&quot;prop-xyz/ns1&quot;), new ArrayList&lt;&gt;());\n\n        final String persistentTopicName = &quot;persistent://prop-xyz/ns1/&quot; + topicName;\n        // Force to create a topic\n        publishMessagesOnPersistentTopic(&quot;persistent://prop-xyz/ns1/&quot; + topicName, 0);\n        assertEquals(admin.topics().getList(&quot;prop-xyz/ns1&quot;),\n                List.of(&quot;persistent://prop-xyz/ns1/&quot; + topicName));\n\n        // create consumer and subscription\n        @Cleanup\n        PulsarClient client = PulsarClient.builder()\n                .serviceUrl(pulsar.getWebServiceAddress())\n                .statsInterval(0, TimeUnit.SECONDS)\n                .build();\n        AtomicInteger total = new AtomicInteger();\n        Consumer&lt;byte[]&gt; consumer = client.newConsumer().topic(persistentTopicName)\n                .messageListener(new MessageListener&lt;byte[]&gt;() {\n                    @SneakyThrows\n                    @Override\n                    public void received(Consumer&lt;byte[]&gt; consumer, Message&lt;byte[]&gt; msg) {\n                        if (total.get() %2 !=0){\n                            consumer.acknowledge(msg);\n                        }\n                        total.incrementAndGet();\n                    }\n                })\n                .subscriptionName(subName)\n                .subscriptionType(SubscriptionType.Exclusive).subscribe();\n\n        assertEquals(admin.topics().getSubscriptions(persistentTopicName), List.of(subName));\n\n        publishMessagesOnPersistentTopic(&quot;persistent://prop-xyz/ns1/&quot; + topicName, 100);\n        TimeUnit.SECONDS.sleep(3);\n        TopicStats topicStats = admin.topics().getStats(persistentTopicName);\n        long msgBacklog = topicStats.getSubscriptions().get(subName).getMsgBacklog();\n        log.info(&quot;back={}&quot;,msgBacklog);\n        int skipNumber = 20;\n        admin.topics().skipMessages(persistentTopicName, subName, skipNumber);\n        topicStats = admin.topics().getStats(persistentTopicName);\n        assertEquals(topicStats.getSubscriptions().get(subName).getMsgBacklog(), msgBacklog - skipNumber);\n    }\"><pre class=\"notranslate\">    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Test</span>(<span class=\"pl-s1\">dataProvider</span> = <span class=\"pl-s\">\"topicName\"</span>)\n    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">testSkipMessages</span>(<span class=\"pl-smi\">String</span> <span class=\"pl-s1\">topicName</span>) <span class=\"pl-k\">throws</span> <span class=\"pl-s1\">Exception</span> {\n        <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">subName</span> = <span class=\"pl-s1\">topicName</span>;\n        <span class=\"pl-en\">assertEquals</span>(<span class=\"pl-s1\">admin</span>.<span class=\"pl-en\">topics</span>().<span class=\"pl-en\">getList</span>(<span class=\"pl-s\">\"prop-xyz/ns1\"</span>), <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ArrayList</span>&lt;&gt;());\n\n        <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">persistentTopicName</span> = <span class=\"pl-s\">\"persistent://prop-xyz/ns1/\"</span> + <span class=\"pl-s1\">topicName</span>;\n        <span class=\"pl-c\">// Force to create a topic</span>\n        <span class=\"pl-en\">publishMessagesOnPersistentTopic</span>(<span class=\"pl-s\">\"persistent://prop-xyz/ns1/\"</span> + <span class=\"pl-s1\">topicName</span>, <span class=\"pl-c1\">0</span>);\n        <span class=\"pl-en\">assertEquals</span>(<span class=\"pl-s1\">admin</span>.<span class=\"pl-en\">topics</span>().<span class=\"pl-en\">getList</span>(<span class=\"pl-s\">\"prop-xyz/ns1\"</span>),\n                <span class=\"pl-smi\">List</span>.<span class=\"pl-en\">of</span>(<span class=\"pl-s\">\"persistent://prop-xyz/ns1/\"</span> + <span class=\"pl-s1\">topicName</span>));\n\n        <span class=\"pl-c\">// create consumer and subscription</span>\n        <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Cleanup</span>\n        <span class=\"pl-smi\">PulsarClient</span> <span class=\"pl-s1\">client</span> = <span class=\"pl-smi\">PulsarClient</span>.<span class=\"pl-en\">builder</span>()\n                .<span class=\"pl-en\">serviceUrl</span>(<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-en\">getWebServiceAddress</span>())\n                .<span class=\"pl-en\">statsInterval</span>(<span class=\"pl-c1\">0</span>, <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">SECONDS</span>)\n                .<span class=\"pl-en\">build</span>();\n        <span class=\"pl-smi\">AtomicInteger</span> <span class=\"pl-s1\">total</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">AtomicInteger</span>();\n        <span class=\"pl-smi\">Consumer</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">consumer</span> = <span class=\"pl-s1\">client</span>.<span class=\"pl-en\">newConsumer</span>().<span class=\"pl-en\">topic</span>(<span class=\"pl-s1\">persistentTopicName</span>)\n                .<span class=\"pl-en\">messageListener</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">MessageListener</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt;() {\n                    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">SneakyThrows</span>\n                    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Override</span>\n                    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">received</span>(<span class=\"pl-smi\">Consumer</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">consumer</span>, <span class=\"pl-smi\">Message</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">msg</span>) {\n                        <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">total</span>.<span class=\"pl-en\">get</span>() %<span class=\"pl-c1\">2</span> !=<span class=\"pl-c1\">0</span>){\n                            <span class=\"pl-s1\">consumer</span>.<span class=\"pl-en\">acknowledge</span>(<span class=\"pl-s1\">msg</span>);\n                        }\n                        <span class=\"pl-s1\">total</span>.<span class=\"pl-en\">incrementAndGet</span>();\n                    }\n                })\n                .<span class=\"pl-en\">subscriptionName</span>(<span class=\"pl-s1\">subName</span>)\n                .<span class=\"pl-en\">subscriptionType</span>(<span class=\"pl-smi\">SubscriptionType</span>.<span class=\"pl-s1\">Exclusive</span>).<span class=\"pl-en\">subscribe</span>();\n\n        <span class=\"pl-en\">assertEquals</span>(<span class=\"pl-s1\">admin</span>.<span class=\"pl-en\">topics</span>().<span class=\"pl-en\">getSubscriptions</span>(<span class=\"pl-s1\">persistentTopicName</span>), <span class=\"pl-smi\">List</span>.<span class=\"pl-en\">of</span>(<span class=\"pl-s1\">subName</span>));\n\n        <span class=\"pl-en\">publishMessagesOnPersistentTopic</span>(<span class=\"pl-s\">\"persistent://prop-xyz/ns1/\"</span> + <span class=\"pl-s1\">topicName</span>, <span class=\"pl-c1\">100</span>);\n        <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">SECONDS</span>.<span class=\"pl-en\">sleep</span>(<span class=\"pl-c1\">3</span>);\n        <span class=\"pl-smi\">TopicStats</span> <span class=\"pl-s1\">topicStats</span> = <span class=\"pl-s1\">admin</span>.<span class=\"pl-en\">topics</span>().<span class=\"pl-en\">getStats</span>(<span class=\"pl-s1\">persistentTopicName</span>);\n        <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">msgBacklog</span> = <span class=\"pl-s1\">topicStats</span>.<span class=\"pl-en\">getSubscriptions</span>().<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">subName</span>).<span class=\"pl-en\">getMsgBacklog</span>();\n        <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"back={}\"</span>,<span class=\"pl-s1\">msgBacklog</span>);\n        <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">skipNumber</span> = <span class=\"pl-c1\">20</span>;\n        <span class=\"pl-s1\">admin</span>.<span class=\"pl-en\">topics</span>().<span class=\"pl-en\">skipMessages</span>(<span class=\"pl-s1\">persistentTopicName</span>, <span class=\"pl-s1\">subName</span>, <span class=\"pl-s1\">skipNumber</span>);\n        <span class=\"pl-s1\">topicStats</span> = <span class=\"pl-s1\">admin</span>.<span class=\"pl-en\">topics</span>().<span class=\"pl-en\">getStats</span>(<span class=\"pl-s1\">persistentTopicName</span>);\n        <span class=\"pl-en\">assertEquals</span>(<span class=\"pl-s1\">topicStats</span>.<span class=\"pl-en\">getSubscriptions</span>().<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">subName</span>).<span class=\"pl-en\">getMsgBacklog</span>(), <span class=\"pl-s1\">msgBacklog</span> - <span class=\"pl-s1\">skipNumber</span>);\n    }</pre></div>\n<p dir=\"auto\"><strong>When I artificially created 50 hollow messages</strong> and skipped 20 messages, only 14 messages were actually skipped.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">The expected number of skipped messages is equal to the actual number of skipped messages.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The actual number of skips is less than the expected number of skips.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/15684156/236889435-cfb6098b-eb90-42b2-bce1-fc3273fc583e.png\"><img width=\"241\" alt=\"image\" src=\"https://user-images.githubusercontent.com/15684156/236889435-cfb6098b-eb90-42b2-bce1-fc3273fc583e.png\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/e956db729f5098ff319237fd4220dbfb234c1b18/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java#L1772-L1785\">pulsar/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 1772 to 1785\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/e956db729f5098ff319237fd4220dbfb234c1b18\">e956db7</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L1772\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1772\"></td>\n          <td id=\"LC1772\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1773\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1773\"></td>\n          <td id=\"LC1773\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">log</span>.<span class=\"pl-en\">isDebugEnabled</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1774\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1774\"></td>\n          <td id=\"LC1774\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">debug</span>(<span class=\"pl-s\">\"[{}] deletePosition {} moved ahead without clearing deleteMsgs {} for cursor {}\"</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1775\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1775\"></td>\n          <td id=\"LC1775\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">ledger</span>.<span class=\"pl-en\">getName</span>(), <span class=\"pl-s1\">markDeletePosition</span>, <span class=\"pl-s1\">r</span>.<span class=\"pl-en\">lowerEndpoint</span>(), <span class=\"pl-s1\">name</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1776\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1776\"></td>\n          <td id=\"LC1776\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1777\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1777\"></td>\n          <td id=\"LC1777\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1778\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1778\"></td>\n          <td id=\"LC1778\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">return</span> <span class=\"pl-c1\">true</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1779\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1779\"></td>\n          <td id=\"LC1779\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } <span class=\"pl-k\">finally</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1780\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1780\"></td>\n          <td id=\"LC1780\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">r</span>.<span class=\"pl-en\">lowerEndpoint</span>() <span class=\"pl-k\">instanceof</span> <span class=\"pl-smi\">PositionImplRecyclable</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1781\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1781\"></td>\n          <td id=\"LC1781\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             ((<span class=\"pl-smi\">PositionImplRecyclable</span>) <span class=\"pl-s1\">r</span>.<span class=\"pl-en\">lowerEndpoint</span>()).<span class=\"pl-en\">recycle</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1782\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1782\"></td>\n          <td id=\"LC1782\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             ((<span class=\"pl-smi\">PositionImplRecyclable</span>) <span class=\"pl-s1\">r</span>.<span class=\"pl-en\">upperEndpoint</span>()).<span class=\"pl-en\">recycle</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1783\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1783\"></td>\n          <td id=\"LC1783\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1784\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1784\"></td>\n          <td id=\"LC1784\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1785\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1785\"></td>\n          <td id=\"LC1785\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> }, <span class=\"pl-s1\">recyclePositionRangeConverter</span>); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\n<a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/15684156/236890402-dd9a5023-e597-432f-b188-abd6443a3965.png\"><img width=\"1052\" alt=\"image\" src=\"https://user-images.githubusercontent.com/15684156/236890402-dd9a5023-e597-432f-b188-abd6443a3965.png\" style=\"max-width: 100%;\"></a><p></p>\n<p dir=\"auto\">The reason for this issue is that the <code class=\"notranslate\">recycle()</code> function reuses objects, causing the object referenced by <code class=\"notranslate\">r</code> to change during runtime. When the loop count is greater than 8, the else block is entered, leading to an incorrect calculation of the message count.</p>\n<p dir=\"auto\">I think there are two methods to fix this issue.</p>\n<p dir=\"auto\">The first method is to perform a copy before assignment, similar to the following:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"        public void setStartPosition(PositionImpl startPosition) {\n            PositionImpl cp = new PositionImpl(startPosition.ledgerId, startPosition.entryId);\n            this.startPosition = cp;\n        }\n\n        public void setEndPosition(PositionImpl endPosition) {\n            PositionImpl cp = new PositionImpl(endPosition.ledgerId, endPosition.entryId);\n            this.endPosition = cp;\n        }\n\t\n\t// state.endPosition = r.lowerEndpoint();\n\tstate.setEndPosition(r.lowerEndpoint());\n\n\t// state.startPosition = r.upperEndpoint();\n\tstate.setStartPosition(r.upperEndpoint());\"><pre class=\"notranslate\">        <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">setStartPosition</span>(<span class=\"pl-smi\">PositionImpl</span> <span class=\"pl-s1\">startPosition</span>) {\n            <span class=\"pl-smi\">PositionImpl</span> <span class=\"pl-s1\">cp</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">PositionImpl</span>(<span class=\"pl-s1\">startPosition</span>.<span class=\"pl-s1\">ledgerId</span>, <span class=\"pl-s1\">startPosition</span>.<span class=\"pl-s1\">entryId</span>);\n            <span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">startPosition</span> = <span class=\"pl-s1\">cp</span>;\n        }\n\n        <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">setEndPosition</span>(<span class=\"pl-smi\">PositionImpl</span> <span class=\"pl-s1\">endPosition</span>) {\n            <span class=\"pl-smi\">PositionImpl</span> <span class=\"pl-s1\">cp</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">PositionImpl</span>(<span class=\"pl-s1\">endPosition</span>.<span class=\"pl-s1\">ledgerId</span>, <span class=\"pl-s1\">endPosition</span>.<span class=\"pl-s1\">entryId</span>);\n            <span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">endPosition</span> = <span class=\"pl-s1\">cp</span>;\n        }\n\t\n\t<span class=\"pl-c\">// state.endPosition = r.lowerEndpoint();</span>\n\t<span class=\"pl-s1\">state</span>.<span class=\"pl-en\">setEndPosition</span>(<span class=\"pl-s1\">r</span>.<span class=\"pl-en\">lowerEndpoint</span>());\n\n\t<span class=\"pl-c\">// state.startPosition = r.upperEndpoint();</span>\n\t<span class=\"pl-s1\">state</span>.<span class=\"pl-en\">setStartPosition</span>(<span class=\"pl-s1\">r</span>.<span class=\"pl-en\">upperEndpoint</span>());</pre></div>\n<p dir=\"auto\">The second method is to remove <code class=\"notranslate\">recyclePositionRangeConverter</code>.</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/15684156/236891897-138ec453-a2df-4e4b-862d-eb65a437e7c9.png\"><img width=\"1697\" alt=\"image\" src=\"https://user-images.githubusercontent.com/15684156/236891897-138ec453-a2df-4e4b-862d-eb65a437e7c9.png\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">any other suggestions for a better solution?</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20262",
                "createdAt": "2023-05-08T17:36:40Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] When creating a namespace anti-affinity group with the default local policies, use the bundle size supplied by the user.",
        "url": "https://github.com/apache/pulsar/pull/20327",
        "resourcePath": "/apache/pulsar/pull/20327",
        "createdAt": "2023-05-15T13:34:34Z",
        "number": 20327,
        "mergeCommit": {
          "oid": "908d0b3f459167a3c3df2a85c23096df336427da",
          "message": "[fix][broker] Use user-specified bundle size on creating a namespace anti-affinity group with the default local policies (#20327)",
          "commitUrl": "https://github.com/apache/pulsar/commit/908d0b3f459167a3c3df2a85c23096df336427da",
          "parents": {
            "nodes": [
              {
                "oid": "4678c36d4023a2bb8361e0a70673b96de33f06ac",
                "message": "[fix][broker]Fix deadlock of metadata store (#20189)\n\nMotivation: This task loadOrCreatePersistentTopic occupied the event thread of the ZK client so that other ZK tasks could not be finished anymore(Including the task itself), and it calls bundlesCache.synchronous().get(nsname) which is a blocking method.\r\n\r\nModification: Since the method getBundle(topic) will eventually call the method bundlesCache.synchronous().get(nsname), use getBundleAsync(topic) instead of getBundle(topic) to avoid blocking the thread."
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/NamespacesBase.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Qg-lo2gAoMTk0YWZiOGQxY2JhMzcxNmQ0OGFkZjZkY2Q2OTk5NDYzZDZkNjZmNQ",
                "url": "https://github.com/apache/pulsar/pull/20327/commits/194afb8d1cba3716d48adf6dcd6999463d6d66f5"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20278,
                "url": "https://github.com/apache/pulsar/issues/20278",
                "title": "Could you also help change `orElse` to `orElseGet` at line 1713 and 1763",
                "bodyHTML": "<p dir=\"auto\">Change <code class=\"notranslate\">orElse</code> to <code class=\"notranslate\">orElseGet</code> at line 1713 and 1763 and also for anti affinity group the default bundle size should be taken from the user-supplied configuration value.</p>\n<p dir=\"auto\">Even at those places and the remaining places where we are creating <strong>new LocalPolicies()</strong> we are not using the bundle size from the configuration. Should I change it to have the bundle size supplied by the user from the configuration? Should we do it in this PR or shall we create another bug and link it and fix them there?</p>\n<p dir=\"auto\"><em>Originally posted by <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/syk-coder/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/syk-coder\">@syk-coder</a> in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1699604098\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20250\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20250/hovercard?comment_id=1539471991&amp;comment_type=issue_comment\" href=\"https://github.com/apache/pulsar/pull/20250#issuecomment-1539471991\">#20250 (comment)</a></em></p>",
                "resourcePath": "/apache/pulsar/issues/20278",
                "createdAt": "2023-05-09T16:52:05Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[feat][meta] Upgrade to jetcd to 0.7.5",
        "url": "https://github.com/apache/pulsar/pull/20339",
        "resourcePath": "/apache/pulsar/pull/20339",
        "createdAt": "2023-05-17T05:37:58Z",
        "number": 20339,
        "mergeCommit": {
          "oid": "c7a4060763b905925ffe8e9690ea983d863aa52f",
          "message": "[feat][meta] Upgrade to jetcd to 0.7.5 (#20339)",
          "commitUrl": "https://github.com/apache/pulsar/commit/c7a4060763b905925ffe8e9690ea983d863aa52f",
          "parents": {
            "nodes": [
              {
                "oid": "1a7a876634f32d5d9218977dc83f8ae08a08bf57",
                "message": "[improve][client] Document Java Client's Seek logic thread-safety improved in #20242 (#20284)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "distribution/server/src/assemble/LICENSE.bin.txt"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/pulsar/metadata/BaseMetadataStoreTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/pulsar/metadata/coordination/impl/LeaderElectionImplTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/pulsar/metadata/impl/EtcdMetadataStoreTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-sql/presto-distribution/LICENSE"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "src/owasp-dependency-check-suppressions.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5QrNc02gAoMzVkY2NjZTI3OTAwMWI3OTgzMmQ1OGNlOWI2OTE1ZDM1Yjg4MDgyZg",
                "url": "https://github.com/apache/pulsar/pull/20339/commits/35dccce279001b79832d58ce9b6915d35b88082f"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20308,
                "url": "https://github.com/apache/pulsar/issues/20308",
                "title": "Flaky-test: LeaderElectionImplTest.validateDeadLock",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4949638662/jobs/8852414583?pr=20297#step:10:1573\">https://github.com/apache/pulsar/actions/runs/4949638662/jobs/8852414583?pr=20297#step:10:1573</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 9, Failures: 1, Errors: 0, Skipped: 5, Time elapsed: 19.697 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.metadata.coordination.impl.LeaderElectionImplTest\n  Error:  org.apache.pulsar.metadata.coordination.impl.LeaderElectionImplTest.validateDeadLock[Etcd, org.apache.pulsar.metadata.BaseMetadataStoreTest$$Lambda$379/0x00000008013a5888@6dc9da2d](10)  Time elapsed: 0.007 s  &lt;&lt;&lt; FAILURE!\n  java.lang.IllegalStateException: Mapped port can only be obtained after the container is started\n  \tat org.testcontainers.shaded.com.google.common.base.Preconditions.checkState(Preconditions.java:174)\n  \tat org.testcontainers.containers.ContainerState.getMappedPort(ContainerState.java:149)\n  \tat io.etcd.jetcd.launcher.EtcdContainer.clientEndpoint(EtcdContainer.java:201)\n  \tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n  \tat java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)\n  \tat java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n  \tat java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n  \tat java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:921)\n  \tat java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n  \tat java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:682)\n  \tat io.etcd.jetcd.launcher.EtcdClusterFactory$2.getClientEndpoints(EtcdClusterFactory.java:112)\n  \tat org.apache.pulsar.metadata.BaseMetadataStoreTest.getEtcdClusterConnectString(BaseMetadataStoreTest.java:90)\n  \tat org.apache.pulsar.metadata.BaseMetadataStoreTest.lambda$implementations$3(BaseMetadataStoreTest.java:81)\n  \tat org.apache.pulsar.metadata.coordination.impl.LeaderElectionImplTest.validateDeadLock(LeaderElectionImplTest.java:41)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 9, Failures: 1, Errors: 0, Skipped: 5, Time elapsed: 19.697 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.metadata.coordination.impl.LeaderElectionImplTest\n  Error:  org.apache.pulsar.metadata.coordination.impl.LeaderElectionImplTest.validateDeadLock[Etcd, org.apache.pulsar.metadata.BaseMetadataStoreTest$$Lambda$379/0x00000008013a5888@6dc9da2d](10)  Time elapsed: 0.007 s  &lt;&lt;&lt; FAILURE!\n  java.lang.IllegalStateException: Mapped port can only be obtained after the container is started\n  \tat org.testcontainers.shaded.com.google.common.base.Preconditions.checkState(Preconditions.java:174)\n  \tat org.testcontainers.containers.ContainerState.getMappedPort(ContainerState.java:149)\n  \tat io.etcd.jetcd.launcher.EtcdContainer.clientEndpoint(EtcdContainer.java:201)\n  \tat java.base/java.util.stream.ReferencePipeline$3$1.accept(ReferencePipeline.java:197)\n  \tat java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)\n  \tat java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n  \tat java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n  \tat java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:921)\n  \tat java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n  \tat java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:682)\n  \tat io.etcd.jetcd.launcher.EtcdClusterFactory$2.getClientEndpoints(EtcdClusterFactory.java:112)\n  \tat org.apache.pulsar.metadata.BaseMetadataStoreTest.getEtcdClusterConnectString(BaseMetadataStoreTest.java:90)\n  \tat org.apache.pulsar.metadata.BaseMetadataStoreTest.lambda$implementations$3(BaseMetadataStoreTest.java:81)\n  \tat org.apache.pulsar.metadata.coordination.impl.LeaderElectionImplTest.validateDeadLock(LeaderElectionImplTest.java:41)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20308",
                "createdAt": "2023-05-11T15:58:31Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][admin] Return BAD_REQUEST on cluster data is null for createCluster",
        "url": "https://github.com/apache/pulsar/pull/20346",
        "resourcePath": "/apache/pulsar/pull/20346",
        "createdAt": "2023-05-18T03:06:42Z",
        "number": 20346,
        "mergeCommit": {
          "oid": "c0757254a0ea2625ffc6d97687a715201e20ef2f",
          "message": "[improve][admin] Return BAD_REQUEST on cluster data is null for createCluster (#20346)",
          "commitUrl": "https://github.com/apache/pulsar/commit/c0757254a0ea2625ffc6d97687a715201e20ef2f",
          "parents": {
            "nodes": [
              {
                "oid": "65f61121e99b504294cf375f319f7946ff4c50fd",
                "message": "[cleanup] Catch TimeoutException when logging about time outs (#20349)\n\nRelates to: #20299\r\n\r\n### Motivation\r\n\r\nWe have several catch blocks that are dedicated to providing meaningful logs about timeouts. As such, we should catch the `TimeoutException`, not the `InterruptedException`, in order to ensure accurate logs.\r\n\r\n### Modifications\r\n\r\n* Replace `InterruptedException` with `TimeoutException`\r\n\r\n### Verifying this change\r\n\r\nThis change is a trivial rework / code cleanup without any test coverage.\r\n\r\n### Documentation\r\n\r\n- [x] `doc-not-needed`"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/ClustersBase.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5QxLWX2gAoZjY5YWNhMmI3Y2UyODQxNzlkYTE3MjAxODIyNmQ1Y2E4MmIyMDBjYw",
                "url": "https://github.com/apache/pulsar/pull/20346/commits/f69aca2b7ce284179da172018226d5ca82b200cc"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19476,
                "url": "https://github.com/apache/pulsar/issues/19476",
                "title": "API > The create cluster request returns 204 even if the body is not specified",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\"><strong>Pulsar version</strong> : 2.9.2<br>\n<strong>OS</strong>: CentOS Linux release 7.9.2009 (Core)</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">The problem occurs when you run the create cluster request without specifying the body. For example:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"curl -X PUT  http://host:9372/admin/v2/clusters/examplecluster\"><pre class=\"notranslate\"><code class=\"notranslate\">curl -X PUT  http://host:9372/admin/v2/clusters/examplecluster\n</code></pre></div>\n<p dir=\"auto\">In the documentation (<a href=\"https://pulsar.apache.org/admin-rest-api/#operation/createCluster\" rel=\"nofollow\">https://pulsar.apache.org/admin-rest-api/#operation/createCluster</a>), the only required parameter is the cluster name. But checking in the code you can see that the body is also required.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I expect that since the body is required the API returns me an error.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Instead the api returns me 204.<br>\nHowever, if I try to get that cluster, I get an error:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[apache-pulsar-2.9.2]$ curl http://host:9372/admin/v2/clusters/examplecluster\n{&quot;reason&quot;:&quot;Cluster does not exist&quot;}\"><pre class=\"notranslate\"><code class=\"notranslate\">[apache-pulsar-2.9.2]$ curl http://host:9372/admin/v2/clusters/examplecluster\n{\"reason\":\"Cluster does not exist\"}\n</code></pre></div>\n<p dir=\"auto\">But if I check the list of available clusters... The cluster I tried to create is also in the cluster list.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"curl http://host:9372/admin/v2/clusters/\n[&quot;magnews&quot;,&quot;examplecluster&quot;]\"><pre class=\"notranslate\"><code class=\"notranslate\">curl http://host:9372/admin/v2/clusters/\n[\"magnews\",\"examplecluster\"]\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">To solve the problem I passed an empty body to the request.<br>\nSomething like:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"curl -H 'Content-Type: application/json' -X PUT -d '{  }' http://host:9372/admin/v2/clusters/examplecluster\"><pre class=\"notranslate\"><code class=\"notranslate\">curl -H 'Content-Type: application/json' -X PUT -d '{  }' http://host:9372/admin/v2/clusters/examplecluster\n</code></pre></div>\n<p dir=\"auto\">In this case I have seen that the cluster is created correctly with the default values.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\" curl http://host:9372/admin/v2/clusters/examplecluster\n{&quot;brokerClientTlsEnabled&quot;:false,&quot;tlsAllowInsecureConnection&quot;:false,&quot;brokerClientTlsEnabledWithKeyStore&quot;:false,&quot;brokerClientTlsTrustStoreType&quot;:&quot;JKS&quot;}\"><pre class=\"notranslate\"><code class=\"notranslate\"> curl http://host:9372/admin/v2/clusters/examplecluster\n{\"brokerClientTlsEnabled\":false,\"tlsAllowInsecureConnection\":false,\"brokerClientTlsEnabledWithKeyStore\":false,\"brokerClientTlsTrustStoreType\":\"JKS\"}\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19476",
                "createdAt": "2023-02-09T07:58:13Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] Increase timeout on ManagedLedgerCompressionTest flaky test",
        "url": "https://github.com/apache/pulsar/pull/20352",
        "resourcePath": "/apache/pulsar/pull/20352",
        "createdAt": "2023-05-19T05:35:57Z",
        "number": 20352,
        "mergeCommit": {
          "oid": "120f229ffd4a2ce264b3a95a6731d948e2d88323",
          "message": "[fix] Increase timeout on ManagedLedgerCompressionTest flaky test (#20352)",
          "commitUrl": "https://github.com/apache/pulsar/commit/120f229ffd4a2ce264b3a95a6731d948e2d88323",
          "parents": {
            "nodes": [
              {
                "oid": "e008de9466f452dd92997a11621df3e30b024ece",
                "message": "[fix][broker] Change some static fields referencing mutable objects to ordinary instance fields in BrokerService (#20372)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/ManagedLedgerCompressionTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Q3EP72gAoOTI0YWQwNGU1MmRhMWYyNTE5ZTkxMWUzMjhiOTRmM2NlZDJmMDc0NA",
                "url": "https://github.com/apache/pulsar/pull/20352/commits/924ad04e52da1f2519e911e328b94f3ced2f0744"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 16497,
                "url": "https://github.com/apache/pulsar/issues/16497",
                "title": "Flaky-test: ManagedLedgerCompressionTest. testRestartBrokerEnableManagedLedgerInfoCompression",
                "bodyHTML": "<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error:  Tests run: 4, Failures: 1, Errors: 0, Skipped: 3, Time elapsed: 78.765 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.ManagedLedgerCompressionTest\n  Error:  testRestartBrokerEnableManagedLedgerInfoCompression(org.apache.pulsar.broker.service.ManagedLedgerCompressionTest)  Time elapsed: 20.018 s  &lt;&lt;&lt; FAILURE!\n  org.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.broker.service.ManagedLedgerCompressionTest.testRestartBrokerEnableManagedLedgerInfoCompression() didn't finish within the time-out 20000\n  \tat org.testng.internal.MethodInvocationHelper.invokeWithTimeoutWithNewExecutor(MethodInvocationHelper.java:371)\n  \tat org.testng.internal.MethodInvocationHelper.invokeWithTimeout(MethodInvocationHelper.java:282)\n  \tat org.testng.internal.TestInvoker.invokeMethod(TestInvoker.java:605)\n  \tat org.testng.internal.TestInvoker.retryFailed(TestInvoker.java:214)\n  \tat org.testng.internal.MethodRunner.runInSequence(MethodRunner.java:58)\n  \tat org.testng.internal.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:822)\n  \tat org.testng.internal.TestInvoker.invokeTestMethods(TestInvoker.java:147)\n  \tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:146)\n  \tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:128)\n  \tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n  \tat org.testng.TestRunner.privateRun(TestRunner.java:764)\n  \tat org.testng.TestRunner.run(TestRunner.java:[585](https://github.com/apache/pulsar/runs/7263165064?check_suite_focus=true#step:10:586))\n  \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:384)\n  \tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:378)\n  \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:337)\n  \tat org.testng.SuiteRunner.run(SuiteRunner.java:286)\n  \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:53)\n  \tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:96)\n  \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1218)\n  \tat org.testng.TestNG.runSuitesLocally(TestNG.java:1140)\n  \tat org.testng.TestNG.runSuites(TestNG.java:1069)\n  \tat org.testng.TestNG.run(TestNG.java:1037)\n  \tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:135)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:112)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:99)\n  \tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:146)\"><pre class=\"notranslate\"><code class=\"notranslate\">Error:  Tests run: 4, Failures: 1, Errors: 0, Skipped: 3, Time elapsed: 78.765 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.ManagedLedgerCompressionTest\n  Error:  testRestartBrokerEnableManagedLedgerInfoCompression(org.apache.pulsar.broker.service.ManagedLedgerCompressionTest)  Time elapsed: 20.018 s  &lt;&lt;&lt; FAILURE!\n  org.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.broker.service.ManagedLedgerCompressionTest.testRestartBrokerEnableManagedLedgerInfoCompression() didn't finish within the time-out 20000\n  \tat org.testng.internal.MethodInvocationHelper.invokeWithTimeoutWithNewExecutor(MethodInvocationHelper.java:371)\n  \tat org.testng.internal.MethodInvocationHelper.invokeWithTimeout(MethodInvocationHelper.java:282)\n  \tat org.testng.internal.TestInvoker.invokeMethod(TestInvoker.java:605)\n  \tat org.testng.internal.TestInvoker.retryFailed(TestInvoker.java:214)\n  \tat org.testng.internal.MethodRunner.runInSequence(MethodRunner.java:58)\n  \tat org.testng.internal.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:822)\n  \tat org.testng.internal.TestInvoker.invokeTestMethods(TestInvoker.java:147)\n  \tat org.testng.internal.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:146)\n  \tat org.testng.internal.TestMethodWorker.run(TestMethodWorker.java:128)\n  \tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n  \tat org.testng.TestRunner.privateRun(TestRunner.java:764)\n  \tat org.testng.TestRunner.run(TestRunner.java:[585](https://github.com/apache/pulsar/runs/7263165064?check_suite_focus=true#step:10:586))\n  \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:384)\n  \tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:378)\n  \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:337)\n  \tat org.testng.SuiteRunner.run(SuiteRunner.java:286)\n  \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:53)\n  \tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:96)\n  \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1218)\n  \tat org.testng.TestNG.runSuitesLocally(TestNG.java:1140)\n  \tat org.testng.TestNG.runSuites(TestNG.java:1069)\n  \tat org.testng.TestNG.run(TestNG.java:1037)\n  \tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:135)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:112)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:99)\n  \tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:146)\n</code></pre></div>",
                "resourcePath": "/apache/pulsar/issues/16497",
                "createdAt": "2022-07-09T11:49:41Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Invalidate metadata children cache after key deleted",
        "url": "https://github.com/apache/pulsar/pull/20363",
        "resourcePath": "/apache/pulsar/pull/20363",
        "createdAt": "2023-05-20T10:43:42Z",
        "number": 20363,
        "mergeCommit": {
          "oid": "7dcb3eab2916d42bb58fc1639dc58e11b5230997",
          "message": "[fix][broker] Invalidate metadata children cache after key deleted (#20363)",
          "commitUrl": "https://github.com/apache/pulsar/commit/7dcb3eab2916d42bb58fc1639dc58e11b5230997",
          "parents": {
            "nodes": [
              {
                "oid": "3f2978d32223d61f04db1de330f5b167a63925ae",
                "message": "[improve][bk] Add integration test with bookie http server enabled (#20149)\n\nSigned-off-by: tison <wander4096@gmail.com>\r\nCo-authored-by: tison <wander4096@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/main/java/org/apache/pulsar/metadata/impl/AbstractMetadataStore.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Q8FVG2gAoNGU5MDg2ZjY0NWYyY2MxMGNkOTE2OTIzMzM3YjM0MTc2NDk4ZmM2MA",
                "url": "https://github.com/apache/pulsar/pull/20363/commits/4e9086f645f2cc10cd916923337b34176498fc60"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 13489,
                "url": "https://github.com/apache/pulsar/issues/13489",
                "title": "Failed to create subscription",
                "bodyHTML": "<p dir=\"auto\">Failed to create consumer for topic partition-3.<br>\nOther partition is normal.<br>\npulsar-broker.log:<br>\n16:27:13.669 [pulsar-io-4-38] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [product/thor/persistent/data_out-partition-3] Cursor data_out_g_flt_xgks_test recovered to position 99681:294407</p>\n<p dir=\"auto\">16:27:13.669 [pulsar-io-4-38] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [product/thor/persistent/data_out-partition-3] Creating ledger, metadata: {component=[109, 97, 110, 97, 103, 101, 100, 45, 108, 101, 100, 103, 101, 114], pulsar/managed-ledger=[112, 114, 111, 100, 117, 99, 116, 47, 116, 104, 111, 114, 47, 112, 101, 114, 115, 105, 115, 116, 101, 110, 116, 47, 100, 97, 116, 97, 95, 111, 117, 116, 45, 112, 97, 114, 116, 105, 116, 105, 111, 110, 45, 51], pulsar/cursor=[100, 97, 116, 97, 95, 111, 117, 116, 95, 103, 95, 102, 108, 116, 95, 120, 103, 107, 115, 95, 116, 101, 115, 116], application=[112, 117, 108, 115, 97, 114]} - metadata ops timeout : 60 seconds</p>\n<p dir=\"auto\">16:27:13.684 [BookKeeperClientWorker-OrderedExecutor-77-0] INFO  org.apache.bookkeeper.mledger.impl.MetaStoreImpl - [product/thor/persistent/data_out-partition-3] [data_out_g_flt_xgks_test] Updating cursor info ledgerId=99725 mark-delete=99681:294407</p>\n<p dir=\"auto\">16:27:13.687 [bookkeeper-ml-scheduler-OrderedScheduler-4-0] WARN  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [product/thor/persistent/data_out-partition-3] Failed to update cursor metadata for data_out_g_flt_xgks_test due to version conflict org.apache.pulsar.metadata.api.MetadataStoreException$BadVersionException: org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion for /managed-ledgers/product/thor/persistent/data_out-partition-3/data_out_g_flt_xgks_test</p>\n<p dir=\"auto\">16:27:13.687 [bookkeeper-ml-scheduler-OrderedScheduler-4-0] WARN  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [product/thor/persistent/data_out-partition-3] Failed to update consumer data_out_g_flt_xgks_test<br>\norg.apache.bookkeeper.mledger.ManagedLedgerException$BadVersionException: org.apache.pulsar.metadata.api.MetadataStoreException$BadVersionException: org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion for /managed-ledgers/product/thor/persistent/data_out-partition-3/data_out_g_flt_xgks_test</p>\n<p dir=\"auto\">16:27:13.688 [bookkeeper-ml-scheduler-OrderedScheduler-4-0] WARN  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [product/thor/persistent/data_out-partition-3] Failed to open cursor: ManagedCursorImpl{ledger=product/thor/persistent/data_out-partition-3, name=data_out_g_flt_xgks_test, ackPos=99681:294407, readPos=99681:294408}</p>\n<p dir=\"auto\">16:27:13.688 [bookkeeper-ml-scheduler-OrderedScheduler-4-0] WARN  org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://product/thor/data_out-partition-3] Failed to create subscription for data_out_g_flt_xgks_test: org.apache.pulsar.metadata.api.MetadataStoreException$BadVersionException: org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion for /managed-ledgers/product/thor/persistent/data_out-partition-3/data_out_g_flt_xgks_test</p>\n<p dir=\"auto\">16:27:13.688 [bookkeeper-ml-scheduler-OrderedScheduler-4-0] ERROR org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://product/thor/data_out-partition-3] Failed to create subscription: data_out_g_flt_xgks_test error: java.util.concurrent.CompletionException: org.apache.pulsar.broker.service.BrokerServiceException$PersistenceException: org.apache.bookkeeper.mledger.ManagedLedgerException$BadVersionException: org.apache.pulsar.metadata.api.MetadataStoreException$BadVersionException: org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion for /managed-ledgers/product/thor/persistent/data_out-partition-3/data_out_g_flt_xgks_test</p>\n<p dir=\"auto\">16:27:13.688 [bookkeeper-ml-scheduler-OrderedScheduler-4-0] WARN  org.apache.pulsar.broker.service.ServerCnx - [/172.16.224.102:13000][persistent://product/thor/data_out-partition-3][data_out_g_flt_xgks_test] Failed to create consumer: consumerId=3, java.util.concurrent.CompletionException: org.apache.pulsar.broker.service.BrokerServiceException$PersistenceException: org.apache.bookkeeper.mledger.ManagedLedgerException$BadVersionException: org.apache.pulsar.metadata.api.MetadataStoreException$BadVersionException: org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion for /managed-ledgers/product/thor/persistent/data_out-partition-3/data_out_g_flt_xgks_test</p>",
                "resourcePath": "/apache/pulsar/issues/13489",
                "createdAt": "2021-12-24T08:38:31Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "lifecycle/stale"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            },
            {
              "node": {
                "number": 14779,
                "url": "https://github.com/apache/pulsar/issues/14779",
                "title": "BadVersionException , unable to consume topic, failing to reconnect",
                "bodyHTML": "<p dir=\"auto\"><strong>Describe the bug</strong><br>\nI am using Pulsar 2.8.0.<br>\nThe topic is partitioned, 3 partitions.<br>\nThe backlog quota is set to 50h<br>\nThe TTL is set to 48h.</p>\n<p dir=\"auto\">This is the second time that we observe this error. The application reads from 5 different topics, but only one topic has been affected twice.</p>\n<p dir=\"auto\">This is the topic with the highest traffic processed by the same application.  (Yet, our app is not really data intensive when compared to other use cases, it process less than 1 million events per hour)</p>\n<p dir=\"auto\">My application suddenly stopped processing messages, tries to reconnect but keeps getting errors about ZK BadVersion.</p>\n<p dir=\"auto\">[persistent://tenant/namespace/mytopic-partition-2] [platform_persistent://tenant/namespace/mytopic] Could not get connection to broker: java.util.concurrent.CompletionException: org.apache.pulsar.broker.service.BrokerServiceException$PersistenceException: org.apache.bookkeeper.mledger.ManagedLedgerException$BadVersionException: org.apache.pulsar.metadata.api.MetadataStoreException$BadVersionException: org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion for /managed-ledgers/tenant/namespace/persistent/my-topic-partition-2/platform_persistent%3A%2F%2Ftenant%2Fnamespace%2Fmytopic -- Will try again in 0.1 s</p>\n<p dir=\"auto\">We unloaded the topic and the application restarted processing messages. (The application did not need to be restarted).</p>\n<p dir=\"auto\">Any idea what causes this? How to prevent it.</p>\n<p dir=\"auto\"><strong>To Reproduce</strong><br>\nUnknown.</p>\n<p dir=\"auto\"><strong>Expected behavior</strong><br>\nI expected that the topic would be unloaded automatically, causing the clients to be able to reconnect to a new broker.</p>\n<p dir=\"auto\">** Logs<br>\nBroker:<br>\n09:13:45.822 [pulsar-io-4-2] WARN  org.apache.pulsar.broker.service.BrokerService - Namespace is being unloaded, cannot add topic persistent://platform/system/workflow-event-even-partition-0<br>\n09:13:45.823 [BookKeeperClientWorker-OrderedExecutor-1-0] WARN  org.apache.pulsar.broker.service.AbstractTopic - [persistent://platform/system/workflow-event-even-partition-0] Attempting to add producer to a fenced topic<br>\n09:13:45.823 [BookKeeperClientWorker-OrderedExecutor-1-0] ERROR org.apache.pulsar.broker.service.ServerCnx - [/10.42.105.16:49756] Failed to add producer to topic persistent://platform/system/workflow-event-even-partition-0: producerId=289578, org.apache.pulsar.broker.service.BrokerServiceException$TopicFencedException: Topic is temporarily unavailable<br>\n09:13:45.844 [ForkJoinPool.commonPool-worker-3] WARN  org.apache.pulsar.broker.service.BrokerService - Namespace bundle for topic (persistent://platform/system/workflow-event-even-partition-0) not served by this instance. Please redo the lookup. Request is denied: namespace=platform/system<br>\n09:13:45.854 [ForkJoinPool.commonPool-worker-3] WARN  org.apache.pulsar.broker.service.BrokerService - Namespace bundle for topic (persistent://platform/system/workflow-event-even-partition-0) not served by this instance. Please redo the lookup. Request is denied: namespace=platform/system<br>\n09:13:45.877 [pulsar-2-2] WARN  org.apache.pulsar.broker.loadbalance.impl.LeastLongTermMessageRate - Broker pulsar-broker-2.pulsar-broker.pulsar.svc.cluster.local:8080 is overloaded: CPU: 96.51538%, MEMORY: 51.04191%, DIRECT MEMORY: 12.5%, BANDWIDTH IN: 2.6368966%, BANDWIDTH OUT: 0.3707455%<br>\n09:13:45.877 [pulsar-2-2] WARN  org.apache.pulsar.broker.loadbalance.impl.LeastLongTermMessageRate - Broker <a href=\"http://pulsar-broker-2.pulsar-broker.pulsar.svc.cluster.local:8080\" rel=\"nofollow\">http://pulsar-broker-2.pulsar-broker.pulsar.svc.cluster.local:8080</a> is overloaded: max usage=0.9651538133621216</p>\n<p dir=\"auto\">09:28:46.277 [bookkeeper-ml-scheduler-OrderedScheduler-1-0] WARN  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [platform/system/persistent/workflow-event-even-partition-2] Failed to update consumer platform_persistent%3A%2F%2Fplatform%2Fsystem%2Fworkflow-event-even_queue<br>\nat org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl$7.operationFailed(ManagedLedgerImpl.java:940) ~[io.streamnative-managed-ledger-2.8.2.0.jar:2.8.2.0]<br>\nat org.apache.bookkeeper.util.SafeRunnable$1.safeRun(SafeRunnable.java:43) [org.apache.bookkeeper-bookkeeper-server-4.14.3.jar:4.14.3]<br>\n09:28:46.281 [bookkeeper-ml-scheduler-OrderedScheduler-1-0] ERROR org.apache.pulsar.broker.service.persistent.PersistentTopic - [persistent://platform/system/workflow-event-even-partition-2] Failed to create subscription: platform_persistent://platform/system/workflow-event-even_queue<br>\njava.util.concurrent.CompletionException: org.apache.pulsar.broker.service.BrokerServiceException$PersistenceException: org.apache.bookkeeper.mledger.ManagedLedgerException$BadVersionException: org.apache.pulsar.metadata.api.MetadataStoreException$BadVersionException: org.apache.zookeeper.KeeperException$BadVersionException: KeeperErrorCode = BadVersion for /managed-ledgers/platform/system/persistent/workflow-event-even-partition-2/platform_persistent%3A%2F%2Fplatform%2Fsystem%2Fworkflow-event-even_queue<br>\nat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:704) ~[?:?]<br>\nat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:506) ~[?:?]<br>\nat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088) ~[?:?]<br>\nat org.apache.pulsar.broker.service.persistent.PersistentTopic$3.openCursorFailed(PersistentTopic.java:887) ~[io.streamnative-pulsar-broker-2.8.2.0.jar:2.8.2.0]<br>\nat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$2.operationFailed(ManagedCursorImpl.java:567) ~[io.streamnative-managed-ledger-2.8.2.0.jar:2.8.2.0]<br>\nat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$23.operationFailed(ManagedCursorImpl.java:2348) ~[io.streamnative-managed-ledger-2.8.2.0.jar:2.8.2.0]</p>\n<p dir=\"auto\">At the time this occurred, I saw long GC in a ZK node:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/1891405/159366581-dc2a518b-f1b9-4ef1-bf5c-bf52b64aa6eb.png\"><img width=\"333\" alt=\"image\" src=\"https://user-images.githubusercontent.com/1891405/159366581-dc2a518b-f1b9-4ef1-bf5c-bf52b64aa6eb.png\" style=\"max-width: 100%;\"></a></p>",
                "resourcePath": "/apache/pulsar/issues/14779",
                "createdAt": "2022-03-21T21:26:34Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "lifecycle/stale"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][offload] use filesystem offloader with class not found error",
        "url": "https://github.com/apache/pulsar/pull/20365",
        "resourcePath": "/apache/pulsar/pull/20365",
        "createdAt": "2023-05-21T09:13:43Z",
        "number": 20365,
        "mergeCommit": {
          "oid": "56ce296e6ee9f9051c124d2f87cc01f58e0cbbcf",
          "message": "[fix][offload] Filesystem offloader class not found hadoop-hdfs-client (#20365)",
          "commitUrl": "https://github.com/apache/pulsar/commit/56ce296e6ee9f9051c124d2f87cc01f58e0cbbcf",
          "parents": {
            "nodes": [
              {
                "oid": "1220b5091f88620700f3be4adc097f845c8a9377",
                "message": "[fix][txn] Use PulsarResource  check for topic existence instead of brokerservice.getTopic() (#20569)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tiered-storage/file-system/pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Q89Jz2gAoM2ZiMGU4ZmM0MzJlODQ2NTdiNmEyYTg5NWE3ZjA0Y2U4YzZjMzE3Ng",
                "url": "https://github.com/apache/pulsar/pull/20365/commits/3fb0e8fc432e84657b6a2a895a7f04ce8c6c3176"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 16955,
                "url": "https://github.com/apache/pulsar/issues/16955",
                "title": "Failed to start standalone pulsar service with tiered storage due to class not found problem ",
                "bodyHTML": "<p dir=\"auto\"><strong>Describe the bug</strong><br>\nFailed to start standalone pulsar service with tiered storage due to class not found problem :<br>\nERROR org.apache.pulsar.broker.PulsarService - Failed to start Pulsar service: java.lang.RuntimeException: java.lang.ClassNotFoundException: Class org.apache.hadoop.hdfs.DistributedFileSystem not found</p>\n<p dir=\"auto\"><strong>To Reproduce</strong><br>\nSteps to reproduce the behavior:</p>\n<ol dir=\"auto\">\n<li>config hdfs tiered storage by following the steps described in <a href=\"https://pulsar.apache.org/docs/cookbooks-tiered-storage/\" rel=\"nofollow\">https://pulsar.apache.org/docs/cookbooks-tiered-storage/</a>, and ensure that offloader nar files in the offloader directory<br>\n2 log shows that 2 offloader nar files are loaded as :</li>\n</ol>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/3608828/183021551-65777e23-3ca6-406b-8d5a-5e93cceb3d7d.png\"><img src=\"https://user-images.githubusercontent.com/3608828/183021551-65777e23-3ca6-406b-8d5a-5e93cceb3d7d.png\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<ol start=\"3\" dir=\"auto\">\n<li>start standalone pulsar service: ./bin/pulsar standalone</li>\n<li>an exception is thrown</li>\n</ol>\n<p dir=\"auto\"><strong>Expected behavior</strong><br>\nservice starts and runs normally at least</p>\n<p dir=\"auto\"><strong>Screenshots</strong><br>\nIf applicable, add screenshots to help explain your problem.</p>\n<p dir=\"auto\"><strong>Desktop (please complete the following information):</strong></p>\n<ul dir=\"auto\">\n<li>OS:  linux</li>\n</ul>\n<p dir=\"auto\"><strong>Additional context</strong><br>\nAdd any other context about the problem here.</p>",
                "resourcePath": "/apache/pulsar/issues/16955",
                "createdAt": "2022-08-05T07:08:44Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky test NonPersistentTopicTest.testMsgDropStat",
        "url": "https://github.com/apache/pulsar/pull/20387",
        "resourcePath": "/apache/pulsar/pull/20387",
        "createdAt": "2023-05-24T11:36:35Z",
        "number": 20387,
        "mergeCommit": {
          "oid": "903425be3afbbcfeb0a7213b0b7d04afe5868151",
          "message": "[fix][test] Fix flaky test NonPersistentTopicTest.testMsgDropStat (#20387)",
          "commitUrl": "https://github.com/apache/pulsar/commit/903425be3afbbcfeb0a7213b0b7d04afe5868151",
          "parents": {
            "nodes": [
              {
                "oid": "aff4a1c7edbf019d17795c7a67b1d0f0e701d118",
                "message": "[fix][broker] Fix flaky test - testClusterMigrationWithReplica\u2026 (#20379)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/NonPersistentTopicTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5RPJ0X2gAoM2YwMDA3MDYwZGRkNzMwOWY5MTJmZjc4ZTk0ZDk3ZjgxNzY0YTNkNw",
                "url": "https://github.com/apache/pulsar/pull/20387/commits/3f0007060ddd7309f912ff78e94d97f81764a3d7"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20386,
                "url": "https://github.com/apache/pulsar/issues/20386",
                "title": "Flaky-test: NonPersistentTopicTest.testMsgDropStat",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/5067587816/jobs/9099067231#step:10:1471\">https://github.com/apache/pulsar/actions/runs/5067587816/jobs/9099067231#step:10:1471</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 151, Failures: 1, Errors: 0, Skipped: 145, Time elapsed: 61.004 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.client.api.NonPersistentTopicTest\n  Error:  org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat  Time elapsed: 2.251 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [true] but found [false]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertTrue(Assert.java:56)\n  \tat org.testng.Assert.assertTrue(Assert.java:66)\n  \tat org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat(NonPersistentTopicTest.java:859)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 151, Failures: 1, Errors: 0, Skipped: 145, Time elapsed: 61.004 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.client.api.NonPersistentTopicTest\n  Error:  org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat  Time elapsed: 2.251 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [true] but found [false]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertTrue(Assert.java:56)\n  \tat org.testng.Assert.assertTrue(Assert.java:66)\n  \tat org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat(NonPersistentTopicTest.java:859)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20386",
                "createdAt": "2023-05-24T11:20:55Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] partitioned __change_events topic is policy topic",
        "url": "https://github.com/apache/pulsar/pull/20392",
        "resourcePath": "/apache/pulsar/pull/20392",
        "createdAt": "2023-05-24T22:04:26Z",
        "number": 20392,
        "mergeCommit": {
          "oid": "9918bced4465e0b0746a7959550c90cb76ae945f",
          "message": "[fix][broker] partitioned __change_events topic is policy topic (#20392)",
          "commitUrl": "https://github.com/apache/pulsar/commit/9918bced4465e0b0746a7959550c90cb76ae945f",
          "parents": {
            "nodes": [
              {
                "oid": "545abfc428eab8dfb93314e1051c47d0f026fadf",
                "message": "[improve][doc] Improve doc for delayed message (#20374)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/naming/SystemTopicNames.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-common/src/test/java/org/apache/pulsar/common/naming/SystemTopicNamesTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5RSold2gAoZjg1MjUyMTRmMjczMWVjNTA1YjBlMzY1YWRiZTI0MWMxMjA1YjE2NQ",
                "url": "https://github.com/apache/pulsar/pull/20392/commits/f8525214f2731ec505b0e365adbe241c1205b165"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20376,
                "url": "https://github.com/apache/pulsar/issues/20376",
                "title": "Flaky-test:  AdminApi2Test.resetClusters",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/5056774399/jobs/9075132818?pr=20372#step:10:1446\">https://github.com/apache/pulsar/actions/runs/5056774399/jobs/9075132818?pr=20372#step:10:1446</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 82, Failures: 1, Errors: 0, Skipped: 55, Time elapsed: 660.065 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.admin.AdminApi2Test\n  Error:  org.apache.pulsar.broker.admin.AdminApi2Test.resetClusters  Time elapsed: 2.209 s  &lt;&lt;&lt; FAILURE!\n  org.apache.pulsar.client.admin.PulsarAdminException$ServerSideErrorException: \n  \n   --- An unexpected error occurred in the server ---\n  \n  Message: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \n  Stacktrace:\n  \n  org.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\n  \tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\n  \tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\n  \tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n  \tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\n  \tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\n  \t... 14 more\n  \n  \tat org.apache.pulsar.client.admin.PulsarAdminException.wrap(PulsarAdminException.java:252)\n  \tat org.apache.pulsar.client.admin.internal.BaseResource.sync(BaseResource.java:352)\n  \tat org.apache.pulsar.client.admin.internal.TenantsImpl.deleteTenant(TenantsImpl.java:93)\n  \tat org.apache.pulsar.broker.admin.AdminApi2Test.resetClusters(AdminApi2Test.java:181)\n  \tat jdk.internal.reflect.GeneratedMethodAccessor548.invoke(Unknown Source)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n  \tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n  \tat org.testng.internal.invokers.TestInvoker.runAfterConfigurations(TestInvoker.java:792)\n  \tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:768)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n  \tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n  \tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n  \tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n  \tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n  \tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n  \tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n  \tat org.testng.TestRunner.run(TestRunner.java:602)\n  \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n  \tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n  \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n  \tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n  \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n  \tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n  \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n  \tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n  \tat org.testng.TestNG.runSuites(TestNG.java:1099)\n  \tat org.testng.TestNG.run(TestNG.java:1067)\n  \tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n  \tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n  \tSuppressed: org.apache.pulsar.client.admin.PulsarAdminException$ServerSideErrorException: \n   --- An unexpected error occurred in the server ---\n  \n  Message: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \n  Stacktrace:\n  \n  org.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\n  \tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\n  \tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\n  \tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n  \tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\n  \tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\n  \t... 14 more\n  \n  \t\tat org.apache.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:272)\n  \t\tat org.apache.pulsar.client.admin.internal.BaseResource$4.failed(BaseResource.java:237)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation$1.failed(JerseyInvocation.java:882)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation$1.completed(JerseyInvocation.java:863)\n  \t\tat org.glassfish.jersey.client.ClientRuntime.processResponse(ClientRuntime.java:229)\n  \t\tat org.glassfish.jersey.client.ClientRuntime.access$200(ClientRuntime.java:62)\n  \t\tat org.glassfish.jersey.client.ClientRuntime$2.lambda$response$0(ClientRuntime.java:173)\n  \t\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)\n  \t\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:292)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:274)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:244)\n  \t\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:288)\n  \t\tat org.glassfish.jersey.client.ClientRuntime$2.response(ClientRuntime.java:173)\n  \t\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$apply$1(AsyncHttpConnector.java:254)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n  \t\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \t\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$retryOperation$4(AsyncHttpConnector.java:296)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n  \t\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \t\tat org.asynchttpclient.netty.NettyResponseFuture.loadContent(NettyResponseFuture.java:222)\n  \t\tat org.asynchttpclient.netty.NettyResponseFuture.done(NettyResponseFuture.java:257)\n  \t\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.finishUpdate(AsyncHttpClientHandler.java:241)\n  \t\tat org.asynchttpclient.netty.handler.HttpHandler.handleChunk(HttpHandler.java:114)\n  \t\tat org.asynchttpclient.netty.handler.HttpHandler.handleRead(HttpHandler.java:143)\n  \t\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.channelRead(AsyncHttpClientHandler.java:78)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelRead(CombinedChannelDuplexHandler.java:436)\n  \t\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)\n  \t\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)\n  \t\tat io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:251)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n  \t\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n  \t\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n  \t\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\n  \t\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n  \t\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \t\tat java.base/java.lang.Thread.run(Thread.java:833)\n  \tCaused by: javax.ws.rs.InternalServerErrorException: HTTP 500 {&quot;reason&quot;:&quot;\\n --- An unexpected error occurred in the server ---\\n\\nMessage: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\nStacktrace:\\n\\norg.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\\n\\tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\\n\\tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\\n\\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\\n\\tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\\n\\tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\\n\\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\\n\\tat java.base/java.lang.Thread.run(Thread.java:833)\\nCaused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\\n\\t... 14 more\\n&quot;}\n  \t\tat org.glassfish.jersey.client.JerseyInvocation.convertToException(JerseyInvocation.java:960)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation.access$700(JerseyInvocation.java:82)\n  \t\t... 54 more\n  Caused by: [CIRCULAR REFERENCE: javax.ws.rs.InternalServerErrorException: HTTP 500 {&quot;reason&quot;:&quot;\\n --- An unexpected error occurred in the server ---\\n\\nMessage: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\nStacktrace:\\n\\norg.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\\n\\tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\\n\\tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\\n\\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\\n\\tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\\n\\tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\\n\\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\\n\\tat java.base/java.lang.Thread.run(Thread.java:833)\\nCaused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\\n\\t... 14 more\\n&quot;}]\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 82, Failures: 1, Errors: 0, Skipped: 55, Time elapsed: 660.065 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.admin.AdminApi2Test\n  Error:  org.apache.pulsar.broker.admin.AdminApi2Test.resetClusters  Time elapsed: 2.209 s  &lt;&lt;&lt; FAILURE!\n  org.apache.pulsar.client.admin.PulsarAdminException$ServerSideErrorException: \n  \n   --- An unexpected error occurred in the server ---\n  \n  Message: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \n  Stacktrace:\n  \n  org.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\n  \tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\n  \tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\n  \tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n  \tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\n  \tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\n  \t... 14 more\n  \n  \tat org.apache.pulsar.client.admin.PulsarAdminException.wrap(PulsarAdminException.java:252)\n  \tat org.apache.pulsar.client.admin.internal.BaseResource.sync(BaseResource.java:352)\n  \tat org.apache.pulsar.client.admin.internal.TenantsImpl.deleteTenant(TenantsImpl.java:93)\n  \tat org.apache.pulsar.broker.admin.AdminApi2Test.resetClusters(AdminApi2Test.java:181)\n  \tat jdk.internal.reflect.GeneratedMethodAccessor548.invoke(Unknown Source)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n  \tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n  \tat org.testng.internal.invokers.TestInvoker.runAfterConfigurations(TestInvoker.java:792)\n  \tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:768)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n  \tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n  \tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n  \tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n  \tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n  \tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n  \tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n  \tat org.testng.TestRunner.run(TestRunner.java:602)\n  \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n  \tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n  \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n  \tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n  \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n  \tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n  \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n  \tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n  \tat org.testng.TestNG.runSuites(TestNG.java:1099)\n  \tat org.testng.TestNG.run(TestNG.java:1067)\n  \tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n  \tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n  \tSuppressed: org.apache.pulsar.client.admin.PulsarAdminException$ServerSideErrorException: \n   --- An unexpected error occurred in the server ---\n  \n  Message: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \n  Stacktrace:\n  \n  org.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\n  \tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\n  \tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\n  \tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n  \tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\n  \tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\n  \t... 14 more\n  \n  \t\tat org.apache.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:272)\n  \t\tat org.apache.pulsar.client.admin.internal.BaseResource$4.failed(BaseResource.java:237)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation$1.failed(JerseyInvocation.java:882)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation$1.completed(JerseyInvocation.java:863)\n  \t\tat org.glassfish.jersey.client.ClientRuntime.processResponse(ClientRuntime.java:229)\n  \t\tat org.glassfish.jersey.client.ClientRuntime.access$200(ClientRuntime.java:62)\n  \t\tat org.glassfish.jersey.client.ClientRuntime$2.lambda$response$0(ClientRuntime.java:173)\n  \t\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)\n  \t\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:292)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:274)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:244)\n  \t\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:288)\n  \t\tat org.glassfish.jersey.client.ClientRuntime$2.response(ClientRuntime.java:173)\n  \t\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$apply$1(AsyncHttpConnector.java:254)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n  \t\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \t\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$retryOperation$4(AsyncHttpConnector.java:296)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n  \t\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \t\tat org.asynchttpclient.netty.NettyResponseFuture.loadContent(NettyResponseFuture.java:222)\n  \t\tat org.asynchttpclient.netty.NettyResponseFuture.done(NettyResponseFuture.java:257)\n  \t\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.finishUpdate(AsyncHttpClientHandler.java:241)\n  \t\tat org.asynchttpclient.netty.handler.HttpHandler.handleChunk(HttpHandler.java:114)\n  \t\tat org.asynchttpclient.netty.handler.HttpHandler.handleRead(HttpHandler.java:143)\n  \t\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.channelRead(AsyncHttpClientHandler.java:78)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelRead(CombinedChannelDuplexHandler.java:436)\n  \t\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)\n  \t\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)\n  \t\tat io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:251)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n  \t\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n  \t\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n  \t\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\n  \t\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n  \t\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \t\tat java.base/java.lang.Thread.run(Thread.java:833)\n  \tCaused by: javax.ws.rs.InternalServerErrorException: HTTP 500 {\"reason\":\"\\n --- An unexpected error occurred in the server ---\\n\\nMessage: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\nStacktrace:\\n\\norg.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\\n\\tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\\n\\tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\\n\\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\\n\\tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\\n\\tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\\n\\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\\n\\tat java.base/java.lang.Thread.run(Thread.java:833)\\nCaused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\\n\\t... 14 more\\n\"}\n  \t\tat org.glassfish.jersey.client.JerseyInvocation.convertToException(JerseyInvocation.java:960)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation.access$700(JerseyInvocation.java:82)\n  \t\t... 54 more\n  Caused by: [CIRCULAR REFERENCE: javax.ws.rs.InternalServerErrorException: HTTP 500 {\"reason\":\"\\n --- An unexpected error occurred in the server ---\\n\\nMessage: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\nStacktrace:\\n\\norg.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\\n\\tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\\n\\tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\\n\\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\\n\\tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\\n\\tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\\n\\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\\n\\tat java.base/java.lang.Thread.run(Thread.java:833)\\nCaused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\\n\\t... 14 more\\n\"}]\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20376",
                "createdAt": "2023-05-23T14:43:28Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix stuck subscription due to cursor recovery timeout",
        "url": "https://github.com/apache/pulsar/pull/20394",
        "resourcePath": "/apache/pulsar/pull/20394",
        "createdAt": "2023-05-24T23:48:43Z",
        "number": 20394,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedCursorTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5RS5872gAoNzNhMDQyMDUyNDg3NzU1YzUwODdjY2IxZDcyZTZkNDQ4YTZkZjZhOA",
                "url": "https://github.com/apache/pulsar/pull/20394/commits/73a042052487755c5087ccb1d72e6d448a6df6a8"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20393,
                "url": "https://github.com/apache/pulsar/issues/20393",
                "title": "[Bug] Broker stuck to create subscription and client fails to create consumer",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<blockquote>\n<p dir=\"auto\">pulsar-2.10, 2.11</p>\n</blockquote>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Sometime Broker tries to recover the topic cursor and couldn't create subscription successfully which causes consumer creation stuck at broker and client application times out and fails to subscribe on topic.</li>\n<li>Broker log</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"05:50:28.411 [pulsar-io-4-32] INFO  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:38126] Subscribing on topic persistent://pulsar/use1/myns/topic-1 / my-sub\n05:50:28.411 [pulsar-io-4-32] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [pulsar/use1/myns/persistent/topic-1] Cursor my-sub recovered to position 52505149:179\n05:50:28.412 [pulsar-io-4-32] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [pulsar/use1/myns/persistent/topic-1] Consumer my-sub cursor initialized with counters: consumed 0 mdPos 52505149:179 rdPos 52505149:180\n05:50:28.412 [pulsar-io-4-32] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [pulsar/use1/myns/persistent/topic-1] Creating ledger, metadata: {component=[109, 97, 110, 97, 103, 101, 100, 45, 108, 101, 100, 103, 101, 114], pulsar/managed-ledger=[112, 117, 108, 115, 97, 114, 47, 112, 115, 116, 103, 45, 103, 113, 49, 47, 112, 115, 116, 103, 49, 45, 98, 114, 111, 107, 101, 114, 50, 46, 109, 101, 115, 115, 97, 103, 105, 110, 103, 46, 103, 113, 49, 46, 121, 97, 104, 111, 111, 46, 99, 111, 109, 58, 52, 48, 56, 48, 47, 112, 101, 114, 115, 105, 115, 116, 101, 110, 116, 47, 115, 97, 110, 105, 116, 121, 84, 101, 115, 116, 84, 111, 112, 105, 99, 45, 49], pulsar/cursor=[115, 97, 110, 105, 116, 121, 83, 117, 98], application=[112, 117, 108, 115, 97, 114]} - metadata ops timeout : 60 seconds\n05:50:28.421 [main-EventThread] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [pulsar/use1/myns/persistent/topic-1] Created ledger 52506173 for cursor my-sub\n05:50:29.860 [bookkeeper-ml-scheduler-OrderedScheduler-5-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [pulsar/use1/myns/persistent/topic-1] Ledger already created when timeout task is triggered\n05:51:28.412 [bookkeeper-ml-scheduler-OrderedScheduler-2-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [pulsar/use1/myns/persistent/topic-1] Ledger already created when timeout task is triggered\n05:51:40.443 [pulsar-io-4-2] INFO  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:38174] Subscribing on topic persistent://pulsar/use1/myns/topic-1 / my-sub\n05:53:47.732 [pulsar-io-4-5] INFO  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:38206] Subscribing on topic persistent://pulsar/use1/myns/topic-1 / my-sub\n05:55:55.171 [pulsar-io-4-8] INFO  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:38238] Subscribing on topic persistent://pulsar/use1/myns/topic-1 / my-sub\n05:58:02.655 [pulsar-io-4-11] INFO  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:38316] Subscribing on topic persistent://pulsar/use1/myns/topic-1 / my-sub\n06:00:10.991 [pulsar-io-4-13] INFO  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:38348] Subscribing on topic persistent://pulsar/use1/myns/topic-1 / my-sub\"><pre class=\"notranslate\"><code class=\"notranslate\">05:50:28.411 [pulsar-io-4-32] INFO  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:38126] Subscribing on topic persistent://pulsar/use1/myns/topic-1 / my-sub\n05:50:28.411 [pulsar-io-4-32] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [pulsar/use1/myns/persistent/topic-1] Cursor my-sub recovered to position 52505149:179\n05:50:28.412 [pulsar-io-4-32] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [pulsar/use1/myns/persistent/topic-1] Consumer my-sub cursor initialized with counters: consumed 0 mdPos 52505149:179 rdPos 52505149:180\n05:50:28.412 [pulsar-io-4-32] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [pulsar/use1/myns/persistent/topic-1] Creating ledger, metadata: {component=[109, 97, 110, 97, 103, 101, 100, 45, 108, 101, 100, 103, 101, 114], pulsar/managed-ledger=[112, 117, 108, 115, 97, 114, 47, 112, 115, 116, 103, 45, 103, 113, 49, 47, 112, 115, 116, 103, 49, 45, 98, 114, 111, 107, 101, 114, 50, 46, 109, 101, 115, 115, 97, 103, 105, 110, 103, 46, 103, 113, 49, 46, 121, 97, 104, 111, 111, 46, 99, 111, 109, 58, 52, 48, 56, 48, 47, 112, 101, 114, 115, 105, 115, 116, 101, 110, 116, 47, 115, 97, 110, 105, 116, 121, 84, 101, 115, 116, 84, 111, 112, 105, 99, 45, 49], pulsar/cursor=[115, 97, 110, 105, 116, 121, 83, 117, 98], application=[112, 117, 108, 115, 97, 114]} - metadata ops timeout : 60 seconds\n05:50:28.421 [main-EventThread] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [pulsar/use1/myns/persistent/topic-1] Created ledger 52506173 for cursor my-sub\n05:50:29.860 [bookkeeper-ml-scheduler-OrderedScheduler-5-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [pulsar/use1/myns/persistent/topic-1] Ledger already created when timeout task is triggered\n05:51:28.412 [bookkeeper-ml-scheduler-OrderedScheduler-2-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [pulsar/use1/myns/persistent/topic-1] Ledger already created when timeout task is triggered\n05:51:40.443 [pulsar-io-4-2] INFO  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:38174] Subscribing on topic persistent://pulsar/use1/myns/topic-1 / my-sub\n05:53:47.732 [pulsar-io-4-5] INFO  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:38206] Subscribing on topic persistent://pulsar/use1/myns/topic-1 / my-sub\n05:55:55.171 [pulsar-io-4-8] INFO  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:38238] Subscribing on topic persistent://pulsar/use1/myns/topic-1 / my-sub\n05:58:02.655 [pulsar-io-4-11] INFO  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:38316] Subscribing on topic persistent://pulsar/use1/myns/topic-1 / my-sub\n06:00:10.991 [pulsar-io-4-13] INFO  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:38348] Subscribing on topic persistent://pulsar/use1/myns/topic-1 / my-sub\n</code></pre></div>\n<ol start=\"4\" dir=\"auto\">\n<li>client logs while creating subscription</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-05-19 05:51:40 [pulsar-client-io-8-1] INFO  o.a.pulsar.client.impl.ConsumerImpl - [persistent://pulsar/use1/myns/topic-1][my-sub] Subscribing to topic on cnx\n [id: 0xdcb4fbde, L:/1.1.1.1:38174 - R:broker2.use1.pulsar.com/1.1.1.1:6651], consumerId 0\n2023-05-19 05:52:10 [pulsar-client-io-8-1] DEBUG o.a.p.common.protocol.PulsarDecoder - [broker2.use1.pulsar.com/1.1.1.1:6651] Received cmd PING\n2023-05-19 05:52:10 [pulsar-client-io-8-1] DEBUG o.a.p.common.protocol.PulsarHandler - [[id: 0xdcb4fbde, L:/1.1.1.1:38174 - R:broker2.use1.pulsar.com/1.1.1.1:6651]] Replying back to ping mess\nage\n2023-05-19 05:52:10 [pulsar-client-io-8-1] DEBUG o.a.p.common.protocol.PulsarHandler - [[id: 0xdcb4fbde, L:/1.1.1.1:38174 - R:broker2.use1.pulsar.com/1.1.1.1:6651]] Sending ping message\n2023-05-19 05:52:10 [pulsar-client-io-8-1] DEBUG o.a.p.common.protocol.PulsarDecoder - [broker2.use1.pulsar.com/1.1.1.1:6651] Received cmd PONG\n2023-05-19 05:52:40 [pulsar-client-io-8-1] DEBUG o.a.p.common.protocol.PulsarDecoder - [broker2.use1.pulsar.com/1.1.1.1:6651] Received cmd PING\n2023-05-19 05:52:40 [pulsar-client-io-8-1] DEBUG o.a.p.common.protocol.PulsarHandler - [[id: 0xdcb4fbde, L:/1.1.1.1:38174 - R:broker2.use1.pulsar.com/1.1.1.1:6651]] Replying back to ping mess\nage\n2023-05-19 05:52:40 [pulsar-client-io-8-1] DEBUG o.a.p.common.protocol.PulsarHandler - [[id: 0xdcb4fbde, L:/1.1.1.1:38174 - R:broker2.use1.pulsar.com/1.1.1.1:6651]] Sending ping message\n2023-05-19 05:52:40 [pulsar-client-io-8-1] WARN  o.a.pulsar.client.impl.ConsumerImpl - [persistent://pulsar/use1/myns/topic-1][my-sub] Failed to subscribe to topi\nc on broker2.use1.pulsar.com/1.1.1.1:6651\n2023-05-19 05:52:40 [pulsar-client-io-8-1] WARN  o.a.pulsar.client.impl.ClientCnx - [id: 0xdcb4fbde, L:/1.1.1.1:38174 - R:broker2.use1.pulsar.com/1.1.1.1:6651] request timeout {'durationMs': \n'30000', 'reqId':'3312998569082859124', 'remote':'broker2.use1.pulsar.com/1.1.1.1:6651', 'local':'/1.1.1.1:38174'}\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-05-19 05:51:40 [pulsar-client-io-8-1] INFO  o.a.pulsar.client.impl.ConsumerImpl - [persistent://pulsar/use1/myns/topic-1][my-sub] Subscribing to topic on cnx\n [id: 0xdcb4fbde, L:/1.1.1.1:38174 - R:broker2.use1.pulsar.com/1.1.1.1:6651], consumerId 0\n2023-05-19 05:52:10 [pulsar-client-io-8-1] DEBUG o.a.p.common.protocol.PulsarDecoder - [broker2.use1.pulsar.com/1.1.1.1:6651] Received cmd PING\n2023-05-19 05:52:10 [pulsar-client-io-8-1] DEBUG o.a.p.common.protocol.PulsarHandler - [[id: 0xdcb4fbde, L:/1.1.1.1:38174 - R:broker2.use1.pulsar.com/1.1.1.1:6651]] Replying back to ping mess\nage\n2023-05-19 05:52:10 [pulsar-client-io-8-1] DEBUG o.a.p.common.protocol.PulsarHandler - [[id: 0xdcb4fbde, L:/1.1.1.1:38174 - R:broker2.use1.pulsar.com/1.1.1.1:6651]] Sending ping message\n2023-05-19 05:52:10 [pulsar-client-io-8-1] DEBUG o.a.p.common.protocol.PulsarDecoder - [broker2.use1.pulsar.com/1.1.1.1:6651] Received cmd PONG\n2023-05-19 05:52:40 [pulsar-client-io-8-1] DEBUG o.a.p.common.protocol.PulsarDecoder - [broker2.use1.pulsar.com/1.1.1.1:6651] Received cmd PING\n2023-05-19 05:52:40 [pulsar-client-io-8-1] DEBUG o.a.p.common.protocol.PulsarHandler - [[id: 0xdcb4fbde, L:/1.1.1.1:38174 - R:broker2.use1.pulsar.com/1.1.1.1:6651]] Replying back to ping mess\nage\n2023-05-19 05:52:40 [pulsar-client-io-8-1] DEBUG o.a.p.common.protocol.PulsarHandler - [[id: 0xdcb4fbde, L:/1.1.1.1:38174 - R:broker2.use1.pulsar.com/1.1.1.1:6651]] Sending ping message\n2023-05-19 05:52:40 [pulsar-client-io-8-1] WARN  o.a.pulsar.client.impl.ConsumerImpl - [persistent://pulsar/use1/myns/topic-1][my-sub] Failed to subscribe to topi\nc on broker2.use1.pulsar.com/1.1.1.1:6651\n2023-05-19 05:52:40 [pulsar-client-io-8-1] WARN  o.a.pulsar.client.impl.ClientCnx - [id: 0xdcb4fbde, L:/1.1.1.1:38174 - R:broker2.use1.pulsar.com/1.1.1.1:6651] request timeout {'durationMs': \n'30000', 'reqId':'3312998569082859124', 'remote':'broker2.use1.pulsar.com/1.1.1.1:6651', 'local':'/1.1.1.1:38174'}\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">sometime broker stucks to create subscription and it can be only fixed by unloading the topic</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">broker should be resilient to handle failure and should make sure to recover curosr and create subscription successfully without impacting availability of the topic.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20393",
                "createdAt": "2023-05-24T23:20:38Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[Fix] [Txn] unwrap the completion exception.",
        "url": "https://github.com/apache/pulsar/pull/20396",
        "resourcePath": "/apache/pulsar/pull/20396",
        "createdAt": "2023-05-25T06:35:30Z",
        "number": 20396,
        "mergeCommit": {
          "oid": "7ea8741af265bd8554e7a52a29a4ed59cb749dea",
          "message": "[Fix][Txn] Unwrap the completion exception. (#20396)",
          "commitUrl": "https://github.com/apache/pulsar/commit/7ea8741af265bd8554e7a52a29a4ed59cb749dea",
          "parents": {
            "nodes": [
              {
                "oid": "a26cf3eb78858ef5638650b6dbd7dab1f76a8c61",
                "message": "[fix][test] Fix flaky test NonPersistentTopicTest.testMsgDropStat, 3rd attempt (#20429)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/TransactionMetadataStoreService.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5RT5df2gAoMTMyNTk4MzBjNGFiZTYwZjY5YmUzZDViMzc5NTlmMzYxOTYyNmNkZg",
                "url": "https://github.com/apache/pulsar/pull/20396/commits/13259830c4abe60f69be3d5b37959f3619626cdf"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20395,
                "url": "https://github.com/apache/pulsar/issues/20395",
                "title": "[Bug] [Txn] Unwrap the realCause from CompletionException",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">org.apache.pulsar.broker.TransactionMetadataStoreService#handleTcClientConnect<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/52550727/240822479-aa1013f0-d34b-454c-bdb2-3dc392359169.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzE0MDEsIm5iZiI6MTcxNDk3MTEwMSwicGF0aCI6Ii81MjU1MDcyNy8yNDA4MjI0NzktYWExMDEzZjAtZDM0Yi00NTRjLWJkYjItM2RjMzkyMzU5MTY5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA0NTE0MVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWRhYjczYjQ0ZWVkMWQwZTE3YTQ2ZTYzZGVkZjIyMzBkYjBjYWE1YjE2Y2FlMzkyNTlkNmU1OTE4ZWY2YjUzOTQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.XsoIAxu_S80fPwkDhS-DfD-XEtUE7GyKmOvbbvn2-JU\"><img src=\"https://private-user-images.githubusercontent.com/52550727/240822479-aa1013f0-d34b-454c-bdb2-3dc392359169.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzE0MDEsIm5iZiI6MTcxNDk3MTEwMSwicGF0aCI6Ii81MjU1MDcyNy8yNDA4MjI0NzktYWExMDEzZjAtZDM0Yi00NTRjLWJkYjItM2RjMzkyMzU5MTY5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA0NTE0MVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWRhYjczYjQ0ZWVkMWQwZTE3YTQ2ZTYzZGVkZjIyMzBkYjBjYWE1YjE2Y2FlMzkyNTlkNmU1OTE4ZWY2YjUzOTQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.XsoIAxu_S80fPwkDhS-DfD-XEtUE7GyKmOvbbvn2-JU\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">The real cause may be wrapped in the CompletionException, we should unwrap the real cause from CompletionException and complete the request with real causes like this:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/52550727/240822725-bc0b3f5c-4379-4acf-9995-ec2de4ef5b6b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzE0MDEsIm5iZiI6MTcxNDk3MTEwMSwicGF0aCI6Ii81MjU1MDcyNy8yNDA4MjI3MjUtYmMwYjNmNWMtNDM3OS00YWNmLTk5OTUtZWMyZGU0ZWY1YjZiLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA0NTE0MVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTFjZWM2YThkZTM5ZmIwMjFmODU4ZGQ1ZjFjYTJkOGI3M2ZhY2JjYTRiMmFkNDMyZTYzNWM0MjhiMTliNGVmY2MmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.ZIdvNs3E_qgZbmXnCz8fwdJxiCMEZ0tPjOLS9DK-Qc8\"><img width=\"550\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/52550727/240822725-bc0b3f5c-4379-4acf-9995-ec2de4ef5b6b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzE0MDEsIm5iZiI6MTcxNDk3MTEwMSwicGF0aCI6Ii81MjU1MDcyNy8yNDA4MjI3MjUtYmMwYjNmNWMtNDM3OS00YWNmLTk5OTUtZWMyZGU0ZWY1YjZiLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA0NTE0MVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTFjZWM2YThkZTM5ZmIwMjFmODU4ZGQ1ZjFjYTJkOGI3M2ZhY2JjYTRiMmFkNDMyZTYzNWM0MjhiMTliNGVmY2MmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.ZIdvNs3E_qgZbmXnCz8fwdJxiCMEZ0tPjOLS9DK-Qc8\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20395",
                "createdAt": "2023-05-25T06:33:08Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][test] Implement broker integration test with entry metadata interceptors enabled",
        "url": "https://github.com/apache/pulsar/pull/20398",
        "resourcePath": "/apache/pulsar/pull/20398",
        "createdAt": "2023-05-25T08:00:02Z",
        "number": 20398,
        "mergeCommit": {
          "oid": "43fcf39ea6db3f157ab3c65a607504fa2e4cda15",
          "message": "[improve][test] Implement broker integration test with entry metadata interceptors enabled (#20398)",
          "commitUrl": "https://github.com/apache/pulsar/commit/43fcf39ea6db3f157ab3c65a607504fa2e4cda15",
          "parents": {
            "nodes": [
              {
                "oid": "ca00a83c13bf4ac8aab962b6e79a550a55f40bf5",
                "message": "[improve][build] add `--no-cache-dir` in dockerfile to disable the pip cache (#20477)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/bookkeeper/BrokerInstallWithEntryMetadataInterceptorsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5RUSEr2gAoYzRiNzM1YWUzYmI2MjAwNmM4MWU4YmQ3ZWU5YzlhMmIzYTVlYWQyZA",
                "url": "https://github.com/apache/pulsar/pull/20398/commits/c4b735ae3bb62006c81e8bd7ee9c9a2b3a5ead2d"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20091,
                "url": "https://github.com/apache/pulsar/issues/20091",
                "title": "[Bug] CI: pulsar does not run tests with interceptors enabled",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">3.0 RC 1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">similar to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1663293789\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20071\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/20071/hovercard\" href=\"https://github.com/apache/pulsar/issues/20071\">#20071</a></p>\n<p dir=\"auto\">See <a href=\"https://lists.apache.org/thread/f2fhvyx202xzxbho909j430h63yvwjlo\" rel=\"nofollow\">https://lists.apache.org/thread/f2fhvyx202xzxbho909j430h63yvwjlo</a></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Regression caught on CI</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">regression caught outside of CI</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20091",
                "createdAt": "2023-04-13T23:37:22Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky test NonPersistentTopicTest.testMsgDropStat, follow up",
        "url": "https://github.com/apache/pulsar/pull/20401",
        "resourcePath": "/apache/pulsar/pull/20401",
        "createdAt": "2023-05-25T08:45:55Z",
        "number": 20401,
        "mergeCommit": {
          "oid": "25c4b7cee402a1d486d720a71dc2e06aa6d9af64",
          "message": "[fix][test] Fix flaky test NonPersistentTopicTest.testMsgDropStat, follow up (#20401)\n\nFixes #20386\r\n\r\n### Motivation\r\n\r\n- the previous attempt #20387 to fix the flakiness wasn't effective\r\n\r\n### Modifications\r\n\r\n- improve the fix and rely on the fact that entryId is -1 when the message is dropped in the broker\r\n  code: https://github.com/apache/pulsar/blob/091ee2504ffbe6ec98e354b76e7f4c045e1914aa/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java#L1699-L1711\r\n\r\n### Documentation\r\n\r\n<!-- DO NOT REMOVE THIS SECTION. CHECK THE PROPER BOX ONLY. -->\r\n\r\n- [ ] `doc` <!-- Your PR contains doc changes. -->\r\n- [ ] `doc-required` <!-- Your PR changes impact docs and you will update later -->\r\n- [x] `doc-not-needed` <!-- Your PR changes do not impact docs -->\r\n- [ ] `doc-complete` <!-- Docs have been already added -->",
          "commitUrl": "https://github.com/apache/pulsar/commit/25c4b7cee402a1d486d720a71dc2e06aa6d9af64",
          "parents": {
            "nodes": [
              {
                "oid": "9918bced4465e0b0746a7959550c90cb76ae945f",
                "message": "[fix][broker] partitioned __change_events topic is policy topic (#20392)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/NonPersistentTopicTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5RUhrz2gAoYzY2M2U2NTRlYWFjNzQzOGU2NTdiMDQ2NjMwYzljMzJkYzZhZjgwZg",
                "url": "https://github.com/apache/pulsar/pull/20401/commits/c663e654eaac7438e657b046630c9c32dc6af80f"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20386,
                "url": "https://github.com/apache/pulsar/issues/20386",
                "title": "Flaky-test: NonPersistentTopicTest.testMsgDropStat",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/5067587816/jobs/9099067231#step:10:1471\">https://github.com/apache/pulsar/actions/runs/5067587816/jobs/9099067231#step:10:1471</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 151, Failures: 1, Errors: 0, Skipped: 145, Time elapsed: 61.004 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.client.api.NonPersistentTopicTest\n  Error:  org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat  Time elapsed: 2.251 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [true] but found [false]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertTrue(Assert.java:56)\n  \tat org.testng.Assert.assertTrue(Assert.java:66)\n  \tat org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat(NonPersistentTopicTest.java:859)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 151, Failures: 1, Errors: 0, Skipped: 145, Time elapsed: 61.004 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.client.api.NonPersistentTopicTest\n  Error:  org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat  Time elapsed: 2.251 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [true] but found [false]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertTrue(Assert.java:56)\n  \tat org.testng.Assert.assertTrue(Assert.java:66)\n  \tat org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat(NonPersistentTopicTest.java:859)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20386",
                "createdAt": "2023-05-24T11:20:55Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Go functions need to use static grpcPort in k8s runtime",
        "url": "https://github.com/apache/pulsar/pull/20404",
        "resourcePath": "/apache/pulsar/pull/20404",
        "createdAt": "2023-05-25T19:47:54Z",
        "number": 20404,
        "mergeCommit": {
          "oid": "7e6ca31dcb7bd04afff4daf50ac44be4749b6f2b",
          "message": "[fix][fn] Go functions need to use static grpcPort in k8s runtime (#20404)",
          "commitUrl": "https://github.com/apache/pulsar/commit/7e6ca31dcb7bd04afff4daf50ac44be4749b6f2b",
          "parents": {
            "nodes": [
              {
                "oid": "3b862ae614fae795e3312c0b298cc3c2b33a698f",
                "message": "[fix][ci] Fix OWASP dependency check suppressions (#20486)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/kubernetes/KubernetesRuntimeFactory.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/test/java/org/apache/pulsar/functions/runtime/kubernetes/KubernetesRuntimeTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5RYCzY2gAoYmY2MjQyYjYxZjhlYjdhNGJiYTIxYzYwOTQ1ZTRkMWU0YWRkYjIyMQ",
                "url": "https://github.com/apache/pulsar/pull/20404/commits/bf6242b61f8eb7a4bba21c60945e4d1e4addb221"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20403,
                "url": "https://github.com/apache/pulsar/issues/20403",
                "title": "[Bug] Unable to communicate with Go Pulsar functions using the Kubernetes runtime. ",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">When setting up functions to run as pods in the Kubernetes runtime, exported metrics work fine, but we are unable to get results from <code class=\"notranslate\">pulsar-admin functions get status</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"pulsar-admin functions status --tenant public --namespace default --name function_test_10\n{\n  &quot;numInstances&quot; : 1,\n  &quot;numRunning&quot; : 0,\n  &quot;instances&quot; : [ {\n    &quot;instanceId&quot; : 0,\n    &quot;status&quot; : {\n      &quot;running&quot; : false,\n      &quot;error&quot; : &quot;UNAVAILABLE: io exception&quot;,\n      &quot;numRestarts&quot; : 0,\n      &quot;numReceived&quot; : 0,\n      &quot;numSuccessfullyProcessed&quot; : 0,\n      &quot;numUserExceptions&quot; : 0,\n      &quot;latestUserExceptions&quot; : [ ],\n      &quot;numSystemExceptions&quot; : 0,\n      &quot;latestSystemExceptions&quot; : [ ],\n      &quot;averageLatency&quot; : 0.0,\n      &quot;lastInvocationTime&quot; : 0,\n      &quot;workerId&quot; : &quot;pulsar-function-0&quot;\n    }\n  } ]\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">pulsar-admin functions status --tenant public --namespace default --name function_test_10\n{\n  \"numInstances\" : 1,\n  \"numRunning\" : 0,\n  \"instances\" : [ {\n    \"instanceId\" : 0,\n    \"status\" : {\n      \"running\" : false,\n      \"error\" : \"UNAVAILABLE: io exception\",\n      \"numRestarts\" : 0,\n      \"numReceived\" : 0,\n      \"numSuccessfullyProcessed\" : 0,\n      \"numUserExceptions\" : 0,\n      \"latestUserExceptions\" : [ ],\n      \"numSystemExceptions\" : 0,\n      \"latestSystemExceptions\" : [ ],\n      \"averageLatency\" : 0.0,\n      \"lastInvocationTime\" : 0,\n      \"workerId\" : \"pulsar-function-0\"\n    }\n  } ]\n}\n</code></pre></div>\n<p dir=\"auto\">A look at the logs gives a clue as to why:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023/05/24 13:32:33.266 log.go:47: [info] Serving InstanceCommunication on port 44491 @flow_id=function_test_10\"><pre class=\"notranslate\"><code class=\"notranslate\">2023/05/24 13:32:33.266 log.go:47: [info] Serving InstanceCommunication on port 44491 @flow_id=function_test_10\n</code></pre></div>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Deploy a go function using the kubernetes function runtime.</li>\n<li>pulsar-admin functions status --tenant  --namespace  --name </li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Function status.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\"><code class=\"notranslate\">  \"error\" : \"UNAVAILABLE: io exception\",</code></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">I believe this happens because the instance config is falling back to the default of a random port, instead of setting the static <code class=\"notranslate\">grpcPort</code> of the <code class=\"notranslate\">KubernetesRuntimeFactory</code>. Python functions get the <code class=\"notranslate\">--port</code> argument that overrides this, however Go functions use a serialized instanceconfig instead, and it is not correctly set there.</p>\n<p dir=\"auto\">I have a PR ready to address this.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20403",
                "createdAt": "2023-05-25T19:20:56Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Go functions must retrieve consumers by non-partitioned topic ID",
        "url": "https://github.com/apache/pulsar/pull/20413",
        "resourcePath": "/apache/pulsar/pull/20413",
        "createdAt": "2023-05-27T02:34:48Z",
        "number": 20413,
        "mergeCommit": {
          "oid": "fb1b46e5e993d77c583f715d2bea2eadbb052a81",
          "message": "[fix][fn] Go functions must retrieve consumers by non-particioned topic ID (#20413)\n\nCo-authored-by: Andy Walker <andy@andy.dev>",
          "commitUrl": "https://github.com/apache/pulsar/commit/fb1b46e5e993d77c583f715d2bea2eadbb052a81",
          "parents": {
            "nodes": [
              {
                "oid": "563a573168ba51b60f060a993416d7ea642cc27b",
                "message": "[fix][fn] Fix function update error (#19895)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/instance.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/util.go"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Re38t2gAoY2EyMDMwN2VmYTlmMzYwYWI0NDM0OGQwYTIzMzA0ZDc4MWRmMDgxYQ",
                "url": "https://github.com/apache/pulsar/pull/20413/commits/ca20307efa9f360ab44348d0a23304d781df081a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19367,
                "url": "https://github.com/apache/pulsar/issues/19367",
                "title": "[Bug] [pulsar-function-go] function process `ackInputMessage`  error",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<ul dir=\"auto\">\n<li>branch: master</li>\n<li>commit: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/apache/pulsar/commit/785fb82966d0e152e65bd86de0c695ce5d6cf45f/hovercard\" href=\"https://github.com/apache/pulsar/commit/785fb82966d0e152e65bd86de0c695ce5d6cf45f\"><tt>785fb82</tt></a></li>\n</ul>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>\n<p dir=\"auto\">write function-go code;</p>\n</li>\n<li>\n<p dir=\"auto\">start function with golang:</p>\n</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\" ./bin/pulsar-admin functions localrun \\\n--go ./func-test/publishFunc \\\n--inputs privatetenant/functions/input-test \\\n--tenant privatetenant \\\n--namespace functions \\\n--output privatetenant/functions/event \\\n--name test-hello \\\n--auto-ack true\"><pre lang=\"shelll\" class=\"notranslate\"><code class=\"notranslate\"> ./bin/pulsar-admin functions localrun \\\n--go ./func-test/publishFunc \\\n--inputs privatetenant/functions/input-test \\\n--tenant privatetenant \\\n--namespace functions \\\n--output privatetenant/functions/event \\\n--name test-hello \\\n--auto-ack true\n</code></pre></div>\n<ol start=\"3\" dir=\"auto\">\n<li>when functions receive msg, ack message had panic: <code class=\"notranslate\">runtime error: invalid memory address or nil pointer dereference</code></li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Functions normal ack message.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"[signal SIGSEGV: segmentation violation code=0x1 addr=0x18 pc=0xaf9cf3]\n\ngoroutine 1 [running]:\ngithub.com/apache/pulsar/pulsar-function-go/pf.(*goInstance).ackInputMessage(0xc000198640, {0xdaefe0, 0xc000186b40})\n        /Users/cheneyin/project/intelliJ/github/apache/pulsar/pulsar-function-go/pf/instance.go:395 +0xb3\ngithub.com/apache/pulsar/pulsar-function-go/pf.(*goInstance).processResult(0xc000198640, {0xdaefe0?, 0xc000186b40?}, {0x0?, 0x0?, 0x1?})\n        /Users/cheneyin/project/intelliJ/github/apache/pulsar/pulsar-function-go/pf/instance.go:387 +0x1bd\ngithub.com/apache/pulsar/pulsar-function-go/pf.(*goInstance).startFunction(0xc000198640, {0xda5aa0?, 0xc0000afec0?})\n        /Users/cheneyin/project/intelliJ/github/apache/pulsar/pulsar-function-go/pf/instance.go:179 +0x4f6\ngithub.com/apache/pulsar/pulsar-function-go/pf.Start({0xb7d020?, 0xcd6c88?})\n        /Users/cheneyin/project/intelliJ/github/apache/pulsar/pulsar-function-go/pf/function.go:171 +0x45\nmain.main()\n        /Users/cheneyin/project/intelliJ/github/apache/pulsar/pulsar-function-go/examples/publishFunc/publishFunc.go:53 +0x27\"><pre class=\"notranslate\">[signal SIGSEGV: segmentation violation code<span class=\"pl-k\">=</span>0x1 addr<span class=\"pl-k\">=</span>0x18 pc<span class=\"pl-k\">=</span>0xaf9cf3]\n\ngoroutine 1 [running]:\ngithub.com/apache/pulsar/pulsar-function-go/pf.(<span class=\"pl-k\">*</span>goInstance).ackInputMessage(0xc000198640, {0xdaefe0, 0xc000186b40})\n        /Users/cheneyin/project/intelliJ/github/apache/pulsar/pulsar-function-go/pf/instance.go:395 +0xb3\ngithub.com/apache/pulsar/pulsar-function-go/pf.(<span class=\"pl-k\">*</span>goInstance).processResult(0xc000198640, {0xdaefe0<span class=\"pl-k\">?</span>, 0xc000186b40<span class=\"pl-k\">?</span>}, {0x0<span class=\"pl-k\">?</span>, 0x0<span class=\"pl-k\">?</span>, 0x1<span class=\"pl-k\">?</span>})\n        /Users/cheneyin/project/intelliJ/github/apache/pulsar/pulsar-function-go/pf/instance.go:387 +0x1bd\ngithub.com/apache/pulsar/pulsar-function-go/pf.(<span class=\"pl-k\">*</span>goInstance).startFunction(0xc000198640, {0xda5aa0<span class=\"pl-k\">?</span>, 0xc0000afec0<span class=\"pl-k\">?</span>})\n        /Users/cheneyin/project/intelliJ/github/apache/pulsar/pulsar-function-go/pf/instance.go:179 +0x4f6\ngithub.com/apache/pulsar/pulsar-function-go/pf.Start({0xb7d020<span class=\"pl-k\">?</span>, 0xcd6c88<span class=\"pl-k\">?</span>})\n        /Users/cheneyin/project/intelliJ/github/apache/pulsar/pulsar-function-go/pf/function.go:171 +0x45\n<span class=\"pl-en\">main.main</span>()\n        /Users/cheneyin/project/intelliJ/github/apache/pulsar/pulsar-function-go/examples/publishFunc/publishFunc.go:53 +0x27</pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19367",
                "createdAt": "2023-01-31T07:07:38Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Supplement schema ledger if schema ledger is lost",
        "url": "https://github.com/apache/pulsar/pull/20415",
        "resourcePath": "/apache/pulsar/pull/20415",
        "createdAt": "2023-05-27T06:15:30Z",
        "number": 20415,
        "mergeCommit": null,
        "potentialMergeCommit": {
          "oid": "1b723a19d70f86c09d386562d45987013766a145",
          "message": "Merge 7a500f7cf83698f35285ca3e6b681a1204fcb404 into eee3694f00e269eef0f75d791521d0d35d8ff411",
          "commitUrl": "https://github.com/apache/pulsar/commit/1b723a19d70f86c09d386562d45987013766a145",
          "parents": {
            "nodes": [
              {
                "oid": "eee3694f00e269eef0f75d791521d0d35d8ff411",
                "message": "[fix][storage] ReadonlyManagedLedger initialization does not fill in the properties (#22630)"
              },
              {
                "oid": "7a500f7cf83698f35285ca3e6b681a1204fcb404",
                "message": "remove delete schema on metastore, and complete test code."
              }
            ]
          }
        },
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/BookkeeperSchemaStorage.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/SchemaServiceTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/protocol/schema/SchemaStorage.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5RfGRk2gAoN2E1MDBmN2NmODM2OThmMzUyODVjYTNlNmI2ODFhMTIwNGZjYjQwNA",
                "url": "https://github.com/apache/pulsar/pull/20415/commits/7a500f7cf83698f35285ca3e6b681a1204fcb404"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20414,
                "url": "https://github.com/apache/pulsar/issues/20414",
                "title": "[improve][broker] Supplement schema ledger if schema ledger is lost",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1347276308\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/17221\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/17221/hovercard\" href=\"https://github.com/apache/pulsar/issues/17221\">#17221</a> describes an environment when multiple bookie copies are corrupted, or a Ledger has been deleted. The loss of schema ledger results in new producers and consumers not even being created and working properly.</p>\n<p dir=\"auto\">According to the solution of PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1404999994\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/18010\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/18010/hovercard\" href=\"https://github.com/apache/pulsar/pull/18010\">#18010</a>, enable <code class=\"notranslate\">autoSkipNonRecoverableData</code> and skip has gotten lost schema can lead to the schema information is not complete. And in the existing code, schema corruption will delete the metadata.<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/a953027aad38c9f54e952133949280ec2f4c04e8/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java#L564-L570\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/SchemaRegistryServiceImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 564 to 570\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/a953027aad38c9f54e952133949280ec2f4c04e8\">a953027</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L564\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"564\"></td>\n          <td id=\"LC564\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\">// clean up the broken schema from zk</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L565\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"565\"></td>\n          <td id=\"LC565\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">deleteSchemaStorage</span>(<span class=\"pl-s1\">schemaId</span>, <span class=\"pl-c1\">true</span>).<span class=\"pl-en\">handle</span>((<span class=\"pl-s1\">sv</span>, <span class=\"pl-s1\">th</span>) -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L566\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"566\"></td>\n          <td id=\"LC566\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"Clean up non-recoverable schema {}. Deletion of schema {} {}\"</span>, <span class=\"pl-s1\">rc</span>.<span class=\"pl-en\">getMessage</span>(), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L567\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"567\"></td>\n          <td id=\"LC567\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">schemaId</span>, (<span class=\"pl-s1\">th</span> == <span class=\"pl-c1\">null</span> ? <span class=\"pl-s\">\"successful\"</span> : <span class=\"pl-s\">\"failed, \"</span> + <span class=\"pl-s1\">th</span>.<span class=\"pl-en\">getCause</span>().<span class=\"pl-en\">getMessage</span>())); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L568\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"568\"></td>\n          <td id=\"LC568\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">schemaResult</span>.<span class=\"pl-en\">complete</span>(<span class=\"pl-s1\">list</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L569\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"569\"></td>\n          <td id=\"LC569\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-c1\">null</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L570\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"570\"></td>\n          <td id=\"LC570\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> }); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\nIf an error is not recoverable will be deleted, but PR <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1404999994\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/18010\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/18010/hovercard\" href=\"https://github.com/apache/pulsar/pull/18010\">#18010</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1634795323\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19882\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19882/hovercard\" href=\"https://github.com/apache/pulsar/pull/19882\">#19882</a> has been maked <code class=\"notranslate\">NoSuchLedgerExistsOnMetadataServerException</code> also as recoverable exception.<p></p>\n<p dir=\"auto\">So we need a solution that does not just skip the schema with the missing ledger, but actually supplements the broken schema ledger.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">A new method called <code class=\"notranslate\">tryCompleteTheLostSchemaLedger</code>. When the schema ledger losted, if the new consumer subscription or a new producer created, when there is a \"Failed to open gotten\" such an error, call <code class=\"notranslate\">tryCompleteTheLostSchemaLedger</code> method.</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"CompletableFuture&lt;Long&gt; tryCompleteTheLostSchemaLedger(String schemaId, SchemaVersion version, SchemaData schema);\"><pre class=\"notranslate\"><span class=\"pl-s1\">CompletableFuture</span>&lt;<span class=\"pl-s1\">Long</span>&gt; <span class=\"pl-en\">tryCompleteTheLostSchemaLedger</span>(<span class=\"pl-smi\">String</span> <span class=\"pl-s1\">schemaId</span>, <span class=\"pl-smi\">SchemaVersion</span> <span class=\"pl-s1\">version</span>, <span class=\"pl-smi\">SchemaData</span> <span class=\"pl-s1\">schema</span>);</pre></div>\n<p dir=\"auto\">This method attempts to create a new ledger save schemaData and then update the new ledger id to the metadata.<br>\n<strong>Now, connected producers and consumers can work even if scheme ledger is deleted.</strong> To get the SchemaData, we need to store the SchemaData and SchemaVersion information in the topic(<code class=\"notranslate\">org.apache.pulsar.broker.service.AbstractTopic</code>). When calling <code class=\"notranslate\">tryCompleteTheLostSchemaLedger</code> incoming.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<ol dir=\"auto\">\n<li>In the broker, <code class=\"notranslate\">org.apache.pulsar.broker.service.Producer</code> and <code class=\"notranslate\">org.apache.pulsar.broker.service.Consumer</code> do not save SchemaData and SchemaVersion, and only call <code class=\"notranslate\">tryCompleteTheLostSchemaLedger</code> through the admin api. Perhaps we should directly implement this function on the upload schema function(<a href=\"https://pulsar.apache.org/docs/3.2.x/admin-api-schemas/#upload-a-schema\" rel=\"nofollow\">https://pulsar.apache.org/docs/3.2.x/admin-api-schemas/#upload-a-schema</a>), then we need to pass in an additional flag to identify whether to register or make up for the missing schema. Of course, for compatibility, the default behavior should be to register a new schema.</li>\n<li>The corresponding schema information is also saved on the Client side. Perhaps the broker side can initiate a request for each connecting consumer or producer to obtain schema information?(<strong>Now, connected producers and consumers can work even if scheme ledger is deleted.</strong>) In this way, schema information does not need to be cached on the broker side.</li>\n<li><del>Store the SchemaData and SchemaVersion information in the <code class=\"notranslate\">org.apache.pulsar.broker.service.Producer</code> and <code class=\"notranslate\">org.apache.pulsar.broker.service.Consumer</code> that are connected or subscribed to the topic on the broker side.(Not an overall alternative, only contains how to store <code class=\"notranslate\">SchemaData</code> and <code class=\"notranslate\">SchemaVersion</code> that have been lost)</del></li>\n</ol>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><strong>Please pay attention to the alternatives and leave your ideas for discussion. I will modify the implementation in pr.</strong></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20414",
                "createdAt": "2023-05-27T05:49:03Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][cli] Fulfill add-opens to function-localrunner also",
        "url": "https://github.com/apache/pulsar/pull/20417",
        "resourcePath": "/apache/pulsar/pull/20417",
        "createdAt": "2023-05-28T01:41:55Z",
        "number": 20417,
        "mergeCommit": {
          "oid": "da2a1482a7dbd57bfc7c130315db249fe53e0260",
          "message": "[fix][cli] Fulfill add-opens to function-localrunner also (#20417)\n\nSigned-off-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/da2a1482a7dbd57bfc7c130315db249fe53e0260",
          "parents": {
            "nodes": [
              {
                "oid": "ad75cc87e045ffca56a44f69e189f2e080373cdb",
                "message": "[improve][meta] Support set metadata size threshold for compression. (#19561)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "bin/bookkeeper"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "bin/function-localrunner"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "bin/pulsar"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "bin/pulsar-admin-common.sh"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "bin/pulsar-perf"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5RhG2T2gAoMzQwNzdlNjYwMTI0NGU1YzJhZDRmOTE3M2JhMmZlOGIwZjczMDA0OQ",
                "url": "https://github.com/apache/pulsar/pull/20417/commits/34077e6601244e5c2ad4f9173ba2fe8b0f730049"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20282,
                "url": "https://github.com/apache/pulsar/issues/20282",
                "title": "[Bug] DnsResolverUtil \"Cannot get DNS TTL settings from sun.net.InetAddressCachePolicy class\" in Java 17",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar Version: v3.0.0<br>\nOS Version: macOS Ventura 13.3.1 (M1 Mac)<br>\nJava Version: openjdk 17.0.7 2023-04-18</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Running through the Debezium example here: <a href=\"https://pulsar.apache.org/docs/3.0.x/io-cdc-debezium/\" rel=\"nofollow\">https://pulsar.apache.org/docs/3.0.x/io-cdc-debezium/</a></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">debezium-postgres-source</code> connector successfully connect to the DB</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Fails when running <code class=\"notranslate\">bin/pulsar-admin source localrun --source-config-file debezium-postgres-source-config.yaml</code><br>\nThe error is:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-05-09T12:54:19,661-0700 [main] WARN  org.apache.pulsar.common.util.netty.DnsResolverUtil - Cannot get DNS TTL settings from sun.net.InetAddressCachePolicy class\njava.lang.IllegalAccessException: class org.apache.pulsar.common.util.netty.DnsResolverUtil cannot access class sun.net.InetAddressCachePolicy (in module java.base) because module java.base does not export sun.net to unnamed module @384ad17b\n\tat jdk.internal.reflect.Reflection.newIllegalAccessException(Reflection.java:392) ~[?:?]\n\tat java.lang.reflect.AccessibleObject.checkAccess(AccessibleObject.java:674) ~[?:?]\n\tat java.lang.reflect.Method.invoke(Method.java:560) ~[?:?]\n\tat org.apache.pulsar.common.util.netty.DnsResolverUtil.&lt;clinit&gt;(DnsResolverUtil.java:46) ~[org.apache.pulsar-pulsar-common-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.client.impl.ConnectionPool.createAddressResolver(ConnectionPool.java:159) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.client.impl.ConnectionPool.lambda$new$1(ConnectionPool.java:126) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat java.util.Optional.orElseGet(Optional.java:364) ~[?:?]\n\tat org.apache.pulsar.client.impl.ConnectionPool.&lt;init&gt;(ConnectionPool.java:126) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.client.impl.ConnectionPool.&lt;init&gt;(ConnectionPool.java:95) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.client.impl.ConnectionPool.&lt;init&gt;(ConnectionPool.java:90) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.client.impl.PulsarClientImpl.&lt;init&gt;(PulsarClientImpl.java:196) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.client.impl.PulsarClientImpl.&lt;init&gt;(PulsarClientImpl.java:153) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.client.impl.ClientBuilderImpl.build(ClientBuilderImpl.java:63) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntimeFactory.initialize(ThreadRuntimeFactory.java:116) ~[org.apache.pulsar-pulsar-functions-runtime-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntimeFactory.&lt;init&gt;(ThreadRuntimeFactory.java:85) ~[org.apache.pulsar-pulsar-functions-runtime-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.functions.LocalRunner.startThreadedMode(LocalRunner.java:643) ~[org.apache.pulsar-pulsar-functions-local-runner-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.functions.LocalRunner.start(LocalRunner.java:436) ~[org.apache.pulsar-pulsar-functions-local-runner-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.functions.LocalRunner.main(LocalRunner.java:216) ~[org.apache.pulsar-pulsar-functions-local-runner-original-3.0.0.jar:3.0.0]\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-05-09T12:54:19,661-0700 [main] WARN  org.apache.pulsar.common.util.netty.DnsResolverUtil - Cannot get DNS TTL settings from sun.net.InetAddressCachePolicy class\njava.lang.IllegalAccessException: class org.apache.pulsar.common.util.netty.DnsResolverUtil cannot access class sun.net.InetAddressCachePolicy (in module java.base) because module java.base does not export sun.net to unnamed module @384ad17b\n\tat jdk.internal.reflect.Reflection.newIllegalAccessException(Reflection.java:392) ~[?:?]\n\tat java.lang.reflect.AccessibleObject.checkAccess(AccessibleObject.java:674) ~[?:?]\n\tat java.lang.reflect.Method.invoke(Method.java:560) ~[?:?]\n\tat org.apache.pulsar.common.util.netty.DnsResolverUtil.&lt;clinit&gt;(DnsResolverUtil.java:46) ~[org.apache.pulsar-pulsar-common-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.client.impl.ConnectionPool.createAddressResolver(ConnectionPool.java:159) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.client.impl.ConnectionPool.lambda$new$1(ConnectionPool.java:126) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat java.util.Optional.orElseGet(Optional.java:364) ~[?:?]\n\tat org.apache.pulsar.client.impl.ConnectionPool.&lt;init&gt;(ConnectionPool.java:126) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.client.impl.ConnectionPool.&lt;init&gt;(ConnectionPool.java:95) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.client.impl.ConnectionPool.&lt;init&gt;(ConnectionPool.java:90) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.client.impl.PulsarClientImpl.&lt;init&gt;(PulsarClientImpl.java:196) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.client.impl.PulsarClientImpl.&lt;init&gt;(PulsarClientImpl.java:153) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.client.impl.ClientBuilderImpl.build(ClientBuilderImpl.java:63) ~[org.apache.pulsar-pulsar-client-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntimeFactory.initialize(ThreadRuntimeFactory.java:116) ~[org.apache.pulsar-pulsar-functions-runtime-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntimeFactory.&lt;init&gt;(ThreadRuntimeFactory.java:85) ~[org.apache.pulsar-pulsar-functions-runtime-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.functions.LocalRunner.startThreadedMode(LocalRunner.java:643) ~[org.apache.pulsar-pulsar-functions-local-runner-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.functions.LocalRunner.start(LocalRunner.java:436) ~[org.apache.pulsar-pulsar-functions-local-runner-original-3.0.0.jar:3.0.0]\n\tat org.apache.pulsar.functions.LocalRunner.main(LocalRunner.java:216) ~[org.apache.pulsar-pulsar-functions-local-runner-original-3.0.0.jar:3.0.0]\n</code></pre></div>\n<p dir=\"auto\">Same as <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1217202052\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/15349\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/15349/hovercard\" href=\"https://github.com/apache/pulsar/issues/15349\">#15349</a></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">On a M1 Mac. Have tried older versions and running through Docker to no avail. Even tried editing <code class=\"notranslate\">pulsar-admin-common.sh</code> to try different options on Line 98 as per the suggestions in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1217202052\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/15349\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/15349/hovercard\" href=\"https://github.com/apache/pulsar/issues/15349\">#15349</a> but nothing worked</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20282",
                "createdAt": "2023-05-09T20:02:44Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky test NonPersistentTopicTest.testMsgDropStat, 3rd attempt",
        "url": "https://github.com/apache/pulsar/pull/20429",
        "resourcePath": "/apache/pulsar/pull/20429",
        "createdAt": "2023-05-29T12:43:43Z",
        "number": 20429,
        "mergeCommit": {
          "oid": "a26cf3eb78858ef5638650b6dbd7dab1f76a8c61",
          "message": "[fix][test] Fix flaky test NonPersistentTopicTest.testMsgDropStat, 3rd attempt (#20429)",
          "commitUrl": "https://github.com/apache/pulsar/commit/a26cf3eb78858ef5638650b6dbd7dab1f76a8c61",
          "parents": {
            "nodes": [
              {
                "oid": "bdd1bf1fcabdfc52527d07a8f8a288930e2cb7dd",
                "message": "[improve][broker] Replace String.intern() with Guava Interner (#20432)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/NonPersistentTopicTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5RmndK2gAoNzMzNGI0YTJhMzE1YWFkZmVjNTFhYjM0ZmQ1NmY0ZTJiZDI1OTNlNw",
                "url": "https://github.com/apache/pulsar/pull/20429/commits/7334b4a2a315aadfec51ab34fd56f4e2bd2593e7"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20386,
                "url": "https://github.com/apache/pulsar/issues/20386",
                "title": "Flaky-test: NonPersistentTopicTest.testMsgDropStat",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/5067587816/jobs/9099067231#step:10:1471\">https://github.com/apache/pulsar/actions/runs/5067587816/jobs/9099067231#step:10:1471</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 151, Failures: 1, Errors: 0, Skipped: 145, Time elapsed: 61.004 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.client.api.NonPersistentTopicTest\n  Error:  org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat  Time elapsed: 2.251 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [true] but found [false]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertTrue(Assert.java:56)\n  \tat org.testng.Assert.assertTrue(Assert.java:66)\n  \tat org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat(NonPersistentTopicTest.java:859)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 151, Failures: 1, Errors: 0, Skipped: 145, Time elapsed: 61.004 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.client.api.NonPersistentTopicTest\n  Error:  org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat  Time elapsed: 2.251 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [true] but found [false]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertTrue(Assert.java:56)\n  \tat org.testng.Assert.assertTrue(Assert.java:66)\n  \tat org.apache.pulsar.client.api.NonPersistentTopicTest.testMsgDropStat(NonPersistentTopicTest.java:859)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20386",
                "createdAt": "2023-05-24T11:20:55Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky PersistentSubscriptionTest",
        "url": "https://github.com/apache/pulsar/pull/20434",
        "resourcePath": "/apache/pulsar/pull/20434",
        "createdAt": "2023-05-29T15:53:15Z",
        "number": 20434,
        "mergeCommit": {
          "oid": "242758d5770de46e506855ff881472cbc274cedb",
          "message": "[fix][test] Fix flaky PersistentSubscriptionTest (#20434)",
          "commitUrl": "https://github.com/apache/pulsar/commit/242758d5770de46e506855ff881472cbc274cedb",
          "parents": {
            "nodes": [
              {
                "oid": "b3360745dc0db8c8a5ec60fb28cdb9e2718b29c6",
                "message": "[improve][broker] Remove uneffective solution for reducing GC pressure (#20428)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PersistentSubscriptionTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/testcontext/NonStartableTestPulsarService.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Rnjn32gAoNzg3NzRjYjk0M2UzMTQ2ZGQyYjhlYjhiZThmMGRhNWFhZDQ0OGUxNQ",
                "url": "https://github.com/apache/pulsar/pull/20434/commits/78774cb943e3146dd2b8eb8be8f0da5aad448e15"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19396,
                "url": "https://github.com/apache/pulsar/issues/19396",
                "title": "Flaky-test: PersistentSubscriptionTest.setup",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4072071397/jobs/7014654778#step:11:1076\">https://github.com/apache/pulsar/actions/runs/4072071397/jobs/7014654778#step:11:1076</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error:  Tests run: 3, Failures: 1, Errors: 0, Skipped: 1, Time elapsed: 5.305 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.persistent.PersistentSubscriptionTest\n  Error:  setup(org.apache.pulsar.broker.service.persistent.PersistentSubscriptionTest)  Time elapsed: 0.111 s  &lt;&lt;&lt; FAILURE!\n  java.lang.NullPointerException: Cannot invoke &quot;org.apache.pulsar.broker.transaction.buffer.TransactionBufferProvider.newTransactionBuffer(org.apache.pulsar.broker.service.Topic)&quot; because the return value of &quot;org.apache.pulsar.broker.PulsarService.getTransactionBufferProvider()&quot; is null\n  \tat org.apache.pulsar.broker.service.persistent.PersistentTopic.&lt;init&gt;(PersistentTopic.java:312)\n  \tat org.apache.pulsar.broker.service.persistent.PersistentSubscriptionTest.setup(PersistentSubscriptionTest.java:163)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n  \tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n  \tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:590)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n  \tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n  \tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n  \tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n  \tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n  \tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n  \tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n  \tat org.testng.TestRunner.run(TestRunner.java:602)\n  \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n  \tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n  \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n  \tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n  \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n  \tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n  \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n  \tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n  \tat org.testng.TestNG.runSuites(TestNG.java:[1099](https://github.com/apache/pulsar/actions/runs/4072071397/jobs/7014654778#step:11:1100))\n  \tat org.testng.TestNG.run(TestNG.java:1067)\n  \tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:135)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:112)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:123)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:90)\n  \tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:146)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)\"><pre class=\"notranslate\"><code class=\"notranslate\">Error:  Tests run: 3, Failures: 1, Errors: 0, Skipped: 1, Time elapsed: 5.305 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.persistent.PersistentSubscriptionTest\n  Error:  setup(org.apache.pulsar.broker.service.persistent.PersistentSubscriptionTest)  Time elapsed: 0.111 s  &lt;&lt;&lt; FAILURE!\n  java.lang.NullPointerException: Cannot invoke \"org.apache.pulsar.broker.transaction.buffer.TransactionBufferProvider.newTransactionBuffer(org.apache.pulsar.broker.service.Topic)\" because the return value of \"org.apache.pulsar.broker.PulsarService.getTransactionBufferProvider()\" is null\n  \tat org.apache.pulsar.broker.service.persistent.PersistentTopic.&lt;init&gt;(PersistentTopic.java:312)\n  \tat org.apache.pulsar.broker.service.persistent.PersistentSubscriptionTest.setup(PersistentSubscriptionTest.java:163)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n  \tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n  \tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:590)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n  \tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n  \tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n  \tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n  \tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n  \tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n  \tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n  \tat org.testng.TestRunner.run(TestRunner.java:602)\n  \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n  \tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n  \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n  \tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n  \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n  \tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n  \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n  \tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n  \tat org.testng.TestNG.runSuites(TestNG.java:[1099](https://github.com/apache/pulsar/actions/runs/4072071397/jobs/7014654778#step:11:1100))\n  \tat org.testng.TestNG.run(TestNG.java:1067)\n  \tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:135)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:112)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:123)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:90)\n  \tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:146)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.invokeProviderInSameClassLoader(ForkedBooter.java:384)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:345)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:126)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:418)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19396",
                "createdAt": "2023-02-02T09:08:53Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][build] Fix the pulsar-all image may use the wrong upstream image",
        "url": "https://github.com/apache/pulsar/pull/20435",
        "resourcePath": "/apache/pulsar/pull/20435",
        "createdAt": "2023-05-30T02:42:23Z",
        "number": 20435,
        "mergeCommit": {
          "oid": "d7f355881b2b1eebf2be6ea262c202660d684fb7",
          "message": "[fix][build] Fix the pulsar-all image may use the wrong upstream image (#20435)\n\nSigned-off-by: Zike Yang <zike@apache.org>\r\nCo-authored-by: Lari Hotari <lhotari@apache.org>",
          "commitUrl": "https://github.com/apache/pulsar/commit/d7f355881b2b1eebf2be6ea262c202660d684fb7",
          "parents": {
            "nodes": [
              {
                "oid": "ad352a90f13173324feac816ee97ffff5140cf8f",
                "message": "[fix][cli] Fix logging noise while admin tool exit (#19884)\n\nCo-authored-by: tison <wander4096@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/build.sh"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/get-version.sh"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/publish.sh"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/pulsar-all/Dockerfile"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/pulsar-all/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/pulsar/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5RpDCk2gAoZjQ2ZGIyOGVjMzFiZTUyMjJjYmZiZDQxOGVlNzhmNjA1MTNiNTc2Zg",
                "url": "https://github.com/apache/pulsar/pull/20435/commits/f46db28ec31be5222cbfbd418ee78f60513b576f"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20420,
                "url": "https://github.com/apache/pulsar/issues/20420",
                "title": "[Bug] pulsar-all 3.0.0 docker image contains Pulsar 2.11.0",
                "bodyHTML": "<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Ubuntu 20.04, Pulsar 3.0.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/12949466/241654033-2e7f1bc2-aeb8-4e72-aae3-73cddc02effd.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzE0NTUsIm5iZiI6MTcxNDk3MTE1NSwicGF0aCI6Ii8xMjk0OTQ2Ni8yNDE2NTQwMzMtMmU3ZjFiYzItYWViOC00ZTcyLWFhZTMtNzNjZGRjMDJlZmZkLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA0NTIzNVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWViNmExNTNhNTRjYjZkMjUzZGQwNGY2M2I3YmExYTdkZTFjN2NlOGQ2NjYzYWIyMTQ1MDg1OTE3NmRmZDQ2MjgmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.mbTyhqtvcxJ-g48qBM_48oJqm7X-IJoxmI0MSCuED2c\"><img width=\"1068\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/12949466/241654033-2e7f1bc2-aeb8-4e72-aae3-73cddc02effd.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzE0NTUsIm5iZiI6MTcxNDk3MTE1NSwicGF0aCI6Ii8xMjk0OTQ2Ni8yNDE2NTQwMzMtMmU3ZjFiYzItYWViOC00ZTcyLWFhZTMtNzNjZGRjMDJlZmZkLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA0NTIzNVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWViNmExNTNhNTRjYjZkMjUzZGQwNGY2M2I3YmExYTdkZTFjN2NlOGQ2NjYzYWIyMTQ1MDg1OTE3NmRmZDQ2MjgmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.mbTyhqtvcxJ-g48qBM_48oJqm7X-IJoxmI0MSCuED2c\" style=\"max-width: 100%;\"></a>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">pulsar-related libs in pulsar-all:3.0.0 image should be 3.0.0 also.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">pulsar-related libs in pulsar-all:3.0.0 is 2.11.0.</p>",
                "resourcePath": "/apache/pulsar/issues/20420",
                "createdAt": "2023-05-29T03:58:33Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[feat][fn] Add stateStorageURL and pulsarWebService URL to go InstanceConfig",
        "url": "https://github.com/apache/pulsar/pull/20443",
        "resourcePath": "/apache/pulsar/pull/20443",
        "createdAt": "2023-05-31T05:04:05Z",
        "number": 20443,
        "mergeCommit": {
          "oid": "510744c20d0339c4b29366f07bf1849cabb81dec",
          "message": "[feat][fn] Add stateStorageURL and pulsarWebService URL to go InstanceConfig (#20443)\n\nCo-authored-by: Andy Walker <andy@andy.dev>",
          "commitUrl": "https://github.com/apache/pulsar/commit/510744c20d0339c4b29366f07bf1849cabb81dec",
          "parents": {
            "nodes": [
              {
                "oid": "8b3c085e9d26605cca544068e8611d72e7012468",
                "message": "[fix][fn] enable Go function token auth and TLS (#20468)\n\nCo-authored-by: Andy Walker <andy@andy.dev>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/conf/conf.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/instanceConf.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/go/GoInstanceConfig.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/RuntimeUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/test/java/org/apache/pulsar/functions/runtime/RuntimeUtilsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Rvu0n2gAoMGFiMjdhMzkwYTA3YWVjNjhhNGZmODBkNjM4NDlhNzgwNmQ3MjAxZg",
                "url": "https://github.com/apache/pulsar/pull/20443/commits/0ab27a390a07aec68a4ff80d63849a7806d7201f"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20442,
                "url": "https://github.com/apache/pulsar/issues/20442",
                "title": "Add state storage and admin URLs to Go function runtime",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">I have been working on enabling state storage and admin interface in the Go function SDK, and have most of  a PR ready for state storage, however in order for either of these to work, Go functions need access to the state storage service URL and admin service URL.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Linked in PR</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\">n/a</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20442",
                "createdAt": "2023-05-31T04:55:21Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn]Reset idle timer correctly",
        "url": "https://github.com/apache/pulsar/pull/20450",
        "resourcePath": "/apache/pulsar/pull/20450",
        "createdAt": "2023-05-31T19:09:04Z",
        "number": 20450,
        "mergeCommit": {
          "oid": "e05b890b804cee781e87db750f2afc3a382fa1d2",
          "message": "[fix][fn]Reset idle timer correctly (#20450)\n\nCo-authored-by: Andy Walker <andy@andy.dev>\r\n\r\nFix apache/pulsar#20449\r\n\r\n<!-- or this PR is one task of an issue -->\r\n\r\nMaster Issue: #20449\r\n\r\n### Verifying this change\r\n\r\n- [ ] Make sure that the change passes the CI checks.\r\n\r\nThis change is a trivial rework / code cleanup without any test coverage.\r\n\r\n### Does this pull request potentially affect one of the following parts:\r\n\r\n<!-- DO NOT REMOVE THIS SECTION. CHECK THE PROPER BOX ONLY. -->\r\n\r\n*If the box was checked, please highlight the changes*\r\n\r\n- [ ] Dependencies (add or upgrade a dependency)\r\n- [ ] The public API\r\n- [ ] The schema\r\n- [ ] The default values of configurations\r\n- [ ] The threading model\r\n- [ ] The binary protocol\r\n- [ ] The REST endpoints\r\n- [ ] The admin CLI options\r\n- [ ] The metrics\r\n- [ ] Anything that affects deployment\r\n\r\n### Documentation\r\n\r\n<!-- DO NOT REMOVE THIS SECTION. CHECK THE PROPER BOX ONLY. -->\r\n\r\n- [ ] `doc` <!-- Your PR contains doc changes. -->\r\n- [ ] `doc-required` <!-- Your PR changes impact docs and you will update later -->\r\n- [X] `doc-not-needed` <!-- Your PR changes do not impact docs -->\r\n- [ ] `doc-complete` <!-- Docs have been already added -->\r\n\r\n### Matching PR in forked repository\r\n\r\nPR in forked repository: https://github.com/flowchartsman/pulsar/pull/5",
          "commitUrl": "https://github.com/apache/pulsar/commit/e05b890b804cee781e87db750f2afc3a382fa1d2",
          "parents": {
            "nodes": [
              {
                "oid": "f86e36fcf1b68afd7ced44cc09b9028f0bb5846c",
                "message": "[cleanup][ml] cleanup numManagedLedgerWorkerThreads (#20454)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/instance.go"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5R0qS_2gAoZjc5N2JhMzg0NGQ4ODk3M2NiNzFlMmIzZDA4NDM2ZTM1ZDk0ZTZjMg",
                "url": "https://github.com/apache/pulsar/pull/20450/commits/f797ba3844d88973cb71e2b3d08436e35d94e6c2"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20449,
                "url": "https://github.com/apache/pulsar/issues/20449",
                "title": "[Bug][fn] Go functions do not reset idleTimer correctly.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">The code in <code class=\"notranslate\">instance.go</code> which handles incoming messages and idle timeout basically boils down to this:</p>\n<div class=\"highlight highlight-source-go notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"\tidleDuration := getIdleTimeout(time.Millisecond * time.Duration(gi.context.instanceConf.killAfterIdleMs))\n\tidleTimer := time.NewTimer(idleDuration)\n\tdefer idleTimer.Stop()\n\nCLOSE:\n\tfor {\n\t\tidleTimer.Reset(idleDuration)\n\t\tselect {\n\t\tcase cm := &lt;-channel:\n\t\t\t// handle message\n\t\tcase &lt;-idleTimer.C:\n\t\t\tclose(channel) // this is not great either, but that's a separate bug ;)\n\t\t\tbreak CLOSE\n\t\t}\n\t}\"><pre class=\"notranslate\">\t<span class=\"pl-s1\">idleDuration</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-en\">getIdleTimeout</span>(<span class=\"pl-s1\">time</span>.<span class=\"pl-c1\">Millisecond</span> <span class=\"pl-c1\">*</span> <span class=\"pl-s1\">time</span>.<span class=\"pl-en\">Duration</span>(<span class=\"pl-s1\">gi</span>.<span class=\"pl-c1\">context</span>.<span class=\"pl-c1\">instanceConf</span>.<span class=\"pl-c1\">killAfterIdleMs</span>))\n\t<span class=\"pl-s1\">idleTimer</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">time</span>.<span class=\"pl-en\">NewTimer</span>(<span class=\"pl-s1\">idleDuration</span>)\n\t<span class=\"pl-k\">defer</span> <span class=\"pl-s1\">idleTimer</span>.<span class=\"pl-en\">Stop</span>()\n\nCLOSE:\n\t<span class=\"pl-k\">for</span> {\n\t\t<span class=\"pl-s1\">idleTimer</span>.<span class=\"pl-en\">Reset</span>(<span class=\"pl-s1\">idleDuration</span>)\n\t\t<span class=\"pl-k\">select</span> {\n\t\t<span class=\"pl-k\">case</span> <span class=\"pl-s1\">cm</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-c1\">&lt;-</span><span class=\"pl-s1\">channel</span>:\n\t\t\t<span class=\"pl-c\">// handle message</span>\n\t\t<span class=\"pl-k\">case</span> <span class=\"pl-c1\">&lt;-</span><span class=\"pl-s1\">idleTimer</span>.<span class=\"pl-c1\">C</span>:\n\t\t\t<span class=\"pl-en\">close</span>(<span class=\"pl-s1\">channel</span>) <span class=\"pl-c\">// this is not great either, but that's a separate bug ;)</span>\n\t\t\t<span class=\"pl-k\">break</span> CLOSE\n\t\t}\n\t}</pre></div>\n<p dir=\"auto\">However, this does not account for the idle timer firing during work. If it does, then the reset will not have the desired effect, and the idle clause will fire erroneously on a subsequent loop, since there's now a timestamp on the channel.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Here's a simple repro:</p>\n<div class=\"highlight highlight-source-go notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"package main\n\nimport &quot;fmt&quot;\nimport &quot;time&quot;\n\nfunc main() {\n\tconst idleDuration = 250*time.Millisecond\n\twork := make(chan int,2)\n\twork &lt;- 1\n\twork &lt;- 2\n\tt := time.NewTimer(idleDuration)\n\tEVENTLOOP:\n\tfor {\n\t\tt.Reset(idleDuration)\n\t\tfmt.Println(&quot;waiting for new work&quot;)\n\t\tselect {\n\t\tcase w := &lt;- work:\n\t\t\tfmt.Printf(&quot;doing work on %d\\n&quot;, w)\n\t\t\ttime.Sleep(500*time.Millisecond)\n\t\t\tfmt.Println(&quot;done with work&quot;)\n\t\tcase &lt;- t.C:\n\t\t\tfmt.Println(&quot;timed out&quot;)\n\t\t\tbreak EVENTLOOP\n\t\t}\n\t}\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">package</span> main\n\n<span class=\"pl-k\">import</span> <span class=\"pl-s\">\"fmt\"</span>\n<span class=\"pl-k\">import</span> <span class=\"pl-s\">\"time\"</span>\n\n<span class=\"pl-k\">func</span> <span class=\"pl-en\">main</span>() {\n\t<span class=\"pl-k\">const</span> <span class=\"pl-s1\">idleDuration</span> <span class=\"pl-c1\">=</span> <span class=\"pl-c1\">250</span><span class=\"pl-c1\">*</span><span class=\"pl-s1\">time</span>.<span class=\"pl-c1\">Millisecond</span>\n\t<span class=\"pl-s1\">work</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-en\">make</span>(<span class=\"pl-k\">chan</span> <span class=\"pl-smi\">int</span>,<span class=\"pl-c1\">2</span>)\n\t<span class=\"pl-s1\">work</span> <span class=\"pl-c1\">&lt;-</span> <span class=\"pl-c1\">1</span>\n\t<span class=\"pl-s1\">work</span> <span class=\"pl-c1\">&lt;-</span> <span class=\"pl-c1\">2</span>\n\t<span class=\"pl-s1\">t</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-s1\">time</span>.<span class=\"pl-en\">NewTimer</span>(<span class=\"pl-s1\">idleDuration</span>)\n\tEVENTLOOP:\n\t<span class=\"pl-k\">for</span> {\n\t\t<span class=\"pl-s1\">t</span>.<span class=\"pl-en\">Reset</span>(<span class=\"pl-s1\">idleDuration</span>)\n\t\t<span class=\"pl-s1\">fmt</span>.<span class=\"pl-en\">Println</span>(<span class=\"pl-s\">\"waiting for new work\"</span>)\n\t\t<span class=\"pl-k\">select</span> {\n\t\t<span class=\"pl-k\">case</span> <span class=\"pl-s1\">w</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-c1\">&lt;-</span> <span class=\"pl-s1\">work</span>:\n\t\t\t<span class=\"pl-s1\">fmt</span>.<span class=\"pl-en\">Printf</span>(<span class=\"pl-s\">\"doing work on %d<span class=\"pl-cce\">\\n</span>\"</span>, <span class=\"pl-s1\">w</span>)\n\t\t\t<span class=\"pl-s1\">time</span>.<span class=\"pl-en\">Sleep</span>(<span class=\"pl-c1\">500</span><span class=\"pl-c1\">*</span><span class=\"pl-s1\">time</span>.<span class=\"pl-c1\">Millisecond</span>)\n\t\t\t<span class=\"pl-s1\">fmt</span>.<span class=\"pl-en\">Println</span>(<span class=\"pl-s\">\"done with work\"</span>)\n\t\t<span class=\"pl-k\">case</span> <span class=\"pl-c1\">&lt;-</span> <span class=\"pl-s1\">t</span>.<span class=\"pl-c1\">C</span>:\n\t\t\t<span class=\"pl-s1\">fmt</span>.<span class=\"pl-en\">Println</span>(<span class=\"pl-s\">\"timed out\"</span>)\n\t\t\t<span class=\"pl-k\">break</span> EVENTLOOP\n\t\t}\n\t}\n}</pre></div>\n<p dir=\"auto\">Run that a few times, and you'll see:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"waiting for new work\ndoing work on 1\ndone with work\nwaiting for new work\ntimed out\"><pre class=\"notranslate\"><code class=\"notranslate\">waiting for new work\ndoing work on 1\ndone with work\nwaiting for new work\ntimed out\n</code></pre></div>\n<p dir=\"auto\">This is exactly what would happen in a Go function, only it would then call <code class=\"notranslate\">log.Fatal</code></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">n/a</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">n/a</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The correct fix is to call <code class=\"notranslate\">Stop()</code> on the timer and, if it returns false, drain the channel before resetting:</p>\n<div class=\"highlight highlight-source-go notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"CLOSE:\n\tfor {\n\t\tselect {\n\t\tcase cm := &lt;-channel:\n\t\t\t// handle message\n\t\tcase &lt;-idleTimer.C:\n\t\t\tclose(channel)\n\t\t\tbreak CLOSE\n\t\t}\n\t\tif !idleTimer.Stop() {\n\t\t\t&lt;-idleTimer.C\n\t\t}\n\t}\n\"><pre class=\"notranslate\">CLOSE:\n\t<span class=\"pl-k\">for</span> {\n\t\t<span class=\"pl-k\">select</span> {\n\t\t<span class=\"pl-k\">case</span> <span class=\"pl-s1\">cm</span> <span class=\"pl-c1\">:=</span> <span class=\"pl-c1\">&lt;-</span><span class=\"pl-s1\">channel</span>:\n\t\t\t<span class=\"pl-c\">// handle message</span>\n\t\t<span class=\"pl-k\">case</span> <span class=\"pl-c1\">&lt;-</span><span class=\"pl-s1\">idleTimer</span>.<span class=\"pl-c1\">C</span>:\n\t\t\t<span class=\"pl-en\">close</span>(<span class=\"pl-s1\">channel</span>)\n\t\t\t<span class=\"pl-k\">break</span> CLOSE\n\t\t}\n\t\t<span class=\"pl-k\">if</span> <span class=\"pl-c1\">!</span><span class=\"pl-s1\">idleTimer</span>.<span class=\"pl-en\">Stop</span>() {\n\t\t\t<span class=\"pl-c1\">&lt;-</span><span class=\"pl-s1\">idleTimer</span>.<span class=\"pl-c1\">C</span>\n\t\t}\n\t}</pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20449",
                "createdAt": "2023-05-31T18:57:11Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix return the earliest position when query position by timestamp.",
        "url": "https://github.com/apache/pulsar/pull/20457",
        "resourcePath": "/apache/pulsar/pull/20457",
        "createdAt": "2023-06-01T11:45:25Z",
        "number": 20457,
        "mergeCommit": {
          "oid": "0e603405c2a6faaa50a47881916a2c1268de9830",
          "message": "[fix][broker] Fix return the earliest position when query position by timestamp. (#20457)",
          "commitUrl": "https://github.com/apache/pulsar/commit/0e603405c2a6faaa50a47881916a2c1268de9830",
          "parents": {
            "nodes": [
              {
                "oid": "1211b14820467750af77a1b28cf0ba9c468d374c",
                "message": "[fix][sql] Remove useless configuration for Pulsar SQL (#20605)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/ManagedCursor.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedCursorContainerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentMessageFinder.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/delayed/MockManagedCursor.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentMessageFinderTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5R5EpP2gAoZjE5NThmZmExYjY1YWRkMGYyZTJlYjI0MDkyMDFmZDQ4MWZiMjU5YQ",
                "url": "https://github.com/apache/pulsar/pull/20457/commits/f1958ffa1b65add0f2e2eb2409201fd481fb259a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20368,
                "url": "https://github.com/apache/pulsar/issues/20368",
                "title": "[Bug]  Return the earliest position when query position by timestamp.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.9.2</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">1\u3001In class OpFindNewest, first, execute the method [readEntryComplete] [checkFirst] logic, if the condition [condition.apply(entry)] executes successfully, set the searchPosition=lastPosition and lastMatchedPosition=position, then execute find() method.</p>\n<p dir=\"auto\">2\u3001In the find() method, if cursor is not null, call cursor.hasMoreEntries(searchPosition).Even if there are still messages later searchPosition, if the message is acked, the method [cursor.hasMoreEntries(searchPosition)] may still return false.</p>\n<p dir=\"auto\">3\u3001If the method [cursor.hasMoreEntries(searchPosition)] return false, will return lastMatchedPosition directly.</p>\n<p dir=\"auto\">4\u3001In this case, it will return earliest position.</p>\n<p dir=\"auto\">In my opinion, when querying the position based on the timestamp, the construction method of the cursor in the class OpFindNewest with null should be used</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">The position closest to provided timestamp</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The earliest position</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">Executing the following test cases in class PersistentMessageFinderTest can be reproduced.</p>\n<p dir=\"auto\">`<br>\n<a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/test/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/test\">@test</a><br>\nvoid testPersistentMessageFinderWhenLastMessageDelete() throws Exception {<br>\nfinal String ledgerAndCursorName = \"testPersistentMessageFinderWhenLastMessageDelete\";</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    ManagedLedgerConfig config = new ManagedLedgerConfig();\n    config.setRetentionSizeInMB(10);\n    config.setMaxEntriesPerLedger(10);\n    config.setRetentionTime(1, TimeUnit.HOURS);\n    ManagedLedger ledger = factory.open(ledgerAndCursorName, config);\n    ManagedCursorImpl cursor = (ManagedCursorImpl) ledger.openCursor(ledgerAndCursorName);\n\n    ledger.addEntry(createMessageWrittenToLedger(&quot;msg1&quot;));\n    Thread.sleep(100);\n    ledger.addEntry(createMessageWrittenToLedger(&quot;msg2&quot;));\n    Thread.sleep(100);\n    ledger.addEntry(createMessageWrittenToLedger(&quot;msg3&quot;));\n    Thread.sleep(100);\n    Position lastPosition = ledger.addEntry(createMessageWrittenToLedger(&quot;last-message&quot;));\n\n    Thread.sleep(1000);\n    long endTimestamp = System.currentTimeMillis();\n\n    Result result = new Result();\n    // delete last position message\n    cursor.delete(lastPosition);\n    CompletableFuture&lt;Void&gt; future = findMessage(result, cursor, endTimestamp);\n    future.get();\n    assertNull(result.exception);\n    assertNotEquals(result.position, null);\n    assertEquals(result.position, lastPosition);\n\n    result.reset();\n    cursor.close();\n    ledger.close();\n    factory.shutdown();\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">    ManagedLedgerConfig config = new ManagedLedgerConfig();\n    config.setRetentionSizeInMB(10);\n    config.setMaxEntriesPerLedger(10);\n    config.setRetentionTime(1, TimeUnit.HOURS);\n    ManagedLedger ledger = factory.open(ledgerAndCursorName, config);\n    ManagedCursorImpl cursor = (ManagedCursorImpl) ledger.openCursor(ledgerAndCursorName);\n\n    ledger.addEntry(createMessageWrittenToLedger(\"msg1\"));\n    Thread.sleep(100);\n    ledger.addEntry(createMessageWrittenToLedger(\"msg2\"));\n    Thread.sleep(100);\n    ledger.addEntry(createMessageWrittenToLedger(\"msg3\"));\n    Thread.sleep(100);\n    Position lastPosition = ledger.addEntry(createMessageWrittenToLedger(\"last-message\"));\n\n    Thread.sleep(1000);\n    long endTimestamp = System.currentTimeMillis();\n\n    Result result = new Result();\n    // delete last position message\n    cursor.delete(lastPosition);\n    CompletableFuture&lt;Void&gt; future = findMessage(result, cursor, endTimestamp);\n    future.get();\n    assertNull(result.exception);\n    assertNotEquals(result.position, null);\n    assertEquals(result.position, lastPosition);\n\n    result.reset();\n    cursor.close();\n    ledger.close();\n    factory.shutdown();\n}\n</code></pre></div>\n<p dir=\"auto\">`<br>\nexecute result\uff1aInstead of the last position, it found the the earliest position.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/16524922/248810927-9f62b900-e241-4062-81f6-a8a17b036102.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzE0ODYsIm5iZiI6MTcxNDk3MTE4NiwicGF0aCI6Ii8xNjUyNDkyMi8yNDg4MTA5MjctOWY2MmI5MDAtZTI0MS00MDYyLTgxZjYtYThhMTdiMDM2MTAyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA0NTMwNlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWNlMGRiZmZiZDg5ZTQ4MGU4NGJlMGFjODY3ZWQ5MmVkYzk5Y2NjOWU5MDkwOGQyZjdjODZjNzM1Zjc2NWVmMzImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.gJO_ujIhy9puN39WCno6sczK05HMQ6-SZ7XrG9ouxe0\"><img width=\"419\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/16524922/248810927-9f62b900-e241-4062-81f6-a8a17b036102.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzE0ODYsIm5iZiI6MTcxNDk3MTE4NiwicGF0aCI6Ii8xNjUyNDkyMi8yNDg4MTA5MjctOWY2MmI5MDAtZTI0MS00MDYyLTgxZjYtYThhMTdiMDM2MTAyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA0NTMwNlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWNlMGRiZmZiZDg5ZTQ4MGU4NGJlMGFjODY3ZWQ5MmVkYzk5Y2NjOWU5MDkwOGQyZjdjODZjNzM1Zjc2NWVmMzImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.gJO_ujIhy9puN39WCno6sczK05HMQ6-SZ7XrG9ouxe0\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20368",
                "createdAt": "2023-05-22T12:02:54Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][build] Improve the build and publish of pulsar images",
        "url": "https://github.com/apache/pulsar/pull/20462",
        "resourcePath": "/apache/pulsar/pull/20462",
        "createdAt": "2023-06-01T17:11:39Z",
        "number": 20462,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": ".github/workflows/pulsar-ci.yaml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/build.sh"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/publish.sh"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/pulsar-all/Dockerfile"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/pulsar-all/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/pulsar/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/docker-images/java-test-image/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/docker-images/latest-version-image/Dockerfile"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/docker-images/latest-version-image/pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5R7Om12gAoNTBmM2QwMjUxYjIxNmZiNjJiMGIyZDhkM2Q3ZmNhOWY0MThhYTBmNw",
                "url": "https://github.com/apache/pulsar/pull/20462/commits/50f3d0251b216fb62b0b2d8d3d7fca9f418aa0f7"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19544,
                "url": "https://github.com/apache/pulsar/issues/19544",
                "title": "[Bug]  Latest docker image version should be 2.11.0",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"docker run -it -p 6650:6650 -p 8080:8080  apachepulsar/pulsar:latest bin/pulsar standalone\"><pre class=\"notranslate\"><code class=\"notranslate\">docker run -it -p 6650:6650 -p 8080:8080  apachepulsar/pulsar:latest bin/pulsar standalone\n</code></pre></div>\n<p dir=\"auto\">Log version:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-02-16T15:22:43,429+0000 [main] INFO  org.apache.pulsar.broker.PulsarService - Starting Pulsar Broker service; version: '2.10.1'\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-02-16T15:22:43,429+0000 [main] INFO  org.apache.pulsar.broker.PulsarService - Starting Pulsar Broker service; version: '2.10.1'\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">The latest image version is Pulsar@2.10.1, the digest is 4a952b3c662b, this should be an error version.</p>\n<p dir=\"auto\">The Pulsar 2.11.0 has been released, so the latest image should be 2.11.0, not 2.10.1.</p>\n<p dir=\"auto\">Please let me know if I miss anything.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<ul dir=\"auto\">\n<li></li>\n</ul>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19544",
                "createdAt": "2023-02-16T15:26:12Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            },
            {
              "node": {
                "number": 20420,
                "url": "https://github.com/apache/pulsar/issues/20420",
                "title": "[Bug] pulsar-all 3.0.0 docker image contains Pulsar 2.11.0",
                "bodyHTML": "<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Ubuntu 20.04, Pulsar 3.0.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/12949466/241654033-2e7f1bc2-aeb8-4e72-aae3-73cddc02effd.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzE0OTMsIm5iZiI6MTcxNDk3MTE5MywicGF0aCI6Ii8xMjk0OTQ2Ni8yNDE2NTQwMzMtMmU3ZjFiYzItYWViOC00ZTcyLWFhZTMtNzNjZGRjMDJlZmZkLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA0NTMxM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTMyNGFkZWY2MGZmNzkwMWZmNzY4ZTNlOWFiZDBmMGU1YjEwZTkxODc3MzE0NDdkZjQ2NDhkNTBiZDZmOTdhNTQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.SyMieCVkBivNndapOwybx918xx0R3d2_RctdwnH3XeE\"><img width=\"1068\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/12949466/241654033-2e7f1bc2-aeb8-4e72-aae3-73cddc02effd.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzE0OTMsIm5iZiI6MTcxNDk3MTE5MywicGF0aCI6Ii8xMjk0OTQ2Ni8yNDE2NTQwMzMtMmU3ZjFiYzItYWViOC00ZTcyLWFhZTMtNzNjZGRjMDJlZmZkLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA0NTMxM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTMyNGFkZWY2MGZmNzkwMWZmNzY4ZTNlOWFiZDBmMGU1YjEwZTkxODc3MzE0NDdkZjQ2NDhkNTBiZDZmOTdhNTQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.SyMieCVkBivNndapOwybx918xx0R3d2_RctdwnH3XeE\" style=\"max-width: 100%;\"></a>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">pulsar-related libs in pulsar-all:3.0.0 image should be 3.0.0 also.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">pulsar-related libs in pulsar-all:3.0.0 is 2.11.0.</p>",
                "resourcePath": "/apache/pulsar/issues/20420",
                "createdAt": "2023-05-29T03:58:33Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Remove dependency on httpbin.org service in FunctionCommonTest",
        "url": "https://github.com/apache/pulsar/pull/20464",
        "resourcePath": "/apache/pulsar/pull/20464",
        "createdAt": "2023-06-01T17:38:10Z",
        "number": 20464,
        "mergeCommit": {
          "oid": "a5f2d25e0f435fa8758904a0f71ceefceb8b5deb",
          "message": "[fix][test] Remove dependency on httpbin.org service in FunctionCommonTest (#20464)",
          "commitUrl": "https://github.com/apache/pulsar/commit/a5f2d25e0f435fa8758904a0f71ceefceb8b5deb",
          "parents": {
            "nodes": [
              {
                "oid": "57f9467a8dbcd546ee9127d8dfbd000b46333f23",
                "message": "[fix][sec] Upgrade Guava to 32.0.0 to address CVE-2023-2976 (#20459)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/utils/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/utils/src/test/java/org/apache/pulsar/functions/utils/FunctionCommonTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5R7V0p2gAoODk0ZjU4YTM0ODgxZWM2NmFhYzY3YTBjOTRhMzI5MDAyNzZlZDYzMg",
                "url": "https://github.com/apache/pulsar/pull/20464/commits/894f58a34881ec66aac67a0c94a32900276ed632"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20463,
                "url": "https://github.com/apache/pulsar/issues/20463",
                "title": "[CI] FunctionCommonTest.testDownloadFileWithBasicAuth test is coupled to external service httpbin.org and when that is down, CI fails",
                "bodyHTML": "<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 15, Failures: 1, Errors: 0, Skipped: 13, Time elapsed: 32.262 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.functions.utils.FunctionCommonTest\n  Error:  org.apache.pulsar.functions.utils.FunctionCommonTest.testDownloadFileWithBasicAuth  Time elapsed: 10.029 s  &lt;&lt;&lt; FAILURE!\n  java.io.IOException: Server returned HTTP response code: 504 for URL: ***httpbin.org/basic-auth/foo/bar\n  \tat java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:2000)\n  \tat java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1589)\n  \tat java.base/sun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream(HttpsURLConnectionImpl.java:224)\n  \tat org.apache.pulsar.functions.utils.FunctionCommon.downloadFromHttpUrl(FunctionCommon.java:260)\n  \tat org.apache.pulsar.functions.utils.FunctionCommonTest.testDownloadFileWithBasicAuth(FunctionCommonTest.java:94)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 15, Failures: 1, Errors: 0, Skipped: 13, Time elapsed: 32.262 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.functions.utils.FunctionCommonTest\n  Error:  org.apache.pulsar.functions.utils.FunctionCommonTest.testDownloadFileWithBasicAuth  Time elapsed: 10.029 s  &lt;&lt;&lt; FAILURE!\n  java.io.IOException: Server returned HTTP response code: 504 for URL: ***httpbin.org/basic-auth/foo/bar\n  \tat java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream0(HttpURLConnection.java:2000)\n  \tat java.base/sun.net.www.protocol.http.HttpURLConnection.getInputStream(HttpURLConnection.java:1589)\n  \tat java.base/sun.net.www.protocol.https.HttpsURLConnectionImpl.getInputStream(HttpsURLConnectionImpl.java:224)\n  \tat org.apache.pulsar.functions.utils.FunctionCommon.downloadFromHttpUrl(FunctionCommon.java:260)\n  \tat org.apache.pulsar.functions.utils.FunctionCommonTest.testDownloadFileWithBasicAuth(FunctionCommonTest.java:94)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>",
                "resourcePath": "/apache/pulsar/issues/20463",
                "createdAt": "2023-06-01T17:19:57Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "area/ci"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Replace test call to Auth0 with call to WireMock",
        "url": "https://github.com/apache/pulsar/pull/20465",
        "resourcePath": "/apache/pulsar/pull/20465",
        "createdAt": "2023-06-01T20:28:02Z",
        "number": 20465,
        "mergeCommit": {
          "oid": "174c4866f926b1ae7f7935395fbea8c0aeb64e31",
          "message": "[fix][test] Replace test call to Auth0 with call to WireMock (#20465)",
          "commitUrl": "https://github.com/apache/pulsar/commit/174c4866f926b1ae7f7935395fbea8c0aeb64e31",
          "parents": {
            "nodes": [
              {
                "oid": "2d7c3b0e47a40f3ca265602d057859b77077dcc0",
                "message": "[fix][sec] Upgrade Jetty to address CVEs (#20461)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TokenOauth2AuthenticatedProducerConsumerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5R8M4E2gAoYmNiYjIwMDQ2MmUyN2U5NDlkMjRjODQ3MDBlMWQxYjBiM2JjNGFlOQ",
                "url": "https://github.com/apache/pulsar/pull/20465/commits/bcbb200462e27e949d24c84700e1d1b0b3bc4ae9"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19330,
                "url": "https://github.com/apache/pulsar/issues/19330",
                "title": "Flaky-test: TokenOauth2AuthenticatedProducerConsumerTest.testOAuth2TokenRefreshedWithoutReconnect, depends on external service",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4010953903/jobs/6894569493#step:11:607\">https://github.com/apache/pulsar/actions/runs/4010953903/jobs/6894569493#step:11:607</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 17, Failures: 1, Errors: 0, Skipped: 16, Time elapsed: 71.923 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.client.api.TokenOauth2AuthenticatedProducerConsumerTest\n  Error:  testOAuth2TokenRefreshedWithoutReconnect(org.apache.pulsar.client.api.TokenOauth2AuthenticatedProducerConsumerTest)  Time elapsed: 10.031 s  &lt;&lt;&lt; FAILURE!\n  org.awaitility.core.ConditionTimeoutException: Condition was evaluated in 9 seconds 17 milliseconds which is earlier than expected minimum timeout 10 seconds\n  \tat org.awaitility.core.ConditionAwaiter.await(ConditionAwaiter.java:172)\n  \tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:119)\n  \tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:31)\n  \tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:985)\n  \tat org.awaitility.core.ConditionFactory.untilAsserted(ConditionFactory.java:769)\n  \tat org.apache.pulsar.client.api.TokenOauth2AuthenticatedProducerConsumerTest.testOAuth2TokenRefreshedWithoutReconnect(TokenOauth2AuthenticatedProducerConsumerTest.java:219)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 17, Failures: 1, Errors: 0, Skipped: 16, Time elapsed: 71.923 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.client.api.TokenOauth2AuthenticatedProducerConsumerTest\n  Error:  testOAuth2TokenRefreshedWithoutReconnect(org.apache.pulsar.client.api.TokenOauth2AuthenticatedProducerConsumerTest)  Time elapsed: 10.031 s  &lt;&lt;&lt; FAILURE!\n  org.awaitility.core.ConditionTimeoutException: Condition was evaluated in 9 seconds 17 milliseconds which is earlier than expected minimum timeout 10 seconds\n  \tat org.awaitility.core.ConditionAwaiter.await(ConditionAwaiter.java:172)\n  \tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:119)\n  \tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:31)\n  \tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:985)\n  \tat org.awaitility.core.ConditionFactory.untilAsserted(ConditionFactory.java:769)\n  \tat org.apache.pulsar.client.api.TokenOauth2AuthenticatedProducerConsumerTest.testOAuth2TokenRefreshedWithoutReconnect(TokenOauth2AuthenticatedProducerConsumerTest.java:219)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19330",
                "createdAt": "2023-01-26T11:05:00Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] enable Go function token auth and TLS",
        "url": "https://github.com/apache/pulsar/pull/20468",
        "resourcePath": "/apache/pulsar/pull/20468",
        "createdAt": "2023-06-01T21:02:03Z",
        "number": 20468,
        "mergeCommit": {
          "oid": "8b3c085e9d26605cca544068e8611d72e7012468",
          "message": "[fix][fn] enable Go function token auth and TLS (#20468)\n\nCo-authored-by: Andy Walker <andy@andy.dev>",
          "commitUrl": "https://github.com/apache/pulsar/commit/8b3c085e9d26605cca544068e8611d72e7012468",
          "parents": {
            "nodes": [
              {
                "oid": "ceed19cf3b8536a8c9059bfbcb29ef972841b412",
                "message": "[fix][fn] Support customizing TLS config for function download command (#20482)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/conf/conf.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/examples/go.mod"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/examples/go.sum"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/instance.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/instanceConf.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/go/GoInstanceConfig.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/RuntimeUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/test/java/org/apache/pulsar/functions/runtime/RuntimeUtilsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5R8Ybx2gAoOTUzN2NjYmFmZDNhYzQ0OGNkMTQyMGYxMzNhOTMzMWZhNmUxOGYyYQ",
                "url": "https://github.com/apache/pulsar/pull/20468/commits/9537ccbafd3ac448cd1420f133a9331fa6e18f2a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20451,
                "url": "https://github.com/apache/pulsar/issues/20451",
                "title": "[Bug][fn] Go functions runtime does not support any sort of auth.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">After enabling JWT auth on our cluster, all of our Go functions started failing.  This is because authentication information is only passed to the <code class=\"notranslate\">pulsar-admin</code> command, and also because the Go function SDK has no concept of auth providers.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Just enable auth, and watch your go functions start to complain:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"broker.pulsar.svc.cluster.local:6650 local_addr=172.27.168.187:37436\n2023/06/01 03:05:16.139 connection.go:226: [warning] Failed to establish connection with broker: 'Unable to authenticate'  remote_addr=pulsar://pulsar-broker.pulsar.svc.cluster.local:6650 local_addr=172.27.168.187:37436\n2023/06/01 03:05:45.027 log.go:77: [error] create producer error:connection error\n2023/06/01 03:05:45.027 instance.go:210: [fatal] connection error\nStream closed EOF for pulsar/pf-public-default-function-test-30-c169f141-0 (pulsarfunction)\n\"><pre class=\"notranslate\"><code class=\"notranslate\">broker.pulsar.svc.cluster.local:6650 local_addr=172.27.168.187:37436\n2023/06/01 03:05:16.139 connection.go:226: [warning] Failed to establish connection with broker: 'Unable to authenticate'  remote_addr=pulsar://pulsar-broker.pulsar.svc.cluster.local:6650 local_addr=172.27.168.187:37436\n2023/06/01 03:05:45.027 log.go:77: [error] create producer error:connection error\n2023/06/01 03:05:45.027 instance.go:210: [fatal] connection error\nStream closed EOF for pulsar/pf-public-default-function-test-30-c169f141-0 (pulsarfunction)\n\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Working functions.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Dead functions.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20451",
                "createdAt": "2023-06-01T03:09:55Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "area/function"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Disable invalid test BrokerServiceTest#testBrokerStatsTopicLoadFailed",
        "url": "https://github.com/apache/pulsar/pull/20494",
        "resourcePath": "/apache/pulsar/pull/20494",
        "createdAt": "2023-06-05T13:35:23Z",
        "number": 20494,
        "mergeCommit": {
          "oid": "90f9651306426d82b35f3dec6380001e7b0d208e",
          "message": "[fix][test] Disable invalid test BrokerServiceTest#testBrokerStatsTopicLoadFailed (#20494)",
          "commitUrl": "https://github.com/apache/pulsar/commit/90f9651306426d82b35f3dec6380001e7b0d208e",
          "parents": {
            "nodes": [
              {
                "oid": "7e6ca31dcb7bd04afff4daf50ac44be4749b6f2b",
                "message": "[fix][fn] Go functions need to use static grpcPort in k8s runtime (#20404)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5SMkgX2gAoZjMzNDJmOTU1MGFhNzdlNjlmMGYyYzIyOThjYWQzYzg5OGFhYzFkYw",
                "url": "https://github.com/apache/pulsar/pull/20494/commits/f3342f9550aa77e69f0f2c2298cad3c898aac1dc"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20492,
                "url": "https://github.com/apache/pulsar/issues/20492",
                "title": "Flaky-test: BrokerServiceTest.testConnectionController",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/5174095082/jobs/9326450731?pr=20487#step:10:1497\">https://github.com/apache/pulsar/actions/runs/5174095082/jobs/9326450731?pr=20487#step:10:1497</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 81, Failures: 2, Errors: 0, Skipped: 73, Time elapsed: 208.775 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.BrokerServiceTest\n  Error:  org.apache.pulsar.broker.service.BrokerServiceTest.testConnectionController  Time elapsed: 60.212 s  &lt;&lt;&lt; FAILURE!\n  org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.TimeoutException\n  \tat org.apache.pulsar.client.api.PulsarClientException.unwrap(PulsarClientException.java:1034)\n  \tat org.apache.pulsar.client.impl.PulsarClientImpl.shutdownEventLoopGroup(PulsarClientImpl.java:873)\n  \tat org.apache.pulsar.client.impl.PulsarClientImpl.shutdown(PulsarClientImpl.java:817)\n  \tat org.apache.pulsar.broker.auth.MockedPulsarServiceBaseTest.internalCleanup(MockedPulsarServiceBaseTest.java:249)\n  \tat org.apache.pulsar.broker.service.BrokerServiceTest.cleanup(BrokerServiceTest.java:132)\n  \tat org.apache.pulsar.broker.service.BrokerServiceTest.testConnectionController(BrokerServiceTest.java:297)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: java.util.concurrent.TimeoutException\n  \tat io.netty.util.concurrent.DefaultPromise.get(DefaultPromise.java:360)\n  \tat org.apache.pulsar.client.impl.PulsarClientImpl.shutdownEventLoopGroup(PulsarClientImpl.java:871)\n  \t... 16 more\n  \n  Error:  org.apache.pulsar.broker.service.BrokerServiceTest.cleanup  Time elapsed: 59.979 s  &lt;&lt;&lt; FAILURE!\n  org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.TimeoutException\n  \tat org.apache.pulsar.client.api.PulsarClientException.unwrap(PulsarClientException.java:1034)\n  \tat org.apache.pulsar.client.impl.PulsarClientImpl.shutdownEventLoopGroup(PulsarClientImpl.java:873)\n  \tat org.apache.pulsar.client.impl.PulsarClientImpl.shutdown(PulsarClientImpl.java:817)\n  \tat org.apache.pulsar.broker.auth.MockedPulsarServiceBaseTest.internalCleanup(MockedPulsarServiceBaseTest.java:249)\n  \tat org.apache.pulsar.broker.service.BrokerServiceTest.cleanup(BrokerServiceTest.java:132)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n  \tat org.testng.internal.invokers.TestMethodWorker.invokeAfterClassMethods(TestMethodWorker.java:222)\n  \tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:131)\n  \tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n  \tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n  \tat org.testng.TestRunner.run(TestRunner.java:602)\n  \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n  \tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n  \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n  \tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n  \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n  \tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n  \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n  \tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n  \tat org.testng.TestNG.runSuites(TestNG.java:1099)\n  \tat org.testng.TestNG.run(TestNG.java:1067)\n  \tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n  \tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n  Caused by: java.util.concurrent.TimeoutException\n  \tat io.netty.util.concurrent.DefaultPromise.get(DefaultPromise.java:360)\n  \tat org.apache.pulsar.client.impl.PulsarClientImpl.shutdownEventLoopGroup(PulsarClientImpl.java:871)\n  \t... 35 more\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 81, Failures: 2, Errors: 0, Skipped: 73, Time elapsed: 208.775 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.BrokerServiceTest\n  Error:  org.apache.pulsar.broker.service.BrokerServiceTest.testConnectionController  Time elapsed: 60.212 s  &lt;&lt;&lt; FAILURE!\n  org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.TimeoutException\n  \tat org.apache.pulsar.client.api.PulsarClientException.unwrap(PulsarClientException.java:1034)\n  \tat org.apache.pulsar.client.impl.PulsarClientImpl.shutdownEventLoopGroup(PulsarClientImpl.java:873)\n  \tat org.apache.pulsar.client.impl.PulsarClientImpl.shutdown(PulsarClientImpl.java:817)\n  \tat org.apache.pulsar.broker.auth.MockedPulsarServiceBaseTest.internalCleanup(MockedPulsarServiceBaseTest.java:249)\n  \tat org.apache.pulsar.broker.service.BrokerServiceTest.cleanup(BrokerServiceTest.java:132)\n  \tat org.apache.pulsar.broker.service.BrokerServiceTest.testConnectionController(BrokerServiceTest.java:297)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: java.util.concurrent.TimeoutException\n  \tat io.netty.util.concurrent.DefaultPromise.get(DefaultPromise.java:360)\n  \tat org.apache.pulsar.client.impl.PulsarClientImpl.shutdownEventLoopGroup(PulsarClientImpl.java:871)\n  \t... 16 more\n  \n  Error:  org.apache.pulsar.broker.service.BrokerServiceTest.cleanup  Time elapsed: 59.979 s  &lt;&lt;&lt; FAILURE!\n  org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.TimeoutException\n  \tat org.apache.pulsar.client.api.PulsarClientException.unwrap(PulsarClientException.java:1034)\n  \tat org.apache.pulsar.client.impl.PulsarClientImpl.shutdownEventLoopGroup(PulsarClientImpl.java:873)\n  \tat org.apache.pulsar.client.impl.PulsarClientImpl.shutdown(PulsarClientImpl.java:817)\n  \tat org.apache.pulsar.broker.auth.MockedPulsarServiceBaseTest.internalCleanup(MockedPulsarServiceBaseTest.java:249)\n  \tat org.apache.pulsar.broker.service.BrokerServiceTest.cleanup(BrokerServiceTest.java:132)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n  \tat org.testng.internal.invokers.TestMethodWorker.invokeAfterClassMethods(TestMethodWorker.java:222)\n  \tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:131)\n  \tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n  \tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n  \tat org.testng.TestRunner.run(TestRunner.java:602)\n  \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n  \tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n  \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n  \tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n  \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n  \tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n  \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n  \tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n  \tat org.testng.TestNG.runSuites(TestNG.java:1099)\n  \tat org.testng.TestNG.run(TestNG.java:1067)\n  \tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n  \tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n  Caused by: java.util.concurrent.TimeoutException\n  \tat io.netty.util.concurrent.DefaultPromise.get(DefaultPromise.java:360)\n  \tat org.apache.pulsar.client.impl.PulsarClientImpl.shutdownEventLoopGroup(PulsarClientImpl.java:871)\n  \t... 35 more\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20492",
                "createdAt": "2023-06-05T12:49:14Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Replace calls to Auth0 with calls to wiremock",
        "url": "https://github.com/apache/pulsar/pull/20500",
        "resourcePath": "/apache/pulsar/pull/20500",
        "createdAt": "2023-06-05T22:28:45Z",
        "number": 20500,
        "mergeCommit": {
          "oid": "da04f24b6e81f05ace04fb4ae0d9a720b44c845f",
          "message": "[fix][test] Replace calls to Auth0 with calls to wiremock (#20500)",
          "commitUrl": "https://github.com/apache/pulsar/commit/da04f24b6e81f05ace04fb4ae0d9a720b44c845f",
          "parents": {
            "nodes": [
              {
                "oid": "12e6dd558b6ca1a22c228c8567f466d3d6aef024",
                "message": "[fix][misc] Use ubuntu 22.04 for Pulsar images (#20475)\n\n### Motivation\r\n\r\nUpgrade Ubuntu to 22.04 to fix some CVEs\r\n\r\n- CVE-2017-14063: https://nvd.nist.gov/vuln/detail/cve-2017-14063\r\n- CVE-2021-27291: https://nvd.nist.gov/vuln/detail/CVE-2021-27291\r\n- CVE-2021-20270: https://nvd.nist.gov/vuln/detail/CVE-2021-20270"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/auth/MockOIDCIdentityProvider.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TokenOauth2AuthenticatedProducerConsumerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/resources/authentication/token/credentials_file.json"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyTlsTestWithAuth.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/test/java/org/apache/pulsar/testclient/Oauth2PerformanceTransactionTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/test/resources/authentication/token/credentials_file.json"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5SPvWR2gAoMzQ5YWI0OGIzYTVmMzllOTQ3N2UyZmVlMjc4MjkwNzBjOTFmYWQzMg",
                "url": "https://github.com/apache/pulsar/pull/20500/commits/349ab48b3a5f39e9477e2fee27829070c91fad32"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20473,
                "url": "https://github.com/apache/pulsar/issues/20473",
                "title": "[Test] Remove Auth0 service dependency from all unit tests",
                "bodyHTML": "<h3 dir=\"auto\">Description</h3>\n<p dir=\"auto\">Auth0 service dependency in TokenOauth2AuthenticatedProducerConsumerTest was removed in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1737038141\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20465\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20465/hovercard\" href=\"https://github.com/apache/pulsar/pull/20465\">#20465</a>.</p>\n<p dir=\"auto\">It turns out that there is an Auth0 service dependency also in these 2 locations:</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/d565c953a7deab1ea93949bfefa44477e51e417f/pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyTlsTestWithAuth.java#L67-L70\">pulsar/pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyTlsTestWithAuth.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 67 to 70\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/d565c953a7deab1ea93949bfefa44477e51e417f\">d565c95</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L67\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"67\"></td>\n          <td id=\"LC67\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">proxyConfig</span>.<span class=\"pl-en\">setBrokerClientAuthenticationParameters</span>(<span class=\"pl-s\">\"{<span class=\"pl-cce\">\\\"</span>grant_type<span class=\"pl-cce\">\\\"</span>:<span class=\"pl-cce\">\\\"</span>client_credentials<span class=\"pl-cce\">\\\"</span>,\"</span> + </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L68\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"68\"></td>\n          <td id=\"LC68\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s\">\" <span class=\"pl-cce\">\\\"</span>issuerUrl<span class=\"pl-cce\">\\\"</span>:<span class=\"pl-cce\">\\\"</span>https://dev-kt-aa9ne.us.auth0.com<span class=\"pl-cce\">\\\"</span>,\"</span> + </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L69\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"69\"></td>\n          <td id=\"LC69\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s\">\" <span class=\"pl-cce\">\\\"</span>audience<span class=\"pl-cce\">\\\"</span>: <span class=\"pl-cce\">\\\"</span>https://dev-kt-aa9ne.us.auth0.com/api/v2/<span class=\"pl-cce\">\\\"</span>,\"</span> + </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L70\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"70\"></td>\n          <td id=\"LC70\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s\">\" <span class=\"pl-cce\">\\\"</span>privateKey<span class=\"pl-cce\">\\\"</span>:<span class=\"pl-cce\">\\\"</span>file://\"</span> + <span class=\"pl-s1\">tempFile</span>.<span class=\"pl-en\">getAbsolutePath</span>() + <span class=\"pl-s\">\"<span class=\"pl-cce\">\\\"</span>}\"</span>); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/82237d3684fe506bcb6426b3b23f413422e6e4fb/pulsar-testclient/src/test/java/org/apache/pulsar/testclient/Oauth2PerformanceTransactionTest.java#L87-L89\">pulsar/pulsar-testclient/src/test/java/org/apache/pulsar/testclient/Oauth2PerformanceTransactionTest.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 87 to 89\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/82237d3684fe506bcb6426b3b23f413422e6e4fb\">82237d3</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L87\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"87\"></td>\n          <td id=\"LC87\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">params</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s\">\"issuerUrl\"</span>, <span class=\"pl-k\">new</span> <span class=\"pl-smi\">URL</span>(<span class=\"pl-s\">\"https://dev-kt-aa9ne.us.auth0.com\"</span>)); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L88\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"88\"></td>\n          <td id=\"LC88\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">params</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s\">\"privateKey\"</span>, <span class=\"pl-s1\">path</span>.<span class=\"pl-en\">toUri</span>().<span class=\"pl-en\">toURL</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L89\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"89\"></td>\n          <td id=\"LC89\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">params</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s\">\"audience\"</span>, <span class=\"pl-s\">\"https://dev-kt-aa9ne.us.auth0.com/api/v2/\"</span>); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">These should also be covered.</p>\n<p dir=\"auto\">An additional detail is that it would be better to change the OAuth2 audience claim <code class=\"notranslate\">https://dev-kt-aa9ne.us.auth0.com/api/v2/</code> in TokenOauth2AuthenticatedProducerConsumerTest during this change since that could cause confusion for future maintainers.</p>\n<h3 dir=\"auto\">Implementation hints</h3>\n<p dir=\"auto\">It's possible to share test classes via pulsar-broker test-jar dependency:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"        &lt;dependency&gt;\n          &lt;groupId&gt;${project.groupId}&lt;/groupId&gt;\n          &lt;artifactId&gt;pulsar-broker&lt;/artifactId&gt;\n          &lt;version&gt;${project.version}&lt;/version&gt;\n          &lt;scope&gt;test&lt;/scope&gt;\n          &lt;type&gt;test-jar&lt;/type&gt;\n        &lt;/dependency&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">        &lt;dependency&gt;\n          &lt;groupId&gt;${project.groupId}&lt;/groupId&gt;\n          &lt;artifactId&gt;pulsar-broker&lt;/artifactId&gt;\n          &lt;version&gt;${project.version}&lt;/version&gt;\n          &lt;scope&gt;test&lt;/scope&gt;\n          &lt;type&gt;test-jar&lt;/type&gt;\n        &lt;/dependency&gt;\n</code></pre></div>\n<p dir=\"auto\">This is already specified in <code class=\"notranslate\">pulsar-proxy/pom.xml</code> and <code class=\"notranslate\">pulsar-testclient/pom.xml</code></p>\n<p dir=\"auto\">It would be possible to extract some test classes from TokenOauth2AuthenticatedProducerConsumerTest for Wiremocking OAuth and put the classes under some package in pulsar-broker/src/test/java/org/apache/pulsar . This would be a way to reduce code duplication across tests where similar logic is needed.</p>",
                "resourcePath": "/apache/pulsar/issues/20473",
                "createdAt": "2023-06-02T05:22:02Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][admin] Make failed `bin/pulsar-admin source` command exit with code `1 (failed)`  instead of `0 (success)`",
        "url": "https://github.com/apache/pulsar/pull/20503",
        "resourcePath": "/apache/pulsar/pull/20503",
        "createdAt": "2023-06-06T03:41:39Z",
        "number": 20503,
        "mergeCommit": {
          "oid": "f53cdda4599460ee364a4883a120ece46fe96ac2",
          "message": "[fix][admin] Make failed `bin/pulsar-admin source` command exit with code `1 (failed)`  instead of `0 (success)` (#20503)",
          "commitUrl": "https://github.com/apache/pulsar/commit/f53cdda4599460ee364a4883a120ece46fe96ac2",
          "parents": {
            "nodes": [
              {
                "oid": "50b9a93e42e412d9f17b1637287d1a4c7c7ab148",
                "message": "[fix][fn] TLS args admin download command use zero arity (#20513)\n\n### Motivation\r\n\r\n#20482 broke the function download command with this error:\r\n\r\n```\r\nExpected a command, got false\r\nUsage: pulsar-admin [options] [command] [command options]\r\n  Options:\r\n    --admin-url\r\n      Admin Service URL to which to connect.\r\n      Default: http://localhost:8080/\r\n```\r\n\r\nThe problem is that the TLS args for hostname verification and for insecure TLS are zero arity, and therefore, we should not add the `false` or the `true` arguments.\r\n\r\n### Modifications\r\n\r\n* Correct the changes made to the TLS args passed to the `pulsar-admin` CLI tool\r\n\r\n### Documentation\r\n\r\n- [x] `doc-not-needed`"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools-test/src/test/java/org/apache/pulsar/admin/cli/PulsarAdminToolTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdSources.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/test/java/org/apache/pulsar/admin/cli/TestCmdSources.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5SQuDi2gAoMDhlYTUzNjRlZWM4NzU1NTI0YTA4MzgzMjUyZmY4MjVkZWNkMThiMQ",
                "url": "https://github.com/apache/pulsar/pull/20503/commits/08ea5364eec8755524a08383252ff825decd18b1"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20485,
                "url": "https://github.com/apache/pulsar/issues/20485",
                "title": "Return exit code 1 when `pulsar-admin` commands fail",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Run <code class=\"notranslate\">bin/pulsar-admin sources create --source-config-file doesnotexist.yaml &amp;&amp; echo $?</code>. The output clearly shows an error, but renders a success return code.</p>\n<p dir=\"auto\">I just spent an hour debugging what turned out to be a spelling error. \ud83d\ude1d</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20485",
                "createdAt": "2023-06-04T11:59:15Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "area/cli"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] fix client with multiple serviceUrl can not connect to server permanently when one broker shutdown",
        "url": "https://github.com/apache/pulsar/pull/20509",
        "resourcePath": "/apache/pulsar/pull/20509",
        "createdAt": "2023-06-06T08:49:45Z",
        "number": 20509,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/HttpClient.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/HttpLookupService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/LookupService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarServiceNameResolver.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ServiceNameResolver.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/TopicListWatcher.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/TransactionMetaStoreHandler.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5SR9UH2gAoNjE4MDU1NjYyOTdkMmJiNDdjNWRlY2JlOGZlODI3OTA0OGU4Yjg5ZQ",
                "url": "https://github.com/apache/pulsar/pull/20509/commits/61805566297d2bb47c5decbe8fe8279048e8b89e"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20508,
                "url": "https://github.com/apache/pulsar/issues/20508",
                "title": "[Bug] [client] client with multi-serviceUrl can not connect to server permanently when only one broker shutdown",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master branch. both 2.x, 3.x have this bug</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">In our production environment, only one broker is down, the others are available. However, the clients configured with multi-serviceUrl can not retry connect successfully, continue throwing connectionTimeout exception, finally reach the max retry number and shutdown</p>\n<p dir=\"auto\">Client code such as follow, host1 shutdown, host2 and host3 available, then client can not create producer permanently<br>\n<code class=\"notranslate\">PulsarClient client = PulsarClient.builder().serviceUrl(\"pulsar://host1,host2,host3\").build(); Producer&lt;byte[]&gt; producer = client.newProducer().topic(topicName).create();</code></p>\n<p dir=\"auto\">The root cause is in PulsarServiceNameResolver#resolveHost. PulsarClient use the same pulsarServiceNameResolver instance to resolveHost when do retry connect. And the retry logic in pulsarServiceNameResolve is roundrobin.</p>\n<p dir=\"auto\">However, if we use pulsarClient to create producer on a partitioned-topic, all the partition share the same pulsarServiceNameResolver. So the retry logic actually is not roundrobin, but random.</p>\n<p dir=\"auto\">The more partitions in topic, the easier this bug occur.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">single point of failure should not exist</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">single point of failure</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20508",
                "createdAt": "2023-06-06T08:48:02Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] fix `ModularLoadManagerImpl` always delete active bundle-data.",
        "url": "https://github.com/apache/pulsar/pull/20512",
        "resourcePath": "/apache/pulsar/pull/20512",
        "createdAt": "2023-06-06T14:49:58Z",
        "number": 20512,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/ModularLoadManagerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/ModularLoadManagerImplTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5SUJ662gAoNjM1YTA5Y2UxMDRmYzM5NTNlODgyZTFlMjNkYzQ3YTU5ZDZlNTg3Yg",
                "url": "https://github.com/apache/pulsar/pull/20512/commits/635a09ce104fc3953e882e1e23dc47a59d6e587b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20544,
                "url": "https://github.com/apache/pulsar/issues/20544",
                "title": "[Bug] LoadManager always delete active bundle-data.",
                "bodyHTML": "<p dir=\"auto\">This problem will cause <code class=\"notranslate\">LoadSheedingTask</code> and <code class=\"notranslate\">BundleSplitTask</code> fail to perfom right logic, because of the lost of active bundle-data.</p>\n<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master code</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>create a cluster with at least two broker.</li>\n<li>create heavy traffic to the cluster. to ensure there is lot of namespace bundles.</li>\n<li>add a log on the line 567<br>\n<div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/c39f7bb123a995538fc8fa9a54b572c73fee39db/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/ModularLoadManagerImpl.java#L563-L570\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/ModularLoadManagerImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 563 to 570\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/c39f7bb123a995538fc8fa9a54b572c73fee39db\">c39f7bb</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L563\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"563\"></td>\n          <td id=\"LC563\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">String</span> <span class=\"pl-s1\">bundle</span> : <span class=\"pl-s1\">bundleData</span>.<span class=\"pl-en\">keySet</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L564\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"564\"></td>\n          <td id=\"LC564\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (!<span class=\"pl-s1\">activeBundles</span>.<span class=\"pl-en\">contains</span>(<span class=\"pl-s1\">bundle</span>)){ </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L565\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"565\"></td>\n          <td id=\"LC565\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">bundleData</span>.<span class=\"pl-en\">remove</span>(<span class=\"pl-s1\">bundle</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L566\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"566\"></td>\n          <td id=\"LC566\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-en\">getLeaderElectionService</span>().<span class=\"pl-en\">isLeader</span>()){ </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L567\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"567\"></td>\n          <td id=\"LC567\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-en\">deleteBundleDataFromMetadataStore</span>(<span class=\"pl-s1\">bundle</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L568\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"568\"></td>\n          <td id=\"LC568\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L569\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"569\"></td>\n          <td id=\"LC569\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L570\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"570\"></td>\n          <td id=\"LC570\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">no log is print if there is no bundle split.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\"><a href=\"https://gist.github.com/lifepuzzlefun/b91ac4cb577edd336038c2a08876f8d1\">https://gist.github.com/lifepuzzlefun/b91ac4cb577edd336038c2a08876f8d1</a></p>\n<p dir=\"auto\">bundle 0xf6b3c96d_0xf7aedfd6 is not splited, but it is deleted 5 times in one minute.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20544",
                "createdAt": "2023-06-08T15:06:36Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Reduce flakiness of AdminApi2Test",
        "url": "https://github.com/apache/pulsar/pull/20529",
        "resourcePath": "/apache/pulsar/pull/20529",
        "createdAt": "2023-06-07T12:38:06Z",
        "number": 20529,
        "mergeCommit": {
          "oid": "60dba5d675f998a5108a35be65649edd57ce8596",
          "message": "[fix][test] Reduce flakiness of AdminApi2Test (#20529)",
          "commitUrl": "https://github.com/apache/pulsar/commit/60dba5d675f998a5108a35be65649edd57ce8596",
          "parents": {
            "nodes": [
              {
                "oid": "03f916702ec2a887833543fdea5a2d5305a87302",
                "message": "[fix][broker] Restore solution for certain topic unloading race conditions (#20527)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApi2Test.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/testcontext/PulsarTestContext.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5SaLlx2gAoMDg5YTg0YjIxYmE3MDQ4YjNlYWRkOWU3MTE4YjU3MzIyNDgyYzExMw",
                "url": "https://github.com/apache/pulsar/pull/20529/commits/089a84b21ba7048b3eadd9e7118b57322482c113"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20376,
                "url": "https://github.com/apache/pulsar/issues/20376",
                "title": "Flaky-test:  AdminApi2Test.resetClusters",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/5056774399/jobs/9075132818?pr=20372#step:10:1446\">https://github.com/apache/pulsar/actions/runs/5056774399/jobs/9075132818?pr=20372#step:10:1446</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 82, Failures: 1, Errors: 0, Skipped: 55, Time elapsed: 660.065 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.admin.AdminApi2Test\n  Error:  org.apache.pulsar.broker.admin.AdminApi2Test.resetClusters  Time elapsed: 2.209 s  &lt;&lt;&lt; FAILURE!\n  org.apache.pulsar.client.admin.PulsarAdminException$ServerSideErrorException: \n  \n   --- An unexpected error occurred in the server ---\n  \n  Message: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \n  Stacktrace:\n  \n  org.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\n  \tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\n  \tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\n  \tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n  \tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\n  \tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\n  \t... 14 more\n  \n  \tat org.apache.pulsar.client.admin.PulsarAdminException.wrap(PulsarAdminException.java:252)\n  \tat org.apache.pulsar.client.admin.internal.BaseResource.sync(BaseResource.java:352)\n  \tat org.apache.pulsar.client.admin.internal.TenantsImpl.deleteTenant(TenantsImpl.java:93)\n  \tat org.apache.pulsar.broker.admin.AdminApi2Test.resetClusters(AdminApi2Test.java:181)\n  \tat jdk.internal.reflect.GeneratedMethodAccessor548.invoke(Unknown Source)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n  \tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n  \tat org.testng.internal.invokers.TestInvoker.runAfterConfigurations(TestInvoker.java:792)\n  \tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:768)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n  \tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n  \tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n  \tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n  \tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n  \tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n  \tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n  \tat org.testng.TestRunner.run(TestRunner.java:602)\n  \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n  \tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n  \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n  \tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n  \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n  \tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n  \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n  \tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n  \tat org.testng.TestNG.runSuites(TestNG.java:1099)\n  \tat org.testng.TestNG.run(TestNG.java:1067)\n  \tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n  \tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n  \tSuppressed: org.apache.pulsar.client.admin.PulsarAdminException$ServerSideErrorException: \n   --- An unexpected error occurred in the server ---\n  \n  Message: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \n  Stacktrace:\n  \n  org.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\n  \tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\n  \tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\n  \tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n  \tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\n  \tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\n  \t... 14 more\n  \n  \t\tat org.apache.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:272)\n  \t\tat org.apache.pulsar.client.admin.internal.BaseResource$4.failed(BaseResource.java:237)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation$1.failed(JerseyInvocation.java:882)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation$1.completed(JerseyInvocation.java:863)\n  \t\tat org.glassfish.jersey.client.ClientRuntime.processResponse(ClientRuntime.java:229)\n  \t\tat org.glassfish.jersey.client.ClientRuntime.access$200(ClientRuntime.java:62)\n  \t\tat org.glassfish.jersey.client.ClientRuntime$2.lambda$response$0(ClientRuntime.java:173)\n  \t\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)\n  \t\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:292)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:274)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:244)\n  \t\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:288)\n  \t\tat org.glassfish.jersey.client.ClientRuntime$2.response(ClientRuntime.java:173)\n  \t\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$apply$1(AsyncHttpConnector.java:254)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n  \t\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \t\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$retryOperation$4(AsyncHttpConnector.java:296)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n  \t\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \t\tat org.asynchttpclient.netty.NettyResponseFuture.loadContent(NettyResponseFuture.java:222)\n  \t\tat org.asynchttpclient.netty.NettyResponseFuture.done(NettyResponseFuture.java:257)\n  \t\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.finishUpdate(AsyncHttpClientHandler.java:241)\n  \t\tat org.asynchttpclient.netty.handler.HttpHandler.handleChunk(HttpHandler.java:114)\n  \t\tat org.asynchttpclient.netty.handler.HttpHandler.handleRead(HttpHandler.java:143)\n  \t\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.channelRead(AsyncHttpClientHandler.java:78)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelRead(CombinedChannelDuplexHandler.java:436)\n  \t\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)\n  \t\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)\n  \t\tat io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:251)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n  \t\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n  \t\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n  \t\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\n  \t\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n  \t\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \t\tat java.base/java.lang.Thread.run(Thread.java:833)\n  \tCaused by: javax.ws.rs.InternalServerErrorException: HTTP 500 {&quot;reason&quot;:&quot;\\n --- An unexpected error occurred in the server ---\\n\\nMessage: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\nStacktrace:\\n\\norg.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\\n\\tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\\n\\tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\\n\\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\\n\\tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\\n\\tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\\n\\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\\n\\tat java.base/java.lang.Thread.run(Thread.java:833)\\nCaused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\\n\\t... 14 more\\n&quot;}\n  \t\tat org.glassfish.jersey.client.JerseyInvocation.convertToException(JerseyInvocation.java:960)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation.access$700(JerseyInvocation.java:82)\n  \t\t... 54 more\n  Caused by: [CIRCULAR REFERENCE: javax.ws.rs.InternalServerErrorException: HTTP 500 {&quot;reason&quot;:&quot;\\n --- An unexpected error occurred in the server ---\\n\\nMessage: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\nStacktrace:\\n\\norg.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\\n\\tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\\n\\tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\\n\\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\\n\\tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\\n\\tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\\n\\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\\n\\tat java.base/java.lang.Thread.run(Thread.java:833)\\nCaused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\\n\\t... 14 more\\n&quot;}]\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 82, Failures: 1, Errors: 0, Skipped: 55, Time elapsed: 660.065 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.admin.AdminApi2Test\n  Error:  org.apache.pulsar.broker.admin.AdminApi2Test.resetClusters  Time elapsed: 2.209 s  &lt;&lt;&lt; FAILURE!\n  org.apache.pulsar.client.admin.PulsarAdminException$ServerSideErrorException: \n  \n   --- An unexpected error occurred in the server ---\n  \n  Message: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \n  Stacktrace:\n  \n  org.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\n  \tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\n  \tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\n  \tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n  \tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\n  \tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\n  \t... 14 more\n  \n  \tat org.apache.pulsar.client.admin.PulsarAdminException.wrap(PulsarAdminException.java:252)\n  \tat org.apache.pulsar.client.admin.internal.BaseResource.sync(BaseResource.java:352)\n  \tat org.apache.pulsar.client.admin.internal.TenantsImpl.deleteTenant(TenantsImpl.java:93)\n  \tat org.apache.pulsar.broker.admin.AdminApi2Test.resetClusters(AdminApi2Test.java:181)\n  \tat jdk.internal.reflect.GeneratedMethodAccessor548.invoke(Unknown Source)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n  \tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n  \tat org.testng.internal.invokers.TestInvoker.runAfterConfigurations(TestInvoker.java:792)\n  \tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:768)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n  \tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n  \tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n  \tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n  \tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n  \tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n  \tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n  \tat org.testng.TestRunner.run(TestRunner.java:602)\n  \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n  \tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n  \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n  \tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n  \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n  \tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n  \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n  \tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n  \tat org.testng.TestNG.runSuites(TestNG.java:1099)\n  \tat org.testng.TestNG.run(TestNG.java:1067)\n  \tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n  \tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n  \tSuppressed: org.apache.pulsar.client.admin.PulsarAdminException$ServerSideErrorException: \n   --- An unexpected error occurred in the server ---\n  \n  Message: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \n  Stacktrace:\n  \n  org.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\n  \tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\n  \tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\n  \tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\n  \tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n  \tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\n  \tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\n  \tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\n  \tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\n  \t... 14 more\n  \n  \t\tat org.apache.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:272)\n  \t\tat org.apache.pulsar.client.admin.internal.BaseResource$4.failed(BaseResource.java:237)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation$1.failed(JerseyInvocation.java:882)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation$1.completed(JerseyInvocation.java:863)\n  \t\tat org.glassfish.jersey.client.ClientRuntime.processResponse(ClientRuntime.java:229)\n  \t\tat org.glassfish.jersey.client.ClientRuntime.access$200(ClientRuntime.java:62)\n  \t\tat org.glassfish.jersey.client.ClientRuntime$2.lambda$response$0(ClientRuntime.java:173)\n  \t\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)\n  \t\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:292)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:274)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:244)\n  \t\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:288)\n  \t\tat org.glassfish.jersey.client.ClientRuntime$2.response(ClientRuntime.java:173)\n  \t\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$apply$1(AsyncHttpConnector.java:254)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n  \t\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \t\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$retryOperation$4(AsyncHttpConnector.java:296)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n  \t\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \t\tat org.asynchttpclient.netty.NettyResponseFuture.loadContent(NettyResponseFuture.java:222)\n  \t\tat org.asynchttpclient.netty.NettyResponseFuture.done(NettyResponseFuture.java:257)\n  \t\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.finishUpdate(AsyncHttpClientHandler.java:241)\n  \t\tat org.asynchttpclient.netty.handler.HttpHandler.handleChunk(HttpHandler.java:114)\n  \t\tat org.asynchttpclient.netty.handler.HttpHandler.handleRead(HttpHandler.java:143)\n  \t\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.channelRead(AsyncHttpClientHandler.java:78)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelRead(CombinedChannelDuplexHandler.java:436)\n  \t\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)\n  \t\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)\n  \t\tat io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:251)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n  \t\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n  \t\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n  \t\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\n  \t\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n  \t\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \t\tat java.base/java.lang.Thread.run(Thread.java:833)\n  \tCaused by: javax.ws.rs.InternalServerErrorException: HTTP 500 {\"reason\":\"\\n --- An unexpected error occurred in the server ---\\n\\nMessage: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\nStacktrace:\\n\\norg.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\\n\\tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\\n\\tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\\n\\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\\n\\tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\\n\\tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\\n\\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\\n\\tat java.base/java.lang.Thread.run(Thread.java:833)\\nCaused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\\n\\t... 14 more\\n\"}\n  \t\tat org.glassfish.jersey.client.JerseyInvocation.convertToException(JerseyInvocation.java:960)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation.access$700(JerseyInvocation.java:82)\n  \t\t... 54 more\n  Caused by: [CIRCULAR REFERENCE: javax.ws.rs.InternalServerErrorException: HTTP 500 {\"reason\":\"\\n --- An unexpected error occurred in the server ---\\n\\nMessage: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\nStacktrace:\\n\\norg.apache.pulsar.metadata.api.MetadataStoreException: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:476)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.handleDeleteResult(ZKMetadataStore.java:304)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$5(ZKMetadataStore.java:216)\\n\\tat org.apache.zookeeper.MockZooKeeper.multi(MockZooKeeper.java:1006)\\n\\tat org.apache.zookeeper.MockZooKeeperSession.multi(MockZooKeeperSession.java:191)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.batchOperation(ZKMetadataStore.java:190)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.internalBatchOperation(AbstractBatchedMetadataStore.java:184)\\n\\tat org.apache.pulsar.metadata.impl.batching.AbstractBatchedMetadataStore.flush(AbstractBatchedMetadataStore.java:124)\\n\\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\\n\\tat java.base/java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305)\\n\\tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\\n\\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\\n\\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\\n\\tat java.base/java.lang.Thread.run(Thread.java:833)\\nCaused by: org.apache.zookeeper.KeeperException$NotEmptyException: KeeperErrorCode = Directory not empty for /managed-ledgers/prop-xyz2\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:132)\\n\\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:54)\\n\\tat org.apache.pulsar.metadata.impl.ZKMetadataStore.getException(ZKMetadataStore.java:466)\\n\\t... 14 more\\n\"}]\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20376",
                "createdAt": "2023-05-23T14:43:28Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] REST Client Producer fails with TLS only",
        "url": "https://github.com/apache/pulsar/pull/20535",
        "resourcePath": "/apache/pulsar/pull/20535",
        "createdAt": "2023-06-07T19:50:38Z",
        "number": 20535,
        "mergeCommit": {
          "oid": "005cce11d0d67cdf7b08305bed55cd2f9ba7f4f0",
          "message": "[fix][broker] REST Client Producer fails with TLS only (#20535)\n\nCo-authored-by: Matt Anderson <>\r\n\r\nFixes #20536\r\n\r\n### Motivation\r\n\r\nWhen disabling HTTP ports in the Pulsar broker, the [REST Client Producer](https://pulsar.apache.org/docs/3.0.x/client-libraries-rest/) fails to produce messages. For reproduction steps, please reference issue details.\r\n\r\n### Modifications\r\n\r\nChange the following lines:\r\n```java\r\n\r\n            LookupResult result = optionalResult.get();\r\n            if (result.getLookupData().getHttpUrl().equals(pulsar().getWebServiceAddress())) {\r\n                // Current broker owns the topic, add to owning topic.\r\n```\r\nTo:\r\n```java\r\n            LookupResult result = optionalResult.get();\r\n            if (result.getLookupData().getHttpUrl().equals(pulsar().getWebServiceAddress())\r\n                    || result.getLookupData().getHttpUrlTls().equals(pulsar().getWebServiceAddressTls())) {\r\n                // Current broker owns the topic, add to owning topic.\r\n```\r\n\r\n### Verifying this change\r\n\r\nThis change is a trivial rework / code cleanup without any test coverage. (outside of the reproduction tests described in the #20536)\r\n\r\n<!-- DO NOT REMOVE THIS SECTION. CHECK THE PROPER BOX ONLY. -->\r\n\r\n*If the box was checked, please highlight the changes*\r\n\r\n- [ ] Dependencies (add or upgrade a dependency)\r\n- [ ] The public API\r\n- [ ] The schema\r\n- [ ] The default values of configurations\r\n- [ ] The threading model\r\n- [ ] The binary protocol\r\n- [x] The REST endpoints\r\n- [ ] The admin CLI options\r\n- [ ] The metrics\r\n- [ ] Anything that affects deployment\r\n\r\n### Documentation\r\n\r\n<!-- DO NOT REMOVE THIS SECTION. CHECK THE PROPER BOX ONLY. -->\r\n\r\n- [ ] `doc` <!-- Your PR contains doc changes. -->\r\n- [ ] `doc-required` <!-- Your PR changes impact docs and you will update later -->\r\n- [x] `doc-not-needed` <!-- Your PR changes do not impact docs -->\r\n- [ ] `doc-complete` <!-- Docs have been already added -->\r\n\r\n### Matching PR in forked repository\r\n\r\nPR in forked repository: https://github.com/maanders-tibco/pulsar\r\n\r\n<!--\r\nAfter opening this PR, the build in apache/pulsar will fail and instructions will\r\nbe provided for opening a PR in the PR author's forked repository.\r\n\r\napache/pulsar pull requests should be first tested in your own fork since the \r\napache/pulsar CI based on GitHub Actions has constrained resources and quota.\r\nGitHub Actions provides separate quota for pull requests that are executed in \r\na forked repository.\r\n\r\nThe tests will be run in the forked repository until all PR review comments have\r\nbeen handled, the tests pass and the PR is approved by a reviewer.\r\n-->",
          "commitUrl": "https://github.com/apache/pulsar/commit/005cce11d0d67cdf7b08305bed55cd2f9ba7f4f0",
          "parents": {
            "nodes": [
              {
                "oid": "aa1d5d9ab660803179ee2f24dcedd23428ec867c",
                "message": "[fix][broker] Should not throw NotFoundException when metadata already exists. (#20539)\n\n## Motivation\r\nMake the Exception more clear.\r\n## Modification\r\nReturn the `409 Conflict` instead of `404 NoFound` when metadata already exists."
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/rest/TopicsBase.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ScxVZ2gAoYzQ5MzZiZDg5OWY2ODA1Yzc1OWY5Yzg0NmY4OTZmNTJjOTcyODNmZQ",
                "url": "https://github.com/apache/pulsar/pull/20535/commits/c4936bd899f6805c759f9c846f896f52c97283fe"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20536,
                "url": "https://github.com/apache/pulsar/issues/20536",
                "title": "[Bug] REST Client Producer fails with TLS only",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Fedora 38 + Pulsar 3.0<br>\nFedora 38 + Pulsar 2.11</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">When disabling HTTP ports in the Pulsar broker, the <a href=\"https://pulsar.apache.org/docs/3.0.x/client-libraries-rest/\" rel=\"nofollow\">REST Client Producer</a> fails to produce messages. The following is a description to reproduce the error:</p>\n<ol dir=\"auto\">\n<li>Start secure single node bare metal cluster according to this doc: <a href=\"https://pulsar.apache.org/docs/3.0.x/deploy-bare-metal/\" rel=\"nofollow\">https://pulsar.apache.org/docs/3.0.x/deploy-bare-metal/</a></li>\n<li>Configure broker.conf with the following parameters:</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"brokerServicePort=6650\nbrokerServicePortTls=6651\nwebServicePort=8080\nwebServicePortTls=8081\"><pre class=\"notranslate\"><code class=\"notranslate\">brokerServicePort=6650\nbrokerServicePortTls=6651\nwebServicePort=8080\nwebServicePortTls=8081\n</code></pre></div>\n<p dir=\"auto\">After starting the broker, this command:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[~/Desktop/pulsar/apache-pulsar-3.0.0]: curl -v -k --cert ./certs/client.cert.pem --key ./certs/client.key.pem --location --request POST 'https://localhost:8081/topics/persistent/public/default/test'  --header 'Content-Type: application/json' --data-raw '{\n    &quot;producerName&quot;: &quot;rest-producer&quot;,\n    &quot;messages&quot;: [ { &quot;payload&quot;:&quot;{\\&quot;TestCURL\\&quot;:\\&quot;TestCURL\\&quot;}&quot; } ] }'\"><pre class=\"notranslate\"><code class=\"notranslate\">[~/Desktop/pulsar/apache-pulsar-3.0.0]: curl -v -k --cert ./certs/client.cert.pem --key ./certs/client.key.pem --location --request POST 'https://localhost:8081/topics/persistent/public/default/test'  --header 'Content-Type: application/json' --data-raw '{\n    \"producerName\": \"rest-producer\",\n    \"messages\": [ { \"payload\":\"{\\\"TestCURL\\\":\\\"TestCURL\\\"}\" } ] }'\n</code></pre></div>\n<p dir=\"auto\">Results in an output of:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{&quot;messagePublishResults&quot;:[{&quot;messageId&quot;:&quot;15:1:-1&quot;,&quot;errorCode&quot;:0,&quot;schemaVersion&quot;:0}],&quot;schemaVersion&quot;:0}%\"><pre class=\"notranslate\"><code class=\"notranslate\">{\"messagePublishResults\":[{\"messageId\":\"15:1:-1\",\"errorCode\":0,\"schemaVersion\":0}],\"schemaVersion\":0}%\n</code></pre></div>\n<p dir=\"auto\">(success)<br>\n3. Configure broker.conf without insecure ports defined:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"brokerServicePort=\nbrokerServicePortTls=6651\nwebServicePort=\nwebServicePortTls=8081\"><pre class=\"notranslate\"><code class=\"notranslate\">brokerServicePort=\nbrokerServicePortTls=6651\nwebServicePort=\nwebServicePortTls=8081\n</code></pre></div>\n<p dir=\"auto\">After starting the broker, this command:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[~/Desktop/pulsar/apache-pulsar-3.0.0]: curl -v -k --cert  ./certs/client.cert.pem --key ./certs/client.key.pem --location  --request POST  'https://localhost:8081/topics/persistent/public/default/test'  --header  'Content-Type: application/json' --data-raw '{\n&quot;producerName&quot;: &quot;rest-producer&quot;,\n&quot;messages&quot;: [ { &quot;payload&quot;:&quot;{\\&quot;TestCURL\\&quot;:\\&quot;TestCURL\\&quot;}&quot; } ] }'\"><pre class=\"notranslate\"><code class=\"notranslate\">[~/Desktop/pulsar/apache-pulsar-3.0.0]: curl -v -k --cert  ./certs/client.cert.pem --key ./certs/client.key.pem --location  --request POST  'https://localhost:8081/topics/persistent/public/default/test'  --header  'Content-Type: application/json' --data-raw '{\n\"producerName\": \"rest-producer\",\n\"messages\": [ { \"payload\":\"{\\\"TestCURL\\\":\\\"TestCURL\\\"}\" } ] }'\n</code></pre></div>\n<p dir=\"auto\">Results in an output of:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Maximum (50) redirects followed\ncurl: (47) Maximum (50) redirects followed\"><pre class=\"notranslate\"><code class=\"notranslate\">Maximum (50) redirects followed\ncurl: (47) Maximum (50) redirects followed\n</code></pre></div>\n<p dir=\"auto\">(failure)<br>\n(conclusion that even in the newest version of 3.0, the error persists)<br>\n4. Test with pulsar-client admin tool<br>\nFor added measure, I tested the pulsar-client tool, and found that even with the broker.conf, producing and consuming still works.<br>\n(in one terminal)</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-client consume -s sub public/default/test -n 0\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-client consume -s sub public/default/test -n 0\n</code></pre></div>\n<p dir=\"auto\">(in another terminal)</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-client produce public/default/test -m &quot;---------hello apache pulsar2-------&quot; -n 10\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-client produce public/default/test -m \"---------hello apache pulsar2-------\" -n 10\n</code></pre></div>\n<p dir=\"auto\">(conclusion that without any changes, the REST producer api has an issue, but the pulsar-client tool doesn\u2019t have it with the exact same broker configuration).</p>\n<p dir=\"auto\">I also looked through the code and the public git history in the REST Client source code, but didn\u2019t see anything fixed.</p>\n<p dir=\"auto\">In conclusion, my tests show that under  this configuration, the REST Producer has a bug that has not been fixed in any newer version.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Should be able to produce to a topic on a broker with only SSL enabled.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Infinite HTTP redirection due to incorrect handling where only null ports are provided in <code class=\"notranslate\">broker.conf</code> (intentionally, so that no non-TLS ports are enabled).</p>\n<p dir=\"auto\">This error occurs due to the fact that the logic to find the broker from the topic name doesn't handle the case where <code class=\"notranslate\">brokerServicePort=</code> or <code class=\"notranslate\">webServicePort=</code>.  It can be found here:</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/60dba5d675f998a5108a35be65649edd57ce8596/pulsar-broker/src/main/java/org/apache/pulsar/broker/rest/TopicsBase.java#L436\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/rest/TopicsBase.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 436\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/60dba5d675f998a5108a35be65649edd57ce8596\">60dba5d</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L436\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"436\"></td>\n          <td id=\"LC436\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">result</span>.<span class=\"pl-en\">getLookupData</span>().<span class=\"pl-en\">getHttpUrl</span>().<span class=\"pl-en\">equals</span>(<span class=\"pl-en\">pulsar</span>().<span class=\"pl-en\">getWebServiceAddress</span>())) { </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">To fix, I propose to change the following lines:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"\n            LookupResult result = optionalResult.get();\n            if (result.getLookupData().getHttpUrl().equals(pulsar().getWebServiceAddress())) {\n                // Current broker owns the topic, add to owning topic.\"><pre class=\"notranslate\">            <span class=\"pl-smi\">LookupResult</span> <span class=\"pl-s1\">result</span> = <span class=\"pl-s1\">optionalResult</span>.<span class=\"pl-en\">get</span>();\n            <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">result</span>.<span class=\"pl-en\">getLookupData</span>().<span class=\"pl-en\">getHttpUrl</span>().<span class=\"pl-en\">equals</span>(<span class=\"pl-en\">pulsar</span>().<span class=\"pl-en\">getWebServiceAddress</span>())) {\n                <span class=\"pl-c\">// Current broker owns the topic, add to owning topic.</span></pre></div>\n<p dir=\"auto\">To:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"            LookupResult result = optionalResult.get();\n            if (result.getLookupData().getHttpUrl().equals(pulsar().getWebServiceAddress())\n                    || result.getLookupData().getHttpUrlTls().equals(pulsar().getWebServiceAddressTls())) {\n                // Current broker owns the topic, add to owning topic.\"><pre class=\"notranslate\">            <span class=\"pl-smi\">LookupResult</span> <span class=\"pl-s1\">result</span> = <span class=\"pl-s1\">optionalResult</span>.<span class=\"pl-en\">get</span>();\n            <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">result</span>.<span class=\"pl-en\">getLookupData</span>().<span class=\"pl-en\">getHttpUrl</span>().<span class=\"pl-en\">equals</span>(<span class=\"pl-en\">pulsar</span>().<span class=\"pl-en\">getWebServiceAddress</span>())\n                    || <span class=\"pl-s1\">result</span>.<span class=\"pl-en\">getLookupData</span>().<span class=\"pl-en\">getHttpUrlTls</span>().<span class=\"pl-en\">equals</span>(<span class=\"pl-en\">pulsar</span>().<span class=\"pl-en\">getWebServiceAddressTls</span>())) {\n                <span class=\"pl-c\">// Current broker owns the topic, add to owning topic.</span></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20536",
                "createdAt": "2023-06-07T20:08:20Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker, client] Fixing BC FIPS based payload encryption",
        "url": "https://github.com/apache/pulsar/pull/20542",
        "resourcePath": "/apache/pulsar/pull/20542",
        "createdAt": "2023-06-08T12:52:42Z",
        "number": 20542,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": "bouncy-castle/src/test/resources/certificate/public-key.client-rsa.pem"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "bouncy-castle/src/test/resources/certificate/public-key.rsa-1024.pem"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "bouncy-castle/src/test/resources/certificate/public-key.rsa-2048.pem"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "bouncy-castle/src/test/resources/certificate/public-key.rsa-256.pem"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-messagecrypto-bc/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-messagecrypto-bc/src/main/java/org/apache/pulsar/client/impl/crypto/MessageCryptoBc.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "src/check-binary-license.sh"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tiered-storage/jcloud/pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ShGPE2gAoM2JiNDRjNjJjMGI0OWZhYzJlNjZmYjFhZDI4ODFkNzdkYjNjYjA3YQ",
                "url": "https://github.com/apache/pulsar/pull/20542/commits/3bb44c62c0b49fac2e66fb1ad2881d77db3cb07a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20373,
                "url": "https://github.com/apache/pulsar/issues/20373",
                "title": "E2E encryption implementation using Bouncycastle FIPS provider and only the FIPS-library provided tools",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">my firm would like to use Pulsar but using Bouncycastle FIPS approved libs in approved mode for E2E encryption.</p>\n<p dir=\"auto\">Currently the <code class=\"notranslate\">MessageCryptoBc</code> is the only <code class=\"notranslate\">MessageCrypto</code> implementation (non FIPS), and it is explicitly referenced from <code class=\"notranslate\">ProducerImpl</code> and <code class=\"notranslate\">ConsumerImpl</code> - unless overridden.</p>\n<p dir=\"auto\">I think it would be greate if someone adds an encryption key and a CryptoKeyReader, based on the loaded modules pulsar would use the fips or non-fips implementation. As related job has been done in pulsar to separate out different version (non-fips or fips) of BouncyCastle dependencies, we could expand on it.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">An idea about the tasks:</p>\n<ol dir=\"auto\">\n<li>Create a new MessageCrypto implementation using only bouncycastle FIPS provider and API calls and add it to a new <code class=\"notranslate\">org.apache.pulsar:pulsar-client-messagecrypto-bcfips</code> module (<code class=\"notranslate\">pulsar-client-messagecrypto-bc</code> already exists).</li>\n<li>ProducerImpl and ConsumerImpl should check which version (bc or bc-fips) of MessageCrypto can be found on the classpath and that should be used. Decision should be logged. Defaulting back to the origial non-fips solution for backward compatibility if both are on classpath.</li>\n</ol>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\">n/a</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">Notes:</p>\n<ul dir=\"auto\">\n<li>ECDSA keys cannot be used to wrap/encrypt keys - in BC's FIPS library only RSA or ELGAMAL cyphers can wrap keys (<a href=\"https://downloads.bouncycastle.org/fips-java/BC-FJA-UserGuide-1.0.2.pdf\" rel=\"nofollow\">https://downloads.bouncycastle.org/fips-java/BC-FJA-UserGuide-1.0.2.pdf</a>, chapter 4)</li>\n<li>in MessageCryptoBc data key encryption is using encrypt/decryp mode of cypher, but it should use wrap and unwrap (please confirm)</li>\n<li>SecureRandom should be changed probably in the new MessageCryprto implementation: maybe using \"NONCEANDIV\" for IV generation (what is done for each message), and another \"DEFAULT\" type for AES data key generation (DEFAULT may exhaust entropy if used for Nonce and IV generation)</li>\n</ul>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20373",
                "createdAt": "2023-05-23T13:41:01Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Flakey-test : Remove `null` assignment to Pulsar insntance in `MockedPulsarServiceBaseTest`",
        "url": "https://github.com/apache/pulsar/pull/20555",
        "resourcePath": "/apache/pulsar/pull/20555",
        "createdAt": "2023-06-10T08:13:51Z",
        "number": 20555,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/auth/MockedPulsarServiceBaseTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5SrO1U2gAoYWQ3NDFhYTc4MmFmZTVlZjNhZjI4YTVmNjI0MjA3MGU5MTk3NGY4Mw",
                "url": "https://github.com/apache/pulsar/pull/20555/commits/ad741aa782afe5ef3af28a5f6242070e91974f83"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20553,
                "url": "https://github.com/apache/pulsar/issues/20553",
                "title": "Flaky-test: SimpleProducerConsumerTest.rest",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/5218634223/jobs/9420198396\">https://github.com/apache/pulsar/actions/runs/5218634223/jobs/9420198396</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error:  Tests run: 106, Failures: 1, Errors: 0, Skipped: 63, Time elapsed: 578.464 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.client.api.SimpleProducerConsumerTest\n  Error:  org.apache.pulsar.client.api.SimpleProducerConsumerTest.rest  Time elapsed: 1.665 s  &lt;&lt;&lt; FAILURE!\n  java.lang.NullPointerException: Cannot invoke &quot;org.apache.pulsar.broker.PulsarService.getConfiguration()&quot; because &quot;this.pulsar&quot; is null\n  \tat org.apache.pulsar.client.api.SimpleProducerConsumerTest.rest(SimpleProducerConsumerTest.java:142)\n  \tat jdk.internal.reflect.GeneratedMethodAccessor174.invoke(Unknown Source)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n  \tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n  \tat org.testng.internal.invokers.TestInvoker.runAfterConfigurations(TestInvoker.java:792)\n  \tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:768)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n  \tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n  \tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n  \tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n  \tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n  \tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n  \tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n  \tat org.testng.TestRunner.run(TestRunner.java:602)\n  \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n  \tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n  \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n  \tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n  \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n  \tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n  \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n  \tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n  \tat org.testng.TestNG.runSuites(TestNG.java:1099)\n  \tat org.testng.TestNG.run(TestNG.java:1067)\n  \tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n  \tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\"><pre class=\"notranslate\"><code class=\"notranslate\">Error:  Tests run: 106, Failures: 1, Errors: 0, Skipped: 63, Time elapsed: 578.464 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.client.api.SimpleProducerConsumerTest\n  Error:  org.apache.pulsar.client.api.SimpleProducerConsumerTest.rest  Time elapsed: 1.665 s  &lt;&lt;&lt; FAILURE!\n  java.lang.NullPointerException: Cannot invoke \"org.apache.pulsar.broker.PulsarService.getConfiguration()\" because \"this.pulsar\" is null\n  \tat org.apache.pulsar.client.api.SimpleProducerConsumerTest.rest(SimpleProducerConsumerTest.java:142)\n  \tat jdk.internal.reflect.GeneratedMethodAccessor174.invoke(Unknown Source)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n  \tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n  \tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n  \tat org.testng.internal.invokers.TestInvoker.runAfterConfigurations(TestInvoker.java:792)\n  \tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:768)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n  \tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n  \tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n  \tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n  \tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n  \tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n  \tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n  \tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n  \tat org.testng.TestRunner.run(TestRunner.java:602)\n  \tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n  \tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n  \tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n  \tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n  \tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n  \tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n  \tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n  \tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n  \tat org.testng.TestNG.runSuites(TestNG.java:1099)\n  \tat org.testng.TestNG.run(TestNG.java:1067)\n  \tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n  \tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n  \tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n  \tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20553",
                "createdAt": "2023-06-09T16:35:32Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Remove failed future when topic load error",
        "url": "https://github.com/apache/pulsar/pull/20561",
        "resourcePath": "/apache/pulsar/pull/20561",
        "createdAt": "2023-06-12T11:16:35Z",
        "number": 20561,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApi2Test.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/OneWayReplicatorTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Swpxx2gAoNGYyYzAwMTI2ODJkOTJhOGVhYTQ4YjhmOWNkZWFiZmUzM2I5N2Y2YQ",
                "url": "https://github.com/apache/pulsar/pull/20561/commits/4f2c0012682d92a8eaa48b8f9cdeabfe33b97f6a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 14941,
                "url": "https://github.com/apache/pulsar/issues/14941",
                "title": "Topic is temporarily unavailable",
                "bodyHTML": "<p dir=\"auto\"><strong>Describe the bug</strong><br>\nWhen the leader node tries to unload the topic and times out, the node where the topic is located will display Topic is temporarily unavailable\u3002<br>\nversion:2.8.1<br>\ntopic type:persistent<br>\n<a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/40714172/160769955-c7803baf-4e36-40f2-b0a0-9c2af31c5403.png\"><img width=\"1378\" alt=\"image\" src=\"https://user-images.githubusercontent.com/40714172/160769955-c7803baf-4e36-40f2-b0a0-9c2af31c5403.png\" style=\"max-width: 100%;\"></a><br>\n<a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/40714172/160770184-83cd1b03-0ff9-4fcf-a675-31b1acf324e6.png\"><img width=\"1377\" alt=\"image\" src=\"https://user-images.githubusercontent.com/40714172/160770184-83cd1b03-0ff9-4fcf-a675-31b1acf324e6.png\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\"><strong>To Reproduce</strong><br>\nSteps to reproduce the behavior:</p>\n<ol dir=\"auto\">\n<li>Go to '...'</li>\n<li>Click on '....'</li>\n<li>Scroll down to '....'</li>\n<li>See error</li>\n</ol>\n<p dir=\"auto\"><strong>Expected behavior</strong><br>\nA clear and concise description of what you expected to happen.</p>\n<p dir=\"auto\"><strong>Screenshots</strong><br>\nIf applicable, add screenshots to help explain your problem.</p>\n<p dir=\"auto\"><strong>Desktop (please complete the following information):</strong></p>\n<ul dir=\"auto\">\n<li>OS: [e.g. iOS]</li>\n</ul>\n<p dir=\"auto\"><strong>Additional context</strong><br>\nAdd any other context about the problem here.</p>",
                "resourcePath": "/apache/pulsar/issues/14941",
                "createdAt": "2022-03-30T06:56:40Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "lifecycle/stale"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix one potential to add duplicated consumer",
        "url": "https://github.com/apache/pulsar/pull/20583",
        "resourcePath": "/apache/pulsar/pull/20583",
        "createdAt": "2023-06-15T10:20:10Z",
        "number": 20583,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/ClientErrorsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5TFGMm2gAoZmJlYmNlZGI2ZmRlMWU4ZTJjZThlYTQwMzY1OWNhMGZjMzQzMjFmMQ",
                "url": "https://github.com/apache/pulsar/pull/20583/commits/fbebcedb6fde1e8e2ce8ea403659ca0fc34321f1"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20576,
                "url": "https://github.com/apache/pulsar/issues/20576",
                "title": "[Bug] [broker] subscription of topic in a permanent fence state and consumerList remain offline consumer",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">server version: 2.9.3</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">I found the similar problem as <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1187824861\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/14970\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/14970/hovercard\" href=\"https://github.com/apache/pulsar/pull/14970\">#14970</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1606466409\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19692\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19692/hovercard\" href=\"https://github.com/apache/pulsar/pull/19692\">#19692</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1194866024\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/15051\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/15051/hovercard\" href=\"https://github.com/apache/pulsar/pull/15051\">#15051</a> in our 2.9.3 production environment.</p>\n<p dir=\"auto\">It remain offline consumers in consumerList, but it was removed from the consumerSet and consumers. And this subscription become fenced permanently.</p>\n<p dir=\"auto\">But it is different from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1606466409\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19692\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19692/hovercard\" href=\"https://github.com/apache/pulsar/pull/19692\">#19692</a>. The topic of this subscription is not closed, and this topic has other available subscriptions, only 1 subscription remain offline consumers and become fenced permanently.</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/13505225/245711385-2545b8ed-b095-4bad-aa7d-2217f1d687dc.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzE2NjAsIm5iZiI6MTcxNDk3MTM2MCwicGF0aCI6Ii8xMzUwNTIyNS8yNDU3MTEzODUtMjU0NWI4ZWQtYjA5NS00YmFkLWFhN2QtMjIxN2YxZDY4N2RjLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA0NTYwMFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTFlNGQzNzJkODBiYWQ2ZTVmYTUzYTQyMzMwMTg2ZWMxNjZjMTkyNjIwMjA4MjM2MGVlNzEzNDIxOTFlNGMwZGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.FC8CxG9W83o1BQL7c8vAB8TRMgOBq7pc5H50DaanFQI\"><img src=\"https://private-user-images.githubusercontent.com/13505225/245711385-2545b8ed-b095-4bad-aa7d-2217f1d687dc.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzE2NjAsIm5iZiI6MTcxNDk3MTM2MCwicGF0aCI6Ii8xMzUwNTIyNS8yNDU3MTEzODUtMjU0NWI4ZWQtYjA5NS00YmFkLWFhN2QtMjIxN2YxZDY4N2RjLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA0NTYwMFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTFlNGQzNzJkODBiYWQ2ZTVmYTUzYTQyMzMwMTg2ZWMxNjZjMTkyNjIwMjA4MjM2MGVlNzEzNDIxOTFlNGMwZGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.FC8CxG9W83o1BQL7c8vAB8TRMgOBq7pc5H50DaanFQI\" alt=\"\u4f01\u4e1a\u5fae\u4fe1\u622a\u56fe_76807075-f79d-4501-962e-10efbcc18f5b\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">I have encounter this problem twice. I guess this maybe a new possibility for duplicated consumer problem happen.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">..</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">..</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">..</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20576",
                "createdAt": "2023-06-14T07:48:56Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][admin] Clusters list API return clusters with local flag",
        "url": "https://github.com/apache/pulsar/pull/20593",
        "resourcePath": "/apache/pulsar/pull/20593",
        "createdAt": "2023-06-16T08:58:06Z",
        "number": 20593,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/ClustersBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdClusters.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5TKzdt2gAoNzc3ODhjMDA1YTNjYmZlMWEyYWQ1Y2Q0YmY0NzQzMWZlNTIyNWY5Zg",
                "url": "https://github.com/apache/pulsar/pull/20593/commits/77788c005a3cbfe1a2ad5cd4bf47431fe5225f9f"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20581,
                "url": "https://github.com/apache/pulsar/issues/20581",
                "title": "[Improve][Admin API] Clusters list API return clusters with local and remote flag",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">After configuring the geo-replication on Pulsar clusters, the <code class=\"notranslate\">clusters list</code> API will return multiple clusters, including the local Pulsar cluster and remote clusters like</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-admin clusters list\nus-west\nus-east\nus-cent\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-admin clusters list\nus-west\nus-east\nus-cent\n</code></pre></div>\n<p dir=\"auto\">But in this return, you can't distinguish the local and the remote cluster. When you need to remove the geo-replication configuration, it will be hard to decide which cluster should be removed on replicated tenants and namespaces unless you record the cluster information.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">I am thinking about whether it's possible to add some flags on the <code class=\"notranslate\">clusters list</code> API return data like</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-admin clusters list\nus-west(local)\nus-east(remote)\nus-cent(remote)\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-admin clusters list\nus-west(local)\nus-east(remote)\nus-cent(remote)\n</code></pre></div>\n<p dir=\"auto\">That will be easy for users to distinguish.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20581",
                "createdAt": "2023-06-15T06:48:50Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky test ExtensibleLoadManagerTest.testIsolationPolicy",
        "url": "https://github.com/apache/pulsar/pull/20609",
        "resourcePath": "/apache/pulsar/pull/20609",
        "createdAt": "2023-06-19T14:47:51Z",
        "number": 20609,
        "mergeCommit": {
          "oid": "e5606f28b89511e23c975b5266fc80168518a978",
          "message": "[fix][test] Fix flaky test ExtensibleLoadManagerTest.testIsolationPolicy (#20609)",
          "commitUrl": "https://github.com/apache/pulsar/commit/e5606f28b89511e23c975b5266fc80168518a978",
          "parents": {
            "nodes": [
              {
                "oid": "677d160148afc935c34a072fb62b765a8a65045c",
                "message": "[cleanup][broker] Remove unused cache executor in `PulsarService` (#20563)\n\nCo-authored-by: wangjinlong <wangjinlong@zhihu.com>\r\n### Motivation\r\n\r\nRemove unused cache executor in PulsarService"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/loadbalance/ExtensibleLoadManagerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5TWZAp2gAoNjc3YWJjOTI3OTMyNjdhMWUzZDYyZmI5MGQwZTM4ODUxMWQ5NGM5Yg",
                "url": "https://github.com/apache/pulsar/pull/20609/commits/677abc92793267a1e3d62fb90d0e388511d94c9b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20608,
                "url": "https://github.com/apache/pulsar/issues/20608",
                "title": "Flaky-test: ExtensibleLoadManagerTest.testIsolationPolicy",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/5309497330/jobs/9610705022?pr=20603#step:12:23713\">https://github.com/apache/pulsar/actions/runs/5309497330/jobs/9610705022?pr=20603#step:12:23713</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 20, Failures: 1, Errors: 0, Skipped: 16, Time elapsed: 545.625 s &lt;&lt;&lt; FAILURE! - in TestSuite\n  Error:  org.apache.pulsar.tests.integration.loadbalance.ExtensibleLoadManagerTest.testIsolationPolicy  Time elapsed: 29.596 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [true] but found [false]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertTrue(Assert.java:56)\n  \tat org.testng.Assert.assertTrue(Assert.java:66)\n  \tat org.apache.pulsar.tests.integration.loadbalance.ExtensibleLoadManagerTest.testIsolationPolicy(ExtensibleLoadManagerTest.java:349)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 20, Failures: 1, Errors: 0, Skipped: 16, Time elapsed: 545.625 s &lt;&lt;&lt; FAILURE! - in TestSuite\n  Error:  org.apache.pulsar.tests.integration.loadbalance.ExtensibleLoadManagerTest.testIsolationPolicy  Time elapsed: 29.596 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [true] but found [false]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertTrue(Assert.java:56)\n  \tat org.testng.Assert.assertTrue(Assert.java:66)\n  \tat org.apache.pulsar.tests.integration.loadbalance.ExtensibleLoadManagerTest.testIsolationPolicy(ExtensibleLoadManagerTest.java:349)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20608",
                "createdAt": "2023-06-19T14:38:02Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][pip] PIP-277: Add `current` option in the Clusters list cmd",
        "url": "https://github.com/apache/pulsar/pull/20614",
        "resourcePath": "/apache/pulsar/pull/20614",
        "createdAt": "2023-06-20T05:56:15Z",
        "number": 20614,
        "mergeCommit": {
          "oid": "d8904321a3a661eda3382c35ff92d54e7cdde57d",
          "message": "[improve][pip] PIP-277: Add `current` option in the Clusters list cmd (#20614)",
          "commitUrl": "https://github.com/apache/pulsar/commit/d8904321a3a661eda3382c35ff92d54e7cdde57d",
          "parents": {
            "nodes": [
              {
                "oid": "3bbd5a314ed73411b7026db189b3ad7ca17979ba",
                "message": "[fix][broker] Fix web tls url null cause NPE (#21137)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "RENAMED",
                "path": "pip/pip-276.md"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pip/pip-277.md"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5TZsLH2gAoZjdmOTEyNzM1NjgzY2QyZDM2NTM2ODNhMDlhMmMyM2E5ZWRmZWZmNw",
                "url": "https://github.com/apache/pulsar/pull/20614/commits/f7f912735683cd2d3653683a09a2c23a9edfeff7"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20581,
                "url": "https://github.com/apache/pulsar/issues/20581",
                "title": "[Improve][Admin API] Clusters list API return clusters with local and remote flag",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">After configuring the geo-replication on Pulsar clusters, the <code class=\"notranslate\">clusters list</code> API will return multiple clusters, including the local Pulsar cluster and remote clusters like</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-admin clusters list\nus-west\nus-east\nus-cent\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-admin clusters list\nus-west\nus-east\nus-cent\n</code></pre></div>\n<p dir=\"auto\">But in this return, you can't distinguish the local and the remote cluster. When you need to remove the geo-replication configuration, it will be hard to decide which cluster should be removed on replicated tenants and namespaces unless you record the cluster information.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">I am thinking about whether it's possible to add some flags on the <code class=\"notranslate\">clusters list</code> API return data like</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-admin clusters list\nus-west(local)\nus-east(remote)\nus-cent(remote)\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-admin clusters list\nus-west(local)\nus-east(remote)\nus-cent(remote)\n</code></pre></div>\n<p dir=\"auto\">That will be easy for users to distinguish.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20581",
                "createdAt": "2023-06-15T06:48:50Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix ModularLoadManagerImpl always delete active bundle-data. sec ver.",
        "url": "https://github.com/apache/pulsar/pull/20620",
        "resourcePath": "/apache/pulsar/pull/20620",
        "createdAt": "2023-06-20T14:53:02Z",
        "number": 20620,
        "mergeCommit": {
          "oid": "f2f0bf47c02ba8c15c63ec5cfb177f913b3fec9a",
          "message": "[fix][broker] fix ModularLoadManagerImpl always delete active bundle-data. sec ver. (#20620)\n\nCo-authored-by: wangjinlong <wangjinlong@zhihu.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/f2f0bf47c02ba8c15c63ec5cfb177f913b3fec9a",
          "parents": {
            "nodes": [
              {
                "oid": "976a58061fd87d577b7903622ed2e61f4bec7d22",
                "message": "[improve][meta] Improve fault tolerance of blocking calls by supporting timeout (#21028)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/ModularLoadManagerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/impl/ModularLoadManagerImplTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5TcsSk2gAoYjVjY2MwOGM1NDMxMmRlYzA4NzM2ZTk0NTk5YzZlOTA4ZjBkNjJjOQ",
                "url": "https://github.com/apache/pulsar/pull/20620/commits/b5ccc08c54312dec08736e94599c6e908f0d62c9"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20544,
                "url": "https://github.com/apache/pulsar/issues/20544",
                "title": "[Bug] LoadManager always delete active bundle-data.",
                "bodyHTML": "<p dir=\"auto\">This problem will cause <code class=\"notranslate\">LoadSheedingTask</code> and <code class=\"notranslate\">BundleSplitTask</code> fail to perfom right logic, because of the lost of active bundle-data.</p>\n<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master code</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>create a cluster with at least two broker.</li>\n<li>create heavy traffic to the cluster. to ensure there is lot of namespace bundles.</li>\n<li>add a log on the line 567<br>\n<div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/c39f7bb123a995538fc8fa9a54b572c73fee39db/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/ModularLoadManagerImpl.java#L563-L570\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/ModularLoadManagerImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 563 to 570\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/c39f7bb123a995538fc8fa9a54b572c73fee39db\">c39f7bb</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L563\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"563\"></td>\n          <td id=\"LC563\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">String</span> <span class=\"pl-s1\">bundle</span> : <span class=\"pl-s1\">bundleData</span>.<span class=\"pl-en\">keySet</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L564\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"564\"></td>\n          <td id=\"LC564\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (!<span class=\"pl-s1\">activeBundles</span>.<span class=\"pl-en\">contains</span>(<span class=\"pl-s1\">bundle</span>)){ </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L565\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"565\"></td>\n          <td id=\"LC565\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">bundleData</span>.<span class=\"pl-en\">remove</span>(<span class=\"pl-s1\">bundle</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L566\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"566\"></td>\n          <td id=\"LC566\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-en\">getLeaderElectionService</span>().<span class=\"pl-en\">isLeader</span>()){ </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L567\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"567\"></td>\n          <td id=\"LC567\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-en\">deleteBundleDataFromMetadataStore</span>(<span class=\"pl-s1\">bundle</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L568\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"568\"></td>\n          <td id=\"LC568\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L569\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"569\"></td>\n          <td id=\"LC569\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L570\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"570\"></td>\n          <td id=\"LC570\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">no log is print if there is no bundle split.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\"><a href=\"https://gist.github.com/lifepuzzlefun/b91ac4cb577edd336038c2a08876f8d1\">https://gist.github.com/lifepuzzlefun/b91ac4cb577edd336038c2a08876f8d1</a></p>\n<p dir=\"auto\">bundle 0xf6b3c96d_0xf7aedfd6 is not splited, but it is deleted 5 times in one minute.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20544",
                "createdAt": "2023-06-08T15:06:36Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][io]\u00a0Elastic Search Sink can now handle raw Record",
        "url": "https://github.com/apache/pulsar/pull/20623",
        "resourcePath": "/apache/pulsar/pull/20623",
        "createdAt": "2023-06-20T17:52:49Z",
        "number": 20623,
        "mergeCommit": {
          "oid": "b05f4360585316870961436b43a0c50d6ea60898",
          "message": "[improve][io]\u00a0Elastic Search Sink can now handle raw Record (#20623)",
          "commitUrl": "https://github.com/apache/pulsar/commit/b05f4360585316870961436b43a0c50d6ea60898",
          "parents": {
            "nodes": [
              {
                "oid": "2152870702bec5b91a3d7125aa539c4f8e71c943",
                "message": "[fix][doc]Correcting spelling mistakes in the pulsar-broker module (#20798)\n\nSigned-off-by: zhangwd3 <zhangwd3@asiainfo.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/elastic-search/src/main/java/org/apache/pulsar/io/elasticsearch/ElasticSearchSink.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-io/elastic-search/src/test/java/org/apache/pulsar/io/elasticsearch/ElasticSearchRawRecordTests.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/elastic-search/src/test/java/org/apache/pulsar/io/elasticsearch/ElasticSearchSinkTests.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Tdonu2gAoNjRiM2YwMmQzZmNiZjkwODg4MTk5YThlYjM2OTJjMWUzNmRlOTQ3Ng",
                "url": "https://github.com/apache/pulsar/pull/20623/commits/64b3f02d3fcbf90888199a8eb3692c1e36de9476"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20619,
                "url": "https://github.com/apache/pulsar/issues/20619",
                "title": "ElasticSearch Sink Improvements",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">The current ElasticSearch sink does not work cleanly with the changes made to allow for Sink pre-processing functions, from PIP 193. Additionally, as mentioned in another <a href=\"https://github.com/apache/pulsar/issues/13173\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/13173/hovercard\">issue</a>, the option to use the key from the record should not be tied to whether the schema is enabled or not.</p>\n<p dir=\"auto\">These changes allow the sink to handle <code class=\"notranslate\">Record&lt;String&gt;</code> and <code class=\"notranslate\">Record&lt;byte[]&gt;</code> which are likely to be output from some pre-processing transform functions.  As long as the record contains a string or bytes that can be parsed as valid JSON, it should be used.</p>\n<p dir=\"auto\">This comes from a thread on slack with <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/eolivelli/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/eolivelli\">@eolivelli</a> and <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/cbornet/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/cbornet\">@cbornet</a></p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">modifiy method: <code class=\"notranslate\">public Pair&lt;String, String&gt; extractIdAndDocument(Record&lt;GenericObject&gt; record) throws JsonProcessingException</code> to handle cases where the <code class=\"notranslate\">Record</code> is <code class=\"notranslate\">String</code> or <code class=\"notranslate\">byte[]</code>.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20619",
                "createdAt": "2023-06-20T14:06:46Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][test] Fix flaky test SimpleProducerConsumerStatTest#testMsgRateExpired",
        "url": "https://github.com/apache/pulsar/pull/20629",
        "resourcePath": "/apache/pulsar/pull/20629",
        "createdAt": "2023-06-21T08:16:24Z",
        "number": 20629,
        "mergeCommit": {
          "oid": "95263829c1b5cdadb73222e4d5c8173c2b2930fe",
          "message": "[improve][test] Fix flaky test SimpleProducerConsumerStatTest#testMsgRateExpired (#20629)",
          "commitUrl": "https://github.com/apache/pulsar/commit/95263829c1b5cdadb73222e4d5c8173c2b2930fe",
          "parents": {
            "nodes": [
              {
                "oid": "2f0555ca0c0d5ad9ff46b07ebf92d1f96f66189d",
                "message": "[feat][broker]PIP-255 Part-2: Make the partition assignment strategy pluggable (#20537)\n\nCo-authored-by: Yunze Xu <xyzinfernity@163.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerStatTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ThIBp2gAoMDQyNjFjOGEwMTU2M2FkMmFlNWI2MjIwOWRhMDA1OWQ5M2I1YTUxYQ",
                "url": "https://github.com/apache/pulsar/pull/20629/commits/04261c8a01563ad2ae5b62209da0059d93b5a51a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20615,
                "url": "https://github.com/apache/pulsar/issues/20615",
                "title": "Flaky-test: SimpleProducerConsumerStatTest.testMsgRateExpired",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/5318677656/jobs/9630529043?pr=20609#step:10:785\">https://github.com/apache/pulsar/actions/runs/5318677656/jobs/9630529043?pr=20609#step:10:785</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  org.apache.pulsar.client.api.SimpleProducerConsumerStatTest.testMsgRateExpired  Time elapsed: 7.346 s  &lt;&lt;&lt; FAILURE!\n  org.awaitility.core.ConditionTimeoutException: Condition with org.apache.pulsar.client.api.SimpleProducerConsumerStatTest was not fulfilled within 5 seconds.\n  \tat org.awaitility.core.ConditionAwaiter.await(ConditionAwaiter.java:167)\n  \tat org.awaitility.core.CallableCondition.await(CallableCondition.java:78)\n  \tat org.awaitility.core.CallableCondition.await(CallableCondition.java:26)\n  \tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:985)\n  \tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:954)\n  \tat org.apache.pulsar.client.api.SimpleProducerConsumerStatTest.testMsgRateExpired(SimpleProducerConsumerStatTest.java:549)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  org.apache.pulsar.client.api.SimpleProducerConsumerStatTest.testMsgRateExpired  Time elapsed: 7.346 s  &lt;&lt;&lt; FAILURE!\n  org.awaitility.core.ConditionTimeoutException: Condition with org.apache.pulsar.client.api.SimpleProducerConsumerStatTest was not fulfilled within 5 seconds.\n  \tat org.awaitility.core.ConditionAwaiter.await(ConditionAwaiter.java:167)\n  \tat org.awaitility.core.CallableCondition.await(CallableCondition.java:78)\n  \tat org.awaitility.core.CallableCondition.await(CallableCondition.java:26)\n  \tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:985)\n  \tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:954)\n  \tat org.apache.pulsar.client.api.SimpleProducerConsumerStatTest.testMsgRateExpired(SimpleProducerConsumerStatTest.java:549)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20615",
                "createdAt": "2023-06-20T06:18:14Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix ExtensibleLoadManager flaky test",
        "url": "https://github.com/apache/pulsar/pull/20634",
        "resourcePath": "/apache/pulsar/pull/20634",
        "createdAt": "2023-06-23T14:20:28Z",
        "number": 20634,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/ExtensibleLoadManagerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/ExtensibleLoadManagerWrapper.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/LoadManagerShared.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/loadbalance/ExtensibleLoadManagerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5TwM3b2gAoMjIyNTc5N2RhYzVjYTRlYTE3N2Y0NTg3NzU0MGU4NWZjZDA5NjQzOQ",
                "url": "https://github.com/apache/pulsar/pull/20634/commits/2225797dac5ca4ea177f45877540e85fcd096439"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20618,
                "url": "https://github.com/apache/pulsar/issues/20618",
                "title": "Flaky-test: ExtensibleLoadManagerTest.testAntiaffinityPolicy is disabled because it blocked CI, it should be fixed",
                "bodyHTML": "<p dir=\"auto\"><a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/apache/pulsar/commit/e5606f28b89511e23c975b5266fc80168518a978/hovercard\" href=\"https://github.com/apache/pulsar/commit/e5606f28b89511e23c975b5266fc80168518a978\"><tt>e5606f2</tt></a> disabled ExtensibleLoadManagerTest.testAntiaffinityPolicy as part of the changes to unblock CI.<br>\nThis test should be fixed.</p>",
                "resourcePath": "/apache/pulsar/issues/20618",
                "createdAt": "2023-06-20T13:24:18Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][meta] Bookie Info lost by notification race condition.",
        "url": "https://github.com/apache/pulsar/pull/20642",
        "resourcePath": "/apache/pulsar/pull/20642",
        "createdAt": "2023-06-25T07:52:18Z",
        "number": 20642,
        "mergeCommit": {
          "oid": "43dc123e299ae1e879c9774a0e4bd972b7103a45",
          "message": "[fix][meta] Bookie Info lost by notification race condition. (#20642)",
          "commitUrl": "https://github.com/apache/pulsar/commit/43dc123e299ae1e879c9774a0e4bd972b7103a45",
          "parents": {
            "nodes": [
              {
                "oid": "cb5676eb17cc0c044b443bd04f3644d9dc611adb",
                "message": "[improve][doc] Update PIP TEMPLATE.md: Clarify images (#20684)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/main/java/org/apache/pulsar/metadata/bookkeeper/PulsarRegistrationClient.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-metadata/src/test/java/org/apache/pulsar/metadata/bookkeeper/FaultInjectableZKRegistrationManager.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/pulsar/metadata/bookkeeper/PulsarRegistrationClientTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5T1fSn2gAoNDBkMzI2YTdiMWUwMDY2Mzk0ODEyNmJiZmQyNmU1ZWYwNjdkOTI5Yg",
                "url": "https://github.com/apache/pulsar/pull/20642/commits/40d326a7b1e00663948126bbfd26e5ef067d929b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20643,
                "url": "https://github.com/apache/pulsar/issues/20643",
                "title": "[Bug] Bookie handle is not available for a long time.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Broker: 2.10+</p>\n<ul dir=\"auto\">\n<li>Bk Client uses PulsarRegistrationClient</li>\n<li>Bookie uses ZKRegistrationManager</li>\n</ul>\n<h3 dir=\"auto\">Description</h3>\n<p dir=\"auto\">The problem occurs when the bookie state changes from read-only to writable or vice versa.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&quot;Jun 16, 2023 @ 16:33:35.960&quot;,&quot;2023-06-16T16:33:35,959+0000 [main-EventThread] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Update BookieInfoCache (readonly bookie) main-bk-2:3181 -&gt; BookieServiceInfo{properties={}, endpoints=[EndpointInfo{id=httpserver, port=8000, host=0.0.0.0, protocol=http, auth=[], extensions=[]}, EndpointInfo{id=bookie, port=3181, host=main-bk-2, protocol=bookie-rpc, auth=[], extensions=[]}]}&quot;,&quot;main-broker-1&quot;\n&quot;Jun 16, 2023 @ 16:33:35.959&quot;,&quot;2023-06-16T16:33:35,959+0000 [main-EventThread] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Update BookieInfoCache (readonly bookie) main-bk-2:3181 -&gt; BookieServiceInfo{properties={}, endpoints=[EndpointInfo{id=httpserver, port=8000, host=0.0.0.0, protocol=http, auth=[], extensions=[]}, EndpointInfo{id=bookie, port=3181, host=main-bk-2, protocol=bookie-rpc, auth=[], extensions=[]}]}&quot;,&quot;main-broker-1&quot;\n&quot;Jun 16, 2023 @ 16:33:35.918&quot;,&quot;2023-06-16T16:33:35,918+0000 [main-EventThread] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Update BookieInfoCache (readonly bookie) main-bk-2:3181 -&gt; BookieServiceInfo{properties={}, endpoints=[EndpointInfo{id=httpserver, port=8000, host=0.0.0.0, protocol=http, auth=[], extensions=[]}, EndpointInfo{id=bookie, port=3181, host=main-bk-2, protocol=bookie-rpc, auth=[], extensions=[]}]}&quot;,&quot;main-broker-0&quot;\n&quot;Jun 16, 2023 @ 16:33:35.909&quot;,&quot;2023-06-16T16:33:35,909+0000 [metadata-store-10-1] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Bookie main-bk-2:3181 disappeared&quot;,&quot;main-broker-1&quot;\n&quot;Jun 16, 2023 @ 16:33:35.909&quot;,&quot;2023-06-16T16:33:35,909+0000 [metadata-store-10-1] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Bookie main-bk-2:3181 disappeared&quot;,&quot;main-broker-1&quot;\n&quot;Jun 16, 2023 @ 16:33:35.908&quot;,&quot;2023-06-16T16:33:35,908+0000 [metadata-store-10-1] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Bookie main-bk-2:3181 disappeared&quot;,&quot;main-broker-2&quot;\n&quot;Jun 16, 2023 @ 16:33:35.908&quot;,&quot;2023-06-16T16:33:35,908+0000 [metadata-store-10-1] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Bookie main-bk-2:3181 disappeared&quot;,&quot;main-broker-0&quot;\n&quot;Jun 16, 2023 @ 16:33:35.908&quot;,&quot;2023-06-16T16:33:35,908+0000 [metadata-store-10-1] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Bookie main-bk-2:3181 disappeared&quot;,&quot;main-broker-2&quot;\n&quot;Jun 16, 2023 @ 16:33:35.908&quot;,&quot;2023-06-16T16:33:35,908+0000 [metadata-store-10-1] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Bookie main-bk-2:3181 disappeared&quot;,&quot;main-broker-0&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">\"Jun 16, 2023 @ 16:33:35.960\",\"2023-06-16T16:33:35,959+0000 [main-EventThread] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Update BookieInfoCache (readonly bookie) main-bk-2:3181 -&gt; BookieServiceInfo{properties={}, endpoints=[EndpointInfo{id=httpserver, port=8000, host=0.0.0.0, protocol=http, auth=[], extensions=[]}, EndpointInfo{id=bookie, port=3181, host=main-bk-2, protocol=bookie-rpc, auth=[], extensions=[]}]}\",\"main-broker-1\"\n\"Jun 16, 2023 @ 16:33:35.959\",\"2023-06-16T16:33:35,959+0000 [main-EventThread] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Update BookieInfoCache (readonly bookie) main-bk-2:3181 -&gt; BookieServiceInfo{properties={}, endpoints=[EndpointInfo{id=httpserver, port=8000, host=0.0.0.0, protocol=http, auth=[], extensions=[]}, EndpointInfo{id=bookie, port=3181, host=main-bk-2, protocol=bookie-rpc, auth=[], extensions=[]}]}\",\"main-broker-1\"\n\"Jun 16, 2023 @ 16:33:35.918\",\"2023-06-16T16:33:35,918+0000 [main-EventThread] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Update BookieInfoCache (readonly bookie) main-bk-2:3181 -&gt; BookieServiceInfo{properties={}, endpoints=[EndpointInfo{id=httpserver, port=8000, host=0.0.0.0, protocol=http, auth=[], extensions=[]}, EndpointInfo{id=bookie, port=3181, host=main-bk-2, protocol=bookie-rpc, auth=[], extensions=[]}]}\",\"main-broker-0\"\n\"Jun 16, 2023 @ 16:33:35.909\",\"2023-06-16T16:33:35,909+0000 [metadata-store-10-1] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Bookie main-bk-2:3181 disappeared\",\"main-broker-1\"\n\"Jun 16, 2023 @ 16:33:35.909\",\"2023-06-16T16:33:35,909+0000 [metadata-store-10-1] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Bookie main-bk-2:3181 disappeared\",\"main-broker-1\"\n\"Jun 16, 2023 @ 16:33:35.908\",\"2023-06-16T16:33:35,908+0000 [metadata-store-10-1] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Bookie main-bk-2:3181 disappeared\",\"main-broker-2\"\n\"Jun 16, 2023 @ 16:33:35.908\",\"2023-06-16T16:33:35,908+0000 [metadata-store-10-1] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Bookie main-bk-2:3181 disappeared\",\"main-broker-0\"\n\"Jun 16, 2023 @ 16:33:35.908\",\"2023-06-16T16:33:35,908+0000 [metadata-store-10-1] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Bookie main-bk-2:3181 disappeared\",\"main-broker-2\"\n\"Jun 16, 2023 @ 16:33:35.908\",\"2023-06-16T16:33:35,908+0000 [metadata-store-10-1] INFO  org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient - Bookie main-bk-2:3181 disappeared\",\"main-broker-0\"\n</code></pre></div>\n<p dir=\"auto\">From the logs above, you can understand that some updates were lost in some broker's.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">No bookie information is missing.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Some bookie information has been missed.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20643",
                "createdAt": "2023-06-25T08:11:57Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][admin] Gracefully shutdown does not work with admin cli in standalone",
        "url": "https://github.com/apache/pulsar/pull/20651",
        "resourcePath": "/apache/pulsar/pull/20651",
        "createdAt": "2023-06-26T15:16:54Z",
        "number": 20651,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/extensions/filter/BrokerLoadManagerClassFilterTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/extensions/filter/BrokerMaxTopicCountFilterTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/extensions/filter/BrokerVersionFilterTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/extensions/scheduler/TransferShedderTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/AuthenticatedProducerConsumerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin-api/src/main/java/org/apache/pulsar/client/admin/Brokers.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/BrokersImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-sql/presto-distribution/LICENSE"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/loadbalance/ExtensibleLoadManagerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5T7x-T2gAoYTBhOGY0NzFhMzZjNjI0NzQ4NmQwZjgzZDUyMmM5NTE3OWExY2Q3YQ",
                "url": "https://github.com/apache/pulsar/pull/20651/commits/a0a8f471a36c6247486d0f83d522c95179a1cd7a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20617,
                "url": "https://github.com/apache/pulsar/issues/20617",
                "title": "[Bug] Gracefully shutdown not work with admin cli",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">3.0.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>start the pulsar standalone</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"PULSAR_STANDALONE_USE_ZOOKEEPER=1 ./bin/pulsar standalone\"><pre class=\"notranslate\"><code class=\"notranslate\">PULSAR_STANDALONE_USE_ZOOKEEPER=1 ./bin/pulsar standalone\n</code></pre></div>\n<ol start=\"2\" dir=\"auto\">\n<li>use admin cli to shutdown broker:</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ bin/pulsar-admin brokers shutdown\nSuccessfully trigger broker shutdown gracefully\"><pre class=\"notranslate\"><code class=\"notranslate\">$ bin/pulsar-admin brokers shutdown\nSuccessfully trigger broker shutdown gracefully\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">The broker should receive the request and start to shutdown.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The broker won't receive the request.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20617",
                "createdAt": "2023-06-20T10:56:52Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[feat][cli] Add command line option for configuring the memory limit",
        "url": "https://github.com/apache/pulsar/pull/20663",
        "resourcePath": "/apache/pulsar/pull/20663",
        "createdAt": "2023-06-27T16:21:37Z",
        "number": 20663,
        "mergeCommit": {
          "oid": "903e223596a7c6b3025ccacf4978812cc5e2004a",
          "message": "[feat][cli] Add command line option for configuring the memory limit (#20663)\n\nSigned-off-by: tison <wander4096@gmail.com>\r\nCo-authored-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/903e223596a7c6b3025ccacf4978812cc5e2004a",
          "parents": {
            "nodes": [
              {
                "oid": "c35524dae2d430d5ceb39b07e9124fac5d02648b",
                "message": "[fix][test] Fix flaky AdminApiMaxUnackedMessagesTest.testMaxUnackedMessagesPerConsumerPriority (#21335)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/main/java/org/apache/pulsar/testclient/LoadSimulationClient.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/main/java/org/apache/pulsar/testclient/PerfClientUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/main/java/org/apache/pulsar/testclient/PerformanceBaseArguments.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/main/java/org/apache/pulsar/testclient/PerformanceConsumer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/main/java/org/apache/pulsar/testclient/PerformanceProducer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/main/java/org/apache/pulsar/testclient/PerformanceReader.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/main/java/org/apache/pulsar/testclient/PerformanceTransaction.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/test/java/org/apache/pulsar/testclient/PerformanceBaseArgumentsTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "src/check-binary-license.sh"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5UDkDS2gAoZGM1ZWVkNDY0MzAzMDU2ODg2MjYzODAwZTMxYzIwODliOTdkY2ZkNA",
                "url": "https://github.com/apache/pulsar/pull/20663/commits/dc5eed464303056886263800e31c2089b97dcfd4"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 15912,
                "url": "https://github.com/apache/pulsar/issues/15912",
                "title": "[Cli tools] Add command line option for configuring the memory limit",
                "bodyHTML": "<p dir=\"auto\"><strong>Is your enhancement request related to a problem? Please describe.</strong><br>\nCli tools such as <code class=\"notranslate\">pulsar-perf</code> don't contain a way to configure the Pulsar client memory limit.</p>\n<p dir=\"auto\"><strong>Describe the solution you'd like</strong><br>\nCli tools should have a way to configure the Pulsar client memory limit.</p>\n<p dir=\"auto\"><strong>Additional context</strong><br>\nSee <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1246171358\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/15748\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/15748/hovercard?comment_id=1145013379&amp;comment_type=issue_comment\" href=\"https://github.com/apache/pulsar/pull/15748#issuecomment-1145013379\">#15748 (comment)</a></p>",
                "resourcePath": "/apache/pulsar/issues/15912",
                "createdAt": "2022-06-02T20:01:25Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "help wanted"
                      }
                    },
                    {
                      "node": {
                        "name": "area/cli"
                      }
                    },
                    {
                      "node": {
                        "name": "good first issue"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][test] Disable disk usage threshold & geoip download and enable logging for Elastic Testcontainers",
        "url": "https://github.com/apache/pulsar/pull/20671",
        "resourcePath": "/apache/pulsar/pull/20671",
        "createdAt": "2023-06-28T12:52:24Z",
        "number": 20671,
        "mergeCommit": {
          "oid": "e97fe5b8ac376ecead0097b184f0f1436fce88e4",
          "message": "[improve][test] Disable disk usage threshold & geoip download and enable logging for Elastic Testcontainers (#20671)",
          "commitUrl": "https://github.com/apache/pulsar/commit/e97fe5b8ac376ecead0097b184f0f1436fce88e4",
          "parents": {
            "nodes": [
              {
                "oid": "2b01f83ea4f3ab7b22f4ea2b0290cc183e79bbb8",
                "message": "[improve][broker] PIP-275:Introduce topicOrderedExecutorThreadNum to deprecate numWorkerThreadsForNonPersistentTopic (#20504)\n\nPIP: https://github.com/apache/pulsar/pull/20507\r\n\r\n<!-- Details of when a PIP is required and how the PIP process work, please see: https://github.com/apache/pulsar/blob/master/pip/README.md -->\r\n\r\n### Motivation\r\n\r\nSee https://github.com/apache/pulsar/pull/20507\r\n\r\n### Modifications\r\n\r\nIntroduce `topicOrderedExecutorThreadNum ` to deprecate `numWorkerThreadsForNonPersistentTopic`"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/elastic-search/src/test/java/org/apache/pulsar/io/elasticsearch/ElasticSearchTestBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/sinks/ElasticSearch7SinkTester.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/sinks/ElasticSearch8SinkTester.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/sinks/ElasticSearchSinkTester.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/io/sinks/OpenSearchSinkTester.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/topologies/PulsarCluster.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5UIzcr2gAoZDk1OWViNDkyOWQ0MTkyZmI1NmMxNDBhOGI1OTBlMGJhMjVkODY2Yg",
                "url": "https://github.com/apache/pulsar/pull/20671/commits/d959eb4929d4192fb56c140a8b590e0ba25d866b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20661,
                "url": "https://github.com/apache/pulsar/issues/20661",
                "title": "[Bug] Master branch is broken due to failing test testElasticSearch8Sink",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Run a Pr against master branch</p>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/5388118701/jobs/9782385675?pr=20654\">https://github.com/apache/pulsar/actions/runs/5388118701/jobs/9782385675?pr=20654</a></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">The tests are passing</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The test failed</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20661",
                "createdAt": "2023-06-27T12:09:04Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Remove timeout for `deleteTopicCloseTransactionBufferTest`",
        "url": "https://github.com/apache/pulsar/pull/20686",
        "resourcePath": "/apache/pulsar/pull/20686",
        "createdAt": "2023-06-29T12:36:56Z",
        "number": 20686,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/transaction/buffer/TransactionBufferCloseTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5UPM582gAoYTRjZGY1OTA4ZDMwMDNlYzM0ZGRiMjcwMTFkODA2NjNlY2FiOWQ1NQ",
                "url": "https://github.com/apache/pulsar/pull/20686/commits/a4cdf5908d3003ec34ddb27011d80663ecab9d55"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20673,
                "url": "https://github.com/apache/pulsar/issues/20673",
                "title": "Flaky-test: TransactionBufferCloseTest.deleteTopicCloseTransactionBufferTest",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/5401760645/jobs/9812478081?pr=20671#step:10:913\">https://github.com/apache/pulsar/actions/runs/5401760645/jobs/9812478081?pr=20671#step:10:913</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 14, Failures: 1, Errors: 0, Skipped: 13, Time elapsed: 52.953 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.transaction.buffer.TransactionBufferCloseTest\n  Error:  org.apache.pulsar.broker.transaction.buffer.TransactionBufferCloseTest.deleteTopicCloseTransactionBufferTest[true](3)  Time elapsed: 10.058 s  &lt;&lt;&lt; FAILURE!\n  org.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.broker.transaction.buffer.TransactionBufferCloseTest.deleteTopicCloseTransactionBufferTest() didn't finish within the time-out 10000\n  \tat java.base@17.0.7/jdk.internal.misc.Unsafe.park(Native Method)\n  \tat java.base@17.0.7/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:252)\n  \tat java.base@17.0.7/java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1866)\n  \tat java.base@17.0.7/java.util.concurrent.ForkJoinPool.unmanagedBlock(ForkJoinPool.java:3463)\n  \tat java.base@17.0.7/java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3434)\n  \tat java.base@17.0.7/java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1939)\n  \tat java.base@17.0.7/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2095)\n  \tat app//org.apache.pulsar.client.admin.internal.BaseResource.sync(BaseResource.java:342)\n  \tat app//org.apache.pulsar.client.admin.internal.TopicsImpl.deletePartitionedTopic(TopicsImpl.java:457)\n  \tat app//org.apache.pulsar.client.admin.Topics.deletePartitionedTopic(Topics.java:802)\n  \tat app//org.apache.pulsar.broker.transaction.buffer.TransactionBufferCloseTest.deleteTopic(TransactionBufferCloseTest.java:81)\n  \tat app//org.apache.pulsar.broker.transaction.buffer.TransactionBufferCloseTest.deleteTopicCloseTransactionBufferTest(TransactionBufferCloseTest.java:72)\n  \tat java.base@17.0.7/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base@17.0.7/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base@17.0.7/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base@17.0.7/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat app//org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base@17.0.7/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base@17.0.7/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base@17.0.7/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base@17.0.7/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 14, Failures: 1, Errors: 0, Skipped: 13, Time elapsed: 52.953 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.transaction.buffer.TransactionBufferCloseTest\n  Error:  org.apache.pulsar.broker.transaction.buffer.TransactionBufferCloseTest.deleteTopicCloseTransactionBufferTest[true](3)  Time elapsed: 10.058 s  &lt;&lt;&lt; FAILURE!\n  org.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.broker.transaction.buffer.TransactionBufferCloseTest.deleteTopicCloseTransactionBufferTest() didn't finish within the time-out 10000\n  \tat java.base@17.0.7/jdk.internal.misc.Unsafe.park(Native Method)\n  \tat java.base@17.0.7/java.util.concurrent.locks.LockSupport.parkNanos(LockSupport.java:252)\n  \tat java.base@17.0.7/java.util.concurrent.CompletableFuture$Signaller.block(CompletableFuture.java:1866)\n  \tat java.base@17.0.7/java.util.concurrent.ForkJoinPool.unmanagedBlock(ForkJoinPool.java:3463)\n  \tat java.base@17.0.7/java.util.concurrent.ForkJoinPool.managedBlock(ForkJoinPool.java:3434)\n  \tat java.base@17.0.7/java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1939)\n  \tat java.base@17.0.7/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2095)\n  \tat app//org.apache.pulsar.client.admin.internal.BaseResource.sync(BaseResource.java:342)\n  \tat app//org.apache.pulsar.client.admin.internal.TopicsImpl.deletePartitionedTopic(TopicsImpl.java:457)\n  \tat app//org.apache.pulsar.client.admin.Topics.deletePartitionedTopic(Topics.java:802)\n  \tat app//org.apache.pulsar.broker.transaction.buffer.TransactionBufferCloseTest.deleteTopic(TransactionBufferCloseTest.java:81)\n  \tat app//org.apache.pulsar.broker.transaction.buffer.TransactionBufferCloseTest.deleteTopicCloseTransactionBufferTest(TransactionBufferCloseTest.java:72)\n  \tat java.base@17.0.7/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base@17.0.7/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base@17.0.7/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base@17.0.7/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat app//org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base@17.0.7/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base@17.0.7/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base@17.0.7/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base@17.0.7/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20673",
                "createdAt": "2023-06-28T15:04:40Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][build] Do not bundle swagger dependencies",
        "url": "https://github.com/apache/pulsar/pull/20687",
        "resourcePath": "/apache/pulsar/pull/20687",
        "createdAt": "2023-06-29T13:58:14Z",
        "number": 20687,
        "mergeCommit": {
          "oid": "d718687f771049f90c1c9f2fd6997100d52abe00",
          "message": "[improve][build] Do not bundle swagger dependencies (#20687)\n\nSigned-off-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/d718687f771049f90c1c9f2fd6997100d52abe00",
          "parents": {
            "nodes": [
              {
                "oid": "e098ff1954d7cd7f9dfa1c7cfc18eaea81b45522",
                "message": "[fix][broker] Reformat property in generateResponseWithEntry (#20481)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "distribution/server/src/assemble/LICENSE.bin.txt"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "distribution/shell/src/assemble/LICENSE.bin.txt"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CliCommand.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdNamespaces.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-sql/presto-distribution/LICENSE"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarFunctionsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5UPrwn2gAoNzgwZGUxODRkMDg1ZDg5M2RkZTAxZWM0OGFhY2UxYzc4ZTE4NDIwNw",
                "url": "https://github.com/apache/pulsar/pull/20687/commits/780de184d085d893dde01ec48aace1c78e184207"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 11313,
                "url": "https://github.com/apache/pulsar/issues/11313",
                "title": "Swagger dependency scope is too broad",
                "bodyHTML": "<p dir=\"auto\"><strong>Is your enhancement request related to a problem? Please describe.</strong></p>\n<p dir=\"auto\">I'm using <code class=\"notranslate\">org.apache.pulsar:pulsar-broker</code> and <code class=\"notranslate\">org.apache.pulsar:pulsar-client-original</code> and I see that Swagger dependencies are \"leaked\" as transitive dependencies, because they are declared in the default compile Maven scope.<br>\nI'm currently using Swagger 2.X in the same project, and I don't like having two versions of the same library in the classpath, if possible.</p>\n<p dir=\"auto\">Are <code class=\"notranslate\">io.swagger:swagger-annotations</code> and <code class=\"notranslate\">io.swagger:swagger-core</code> actually required also at runtime?</p>\n<p dir=\"auto\"><strong>Describe the solution you'd like</strong></p>\n<p dir=\"auto\">I think those dependencies should be declared in the <code class=\"notranslate\">provided</code> scope like usual for annotation libraries.</p>\n<p dir=\"auto\"><strong>Describe alternatives you've considered</strong></p>\n<p dir=\"auto\">If there is no interest in handling this behavior, I'm also asking whether can I exclude the dependency from Maven when declaring the Pulsar dependency, or are you aware of problems about this workaround?</p>\n<p dir=\"auto\"><strong>Additional context</strong></p>\n<p dir=\"auto\">I'm currently using Pulsar 2.6.3, which brings in Swagger 1.5.21, but I'm planning to upgrade to the latest Pulsar version, which brings in Swagger 1.6.2, so this issue should apply also to newer versions.</p>",
                "resourcePath": "/apache/pulsar/issues/11313",
                "createdAt": "2021-07-14T07:51:38Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "lifecycle/stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Exit JVM when main thread throws exception",
        "url": "https://github.com/apache/pulsar/pull/20689",
        "resourcePath": "/apache/pulsar/pull/20689",
        "createdAt": "2023-06-29T20:03:17Z",
        "number": 20689,
        "mergeCommit": {
          "oid": "d83c7a6cc16dd374a976d7d535b5fcd325b5a812",
          "message": "[fix][fn] Exit JVM when main thread throws exception (#20689)\n\nFixes: https://github.com/apache/pulsar/issues/20688\r\n\r\n### Motivation\r\n\r\nWhen a function throws an exception that ends processing, we should exit the JVM.\r\n\r\n### Modifications\r\n\r\n* Update `JavaInstanceMain` so that an exception leads to exiting the JVM. Since the class does not use any dependencies (see the class's Javadoc), we use reflection to shutdown logging.\r\n\r\n### Verifying this change\r\n\r\nThis change is a trivial rework / code cleanup without any test coverage.\r\n\r\n### Documentation\r\n\r\n- [x] `doc-not-needed`",
          "commitUrl": "https://github.com/apache/pulsar/commit/d83c7a6cc16dd374a976d7d535b5fcd325b5a812",
          "parents": {
            "nodes": [
              {
                "oid": "8d5303514efa6cf0fa98c7285339a11821c7cf79",
                "message": "[cleanup][broker] Various cleanups (#20658)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime-all/src/main/java/org/apache/pulsar/functions/instance/JavaInstanceMain.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5URgyZ2gAoNDY3NWQ2NWM3ZTg3ZDM2NDFjNzhiZjliNmU0ODc2Y2VlMGYyNTc0YQ",
                "url": "https://github.com/apache/pulsar/pull/20689/commits/4675d65c7e87d3641c78bf9b6e4876cee0f2574a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20688,
                "url": "https://github.com/apache/pulsar/issues/20688",
                "title": "[Bug] Function becomes unresponse, does not exit on failure to unpack nar files",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">This happens on master right now, so 3.1.0-SNAPSHOT and all prior versions.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Start a function when there is not enough disk space to unpack all of the nar files</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I expected to see a crash looping pod (in k8s).</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">I found a function pod that was passing the health check but didn't fail in any way. Here is the relevant stack trace:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-06-28T19:09:24,586+0000 [main] INFO  org.apache.pulsar.functions.runtime.thread.ThreadRuntime - Trying Loading file as NAR file: /tmp/pulsar_functions/\n2023-06-28T19:09:24,587+0000 [main] INFO  org.apache.pulsar.common.nar.NarUnpacker - Created directory /tmp/pulsar-nar/pulsar_functions-unpacked\n2023-06-28T19:09:26,601+0000 [main] INFO  org.apache.pulsar.common.nar.NarUnpacker - Extracting /tmp/pulsar_functions to /tmp/pulsar-nar/pulsar_functions-unpacked/6g76nIrGE6SQEQ9SpwxtgQ\n2023-06-28T19:10:01,182+0000 [main] ERROR org.apache.pulsar.common.nar.NarUnpacker - There was a problem extracting the nar file. Deleting /tmp/pulsar-nar/pulsar_functions-unpacked/6g76nIrGE6SQEQ9SpwxtgQ to clean up state.\njava.io.IOException: No space left on device\n\tat java.io.FileOutputStream.writeBytes(Native Method) ~[?:?]\n\tat java.io.FileOutputStream.write(FileOutputStream.java:354) ~[?:?]\n\tat org.apache.pulsar.common.nar.NarUnpacker.makeFile(NarUnpacker.java:147) ~[com.datastax.oss-pulsar-common-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.common.nar.NarUnpacker.unpack(NarUnpacker.java:126) ~[com.datastax.oss-pulsar-common-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.common.nar.NarUnpacker.doUnpackNar(NarUnpacker.java:95) ~[com.datastax.oss-pulsar-common-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.common.nar.NarUnpacker.unpackNar(NarUnpacker.java:64) ~[com.datastax.oss-pulsar-common-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.common.nar.NarClassLoader.getFromArchive(NarClassLoader.java:147) ~[com.datastax.oss-pulsar-common-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.functions.utils.functioncache.FunctionCacheManagerImpl.registerFunctionInstanceWithArchive(FunctionCacheManagerImpl.java:129) ~[com.datastax.oss-pulsar-functions-utils-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntime.loadJars(ThreadRuntime.java:159) ~[com.datastax.oss-pulsar-functions-runtime-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntime.getFunctionClassLoader(ThreadRuntime.java:142) ~[com.datastax.oss-pulsar-functions-runtime-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntime.start(ThreadRuntime.java:199) ~[com.datastax.oss-pulsar-functions-runtime-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.functions.runtime.RuntimeSpawner.start(RuntimeSpawner.java:84) ~[com.datastax.oss-pulsar-functions-runtime-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.functions.runtime.JavaInstanceStarter.start(JavaInstanceStarter.java:251) ~[com.datastax.oss-pulsar-functions-runtime-2.10.3.4.jar:2.10.3.4]\n\tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n\tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:?]\n\tat jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n\tat java.lang.reflect.Method.invoke(Method.java:566) ~[?:?]\n\tat org.apache.pulsar.functions.instance.JavaInstanceMain.main(JavaInstanceMain.java:100) ~[java-instance.jar:?]\nException in thread &quot;main&quot; java.lang.reflect.InvocationTargetException\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\n\tat org.apache.pulsar.functions.instance.JavaInstanceMain.main(JavaInstanceMain.java:100)\nCaused by: java.io.IOException: No space left on device\n\tat java.base/java.io.FileOutputStream.writeBytes(Native Method)\n\tat java.base/java.io.FileOutputStream.write(FileOutputStream.java:354)\n\tat org.apache.pulsar.common.nar.NarUnpacker.makeFile(NarUnpacker.java:147)\n\tat org.apache.pulsar.common.nar.NarUnpacker.unpack(NarUnpacker.java:126)\n\tat org.apache.pulsar.common.nar.NarUnpacker.doUnpackNar(NarUnpacker.java:95)\n\tat org.apache.pulsar.common.nar.NarUnpacker.unpackNar(NarUnpacker.java:64)\n\tat org.apache.pulsar.common.nar.NarClassLoader.getFromArchive(NarClassLoader.java:147)\n\tat org.apache.pulsar.common.nar.NarClassLoaderBuilder.build(NarClassLoaderBuilder.java:72)\n\tat org.apache.pulsar.functions.utils.functioncache.FunctionCacheEntry.&lt;init&gt;(FunctionCacheEntry.java:78)\n\tat org.apache.pulsar.functions.utils.functioncache.FunctionCacheManagerImpl.registerFunctionInstanceWithArchive(FunctionCacheManagerImpl.java:129)\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntime.loadJars(ThreadRuntime.java:159)\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntime.getFunctionClassLoader(ThreadRuntime.java:142)\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntime.start(ThreadRuntime.java:199)\n\tat org.apache.pulsar.functions.runtime.RuntimeSpawner.start(RuntimeSpawner.java:84)\n\tat org.apache.pulsar.functions.runtime.JavaInstanceStarter.start(JavaInstanceStarter.java:251)\n\t... 5 more\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-06-28T19:09:24,586+0000 [main] INFO  org.apache.pulsar.functions.runtime.thread.ThreadRuntime - Trying Loading file as NAR file: /tmp/pulsar_functions/\n2023-06-28T19:09:24,587+0000 [main] INFO  org.apache.pulsar.common.nar.NarUnpacker - Created directory /tmp/pulsar-nar/pulsar_functions-unpacked\n2023-06-28T19:09:26,601+0000 [main] INFO  org.apache.pulsar.common.nar.NarUnpacker - Extracting /tmp/pulsar_functions to /tmp/pulsar-nar/pulsar_functions-unpacked/6g76nIrGE6SQEQ9SpwxtgQ\n2023-06-28T19:10:01,182+0000 [main] ERROR org.apache.pulsar.common.nar.NarUnpacker - There was a problem extracting the nar file. Deleting /tmp/pulsar-nar/pulsar_functions-unpacked/6g76nIrGE6SQEQ9SpwxtgQ to clean up state.\njava.io.IOException: No space left on device\n\tat java.io.FileOutputStream.writeBytes(Native Method) ~[?:?]\n\tat java.io.FileOutputStream.write(FileOutputStream.java:354) ~[?:?]\n\tat org.apache.pulsar.common.nar.NarUnpacker.makeFile(NarUnpacker.java:147) ~[com.datastax.oss-pulsar-common-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.common.nar.NarUnpacker.unpack(NarUnpacker.java:126) ~[com.datastax.oss-pulsar-common-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.common.nar.NarUnpacker.doUnpackNar(NarUnpacker.java:95) ~[com.datastax.oss-pulsar-common-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.common.nar.NarUnpacker.unpackNar(NarUnpacker.java:64) ~[com.datastax.oss-pulsar-common-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.common.nar.NarClassLoader.getFromArchive(NarClassLoader.java:147) ~[com.datastax.oss-pulsar-common-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.functions.utils.functioncache.FunctionCacheManagerImpl.registerFunctionInstanceWithArchive(FunctionCacheManagerImpl.java:129) ~[com.datastax.oss-pulsar-functions-utils-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntime.loadJars(ThreadRuntime.java:159) ~[com.datastax.oss-pulsar-functions-runtime-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntime.getFunctionClassLoader(ThreadRuntime.java:142) ~[com.datastax.oss-pulsar-functions-runtime-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntime.start(ThreadRuntime.java:199) ~[com.datastax.oss-pulsar-functions-runtime-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.functions.runtime.RuntimeSpawner.start(RuntimeSpawner.java:84) ~[com.datastax.oss-pulsar-functions-runtime-2.10.3.4.jar:2.10.3.4]\n\tat org.apache.pulsar.functions.runtime.JavaInstanceStarter.start(JavaInstanceStarter.java:251) ~[com.datastax.oss-pulsar-functions-runtime-2.10.3.4.jar:2.10.3.4]\n\tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n\tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62) ~[?:?]\n\tat jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n\tat java.lang.reflect.Method.invoke(Method.java:566) ~[?:?]\n\tat org.apache.pulsar.functions.instance.JavaInstanceMain.main(JavaInstanceMain.java:100) ~[java-instance.jar:?]\nException in thread \"main\" java.lang.reflect.InvocationTargetException\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:62)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:566)\n\tat org.apache.pulsar.functions.instance.JavaInstanceMain.main(JavaInstanceMain.java:100)\nCaused by: java.io.IOException: No space left on device\n\tat java.base/java.io.FileOutputStream.writeBytes(Native Method)\n\tat java.base/java.io.FileOutputStream.write(FileOutputStream.java:354)\n\tat org.apache.pulsar.common.nar.NarUnpacker.makeFile(NarUnpacker.java:147)\n\tat org.apache.pulsar.common.nar.NarUnpacker.unpack(NarUnpacker.java:126)\n\tat org.apache.pulsar.common.nar.NarUnpacker.doUnpackNar(NarUnpacker.java:95)\n\tat org.apache.pulsar.common.nar.NarUnpacker.unpackNar(NarUnpacker.java:64)\n\tat org.apache.pulsar.common.nar.NarClassLoader.getFromArchive(NarClassLoader.java:147)\n\tat org.apache.pulsar.common.nar.NarClassLoaderBuilder.build(NarClassLoaderBuilder.java:72)\n\tat org.apache.pulsar.functions.utils.functioncache.FunctionCacheEntry.&lt;init&gt;(FunctionCacheEntry.java:78)\n\tat org.apache.pulsar.functions.utils.functioncache.FunctionCacheManagerImpl.registerFunctionInstanceWithArchive(FunctionCacheManagerImpl.java:129)\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntime.loadJars(ThreadRuntime.java:159)\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntime.getFunctionClassLoader(ThreadRuntime.java:142)\n\tat org.apache.pulsar.functions.runtime.thread.ThreadRuntime.start(ThreadRuntime.java:199)\n\tat org.apache.pulsar.functions.runtime.RuntimeSpawner.start(RuntimeSpawner.java:84)\n\tat org.apache.pulsar.functions.runtime.JavaInstanceStarter.start(JavaInstanceStarter.java:251)\n\t... 5 more\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">There are two solutions:</p>\n<ol dir=\"auto\">\n<li>Make the health check better so that it fails if \"nothing\" is happening.</li>\n<li>Exit on certain errors.</li>\n</ol>\n<p dir=\"auto\">While a better health check could be valuable, I think an exception in the main thread is a pretty good reason to exit the JVM.</p>\n<p dir=\"auto\">Note that there are several issues where we have seen this kind of problem before: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1634921102\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19885\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/19885/hovercard\" href=\"https://github.com/apache/pulsar/issues/19885\">#19885</a>, <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"948159746\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/11379\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/11379/hovercard\" href=\"https://github.com/apache/pulsar/issues/11379\">#11379</a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20688",
                "createdAt": "2023-06-29T19:59:25Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][cli] Dedicated docs tools",
        "url": "https://github.com/apache/pulsar/pull/20700",
        "resourcePath": "/apache/pulsar/pull/20700",
        "createdAt": "2023-07-01T04:20:21Z",
        "number": 20700,
        "mergeCommit": {
          "oid": "db79096baaa3d7118aa026978a615ddc576f9183",
          "message": "[fix][cli] Dedicated docs tools (#20700)\n\nSigned-off-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/db79096baaa3d7118aa026978a615ddc576f9183",
          "parents": {
            "nodes": [
              {
                "oid": "e231ee9cb998469a2999d23b7c198e8a7aa331c0",
                "message": "[improve][broker] Improve CompactedTopicImpl lock (#20697)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/FunctionWorkerStarter.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyServiceStarter.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/stats/ProxyStats.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/util/CmdGenerateDocumentation.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/util/package-info.java"
              }
            },
            {
              "node": {
                "changeType": "RENAMED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/util/CmdGenerateDocumentationTest.java"
              }
            },
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/util/CmdTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/main/java/org/apache/pulsar/websocket/service/WebSocketServiceStarter.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5UYd5d2gAoMTU3NzQzNjNmNmQ1ZDEyYTI2ZmRhODBjMTk1ZDQ3YWRlNzQ5M2VmZQ",
                "url": "https://github.com/apache/pulsar/pull/20700/commits/15774363f6d5d12a26fda80c195d47ade7493efe"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 18932,
                "url": "https://github.com/apache/pulsar/issues/18932",
                "title": "[Client] Drop jcommander dependency in Pulsar java client",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Pulsar add the <code class=\"notranslate\">jcommander</code> as dependency in <code class=\"notranslate\">pulsar-common</code> module, but it should be an optional dependency because most people don't need it in client side.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Make the <code class=\"notranslate\">jcommander</code> in <code class=\"notranslate\">pulsar-common</code> with <code class=\"notranslate\">&lt;optional&gt;true&lt;/optional&gt;</code>.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/18932",
                "createdAt": "2022-12-14T15:02:49Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "help wanted"
                      }
                    },
                    {
                      "node": {
                        "name": "area/cli"
                      }
                    },
                    {
                      "node": {
                        "name": "good first issue"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][misc] Stop logging full stacktrace when `SecurityUtility.loadConscryptProvider()` fails to find Conscrypt with unknown error",
        "url": "https://github.com/apache/pulsar/pull/20705",
        "resourcePath": "/apache/pulsar/pull/20705",
        "createdAt": "2023-07-02T14:42:03Z",
        "number": 20705,
        "mergeCommit": {
          "oid": "4d13bdbe510cefc73a187ff587883f91c50d52f0",
          "message": "[fix][misc] Stop logging full stacktrace when `SecurityUtility.loadConscryptProvider()` fails to find Conscrypt with unknown error (#20705)",
          "commitUrl": "https://github.com/apache/pulsar/commit/4d13bdbe510cefc73a187ff587883f91c50d52f0",
          "parents": {
            "nodes": [
              {
                "oid": "db79096baaa3d7118aa026978a615ddc576f9183",
                "message": "[fix][cli] Dedicated docs tools (#20700)\n\nSigned-off-by: tison <wander4096@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/SecurityUtility.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Uchbv2gAoNzI0OWZlOWI2NDQxMmY5NjI5NTJmNjUwMTFhMjUzNjE2YzBiYmI1NA",
                "url": "https://github.com/apache/pulsar/pull/20705/commits/7249fe9b64412f962952f65011a253616c0bbb54"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20702,
                "url": "https://github.com/apache/pulsar/issues/20702",
                "title": "[Bug] pulsar-shell throws massive conscrypt stacktrace for every command when TLS is enabled on arm64",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">I was pleased to find arm64 builds for pulsar 3.0.0, however every administrative tool command leads to a massive stack trace warning about conscrypt being missing that precedes the results of every command, completely munges the output and fills the screen with useless stack-trace information.</p>\n<p dir=\"auto\">I get the warning, it's making sure the user knows about the fallback, but does it really need to dump the stack every time? Even if the root cause (Conscrypt dependency is broken or architecture-dependent) isn't fixable in the short term, there should be a way to squash this output, since it makes <code class=\"notranslate\">pulsar-admin</code> and <code class=\"notranslate\">pulshar-shell</code> <em>extremely</em> unpleasant to use.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ul dir=\"auto\">\n<li>Download and install pulsar-shell on arm64.</li>\n<li>Set it up for your cluster with TLS enabled</li>\n<li>Try to use it at all for anything.</li>\n</ul>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"tlsclient(pulsar.my.cluster)&gt; admin topics list public/default\npersistent://public/default/topic1\npersistent://public/default/topic2\ntlsclient(pulsar.my.cluster)&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">tlsclient(pulsar.my.cluster)&gt; admin topics list public/default\npersistent://public/default/topic1\npersistent://public/default/topic2\ntlsclient(pulsar.my.cluster)&gt;\n</code></pre></div>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"tlsclient(pulsar.my.cluster)&gt; admin topics list public/default\n2023-07-02T00:45:57,946-0400 [main] WARN  org.apache.pulsar.common.util.SecurityUtility - Conscrypt isn't available. Using JDK default security provider.\njava.lang.reflect.InvocationTargetException: null\n        at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n        at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n        at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n        at org.apache.pulsar.common.util.SecurityUtility.loadConscryptProvider(SecurityUtility.java:125) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.common.util.SecurityUtility.&lt;clinit&gt;(SecurityUtility.java:81) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.&lt;init&gt;(AsyncHttpConnector.java:163) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnectorProvider.getConnector(AsyncHttpConnectorProvider.java:52) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.client.admin.internal.PulsarAdminImpl.&lt;init&gt;(PulsarAdminImpl.java:199) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.client.admin.internal.PulsarAdminBuilderImpl.build(PulsarAdminBuilderImpl.java:49) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:69) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:29) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.CmdBase.getAdmin(CmdBase.java:112) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.CmdTopics.getTopics(CmdTopics.java:2876) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.CmdTopics.access$12200(CmdTopics.java:91) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.CmdTopics$ListCmd.run(CmdTopics.java:395) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:87) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:257) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.shell.AdminShell.runCommand(AdminShell.java:72) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:455) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:237) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.shell.PulsarShell.main(PulsarShell.java:215) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\nCaused by: java.lang.UnsatisfiedLinkError: no conscrypt_openjdk_jni-osx-aarch_64 in java.library.path: /Users/awalker/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.\n        at java.lang.ClassLoader.loadLibrary(ClassLoader.java:2429) ~[?:?]\n        at java.lang.Runtime.loadLibrary0(Runtime.java:818) ~[?:?]\n        at java.lang.System.loadLibrary(System.java:1989) ~[?:?]\n        at org.conscrypt.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:54) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n        at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n        at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n        at org.conscrypt.NativeLibraryLoader$1.run(NativeLibraryLoader.java:297) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at org.conscrypt.NativeLibraryLoader$1.run(NativeLibraryLoader.java:289) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at java.security.AccessController.doPrivileged(AccessController.java:318) ~[?:?]\n        at org.conscrypt.NativeLibraryLoader.loadLibraryFromHelperClassloader(NativeLibraryLoader.java:289) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at org.conscrypt.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:262) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at org.conscrypt.NativeLibraryLoader.load(NativeLibraryLoader.java:162) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at org.conscrypt.NativeLibraryLoader.loadFirstAvailable(NativeLibraryLoader.java:106) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at org.conscrypt.NativeCryptoJni.init(NativeCryptoJni.java:50) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at org.conscrypt.NativeCrypto.&lt;clinit&gt;(NativeCrypto.java:64) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at org.conscrypt.Conscrypt.checkAvailability(Conscrypt.java:119) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        ... 22 more\n        Suppressed: java.lang.UnsatisfiedLinkError: no conscrypt_openjdk_jni-osx-aarch_64 in java.library.path: /Users/awalker/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.\n                at java.lang.ClassLoader.loadLibrary(ClassLoader.java:2429) ~[?:?]\n                at java.lang.Runtime.loadLibrary0(Runtime.java:818) ~[?:?]\n                at java.lang.System.loadLibrary(System.java:1989) ~[?:?]\n                at org.conscrypt.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:54) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibraryFromCurrentClassloader(NativeLibraryLoader.java:318) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:273) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.load(NativeLibraryLoader.java:162) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadFirstAvailable(NativeLibraryLoader.java:106) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCryptoJni.init(NativeCryptoJni.java:50) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCrypto.&lt;clinit&gt;(NativeCrypto.java:64) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.Conscrypt.checkAvailability(Conscrypt.java:119) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n                at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n                at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n                at org.apache.pulsar.common.util.SecurityUtility.loadConscryptProvider(SecurityUtility.java:125) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.common.util.SecurityUtility.&lt;clinit&gt;(SecurityUtility.java:81) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.&lt;init&gt;(AsyncHttpConnector.java:163) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnectorProvider.getConnector(AsyncHttpConnectorProvider.java:52) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminImpl.&lt;init&gt;(PulsarAdminImpl.java:199) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminBuilderImpl.build(PulsarAdminBuilderImpl.java:49) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:69) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:29) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.getAdmin(CmdBase.java:112) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.getTopics(CmdTopics.java:2876) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.access$12200(CmdTopics.java:91) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics$ListCmd.run(CmdTopics.java:395) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:87) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:257) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.AdminShell.runCommand(AdminShell.java:72) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:455) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:237) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.main(PulsarShell.java:215) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        Suppressed: java.lang.UnsatisfiedLinkError: no conscrypt_openjdk_jni in java.library.path: /Users/awalker/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.\n                at java.lang.ClassLoader.loadLibrary(ClassLoader.java:2429) ~[?:?]\n                at java.lang.Runtime.loadLibrary0(Runtime.java:818) ~[?:?]\n                at java.lang.System.loadLibrary(System.java:1989) ~[?:?]\n                at org.conscrypt.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:54) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n                at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n                at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n                at org.conscrypt.NativeLibraryLoader$1.run(NativeLibraryLoader.java:297) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader$1.run(NativeLibraryLoader.java:289) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at java.security.AccessController.doPrivileged(AccessController.java:318) ~[?:?]\n                at org.conscrypt.NativeLibraryLoader.loadLibraryFromHelperClassloader(NativeLibraryLoader.java:289) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:262) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.load(NativeLibraryLoader.java:162) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadFirstAvailable(NativeLibraryLoader.java:106) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCryptoJni.init(NativeCryptoJni.java:50) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCrypto.&lt;clinit&gt;(NativeCrypto.java:64) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.Conscrypt.checkAvailability(Conscrypt.java:119) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n                at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n                at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n                at org.apache.pulsar.common.util.SecurityUtility.loadConscryptProvider(SecurityUtility.java:125) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.common.util.SecurityUtility.&lt;clinit&gt;(SecurityUtility.java:81) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.&lt;init&gt;(AsyncHttpConnector.java:163) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnectorProvider.getConnector(AsyncHttpConnectorProvider.java:52) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminImpl.&lt;init&gt;(PulsarAdminImpl.java:199) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminBuilderImpl.build(PulsarAdminBuilderImpl.java:49) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:69) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:29) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.getAdmin(CmdBase.java:112) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.getTopics(CmdTopics.java:2876) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.access$12200(CmdTopics.java:91) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics$ListCmd.run(CmdTopics.java:395) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:87) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:257) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.AdminShell.runCommand(AdminShell.java:72) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:455) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:237) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.main(PulsarShell.java:215) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        Suppressed: java.lang.UnsatisfiedLinkError: no conscrypt_openjdk_jni in java.library.path: /Users/awalker/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.\n                at java.lang.ClassLoader.loadLibrary(ClassLoader.java:2429) ~[?:?]\n                at java.lang.Runtime.loadLibrary0(Runtime.java:818) ~[?:?]\n                at java.lang.System.loadLibrary(System.java:1989) ~[?:?]\n                at org.conscrypt.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:54) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibraryFromCurrentClassloader(NativeLibraryLoader.java:318) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:273) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.load(NativeLibraryLoader.java:162) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadFirstAvailable(NativeLibraryLoader.java:106) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCryptoJni.init(NativeCryptoJni.java:50) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCrypto.&lt;clinit&gt;(NativeCrypto.java:64) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.Conscrypt.checkAvailability(Conscrypt.java:119) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n                at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n                at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n                at org.apache.pulsar.common.util.SecurityUtility.loadConscryptProvider(SecurityUtility.java:125) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.common.util.SecurityUtility.&lt;clinit&gt;(SecurityUtility.java:81) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.&lt;init&gt;(AsyncHttpConnector.java:163) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnectorProvider.getConnector(AsyncHttpConnectorProvider.java:52) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminImpl.&lt;init&gt;(PulsarAdminImpl.java:199) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminBuilderImpl.build(PulsarAdminBuilderImpl.java:49) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:69) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:29) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.getAdmin(CmdBase.java:112) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.getTopics(CmdTopics.java:2876) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.access$12200(CmdTopics.java:91) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics$ListCmd.run(CmdTopics.java:395) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:87) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:257) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.AdminShell.runCommand(AdminShell.java:72) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:455) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:237) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.main(PulsarShell.java:215) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        Suppressed: java.lang.UnsatisfiedLinkError: no conscrypt in java.library.path: /Users/awalker/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.\n                at java.lang.ClassLoader.loadLibrary(ClassLoader.java:2429) ~[?:?]\n                at java.lang.Runtime.loadLibrary0(Runtime.java:818) ~[?:?]\n                at java.lang.System.loadLibrary(System.java:1989) ~[?:?]\n                at org.conscrypt.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:54) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n                at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n                at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n                at org.conscrypt.NativeLibraryLoader$1.run(NativeLibraryLoader.java:297) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader$1.run(NativeLibraryLoader.java:289) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at java.security.AccessController.doPrivileged(AccessController.java:318) ~[?:?]\n                at org.conscrypt.NativeLibraryLoader.loadLibraryFromHelperClassloader(NativeLibraryLoader.java:289) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:262) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.load(NativeLibraryLoader.java:162) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadFirstAvailable(NativeLibraryLoader.java:106) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCryptoJni.init(NativeCryptoJni.java:50) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCrypto.&lt;clinit&gt;(NativeCrypto.java:64) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.Conscrypt.checkAvailability(Conscrypt.java:119) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n                at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n                at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n                at org.apache.pulsar.common.util.SecurityUtility.loadConscryptProvider(SecurityUtility.java:125) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.common.util.SecurityUtility.&lt;clinit&gt;(SecurityUtility.java:81) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.&lt;init&gt;(AsyncHttpConnector.java:163) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnectorProvider.getConnector(AsyncHttpConnectorProvider.java:52) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminImpl.&lt;init&gt;(PulsarAdminImpl.java:199) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminBuilderImpl.build(PulsarAdminBuilderImpl.java:49) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:69) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:29) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.getAdmin(CmdBase.java:112) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.getTopics(CmdTopics.java:2876) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.access$12200(CmdTopics.java:91) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics$ListCmd.run(CmdTopics.java:395) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:87) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:257) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.AdminShell.runCommand(AdminShell.java:72) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:455) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:237) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.main(PulsarShell.java:215) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        Suppressed: java.lang.UnsatisfiedLinkError: no conscrypt in java.library.path: /Users/awalker/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.\n                at java.lang.ClassLoader.loadLibrary(ClassLoader.java:2429) ~[?:?]\n                at java.lang.Runtime.loadLibrary0(Runtime.java:818) ~[?:?]\n                at java.lang.System.loadLibrary(System.java:1989) ~[?:?]\n                at org.conscrypt.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:54) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibraryFromCurrentClassloader(NativeLibraryLoader.java:318) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:273) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.load(NativeLibraryLoader.java:162) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadFirstAvailable(NativeLibraryLoader.java:106) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCryptoJni.init(NativeCryptoJni.java:50) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCrypto.&lt;clinit&gt;(NativeCrypto.java:64) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.Conscrypt.checkAvailability(Conscrypt.java:119) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n                at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n                at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n                at org.apache.pulsar.common.util.SecurityUtility.loadConscryptProvider(SecurityUtility.java:125) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.common.util.SecurityUtility.&lt;clinit&gt;(SecurityUtility.java:81) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.&lt;init&gt;(AsyncHttpConnector.java:163) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnectorProvider.getConnector(AsyncHttpConnectorProvider.java:52) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminImpl.&lt;init&gt;(PulsarAdminImpl.java:199) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminBuilderImpl.build(PulsarAdminBuilderImpl.java:49) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:69) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:29) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.getAdmin(CmdBase.java:112) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.getTopics(CmdTopics.java:2876) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.access$12200(CmdTopics.java:91) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics$ListCmd.run(CmdTopics.java:395) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:87) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:257) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.AdminShell.runCommand(AdminShell.java:72) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:455) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:237) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.main(PulsarShell.java:215) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\npersistent://public/default/topic1\npersistent://public/default/topic2\ntlsclient(pulsar.my.cluster)&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">tlsclient(pulsar.my.cluster)&gt; admin topics list public/default\n2023-07-02T00:45:57,946-0400 [main] WARN  org.apache.pulsar.common.util.SecurityUtility - Conscrypt isn't available. Using JDK default security provider.\njava.lang.reflect.InvocationTargetException: null\n        at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n        at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n        at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n        at org.apache.pulsar.common.util.SecurityUtility.loadConscryptProvider(SecurityUtility.java:125) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.common.util.SecurityUtility.&lt;clinit&gt;(SecurityUtility.java:81) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.&lt;init&gt;(AsyncHttpConnector.java:163) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnectorProvider.getConnector(AsyncHttpConnectorProvider.java:52) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.client.admin.internal.PulsarAdminImpl.&lt;init&gt;(PulsarAdminImpl.java:199) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.client.admin.internal.PulsarAdminBuilderImpl.build(PulsarAdminBuilderImpl.java:49) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:69) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:29) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.CmdBase.getAdmin(CmdBase.java:112) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.CmdTopics.getTopics(CmdTopics.java:2876) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.CmdTopics.access$12200(CmdTopics.java:91) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.CmdTopics$ListCmd.run(CmdTopics.java:395) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:87) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:257) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.shell.AdminShell.runCommand(AdminShell.java:72) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:455) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:237) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        at org.apache.pulsar.shell.PulsarShell.main(PulsarShell.java:215) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\nCaused by: java.lang.UnsatisfiedLinkError: no conscrypt_openjdk_jni-osx-aarch_64 in java.library.path: /Users/awalker/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.\n        at java.lang.ClassLoader.loadLibrary(ClassLoader.java:2429) ~[?:?]\n        at java.lang.Runtime.loadLibrary0(Runtime.java:818) ~[?:?]\n        at java.lang.System.loadLibrary(System.java:1989) ~[?:?]\n        at org.conscrypt.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:54) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n        at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n        at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n        at org.conscrypt.NativeLibraryLoader$1.run(NativeLibraryLoader.java:297) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at org.conscrypt.NativeLibraryLoader$1.run(NativeLibraryLoader.java:289) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at java.security.AccessController.doPrivileged(AccessController.java:318) ~[?:?]\n        at org.conscrypt.NativeLibraryLoader.loadLibraryFromHelperClassloader(NativeLibraryLoader.java:289) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at org.conscrypt.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:262) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at org.conscrypt.NativeLibraryLoader.load(NativeLibraryLoader.java:162) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at org.conscrypt.NativeLibraryLoader.loadFirstAvailable(NativeLibraryLoader.java:106) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at org.conscrypt.NativeCryptoJni.init(NativeCryptoJni.java:50) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at org.conscrypt.NativeCrypto.&lt;clinit&gt;(NativeCrypto.java:64) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        at org.conscrypt.Conscrypt.checkAvailability(Conscrypt.java:119) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n        ... 22 more\n        Suppressed: java.lang.UnsatisfiedLinkError: no conscrypt_openjdk_jni-osx-aarch_64 in java.library.path: /Users/awalker/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.\n                at java.lang.ClassLoader.loadLibrary(ClassLoader.java:2429) ~[?:?]\n                at java.lang.Runtime.loadLibrary0(Runtime.java:818) ~[?:?]\n                at java.lang.System.loadLibrary(System.java:1989) ~[?:?]\n                at org.conscrypt.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:54) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibraryFromCurrentClassloader(NativeLibraryLoader.java:318) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:273) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.load(NativeLibraryLoader.java:162) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadFirstAvailable(NativeLibraryLoader.java:106) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCryptoJni.init(NativeCryptoJni.java:50) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCrypto.&lt;clinit&gt;(NativeCrypto.java:64) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.Conscrypt.checkAvailability(Conscrypt.java:119) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n                at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n                at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n                at org.apache.pulsar.common.util.SecurityUtility.loadConscryptProvider(SecurityUtility.java:125) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.common.util.SecurityUtility.&lt;clinit&gt;(SecurityUtility.java:81) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.&lt;init&gt;(AsyncHttpConnector.java:163) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnectorProvider.getConnector(AsyncHttpConnectorProvider.java:52) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminImpl.&lt;init&gt;(PulsarAdminImpl.java:199) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminBuilderImpl.build(PulsarAdminBuilderImpl.java:49) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:69) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:29) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.getAdmin(CmdBase.java:112) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.getTopics(CmdTopics.java:2876) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.access$12200(CmdTopics.java:91) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics$ListCmd.run(CmdTopics.java:395) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:87) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:257) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.AdminShell.runCommand(AdminShell.java:72) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:455) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:237) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.main(PulsarShell.java:215) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        Suppressed: java.lang.UnsatisfiedLinkError: no conscrypt_openjdk_jni in java.library.path: /Users/awalker/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.\n                at java.lang.ClassLoader.loadLibrary(ClassLoader.java:2429) ~[?:?]\n                at java.lang.Runtime.loadLibrary0(Runtime.java:818) ~[?:?]\n                at java.lang.System.loadLibrary(System.java:1989) ~[?:?]\n                at org.conscrypt.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:54) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n                at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n                at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n                at org.conscrypt.NativeLibraryLoader$1.run(NativeLibraryLoader.java:297) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader$1.run(NativeLibraryLoader.java:289) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at java.security.AccessController.doPrivileged(AccessController.java:318) ~[?:?]\n                at org.conscrypt.NativeLibraryLoader.loadLibraryFromHelperClassloader(NativeLibraryLoader.java:289) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:262) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.load(NativeLibraryLoader.java:162) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadFirstAvailable(NativeLibraryLoader.java:106) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCryptoJni.init(NativeCryptoJni.java:50) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCrypto.&lt;clinit&gt;(NativeCrypto.java:64) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.Conscrypt.checkAvailability(Conscrypt.java:119) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n                at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n                at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n                at org.apache.pulsar.common.util.SecurityUtility.loadConscryptProvider(SecurityUtility.java:125) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.common.util.SecurityUtility.&lt;clinit&gt;(SecurityUtility.java:81) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.&lt;init&gt;(AsyncHttpConnector.java:163) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnectorProvider.getConnector(AsyncHttpConnectorProvider.java:52) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminImpl.&lt;init&gt;(PulsarAdminImpl.java:199) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminBuilderImpl.build(PulsarAdminBuilderImpl.java:49) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:69) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:29) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.getAdmin(CmdBase.java:112) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.getTopics(CmdTopics.java:2876) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.access$12200(CmdTopics.java:91) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics$ListCmd.run(CmdTopics.java:395) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:87) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:257) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.AdminShell.runCommand(AdminShell.java:72) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:455) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:237) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.main(PulsarShell.java:215) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        Suppressed: java.lang.UnsatisfiedLinkError: no conscrypt_openjdk_jni in java.library.path: /Users/awalker/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.\n                at java.lang.ClassLoader.loadLibrary(ClassLoader.java:2429) ~[?:?]\n                at java.lang.Runtime.loadLibrary0(Runtime.java:818) ~[?:?]\n                at java.lang.System.loadLibrary(System.java:1989) ~[?:?]\n                at org.conscrypt.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:54) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibraryFromCurrentClassloader(NativeLibraryLoader.java:318) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:273) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.load(NativeLibraryLoader.java:162) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadFirstAvailable(NativeLibraryLoader.java:106) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCryptoJni.init(NativeCryptoJni.java:50) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCrypto.&lt;clinit&gt;(NativeCrypto.java:64) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.Conscrypt.checkAvailability(Conscrypt.java:119) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n                at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n                at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n                at org.apache.pulsar.common.util.SecurityUtility.loadConscryptProvider(SecurityUtility.java:125) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.common.util.SecurityUtility.&lt;clinit&gt;(SecurityUtility.java:81) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.&lt;init&gt;(AsyncHttpConnector.java:163) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnectorProvider.getConnector(AsyncHttpConnectorProvider.java:52) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminImpl.&lt;init&gt;(PulsarAdminImpl.java:199) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminBuilderImpl.build(PulsarAdminBuilderImpl.java:49) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:69) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:29) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.getAdmin(CmdBase.java:112) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.getTopics(CmdTopics.java:2876) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.access$12200(CmdTopics.java:91) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics$ListCmd.run(CmdTopics.java:395) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:87) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:257) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.AdminShell.runCommand(AdminShell.java:72) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:455) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:237) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.main(PulsarShell.java:215) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        Suppressed: java.lang.UnsatisfiedLinkError: no conscrypt in java.library.path: /Users/awalker/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.\n                at java.lang.ClassLoader.loadLibrary(ClassLoader.java:2429) ~[?:?]\n                at java.lang.Runtime.loadLibrary0(Runtime.java:818) ~[?:?]\n                at java.lang.System.loadLibrary(System.java:1989) ~[?:?]\n                at org.conscrypt.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:54) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n                at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n                at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n                at org.conscrypt.NativeLibraryLoader$1.run(NativeLibraryLoader.java:297) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader$1.run(NativeLibraryLoader.java:289) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at java.security.AccessController.doPrivileged(AccessController.java:318) ~[?:?]\n                at org.conscrypt.NativeLibraryLoader.loadLibraryFromHelperClassloader(NativeLibraryLoader.java:289) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:262) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.load(NativeLibraryLoader.java:162) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadFirstAvailable(NativeLibraryLoader.java:106) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCryptoJni.init(NativeCryptoJni.java:50) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCrypto.&lt;clinit&gt;(NativeCrypto.java:64) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.Conscrypt.checkAvailability(Conscrypt.java:119) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n                at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n                at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n                at org.apache.pulsar.common.util.SecurityUtility.loadConscryptProvider(SecurityUtility.java:125) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.common.util.SecurityUtility.&lt;clinit&gt;(SecurityUtility.java:81) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.&lt;init&gt;(AsyncHttpConnector.java:163) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnectorProvider.getConnector(AsyncHttpConnectorProvider.java:52) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminImpl.&lt;init&gt;(PulsarAdminImpl.java:199) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminBuilderImpl.build(PulsarAdminBuilderImpl.java:49) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:69) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:29) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.getAdmin(CmdBase.java:112) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.getTopics(CmdTopics.java:2876) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.access$12200(CmdTopics.java:91) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics$ListCmd.run(CmdTopics.java:395) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:87) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:257) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.AdminShell.runCommand(AdminShell.java:72) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:455) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:237) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.main(PulsarShell.java:215) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n        Suppressed: java.lang.UnsatisfiedLinkError: no conscrypt in java.library.path: /Users/awalker/Library/Java/Extensions:/Library/Java/Extensions:/Network/Library/Java/Extensions:/System/Library/Java/Extensions:/usr/lib/java:.\n                at java.lang.ClassLoader.loadLibrary(ClassLoader.java:2429) ~[?:?]\n                at java.lang.Runtime.loadLibrary0(Runtime.java:818) ~[?:?]\n                at java.lang.System.loadLibrary(System.java:1989) ~[?:?]\n                at org.conscrypt.NativeLibraryUtil.loadLibrary(NativeLibraryUtil.java:54) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibraryFromCurrentClassloader(NativeLibraryLoader.java:318) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadLibrary(NativeLibraryLoader.java:273) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.load(NativeLibraryLoader.java:162) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeLibraryLoader.loadFirstAvailable(NativeLibraryLoader.java:106) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCryptoJni.init(NativeCryptoJni.java:50) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.NativeCrypto.&lt;clinit&gt;(NativeCrypto.java:64) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at org.conscrypt.Conscrypt.checkAvailability(Conscrypt.java:119) ~[conscrypt-openjdk-uber-2.5.2.jar:2.5.2]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method) ~[?:?]\n                at jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77) ~[?:?]\n                at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n                at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n                at org.apache.pulsar.common.util.SecurityUtility.loadConscryptProvider(SecurityUtility.java:125) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.common.util.SecurityUtility.&lt;clinit&gt;(SecurityUtility.java:81) ~[pulsar-common-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.&lt;init&gt;(AsyncHttpConnector.java:163) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.http.AsyncHttpConnectorProvider.getConnector(AsyncHttpConnectorProvider.java:52) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminImpl.&lt;init&gt;(PulsarAdminImpl.java:199) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.client.admin.internal.PulsarAdminBuilderImpl.build(PulsarAdminBuilderImpl.java:49) ~[pulsar-client-admin-original-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:69) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminSupplier.get(PulsarAdminSupplier.java:29) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.getAdmin(CmdBase.java:112) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.getTopics(CmdTopics.java:2876) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics.access$12200(CmdTopics.java:91) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdTopics$ListCmd.run(CmdTopics.java:395) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:87) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:257) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.AdminShell.runCommand(AdminShell.java:72) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:455) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.run(PulsarShell.java:237) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\n                at org.apache.pulsar.shell.PulsarShell.main(PulsarShell.java:215) ~[pulsar-client-tools-2.10.4.2.jar:2.10.4.2]\npersistent://public/default/topic1\npersistent://public/default/topic2\ntlsclient(pulsar.my.cluster)&gt;\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"tlsclient(pulsar.my.cluster)&gt; config view tlsclient\nwebServiceUrl=https://pulsar.my.cluster:443\nbrokerServiceUrl=pulsar://pulsar.my.cluster:6650\nauthPlugin=org.apache.pulsar.client.impl.auth.AuthenticationToken\nauthParams=file:///Users/me/.config/pulsar/auth_token.txt\ntlsAllowInsecureConnection=false\ntlsEnableHostnameVerification=false\ntlsTrustCertsFilePath=/Users/me/.config/pulsar/mycluster.crt\nuseKeyStoreTls=false\ntlsTrustStoreType=JKS\ntlsTrustStorePath=\ntlsTrustStorePassword=\"><pre class=\"notranslate\"><code class=\"notranslate\">tlsclient(pulsar.my.cluster)&gt; config view tlsclient\nwebServiceUrl=https://pulsar.my.cluster:443\nbrokerServiceUrl=pulsar://pulsar.my.cluster:6650\nauthPlugin=org.apache.pulsar.client.impl.auth.AuthenticationToken\nauthParams=file:///Users/me/.config/pulsar/auth_token.txt\ntlsAllowInsecureConnection=false\ntlsEnableHostnameVerification=false\ntlsTrustCertsFilePath=/Users/me/.config/pulsar/mycluster.crt\nuseKeyStoreTls=false\ntlsTrustStoreType=JKS\ntlsTrustStorePath=\ntlsTrustStorePassword=\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20702",
                "createdAt": "2023-07-02T05:02:51Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Gracefully shutdown does not work with admin cli in standalone",
        "url": "https://github.com/apache/pulsar/pull/20709",
        "resourcePath": "/apache/pulsar/pull/20709",
        "createdAt": "2023-07-03T22:43:44Z",
        "number": 20709,
        "mergeCommit": {
          "oid": "362c4f4966a59bdb612ba4369d63bcfb23419e32",
          "message": "[fix][broker] Gracefully shutdown does not work with admin cli in standalone (#20709)\n\nFixes : #20617\r\n\r\n### Motivation\r\n\r\nCurrently, clients' shutdown API does not behave consistently in sense that asynchronicity is not handled explicitly. So issue #20617 happens.\r\n\r\nThis PR will allow clients know that shutdown is actually triggered.\r\n\r\n### Modifications\r\n\r\n- Synchronize call to `POST /shutdown` on client side\r\n- Asynchronize explicitly `pulsar().closeAsync()` invocation",
          "commitUrl": "https://github.com/apache/pulsar/commit/362c4f4966a59bdb612ba4369d63bcfb23419e32",
          "parents": {
            "nodes": [
              {
                "oid": "e55ed58eed4380b463d04b76dbb953d7a0ac795d",
                "message": "[improve][broker] Add annotation for topic compaction strategy (#20858)\n\n### Motivation\r\n\r\nAdd `Audience.Private` annotation for topic compaction strategy. Since this interface only uses for load manager, other users should not use this interface."
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/BrokersBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin-api/src/main/java/org/apache/pulsar/client/admin/Brokers.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdBrokers.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5UkFdq2gAoMDJiOWIwMzBjNGIxNTIzZDNjMGM4OWFlNzFlOTY0Y2U4NTljNWI3Ng",
                "url": "https://github.com/apache/pulsar/pull/20709/commits/02b9b030c4b1523d3c0c89ae71e964ce859c5b76"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20617,
                "url": "https://github.com/apache/pulsar/issues/20617",
                "title": "[Bug] Gracefully shutdown not work with admin cli",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">3.0.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>start the pulsar standalone</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"PULSAR_STANDALONE_USE_ZOOKEEPER=1 ./bin/pulsar standalone\"><pre class=\"notranslate\"><code class=\"notranslate\">PULSAR_STANDALONE_USE_ZOOKEEPER=1 ./bin/pulsar standalone\n</code></pre></div>\n<ol start=\"2\" dir=\"auto\">\n<li>use admin cli to shutdown broker:</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ bin/pulsar-admin brokers shutdown\nSuccessfully trigger broker shutdown gracefully\"><pre class=\"notranslate\"><code class=\"notranslate\">$ bin/pulsar-admin brokers shutdown\nSuccessfully trigger broker shutdown gracefully\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">The broker should receive the request and start to shutdown.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The broker won't receive the request.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20617",
                "createdAt": "2023-06-20T10:56:52Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Fix subscribing pattern topics through Proxy not working",
        "url": "https://github.com/apache/pulsar/pull/20739",
        "resourcePath": "/apache/pulsar/pull/20739",
        "createdAt": "2023-07-06T10:48:18Z",
        "number": 20739,
        "mergeCommit": {
          "oid": "558c12df6aff2b93e81ab56099c50ce291f8f6d3",
          "message": "[fix][client] Fix subscribing pattern topics through Proxy not working (#20739)",
          "commitUrl": "https://github.com/apache/pulsar/commit/558c12df6aff2b93e81ab56099c50ce291f8f6d3",
          "parents": {
            "nodes": [
              {
                "oid": "e96b3398912163eb6e0528c10aed3507c95952fd",
                "message": "[improve][broker] Support get/remove permissions for AuthorizationProvider (#20496)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/InactiveTopicDeleteTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/TopicListWatcher.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/TopicListWatcherTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5UzCJ22gAoNDljNzdjNzczMDY4MjQyMjc3YThlNTYzMjFkYjZkYTg5MjFlZWVkMQ",
                "url": "https://github.com/apache/pulsar/pull/20739/commits/49c77c773068242277a8e56321db6da8921eeed1"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20714,
                "url": "https://github.com/apache/pulsar/issues/20714",
                "title": "[Bug] Exception creating topic list watcher with regex topic pattern",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar 3.0.0<br>\nMac OS 13.4 (M1) &amp; Windows 10 (Tested steps to reproduce on both)</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Place the following <code class=\"notranslate\">docker-compose.yml</code> in a folder and run <code class=\"notranslate\">docker-compose up --build</code> in that folder. Exec into one of the Pulsar container (I used the Proxy one), run <code class=\"notranslate\">bash</code> then <code class=\"notranslate\">cd bin</code> then execute <code class=\"notranslate\">./pulsar-client --url \"pulsar://localhost:6650\" consume \"public/default/message-type-[a-z0-9]{1,8}\" --subscription-name \"serviceMessageTypeSubscription\" --regex</code>. You should see the following:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-07-04T12:07:35,209+0000 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ConnectionPool - [[id: 0x99f4dfff, L:/127.0.0.1:39888 - R:localhost/127.0.0.1:6650]] Connected to server\n2023-07-04T12:07:35,345+0000 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.TopicListWatcher - [null][Watcher(public/default/message-type-[a-z0-9]{1,8})] Creating topic list watcher on cnx [id: 0x99f4dfff, L:/127.0.0.1:39888 - R:localhost/127.0.0.1:6650], watcherId 0\n2023-07-04T12:07:35,349+0000 [pulsar-client-io-1-3] WARN  org.apache.pulsar.client.impl.TopicListWatcher - [null][Watcher(public/default/message-type-[a-z0-9]{1,8})] Failed to create topic list watcher on localhost/127.0.0.1:6650\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-07-04T12:07:35,209+0000 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ConnectionPool - [[id: 0x99f4dfff, L:/127.0.0.1:39888 - R:localhost/127.0.0.1:6650]] Connected to server\n2023-07-04T12:07:35,345+0000 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.TopicListWatcher - [null][Watcher(public/default/message-type-[a-z0-9]{1,8})] Creating topic list watcher on cnx [id: 0x99f4dfff, L:/127.0.0.1:39888 - R:localhost/127.0.0.1:6650], watcherId 0\n2023-07-04T12:07:35,349+0000 [pulsar-client-io-1-3] WARN  org.apache.pulsar.client.impl.TopicListWatcher - [null][Watcher(public/default/message-type-[a-z0-9]{1,8})] Failed to create topic list watcher on localhost/127.0.0.1:6650\n</code></pre></div>\n<div class=\"highlight highlight-source-yaml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"version: '3'\n\nnetworks:\n  pulsar:\n    driver: bridge\n\nservices:\n\n  zookeeper:\n    image: apachepulsar/pulsar:3.0.0\n    container_name: zookeeper\n    restart: on-failure\n    networks:\n      - pulsar\n    ports:\n      - &quot;2181:2181&quot;\n      - &quot;8010:8000&quot;\n    environment:\n      - PULSAR_MEM=-Xms256m -Xmx256m -XX:MaxDirectMemorySize=256m\n    command: &gt;\n      bash -c &quot;bin/apply-config-from-env.py conf/zookeeper.conf &amp;&amp; \\\n             bin/generate-zookeeper-config.sh conf/zookeeper.conf &amp;&amp; \\\n             exec bin/pulsar zookeeper&quot;\n    healthcheck:\n      test: [&quot;CMD&quot;, &quot;bin/pulsar-zookeeper-ruok.sh&quot;]\n      interval: 10s\n      timeout: 5s\n      retries: 30\n\n  cluster-init:\n    container_name: cluster-init\n    hostname: cluster-init\n    image: apachepulsar/pulsar:3.0.0\n    networks:\n      - pulsar\n    command: &gt;\n      bin/pulsar initialize-cluster-metadata \\\n               --cluster local \\\n               --zookeeper zookeeper:2181 \\\n               --configuration-store zookeeper:2181 \\\n               --web-service-url http://broker:8080 \\\n               --broker-service-url pulsar://broker:6650\n    depends_on:\n      zookeeper:\n        condition: service_healthy\n\n  bookie:\n    image: apachepulsar/pulsar:3.0.0\n    container_name: bookie\n    restart: on-failure\n    networks:\n      - pulsar\n    environment:\n      - clusterName=local\n      - zkServers=zookeeper:2181\n      - enableStatistics=true\n      - advertisedAddress=bookie\n      - extraServerComponents=org.apache.bookkeeper.stream.server.StreamStorageLifecycleComponent\n      - BOOKIE_MEM=-Xms512m -Xmx512m -XX:MaxDirectMemorySize=256m\n    depends_on:\n      zookeeper:\n        condition: service_healthy\n      cluster-init:\n        condition: service_completed_successfully\n    ports:\n      - &quot;3181:3181&quot;\n      - &quot;4181:4181&quot;\n      - &quot;8020:8000&quot;\n    command: &gt;\n      bash -c &quot;\n        bin/apply-config-from-env.py conf/bookkeeper.conf &amp;&amp;\n        echo 'storageserver.grpc.port=4181' &gt;&gt; conf/bookkeeper.conf &amp;&amp;\n        echo 'dlog.bkcEnsembleSize=1' &gt;&gt; conf/bookkeeper.conf &amp;&amp;\n        echo 'dlog.bkcWriteQuorumSize=1' &gt;&gt; conf/bookkeeper.conf &amp;&amp;\n        echo 'dlog.bkcAckQuorumSize=1' &gt;&gt; conf/bookkeeper.conf &amp;&amp;\n        echo 'storage.range.store.dirs=data/bookkeeper/ranges' &gt;&gt; conf/bookkeeper.conf &amp;&amp;\n        echo 'storage.serve.readonly.tables=false' &gt;&gt; conf/bookkeeper.conf &amp;&amp;\n        echo 'storage.cluster.controller.schedule.interval.ms=30000' &gt;&gt; conf/bookkeeper.conf &amp;&amp;\n        exec bin/pulsar bookie\n      &quot;\n\n  broker:\n    image: apachepulsar/pulsar:3.0.0\n    container_name: broker\n    hostname: broker\n    restart: on-failure\n    networks:\n      - pulsar\n    environment:\n      - metadataStoreUrl=zookeeper:2181\n      - configurationMetadataStoreUrl=zookeeper:2181\n      - advertisedAddress=broker\n      - clusterName=local\n      - allowAutoTopicCreationType=partitioned\n      - defaultNumPartitions=2\n      - subscriptionExpirationTimeMinutes=10\n      - subscriptionPatternMaxLength=65\n      - webSocketServiceEnabled=true\n      - functionsWorkerEnabled=true\n      - proxyRoles=proxy-admin\n      - superUserRoles=broker-admin,proxy-admin,fw-admin,internal-admin\n      - authenticateOriginalAuthData=false\n      - authenticationEnabled=false\n      - authorizationEnabled=false\n      - managedLedgerDefaultEnsembleSize=1\n      - managedLedgerDefaultWriteQuorum=1\n      - managedLedgerDefaultAckQuorum=1\n      - PULSAR_MEM=-Xms512m -Xmx512m -XX:MaxDirectMemorySize=256m\n    depends_on:\n      zookeeper:\n        condition: service_healthy\n      bookie:\n        condition: service_started\n    ports:\n      - &quot;8030:8080&quot;\n    command: &gt;\n      bash -c &quot;\n        bin/apply-config-from-env.py conf/broker.conf &amp;&amp; \n        exec bin/pulsar broker\n      &quot;\n\n  proxy:\n    image: apachepulsar/pulsar:3.0.0\n    container_name: proxy\n    hostname: proxy\n    restart: on-failure\n    networks:\n      - pulsar\n    environment:\n      - metadataStoreUrl=zookeeper:2181\n      - configurationMetadataStoreUrl=zookeeper:2181\n      - forwardAuthorizationCredentials=true\n      - authenticationEnabled=false\n      - webSocketServiceEnabled=true\n      - clusterName=local\n      - PULSAR_MEM=-Xms256m -Xmx256m -XX:MaxDirectMemorySize=256m\n    depends_on:\n      zookeeper:\n        condition: service_healthy\n      broker:\n        condition: service_started\n    ports:\n      - &quot;6650:6650&quot;\n      - &quot;8080:8080&quot;\n    command: bash -c &quot;bin/apply-config-from-env.py conf/proxy.conf &amp;&amp; exec bin/pulsar proxy&quot;\"><pre class=\"notranslate\"><span class=\"pl-ent\">version</span>: <span class=\"pl-s\"><span class=\"pl-pds\">'</span>3<span class=\"pl-pds\">'</span></span>\n\n<span class=\"pl-ent\">networks</span>:\n  <span class=\"pl-ent\">pulsar</span>:\n    <span class=\"pl-ent\">driver</span>: <span class=\"pl-s\">bridge</span>\n\n<span class=\"pl-ent\">services</span>:\n\n  <span class=\"pl-ent\">zookeeper</span>:\n    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">apachepulsar/pulsar:3.0.0</span>\n    <span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">zookeeper</span>\n    <span class=\"pl-ent\">restart</span>: <span class=\"pl-s\">on-failure</span>\n    <span class=\"pl-ent\">networks</span>:\n      - <span class=\"pl-s\">pulsar</span>\n    <span class=\"pl-ent\">ports</span>:\n      - <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>2181:2181<span class=\"pl-pds\">\"</span></span>\n      - <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>8010:8000<span class=\"pl-pds\">\"</span></span>\n    <span class=\"pl-ent\">environment</span>:\n      - <span class=\"pl-s\">PULSAR_MEM=-Xms256m -Xmx256m -XX:MaxDirectMemorySize=256m</span>\n    <span class=\"pl-ent\">command</span>: <span class=\"pl-s\">&gt;</span>\n<span class=\"pl-s\">      bash -c \"bin/apply-config-from-env.py conf/zookeeper.conf &amp;&amp; \\</span>\n<span class=\"pl-s\">             bin/generate-zookeeper-config.sh conf/zookeeper.conf &amp;&amp; \\</span>\n<span class=\"pl-s\">             exec bin/pulsar zookeeper\"</span>\n<span class=\"pl-s\"></span>    <span class=\"pl-ent\">healthcheck</span>:\n      <span class=\"pl-ent\">test</span>: <span class=\"pl-s\">[\"CMD\", \"bin/pulsar-zookeeper-ruok.sh\"]</span>\n      <span class=\"pl-ent\">interval</span>: <span class=\"pl-c1\">10s</span>\n      <span class=\"pl-ent\">timeout</span>: <span class=\"pl-c1\">5s</span>\n      <span class=\"pl-ent\">retries</span>: <span class=\"pl-c1\">30</span>\n\n  <span class=\"pl-ent\">cluster-init</span>:\n    <span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">cluster-init</span>\n    <span class=\"pl-ent\">hostname</span>: <span class=\"pl-s\">cluster-init</span>\n    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">apachepulsar/pulsar:3.0.0</span>\n    <span class=\"pl-ent\">networks</span>:\n      - <span class=\"pl-s\">pulsar</span>\n    <span class=\"pl-ent\">command</span>: <span class=\"pl-s\">&gt;</span>\n<span class=\"pl-s\">      bin/pulsar initialize-cluster-metadata \\</span>\n<span class=\"pl-s\">               --cluster local \\</span>\n<span class=\"pl-s\">               --zookeeper zookeeper:2181 \\</span>\n<span class=\"pl-s\">               --configuration-store zookeeper:2181 \\</span>\n<span class=\"pl-s\">               --web-service-url http://broker:8080 \\</span>\n<span class=\"pl-s\">               --broker-service-url pulsar://broker:6650</span>\n<span class=\"pl-s\"></span>    <span class=\"pl-ent\">depends_on</span>:\n      <span class=\"pl-ent\">zookeeper</span>:\n        <span class=\"pl-ent\">condition</span>: <span class=\"pl-s\">service_healthy</span>\n\n  <span class=\"pl-ent\">bookie</span>:\n    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">apachepulsar/pulsar:3.0.0</span>\n    <span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">bookie</span>\n    <span class=\"pl-ent\">restart</span>: <span class=\"pl-s\">on-failure</span>\n    <span class=\"pl-ent\">networks</span>:\n      - <span class=\"pl-s\">pulsar</span>\n    <span class=\"pl-ent\">environment</span>:\n      - <span class=\"pl-s\">clusterName=local</span>\n      - <span class=\"pl-s\">zkServers=zookeeper:2181</span>\n      - <span class=\"pl-s\">enableStatistics=true</span>\n      - <span class=\"pl-s\">advertisedAddress=bookie</span>\n      - <span class=\"pl-s\">extraServerComponents=org.apache.bookkeeper.stream.server.StreamStorageLifecycleComponent</span>\n      - <span class=\"pl-s\">BOOKIE_MEM=-Xms512m -Xmx512m -XX:MaxDirectMemorySize=256m</span>\n    <span class=\"pl-ent\">depends_on</span>:\n      <span class=\"pl-ent\">zookeeper</span>:\n        <span class=\"pl-ent\">condition</span>: <span class=\"pl-s\">service_healthy</span>\n      <span class=\"pl-ent\">cluster-init</span>:\n        <span class=\"pl-ent\">condition</span>: <span class=\"pl-s\">service_completed_successfully</span>\n    <span class=\"pl-ent\">ports</span>:\n      - <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>3181:3181<span class=\"pl-pds\">\"</span></span>\n      - <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>4181:4181<span class=\"pl-pds\">\"</span></span>\n      - <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>8020:8000<span class=\"pl-pds\">\"</span></span>\n    <span class=\"pl-ent\">command</span>: <span class=\"pl-s\">&gt;</span>\n<span class=\"pl-s\">      bash -c \"</span>\n<span class=\"pl-s\">        bin/apply-config-from-env.py conf/bookkeeper.conf &amp;&amp;</span>\n<span class=\"pl-s\">        echo 'storageserver.grpc.port=4181' &gt;&gt; conf/bookkeeper.conf &amp;&amp;</span>\n<span class=\"pl-s\">        echo 'dlog.bkcEnsembleSize=1' &gt;&gt; conf/bookkeeper.conf &amp;&amp;</span>\n<span class=\"pl-s\">        echo 'dlog.bkcWriteQuorumSize=1' &gt;&gt; conf/bookkeeper.conf &amp;&amp;</span>\n<span class=\"pl-s\">        echo 'dlog.bkcAckQuorumSize=1' &gt;&gt; conf/bookkeeper.conf &amp;&amp;</span>\n<span class=\"pl-s\">        echo 'storage.range.store.dirs=data/bookkeeper/ranges' &gt;&gt; conf/bookkeeper.conf &amp;&amp;</span>\n<span class=\"pl-s\">        echo 'storage.serve.readonly.tables=false' &gt;&gt; conf/bookkeeper.conf &amp;&amp;</span>\n<span class=\"pl-s\">        echo 'storage.cluster.controller.schedule.interval.ms=30000' &gt;&gt; conf/bookkeeper.conf &amp;&amp;</span>\n<span class=\"pl-s\">        exec bin/pulsar bookie</span>\n<span class=\"pl-s\">      \"</span>\n<span class=\"pl-s\"></span>\n<span class=\"pl-s\"></span>  <span class=\"pl-ent\">broker</span>:\n    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">apachepulsar/pulsar:3.0.0</span>\n    <span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">broker</span>\n    <span class=\"pl-ent\">hostname</span>: <span class=\"pl-s\">broker</span>\n    <span class=\"pl-ent\">restart</span>: <span class=\"pl-s\">on-failure</span>\n    <span class=\"pl-ent\">networks</span>:\n      - <span class=\"pl-s\">pulsar</span>\n    <span class=\"pl-ent\">environment</span>:\n      - <span class=\"pl-s\">metadataStoreUrl=zookeeper:2181</span>\n      - <span class=\"pl-s\">configurationMetadataStoreUrl=zookeeper:2181</span>\n      - <span class=\"pl-s\">advertisedAddress=broker</span>\n      - <span class=\"pl-s\">clusterName=local</span>\n      - <span class=\"pl-s\">allowAutoTopicCreationType=partitioned</span>\n      - <span class=\"pl-s\">defaultNumPartitions=2</span>\n      - <span class=\"pl-s\">subscriptionExpirationTimeMinutes=10</span>\n      - <span class=\"pl-s\">subscriptionPatternMaxLength=65</span>\n      - <span class=\"pl-s\">webSocketServiceEnabled=true</span>\n      - <span class=\"pl-s\">functionsWorkerEnabled=true</span>\n      - <span class=\"pl-s\">proxyRoles=proxy-admin</span>\n      - <span class=\"pl-s\">superUserRoles=broker-admin,proxy-admin,fw-admin,internal-admin</span>\n      - <span class=\"pl-s\">authenticateOriginalAuthData=false</span>\n      - <span class=\"pl-s\">authenticationEnabled=false</span>\n      - <span class=\"pl-s\">authorizationEnabled=false</span>\n      - <span class=\"pl-s\">managedLedgerDefaultEnsembleSize=1</span>\n      - <span class=\"pl-s\">managedLedgerDefaultWriteQuorum=1</span>\n      - <span class=\"pl-s\">managedLedgerDefaultAckQuorum=1</span>\n      - <span class=\"pl-s\">PULSAR_MEM=-Xms512m -Xmx512m -XX:MaxDirectMemorySize=256m</span>\n    <span class=\"pl-ent\">depends_on</span>:\n      <span class=\"pl-ent\">zookeeper</span>:\n        <span class=\"pl-ent\">condition</span>: <span class=\"pl-s\">service_healthy</span>\n      <span class=\"pl-ent\">bookie</span>:\n        <span class=\"pl-ent\">condition</span>: <span class=\"pl-s\">service_started</span>\n    <span class=\"pl-ent\">ports</span>:\n      - <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>8030:8080<span class=\"pl-pds\">\"</span></span>\n    <span class=\"pl-ent\">command</span>: <span class=\"pl-s\">&gt;</span>\n<span class=\"pl-s\">      bash -c \"</span>\n<span class=\"pl-s\">        bin/apply-config-from-env.py conf/broker.conf &amp;&amp; </span>\n<span class=\"pl-s\">        exec bin/pulsar broker</span>\n<span class=\"pl-s\">      \"</span>\n<span class=\"pl-s\"></span>\n<span class=\"pl-s\"></span>  <span class=\"pl-ent\">proxy</span>:\n    <span class=\"pl-ent\">image</span>: <span class=\"pl-s\">apachepulsar/pulsar:3.0.0</span>\n    <span class=\"pl-ent\">container_name</span>: <span class=\"pl-s\">proxy</span>\n    <span class=\"pl-ent\">hostname</span>: <span class=\"pl-s\">proxy</span>\n    <span class=\"pl-ent\">restart</span>: <span class=\"pl-s\">on-failure</span>\n    <span class=\"pl-ent\">networks</span>:\n      - <span class=\"pl-s\">pulsar</span>\n    <span class=\"pl-ent\">environment</span>:\n      - <span class=\"pl-s\">metadataStoreUrl=zookeeper:2181</span>\n      - <span class=\"pl-s\">configurationMetadataStoreUrl=zookeeper:2181</span>\n      - <span class=\"pl-s\">forwardAuthorizationCredentials=true</span>\n      - <span class=\"pl-s\">authenticationEnabled=false</span>\n      - <span class=\"pl-s\">webSocketServiceEnabled=true</span>\n      - <span class=\"pl-s\">clusterName=local</span>\n      - <span class=\"pl-s\">PULSAR_MEM=-Xms256m -Xmx256m -XX:MaxDirectMemorySize=256m</span>\n    <span class=\"pl-ent\">depends_on</span>:\n      <span class=\"pl-ent\">zookeeper</span>:\n        <span class=\"pl-ent\">condition</span>: <span class=\"pl-s\">service_healthy</span>\n      <span class=\"pl-ent\">broker</span>:\n        <span class=\"pl-ent\">condition</span>: <span class=\"pl-s\">service_started</span>\n    <span class=\"pl-ent\">ports</span>:\n      - <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>6650:6650<span class=\"pl-pds\">\"</span></span>\n      - <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>8080:8080<span class=\"pl-pds\">\"</span></span>\n    <span class=\"pl-ent\">command</span>: <span class=\"pl-s\">bash -c \"bin/apply-config-from-env.py conf/proxy.conf &amp;&amp; exec bin/pulsar proxy\"</span></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I expected to see the client successfully create a topic watcher for my topic regex pattern.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The client fails to create a topic watcher for the regex pattern you can see in the steps to reproduce. When run from my Java microservice, we also get the following stack trace which seems to provide a little more information:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-07-04 11:35:56.090 DEBUG 70935 --- [r-client-io-1-3] o.a.p.c.i.PatternMultiTopicsConsumerImpl :  : Unable to create topic list watcher. Falling back to only polling for new topics\n\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$NotAllowedException: Broker does not allow broker side pattern evaluation.\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:332) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.uniAcceptNow(CompletableFuture.java:747) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:735) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:2214) ~[?:?]\n\tat org.apache.pulsar.client.impl.TopicListWatcher.connectionOpened(TopicListWatcher.java:127) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.client.impl.ConnectionHandler.lambda$grabCnx$0(ConnectionHandler.java:84) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat java.util.concurrent.CompletableFuture.uniAcceptNow(CompletableFuture.java:757) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:735) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:2214) ~[?:?]\n\tat org.apache.pulsar.client.impl.ConnectionHandler.grabCnx(ConnectionHandler.java:84) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.client.impl.TopicListWatcher.&lt;init&gt;(TopicListWatcher.java:81) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.client.impl.PatternMultiTopicsConsumerImpl.&lt;init&gt;(PatternMultiTopicsConsumerImpl.java:84) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.client.impl.PulsarClientImpl.lambda$patternTopicSubscribeAsync$8(PulsarClientImpl.java:588) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:718) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2179) ~[?:?]\n\tat org.apache.pulsar.client.impl.BinaryProtoLookupService.lambda$getTopicsUnderNamespace$11(BinaryProtoLookupService.java:315) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863) ~[?:?]\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2179) ~[?:?]\n\tat org.apache.pulsar.client.impl.ClientCnx.handleGetTopicsOfNamespaceSuccess(ClientCnx.java:899) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:344) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.handler.flush.FlushConsolidationHandler.channelRead(FlushConsolidationHandler.java:152) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat java.lang.Thread.run(Thread.java:1583) ~[?:?]\nCaused by: org.apache.pulsar.client.api.PulsarClientException$NotAllowedException: Broker does not allow broker side pattern evaluation.\n\tat org.apache.pulsar.client.impl.ClientCnx.newWatchTopicList(ClientCnx.java:1131) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.client.impl.TopicListWatcher.connectionOpened(TopicListWatcher.java:125) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\t... 43 more\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-07-04 11:35:56.090 DEBUG 70935 --- [r-client-io-1-3] o.a.p.c.i.PatternMultiTopicsConsumerImpl :  : Unable to create topic list watcher. Falling back to only polling for new topics\n\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$NotAllowedException: Broker does not allow broker side pattern evaluation.\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:332) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.uniAcceptNow(CompletableFuture.java:747) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:735) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:2214) ~[?:?]\n\tat org.apache.pulsar.client.impl.TopicListWatcher.connectionOpened(TopicListWatcher.java:127) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.client.impl.ConnectionHandler.lambda$grabCnx$0(ConnectionHandler.java:84) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat java.util.concurrent.CompletableFuture.uniAcceptNow(CompletableFuture.java:757) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:735) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:2214) ~[?:?]\n\tat org.apache.pulsar.client.impl.ConnectionHandler.grabCnx(ConnectionHandler.java:84) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.client.impl.TopicListWatcher.&lt;init&gt;(TopicListWatcher.java:81) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.client.impl.PatternMultiTopicsConsumerImpl.&lt;init&gt;(PatternMultiTopicsConsumerImpl.java:84) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.client.impl.PulsarClientImpl.lambda$patternTopicSubscribeAsync$8(PulsarClientImpl.java:588) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:718) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2179) ~[?:?]\n\tat org.apache.pulsar.client.impl.BinaryProtoLookupService.lambda$getTopicsUnderNamespace$11(BinaryProtoLookupService.java:315) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863) ~[?:?]\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2179) ~[?:?]\n\tat org.apache.pulsar.client.impl.ClientCnx.handleGetTopicsOfNamespaceSuccess(ClientCnx.java:899) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:344) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.handler.flush.FlushConsolidationHandler.channelRead(FlushConsolidationHandler.java:152) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat java.lang.Thread.run(Thread.java:1583) ~[?:?]\nCaused by: org.apache.pulsar.client.api.PulsarClientException$NotAllowedException: Broker does not allow broker side pattern evaluation.\n\tat org.apache.pulsar.client.impl.ClientCnx.newWatchTopicList(ClientCnx.java:1131) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\tat org.apache.pulsar.client.impl.TopicListWatcher.connectionOpened(TopicListWatcher.java:125) ~[pulsar-client-3.0.0.jar!/:3.0.0]\n\t... 43 more\n</code></pre></div>\n<p dir=\"auto\">In the microservice we are using the same Pulsar version and subscription pattern.</p>\n<p dir=\"auto\">We have confirmed that broker pattern evaluation is enabled in our conf.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">We also tried subscribing against the broker directly and we <strong>do not</strong> see this issue. We also don't see this issue when testing against Pulsar Standalone</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20714",
                "createdAt": "2023-07-04T12:12:40Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[feat][ci] Label PIP request",
        "url": "https://github.com/apache/pulsar/pull/20760",
        "resourcePath": "/apache/pulsar/pull/20760",
        "createdAt": "2023-07-08T16:05:03Z",
        "number": 20760,
        "mergeCommit": {
          "oid": "c749872a72a0f74e8daf2ebd2669287c410809cb",
          "message": "[feat][ci] Label PIP request (#20760)\n\nSigned-off-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/c749872a72a0f74e8daf2ebd2669287c410809cb",
          "parents": {
            "nodes": [
              {
                "oid": "3a9fca9dd64df6003f72e880cc2f56d83382b6ab",
                "message": "[fix][test] Fix RangeConvert parse issue in the PerformanceProducer (#20755)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": ".github/labeler.yml"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": ".github/workflows/labeler.yml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5U_tG82gAoYzNiNmNmZDc5ODdjOGYzMGIyYjk4YTc2ZGE1N2ZlM2M0OTUyMzU0YQ",
                "url": "https://github.com/apache/pulsar/pull/20760/commits/c3b6cfd7987c8f30b2b98a76da57fe3c4952354a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20712,
                "url": "https://github.com/apache/pulsar/issues/20712",
                "title": "Add \"pip\" label automatically to a PR when adding file to PIP directory",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">When someone creates a new PR for a new PIP, they need to select a number.<br>\nToday they search for previous PIPs PRs based on text like \"[pip]\" but people forget to register that text in their title thus leading to numbering conflicts.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">There will be a GitHub workflow, which will detect if a PR contains a <em>new</em> file matching the pattern \"pip*.md\" and add the label \"pip\" to the PR.</p>\n<p dir=\"auto\">Once we add \"pip\" label to previous PIP PRs, we can modify the search for previous PIPs listed <a href=\"https://github.com/apache/pulsar/blob/master/pip/README.md\">here</a> to be based on \"pip\" label, and type: PR.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\">Using titles as described in motivation</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">No</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20712",
                "createdAt": "2023-07-04T08:05:46Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Unload concurrency limit during graceful shutdown",
        "url": "https://github.com/apache/pulsar/pull/20766",
        "resourcePath": "/apache/pulsar/pull/20766",
        "createdAt": "2023-07-10T02:25:57Z",
        "number": 20766,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5VCNXr2gAoODY3YzZlZjBhM2JjN2JkZWY0NGY2Y2ZjNWYzYmI4NTYyOTExYmQ0Yg",
                "url": "https://github.com/apache/pulsar/pull/20766/commits/867c6ef0a3bc7bdef44f6cfc5f3bb8562911bd4b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20753,
                "url": "https://github.com/apache/pulsar/issues/20753",
                "title": "Unload Rate Limiting during Graceful Shutdown",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">When Pulsar undergoes a graceful shutdown, it unloads all topics, but there is no limit on the unloading rate. As a result, during a rolling upgrade, the broker cluster might generate a large volume of lookup requests in a short period, which could affect the service of the broker. Implementing a limit on the unload rate would make the upgrade process smoother.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">This issue has been previously raised in a pull request <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1123731114\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/14114\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/14114/hovercard\" href=\"https://github.com/apache/pulsar/pull/14114\">#14114</a> and a solution was proposed by adding an unload interface with concurrency control for admin CLI.</p>\n<p dir=\"auto\">However, the current broker graceful shutdown doesn't use this interface. Hence, my proposal is pretty straightforward:</p>\n<ol dir=\"auto\">\n<li>\n<p dir=\"auto\">Add a <strong>dynamic</strong> config named <code class=\"notranslate\">brokerShutdownMaxBundleUnloadPerMinute</code>  to the Pulsar broker to control the concurrency of unloading.</p>\n</li>\n<li>\n<p dir=\"auto\">Modify <a href=\"https://github.com/apache/pulsar/blob/7636e8989f4d3fc24fce69a356d54e1c550945ed/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/BrokersBase.java#L557\">this code</a> to use <a href=\"https://github.com/apache/pulsar/blob/7636e8989f4d3fc24fce69a356d54e1c550945ed/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java#L790-L791\">this function</a> with the concurrency parameter for unloading.</p>\n</li>\n</ol>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">mail list: <a href=\"https://lists.apache.org/thread/7f5f9gn7qq86hstrkw5oz51g0rxrqq37\" rel=\"nofollow\">https://lists.apache.org/thread/7f5f9gn7qq86hstrkw5oz51g0rxrqq37</a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20753",
                "createdAt": "2023-07-07T07:23:43Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Pulsar Function Kubernetes Runtime fails to start function that contains parenthesis in original jar filename",
        "url": "https://github.com/apache/pulsar/pull/20790",
        "resourcePath": "/apache/pulsar/pull/20790",
        "createdAt": "2023-07-12T09:37:36Z",
        "number": 20790,
        "mergeCommit": {
          "oid": "1c3e6932f277a2450be4cc5940655dd99ec4b9fd",
          "message": "[fix][fn] Pulsar Function Kubernetes Runtime fails to start function that contains parenthesis in original jar filename (#20790)",
          "commitUrl": "https://github.com/apache/pulsar/commit/1c3e6932f277a2450be4cc5940655dd99ec4b9fd",
          "parents": {
            "nodes": [
              {
                "oid": "f69e7dd2dea07c6ab55b367a7818218843ec9335",
                "message": "[pip][design] PIP-280: Refactor CLI for measurement units (time and byte) (#20691)\n\nCo-authored-by: tison <wander4096@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/RuntimeUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/kubernetes/KubernetesRuntime.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/test/java/org/apache/pulsar/functions/runtime/RuntimeUtilsTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/test/java/org/apache/pulsar/functions/runtime/kubernetes/KubernetesRuntimeTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5VSi8O2gAoNmU3NDhmOWQxZDY2ZjViM2UzMDgwODZlZjUxYjcwZTk3M2NkNzA2OA",
                "url": "https://github.com/apache/pulsar/pull/20790/commits/6e748f9d1d66f5b3e308086ef51b70e973cd7068"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20789,
                "url": "https://github.com/apache/pulsar/issues/20789",
                "title": "[Bug] Pulsar Functions Kubernetes Runtime fails to start function instance when original jar file name contains parenthesis",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.10.x</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Create a function with a jar file that contains parenthesis<br>\nfor example <code class=\"notranslate\">function(1).jar</code></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Function should run normally</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Function stateful set was in a crash loop in Kubernetes. Logs contained this error:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"stderr F sh: 1: Syntax error: &quot;(&quot; unexpected\"><pre class=\"notranslate\"><code class=\"notranslate\">stderr F sh: 1: Syntax error: \"(\" unexpected\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20789",
                "createdAt": "2023-07-12T09:10:31Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix resource leak in PulsarTestContext",
        "url": "https://github.com/apache/pulsar/pull/20799",
        "resourcePath": "/apache/pulsar/pull/20799",
        "createdAt": "2023-07-13T12:18:31Z",
        "number": 20799,
        "mergeCommit": {
          "oid": "ae0fc5bdcae0220da4936d0fdaff71eead219cdd",
          "message": "[fix][test] Fix resource leak in PulsarTestContext (#20799)",
          "commitUrl": "https://github.com/apache/pulsar/commit/ae0fc5bdcae0220da4936d0fdaff71eead219cdd",
          "parents": {
            "nodes": [
              {
                "oid": "fa72ab4d1fc9991c20025ef86bb8a0b8d65e625b",
                "message": "[fix] [io] elastic-search sink connector not support JSON.String schema. (#20741)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentTopicTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/testcontext/AbstractTestPulsarService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/testcontext/NonStartableTestPulsarService.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5VahKz2gAoMjRmMjUyODI3NmUwYzVmYzYyNWQ4Y2I3MjQ1NmU5MzU3NjE1ZGM3Mw",
                "url": "https://github.com/apache/pulsar/pull/20799/commits/24f2528276e0c5fc625d8cb72456e9357615dc73"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20797,
                "url": "https://github.com/apache/pulsar/issues/20797",
                "title": "[Tests] Thread resource leaks in unit tests ",
                "bodyHTML": "<p dir=\"auto\">Thread leaks:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"\u276f grep -shEr &quot;created [0-9]+ new threads&quot; pulsar-broker | awk -F &quot;Summary: &quot; '{ print $2 }' | awk '{ print $(NF-2), $0}' |sort -rn | cut -f2- -d' '\nTests in class org.apache.pulsar.broker.service.ServerCnxTest created 849 new threads\nTests in class org.apache.pulsar.broker.service.ClusterMigrationTest created 743 new threads\nTests in class org.apache.pulsar.broker.transaction.AuthenticatedTransactionProducerConsumerTest created 100 new threads\nTests in class org.apache.pulsar.broker.loadbalance.LoadBalancerTest created 92 new threads\nTests in class org.apache.pulsar.broker.loadbalance.MultiBrokerLeaderElectionTest created 89 new threads\nTests in class org.apache.pulsar.broker.loadbalance.MultiBrokerLeaderElectionExpirationTest created 81 new threads\nTests in class org.apache.pulsar.broker.transaction.pendingack.PendingAckInMemoryDeleteTest created 78 new threads\nTests in class org.apache.pulsar.broker.transaction.buffer.TransactionStablePositionTest created 78 new threads\nTests in class org.apache.pulsar.broker.service.MessageCumulativeAckTest created 62 new threads\nTests in class org.apache.pulsar.broker.service.ReplicatorTest created 61 new threads\nTests in class org.apache.pulsar.broker.service.BrokerBookieIsolationTest created 51 new threads\nTests in class org.apache.pulsar.broker.loadbalance.SimpleLoadManagerImplTest created 51 new threads\nTests in class org.apache.pulsar.broker.loadbalance.ModularLoadManagerImplTest created 47 new threads\nTests in class org.apache.pulsar.broker.service.TopicOwnerTest created 40 new threads\nTests in class org.apache.pulsar.broker.service.BrokerServiceTest created 37 new threads\nTests in class org.apache.pulsar.broker.service.BrokerBkEnsemblesTests created 32 new threads\nTests in class org.apache.pulsar.broker.SLAMonitoringTest created 31 new threads\nTests in class org.apache.pulsar.broker.service.ReplicatorAdminTlsTest created 26 new threads\nTests in class org.apache.pulsar.broker.service.ReplicatorAdminTlsWithKeyStoreTest created 25 new threads\nTests in class org.apache.pulsar.broker.service.persistent.PersistentSubscriptionTest created 25 new threads\nTests in class org.apache.pulsar.broker.service.PeerReplicatorTest created 24 new threads\nTests in class org.apache.pulsar.broker.service.ReplicatorSubscriptionTest created 23 new threads\nTests in class org.apache.pulsar.broker.service.MaxMessageSizeTest created 23 new threads\nTests in class org.apache.pulsar.broker.service.ReplicatorTopicPoliciesTest created 22 new threads\nTests in class org.apache.pulsar.broker.service.OneWayReplicatorTest created 20 new threads\nTests in class org.apache.pulsar.broker.service.schema.SchemaServiceTest created 18 new threads\nTests in class org.apache.pulsar.broker.service.ReplicatorTlsTest created 18 new threads\nTests in class org.apache.pulsar.broker.service.ReplicatorRemoveClusterTest created 18 new threads\nTests in class org.apache.pulsar.broker.service.BacklogQuotaManagerTest created 17 new threads\nTests in class org.apache.pulsar.broker.service.schema.PartitionedTopicsSchemaTest created 16 new threads\nTests in class org.apache.pulsar.broker.loadbalance.SimpleBrokerStartTest created 13 new threads\nTests in class org.apache.pulsar.broker.loadbalance.LeaderElectionServiceTest created 13 new threads\nTests in class org.apache.pulsar.broker.loadbalance.impl.BundleSplitterTaskTest created 13 new threads\nTests in class org.apache.pulsar.broker.auth.AuthorizationTest created 12 new threads\nTests in class org.apache.pulsar.broker.service.persistent.PersistentStickyKeyDispatcherMultipleConsumersTest created 11 new threads\nTests in class org.apache.pulsar.broker.loadbalance.extensions.scheduler.UnloadSchedulerTest created 10 new threads\nTests in class org.apache.pulsar.broker.intercept.MangedLedgerInterceptorImplTest created 10 new threads\nTests in class org.apache.pulsar.broker.service.OpportunisticStripingTest created 9 new threads\nTests in class org.apache.pulsar.broker.service.ManagedLedgerCompressionTest created 9 new threads\nTests in class org.apache.pulsar.broker.loadbalance.extensions.AntiAffinityNamespaceGroupExtensionTest created 8 new threads\nTests in class org.apache.pulsar.broker.stats.ManagedCursorMetricsTest created 7 new threads\nTests in class org.apache.pulsar.broker.service.BusyWaitServiceTest created 7 new threads\nTests in class org.apache.pulsar.broker.loadbalance.extensions.BrokerRegistryTest created 7 new threads\nTests in class org.apache.pulsar.broker.web.WebServiceTest created 6 new threads\nTests in class org.apache.pulsar.broker.service.PersistentMessageFinderTest created 6 new threads\nTests in class org.apache.pulsar.broker.loadbalance.extensions.channel.ServiceUnitStateChannelTest created 6 new threads\nTests in class org.apache.pulsar.broker.BrokerAdditionalServletTest created 6 new threads\nTests in class org.apache.pulsar.broker.service.PersistentFailoverE2ETest created 5 new threads\nTests in class org.apache.pulsar.broker.service.NonPersistentTopicE2ETest created 5 new threads\nTests in class org.apache.pulsar.broker.service.InactiveTopicDeleteTest created 5 new threads\nTests in class org.apache.pulsar.broker.service.ExclusiveProducerTest created 5 new threads\"><pre class=\"notranslate\"><code class=\"notranslate\">\u276f grep -shEr \"created [0-9]+ new threads\" pulsar-broker | awk -F \"Summary: \" '{ print $2 }' | awk '{ print $(NF-2), $0}' |sort -rn | cut -f2- -d' '\nTests in class org.apache.pulsar.broker.service.ServerCnxTest created 849 new threads\nTests in class org.apache.pulsar.broker.service.ClusterMigrationTest created 743 new threads\nTests in class org.apache.pulsar.broker.transaction.AuthenticatedTransactionProducerConsumerTest created 100 new threads\nTests in class org.apache.pulsar.broker.loadbalance.LoadBalancerTest created 92 new threads\nTests in class org.apache.pulsar.broker.loadbalance.MultiBrokerLeaderElectionTest created 89 new threads\nTests in class org.apache.pulsar.broker.loadbalance.MultiBrokerLeaderElectionExpirationTest created 81 new threads\nTests in class org.apache.pulsar.broker.transaction.pendingack.PendingAckInMemoryDeleteTest created 78 new threads\nTests in class org.apache.pulsar.broker.transaction.buffer.TransactionStablePositionTest created 78 new threads\nTests in class org.apache.pulsar.broker.service.MessageCumulativeAckTest created 62 new threads\nTests in class org.apache.pulsar.broker.service.ReplicatorTest created 61 new threads\nTests in class org.apache.pulsar.broker.service.BrokerBookieIsolationTest created 51 new threads\nTests in class org.apache.pulsar.broker.loadbalance.SimpleLoadManagerImplTest created 51 new threads\nTests in class org.apache.pulsar.broker.loadbalance.ModularLoadManagerImplTest created 47 new threads\nTests in class org.apache.pulsar.broker.service.TopicOwnerTest created 40 new threads\nTests in class org.apache.pulsar.broker.service.BrokerServiceTest created 37 new threads\nTests in class org.apache.pulsar.broker.service.BrokerBkEnsemblesTests created 32 new threads\nTests in class org.apache.pulsar.broker.SLAMonitoringTest created 31 new threads\nTests in class org.apache.pulsar.broker.service.ReplicatorAdminTlsTest created 26 new threads\nTests in class org.apache.pulsar.broker.service.ReplicatorAdminTlsWithKeyStoreTest created 25 new threads\nTests in class org.apache.pulsar.broker.service.persistent.PersistentSubscriptionTest created 25 new threads\nTests in class org.apache.pulsar.broker.service.PeerReplicatorTest created 24 new threads\nTests in class org.apache.pulsar.broker.service.ReplicatorSubscriptionTest created 23 new threads\nTests in class org.apache.pulsar.broker.service.MaxMessageSizeTest created 23 new threads\nTests in class org.apache.pulsar.broker.service.ReplicatorTopicPoliciesTest created 22 new threads\nTests in class org.apache.pulsar.broker.service.OneWayReplicatorTest created 20 new threads\nTests in class org.apache.pulsar.broker.service.schema.SchemaServiceTest created 18 new threads\nTests in class org.apache.pulsar.broker.service.ReplicatorTlsTest created 18 new threads\nTests in class org.apache.pulsar.broker.service.ReplicatorRemoveClusterTest created 18 new threads\nTests in class org.apache.pulsar.broker.service.BacklogQuotaManagerTest created 17 new threads\nTests in class org.apache.pulsar.broker.service.schema.PartitionedTopicsSchemaTest created 16 new threads\nTests in class org.apache.pulsar.broker.loadbalance.SimpleBrokerStartTest created 13 new threads\nTests in class org.apache.pulsar.broker.loadbalance.LeaderElectionServiceTest created 13 new threads\nTests in class org.apache.pulsar.broker.loadbalance.impl.BundleSplitterTaskTest created 13 new threads\nTests in class org.apache.pulsar.broker.auth.AuthorizationTest created 12 new threads\nTests in class org.apache.pulsar.broker.service.persistent.PersistentStickyKeyDispatcherMultipleConsumersTest created 11 new threads\nTests in class org.apache.pulsar.broker.loadbalance.extensions.scheduler.UnloadSchedulerTest created 10 new threads\nTests in class org.apache.pulsar.broker.intercept.MangedLedgerInterceptorImplTest created 10 new threads\nTests in class org.apache.pulsar.broker.service.OpportunisticStripingTest created 9 new threads\nTests in class org.apache.pulsar.broker.service.ManagedLedgerCompressionTest created 9 new threads\nTests in class org.apache.pulsar.broker.loadbalance.extensions.AntiAffinityNamespaceGroupExtensionTest created 8 new threads\nTests in class org.apache.pulsar.broker.stats.ManagedCursorMetricsTest created 7 new threads\nTests in class org.apache.pulsar.broker.service.BusyWaitServiceTest created 7 new threads\nTests in class org.apache.pulsar.broker.loadbalance.extensions.BrokerRegistryTest created 7 new threads\nTests in class org.apache.pulsar.broker.web.WebServiceTest created 6 new threads\nTests in class org.apache.pulsar.broker.service.PersistentMessageFinderTest created 6 new threads\nTests in class org.apache.pulsar.broker.loadbalance.extensions.channel.ServiceUnitStateChannelTest created 6 new threads\nTests in class org.apache.pulsar.broker.BrokerAdditionalServletTest created 6 new threads\nTests in class org.apache.pulsar.broker.service.PersistentFailoverE2ETest created 5 new threads\nTests in class org.apache.pulsar.broker.service.NonPersistentTopicE2ETest created 5 new threads\nTests in class org.apache.pulsar.broker.service.InactiveTopicDeleteTest created 5 new threads\nTests in class org.apache.pulsar.broker.service.ExclusiveProducerTest created 5 new threads\n</code></pre></div>\n<p dir=\"auto\"><em>Originally posted by <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/lhotari/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/lhotari\">@lhotari</a> in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1779158637\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20673\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/20673/hovercard?comment_id=1633958559&amp;comment_type=issue_comment\" href=\"https://github.com/apache/pulsar/issues/20673#issuecomment-1633958559\">#20673 (comment)</a></em></p>\n<p dir=\"auto\">In some cases, it's possible that detected thread leaks are false positives.<br>\nOne reason for that is that broker shutdown is asynchronous in tests because of performance reasons. Broker shutdown can be made to wait for completion in tests by setting <code class=\"notranslate\">svcConfig.setBrokerShutdownTimeoutMs(5000L);</code></p>",
                "resourcePath": "/apache/pulsar/issues/20797",
                "createdAt": "2023-07-13T11:17:18Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve] [broker] Verify at least one URL is present for cluster creation",
        "url": "https://github.com/apache/pulsar/pull/20821",
        "resourcePath": "/apache/pulsar/pull/20821",
        "createdAt": "2023-07-17T08:46:21Z",
        "number": 20821,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApi2Test.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/policies/data/ClusterDataImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/test/java/org/apache/pulsar/common/policies/data/ClusterDataImplTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5VpSPx2gAoNTE5M2ZjNDJkZTA4ZDU4NWE0MjA5NGU1NGI1MjU3ZmZhZWQ4NGU5MQ",
                "url": "https://github.com/apache/pulsar/pull/20821/commits/5193fc42de08d585a42094e54b5257ffaed84e91"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 5638,
                "url": "https://github.com/streamnative/pulsar-archived/issues/5638",
                "title": "ISSUE-19866: Verify at least one URL is present for cluster creation",
                "bodyHTML": "<p dir=\"auto\">Original Issue: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1632645956\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19866\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/19866/hovercard\" href=\"https://github.com/apache/pulsar/issues/19866\">apache#19866</a></p>\n<hr>\n<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">With <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1522254755\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19151\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19151/hovercard\" href=\"https://github.com/apache/pulsar/pull/19151\">apache#19151</a> and <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1616756289\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19762\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19762/hovercard\" href=\"https://github.com/apache/pulsar/pull/19762\">apache#19762</a>, we verify that cluster urls are valid. It seems like we could also verify that there is at least one <code class=\"notranslate\">serviceUrl</code>/<code class=\"notranslate\">serviceUrlTls</code> and at least one <code class=\"notranslate\">brokerServiceUrl</code>/<code class=\"notranslate\">brokerServiceUrlTls</code> set.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Update the following code to add a check that some of those variables are set:</p>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/blob/e829672b84c15a596574da25205d32ae7b1abf4b/pulsar-common/src/main/java/org/apache/pulsar/common/policies/data/ClusterDataImpl.java#L412-L430\">https://github.com/apache/pulsar/blob/e829672b84c15a596574da25205d32ae7b1abf4b/pulsar-common/src/main/java/org/apache/pulsar/common/policies/data/ClusterDataImpl.java#L412-L430</a></p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/streamnative/pulsar-archived/issues/5638",
                "createdAt": "2023-03-20T19:06:35Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "good first issue"
                      }
                    },
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][build] Upgrade PyYaml version to 6.0.1",
        "url": "https://github.com/apache/pulsar/pull/20831",
        "resourcePath": "/apache/pulsar/pull/20831",
        "createdAt": "2023-07-18T09:08:41Z",
        "number": 20831,
        "mergeCommit": {
          "oid": "f5553a286d5a7795771c79f91f9ae8a412cf4683",
          "message": "[fix][build] Upgrade PyYaml version to 6.0.1 (#20831)",
          "commitUrl": "https://github.com/apache/pulsar/commit/f5553a286d5a7795771c79f91f9ae8a412cf4683",
          "parents": {
            "nodes": [
              {
                "oid": "1687244ff0e9d12dd0d864136f9b39623f0446bc",
                "message": "[improve][offload] Extend the offload policies to allow specifying more conf (#20804)\n\n### Motivation\r\n\r\nThe offload policies have limited the configurations for the offloaders.  That means if the offloader needs more configurations, we need to extend more fields in the OffloadPoliciesImpl. That doesn't make sense. We should make it extendable easily. Add a configuration map support to allow it to set more configurations."
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/pulsar/Dockerfile"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/pulsar/scripts/gen-yml-from-env.py"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Vw19L2gAoZjIxNjhhYmI4MWZjZjk4MjQxNjRiMWJlYzAzNjQzODMxMjFmZWU3YQ",
                "url": "https://github.com/apache/pulsar/pull/20831/commits/f2168abb81fcf9824164b1bec0364383121fee7a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20839,
                "url": "https://github.com/apache/pulsar/issues/20839",
                "title": "[Bug] CI Blocker `Build Pulsar docker image` failure",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master branch</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Currently,  CI <code class=\"notranslate\">Build Pulsar docker image</code> action is failing on master branch. with following PRs as examples.</p>\n<ul dir=\"auto\">\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1800788828\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20792\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20792/hovercard\" href=\"https://github.com/apache/pulsar/pull/20792\">#20792</a>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/5598232691/jobs/10242732078?pr=20792\">https://github.com/apache/pulsar/actions/runs/5598232691/jobs/10242732078?pr=20792</a></li>\n</ul>\n</li>\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1811077789\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20836\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20836/hovercard\" href=\"https://github.com/apache/pulsar/pull/20836\">#20836</a>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/5594652811/jobs/10232369328?pr=20836\">https://github.com/apache/pulsar/actions/runs/5594652811/jobs/10232369328?pr=20836</a></li>\n</ul>\n</li>\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1811425286\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20837\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20837/hovercard\" href=\"https://github.com/apache/pulsar/pull/20837\">#20837</a>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/5597413965/jobs/10235999625?pr=20837\">https://github.com/apache/pulsar/actions/runs/5597413965/jobs/10235999625?pr=20837</a></li>\n</ul>\n</li>\n</ul>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Clean CI Pass.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Error log (Check above actions link for more)</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error:  Failed to execute goal io.fabric8:docker-maven-plugin:0.42.1:build (default) on project pulsar-docker-image: Unable to build image [apachepulsar/pulsar] : &quot;The command '/bin/sh -c pip3 install pyyaml==5.4.1' returned a non-zero code: 1&quot; -&gt; [Help 1]\nError:  \nError:  To see the full stack trace of the errors, re-run Maven with the -e switch.\nError:  Re-run Maven using the -X switch to enable full debug logging.\nError:  \nError:  For more information about the errors and possible solutions, please read the following articles:\nError:  [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\nError:  \nError:  After correcting the problems, you can resume the build with the command\nError:    mvn &lt;args&gt; -rf :pulsar-docker-image\nError: Process completed with exit code 1.\"><pre lang=\"log\" class=\"notranslate\"><code class=\"notranslate\">Error:  Failed to execute goal io.fabric8:docker-maven-plugin:0.42.1:build (default) on project pulsar-docker-image: Unable to build image [apachepulsar/pulsar] : \"The command '/bin/sh -c pip3 install pyyaml==5.4.1' returned a non-zero code: 1\" -&gt; [Help 1]\nError:  \nError:  To see the full stack trace of the errors, re-run Maven with the -e switch.\nError:  Re-run Maven using the -X switch to enable full debug logging.\nError:  \nError:  For more information about the errors and possible solutions, please read the following articles:\nError:  [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\nError:  \nError:  After correcting the problems, you can resume the build with the command\nError:    mvn &lt;args&gt; -rf :pulsar-docker-image\nError: Process completed with exit code 1.\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20839",
                "createdAt": "2023-07-19T14:59:46Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] Upgrade to pyyaml 6.0.1 in docker image",
        "url": "https://github.com/apache/pulsar/pull/20842",
        "resourcePath": "/apache/pulsar/pull/20842",
        "createdAt": "2023-07-20T05:11:21Z",
        "number": 20842,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/pulsar/Dockerfile"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5V9T5y2gAoZDExZmY5MTIxN2IxNDg5MDc2NTcxNjY4YTY4NTVhOWIyMTUwYjllNw",
                "url": "https://github.com/apache/pulsar/pull/20842/commits/d11ff91217b1489076571668a6855a9b2150b9e7"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20839,
                "url": "https://github.com/apache/pulsar/issues/20839",
                "title": "[Bug] CI Blocker `Build Pulsar docker image` failure",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master branch</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Currently,  CI <code class=\"notranslate\">Build Pulsar docker image</code> action is failing on master branch. with following PRs as examples.</p>\n<ul dir=\"auto\">\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1800788828\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20792\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20792/hovercard\" href=\"https://github.com/apache/pulsar/pull/20792\">#20792</a>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/5598232691/jobs/10242732078?pr=20792\">https://github.com/apache/pulsar/actions/runs/5598232691/jobs/10242732078?pr=20792</a></li>\n</ul>\n</li>\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1811077789\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20836\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20836/hovercard\" href=\"https://github.com/apache/pulsar/pull/20836\">#20836</a>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/5594652811/jobs/10232369328?pr=20836\">https://github.com/apache/pulsar/actions/runs/5594652811/jobs/10232369328?pr=20836</a></li>\n</ul>\n</li>\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1811425286\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20837\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20837/hovercard\" href=\"https://github.com/apache/pulsar/pull/20837\">#20837</a>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/5597413965/jobs/10235999625?pr=20837\">https://github.com/apache/pulsar/actions/runs/5597413965/jobs/10235999625?pr=20837</a></li>\n</ul>\n</li>\n</ul>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Clean CI Pass.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Error log (Check above actions link for more)</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error:  Failed to execute goal io.fabric8:docker-maven-plugin:0.42.1:build (default) on project pulsar-docker-image: Unable to build image [apachepulsar/pulsar] : &quot;The command '/bin/sh -c pip3 install pyyaml==5.4.1' returned a non-zero code: 1&quot; -&gt; [Help 1]\nError:  \nError:  To see the full stack trace of the errors, re-run Maven with the -e switch.\nError:  Re-run Maven using the -X switch to enable full debug logging.\nError:  \nError:  For more information about the errors and possible solutions, please read the following articles:\nError:  [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\nError:  \nError:  After correcting the problems, you can resume the build with the command\nError:    mvn &lt;args&gt; -rf :pulsar-docker-image\nError: Process completed with exit code 1.\"><pre lang=\"log\" class=\"notranslate\"><code class=\"notranslate\">Error:  Failed to execute goal io.fabric8:docker-maven-plugin:0.42.1:build (default) on project pulsar-docker-image: Unable to build image [apachepulsar/pulsar] : \"The command '/bin/sh -c pip3 install pyyaml==5.4.1' returned a non-zero code: 1\" -&gt; [Help 1]\nError:  \nError:  To see the full stack trace of the errors, re-run Maven with the -e switch.\nError:  Re-run Maven using the -X switch to enable full debug logging.\nError:  \nError:  For more information about the errors and possible solutions, please read the following articles:\nError:  [Help 1] http://cwiki.apache.org/confluence/display/MAVEN/MojoExecutionException\nError:  \nError:  After correcting the problems, you can resume the build with the command\nError:    mvn &lt;args&gt; -rf :pulsar-docker-image\nError: Process completed with exit code 1.\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20839",
                "createdAt": "2023-07-19T14:59:46Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[feat][fn] Add option to merge secrets into config for sink/source",
        "url": "https://github.com/apache/pulsar/pull/20863",
        "resourcePath": "/apache/pulsar/pull/20863",
        "createdAt": "2023-07-24T22:29:34Z",
        "number": 20863,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/ContextImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/InstanceConfig.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/JavaInstanceRunnable.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/test/java/org/apache/pulsar/functions/instance/JavaInstanceRunnableTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/JavaInstanceStarter.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/RuntimeUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/worker/WorkerConfig.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/test/java/org/apache/pulsar/functions/runtime/kubernetes/KubernetesRuntimeTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/test/java/org/apache/pulsar/functions/runtime/process/ProcessRuntimeTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/FunctionActioner.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5WRn7L2gAoNzllYmQxZWYyODJhYzhjYTJkY2NhZmFlMjcyOTZiOWVmYzM2OTJhYg",
                "url": "https://github.com/apache/pulsar/pull/20863/commits/79ebd1ef282ac8ca2dccafae27296b9efc3692ab"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20862,
                "url": "https://github.com/apache/pulsar/issues/20862",
                "title": "Generic Secret Injection for Connector Configuration",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Provide a generic way to inject secrets into the <code class=\"notranslate\">config</code> map for connectors without requiring a rewrite of each source/sink and without leaking them on the command line used to start the connector.</p>\n<h4 dir=\"auto\">Context</h4>\n<p dir=\"auto\">The recent <a href=\"https://github.com/apache/pulsar/wiki/CVE%E2%80%902023%E2%80%9037579\">CVE-2023-37579</a> resulted in the potential to leak source/sink credentials because some credentials are stored in connector configuration instead of in the connector's <code class=\"notranslate\">secrets</code> map.</p>\n<p dir=\"auto\">The current way to configure secrets for connectors requires each source or sink to implement correct secret handling by either getting a secret from the <a href=\"https://github.com/apache/pulsar/blob/82237d3684fe506bcb6426b3b23f413422e6e4fb/pulsar-functions/secrets/src/main/java/org/apache/pulsar/functions/secretsprovider/SecretsProvider.java#L28C1-L42\">SecretsProvider</a> or by using <a href=\"https://github.com/apache/pulsar/blob/82237d3684fe506bcb6426b3b23f413422e6e4fb/pulsar-io/core/src/main/java/org/apache/pulsar/io/core/annotations/FieldDoc.java#L28-L66\">custom annotations</a> and this <a href=\"https://github.com/apache/pulsar/blob/674655347da95305cf671f0696f113dcca88b44d/pulsar-io/common/src/main/java/org/apache/pulsar/io/common/IOConfigUtils.java#L38-L103\">special configuration loader</a>. This implementation assumes that users have a <code class=\"notranslate\">Configuration</code> class that can be annotated, but that is not always the case because the connector framework passes a configuration map of <code class=\"notranslate\">Map&lt;String, Object&gt;</code>. Note that the current mechanism is not well documented and is not used by all of the official Apache Pulsar connectors.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">I propose that we materialize and merge all secrets from the <code class=\"notranslate\">secrets</code> map into the <code class=\"notranslate\">config</code> that is passed to the connector when we call <code class=\"notranslate\">Source#open</code> or <code class=\"notranslate\">Sink#open</code>. Materializing the secrets would look like:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    private void mergeSecretsIntoConfigs(Map&lt;String, Object&gt; secrets, Map&lt;String, Object&gt; configs) {\n        for (Map.Entry&lt;String, Object&gt; entry : secrets.entrySet()) {\n            Object oldValue = configs.put(entry.getKey(),\n                    secretsProvider.provideSecret(entry.getKey(), entry.getValue()));\n            if (oldValue != null) {\n                log.warn(&quot;Config value for {} replaced by secret's configuration value.&quot;, entry.getKey());\n            }\n        }\n    }\"><pre class=\"notranslate\">    <span class=\"pl-k\">private</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">mergeSecretsIntoConfigs</span>(<span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt; <span class=\"pl-s1\">secrets</span>, <span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt; <span class=\"pl-s1\">configs</span>) {\n        <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">Map</span>.<span class=\"pl-smi\">Entry</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt; <span class=\"pl-s1\">entry</span> : <span class=\"pl-s1\">secrets</span>.<span class=\"pl-en\">entrySet</span>()) {\n            <span class=\"pl-smi\">Object</span> <span class=\"pl-s1\">oldValue</span> = <span class=\"pl-s1\">configs</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getKey</span>(),\n                    <span class=\"pl-s1\">secretsProvider</span>.<span class=\"pl-en\">provideSecret</span>(<span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getKey</span>(), <span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getValue</span>()));\n            <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">oldValue</span> != <span class=\"pl-c1\">null</span>) {\n                <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">warn</span>(<span class=\"pl-s\">\"Config value for {} replaced by secret's configuration value.\"</span>, <span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getKey</span>());\n            }\n        }\n    }</pre></div>\n<p dir=\"auto\">They key benefit to this solution is that it will work for all sinks and sources, and it will leverage the <code class=\"notranslate\">SecretsProvider</code> interface to materialize the secrets.</p>\n<p dir=\"auto\">This will benefit all deployment methods, but is most helpful for the kubernetes runtime.</p>\n<h4 dir=\"auto\">Trade off</h4>\n<p dir=\"auto\"><del>The one drawback to this solution is that it could theoretically break existing connector configuration. However, I think this is very unlikely because it only breaks when a configuration and a secret are passed with the same <code class=\"notranslate\">key</code>.</del></p>\n<p dir=\"auto\">I was able to resolve this trade off in two ways. First, I put this feature behind a feature flag. Second, I replaced <code class=\"notranslate\">put</code> with <code class=\"notranslate\">putIfAbsent</code> in the merge logic so that the existing configuration has precedence.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\">We could consider interpreting configuration values that start with a well known prefix, like <code class=\"notranslate\">env:</code>, as values that need to be read from the environment. The primary drawback to this solution is that there is not an easy way to configure the function at this point in the code, which means that</p>\n<p dir=\"auto\">This solution would look something like adding this code block</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    // Replace environment variable pointers with their environment variable values\n    for (Map.Entry&lt;String, Object&gt; entry : config.entrySet()) {\n        if (entry.getValue() instanceof String &amp;&amp; ((String) entry.getValue()).toLowerCase().startsWith(&quot;env:&quot;)) {\n            String envVariableName = ((String) entry.getValue()).substring(&quot;env:&quot;.length());\n            String envVariableValue = System.getenv(envVariableName);\n            entry.setValue(envVariableValue);\n        }\n    }\"><pre class=\"notranslate\">    <span class=\"pl-c\">// Replace environment variable pointers with their environment variable values</span>\n    <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">Map</span>.<span class=\"pl-smi\">Entry</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt; <span class=\"pl-s1\">entry</span> : <span class=\"pl-s1\">config</span>.<span class=\"pl-en\">entrySet</span>()) {\n        <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getValue</span>() <span class=\"pl-k\">instanceof</span> <span class=\"pl-smi\">String</span> &amp;&amp; ((<span class=\"pl-smi\">String</span>) <span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getValue</span>()).<span class=\"pl-en\">toLowerCase</span>().<span class=\"pl-en\">startsWith</span>(<span class=\"pl-s\">\"env:\"</span>)) {\n            <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">envVariableName</span> = ((<span class=\"pl-smi\">String</span>) <span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getValue</span>()).<span class=\"pl-en\">substring</span>(<span class=\"pl-s\">\"env:\"</span>.<span class=\"pl-en\">length</span>());\n            <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">envVariableValue</span> = <span class=\"pl-smi\">System</span>.<span class=\"pl-en\">getenv</span>(<span class=\"pl-s1\">envVariableName</span>);\n            <span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">setValue</span>(<span class=\"pl-s1\">envVariableValue</span>);\n        }\n    }</pre></div>\n<p dir=\"auto\">to this method</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/f7c0b3c49c9ad8c28d0b00aa30d727850eb8bc04/pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/JavaInstanceRunnable.java#L884-L929\">pulsar/pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/JavaInstanceRunnable.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 884 to 929\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/f7c0b3c49c9ad8c28d0b00aa30d727850eb8bc04\">f7c0b3c</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L884\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"884\"></td>\n          <td id=\"LC884\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt; <span class=\"pl-en\">parseComponentConfig</span>(<span class=\"pl-smi\">String</span> <span class=\"pl-s1\">connectorConfigs</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L885\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"885\"></td>\n          <td id=\"LC885\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                                 <span class=\"pl-smi\">InstanceConfig</span> <span class=\"pl-s1\">instanceConfig</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L886\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"886\"></td>\n          <td id=\"LC886\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                                 <span class=\"pl-smi\">ClassLoader</span> <span class=\"pl-s1\">componentClassLoader</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L887\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"887\"></td>\n          <td id=\"LC887\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                                 <span class=\"pl-smi\">org</span>.<span class=\"pl-smi\">apache</span>.<span class=\"pl-smi\">pulsar</span>.<span class=\"pl-smi\">functions</span>.<span class=\"pl-smi\">proto</span>.<span class=\"pl-smi\">Function</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L888\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"888\"></td>\n          <td id=\"LC888\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                                         .<span class=\"pl-smi\">FunctionDetails</span>.<span class=\"pl-smi\">ComponentType</span> <span class=\"pl-s1\">componentType</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L889\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"889\"></td>\n          <td id=\"LC889\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">IOException</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L890\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"890\"></td>\n          <td id=\"LC890\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">final</span> <span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt; <span class=\"pl-s1\">config</span> = <span class=\"pl-smi\">ObjectMapperFactory</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L891\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"891\"></td>\n          <td id=\"LC891\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             .<span class=\"pl-en\">getMapper</span>() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L892\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"892\"></td>\n          <td id=\"LC892\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             .<span class=\"pl-en\">reader</span>() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L893\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"893\"></td>\n          <td id=\"LC893\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             .<span class=\"pl-en\">forType</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">TypeReference</span>&lt;<span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt;&gt;() {}) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L894\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"894\"></td>\n          <td id=\"LC894\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             .<span class=\"pl-en\">readValue</span>(<span class=\"pl-s1\">connectorConfigs</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L895\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"895\"></td>\n          <td id=\"LC895\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">instanceConfig</span>.<span class=\"pl-en\">isIgnoreUnknownConfigFields</span>() &amp;&amp; <span class=\"pl-s1\">componentClassLoader</span> <span class=\"pl-k\">instanceof</span> <span class=\"pl-smi\">NarClassLoader</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L896\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"896\"></td>\n          <td id=\"LC896\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">configClassName</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L897\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"897\"></td>\n          <td id=\"LC897\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">componentType</span> == <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-s1\">functions</span>.<span class=\"pl-s1\">proto</span>.<span class=\"pl-s1\">Function</span>.<span class=\"pl-s1\">FunctionDetails</span>.<span class=\"pl-s1\">ComponentType</span>.<span class=\"pl-c1\">SOURCE</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L898\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"898\"></td>\n          <td id=\"LC898\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">configClassName</span> = <span class=\"pl-smi\">ConnectorUtils</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L899\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"899\"></td>\n          <td id=\"LC899\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     .<span class=\"pl-en\">getConnectorDefinition</span>((<span class=\"pl-smi\">NarClassLoader</span>) <span class=\"pl-s1\">componentClassLoader</span>).<span class=\"pl-en\">getSourceConfigClass</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L900\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"900\"></td>\n          <td id=\"LC900\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">componentType</span> == <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-s1\">functions</span>.<span class=\"pl-s1\">proto</span>.<span class=\"pl-s1\">Function</span>.<span class=\"pl-s1\">FunctionDetails</span>.<span class=\"pl-s1\">ComponentType</span>.<span class=\"pl-c1\">SINK</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L901\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"901\"></td>\n          <td id=\"LC901\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">configClassName</span> =  <span class=\"pl-smi\">ConnectorUtils</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L902\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"902\"></td>\n          <td id=\"LC902\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     .<span class=\"pl-en\">getConnectorDefinition</span>((<span class=\"pl-smi\">NarClassLoader</span>) <span class=\"pl-s1\">componentClassLoader</span>).<span class=\"pl-en\">getSinkConfigClass</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L903\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"903\"></td>\n          <td id=\"LC903\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L904\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"904\"></td>\n          <td id=\"LC904\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">return</span> <span class=\"pl-s1\">config</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L905\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"905\"></td>\n          <td id=\"LC905\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L906\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"906\"></td>\n          <td id=\"LC906\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">configClassName</span> != <span class=\"pl-c1\">null</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L907\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"907\"></td>\n          <td id=\"LC907\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L908\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"908\"></td>\n          <td id=\"LC908\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-smi\">Class</span>&lt;?&gt; <span class=\"pl-s1\">configClass</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L909\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"909\"></td>\n          <td id=\"LC909\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">try</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L910\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"910\"></td>\n          <td id=\"LC910\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">configClass</span> = <span class=\"pl-smi\">Class</span>.<span class=\"pl-en\">forName</span>(<span class=\"pl-s1\">configClassName</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L911\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"911\"></td>\n          <td id=\"LC911\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-c1\">true</span>, <span class=\"pl-smi\">Thread</span>.<span class=\"pl-en\">currentThread</span>().<span class=\"pl-en\">getContextClassLoader</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L912\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"912\"></td>\n          <td id=\"LC912\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">ClassNotFoundException</span> <span class=\"pl-s1\">e</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L913\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"913\"></td>\n          <td id=\"LC913\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">throw</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">RuntimeException</span>(<span class=\"pl-s\">\"Config class not found: \"</span> + <span class=\"pl-s1\">configClassName</span>, <span class=\"pl-s1\">e</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L914\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"914\"></td>\n          <td id=\"LC914\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L915\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"915\"></td>\n          <td id=\"LC915\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">final</span> <span class=\"pl-smi\">List</span>&lt;<span class=\"pl-smi\">String</span>&gt; <span class=\"pl-s1\">allFields</span> = <span class=\"pl-smi\">BeanPropertiesReader</span>.<span class=\"pl-en\">getBeanProperties</span>(<span class=\"pl-s1\">configClass</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L916\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"916\"></td>\n          <td id=\"LC916\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L917\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"917\"></td>\n          <td id=\"LC917\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">String</span> <span class=\"pl-s1\">s</span> : <span class=\"pl-s1\">config</span>.<span class=\"pl-en\">keySet</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L918\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"918\"></td>\n          <td id=\"LC918\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">if</span> (!<span class=\"pl-s1\">allFields</span>.<span class=\"pl-en\">contains</span>(<span class=\"pl-s1\">s</span>)) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L919\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"919\"></td>\n          <td id=\"LC919\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">error</span>(<span class=\"pl-s\">\"Field '{}' not defined in the {} configuration {}, the field will be ignored\"</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L920\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"920\"></td>\n          <td id=\"LC920\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-s1\">s</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L921\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"921\"></td>\n          <td id=\"LC921\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-s1\">componentType</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L922\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"922\"></td>\n          <td id=\"LC922\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-s1\">configClass</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L923\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"923\"></td>\n          <td id=\"LC923\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-s1\">config</span>.<span class=\"pl-en\">remove</span>(<span class=\"pl-s1\">s</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L924\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"924\"></td>\n          <td id=\"LC924\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L925\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"925\"></td>\n          <td id=\"LC925\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L926\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"926\"></td>\n          <td id=\"LC926\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L927\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"927\"></td>\n          <td id=\"LC927\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L928\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"928\"></td>\n          <td id=\"LC928\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-s1\">config</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L929\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"929\"></td>\n          <td id=\"LC929\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20862",
                "createdAt": "2023-07-24T17:22:11Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "area/connector"
                      }
                    },
                    {
                      "node": {
                        "name": "area/security"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][cli] Better error message for pulsar-admin schema upload",
        "url": "https://github.com/apache/pulsar/pull/20876",
        "resourcePath": "/apache/pulsar/pull/20876",
        "createdAt": "2023-07-26T01:47:33Z",
        "number": 20876,
        "mergeCommit": {
          "oid": "b12dbe782d82d859a68657f0464ba83bd04cb63e",
          "message": "[improve][cli] Better error message for pulsar-admin schema upload (#20876)\n\nSigned-off-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/b12dbe782d82d859a68657f0464ba83bd04cb63e",
          "parents": {
            "nodes": [
              {
                "oid": "3f637680bbbc268d4801172d3212279ace38c4d4",
                "message": "[fix][broker] Avoid infinite bundle unloading (#20822)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdSchemas.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5WZE0z2gAoN2Y1MmFmNGVkZTY4NjUzODY4NDA1MzM5MzQ0Y2ZkM2EwMTdlMDBiYg",
                "url": "https://github.com/apache/pulsar/pull/20876/commits/7f52af4ede68653868405339344cfd3a017e00bb"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 10578,
                "url": "https://github.com/apache/pulsar/issues/10578",
                "title": "Relative paths do not work for pulsar-admin schema upload --filename flag",
                "bodyHTML": "<p dir=\"auto\"><strong>Describe the bug</strong></p>\n<p dir=\"auto\">Currently, when using the <code class=\"notranslate\">pulsar-admin schemas upload</code> command to upload a schema via a file with the <code class=\"notranslate\">--filename</code> flag, an exception is thrown because the file cannot be found.</p>\n<p dir=\"auto\"><strong>To Reproduce</strong></p>\n<p dir=\"auto\">Steps to reproduce the behavior:</p>\n<ol dir=\"auto\">\n<li>Create a test topic</li>\n<li>Create a json file based off \"Example 1\" from the <a href=\"https://pulsar.apache.org/docs/en/schema-manage/#upload-a-schema\" rel=\"nofollow\">schema management docs</a></li>\n<li><code class=\"notranslate\">cd</code> into the directory where the new json file exists</li>\n<li>run <code class=\"notranslate\">&lt;path-to-pulsar-bin&gt;/pulsar-admin schemas upload persistent://&lt;tenant&gt;/&lt;namespace&gt;/&lt;topic&gt;/ --filename ./testSchema.json</code></li>\n<li>See error</li>\n<li>Confirm that this works with an absolute path instead by running <code class=\"notranslate\">&lt;path-to-pulsar-bin&gt;/pulsar-admin schemas upload persistent://&lt;tenant&gt;/&lt;namespace&gt;/&lt;topic&gt;/ --filename /absolute/path/to/testSchema.json</code></li>\n</ol>\n<p dir=\"auto\"><strong>Expected behavior</strong></p>\n<p dir=\"auto\"><strong>Ideal</strong>: When passing in a relative path for a filename, it should accept the filename<br>\n<strong>Alternative</strong>: provide a graceful error encouraging the user to use absolute paths</p>\n<p dir=\"auto\"><strong>Example</strong></p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ pulsar-admin schemas upload persistent://test-tenant/default/test-topic --filename ./testSchema.json\njava.io.FileNotFoundException: ./testSchema.json (No such file or directory)\n\tat java.base/java.io.FileInputStream.open0(Native Method)\n\tat java.base/java.io.FileInputStream.open(FileInputStream.java:211)\n\tat java.base/java.io.FileInputStream.&lt;init&gt;(FileInputStream.java:153)\n\tat com.fasterxml.jackson.core.JsonFactory.createParser(JsonFactory.java:916)\n\tat com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3299)\n\tat org.apache.pulsar.admin.cli.CmdSchemas$UploadSchema.run(CmdSchemas.java:86)\n\tat org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:76)\n\tat org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:246)\n\tat org.apache.pulsar.admin.cli.PulsarAdminTool.main(PulsarAdminTool.java:288)\"><pre class=\"notranslate\">$ pulsar-admin schemas upload persistent://test-tenant/default/test-topic --filename ./testSchema.json\njava.io.FileNotFoundException: ./testSchema.json (No such file or directory)\n\tat java.base/java.io.FileInputStream.open0(Native Method)\n\tat java.base/java.io.FileInputStream.open(FileInputStream.java:211)\n\tat java.base/java.io.FileInputStream.<span class=\"pl-k\">&lt;</span>init<span class=\"pl-s\"><span class=\"pl-pds\">&gt;(</span>FileInputStream.java:153<span class=\"pl-pds\">)</span></span>\n\tat com.fasterxml.jackson.core.JsonFactory.createParser(JsonFactory.java:916)\n\tat com.fasterxml.jackson.databind.ObjectMapper.readValue(ObjectMapper.java:3299)\n\tat org.apache.pulsar.admin.cli.CmdSchemas<span class=\"pl-smi\">$UploadSchema</span>.run(CmdSchemas.java:86)\n\tat org.apache.pulsar.admin.cli.CmdBase.run(CmdBase.java:76)\n\tat org.apache.pulsar.admin.cli.PulsarAdminTool.run(PulsarAdminTool.java:246)\n\tat org.apache.pulsar.admin.cli.PulsarAdminTool.main(PulsarAdminTool.java:288)</pre></div>\n<p dir=\"auto\"><strong>Desktop (please complete the following information):</strong></p>\n<ul dir=\"auto\">\n<li>OS: Mac OS Catalina 10.15.7 (intel)</li>\n<li>Pulsar version: How do I check this? see issue: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"891152897\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/10577\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/10577/hovercard\" href=\"https://github.com/apache/pulsar/issues/10577\">#10577</a></li>\n</ul>\n<p dir=\"auto\"><strong>Additional context</strong></p>\n<p dir=\"auto\">At least one closed issue addresses this same concern with a separate subcommand, so this might suggest there's a larger issue, or that this somehow was missed while addressing this other issue:</p>\n<p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"452446263\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/4481\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/4481/hovercard\" href=\"https://github.com/apache/pulsar/issues/4481\">#4481</a></p>",
                "resourcePath": "/apache/pulsar/issues/10578",
                "createdAt": "2021-05-13T16:05:04Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "lifecycle/stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[pip][design] PIP 289: Secure Pulsar Connector Configuration",
        "url": "https://github.com/apache/pulsar/pull/20903",
        "resourcePath": "/apache/pulsar/pull/20903",
        "createdAt": "2023-07-28T21:50:03Z",
        "number": 20903,
        "mergeCommit": {
          "oid": "d01471315ad6f7b36daf56bc2c89dd0fddc6a3a5",
          "message": "[pip][design] PIP 289: Secure Pulsar Connector Configuration (#20903)",
          "commitUrl": "https://github.com/apache/pulsar/commit/d01471315ad6f7b36daf56bc2c89dd0fddc6a3a5",
          "parents": {
            "nodes": [
              {
                "oid": "d6734b76b14aedd800116218b02ae607b93df9d1",
                "message": "[fix][io] Update test certs for Elasticsearch (#21001)\n\nFixes: #20997 \r\n\r\n### Motivation\r\n\r\nUpdate the expired certs to get tests passing.\r\n\r\n### Modifications\r\n\r\n* Update all certs. See `README.md` in files for detailed steps.\r\n\r\n### Verifying this change\r\n\r\nThis change is covered by tests.\r\n\r\n### Documentation\r\n\r\n- [x] `doc-not-needed`"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": "pip/pip-289.md"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5WsTne2gAoZmUzNDdlNmYzYTQxNzlkNTU1YzUzMWQzOWQwMDdmNGRlNGY0NjUxNw",
                "url": "https://github.com/apache/pulsar/pull/20903/commits/fe347e6f3a4179d555c531d39d007f4de4f46517"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20862,
                "url": "https://github.com/apache/pulsar/issues/20862",
                "title": "Generic Secret Injection for Connector Configuration",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Provide a generic way to inject secrets into the <code class=\"notranslate\">config</code> map for connectors without requiring a rewrite of each source/sink and without leaking them on the command line used to start the connector.</p>\n<h4 dir=\"auto\">Context</h4>\n<p dir=\"auto\">The recent <a href=\"https://github.com/apache/pulsar/wiki/CVE%E2%80%902023%E2%80%9037579\">CVE-2023-37579</a> resulted in the potential to leak source/sink credentials because some credentials are stored in connector configuration instead of in the connector's <code class=\"notranslate\">secrets</code> map.</p>\n<p dir=\"auto\">The current way to configure secrets for connectors requires each source or sink to implement correct secret handling by either getting a secret from the <a href=\"https://github.com/apache/pulsar/blob/82237d3684fe506bcb6426b3b23f413422e6e4fb/pulsar-functions/secrets/src/main/java/org/apache/pulsar/functions/secretsprovider/SecretsProvider.java#L28C1-L42\">SecretsProvider</a> or by using <a href=\"https://github.com/apache/pulsar/blob/82237d3684fe506bcb6426b3b23f413422e6e4fb/pulsar-io/core/src/main/java/org/apache/pulsar/io/core/annotations/FieldDoc.java#L28-L66\">custom annotations</a> and this <a href=\"https://github.com/apache/pulsar/blob/674655347da95305cf671f0696f113dcca88b44d/pulsar-io/common/src/main/java/org/apache/pulsar/io/common/IOConfigUtils.java#L38-L103\">special configuration loader</a>. This implementation assumes that users have a <code class=\"notranslate\">Configuration</code> class that can be annotated, but that is not always the case because the connector framework passes a configuration map of <code class=\"notranslate\">Map&lt;String, Object&gt;</code>. Note that the current mechanism is not well documented and is not used by all of the official Apache Pulsar connectors.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">I propose that we materialize and merge all secrets from the <code class=\"notranslate\">secrets</code> map into the <code class=\"notranslate\">config</code> that is passed to the connector when we call <code class=\"notranslate\">Source#open</code> or <code class=\"notranslate\">Sink#open</code>. Materializing the secrets would look like:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    private void mergeSecretsIntoConfigs(Map&lt;String, Object&gt; secrets, Map&lt;String, Object&gt; configs) {\n        for (Map.Entry&lt;String, Object&gt; entry : secrets.entrySet()) {\n            Object oldValue = configs.put(entry.getKey(),\n                    secretsProvider.provideSecret(entry.getKey(), entry.getValue()));\n            if (oldValue != null) {\n                log.warn(&quot;Config value for {} replaced by secret's configuration value.&quot;, entry.getKey());\n            }\n        }\n    }\"><pre class=\"notranslate\">    <span class=\"pl-k\">private</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">mergeSecretsIntoConfigs</span>(<span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt; <span class=\"pl-s1\">secrets</span>, <span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt; <span class=\"pl-s1\">configs</span>) {\n        <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">Map</span>.<span class=\"pl-smi\">Entry</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt; <span class=\"pl-s1\">entry</span> : <span class=\"pl-s1\">secrets</span>.<span class=\"pl-en\">entrySet</span>()) {\n            <span class=\"pl-smi\">Object</span> <span class=\"pl-s1\">oldValue</span> = <span class=\"pl-s1\">configs</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getKey</span>(),\n                    <span class=\"pl-s1\">secretsProvider</span>.<span class=\"pl-en\">provideSecret</span>(<span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getKey</span>(), <span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getValue</span>()));\n            <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">oldValue</span> != <span class=\"pl-c1\">null</span>) {\n                <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">warn</span>(<span class=\"pl-s\">\"Config value for {} replaced by secret's configuration value.\"</span>, <span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getKey</span>());\n            }\n        }\n    }</pre></div>\n<p dir=\"auto\">They key benefit to this solution is that it will work for all sinks and sources, and it will leverage the <code class=\"notranslate\">SecretsProvider</code> interface to materialize the secrets.</p>\n<p dir=\"auto\">This will benefit all deployment methods, but is most helpful for the kubernetes runtime.</p>\n<h4 dir=\"auto\">Trade off</h4>\n<p dir=\"auto\"><del>The one drawback to this solution is that it could theoretically break existing connector configuration. However, I think this is very unlikely because it only breaks when a configuration and a secret are passed with the same <code class=\"notranslate\">key</code>.</del></p>\n<p dir=\"auto\">I was able to resolve this trade off in two ways. First, I put this feature behind a feature flag. Second, I replaced <code class=\"notranslate\">put</code> with <code class=\"notranslate\">putIfAbsent</code> in the merge logic so that the existing configuration has precedence.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\">We could consider interpreting configuration values that start with a well known prefix, like <code class=\"notranslate\">env:</code>, as values that need to be read from the environment. The primary drawback to this solution is that there is not an easy way to configure the function at this point in the code, which means that</p>\n<p dir=\"auto\">This solution would look something like adding this code block</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    // Replace environment variable pointers with their environment variable values\n    for (Map.Entry&lt;String, Object&gt; entry : config.entrySet()) {\n        if (entry.getValue() instanceof String &amp;&amp; ((String) entry.getValue()).toLowerCase().startsWith(&quot;env:&quot;)) {\n            String envVariableName = ((String) entry.getValue()).substring(&quot;env:&quot;.length());\n            String envVariableValue = System.getenv(envVariableName);\n            entry.setValue(envVariableValue);\n        }\n    }\"><pre class=\"notranslate\">    <span class=\"pl-c\">// Replace environment variable pointers with their environment variable values</span>\n    <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">Map</span>.<span class=\"pl-smi\">Entry</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt; <span class=\"pl-s1\">entry</span> : <span class=\"pl-s1\">config</span>.<span class=\"pl-en\">entrySet</span>()) {\n        <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getValue</span>() <span class=\"pl-k\">instanceof</span> <span class=\"pl-smi\">String</span> &amp;&amp; ((<span class=\"pl-smi\">String</span>) <span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getValue</span>()).<span class=\"pl-en\">toLowerCase</span>().<span class=\"pl-en\">startsWith</span>(<span class=\"pl-s\">\"env:\"</span>)) {\n            <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">envVariableName</span> = ((<span class=\"pl-smi\">String</span>) <span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getValue</span>()).<span class=\"pl-en\">substring</span>(<span class=\"pl-s\">\"env:\"</span>.<span class=\"pl-en\">length</span>());\n            <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">envVariableValue</span> = <span class=\"pl-smi\">System</span>.<span class=\"pl-en\">getenv</span>(<span class=\"pl-s1\">envVariableName</span>);\n            <span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">setValue</span>(<span class=\"pl-s1\">envVariableValue</span>);\n        }\n    }</pre></div>\n<p dir=\"auto\">to this method</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/f7c0b3c49c9ad8c28d0b00aa30d727850eb8bc04/pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/JavaInstanceRunnable.java#L884-L929\">pulsar/pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/JavaInstanceRunnable.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 884 to 929\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/f7c0b3c49c9ad8c28d0b00aa30d727850eb8bc04\">f7c0b3c</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L884\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"884\"></td>\n          <td id=\"LC884\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt; <span class=\"pl-en\">parseComponentConfig</span>(<span class=\"pl-smi\">String</span> <span class=\"pl-s1\">connectorConfigs</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L885\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"885\"></td>\n          <td id=\"LC885\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                                 <span class=\"pl-smi\">InstanceConfig</span> <span class=\"pl-s1\">instanceConfig</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L886\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"886\"></td>\n          <td id=\"LC886\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                                 <span class=\"pl-smi\">ClassLoader</span> <span class=\"pl-s1\">componentClassLoader</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L887\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"887\"></td>\n          <td id=\"LC887\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                                 <span class=\"pl-smi\">org</span>.<span class=\"pl-smi\">apache</span>.<span class=\"pl-smi\">pulsar</span>.<span class=\"pl-smi\">functions</span>.<span class=\"pl-smi\">proto</span>.<span class=\"pl-smi\">Function</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L888\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"888\"></td>\n          <td id=\"LC888\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                                         .<span class=\"pl-smi\">FunctionDetails</span>.<span class=\"pl-smi\">ComponentType</span> <span class=\"pl-s1\">componentType</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L889\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"889\"></td>\n          <td id=\"LC889\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">IOException</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L890\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"890\"></td>\n          <td id=\"LC890\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">final</span> <span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt; <span class=\"pl-s1\">config</span> = <span class=\"pl-smi\">ObjectMapperFactory</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L891\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"891\"></td>\n          <td id=\"LC891\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             .<span class=\"pl-en\">getMapper</span>() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L892\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"892\"></td>\n          <td id=\"LC892\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             .<span class=\"pl-en\">reader</span>() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L893\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"893\"></td>\n          <td id=\"LC893\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             .<span class=\"pl-en\">forType</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">TypeReference</span>&lt;<span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt;&gt;() {}) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L894\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"894\"></td>\n          <td id=\"LC894\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             .<span class=\"pl-en\">readValue</span>(<span class=\"pl-s1\">connectorConfigs</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L895\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"895\"></td>\n          <td id=\"LC895\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">instanceConfig</span>.<span class=\"pl-en\">isIgnoreUnknownConfigFields</span>() &amp;&amp; <span class=\"pl-s1\">componentClassLoader</span> <span class=\"pl-k\">instanceof</span> <span class=\"pl-smi\">NarClassLoader</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L896\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"896\"></td>\n          <td id=\"LC896\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">configClassName</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L897\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"897\"></td>\n          <td id=\"LC897\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">componentType</span> == <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-s1\">functions</span>.<span class=\"pl-s1\">proto</span>.<span class=\"pl-s1\">Function</span>.<span class=\"pl-s1\">FunctionDetails</span>.<span class=\"pl-s1\">ComponentType</span>.<span class=\"pl-c1\">SOURCE</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L898\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"898\"></td>\n          <td id=\"LC898\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">configClassName</span> = <span class=\"pl-smi\">ConnectorUtils</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L899\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"899\"></td>\n          <td id=\"LC899\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     .<span class=\"pl-en\">getConnectorDefinition</span>((<span class=\"pl-smi\">NarClassLoader</span>) <span class=\"pl-s1\">componentClassLoader</span>).<span class=\"pl-en\">getSourceConfigClass</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L900\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"900\"></td>\n          <td id=\"LC900\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">componentType</span> == <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-s1\">functions</span>.<span class=\"pl-s1\">proto</span>.<span class=\"pl-s1\">Function</span>.<span class=\"pl-s1\">FunctionDetails</span>.<span class=\"pl-s1\">ComponentType</span>.<span class=\"pl-c1\">SINK</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L901\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"901\"></td>\n          <td id=\"LC901\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">configClassName</span> =  <span class=\"pl-smi\">ConnectorUtils</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L902\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"902\"></td>\n          <td id=\"LC902\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     .<span class=\"pl-en\">getConnectorDefinition</span>((<span class=\"pl-smi\">NarClassLoader</span>) <span class=\"pl-s1\">componentClassLoader</span>).<span class=\"pl-en\">getSinkConfigClass</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L903\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"903\"></td>\n          <td id=\"LC903\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L904\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"904\"></td>\n          <td id=\"LC904\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">return</span> <span class=\"pl-s1\">config</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L905\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"905\"></td>\n          <td id=\"LC905\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L906\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"906\"></td>\n          <td id=\"LC906\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">configClassName</span> != <span class=\"pl-c1\">null</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L907\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"907\"></td>\n          <td id=\"LC907\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L908\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"908\"></td>\n          <td id=\"LC908\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-smi\">Class</span>&lt;?&gt; <span class=\"pl-s1\">configClass</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L909\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"909\"></td>\n          <td id=\"LC909\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">try</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L910\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"910\"></td>\n          <td id=\"LC910\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">configClass</span> = <span class=\"pl-smi\">Class</span>.<span class=\"pl-en\">forName</span>(<span class=\"pl-s1\">configClassName</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L911\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"911\"></td>\n          <td id=\"LC911\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-c1\">true</span>, <span class=\"pl-smi\">Thread</span>.<span class=\"pl-en\">currentThread</span>().<span class=\"pl-en\">getContextClassLoader</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L912\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"912\"></td>\n          <td id=\"LC912\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">ClassNotFoundException</span> <span class=\"pl-s1\">e</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L913\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"913\"></td>\n          <td id=\"LC913\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">throw</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">RuntimeException</span>(<span class=\"pl-s\">\"Config class not found: \"</span> + <span class=\"pl-s1\">configClassName</span>, <span class=\"pl-s1\">e</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L914\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"914\"></td>\n          <td id=\"LC914\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L915\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"915\"></td>\n          <td id=\"LC915\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">final</span> <span class=\"pl-smi\">List</span>&lt;<span class=\"pl-smi\">String</span>&gt; <span class=\"pl-s1\">allFields</span> = <span class=\"pl-smi\">BeanPropertiesReader</span>.<span class=\"pl-en\">getBeanProperties</span>(<span class=\"pl-s1\">configClass</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L916\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"916\"></td>\n          <td id=\"LC916\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L917\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"917\"></td>\n          <td id=\"LC917\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">String</span> <span class=\"pl-s1\">s</span> : <span class=\"pl-s1\">config</span>.<span class=\"pl-en\">keySet</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L918\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"918\"></td>\n          <td id=\"LC918\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">if</span> (!<span class=\"pl-s1\">allFields</span>.<span class=\"pl-en\">contains</span>(<span class=\"pl-s1\">s</span>)) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L919\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"919\"></td>\n          <td id=\"LC919\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">error</span>(<span class=\"pl-s\">\"Field '{}' not defined in the {} configuration {}, the field will be ignored\"</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L920\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"920\"></td>\n          <td id=\"LC920\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-s1\">s</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L921\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"921\"></td>\n          <td id=\"LC921\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-s1\">componentType</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L922\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"922\"></td>\n          <td id=\"LC922\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-s1\">configClass</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L923\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"923\"></td>\n          <td id=\"LC923\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-s1\">config</span>.<span class=\"pl-en\">remove</span>(<span class=\"pl-s1\">s</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L924\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"924\"></td>\n          <td id=\"LC924\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L925\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"925\"></td>\n          <td id=\"LC925\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L926\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"926\"></td>\n          <td id=\"LC926\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L927\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"927\"></td>\n          <td id=\"LC927\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L928\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"928\"></td>\n          <td id=\"LC928\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-s1\">config</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L929\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"929\"></td>\n          <td id=\"LC929\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20862",
                "createdAt": "2023-07-24T17:22:11Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "area/connector"
                      }
                    },
                    {
                      "node": {
                        "name": "area/security"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] fix MessageDeduplication throw NPE when enable broker dedup and set namespace disable deduplication.",
        "url": "https://github.com/apache/pulsar/pull/20905",
        "resourcePath": "/apache/pulsar/pull/20905",
        "createdAt": "2023-07-30T10:08:04Z",
        "number": 20905,
        "mergeCommit": {
          "oid": "4349e9f789692761a39c999dad44f9af33534208",
          "message": "[fix][broker] fix MessageDeduplication throw NPE when enable broker dedup and set namespace disable deduplication. (#20905)",
          "commitUrl": "https://github.com/apache/pulsar/commit/4349e9f789692761a39c999dad44f9af33534208",
          "parents": {
            "nodes": [
              {
                "oid": "001b134653b89103089b1429b9058d987cd0485c",
                "message": "[improve][sql] Fix the wrong format of the logs (#20907)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/MessageDeduplication.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/TopicDuplicationTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5WuwA42gAoODg3Zjk1MmY4NTM2NDk1MzdhMjQ0MTRhOTQ1OTc4MmRmNzdiOGM0Yw",
                "url": "https://github.com/apache/pulsar/pull/20905/commits/887f952f853649537a24414a9459782df77b8c4c"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20904,
                "url": "https://github.com/apache/pulsar/issues/20904",
                "title": "[Bug] MessageDeduplication throw NPE when enable broker dedup and set namespace disable deduplication.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">3.0.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>enable brokerDeduplication in broker.conf</li>\n<li>set namespace policies to disable messageDeduplication.</li>\n<li>write some message and trigger snapshot.</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">nothing else happen.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">2023-07-30T17:40:59,413+0800 [deduplication-snapshot-monitor-OrderedScheduler-0-0] WARN  org.apache.bookkeeper.common.util.SingleThreadSafeScheduledExecutorService - Unexpected throwable from task class com.google.common.util.concurrent.MoreExecutors$ScheduledListeningDecorator$NeverSuccessfulListenableFutureTask: Cannot invoke \"org.apache.bookkeeper.mledger.ManagedCursor.getMarkDeletedPosition()\" because \"this.managedCursor\" is null<br>\njava.lang.NullPointerException: Cannot invoke \"org.apache.bookkeeper.mledger.ManagedCursor.getMarkDeletedPosition()\" because \"this.managedCursor\" is null<br>\nat org.apache.pulsar.broker.service.persistent.MessageDeduplication.takeSnapshot(MessageDeduplication.java:495) ~[org.apache.pulsar-pulsar-broker-3.0.0.jar:3.0.0]<br>\nat org.apache.pulsar.broker.service.persistent.PersistentTopic.checkDeduplicationSnapshot(PersistentTopic.java:2764) ~[org.apache.pulsar-pulsar-broker-3.0.0.jar:3.0.0]<br>\nat java.util.Optional.ifPresent(Optional.java:178) ~[?:?]<br>\nat org.apache.pulsar.broker.service.BrokerService.lambda$forEachTopic$83(BrokerService.java:2091) ~[org.apache.pulsar-pulsar-broker-3.0.0.jar:3.0.0]<br>\nat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.forEach(ConcurrentOpenHashMap.java:554) ~[org.apache.pulsar-pulsar-common-3.0.0.jar:3.0.0]<br>\nat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.forEach(ConcurrentOpenHashMap.java:277) ~[org.apache.pulsar-pulsar-common-3.0.0.jar:3.0.0]<br>\nat org.apache.pulsar.broker.service.BrokerService.forEachTopic(BrokerService.java:2089) ~[org.apache.pulsar-pulsar-broker-3.0.0.jar:3.0.0]<br>\nat org.apache.pulsar.broker.service.BrokerService.lambda$startDeduplicationSnapshotMonitor$8(BrokerService.java:585) ~[org.apache.pulsar-pulsar-broker-3.0.0.jar:3.0.0]<br>\nat com.google.common.util.concurrent.MoreExecutors$ScheduledListeningDecorator$NeverSuccessfulListenableFutureTask.run(MoreExecutors.java:718) ~[com.google.guava-guava-31.0.1-jre.jar:?]<br>\nat org.apache.bookkeeper.common.util.SingleThreadSafeScheduledExecutorService$SafeRunnable.run(SingleThreadSafeScheduledExecutorService.java:46) ~[org.apache.bookkeeper-bookkeeper-common-4.16.1.jar:4.16.1]<br>\nat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539) ~[?:?]<br>\nat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:305) ~[?:?]<br>\nat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:305) ~[?:?]<br>\nat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[?:?]<br>\nat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[?:?]<br>\nat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.89.Final.jar:4.1.89.Final]<br>\nat java.lang.Thread.run(Thread.java:833) ~[?:?]</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20904",
                "createdAt": "2023-07-30T09:43:32Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][sql] Fix SQL query is blocked",
        "url": "https://github.com/apache/pulsar/pull/20911",
        "resourcePath": "/apache/pulsar/pull/20911",
        "createdAt": "2023-08-01T06:49:01Z",
        "number": 20911,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerFactoryImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5W35UF2gAoMjA3MDAyYWVlNzNlODAwNmI3M2MyYTQ2NjVhNzQyMjhlMmMxZmE2MA",
                "url": "https://github.com/apache/pulsar/pull/20911/commits/207002aee73e8006b73c2a4665a74228e2c1fa60"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20910,
                "url": "https://github.com/apache/pulsar/issues/20910",
                "title": "[Bug] When querying a newly created topic with Pulsar SQL, the query will be blocked.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Create a new topic: <code class=\"notranslate\">admin.topics().createPartitionedTopic(topic, 2);</code></li>\n<li>Query with <code class=\"notranslate\">Pulsar-SQL</code>: <code class=\"notranslate\">select * from pulsar.\"public/default\".\"topic1\";</code></li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Return an empty query result.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The query will be blocked.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/15684156/257399918-74c5ea8d-7c77-47f5-9801-030c6cd4a5b6.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxMDksIm5iZiI6MTcxNDk3MTgwOSwicGF0aCI6Ii8xNTY4NDE1Ni8yNTczOTk5MTgtNzRjNWVhOGQtN2M3Ny00N2Y1LTk4MDEtMDMwYzZjZDRhNWI2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDMyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWNhODA5ZjZlNTU0YTMwZmNhZjNhZmFkOTBhZjM3ZjQ0OGQ2ZTk4MmY0Mzc4ODBiODcwN2E4ZGM2ZGYzNThiMzcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.BSXWnuPPFWr-8ODJqVk9672OLi5FjuuYCzcEgewdCSo\"><img src=\"https://private-user-images.githubusercontent.com/15684156/257399918-74c5ea8d-7c77-47f5-9801-030c6cd4a5b6.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxMDksIm5iZiI6MTcxNDk3MTgwOSwicGF0aCI6Ii8xNTY4NDE1Ni8yNTczOTk5MTgtNzRjNWVhOGQtN2M3Ny00N2Y1LTk4MDEtMDMwYzZjZDRhNWI2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDMyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWNhODA5ZjZlNTU0YTMwZmNhZjNhZmFkOTBhZjM3ZjQ0OGQ2ZTk4MmY0Mzc4ODBiODcwN2E4ZGM2ZGYzNThiMzcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.BSXWnuPPFWr-8ODJqVk9672OLi5FjuuYCzcEgewdCSo\" alt=\"image\" style=\"max-width: 100%;\"></a><br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/15684156/257399963-27c35d2e-fb28-43c7-ade4-6fcdc638b32a.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxMDksIm5iZiI6MTcxNDk3MTgwOSwicGF0aCI6Ii8xNTY4NDE1Ni8yNTczOTk5NjMtMjdjMzVkMmUtZmIyOC00M2M3LWFkZTQtNmZjZGM2MzhiMzJhLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDMyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTJkODUyMTcxYzQ4NjQwOGJhNmE5NjdlMTAyOTU0NDg0MjFlYWEzZGNiMjE1MDg0ZGNkNjdjNmY3NDZkNDFkMWMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.sC_kf6S8JaP2DhcsjCusYtE1imvNyV20ZOpq4mI7Eak\"><img src=\"https://private-user-images.githubusercontent.com/15684156/257399963-27c35d2e-fb28-43c7-ade4-6fcdc638b32a.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxMDksIm5iZiI6MTcxNDk3MTgwOSwicGF0aCI6Ii8xNTY4NDE1Ni8yNTczOTk5NjMtMjdjMzVkMmUtZmIyOC00M2M3LWFkZTQtNmZjZGM2MzhiMzJhLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDMyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTJkODUyMTcxYzQ4NjQwOGJhNmE5NjdlMTAyOTU0NDg0MjFlYWEzZGNiMjE1MDg0ZGNkNjdjNmY3NDZkNDFkMWMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.sC_kf6S8JaP2DhcsjCusYtE1imvNyV20ZOpq4mI7Eak\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">The blocking happened here, line: 475<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/001b134653b89103089b1429b9058d987cd0485c/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerFactoryImpl.java#L460-L476\">pulsar/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerFactoryImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 460 to 476\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/001b134653b89103089b1429b9058d987cd0485c\">001b134</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L460\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"460\"></td>\n          <td id=\"LC460\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">CountDownLatch</span> <span class=\"pl-s1\">latch</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">CountDownLatch</span>(<span class=\"pl-c1\">1</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L461\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"461\"></td>\n          <td id=\"LC461\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">asyncOpenReadOnlyCursor</span>(<span class=\"pl-s1\">managedLedgerName</span>, <span class=\"pl-s1\">startPosition</span>, <span class=\"pl-s1\">config</span>, <span class=\"pl-k\">new</span> <span class=\"pl-smi\">OpenReadOnlyCursorCallback</span>() { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L462\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"462\"></td>\n          <td id=\"LC462\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Override</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L463\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"463\"></td>\n          <td id=\"LC463\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">openReadOnlyCursorComplete</span>(<span class=\"pl-smi\">ReadOnlyCursor</span> <span class=\"pl-s1\">cursor</span>, <span class=\"pl-smi\">Object</span> <span class=\"pl-s1\">ctx</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L464\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"464\"></td>\n          <td id=\"LC464\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">r</span>.<span class=\"pl-s1\">c</span> = <span class=\"pl-s1\">cursor</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L465\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"465\"></td>\n          <td id=\"LC465\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">latch</span>.<span class=\"pl-en\">countDown</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L466\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"466\"></td>\n          <td id=\"LC466\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L467\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"467\"></td>\n          <td id=\"LC467\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L468\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"468\"></td>\n          <td id=\"LC468\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Override</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L469\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"469\"></td>\n          <td id=\"LC469\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">openReadOnlyCursorFailed</span>(<span class=\"pl-smi\">ManagedLedgerException</span> <span class=\"pl-s1\">exception</span>, <span class=\"pl-smi\">Object</span> <span class=\"pl-s1\">ctx</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L470\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"470\"></td>\n          <td id=\"LC470\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">r</span>.<span class=\"pl-s1\">e</span> = <span class=\"pl-s1\">exception</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L471\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"471\"></td>\n          <td id=\"LC471\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">latch</span>.<span class=\"pl-en\">countDown</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L472\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"472\"></td>\n          <td id=\"LC472\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L473\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"473\"></td>\n          <td id=\"LC473\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> }, <span class=\"pl-c1\">null</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L474\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"474\"></td>\n          <td id=\"LC474\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L475\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"475\"></td>\n          <td id=\"LC475\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">latch</span>.<span class=\"pl-en\">await</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L476\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"476\"></td>\n          <td id=\"LC476\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">Thread stack:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/15684156/258464434-454d02ef-6896-45f5-8c57-1b88a37a800f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxMDksIm5iZiI6MTcxNDk3MTgwOSwicGF0aCI6Ii8xNTY4NDE1Ni8yNTg0NjQ0MzQtNDU0ZDAyZWYtNjg5Ni00NWY1LThjNTctMWI4OGEzN2E4MDBmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDMyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWY4ZjdmN2U1ZGIwYWRhZjE0NTE5YjIwMGYxYjJhMTFiZWZiODIzZTEzOTM0YzUyMTJmZjJmNGM4MzRiOGEyNjUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.UK7A2Swez7FElk1HCfp8pxkecw60_Sgq8sp746BQzWE\"><img width=\"1332\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/15684156/258464434-454d02ef-6896-45f5-8c57-1b88a37a800f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxMDksIm5iZiI6MTcxNDk3MTgwOSwicGF0aCI6Ii8xNTY4NDE1Ni8yNTg0NjQ0MzQtNDU0ZDAyZWYtNjg5Ni00NWY1LThjNTctMWI4OGEzN2E4MDBmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDMyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWY4ZjdmN2U1ZGIwYWRhZjE0NTE5YjIwMGYxYjJhMTFiZWZiODIzZTEzOTM0YzUyMTJmZjJmNGM4MzRiOGEyNjUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.UK7A2Swez7FElk1HCfp8pxkecw60_Sgq8sp746BQzWE\" style=\"max-width: 100%;\"></a><br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/15684156/258464641-743694a8-975e-44f5-af4d-aca0be8e4fb5.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxMDksIm5iZiI6MTcxNDk3MTgwOSwicGF0aCI6Ii8xNTY4NDE1Ni8yNTg0NjQ2NDEtNzQzNjk0YTgtOTc1ZS00NGY1LWFmNGQtYWNhMGJlOGU0ZmI1LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDMyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTQ5OGNjNGE3ZjZkODBlOTIyOWQxYWYyNDkwMzZhZWExMWE4MWM1ZmQ0Yzc2Y2Y1YzA0MDQwYTQ3MDkxMjM1NmUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.caWlNWVACSM1RPjoZwy5Ri830VxDcrpTrqjSDhLFJhk\"><img width=\"359\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/15684156/258464641-743694a8-975e-44f5-af4d-aca0be8e4fb5.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxMDksIm5iZiI6MTcxNDk3MTgwOSwicGF0aCI6Ii8xNTY4NDE1Ni8yNTg0NjQ2NDEtNzQzNjk0YTgtOTc1ZS00NGY1LWFmNGQtYWNhMGJlOGU0ZmI1LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDMyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTQ5OGNjNGE3ZjZkODBlOTIyOWQxYWYyNDkwMzZhZWExMWE4MWM1ZmQ0Yzc2Y2Y1YzA0MDQwYTQ3MDkxMjM1NmUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.caWlNWVACSM1RPjoZwy5Ri830VxDcrpTrqjSDhLFJhk\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20910",
                "createdAt": "2023-08-01T04:09:56Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[draft] [improve] [pip] PIP-291 Support producer batch IO write to improve replication",
        "url": "https://github.com/apache/pulsar/pull/20925",
        "resourcePath": "/apache/pulsar/pull/20925",
        "createdAt": "2023-08-03T13:32:26Z",
        "number": 20925,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": "pip/pip-291.md"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5XHG6_2gAoNWZhZWUzNzQ1OGMxOGZmZDMyYzc4MDg2YWE0MGU0ZTI4OTM5YTVhOA",
                "url": "https://github.com/apache/pulsar/pull/20925/commits/5faee37458c18ffd32c78086aa40e4e28939a5a8"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20857,
                "url": "https://github.com/apache/pulsar/issues/20857",
                "title": "[improve] [replication] Replicate messages in batches to improve performance",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">The replicator works like this:</p>\n<ul dir=\"auto\">\n<li>read messages with the cursor</li>\n<li>send messages to remote cluster one by one</li>\n</ul>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">The replicator works like this:</p>\n<ul dir=\"auto\">\n<li>read messages with the cursor</li>\n<li>send messages in batches to improve performance( <strong>Improve</strong> )</li>\n</ul>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20857",
                "createdAt": "2023-07-24T03:11:08Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "area/geo-replication"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][client] Add optional fields to dead letter policy for configuring batching/chunking",
        "url": "https://github.com/apache/pulsar/pull/20936",
        "resourcePath": "/apache/pulsar/pull/20936",
        "createdAt": "2023-08-06T23:58:44Z",
        "number": 20936,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/DeadLetterPolicy.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/ConsumerBuilderImplTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5XSJGc2gAoOTlmNGM0MGVjODc0ZmU0MzlkZjM5ZGQyMDFiNTg0YzE5YWJjYjAzMQ",
                "url": "https://github.com/apache/pulsar/pull/20936/commits/99f4c40ec874fe439df39dd201b584c19abcb031"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20934,
                "url": "https://github.com/apache/pulsar/issues/20934",
                "title": "[Bug] Dead Letter Policy in Consumer configuration doesn't account for chunking or batching configuration.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.11.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ul dir=\"auto\">\n<li>Produce a message to a topic that exceeds the <code class=\"notranslate\">maxMessageSize</code> default value of <code class=\"notranslate\">5MB</code>.</li>\n<li>Create a consumer that consumes from that topic. This consumer should be configured with a <code class=\"notranslate\">deadLetterPolicy</code> that includes retry letter and dead letter topics.</li>\n<li>Simulate a failure in the consumer code by forcing a call to <code class=\"notranslate\">reconsumeLater</code></li>\n</ul>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I would expect that a message will be produced to the retry letter topic that was configured in the deadLetterPolicy for that consumer.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The following error is observed:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"org.apache.pulsar.client.api.PulsarClientException$InvalidMessageException: The producer mdl-pulsar-0-12 of the topic persistent://metadatalake/metadatalake/part-rlt-v1 sends a  message with 7094331 bytes that exceeds 5242880 bytes\"><pre class=\"notranslate\"><code class=\"notranslate\">org.apache.pulsar.client.api.PulsarClientException$InvalidMessageException: The producer mdl-pulsar-0-12 of the topic persistent://metadatalake/metadatalake/part-rlt-v1 sends a  message with 7094331 bytes that exceeds 5242880 bytes\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The root cause is expected to be that the consumer implementation with respect to creating the producers for whatever is provided in <code class=\"notranslate\">deadLetterPolicy</code> does not have any configuration parameters regarding if batching or chunking should be enabled. Problematic code:</p>\n<ul dir=\"auto\">\n<li><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/ecd16d68e29700cc9521e6d77d124a403c3486c9/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java#L2092-L2097\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 2092 to 2097\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/ecd16d68e29700cc9521e6d77d124a403c3486c9\">ecd16d6</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L2092\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2092\"></td>\n          <td id=\"LC2092\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">deadLetterProducer</span> = </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2093\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2093\"></td>\n          <td id=\"LC2093\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         ((<span class=\"pl-smi\">ProducerBuilderImpl</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt;) <span class=\"pl-s1\">client</span>.<span class=\"pl-en\">newProducer</span>(<span class=\"pl-smi\">Schema</span>.<span class=\"pl-en\">AUTO_PRODUCE_BYTES</span>(<span class=\"pl-s1\">schema</span>))) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2094\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2094\"></td>\n          <td id=\"LC2094\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 .<span class=\"pl-en\">initialSubscriptionName</span>(<span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">deadLetterPolicy</span>.<span class=\"pl-en\">getInitialSubscriptionName</span>()) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2095\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2095\"></td>\n          <td id=\"LC2095\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 .<span class=\"pl-en\">topic</span>(<span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">deadLetterPolicy</span>.<span class=\"pl-en\">getDeadLetterTopic</span>()) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2096\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2096\"></td>\n          <td id=\"LC2096\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 .<span class=\"pl-en\">blockIfQueueFull</span>(<span class=\"pl-c1\">false</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2097\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2097\"></td>\n          <td id=\"LC2097\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 .<span class=\"pl-en\">createAsync</span>(); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</li>\n<li><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/ecd16d68e29700cc9521e6d77d124a403c3486c9/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java#L613-L617\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 613 to 617\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/ecd16d68e29700cc9521e6d77d124a403c3486c9\">ecd16d6</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L613\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"613\"></td>\n          <td id=\"LC613\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">retryLetterProducer</span> = <span class=\"pl-s1\">client</span>.<span class=\"pl-en\">newProducer</span>(<span class=\"pl-smi\">Schema</span>.<span class=\"pl-en\">AUTO_PRODUCE_BYTES</span>(<span class=\"pl-s1\">schema</span>)) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L614\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"614\"></td>\n          <td id=\"LC614\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">topic</span>(<span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">deadLetterPolicy</span>.<span class=\"pl-en\">getRetryLetterTopic</span>()) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L615\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"615\"></td>\n          <td id=\"LC615\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">enableBatching</span>(<span class=\"pl-c1\">false</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L616\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"616\"></td>\n          <td id=\"LC616\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">blockIfQueueFull</span>(<span class=\"pl-c1\">false</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L617\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"617\"></td>\n          <td id=\"LC617\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">create</span>(); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</li>\n</ul>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20934",
                "createdAt": "2023-08-04T18:47:40Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker]Check that the super user role is in the MultiRolesTokenAuthorizationProvider plugin",
        "url": "https://github.com/apache/pulsar/pull/20939",
        "resourcePath": "/apache/pulsar/pull/20939",
        "createdAt": "2023-08-07T03:01:02Z",
        "number": 20939,
        "mergeCommit": {
          "oid": "e41883e23b581e3d3c7c219b6356cd1d9a169017",
          "message": "[fix][broker]Check that the super user role is in the MultiRolesTokenAuthorizationProvider plugin (#20939)\n\nFixed https://github.com/apache/pulsar/issues/20938",
          "commitUrl": "https://github.com/apache/pulsar/commit/e41883e23b581e3d3c7c219b6356cd1d9a169017",
          "parents": {
            "nodes": [
              {
                "oid": "98628845aa94b416b0c3711b5a15819ade549c57",
                "message": "[fix][test] Fix flaky test `testCloseTransactionBufferWhenTimeout` and close producer/consumer (#20956)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/authorization/MultiRolesTokenAuthorizationProvider.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/test/java/org/apache/pulsar/broker/authorization/MultiRolesTokenAuthorizationProviderTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5XSiBT2gAoMTQyY2I3OWI3MTBlMjViMDI1MTY4MWY5NmJjMTk0ZDEyYjllZjJmZA",
                "url": "https://github.com/apache/pulsar/pull/20939/commits/142cb79b710e25b0251681f96bc194d12b9ef2fd"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20938,
                "url": "https://github.com/apache/pulsar/issues/20938",
                "title": "[Bug] When anonymousUserRole and MultiRolesTokenAuthorizationProvider are enabled, super user role no longer works.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.10, 2.11, 3.0 and master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Enabled anonymousUserRole, authentication and authorization plugin<br>\nSet authorizationProvider value is org.apache.pulsar.broker.authorization.MultiRolesTokenAuthorizationProvider</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"curl http://localhost:8080/admin/v2/tenants\"><pre class=\"notranslate\"><code class=\"notranslate\">curl http://localhost:8080/admin/v2/tenants\n</code></pre></div>\n<p dir=\"auto\">Throws 401 exception:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Unauthorized to validateTenantOperation for originalPrincipal [admin] and clientAppId [admin] about operation [LIST_NAMESPACES] on tenant [xxxxx]\"><pre class=\"notranslate\"><code class=\"notranslate\">Unauthorized to validateTenantOperation for originalPrincipal [admin] and clientAppId [admin] about operation [LIST_NAMESPACES] on tenant [xxxxx]\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">No exceptions are thrown</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Throws 401 exception:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Unauthorized to validateTenantOperation for originalPrincipal [admin] and clientAppId [admin] about operation [LIST_NAMESPACES] on tenant [xxxxx]\"><pre class=\"notranslate\"><code class=\"notranslate\">Unauthorized to validateTenantOperation for originalPrincipal [admin] and clientAppId [admin] about operation [LIST_NAMESPACES] on tenant [xxxxx]\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20938",
                "createdAt": "2023-08-07T02:56:23Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix http error message of Bookie rack placement config API when bookie-rack is not configured.",
        "url": "https://github.com/apache/pulsar/pull/20949",
        "resourcePath": "/apache/pulsar/pull/20949",
        "createdAt": "2023-08-07T16:46:52Z",
        "number": 20949,
        "mergeCommit": {
          "oid": "bafc8277940a827bc7a9f7c7d22f07dfe1b3ef47",
          "message": "[fix][broker] Fix http error message of Bookie rack placement config API when bookie-rack is not configured. (#20949)",
          "commitUrl": "https://github.com/apache/pulsar/commit/bafc8277940a827bc7a9f7c7d22f07dfe1b3ef47",
          "parents": {
            "nodes": [
              {
                "oid": "980dfc81a5165147615232692e7b5a71b61c71a7",
                "message": "[improve][cli] Add some checks for topic-level `setOffloadPolicies` (#20943)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/Bookies.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/BookiesApiTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5XW2IG2gAoNTRiZDI3YjY5MTdmMGJmMDRlNjJiYmY2NjIyYmRhMTc2MWU2MGJjMA",
                "url": "https://github.com/apache/pulsar/pull/20949/commits/54bd27b6917f0bf04e62bbf6622bda1761e60bc0"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20871,
                "url": "https://github.com/apache/pulsar/issues/20871",
                "title": "[Bug] When bookie-rack is not configured, pulsar-admin bookies get-bookie-rack -b <correct-bookie-address> is throwing 'Bookie address not found' error",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar 2.10.3 on K8s container</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Ensure that bookie-rack policy is NOT configured</li>\n<li>Lis the bookies using \"pulsar-admin bookies list-bookies\"</li>\n<li>Get the bookie rack using the address displayed in step 2 (list-bookies command) [pulsar-admin bookies get-bookie-rack -b \"proper-bookie-id.:3181\"]   . The get-bookie-rack throws error \"Bookie address not found: proper-bookie-id.:3181\"</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">If the bookie-rack is not set, proper error message should be displayed [ Example : null as bookie as rack]</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Bookie address not found: .:3181<br>\nExample: Bookie address not found: proper-bookie-id.:3181</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20871",
                "createdAt": "2023-07-25T10:07:51Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][sql] Add SQL query checks for schema compatibility",
        "url": "https://github.com/apache/pulsar/pull/20955",
        "resourcePath": "/apache/pulsar/pull/20955",
        "createdAt": "2023-08-08T11:16:11Z",
        "number": 20955,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-sql/presto-pulsar/src/main/java/org/apache/pulsar/sql/presto/PulsarDispatchingRowDecoderFactory.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-sql/presto-pulsar/src/main/java/org/apache/pulsar/sql/presto/PulsarMetadata.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5XbDBQ2gAoZWIxNDE3NTQ3Y2I2MTFlMDVlOTViMWQ3NGY3MTVkNzlkZGYyZGQ3NA",
                "url": "https://github.com/apache/pulsar/pull/20955/commits/eb1417547cb611e05e95b1d74f715d79ddf2dd74"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20945,
                "url": "https://github.com/apache/pulsar/issues/20945",
                "title": "[Bug] When the Schema structure is incorrect, SQL queries return Not a record: \"string\"",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<h2 dir=\"auto\">Create producer</h2>\n<p dir=\"auto\"><code class=\"notranslate\">Producer p = pulsarClient.newProducer(Schema.JSON(String.class)).create()</code></p>\n<p dir=\"auto\">It would generate the following schema:</p>\n<div class=\"highlight highlight-source-json notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{\n  &quot;version&quot;: 0,\n  &quot;schemaInfo&quot;: {\n    &quot;name&quot;: &quot;schema-test-2&quot;,\n    &quot;schema&quot;: &quot;\\&quot;string\\&quot;&quot;,\n    &quot;type&quot;: &quot;JSON&quot;,\n    &quot;timestamp&quot;: 1691379461556,\n    &quot;properties&quot;: {\n      &quot;__alwaysAllowNull&quot;: &quot;true&quot;,\n      &quot;__jsr310ConversionEnabled&quot;: &quot;false&quot;\n    }\n  }\n}\"><pre class=\"notranslate\">{\n  <span class=\"pl-ent\">\"version\"</span>: <span class=\"pl-c1\">0</span>,\n  <span class=\"pl-ent\">\"schemaInfo\"</span>: {\n    <span class=\"pl-ent\">\"name\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>schema-test-2<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"schema\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-cce\">\\\"</span>string<span class=\"pl-cce\">\\\"</span><span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"type\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>JSON<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"timestamp\"</span>: <span class=\"pl-c1\">1691379461556</span>,\n    <span class=\"pl-ent\">\"properties\"</span>: {\n      <span class=\"pl-ent\">\"__alwaysAllowNull\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>true<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"__jsr310ConversionEnabled\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>false<span class=\"pl-pds\">\"</span></span>\n    }\n  }\n}</pre></div>\n<p dir=\"auto\">And query from <code class=\"notranslate\">Trino</code>:</p>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"select * from pulsar.&quot;public/default&quot;.&quot;schema-test-2&quot;;\"><pre class=\"notranslate\"><span class=\"pl-k\">select</span> <span class=\"pl-k\">*</span> <span class=\"pl-k\">from</span> pulsar.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>public/default<span class=\"pl-pds\">\"</span></span>.<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>schema-test-2<span class=\"pl-pds\">\"</span></span>;</pre></div>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/15684156/258736752-94dcf40e-7741-4b89-9123-c052b5b13f16.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxNjksIm5iZiI6MTcxNDk3MTg2OSwicGF0aCI6Ii8xNTY4NDE1Ni8yNTg3MzY3NTItOTRkY2Y0MGUtNzc0MS00Yjg5LTkxMjMtYzA1MmI1YjEzZjE2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDQyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWIxYWFiY2YzOGI4NzhiNzYwY2NiOGJkY2E4YmU3YTU4NDIyNDg3ZDU3Y2MyMzAyNzczMmYyNjU4MGE0Zjg0MGYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.xQ381I7ePDZtMrAPvXB6R60TwXWUT8SqFcFleC1T5u4\"><img src=\"https://private-user-images.githubusercontent.com/15684156/258736752-94dcf40e-7741-4b89-9123-c052b5b13f16.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxNjksIm5iZiI6MTcxNDk3MTg2OSwicGF0aCI6Ii8xNTY4NDE1Ni8yNTg3MzY3NTItOTRkY2Y0MGUtNzc0MS00Yjg5LTkxMjMtYzA1MmI1YjEzZjE2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDQyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWIxYWFiY2YzOGI4NzhiNzYwY2NiOGJkY2E4YmU3YTU4NDIyNDg3ZDU3Y2MyMzAyNzczMmYyNjU4MGE0Zjg0MGYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.xQ381I7ePDZtMrAPvXB6R60TwXWUT8SqFcFleC1T5u4\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\"><code class=\"notranslate\">Trino</code> service did not report any exception.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/15684156/258737201-16229a9e-6f86-42b0-a0fb-9fd0d04787f8.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxNjksIm5iZiI6MTcxNDk3MTg2OSwicGF0aCI6Ii8xNTY4NDE1Ni8yNTg3MzcyMDEtMTYyMjlhOWUtNmY4Ni00MmIwLWEwZmItOWZkMGQwNDc4N2Y4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDQyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTFhMjBiYzYzN2VjMjhmZmY5NDdlOWE5OGRkYjBjOTg3Y2ViNjFlOTI4YWU5Y2U4YjUxMzQwYjA0OTllNDhlOGEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.Gp-sUX68UbiVnHWEXXID19LGQuNlCKS2Vm4VhsYOxG8\"><img src=\"https://private-user-images.githubusercontent.com/15684156/258737201-16229a9e-6f86-42b0-a0fb-9fd0d04787f8.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxNjksIm5iZiI6MTcxNDk3MTg2OSwicGF0aCI6Ii8xNTY4NDE1Ni8yNTg3MzcyMDEtMTYyMjlhOWUtNmY4Ni00MmIwLWEwZmItOWZkMGQwNDc4N2Y4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDQyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTFhMjBiYzYzN2VjMjhmZmY5NDdlOWE5OGRkYjBjOTg3Y2ViNjFlOTI4YWU5Y2U4YjUxMzQwYjA0OTllNDhlOGEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.Gp-sUX68UbiVnHWEXXID19LGQuNlCKS2Vm4VhsYOxG8\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Query success.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Query 20230807_075157_00000_b7hfa failed: Not a record: \"string\"</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">This exception was thrown from there:</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/2ab184e49a036a1dd10dc537bef4ab034a5ad5e0/pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericSchemaImpl.java#L43-L46\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/schema/generic/GenericSchemaImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 43 to 46\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/2ab184e49a036a1dd10dc537bef4ab034a5ad5e0\">2ab184e</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L43\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"43\"></td>\n          <td id=\"LC43\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">fields</span> = <span class=\"pl-s1\">schema</span>.<span class=\"pl-en\">getFields</span>() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L44\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"44\"></td>\n          <td id=\"LC44\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">stream</span>() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L45\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"45\"></td>\n          <td id=\"LC45\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">map</span>(<span class=\"pl-s1\">f</span> -&gt; <span class=\"pl-k\">new</span> <span class=\"pl-smi\">Field</span>(<span class=\"pl-s1\">f</span>.<span class=\"pl-en\">name</span>(), <span class=\"pl-s1\">f</span>.<span class=\"pl-en\">pos</span>())) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L46\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"46\"></td>\n          <td id=\"LC46\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">collect</span>(<span class=\"pl-smi\">Collectors</span>.<span class=\"pl-en\">toList</span>()); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">Because there are a large amount of these types of codes in our production environment, we hope that they can be compatible in this situation in the <code class=\"notranslate\">pulsar-sql</code> module.</p>\n<p dir=\"auto\">When parsing the Schema encounters exceptions, use defaultSchema to regenerate, like this:</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/15684156/258740659-565c4e73-ef43-46b3-afbe-d41989e194fb.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxNjksIm5iZiI6MTcxNDk3MTg2OSwicGF0aCI6Ii8xNTY4NDE1Ni8yNTg3NDA2NTktNTY1YzRlNzMtZWY0My00NmIzLWFmYmUtZDQxOTg5ZTE5NGZiLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDQyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTZmMjFjOGQ5MWEyNGM4YTNjNGZiMTEyYTNkMjNkYzRlOTAwOTZlYzkzMGE5MmI2M2U0NGU4ZDYzZmI1MjQ1YzEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.BrnTYvsaOD0pRpE7F2A3Qdmq5cA9nuf-TXbdsF3XwtE\"><img src=\"https://private-user-images.githubusercontent.com/15684156/258740659-565c4e73-ef43-46b3-afbe-d41989e194fb.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxNjksIm5iZiI6MTcxNDk3MTg2OSwicGF0aCI6Ii8xNTY4NDE1Ni8yNTg3NDA2NTktNTY1YzRlNzMtZWY0My00NmIzLWFmYmUtZDQxOTg5ZTE5NGZiLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDQyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTZmMjFjOGQ5MWEyNGM4YTNjNGZiMTEyYTNkMjNkYzRlOTAwOTZlYzkzMGE5MmI2M2U0NGU4ZDYzZmI1MjQ1YzEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.BrnTYvsaOD0pRpE7F2A3Qdmq5cA9nuf-TXbdsF3XwtE\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20945",
                "createdAt": "2023-08-07T08:15:13Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][pip] PIP-293: Add configuration for batching/chunking for retry letter and dead letter producers",
        "url": "https://github.com/apache/pulsar/pull/20959",
        "resourcePath": "/apache/pulsar/pull/20959",
        "createdAt": "2023-08-08T23:58:22Z",
        "number": 20959,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": "pip/pip-293.md"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Xe-6Y2gAoZjM1ZWM1ZmVhYzdhYzRjZjQ3MWNlZGJmNDZjM2EzMGNmY2I0YzhmYw",
                "url": "https://github.com/apache/pulsar/pull/20959/commits/f35ec5feac7ac4cf471cedbf46c3a30cfcb4c8fc"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20934,
                "url": "https://github.com/apache/pulsar/issues/20934",
                "title": "[Bug] Dead Letter Policy in Consumer configuration doesn't account for chunking or batching configuration.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.11.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ul dir=\"auto\">\n<li>Produce a message to a topic that exceeds the <code class=\"notranslate\">maxMessageSize</code> default value of <code class=\"notranslate\">5MB</code>.</li>\n<li>Create a consumer that consumes from that topic. This consumer should be configured with a <code class=\"notranslate\">deadLetterPolicy</code> that includes retry letter and dead letter topics.</li>\n<li>Simulate a failure in the consumer code by forcing a call to <code class=\"notranslate\">reconsumeLater</code></li>\n</ul>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I would expect that a message will be produced to the retry letter topic that was configured in the deadLetterPolicy for that consumer.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The following error is observed:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"org.apache.pulsar.client.api.PulsarClientException$InvalidMessageException: The producer mdl-pulsar-0-12 of the topic persistent://metadatalake/metadatalake/part-rlt-v1 sends a  message with 7094331 bytes that exceeds 5242880 bytes\"><pre class=\"notranslate\"><code class=\"notranslate\">org.apache.pulsar.client.api.PulsarClientException$InvalidMessageException: The producer mdl-pulsar-0-12 of the topic persistent://metadatalake/metadatalake/part-rlt-v1 sends a  message with 7094331 bytes that exceeds 5242880 bytes\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The root cause is expected to be that the consumer implementation with respect to creating the producers for whatever is provided in <code class=\"notranslate\">deadLetterPolicy</code> does not have any configuration parameters regarding if batching or chunking should be enabled. Problematic code:</p>\n<ul dir=\"auto\">\n<li><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/ecd16d68e29700cc9521e6d77d124a403c3486c9/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java#L2092-L2097\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 2092 to 2097\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/ecd16d68e29700cc9521e6d77d124a403c3486c9\">ecd16d6</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L2092\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2092\"></td>\n          <td id=\"LC2092\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">deadLetterProducer</span> = </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2093\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2093\"></td>\n          <td id=\"LC2093\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         ((<span class=\"pl-smi\">ProducerBuilderImpl</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt;) <span class=\"pl-s1\">client</span>.<span class=\"pl-en\">newProducer</span>(<span class=\"pl-smi\">Schema</span>.<span class=\"pl-en\">AUTO_PRODUCE_BYTES</span>(<span class=\"pl-s1\">schema</span>))) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2094\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2094\"></td>\n          <td id=\"LC2094\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 .<span class=\"pl-en\">initialSubscriptionName</span>(<span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">deadLetterPolicy</span>.<span class=\"pl-en\">getInitialSubscriptionName</span>()) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2095\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2095\"></td>\n          <td id=\"LC2095\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 .<span class=\"pl-en\">topic</span>(<span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">deadLetterPolicy</span>.<span class=\"pl-en\">getDeadLetterTopic</span>()) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2096\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2096\"></td>\n          <td id=\"LC2096\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 .<span class=\"pl-en\">blockIfQueueFull</span>(<span class=\"pl-c1\">false</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2097\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2097\"></td>\n          <td id=\"LC2097\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 .<span class=\"pl-en\">createAsync</span>(); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</li>\n<li><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/ecd16d68e29700cc9521e6d77d124a403c3486c9/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java#L613-L617\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 613 to 617\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/ecd16d68e29700cc9521e6d77d124a403c3486c9\">ecd16d6</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L613\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"613\"></td>\n          <td id=\"LC613\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">retryLetterProducer</span> = <span class=\"pl-s1\">client</span>.<span class=\"pl-en\">newProducer</span>(<span class=\"pl-smi\">Schema</span>.<span class=\"pl-en\">AUTO_PRODUCE_BYTES</span>(<span class=\"pl-s1\">schema</span>)) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L614\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"614\"></td>\n          <td id=\"LC614\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">topic</span>(<span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">deadLetterPolicy</span>.<span class=\"pl-en\">getRetryLetterTopic</span>()) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L615\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"615\"></td>\n          <td id=\"LC615\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">enableBatching</span>(<span class=\"pl-c1\">false</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L616\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"616\"></td>\n          <td id=\"LC616\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">blockIfQueueFull</span>(<span class=\"pl-c1\">false</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L617\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"617\"></td>\n          <td id=\"LC617\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">create</span>(); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</li>\n</ul>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20934",
                "createdAt": "2023-08-04T18:47:40Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][build] add spotless plugin",
        "url": "https://github.com/apache/pulsar/pull/20974",
        "resourcePath": "/apache/pulsar/pull/20974",
        "createdAt": "2023-08-11T04:37:37Z",
        "number": 20974,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/main/java/org/apache/pulsar/websocket/stats/ProxyStats.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/main/java/org/apache/pulsar/websocket/stats/ProxyTopicStat.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/test/java/org/apache/pulsar/websocket/AbstractWebSocketHandlerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/test/java/org/apache/pulsar/websocket/LookupProtocolTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/test/java/org/apache/pulsar/websocket/PingPongSupportTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/test/java/org/apache/pulsar/websocket/ProducerHandlerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/test/java/org/apache/pulsar/websocket/ReaderHandlerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/test/java/org/apache/pulsar/websocket/WebSocketHttpServletRequestWrapperTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/test/java/org/apache/pulsar/websocket/WebSocketProxyConfigurationTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/test/java/org/apache/pulsar/websocket/admin/WebSocketWebResourceTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5XsUFi2gAoY2Y0MThiMTNhNzIwNWEwMTIxMDBmNjVjNmI4YmYyYzBlOTgxMTQ5Yw",
                "url": "https://github.com/apache/pulsar/pull/20974/commits/cf418b13a7205a012100f65c6b8bf2c0e981149c"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20967,
                "url": "https://github.com/apache/pulsar/issues/20967",
                "title": "[improve][CodeStyle] Strange code style",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\"><strong>When I was reading the source code, I found some problems in the code format. Most of this is code from a long time ago, maybe we should add some CheckStyle rules?</strong></p>\n<p dir=\"auto\"><strong>1.missing spaces</strong><br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/2ab184e49a036a1dd10dc537bef4ab034a5ad5e0/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractReplicator.java#L178-L189\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractReplicator.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 178 to 189\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/2ab184e49a036a1dd10dc537bef4ab034a5ad5e0\">2ab184e</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L178\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"178\"></td>\n          <td id=\"LC178\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">protected</span> <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Boolean</span>&gt; <span class=\"pl-en\">isLocalTopicActive</span>() { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L179\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"179\"></td>\n          <td id=\"LC179\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Optional</span>&lt;<span class=\"pl-smi\">Topic</span>&gt;&gt; <span class=\"pl-s1\">topicFuture</span> = <span class=\"pl-s1\">brokerService</span>.<span class=\"pl-en\">getTopics</span>().<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">localTopicName</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L180\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"180\"></td>\n          <td id=\"LC180\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">topicFuture</span> == <span class=\"pl-c1\">null</span>){ </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L181\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"181\"></td>\n          <td id=\"LC181\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">return</span> <span class=\"pl-smi\">CompletableFuture</span>.<span class=\"pl-en\">completedFuture</span>(<span class=\"pl-c1\">false</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L182\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"182\"></td>\n          <td id=\"LC182\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L183\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"183\"></td>\n          <td id=\"LC183\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-s1\">topicFuture</span>.<span class=\"pl-en\">thenApplyAsync</span>(<span class=\"pl-s1\">optional</span> -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L184\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"184\"></td>\n          <td id=\"LC184\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">optional</span>.<span class=\"pl-en\">isEmpty</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L185\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"185\"></td>\n          <td id=\"LC185\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">return</span> <span class=\"pl-c1\">false</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L186\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"186\"></td>\n          <td id=\"LC186\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L187\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"187\"></td>\n          <td id=\"LC187\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">return</span> <span class=\"pl-s1\">optional</span>.<span class=\"pl-en\">get</span>() == <span class=\"pl-s1\">localTopic</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L188\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"188\"></td>\n          <td id=\"LC188\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     }, <span class=\"pl-s1\">brokerService</span>.<span class=\"pl-en\">executor</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L189\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"189\"></td>\n          <td id=\"LC189\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\n<div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/2ab184e49a036a1dd10dc537bef4ab034a5ad5e0/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java#L529-L545\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 529 to 545\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/2ab184e49a036a1dd10dc537bef4ab034a5ad5e0\">2ab184e</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L529\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"529\"></td>\n          <td id=\"LC529\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Override</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L530\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"530\"></td>\n          <td id=\"LC530\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">public</span> <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Void</span>&gt; <span class=\"pl-en\">acknowledgeAsync</span>(<span class=\"pl-smi\">Messages</span>&lt;?&gt; <span class=\"pl-s1\">messages</span>, <span class=\"pl-smi\">Transaction</span> <span class=\"pl-s1\">txn</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L531\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"531\"></td>\n          <td id=\"LC531\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">List</span>&lt;<span class=\"pl-smi\">MessageId</span>&gt; <span class=\"pl-s1\">messageIds</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ArrayList</span>&lt;&gt;(<span class=\"pl-s1\">messages</span>.<span class=\"pl-en\">size</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L532\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"532\"></td>\n          <td id=\"LC532\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">Message</span>&lt;?&gt; <span class=\"pl-s1\">message</span>: <span class=\"pl-s1\">messages</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L533\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"533\"></td>\n          <td id=\"LC533\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">try</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L534\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"534\"></td>\n          <td id=\"LC534\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-en\">validateMessageId</span>(<span class=\"pl-s1\">message</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L535\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"535\"></td>\n          <td id=\"LC535\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">PulsarClientException</span> <span class=\"pl-s1\">e</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L536\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"536\"></td>\n          <td id=\"LC536\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">return</span> <span class=\"pl-smi\">FutureUtil</span>.<span class=\"pl-en\">failedFuture</span>(<span class=\"pl-s1\">e</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L537\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"537\"></td>\n          <td id=\"LC537\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L538\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"538\"></td>\n          <td id=\"LC538\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">messageIds</span>.<span class=\"pl-en\">add</span>(<span class=\"pl-s1\">message</span>.<span class=\"pl-en\">getMessageId</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L539\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"539\"></td>\n          <td id=\"LC539\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L540\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"540\"></td>\n          <td id=\"LC540\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">txn</span> != <span class=\"pl-c1\">null</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L541\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"541\"></td>\n          <td id=\"LC541\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">return</span> <span class=\"pl-en\">acknowledgeAsync</span>(<span class=\"pl-s1\">messageIds</span>, <span class=\"pl-s1\">txn</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L542\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"542\"></td>\n          <td id=\"LC542\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L543\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"543\"></td>\n          <td id=\"LC543\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">return</span> <span class=\"pl-en\">acknowledgeAsync</span>(<span class=\"pl-s1\">messageIds</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L544\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"544\"></td>\n          <td id=\"LC544\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L545\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"545\"></td>\n          <td id=\"LC545\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\"><strong>2.Indent of wrong length</strong><br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/2ab184e49a036a1dd10dc537bef4ab034a5ad5e0/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractDispatcherSingleActiveConsumer.java#L87-L92\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractDispatcherSingleActiveConsumer.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 87 to 92\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/2ab184e49a036a1dd10dc537bef4ab034a5ad5e0\">2ab184e</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L87\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"87\"></td>\n          <td id=\"LC87\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">protected</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">notifyActiveConsumerChanged</span>(<span class=\"pl-smi\">Consumer</span> <span class=\"pl-s1\">activeConsumer</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L88\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"88\"></td>\n          <td id=\"LC88\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-c1\">null</span> != <span class=\"pl-s1\">activeConsumer</span> &amp;&amp; <span class=\"pl-s1\">subscriptionType</span> == <span class=\"pl-smi\">SubType</span>.<span class=\"pl-s1\">Failover</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L89\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"89\"></td>\n          <td id=\"LC89\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">consumers</span>.<span class=\"pl-en\">forEach</span>(<span class=\"pl-s1\">consumer</span> -&gt; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L90\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"90\"></td>\n          <td id=\"LC90\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">consumer</span>.<span class=\"pl-en\">notifyActiveConsumerChange</span>(<span class=\"pl-s1\">activeConsumer</span>)); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L91\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"91\"></td>\n          <td id=\"LC91\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L92\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"92\"></td>\n          <td id=\"LC92\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\n<div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/2ab184e49a036a1dd10dc537bef4ab034a5ad5e0/pulsar-client-tools/src/main/java/org/apache/pulsar/client/cli/AbstractCmdConsume.java#L136-L148\">pulsar/pulsar-client-tools/src/main/java/org/apache/pulsar/client/cli/AbstractCmdConsume.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 136 to 148\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/2ab184e49a036a1dd10dc537bef4ab034a5ad5e0\">2ab184e</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L136\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"136\"></td>\n          <td id=\"LC136\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">protected</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Object</span>&gt; <span class=\"pl-en\">genericObjectToMap</span>(<span class=\"pl-smi\">GenericObject</span> <span class=\"pl-s1\">value</span>, <span class=\"pl-smi\">boolean</span> <span class=\"pl-s1\">displayHex</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L137\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"137\"></td>\n          <td id=\"LC137\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">IOException</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L138\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"138\"></td>\n          <td id=\"LC138\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">switch</span> (<span class=\"pl-s1\">value</span>.<span class=\"pl-en\">getSchemaType</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L139\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"139\"></td>\n          <td id=\"LC139\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">case</span> <span class=\"pl-c1\">AVRO</span>: </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L140\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"140\"></td>\n          <td id=\"LC140\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">case</span> <span class=\"pl-c1\">JSON</span>: </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L141\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"141\"></td>\n          <td id=\"LC141\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">case</span> <span class=\"pl-c1\">PROTOBUF_NATIVE</span>: </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L142\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"142\"></td>\n          <td id=\"LC142\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">return</span> <span class=\"pl-en\">genericRecordToMap</span>((<span class=\"pl-smi\">GenericRecord</span>) <span class=\"pl-s1\">value</span>, <span class=\"pl-s1\">displayHex</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L143\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"143\"></td>\n          <td id=\"LC143\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">case</span> <span class=\"pl-c1\">KEY_VALUE</span>: </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L144\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"144\"></td>\n          <td id=\"LC144\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">return</span> <span class=\"pl-en\">keyValueToMap</span>((<span class=\"pl-smi\">KeyValue</span>) <span class=\"pl-s1\">value</span>.<span class=\"pl-en\">getNativeObject</span>(), <span class=\"pl-s1\">displayHex</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L145\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"145\"></td>\n          <td id=\"LC145\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">default</span>: </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L146\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"146\"></td>\n          <td id=\"LC146\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">return</span> <span class=\"pl-en\">primitiveValueToMap</span>(<span class=\"pl-s1\">value</span>.<span class=\"pl-en\">getNativeObject</span>(), <span class=\"pl-s1\">displayHex</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L147\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"147\"></td>\n          <td id=\"LC147\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L148\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"148\"></td>\n          <td id=\"LC148\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\n<div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/2ab184e49a036a1dd10dc537bef4ab034a5ad5e0/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java#L738-L757\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 738 to 757\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/2ab184e49a036a1dd10dc537bef4ab034a5ad5e0\">2ab184e</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L738\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"738\"></td>\n          <td id=\"LC738\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">protected</span> <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Optional</span>&lt;<span class=\"pl-smi\">Long</span>&gt;&gt; <span class=\"pl-en\">incrementTopicEpochIfNeeded</span>(<span class=\"pl-smi\">Producer</span> <span class=\"pl-s1\">producer</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L739\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"739\"></td>\n          <td id=\"LC739\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Void</span>&gt; <span class=\"pl-s1\">producerQueuedFuture</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L740\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"740\"></td>\n          <td id=\"LC740\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">lock</span>.<span class=\"pl-en\">writeLock</span>().<span class=\"pl-en\">lock</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L741\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"741\"></td>\n          <td id=\"LC741\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">try</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L742\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"742\"></td>\n          <td id=\"LC742\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">switch</span> (<span class=\"pl-s1\">producer</span>.<span class=\"pl-en\">getAccessMode</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L743\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"743\"></td>\n          <td id=\"LC743\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">case</span> <span class=\"pl-s1\">Shared</span>: </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L744\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"744\"></td>\n          <td id=\"LC744\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">hasExclusiveProducer</span> || !<span class=\"pl-s1\">waitingExclusiveProducers</span>.<span class=\"pl-en\">isEmpty</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L745\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"745\"></td>\n          <td id=\"LC745\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">return</span> <span class=\"pl-smi\">FutureUtil</span>.<span class=\"pl-en\">failedFuture</span>( </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L746\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"746\"></td>\n          <td id=\"LC746\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ProducerBusyException</span>( </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L747\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"747\"></td>\n          <td id=\"LC747\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                 <span class=\"pl-s\">\"Topic has an existing exclusive producer: \"</span> + <span class=\"pl-s1\">exclusiveProducerName</span>)); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L748\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"748\"></td>\n          <td id=\"LC748\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L749\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"749\"></td>\n          <td id=\"LC749\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-c\">// Normal producer getting added, we don't need a new epoch</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L750\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"750\"></td>\n          <td id=\"LC750\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">return</span> <span class=\"pl-smi\">CompletableFuture</span>.<span class=\"pl-en\">completedFuture</span>(<span class=\"pl-s1\">topicEpoch</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L751\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"751\"></td>\n          <td id=\"LC751\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L752\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"752\"></td>\n          <td id=\"LC752\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L753\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"753\"></td>\n          <td id=\"LC753\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">case</span> <span class=\"pl-s1\">Exclusive</span>: </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L754\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"754\"></td>\n          <td id=\"LC754\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">hasExclusiveProducer</span> || !<span class=\"pl-s1\">waitingExclusiveProducers</span>.<span class=\"pl-en\">isEmpty</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L755\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"755\"></td>\n          <td id=\"LC755\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">return</span> <span class=\"pl-smi\">FutureUtil</span>.<span class=\"pl-en\">failedFuture</span>( </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L756\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"756\"></td>\n          <td id=\"LC756\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ProducerFencedException</span>( </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L757\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"757\"></td>\n          <td id=\"LC757\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                 <span class=\"pl-s\">\"Topic has an existing exclusive producer: \"</span> + <span class=\"pl-s1\">exclusiveProducerName</span>)); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\"><strong>I counted a lot of code with these problems:</strong><br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/54846009/259453159-b599040a-57c1-4240-a5be-11603fcea495.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxOTYsIm5iZiI6MTcxNDk3MTg5NiwicGF0aCI6Ii81NDg0NjAwOS8yNTk0NTMxNTktYjU5OTA0MGEtNTdjMS00MjQwLWE1YmUtMTE2MDNmY2VhNDk1LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDQ1NlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTcxMmI5MzdiZjZkYWFjOTM0ODg2ODM3NTYyZDBlNzFlZTc3ZWQxMDI1ZWI4NWRkMzYyNWUwYmVhNDEzM2FmZmYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.8T5HheBAw-m-XbwU9PbB1CYShI_bVilTioJShe6fdhY\"><img width=\"600\" alt=\"Snipaste_2023-08-09_22-38-09\" src=\"https://private-user-images.githubusercontent.com/54846009/259453159-b599040a-57c1-4240-a5be-11603fcea495.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIxOTYsIm5iZiI6MTcxNDk3MTg5NiwicGF0aCI6Ii81NDg0NjAwOS8yNTk0NTMxNTktYjU5OTA0MGEtNTdjMS00MjQwLWE1YmUtMTE2MDNmY2VhNDk1LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDQ1NlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTcxMmI5MzdiZjZkYWFjOTM0ODg2ODM3NTYyZDBlNzFlZTc3ZWQxMDI1ZWI4NWRkMzYyNWUwYmVhNDEzM2FmZmYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.8T5HheBAw-m-XbwU9PbB1CYShI_bVilTioJShe6fdhY\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">1.change <code class=\"notranslate\">WhitespaceAround</code></p>\n<div class=\"highlight highlight-text-xml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"&lt;module name=&quot;WhitespaceAround&quot;&gt;\n      &lt;!-- Checks that various tokens are surrounded by whitespace.\n           This includes most binary operators and keywords followed\n           by regular or curly braces.\n      --&gt;\n      &lt;property name=&quot;ignoreEnhancedForColon&quot; value=&quot;false&quot; /&gt;\n      &lt;property name=&quot;tokens&quot; value=&quot;ASSIGN, BAND, BAND_ASSIGN, BOR,\n  BOR_ASSIGN, BSR, BSR_ASSIGN, BXOR, BXOR_ASSIGN, COLON, DIV, DIV_ASSIGN, DO_WHILE,\n  EQUAL, GE, GT, LAND, LAMBDA, LE, LITERAL_ASSERT,  LITERAL_CATCH, LITERAL_DO, LITERAL_ELSE,\n  LITERAL_FINALLY, LITERAL_FOR, LITERAL_IF, LITERAL_RETURN, LITERAL_SWITCH,\n  LITERAL_SYNCHRONIZED, LITERAL_TRY, LITERAL_WHILE, LOR, LT, MINUS,\n  MINUS_ASSIGN, MOD, MOD_ASSIGN, NOT_EQUAL, PLUS, PLUS_ASSIGN, QUESTION,\n  SL, SLIST, SL_ASSIGN, SR, SR_ASSIGN, STAR, STAR_ASSIGN, TYPE_EXTENSION_AND&quot;/&gt;\n      &lt;property name=&quot;severity&quot; value=&quot;error&quot;/&gt;\n  &lt;/module&gt;\"><pre class=\"notranslate\">&lt;<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>WhitespaceAround<span class=\"pl-pds\">\"</span></span>&gt;\n      <span class=\"pl-c\"><span class=\"pl-c\">&lt;!--</span> Checks that various tokens are surrounded by whitespace.</span>\n<span class=\"pl-c\">           This includes most binary operators and keywords followed</span>\n<span class=\"pl-c\">           by regular or curly braces.</span>\n<span class=\"pl-c\">      <span class=\"pl-c\">--&gt;</span></span>\n      &lt;<span class=\"pl-ent\">property</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ignoreEnhancedForColon<span class=\"pl-pds\">\"</span></span> <span class=\"pl-e\">value</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>false<span class=\"pl-pds\">\"</span></span> /&gt;\n      &lt;<span class=\"pl-ent\">property</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>tokens<span class=\"pl-pds\">\"</span></span> <span class=\"pl-e\">value</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ASSIGN, BAND, BAND_ASSIGN, BOR,</span>\n<span class=\"pl-s\">  BOR_ASSIGN, BSR, BSR_ASSIGN, BXOR, BXOR_ASSIGN, COLON, DIV, DIV_ASSIGN, DO_WHILE,</span>\n<span class=\"pl-s\">  EQUAL, GE, GT, LAND, LAMBDA, LE, LITERAL_ASSERT,  LITERAL_CATCH, LITERAL_DO, LITERAL_ELSE,</span>\n<span class=\"pl-s\">  LITERAL_FINALLY, LITERAL_FOR, LITERAL_IF, LITERAL_RETURN, LITERAL_SWITCH,</span>\n<span class=\"pl-s\">  LITERAL_SYNCHRONIZED, LITERAL_TRY, LITERAL_WHILE, LOR, LT, MINUS,</span>\n<span class=\"pl-s\">  MINUS_ASSIGN, MOD, MOD_ASSIGN, NOT_EQUAL, PLUS, PLUS_ASSIGN, QUESTION,</span>\n<span class=\"pl-s\">  SL, SLIST, SL_ASSIGN, SR, SR_ASSIGN, STAR, STAR_ASSIGN, TYPE_EXTENSION_AND<span class=\"pl-pds\">\"</span></span>/&gt;\n      &lt;<span class=\"pl-ent\">property</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>severity<span class=\"pl-pds\">\"</span></span> <span class=\"pl-e\">value</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>error<span class=\"pl-pds\">\"</span></span>/&gt;\n  &lt;/<span class=\"pl-ent\">module</span>&gt;</pre></div>\n<p dir=\"auto\">2.add this rule</p>\n<div class=\"highlight highlight-text-xml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"&lt;module name=&quot;Indentation&quot;&gt;\n    &lt;property name=&quot;throwsIndent&quot; value=&quot;8&quot; /&gt;\n    &lt;property name=&quot;lineWrappingIndentation&quot; value=&quot;8&quot; /&gt;\n&lt;/module&gt;\"><pre class=\"notranslate\">&lt;<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Indentation<span class=\"pl-pds\">\"</span></span>&gt;\n    &lt;<span class=\"pl-ent\">property</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>throwsIndent<span class=\"pl-pds\">\"</span></span> <span class=\"pl-e\">value</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>8<span class=\"pl-pds\">\"</span></span> /&gt;\n    &lt;<span class=\"pl-ent\">property</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>lineWrappingIndentation<span class=\"pl-pds\">\"</span></span> <span class=\"pl-e\">value</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>8<span class=\"pl-pds\">\"</span></span> /&gt;\n&lt;/<span class=\"pl-ent\">module</span>&gt;</pre></div>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">Other discussions on code styles:<br>\n<a href=\"https://lists.apache.org/thread/qoqg33wpl5099c3dwcb1ry0gn4mr7z4q\" rel=\"nofollow\">https://lists.apache.org/thread/qoqg33wpl5099c3dwcb1ry0gn4mr7z4q</a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20967",
                "createdAt": "2023-08-09T15:02:21Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix compaction subscription delete by inactive subscription check.",
        "url": "https://github.com/apache/pulsar/pull/20983",
        "resourcePath": "/apache/pulsar/pull/20983",
        "createdAt": "2023-08-12T06:43:47Z",
        "number": 20983,
        "mergeCommit": {
          "oid": "43cd86d6835b4b096739e510f9fa928a64e46ac9",
          "message": "[fix][broker] Fix compaction subscription delete by inactive subscription check. (#20983)",
          "commitUrl": "https://github.com/apache/pulsar/commit/43cd86d6835b4b096739e510f9fa928a64e46ac9",
          "parents": {
            "nodes": [
              {
                "oid": "dbbaddb6dbdf2b5a2eaaa93a1ece37a31326a42b",
                "message": "[improve][pip] PIP-293: Delete config `disableBrokerInterceptors` (#20993)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Xx3p22gAoMTI4ZmYzZmRiOThiMmU3MzM4YmI2ODIyNzA1YmI3NzNiYWVmYjRiNA",
                "url": "https://github.com/apache/pulsar/pull/20983/commits/128ff3fdb98b2e7338bb6822705bb773baefb4b4"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20982,
                "url": "https://github.com/apache/pulsar/issues/20982",
                "title": "[Bug] Compaction cursor deleted by inactive subscription check",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master branch.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>enable compaction.</li>\n<li>enable SubscriptionExpiration set to 1 minute.</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">__compaction subscription should not be deleted.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">2023-08-12T13:56:30,821 - INFO  - [main:PersistentTopic@2752] - [persistent://prop/test/testCompactionCursorShouldNotDelete][__compaction] The subscription was deleted due to expiration with last active [1691819767437]</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">no</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20982",
                "createdAt": "2023-08-12T05:59:38Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix incorrect unack msk count when dup ack a message",
        "url": "https://github.com/apache/pulsar/pull/20990",
        "resourcePath": "/apache/pulsar/pull/20990",
        "createdAt": "2023-08-15T02:03:47Z",
        "number": 20990,
        "mergeCommit": {
          "oid": "4facdad9c7e8f6558dfb71b230aa8260e57b559e",
          "message": "[fix][broker] Fix incorrect unack msk count when dup ack a message (#20990)",
          "commitUrl": "https://github.com/apache/pulsar/commit/4facdad9c7e8f6558dfb71b230aa8260e57b559e",
          "parents": {
            "nodes": [
              {
                "oid": "3160b76fb6223012b366bdfe81d0ad7e25000cf1",
                "message": "[fix][test] fix flaky testSplitBundleAdminApi (#21019)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Consumer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5X79Mr2gAoZmRhYzkxNzU4N2RkNWY5M2E1YjI3ZTQzOTM1YWQ0ZWI1NzAxNzcyYw",
                "url": "https://github.com/apache/pulsar/pull/20990/commits/fdac917587dd5f93a5b27e43935ad4eb5701772c"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19268,
                "url": "https://github.com/apache/pulsar/issues/19268",
                "title": "[Bug] Acknowledge the same message-id causes inconsistency unackedMessages number.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">all</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"/**\n     * This test is used to test the unackedMessage number in the consumer.\n     */\n    @Test\n    public void testDuplicateAcknowledgement() throws PulsarClientException, PulsarAdminException {\n        final String topicName = &quot;persistent://public/default/duplicated-acknowledgement-test&quot;;\n        @Cleanup\n        Producer&lt;byte[]&gt; producer = pulsarClient.newProducer()\n                .topic(topicName)\n                .create();\n        @Cleanup\n        Consumer&lt;byte[]&gt; consumer1 = pulsarClient.newConsumer()\n                .topic(topicName)\n                .subscriptionName(&quot;sub-1&quot;)\n                .acknowledgmentGroupTime(0, TimeUnit.SECONDS)\n                .subscriptionType(SubscriptionType.Shared)\n                .subscribe();\n        producer.send(&quot;1&quot;.getBytes(StandardCharsets.UTF_8));\n        Message&lt;byte[]&gt; message = consumer1.receive();\n        consumer1.acknowledge(message);\n        consumer1.acknowledge(message);\n        assertEquals(admin.topics().getStats(topicName).getSubscriptions()\n                .get(&quot;sub-1&quot;).getUnackedMessages(), 0);\n    }\"><pre class=\"notranslate\"><span class=\"pl-c\">/**</span>\n<span class=\"pl-c\">     * This test is used to test the unackedMessage number in the consumer.</span>\n<span class=\"pl-c\">     */</span>\n    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Test</span>\n    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">testDuplicateAcknowledgement</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">PulsarClientException</span>, <span class=\"pl-s1\">PulsarAdminException</span> {\n        <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">topicName</span> = <span class=\"pl-s\">\"persistent://public/default/duplicated-acknowledgement-test\"</span>;\n        <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Cleanup</span>\n        <span class=\"pl-smi\">Producer</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">producer</span> = <span class=\"pl-s1\">pulsarClient</span>.<span class=\"pl-en\">newProducer</span>()\n                .<span class=\"pl-en\">topic</span>(<span class=\"pl-s1\">topicName</span>)\n                .<span class=\"pl-en\">create</span>();\n        <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Cleanup</span>\n        <span class=\"pl-smi\">Consumer</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">consumer1</span> = <span class=\"pl-s1\">pulsarClient</span>.<span class=\"pl-en\">newConsumer</span>()\n                .<span class=\"pl-en\">topic</span>(<span class=\"pl-s1\">topicName</span>)\n                .<span class=\"pl-en\">subscriptionName</span>(<span class=\"pl-s\">\"sub-1\"</span>)\n                .<span class=\"pl-en\">acknowledgmentGroupTime</span>(<span class=\"pl-c1\">0</span>, <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">SECONDS</span>)\n                .<span class=\"pl-en\">subscriptionType</span>(<span class=\"pl-smi\">SubscriptionType</span>.<span class=\"pl-s1\">Shared</span>)\n                .<span class=\"pl-en\">subscribe</span>();\n        <span class=\"pl-s1\">producer</span>.<span class=\"pl-en\">send</span>(<span class=\"pl-s\">\"1\"</span>.<span class=\"pl-en\">getBytes</span>(<span class=\"pl-smi\">StandardCharsets</span>.<span class=\"pl-c1\">UTF_8</span>));\n        <span class=\"pl-smi\">Message</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">message</span> = <span class=\"pl-s1\">consumer1</span>.<span class=\"pl-en\">receive</span>();\n        <span class=\"pl-s1\">consumer1</span>.<span class=\"pl-en\">acknowledge</span>(<span class=\"pl-s1\">message</span>);\n        <span class=\"pl-s1\">consumer1</span>.<span class=\"pl-en\">acknowledge</span>(<span class=\"pl-s1\">message</span>);\n        <span class=\"pl-en\">assertEquals</span>(<span class=\"pl-s1\">admin</span>.<span class=\"pl-en\">topics</span>().<span class=\"pl-en\">getStats</span>(<span class=\"pl-s1\">topicName</span>).<span class=\"pl-en\">getSubscriptions</span>()\n                .<span class=\"pl-en\">get</span>(<span class=\"pl-s\">\"sub-1\"</span>).<span class=\"pl-en\">getUnackedMessages</span>(), <span class=\"pl-c1\">0</span>);\n    }</pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\"><code class=\"notranslate\">unackedMessages=0</code>.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\"><code class=\"notranslate\">unackedMessages=-1</code>.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19268",
                "createdAt": "2023-01-18T06:13:57Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "help wanted"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][io] Update test certs for Elasticsearch",
        "url": "https://github.com/apache/pulsar/pull/21001",
        "resourcePath": "/apache/pulsar/pull/21001",
        "createdAt": "2023-08-15T22:48:44Z",
        "number": 21001,
        "mergeCommit": {
          "oid": "d6734b76b14aedd800116218b02ae607b93df9d1",
          "message": "[fix][io] Update test certs for Elasticsearch (#21001)\n\nFixes: #20997 \r\n\r\n### Motivation\r\n\r\nUpdate the expired certs to get tests passing.\r\n\r\n### Modifications\r\n\r\n* Update all certs. See `README.md` in files for detailed steps.\r\n\r\n### Verifying this change\r\n\r\nThis change is covered by tests.\r\n\r\n### Documentation\r\n\r\n- [x] `doc-not-needed`",
          "commitUrl": "https://github.com/apache/pulsar/commit/d6734b76b14aedd800116218b02ae607b93df9d1",
          "parents": {
            "nodes": [
              {
                "oid": "9127d89a1313ed5897357dfcbf50ca593c174a3d",
                "message": "[pip][design] PIP-281: Add notifyError method on PushSource (#20807)\n\nCo-authored-by: Anonymitaet <50226895+Anonymitaet@users.noreply.github.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-io/elastic-search/src/test/resources/ssl/README.md"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/elastic-search/src/test/resources/ssl/cacert.crt"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/elastic-search/src/test/resources/ssl/cacert.pem"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/elastic-search/src/test/resources/ssl/elasticsearch.crt"
              }
            },
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-io/elastic-search/src/test/resources/ssl/elasticsearch.jks"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/elastic-search/src/test/resources/ssl/elasticsearch.key"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/elastic-search/src/test/resources/ssl/elasticsearch.pem"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/elastic-search/src/test/resources/ssl/keystore.jks"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/elastic-search/src/test/resources/ssl/truststore.jks"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5YAyu42gAoZjBlZDRiYjFlYjk5YmY3MjZiNjA4OWUwYWNkOGI2NWY1NzJlNzMzNg",
                "url": "https://github.com/apache/pulsar/pull/21001/commits/f0ed4bb1eb99bf726b6089e0acd8b65f572e7336"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20997,
                "url": "https://github.com/apache/pulsar/issues/20997",
                "title": "Flaky-test: ElasticSearch8ClientSslTests.testSslBasic",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/5864096913/job/15906097733?pr=20990\">https://github.com/apache/pulsar/actions/runs/5864096913/job/15906097733?pr=20990</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"   Error:  Tests run: 5, Failures: 1, Errors: 0, Skipped: 4, Time elapsed: 603.24 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.io.elasticsearch.v8.ElasticSearch8ClientSslTests\n  Error:  org.apache.pulsar.io.elasticsearch.v8.ElasticSearch8ClientSslTests.testSslBasic  Time elapsed: 300.01 s  &lt;&lt;&lt; FAILURE!\n  org.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.io.elasticsearch.ElasticSearchClientSslTests.testSslBasic() didn't finish within the time-out 300000\n  \tat java.base@17.0.8/java.lang.Thread.sleep(Native Method)\n  \tat app//org.apache.pulsar.io.elasticsearch.RandomExponentialRetry$Time.sleep(RandomExponentialRetry.java:85)\n  \tat app//org.apache.pulsar.io.elasticsearch.RandomExponentialRetry.retry(RandomExponentialRetry.java:76)\n  \tat app//org.apache.pulsar.io.elasticsearch.RandomExponentialRetry.retry(RandomExponentialRetry.java:62)\n  \tat app//org.apache.pulsar.io.elasticsearch.ElasticSearchClient.retry(ElasticSearchClient.java:341)\n  \tat app//org.apache.pulsar.io.elasticsearch.ElasticSearchClient.&lt;init&gt;(ElasticSearchClient.java:96)\n  \tat app//org.apache.pulsar.io.elasticsearch.ElasticSearchClientSslTests.testClientWithConfig(ElasticSearchClientSslTests.java:186)\n  \tat app//org.apache.pulsar.io.elasticsearch.ElasticSearchClientSslTests.testSslBasic(ElasticSearchClientSslTests.java:74)\n  \tat java.base@17.0.8/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base@17.0.8/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base@17.0.8/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base@17.0.8/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat app//org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base@17.0.8/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base@17.0.8/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base@17.0.8/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base@17.0.8/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">   Error:  Tests run: 5, Failures: 1, Errors: 0, Skipped: 4, Time elapsed: 603.24 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.io.elasticsearch.v8.ElasticSearch8ClientSslTests\n  Error:  org.apache.pulsar.io.elasticsearch.v8.ElasticSearch8ClientSslTests.testSslBasic  Time elapsed: 300.01 s  &lt;&lt;&lt; FAILURE!\n  org.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.io.elasticsearch.ElasticSearchClientSslTests.testSslBasic() didn't finish within the time-out 300000\n  \tat java.base@17.0.8/java.lang.Thread.sleep(Native Method)\n  \tat app//org.apache.pulsar.io.elasticsearch.RandomExponentialRetry$Time.sleep(RandomExponentialRetry.java:85)\n  \tat app//org.apache.pulsar.io.elasticsearch.RandomExponentialRetry.retry(RandomExponentialRetry.java:76)\n  \tat app//org.apache.pulsar.io.elasticsearch.RandomExponentialRetry.retry(RandomExponentialRetry.java:62)\n  \tat app//org.apache.pulsar.io.elasticsearch.ElasticSearchClient.retry(ElasticSearchClient.java:341)\n  \tat app//org.apache.pulsar.io.elasticsearch.ElasticSearchClient.&lt;init&gt;(ElasticSearchClient.java:96)\n  \tat app//org.apache.pulsar.io.elasticsearch.ElasticSearchClientSslTests.testClientWithConfig(ElasticSearchClientSslTests.java:186)\n  \tat app//org.apache.pulsar.io.elasticsearch.ElasticSearchClientSslTests.testSslBasic(ElasticSearchClientSslTests.java:74)\n  \tat java.base@17.0.8/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base@17.0.8/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base@17.0.8/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base@17.0.8/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat app//org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base@17.0.8/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base@17.0.8/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base@17.0.8/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base@17.0.8/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20997",
                "createdAt": "2023-08-15T16:57:00Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker]  Fix PulsarService.getLookupServiceAddress returns wrong port if TLS is enabled",
        "url": "https://github.com/apache/pulsar/pull/21015",
        "resourcePath": "/apache/pulsar/pull/21015",
        "createdAt": "2023-08-17T12:38:12Z",
        "number": 21015,
        "mergeCommit": {
          "oid": "1363777918547b0f56bdbbf04cec28d050a43586",
          "message": "[fix][broker]  Fix PulsarService.getLookupServiceAddress returns wrong port if TLS is enabled (#21015)",
          "commitUrl": "https://github.com/apache/pulsar/commit/1363777918547b0f56bdbbf04cec28d050a43586",
          "parents": {
            "nodes": [
              {
                "oid": "62a88f9f8e8bde31f71b0dc0bad3fc47e6de131c",
                "message": "[fix][doc] fix doc comment for subscriptionType (#20987)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/transaction/TransactionTestBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/BrokerServiceLookupTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/ClientAuthenticationTlsTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyRefreshAuthTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyServiceTlsStarterTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/containers/BrokerContainer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/containers/ProxyContainer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/tls/ClientTlsTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/topologies/PulsarCluster.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/topologies/PulsarClusterSpec.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5YJ1wc2gAoNzA4MmYzM2NiOTUxZWY1MjlkZjFlYjA1NTJiOTcwMjRiZTNlNjE4Zg",
                "url": "https://github.com/apache/pulsar/pull/21015/commits/7082f33cb951ef529df1eb0552b97024be3e618f"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21012,
                "url": "https://github.com/apache/pulsar/issues/21012",
                "title": "[Bug] PulsarService.getLookupServiceAddress returns wrong port if TLS is enabled",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar 3.1.0 but also broken on master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Start pulsar standalone with TLS configured using e.g. port 8081 for TLS</li>\n<li>Run pulsarAdmin.brokers().getActiveBrokers()</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">The return value should be <code class=\"notranslate\">localhost:8081</code> (using TLS port)</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The return value is <code class=\"notranslate\">localhost:8080</code> (not using TLS port)</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The value is ultimately retrieved from <code class=\"notranslate\">PulsarService.getLookupServiceAddress</code>.<br>\nI believe the code below should be the other way around, first checking if a TLS address is available and if not fall back to the non tls one:</p>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java#L1740-L1743\">https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java#L1740-L1743</a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21012",
                "createdAt": "2023-08-17T09:04:33Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] fix flaky testSplitBundleAdminApi",
        "url": "https://github.com/apache/pulsar/pull/21019",
        "resourcePath": "/apache/pulsar/pull/21019",
        "createdAt": "2023-08-17T20:50:16Z",
        "number": 21019,
        "mergeCommit": {
          "oid": "3160b76fb6223012b366bdfe81d0ad7e25000cf1",
          "message": "[fix][test] fix flaky testSplitBundleAdminApi (#21019)",
          "commitUrl": "https://github.com/apache/pulsar/commit/3160b76fb6223012b366bdfe81d0ad7e25000cf1",
          "parents": {
            "nodes": [
              {
                "oid": "4a9fec693b90fcb76aea9a98a94de31608b56bab",
                "message": "[fix][broker] Fix consumers are not redirected to migrated cluster (#20928)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/loadbalance/ExtensibleLoadManagerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5YMeMO2gAoMDFhMzA1ZGI4NzM3NGUzZGU1ZjM0OTJkN2EyMTVjODk2N2Y5OWIzMQ",
                "url": "https://github.com/apache/pulsar/pull/21019/commits/01a305db87374e3de5f3492d7a215c8967f99b31"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 19908,
                "url": "https://github.com/apache/pulsar/issues/19908",
                "title": "Flaky-test: ExtensibleLoadManagerImplTest.testSplitBundleAdminAPI",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4496824499/jobs/7912653752?pr=19899#step:11:1584\">https://github.com/apache/pulsar/actions/runs/4496824499/jobs/7912653752?pr=19899#step:11:1584</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  testSplitBundleAdminAPI(org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest)  Time elapsed: 0 s  &lt;&lt;&lt; FAILURE!\n  java.lang.NullPointerException: Cannot invoke &quot;org.apache.pulsar.client.admin.PulsarAdmin.topics()&quot; because &quot;this.admin&quot; is null\n  \tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest.testSplitBundleAdminAPI(ExtensibleLoadManagerImplTest.java:380)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  testSplitBundleAdminAPI(org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest)  Time elapsed: 0 s  &lt;&lt;&lt; FAILURE!\n  java.lang.NullPointerException: Cannot invoke \"org.apache.pulsar.client.admin.PulsarAdmin.topics()\" because \"this.admin\" is null\n  \tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest.testSplitBundleAdminAPI(ExtensibleLoadManagerImplTest.java:380)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/19908",
                "createdAt": "2023-03-23T09:10:04Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Fix the --batch-builder not working error for functions",
        "url": "https://github.com/apache/pulsar/pull/21023",
        "resourcePath": "/apache/pulsar/pull/21023",
        "createdAt": "2023-08-18T06:29:41Z",
        "number": 21023,
        "mergeCommit": {
          "oid": "29addaacbdd280675d2682dc9c6f83b368063eb1",
          "message": "[fix][fn] Fix the --batch-builder not working error for functions (#21023)",
          "commitUrl": "https://github.com/apache/pulsar/commit/29addaacbdd280675d2682dc9c6f83b368063eb1",
          "parents": {
            "nodes": [
              {
                "oid": "35bb021cdbd9cc9f4f801bd14f95d035a76a0043",
                "message": "[fix][client] Fix repeat consume when using n-ack and batched messages (#21116)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/FunctionConfigUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/utils/src/test/java/org/apache/pulsar/functions/utils/FunctionConfigUtilsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5YN9Z22gAoOTMzNmVlNTMwMmE1ZjY5NzI1YzEzZTU0NmZlMDE3MjhmMmEyOWZmZQ",
                "url": "https://github.com/apache/pulsar/pull/21023/commits/9336ee5302a5f69725c13e546fe01728f2a29ffe"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21022,
                "url": "https://github.com/apache/pulsar/issues/21022",
                "title": "[Bug] --batch-builder parameter doesn't work for function creating/updating",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\"><a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/apache/pulsar/commit/4a9fec693b90fcb76aea9a98a94de31608b56bab/hovercard\" href=\"https://github.com/apache/pulsar/commit/4a9fec693b90fcb76aea9a98a94de31608b56bab\"><tt>4a9fec6</tt></a></p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">create function with <code class=\"notranslate\">--batch-builder</code> specified:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"./bin/pulsar-admin functions create --tenant public --namespace default --name test --batch-builder KEY_BASED -inputs input-topic --className org.apache.pulsar.functions.api.examples.ExclamationFunction --jar examples/api-examples.jar\"><pre class=\"notranslate\"><code class=\"notranslate\">./bin/pulsar-admin functions create --tenant public --namespace default --name test --batch-builder KEY_BASED -inputs input-topic --className org.apache.pulsar.functions.api.examples.ExclamationFunction --jar examples/api-examples.jar\n</code></pre></div>\n<p dir=\"auto\">and then get the function</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"./bin/pulsar-admin functions get --tenant public --namespace default --name test\"><pre class=\"notranslate\"><code class=\"notranslate\">./bin/pulsar-admin functions get --tenant public --namespace default --name test\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">the returned <code class=\"notranslate\">producerConf</code> should contain the <code class=\"notranslate\">batchBuilder: KEY_BASED</code></p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">the returned <code class=\"notranslate\">producerConf</code> doesn't contain the <code class=\"notranslate\">batchBuilder: KEY_BASED</code></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21022",
                "createdAt": "2023-08-18T06:22:00Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "area/function"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] fix UniformLoadShedder selecet wrong overloadbroker and underloadbroker",
        "url": "https://github.com/apache/pulsar/pull/21025",
        "resourcePath": "/apache/pulsar/pull/21025",
        "createdAt": "2023-08-18T07:23:19Z",
        "number": 21025,
        "mergeCommit": {
          "oid": "fc86f3b5f066bc71840d42d1163e85f048216aa7",
          "message": "[fix][broker] fix UniformLoadShedder seleet wrong overloadbroker and underloadbroker (#21025)",
          "commitUrl": "https://github.com/apache/pulsar/commit/fc86f3b5f066bc71840d42d1163e85f048216aa7",
          "parents": {
            "nodes": [
              {
                "oid": "f2b9a3fffd4aad414ba5f35ebff17502cb64eb12",
                "message": "[fix] [client] fix same producer/consumer use more than one connection per broker (#21144)\n\nMotivation: Pulsar has two mechanisms to guarantee that a producer connects to the broker multiple times the result is still correct.\r\n\r\n- In a connection, the second connection waits for the first connection to complete.\r\n- In a topic, the second connection will override the previous one.\r\n\r\nHowever, if a producer can use different connections to connect to the broker, these two mechanisms will not work.\r\n\r\nWhen the config `connectionsPerBroker` of `PulsarClient` is larger than `1`, a producer could use more than one connection, leading to the error above. You can reproduce this issue by the test `testSelectConnectionForSameProducer.`\r\n\r\nModifications: Make the same producer/consumer usage the same connection"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/UniformLoadShedder.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/impl/UniformLoadShedderTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5YOMVD2gAoMGNkMGQyMzZhOGUzOTljYTBiZmU0OTU0N2I0Mzc2NTc0Mzk0ZDRkZQ",
                "url": "https://github.com/apache/pulsar/pull/21025/commits/0cd0d236a8e399ca0bfe49547b4376574394d4de"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21016,
                "url": "https://github.com/apache/pulsar/issues/21016",
                "title": "[Bug] UniformLoadShedder selects wrong overloadbroker and underloadbroker",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master branch</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>start some brokers whose LoadSheddingStrategy is  UniformLoadShedder</li>\n<li>make sure each of them has a different load like</li>\n</ol>\n<ul dir=\"auto\">\n<li>broker0  with msgRate 50000 and  throughput 50 MB</li>\n<li>broker1  with msgRate 60000 and  throughput 60 MB</li>\n<li>broker2  with msgRate 70000 and  throughput 70 MB</li>\n<li>broker3  with msgRate 10000 and  throughput 80 MB</li>\n<li>broker4  with msgRate 20000 and  throughput 10 MB</li>\n</ul>\n<ol start=\"3\" dir=\"auto\">\n<li>then UniformLoadShedder will select the wrong overload broker and underload broker for bundle unloading</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">broker2 should be selected as the overloaded broker since it has the highest msgRate and msgThroughtput</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">broker 4 may be  selected as the overload broker</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The root cause is:   </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/c890a8c15cd9d30518818377c3155776514f5a9c/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/UniformLoadShedder.java#L72-L86\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/UniformLoadShedder.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 72 to 86\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/c890a8c15cd9d30518818377c3155776514f5a9c\">c890a8c</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L72\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"72\"></td>\n          <td id=\"LC72\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">brokersData</span>.<span class=\"pl-en\">forEach</span>((<span class=\"pl-s1\">broker</span>, <span class=\"pl-s1\">data</span>) -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L73\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"73\"></td>\n          <td id=\"LC73\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">double</span> <span class=\"pl-s1\">msgRate</span> = <span class=\"pl-s1\">data</span>.<span class=\"pl-en\">getLocalData</span>().<span class=\"pl-en\">getMsgRateIn</span>() + <span class=\"pl-s1\">data</span>.<span class=\"pl-en\">getLocalData</span>().<span class=\"pl-en\">getMsgRateOut</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L74\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"74\"></td>\n          <td id=\"LC74\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">double</span> <span class=\"pl-s1\">throughputRate</span> = <span class=\"pl-s1\">data</span>.<span class=\"pl-en\">getLocalData</span>().<span class=\"pl-en\">getMsgThroughputIn</span>() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L75\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"75\"></td>\n          <td id=\"LC75\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             + <span class=\"pl-s1\">data</span>.<span class=\"pl-en\">getLocalData</span>().<span class=\"pl-en\">getMsgThroughputOut</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L76\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"76\"></td>\n          <td id=\"LC76\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">msgRate</span> &gt; <span class=\"pl-s1\">maxMsgRate</span>.<span class=\"pl-en\">getValue</span>() || <span class=\"pl-s1\">throughputRate</span> &gt; <span class=\"pl-s1\">maxThroughputRate</span>.<span class=\"pl-en\">getValue</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L77\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"77\"></td>\n          <td id=\"LC77\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">overloadedBroker</span>.<span class=\"pl-en\">setValue</span>(<span class=\"pl-s1\">broker</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L78\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"78\"></td>\n          <td id=\"LC78\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">maxMsgRate</span>.<span class=\"pl-en\">setValue</span>(<span class=\"pl-s1\">msgRate</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L79\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"79\"></td>\n          <td id=\"LC79\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">maxThroughputRate</span>.<span class=\"pl-en\">setValue</span>(<span class=\"pl-s1\">throughputRate</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L80\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"80\"></td>\n          <td id=\"LC80\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L81\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"81\"></td>\n          <td id=\"LC81\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">msgRate</span> &lt; <span class=\"pl-s1\">minMsgRate</span>.<span class=\"pl-en\">getValue</span>() || <span class=\"pl-s1\">throughputRate</span> &lt; <span class=\"pl-s1\">minThroughputRate</span>.<span class=\"pl-en\">getValue</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L82\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"82\"></td>\n          <td id=\"LC82\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">underloadedBroker</span>.<span class=\"pl-en\">setValue</span>(<span class=\"pl-s1\">broker</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L83\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"83\"></td>\n          <td id=\"LC83\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">minMsgRate</span>.<span class=\"pl-en\">setValue</span>(<span class=\"pl-s1\">msgRate</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L84\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"84\"></td>\n          <td id=\"LC84\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">minThroughputRate</span>.<span class=\"pl-en\">setValue</span>(<span class=\"pl-s1\">throughputRate</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L85\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"85\"></td>\n          <td id=\"LC85\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L86\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"86\"></td>\n          <td id=\"LC86\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> }); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">the update condition for the overload broker is <code class=\"notranslate\">if (msgRate &gt; maxMsgRate.getValue() || throughputRate &gt; maxThroughputRate.getValue())</code>,  which will update overload broker ethier msgRate &gt; maxMsgRate or the throughputRate &gt;maxThroughputRate.</p>\n<p dir=\"auto\">if  brokers' load is</p>\n<ul dir=\"auto\">\n<li>broker0  with msgRate 50000 and  throughput 50 MB</li>\n<li>broker1  with msgRate 60000 and  throughput 60 MB</li>\n<li>broker2  with msgRate 70000 and  throughput 70 MB</li>\n<li>broker3  with msgRate 10000 and  throughput 80 MB</li>\n<li>broker4  with msgRate 20000 and  throughput 10 MB</li>\n</ul>\n<p dir=\"auto\">then the broker4 will be selected as the overloaded broker, same with the underload broker selection.</p>",
                "resourcePath": "/apache/pulsar/issues/21016",
                "createdAt": "2023-08-17T14:33:40Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] fix topic policy is updated incorrectly when continuously use pulsar-admin to set policy",
        "url": "https://github.com/apache/pulsar/pull/21026",
        "resourcePath": "/apache/pulsar/pull/21026",
        "createdAt": "2023-08-18T08:19:07Z",
        "number": 21026,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerServiceException.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/TopicPoliciesTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/util/RetryUtil.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/policies/data/TopicPolicies.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5YOdE42gAoM2I4YmU3MzZlZTExNTI1YzVjZWUzNDJlYTc5ZDBhZGNkOTY1M2Q2Yw",
                "url": "https://github.com/apache/pulsar/pull/21026/commits/3b8be736ee11525c5cee342ea79d0adcd9653d6c"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21024,
                "url": "https://github.com/apache/pulsar/issues/21024",
                "title": "[Bug] Topic policy is updated incorrectly when continuously use pulsar-admin to set policy",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master branch</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Two incorrect case of topic policy</p>\n<p dir=\"auto\">case1:</p>\n<ol dir=\"auto\">\n<li>topic do not have topicPolicy</li>\n<li>use pulsar-admin to set retention for topic</li>\n<li>use pulsar-admin to set message ttl for topic</li>\n</ol>\n<p dir=\"auto\">case 2:</p>\n<ol dir=\"auto\">\n<li>topic have policy</li>\n<li>use pulsar-admin to set retention for topic,  update retentionTime to 1d</li>\n<li>use pulsar-admin to set retention for topic, update retentionTime to 2d</li>\n<li>use pulsar-admin to set message ttl for topic</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Both retention and ttl is set correctly</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">For case 1:</p>\n<ul dir=\"auto\">\n<li>Only ttl is set, retention is not set correctly.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/13505225/261279689-bd0f24a5-ac22-4b04-93ba-c4f86bcb2207.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIyNjksIm5iZiI6MTcxNDk3MTk2OSwicGF0aCI6Ii8xMzUwNTIyNS8yNjEyNzk2ODktYmQwZjI0YTUtYWMyMi00YjA0LTkzYmEtYzRmODZiY2IyMjA3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDYwOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTAxNDMzNGVlMjEyNTBiODY3MTJlZWIxODljNTExMDllMjYwOTFhODZlMTA2YjJlN2JlZTQzN2EwNmFkMmRjNGMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.6w3EB0WE6Obg8J3_ddi1RulnOjXDemK38gy5kSCeatA\"><img src=\"https://private-user-images.githubusercontent.com/13505225/261279689-bd0f24a5-ac22-4b04-93ba-c4f86bcb2207.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIyNjksIm5iZiI6MTcxNDk3MTk2OSwicGF0aCI6Ii8xMzUwNTIyNS8yNjEyNzk2ODktYmQwZjI0YTUtYWMyMi00YjA0LTkzYmEtYzRmODZiY2IyMjA3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDYwOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTAxNDMzNGVlMjEyNTBiODY3MTJlZWIxODljNTExMDllMjYwOTFhODZlMTA2YjJlN2JlZTQzN2EwNmFkMmRjNGMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.6w3EB0WE6Obg8J3_ddi1RulnOjXDemK38gy5kSCeatA\" alt=\"image\" style=\"max-width: 100%;\"></a></li>\n</ul>\n<p dir=\"auto\">For case 2:</p>\n<ul dir=\"auto\">\n<li>ttl is set, retentionTime is set as 1d, but not 2d.</li>\n</ul>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The code of set/get topic policy result in this case.</p>\n<p dir=\"auto\">In SystemTopicBasedTopicPoliciesService, policiesCache would be update in refreshTopicPoliciesCache(). The process is :</p>\n<ol dir=\"auto\">\n<li>systemTopicReader successfully read the next event message</li>\n<li>update the value in policiesCache</li>\n<li>notifyListener() to actually update topic policy in PersistentTopic#onUpdate()</li>\n</ol>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/4a9fec693b90fcb76aea9a98a94de31608b56bab/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/SystemTopicBasedTopicPoliciesService.java#L470-L476\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/SystemTopicBasedTopicPoliciesService.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 470 to 476\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/4a9fec693b90fcb76aea9a98a94de31608b56bab\">4a9fec6</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L470\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"470\"></td>\n          <td id=\"LC470\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">case</span> <span class=\"pl-c1\">UPDATE</span>: </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L471\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"471\"></td>\n          <td id=\"LC471\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">event</span>.<span class=\"pl-en\">getPolicies</span>().<span class=\"pl-en\">isGlobalPolicies</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L472\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"472\"></td>\n          <td id=\"LC472\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">globalPoliciesCache</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s1\">topicName</span>, <span class=\"pl-s1\">event</span>.<span class=\"pl-en\">getPolicies</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L473\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"473\"></td>\n          <td id=\"LC473\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L474\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"474\"></td>\n          <td id=\"LC474\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">policiesCache</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s1\">topicName</span>, <span class=\"pl-s1\">event</span>.<span class=\"pl-en\">getPolicies</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L475\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"475\"></td>\n          <td id=\"LC475\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L476\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"476\"></td>\n          <td id=\"LC476\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">break</span>; </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">But the operation of PersistentTopicsBase#internalSetRetention() is:</p>\n<ol dir=\"auto\">\n<li>get the current topicPolicy from policiesCache. If it is not exist in policiesCache, construct a new topicPolicy.</li>\n<li>Then do setRetention. It may change the policy value in policiesCache.</li>\n<li>send updatePolicyEvent msg to __change_events. If send success, response success to client.</li>\n</ol>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/4a9fec693b90fcb76aea9a98a94de31608b56bab/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java#L3467-L3493\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 3467 to 3493\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/4a9fec693b90fcb76aea9a98a94de31608b56bab\">4a9fec6</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L3467\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3467\"></td>\n          <td id=\"LC3467\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">protected</span> <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Void</span>&gt; <span class=\"pl-en\">internalSetRetention</span>(<span class=\"pl-smi\">RetentionPolicies</span> <span class=\"pl-s1\">retention</span>, <span class=\"pl-smi\">boolean</span> <span class=\"pl-s1\">isGlobal</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3468\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3468\"></td>\n          <td id=\"LC3468\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">retention</span> == <span class=\"pl-c1\">null</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3469\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3469\"></td>\n          <td id=\"LC3469\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">return</span> <span class=\"pl-smi\">CompletableFuture</span>.<span class=\"pl-en\">completedFuture</span>(<span class=\"pl-c1\">null</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3470\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3470\"></td>\n          <td id=\"LC3470\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3471\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3471\"></td>\n          <td id=\"LC3471\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-en\">getTopicPoliciesAsyncWithRetry</span>(<span class=\"pl-s1\">topicName</span>, <span class=\"pl-s1\">isGlobal</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3472\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3472\"></td>\n          <td id=\"LC3472\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">thenCompose</span>(<span class=\"pl-s1\">op</span> -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3473\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3473\"></td>\n          <td id=\"LC3473\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-smi\">TopicPolicies</span> <span class=\"pl-s1\">topicPolicies</span> = <span class=\"pl-s1\">op</span>.<span class=\"pl-en\">orElseGet</span>(<span class=\"pl-smi\">TopicPolicies</span>::<span class=\"pl-k\">new</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3474\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3474\"></td>\n          <td id=\"LC3474\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">BacklogQuota</span>.<span class=\"pl-smi\">BacklogQuotaType</span> <span class=\"pl-s1\">backlogQuotaType</span> : <span class=\"pl-smi\">BacklogQuota</span>.<span class=\"pl-s1\">BacklogQuotaType</span>.<span class=\"pl-en\">values</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3475\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3475\"></td>\n          <td id=\"LC3475\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-smi\">BacklogQuota</span> <span class=\"pl-s1\">backlogQuota</span> = <span class=\"pl-s1\">topicPolicies</span>.<span class=\"pl-en\">getBackLogQuotaMap</span>().<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">backlogQuotaType</span>.<span class=\"pl-en\">name</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3476\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3476\"></td>\n          <td id=\"LC3476\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">backlogQuota</span> == <span class=\"pl-c1\">null</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3477\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3477\"></td>\n          <td id=\"LC3477\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-smi\">Policies</span> <span class=\"pl-s1\">policies</span> = <span class=\"pl-en\">getNamespacePolicies</span>(<span class=\"pl-s1\">topicName</span>.<span class=\"pl-en\">getNamespaceObject</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3478\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3478\"></td>\n          <td id=\"LC3478\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-s1\">backlogQuota</span> = <span class=\"pl-s1\">policies</span>.<span class=\"pl-s1\">backlog_quota_map</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">backlogQuotaType</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3479\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3479\"></td>\n          <td id=\"LC3479\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3480\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3480\"></td>\n          <td id=\"LC3480\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">if</span> (!<span class=\"pl-en\">checkBacklogQuota</span>(<span class=\"pl-s1\">backlogQuota</span>, <span class=\"pl-s1\">retention</span>)) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3481\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3481\"></td>\n          <td id=\"LC3481\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">warn</span>( </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3482\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3482\"></td>\n          <td id=\"LC3482\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-s\">\"[{}] Failed to update retention quota configuration for topic {}: \"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3483\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3483\"></td>\n          <td id=\"LC3483\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     + <span class=\"pl-s\">\"conflicts with retention quota\"</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3484\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3484\"></td>\n          <td id=\"LC3484\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-en\">clientAppId</span>(), <span class=\"pl-s1\">topicName</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3485\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3485\"></td>\n          <td id=\"LC3485\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-k\">return</span> <span class=\"pl-smi\">FutureUtil</span>.<span class=\"pl-en\">failedFuture</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">RestException</span>(<span class=\"pl-smi\">Status</span>.<span class=\"pl-c1\">PRECONDITION_FAILED</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3486\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3486\"></td>\n          <td id=\"LC3486\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-s\">\"Retention Quota must exceed configured backlog quota for topic. \"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3487\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3487\"></td>\n          <td id=\"LC3487\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     + <span class=\"pl-s\">\"Please increase retention quota and retry\"</span>)); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3488\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3488\"></td>\n          <td id=\"LC3488\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3489\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3489\"></td>\n          <td id=\"LC3489\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3490\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3490\"></td>\n          <td id=\"LC3490\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">topicPolicies</span>.<span class=\"pl-en\">setRetentionPolicies</span>(<span class=\"pl-s1\">retention</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3491\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3491\"></td>\n          <td id=\"LC3491\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">topicPolicies</span>.<span class=\"pl-en\">setIsGlobal</span>(<span class=\"pl-s1\">isGlobal</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3492\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3492\"></td>\n          <td id=\"LC3492\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">return</span> <span class=\"pl-en\">pulsar</span>().<span class=\"pl-en\">getTopicPoliciesService</span>().<span class=\"pl-en\">updateTopicPoliciesAsync</span>(<span class=\"pl-s1\">topicName</span>, <span class=\"pl-s1\">topicPolicies</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L3493\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"3493\"></td>\n          <td id=\"LC3493\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         }); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">Therefore, it would cause the above two bad case</p>\n<ol dir=\"auto\">\n<li>If topic do not have topic policy, after use pulsar-admin to setRetention success, the policiesCache actually is not update. policiesCache would be updated until systemTopicReader read the next msg in __change_events.    So we then use pulsar-admin to setMessageTTL, maybe get null topicPolicy from policiesCache.</li>\n<li>After twice setRetention operation, we update retentionTime to 1d and then 2d, the policiesCache would be updated four times.  So we then setMessageTTL, maybe get retentionTime is 1d from policiesCache.</li>\n</ol>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21024",
                "createdAt": "2023-08-18T06:56:16Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Fix RawReader hasMessageAvailable returns true when no messages",
        "url": "https://github.com/apache/pulsar/pull/21032",
        "resourcePath": "/apache/pulsar/pull/21032",
        "createdAt": "2023-08-19T07:59:13Z",
        "number": 21032,
        "mergeCommit": {
          "oid": "00ca6aa1cef950bd9ea5014d4332d16d3c8d37e2",
          "message": "[fix][client] Fix RawReader hasMessageAvailable returns true when no messages (#21032)",
          "commitUrl": "https://github.com/apache/pulsar/commit/00ca6aa1cef950bd9ea5014d4332d16d3c8d37e2",
          "parents": {
            "nodes": [
              {
                "oid": "d06cda6cd8a58b8a7e0678183f05c08059ddb9b2",
                "message": "[improve][proxy] Support disabling metrics endpoint (#21031)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/client/impl/RawReaderImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/MultiTopicsReaderTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/NegativeAcksTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/RawReaderTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5YTCtl2gAoZjQ5MGJlNTlmOWE2N2ZlYWQ2OTJmOWE4OGQwMTUzNGVlMTRjMzI1Yg",
                "url": "https://github.com/apache/pulsar/pull/21032/commits/f490be59f9a67fead692f9a88d01534ee14c325b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20998,
                "url": "https://github.com/apache/pulsar/issues/20998",
                "title": "Flaky-test: RawReaderTest.testHasMessageAvailableWithBatch",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/michaeljmarshall/pulsar/actions/runs/5869219096/job/15914141056?pr=54\">https://github.com/michaeljmarshall/pulsar/actions/runs/5869219096/job/15914141056?pr=54</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"   Error:  Tests run: 28, Failures: 1, Errors: 0, Skipped: 21, Time elapsed: 52.798 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.client.impl.RawReaderTest\n  Error:  org.apache.pulsar.client.impl.RawReaderTest.testHasMessageAvailableWithBatch  Time elapsed: 0.221 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: HasMessageAvailable shows still has message when there is no message\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.apache.pulsar.client.impl.RawReaderTest.testHasMessageAvailableWithBatch(RawReaderTest.java:148)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">   Error:  Tests run: 28, Failures: 1, Errors: 0, Skipped: 21, Time elapsed: 52.798 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.client.impl.RawReaderTest\n  Error:  org.apache.pulsar.client.impl.RawReaderTest.testHasMessageAvailableWithBatch  Time elapsed: 0.221 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: HasMessageAvailable shows still has message when there is no message\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.apache.pulsar.client.impl.RawReaderTest.testHasMessageAvailableWithBatch(RawReaderTest.java:148)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20998",
                "createdAt": "2023-08-15T17:20:53Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Fix ProducerConfig cannot update error",
        "url": "https://github.com/apache/pulsar/pull/21037",
        "resourcePath": "/apache/pulsar/pull/21037",
        "createdAt": "2023-08-21T03:58:57Z",
        "number": 21037,
        "mergeCommit": {
          "oid": "64d006b3896bcc971a1b0bee6b78a7c33753b92e",
          "message": "[fix][fn] Fix ProducerConfig cannot update error (#21037)",
          "commitUrl": "https://github.com/apache/pulsar/commit/64d006b3896bcc971a1b0bee6b78a7c33753b92e",
          "parents": {
            "nodes": [
              {
                "oid": "7ecb93cd3b94660412bbb968c0976bb0e0d75e71",
                "message": "[fix][io] Fix --retain[-key]-ordering not working error for sink (#21060)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/FunctionConfigUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/SourceConfigUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/utils/src/test/java/org/apache/pulsar/functions/utils/FunctionConfigUtilsTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/utils/src/test/java/org/apache/pulsar/functions/utils/SourceConfigUtilsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5YV4wE2gAoZWZhYWE3MWQ5YTQ2ZDFjOGNmNjhlNWQzYjY4NzUzNDU5NWU1YWRkNw",
                "url": "https://github.com/apache/pulsar/pull/21037/commits/efaaa71d9a46d1c8cf68e5d3b687534595e5add7"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21036,
                "url": "https://github.com/apache/pulsar/issues/21036",
                "title": "[Bug] Cannot update the `ProducerConfig` for functions/sources",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/commit/dbbaddb6dbdf2b5a2eaaa93a1ece37a31326a42b\">dbbaddb</a></p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>create function with <code class=\"notranslate\">--producer-config</code>:</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"pulsar-admin functions create --tenant public --namespace default  --name fuction-producer-config --inputs public/default/input_topic-1  --output public/default/output_topic-1 --producer-config '{&quot;batchBuilder&quot;:&quot;KEY_BASED&quot;,&quot;maxPendingMessages&quot;:&quot;1000&quot;,&quot;maxPendingMessagesAcrossPartitions&quot;:&quot;50000&quot;,&quot;useThreadLocalProducers&quot;:&quot;true&quot;}' --className org.apache.pulsar.functions.api.examples.ExclamationFunction --jar examples/api-examples.jar\"><pre class=\"notranslate\"><code class=\"notranslate\">pulsar-admin functions create --tenant public --namespace default  --name fuction-producer-config --inputs public/default/input_topic-1  --output public/default/output_topic-1 --producer-config '{\"batchBuilder\":\"KEY_BASED\",\"maxPendingMessages\":\"1000\",\"maxPendingMessagesAcrossPartitions\":\"50000\",\"useThreadLocalProducers\":\"true\"}' --className org.apache.pulsar.functions.api.examples.ExclamationFunction --jar examples/api-examples.jar\n</code></pre></div>\n<ol start=\"2\" dir=\"auto\">\n<li>update the function with new <code class=\"notranslate\">--producer-config</code>:</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"pulsar-admin functions update --tenant public --namespace default  --name fuction-producer-config  --producer-config '{&quot;batchBuilder&quot;:&quot;KEY_BASED&quot;,&quot;maxPendingMessages&quot;:&quot;1001&quot;,&quot;maxPendingMessagesAcrossPartitions&quot;:&quot;50001&quot;,&quot;useThreadLocalProducers&quot;:&quot;true&quot;}'\"><pre class=\"notranslate\"><code class=\"notranslate\">pulsar-admin functions update --tenant public --namespace default  --name fuction-producer-config  --producer-config '{\"batchBuilder\":\"KEY_BASED\",\"maxPendingMessages\":\"1001\",\"maxPendingMessagesAcrossPartitions\":\"50001\",\"useThreadLocalProducers\":\"true\"}'\n</code></pre></div>\n<ol start=\"3\" dir=\"auto\">\n<li>get the function</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"pulsar-admin functions get --name fuction-producer-config\"><pre class=\"notranslate\"><code class=\"notranslate\">pulsar-admin functions get --name fuction-producer-config\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">the producer config should be updated:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  &quot;producerConfig&quot;: {\n    &quot;maxPendingMessages&quot;: 1001,\n    &quot;maxPendingMessagesAcrossPartitions&quot;: 50001,\n    &quot;useThreadLocalProducers&quot;: true,\n    &quot;batchBuilder&quot;: &quot;KEY_BASED&quot;\n  },\"><pre class=\"notranslate\"><code class=\"notranslate\">  \"producerConfig\": {\n    \"maxPendingMessages\": 1001,\n    \"maxPendingMessagesAcrossPartitions\": 50001,\n    \"useThreadLocalProducers\": true,\n    \"batchBuilder\": \"KEY_BASED\"\n  },\n</code></pre></div>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">the producer config is not updated:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  &quot;producerConfig&quot;: {\n    &quot;maxPendingMessages&quot;: 1000,\n    &quot;maxPendingMessagesAcrossPartitions&quot;: 50000,\n    &quot;useThreadLocalProducers&quot;: true,\n    &quot;batchBuilder&quot;: &quot;KEY_BASED&quot;\n  },\"><pre class=\"notranslate\"><code class=\"notranslate\">  \"producerConfig\": {\n    \"maxPendingMessages\": 1000,\n    \"maxPendingMessagesAcrossPartitions\": 50000,\n    \"useThreadLocalProducers\": true,\n    \"batchBuilder\": \"KEY_BASED\"\n  },\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21036",
                "createdAt": "2023-08-21T03:49:46Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "area/function"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix potential case cause retention policy not working on topic level",
        "url": "https://github.com/apache/pulsar/pull/21041",
        "resourcePath": "/apache/pulsar/pull/21041",
        "createdAt": "2023-08-21T12:44:00Z",
        "number": 21041,
        "mergeCommit": {
          "oid": "d3a6df3c2a8f99ab3e5b7f6d826533ffd23328dc",
          "message": "[fix][broker] Fix potential case cause retention policy not working on topic level (#21041)",
          "commitUrl": "https://github.com/apache/pulsar/commit/d3a6df3c2a8f99ab3e5b7f6d826533ffd23328dc",
          "parents": {
            "nodes": [
              {
                "oid": "9e2195ce553ddbd6859b271a5ae0f2a23db02c44",
                "message": "[fix][broker] Fix can't stop phase-two of compaction even though messageId read reaches lastReadId (#20988)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PersistentTopicTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5YYef02gAoNDJiY2JjZmUyZGVkNzI1NWViOGRmMTcxNjg3MDFkNDliN2EzYzA4ZA",
                "url": "https://github.com/apache/pulsar/pull/21041/commits/42bcbcfe2ded7255eb8df17168701d49b7a3c08d"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20968,
                "url": "https://github.com/apache/pulsar/issues/20968",
                "title": "[Bug] Brokers restart during read/writes causes data loss",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<ul dir=\"auto\">\n<li>\n<p dir=\"auto\">Affected Pulsar versions:</p>\n<ul dir=\"auto\">\n<li>3.0.1</li>\n<li>3.0.0</li>\n</ul>\n</li>\n<li>\n<p dir=\"auto\">Tested environments</p>\n<ul dir=\"auto\">\n<li>GCP Kubernetes Cluster - 3-3-3-4 (Zk-proxy-broker-BK), Qurum 2-2-2</li>\n<li>MicroK8S local cluster - 1-1-3-1 (Zk-proxy-broker-BK), Qurum 1-1-1</li>\n</ul>\n</li>\n</ul>\n<p dir=\"auto\">Deployments done using official Helm Chart.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Checkout:<br>\n<a href=\"https://github.com/websight-io/pulsar-chaos-test/\">https://github.com/websight-io/pulsar-chaos-test/</a> and follow README.MD</p>\n<p dir=\"auto\">OR:</p>\n<ol dir=\"auto\">\n<li>Create partitioned (12 partitions) topic, set retention to -1, -1</li>\n<li>Create a producer and start writing to a topic</li>\n<li>Create a consumer with a new subscription set to <code class=\"notranslate\">Earliest</code> position and start reading the messages</li>\n<li>Restart all Broker Pods at once</li>\n<li>Wait for the brokers to start (2-3 minutes)</li>\n<li>Stop producer created in step 2</li>\n<li>Stop consumer created in step 3</li>\n<li>Create a new consumer with a new subscription set to <code class=\"notranslate\">Earliest</code> position and read all the messages</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Both consumers read the same number of messages.<br>\nTopic should contain all the messages that were stored in it.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Consumer created after the restart cannot read the same number of messages as the one created before the restart.<br>\nTopic does not contain all the messages that were stored in it.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<ul dir=\"auto\">\n<li>Retention is set before starting the set. It's preserved and can be verified:<br>\n<code class=\"notranslate\">bin/pulsar-admin topics get-retention persistent://websight/dxp/chaos-test</code></li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{\n  &quot;retentionTimeInMinutes&quot; : -1,\n  &quot;retentionSizeInMB&quot; : -1\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">{\n  \"retentionTimeInMinutes\" : -1,\n  \"retentionSizeInMB\" : -1\n}\n</code></pre></div>\n<ul dir=\"auto\">\n<li>Pulsar Manager shows that some of the partitions are empty after restart (or the data is not equally distributed)</li>\n</ul>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/4356553/259483563-e0326f27-0031-4dcd-95e3-98968cda8962.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIyOTEsIm5iZiI6MTcxNDk3MTk5MSwicGF0aCI6Ii80MzU2NTUzLzI1OTQ4MzU2My1lMDMyNmYyNy0wMDMxLTRkY2QtOTVlMy05ODk2OGNkYTg5NjIucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDUwNiUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA1MDZUMDUwNjMxWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9N2FlN2I1MmM2MzhiNjE0MDg0MzBjMTQwMjg1YzBjMWE1NzA3YTc3NmRjOWZkZWM2NzMxYjI4ZjViZTk4ZTQzMiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.P1XcGEbdPcaEeFqjycyTRwvkG_4InNGy1WhMaDi3Qy4\"><img width=\"1217\" alt=\"Screenshot 2023-08-09 at 18 40 31\" src=\"https://private-user-images.githubusercontent.com/4356553/259483563-e0326f27-0031-4dcd-95e3-98968cda8962.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIyOTEsIm5iZiI6MTcxNDk3MTk5MSwicGF0aCI6Ii80MzU2NTUzLzI1OTQ4MzU2My1lMDMyNmYyNy0wMDMxLTRkY2QtOTVlMy05ODk2OGNkYTg5NjIucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDUwNiUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA1MDZUMDUwNjMxWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9N2FlN2I1MmM2MzhiNjE0MDg0MzBjMTQwMjg1YzBjMWE1NzA3YTc3NmRjOWZkZWM2NzMxYjI4ZjViZTk4ZTQzMiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.P1XcGEbdPcaEeFqjycyTRwvkG_4InNGy1WhMaDi3Qy4\" style=\"max-width: 100%;\"></a>\n- Pulsar Manager state from before the restart:\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/4356553/259483911-aaa45b43-03e7-4f48-a994-889a466d80eb.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIyOTEsIm5iZiI6MTcxNDk3MTk5MSwicGF0aCI6Ii80MzU2NTUzLzI1OTQ4MzkxMS1hYWE0NWI0My0wM2U3LTRmNDgtYTk5NC04ODlhNDY2ZDgwZWIucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDUwNiUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA1MDZUMDUwNjMxWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NTg3NGI1MTVmMzg5YTM1MWQ5ZGI2MmQ3YjY3ODVjNDYyYmIxYzAyMjc3MmIzMzg1NzkyNDU0MGNhNjhjNjRlNSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.wErikjpIFJXTzUl50ALaBo9lb1IpMftip7cL1tuq1-U\"><img width=\"1218\" alt=\"Screenshot 2023-08-09 at 18 41 28\" src=\"https://private-user-images.githubusercontent.com/4356553/259483911-aaa45b43-03e7-4f48-a994-889a466d80eb.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIyOTEsIm5iZiI6MTcxNDk3MTk5MSwicGF0aCI6Ii80MzU2NTUzLzI1OTQ4MzkxMS1hYWE0NWI0My0wM2U3LTRmNDgtYTk5NC04ODlhNDY2ZDgwZWIucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDUwNiUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA1MDZUMDUwNjMxWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NTg3NGI1MTVmMzg5YTM1MWQ5ZGI2MmQ3YjY3ODVjNDYyYmIxYzAyMjc3MmIzMzg1NzkyNDU0MGNhNjhjNjRlNSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.wErikjpIFJXTzUl50ALaBo9lb1IpMftip7cL1tuq1-U\" style=\"max-width: 100%;\"></a>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20968",
                "createdAt": "2023-08-09T16:41:58Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Fix cannot retry chunk messages and send to DLQ",
        "url": "https://github.com/apache/pulsar/pull/21048",
        "resourcePath": "/apache/pulsar/pull/21048",
        "createdAt": "2023-08-22T08:53:28Z",
        "number": 21048,
        "mergeCommit": {
          "oid": "99e3fea2e3adecb3346d1fc8e5422a3fde4236e3",
          "message": "[fix][client] Fix cannot retry chunk messages and send to DLQ (#21048)",
          "commitUrl": "https://github.com/apache/pulsar/commit/99e3fea2e3adecb3346d1fc8e5422a3fde4236e3",
          "parents": {
            "nodes": [
              {
                "oid": "53ffe81105d3f4ce9d317c3ed32a8608ed6d81a4",
                "message": "[refactor][cli] PIP-280 Add pulsar-cli-utils to core-modules profile (#21062)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/DeadLetterTopicTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MessageIdAdvUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/UnAckedMessageTracker.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/UnAckedMessageTrackerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5YeN2P2gAoYzMxZWI5Njk3MWVjOGRjNDI3ZDhhYjAxMWJmNjM5MjU4NjMxMWM1Ng",
                "url": "https://github.com/apache/pulsar/pull/21048/commits/c31eb96971ec8dc427d8ab011bf6392586311c56"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20934,
                "url": "https://github.com/apache/pulsar/issues/20934",
                "title": "[Bug] Dead Letter Policy in Consumer configuration doesn't account for chunking or batching configuration.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.11.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ul dir=\"auto\">\n<li>Produce a message to a topic that exceeds the <code class=\"notranslate\">maxMessageSize</code> default value of <code class=\"notranslate\">5MB</code>.</li>\n<li>Create a consumer that consumes from that topic. This consumer should be configured with a <code class=\"notranslate\">deadLetterPolicy</code> that includes retry letter and dead letter topics.</li>\n<li>Simulate a failure in the consumer code by forcing a call to <code class=\"notranslate\">reconsumeLater</code></li>\n</ul>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I would expect that a message will be produced to the retry letter topic that was configured in the deadLetterPolicy for that consumer.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The following error is observed:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"org.apache.pulsar.client.api.PulsarClientException$InvalidMessageException: The producer mdl-pulsar-0-12 of the topic persistent://metadatalake/metadatalake/part-rlt-v1 sends a  message with 7094331 bytes that exceeds 5242880 bytes\"><pre class=\"notranslate\"><code class=\"notranslate\">org.apache.pulsar.client.api.PulsarClientException$InvalidMessageException: The producer mdl-pulsar-0-12 of the topic persistent://metadatalake/metadatalake/part-rlt-v1 sends a  message with 7094331 bytes that exceeds 5242880 bytes\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The root cause is expected to be that the consumer implementation with respect to creating the producers for whatever is provided in <code class=\"notranslate\">deadLetterPolicy</code> does not have any configuration parameters regarding if batching or chunking should be enabled. Problematic code:</p>\n<ul dir=\"auto\">\n<li><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/ecd16d68e29700cc9521e6d77d124a403c3486c9/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java#L2092-L2097\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 2092 to 2097\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/ecd16d68e29700cc9521e6d77d124a403c3486c9\">ecd16d6</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L2092\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2092\"></td>\n          <td id=\"LC2092\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">deadLetterProducer</span> = </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2093\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2093\"></td>\n          <td id=\"LC2093\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         ((<span class=\"pl-smi\">ProducerBuilderImpl</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt;) <span class=\"pl-s1\">client</span>.<span class=\"pl-en\">newProducer</span>(<span class=\"pl-smi\">Schema</span>.<span class=\"pl-en\">AUTO_PRODUCE_BYTES</span>(<span class=\"pl-s1\">schema</span>))) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2094\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2094\"></td>\n          <td id=\"LC2094\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 .<span class=\"pl-en\">initialSubscriptionName</span>(<span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">deadLetterPolicy</span>.<span class=\"pl-en\">getInitialSubscriptionName</span>()) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2095\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2095\"></td>\n          <td id=\"LC2095\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 .<span class=\"pl-en\">topic</span>(<span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">deadLetterPolicy</span>.<span class=\"pl-en\">getDeadLetterTopic</span>()) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2096\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2096\"></td>\n          <td id=\"LC2096\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 .<span class=\"pl-en\">blockIfQueueFull</span>(<span class=\"pl-c1\">false</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L2097\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2097\"></td>\n          <td id=\"LC2097\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 .<span class=\"pl-en\">createAsync</span>(); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</li>\n<li><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/ecd16d68e29700cc9521e6d77d124a403c3486c9/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java#L613-L617\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 613 to 617\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/ecd16d68e29700cc9521e6d77d124a403c3486c9\">ecd16d6</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L613\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"613\"></td>\n          <td id=\"LC613\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">retryLetterProducer</span> = <span class=\"pl-s1\">client</span>.<span class=\"pl-en\">newProducer</span>(<span class=\"pl-smi\">Schema</span>.<span class=\"pl-en\">AUTO_PRODUCE_BYTES</span>(<span class=\"pl-s1\">schema</span>)) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L614\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"614\"></td>\n          <td id=\"LC614\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">topic</span>(<span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">deadLetterPolicy</span>.<span class=\"pl-en\">getRetryLetterTopic</span>()) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L615\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"615\"></td>\n          <td id=\"LC615\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">enableBatching</span>(<span class=\"pl-c1\">false</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L616\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"616\"></td>\n          <td id=\"LC616\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">blockIfQueueFull</span>(<span class=\"pl-c1\">false</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L617\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"617\"></td>\n          <td id=\"LC617\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         .<span class=\"pl-en\">create</span>(); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n</li>\n</ul>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20934",
                "createdAt": "2023-08-04T18:47:40Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [auto-recovery] Improve to the ReplicaitonWorker performance by deleting invalid underreplication nodes",
        "url": "https://github.com/apache/pulsar/pull/21059",
        "resourcePath": "/apache/pulsar/pull/21059",
        "createdAt": "2023-08-24T03:18:46Z",
        "number": 21059,
        "mergeCommit": {
          "oid": "ba0f2ba38bb88869b8bf664cb20ef41d47a73026",
          "message": "[fix][auto-recovery] Improve to the ReplicaitonWorker performance by deleting invalid underreplication nodes (#21059)",
          "commitUrl": "https://github.com/apache/pulsar/commit/ba0f2ba38bb88869b8bf664cb20ef41d47a73026",
          "parents": {
            "nodes": [
              {
                "oid": "f1c8684fe52d9f75189649eecb34c35e59441590",
                "message": "[fix][io] Allow setting sourceType in config file (#19836)\n\nSigned-off-by: tison <wander4096@gmail.com>\r\nCo-authored-by: Alexander Preu\u00df <alexander.preuss@streamnative.io>\r\nCo-authored-by: tison <wander4096@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/main/java/org/apache/pulsar/metadata/bookkeeper/PulsarLedgerUnderreplicationManager.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/pulsar/metadata/bookkeeper/LedgerUnderreplicationManagerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5YppfH2gAoYWE2MWIwOTMxOTlmZjkyNjdiN2VkM2U5ZGE5OWM1NmE2YjhmNWI5Yg",
                "url": "https://github.com/apache/pulsar/pull/21059/commits/aa61b093199ff9267b7ed3e9da99c56a6b8f5b9b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21058,
                "url": "https://github.com/apache/pulsar/issues/21058",
                "title": "[Bug] [Auto-Recovery] ReplicationWorker low performance problem.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">The newest master.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Start AutoRecovery using <code class=\"notranslate\">bin/bookkeeper recovery</code></li>\n<li>Stop one bookie</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<h3 dir=\"auto\">Superficial cause</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-08-21T13:10:47,207-0400 [ReplicationWorker] DEBUG org.apache.bookkeeper.replication.ReplicationWorker - Going to replicate the fragments of the ledger: 36955355\n\n2023-08-21T13:10:48,889-0400 [ReplicationWorker] DEBUG org.apache.bookkeeper.replication.ReplicationWorker - Founds fragments [Fragment(LedgerID: 36955355, FirstEntryID: 0[0], LastKnownEntryID: 735[735], Host: [bookie-host.com:3181], Closed: true)] for replication from ledger: 36955355\n\n2023-08-21T13:10:48,911-0400 [ReplicationWorker] INFO  org.apache.bookkeeper.client.LedgerFragmentReplicator - Replicating fragment Fragment(LedgerID: 36955355, FirstEntryID: 0[0], LastKnownEntryID: 735[735], Host: [bookie-host.com:3181], Closed: true) in 1 sub fragments.\n\n2023-08-21T13:10:49,393-0400 [main-EventThread] INFO  org.apache.bookkeeper.client.LedgerFragmentReplicator - Updated ZK to point ledger fragments from old bookies to new bookies: {bookie-host.com:3181=bookie-host1.com:3181}\n\n2023-08-21T13:10:49,401-0400 [ReplicationWorker] INFO  org.apache.bookkeeper.replication.ReplicationWorker - Ledger replicated successfully. ledger id is: 36955355\n\n2023-08-21T13:10:49,401-0400 [ReplicationWorker] DEBUG org.apache.pulsar.metadata.bookkeeper.PulsarLedgerUnderreplicationManager - markLedgerReplicated(ledgerId=36955355)\n\n2023-08-21T13:10:49,421-0400 [ReplicationWorker] DEBUG org.apache.pulsar.metadata.bookkeeper.PulsarLedgerUnderreplicationManager - releaseLedger(ledgerId=36955355)\n\n2023-08-21T13:10:49,430-0400 [ReplicationWorker] DEBUG org.apache.pulsar.metadata.bookkeeper.PulsarLedgerManager - Unregistered ledger metadata listener ReadOnlyLedgerHandle(lid = 36955355, id = 1009584614) on ledger 36955355.\n\n2023-08-21T13:10:49,431-0400 [ReplicationWorker] DEBUG org.apache.pulsar.metadata.bookkeeper.PulsarLedgerUnderreplicationManager - releaseLedger(ledgerId=36955355)\n\n2023-08-21T13:10:49,431-0400 [ReplicationWorker] DEBUG org.apache.pulsar.metadata.bookkeeper.PulsarLedgerUnderreplicationManager - getLedgerToRereplicate()\n\n2023-08-21T13:10:49,431-0400 [ReplicationWorker] DEBUG org.apache.pulsar.metadata.bookkeeper.PulsarLedgerUnderreplicationManager - isLedgerReplicationEnabled()\n\n\n2023-08-21T13:17:15,122-0400 [ReplicationWorker] DEBUG org.apache.bookkeeper.replication.ReplicationWorker - Going to replicate the fragments of the ledger: 23993683\n\n2023-08-21T13:17:15,167-0400 [ReplicationWorker] INFO  org.apache.bookkeeper.replication.ReplicationWorker - Ledger replicated successfully. ledger id is: 23993683\n\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-08-21T13:10:47,207-0400 [ReplicationWorker] DEBUG org.apache.bookkeeper.replication.ReplicationWorker - Going to replicate the fragments of the ledger: 36955355\n\n2023-08-21T13:10:48,889-0400 [ReplicationWorker] DEBUG org.apache.bookkeeper.replication.ReplicationWorker - Founds fragments [Fragment(LedgerID: 36955355, FirstEntryID: 0[0], LastKnownEntryID: 735[735], Host: [bookie-host.com:3181], Closed: true)] for replication from ledger: 36955355\n\n2023-08-21T13:10:48,911-0400 [ReplicationWorker] INFO  org.apache.bookkeeper.client.LedgerFragmentReplicator - Replicating fragment Fragment(LedgerID: 36955355, FirstEntryID: 0[0], LastKnownEntryID: 735[735], Host: [bookie-host.com:3181], Closed: true) in 1 sub fragments.\n\n2023-08-21T13:10:49,393-0400 [main-EventThread] INFO  org.apache.bookkeeper.client.LedgerFragmentReplicator - Updated ZK to point ledger fragments from old bookies to new bookies: {bookie-host.com:3181=bookie-host1.com:3181}\n\n2023-08-21T13:10:49,401-0400 [ReplicationWorker] INFO  org.apache.bookkeeper.replication.ReplicationWorker - Ledger replicated successfully. ledger id is: 36955355\n\n2023-08-21T13:10:49,401-0400 [ReplicationWorker] DEBUG org.apache.pulsar.metadata.bookkeeper.PulsarLedgerUnderreplicationManager - markLedgerReplicated(ledgerId=36955355)\n\n2023-08-21T13:10:49,421-0400 [ReplicationWorker] DEBUG org.apache.pulsar.metadata.bookkeeper.PulsarLedgerUnderreplicationManager - releaseLedger(ledgerId=36955355)\n\n2023-08-21T13:10:49,430-0400 [ReplicationWorker] DEBUG org.apache.pulsar.metadata.bookkeeper.PulsarLedgerManager - Unregistered ledger metadata listener ReadOnlyLedgerHandle(lid = 36955355, id = 1009584614) on ledger 36955355.\n\n2023-08-21T13:10:49,431-0400 [ReplicationWorker] DEBUG org.apache.pulsar.metadata.bookkeeper.PulsarLedgerUnderreplicationManager - releaseLedger(ledgerId=36955355)\n\n2023-08-21T13:10:49,431-0400 [ReplicationWorker] DEBUG org.apache.pulsar.metadata.bookkeeper.PulsarLedgerUnderreplicationManager - getLedgerToRereplicate()\n\n2023-08-21T13:10:49,431-0400 [ReplicationWorker] DEBUG org.apache.pulsar.metadata.bookkeeper.PulsarLedgerUnderreplicationManager - isLedgerReplicationEnabled()\n\n\n2023-08-21T13:17:15,122-0400 [ReplicationWorker] DEBUG org.apache.bookkeeper.replication.ReplicationWorker - Going to replicate the fragments of the ledger: 23993683\n\n2023-08-21T13:17:15,167-0400 [ReplicationWorker] INFO  org.apache.bookkeeper.replication.ReplicationWorker - Ledger replicated successfully. ledger id is: 23993683\n\n</code></pre></div>\n<p dir=\"auto\">We can see the ledger <code class=\"notranslate\">36955355</code> was completed quickly, it only took about 2 seconds (13:10:47-13:10:49).</p>\n<p dir=\"auto\">After <code class=\"notranslate\">36955355</code> completing, the ReplicationWorker will get the next underReplicated ledger id from the metadata store. From the logs, it takes about 6 minutes; this means the method <code class=\"notranslate\">PulsarLedgerUnderreplicationManager#getLedgerToRereplicate</code> takes about 6 minutes.</p>\n<p dir=\"auto\">in <code class=\"notranslate\">PulsarLedgerUnderreplicationManager#getLedgerToRereplicate</code>, it will iterate the child nodes under <code class=\"notranslate\">/ledgers/underreplication/ledgers</code>. And it only picks the node whose depth is 5, like <code class=\"notranslate\">/ledgers/underreplication/ledgers/0000/0000/0000/4441/urL0000017473</code>. If the path only has 4 depths, like <code class=\"notranslate\">/ledgers/underreplication/ledgers/0000/0000/0000/4442</code>, the path will be ignored, then pick the next path.</p>\n<p dir=\"auto\">Example:<br>\nThere are 4 nodes.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/ledgers/underreplication/ledgers/0000/0000/0000/4441/urL0000017473\n/ledgers/underreplication/ledgers/0000/0000/0000/45c8/urL0000017864\n/ledgers/underreplication/ledgers/0000/0000/0000/4785\n/ledgers/underreplication/ledgers/0000/0000/0000/4778\"><pre class=\"notranslate\"><code class=\"notranslate\">/ledgers/underreplication/ledgers/0000/0000/0000/4441/urL0000017473\n/ledgers/underreplication/ledgers/0000/0000/0000/45c8/urL0000017864\n/ledgers/underreplication/ledgers/0000/0000/0000/4785\n/ledgers/underreplication/ledgers/0000/0000/0000/4778\n</code></pre></div>\n<p dir=\"auto\">When picking <code class=\"notranslate\">/ledgers/underreplication/ledgers/0000/0000/0000/4785</code>(The pick algorithm is random), it found that it only has 4 depths ('/0000/0000/0000/4785'), the node will be ignored. Then pick the next node <code class=\"notranslate\">/ledgers/underreplication/ledgers/0000/0000/0000/4441</code>, and it found that it has 5 depths(<code class=\"notranslate\">/0000/0000/0000/4441/urL0000017473</code>), then return the ledger id <code class=\"notranslate\">17473</code>.</p>\n<p dir=\"auto\">We found that in the customer's cluster, it has too many invalid nodes with a depth of 4. So the replicationWorker iterates too many invalid nodes, and the iteration takes a long time.</p>\n<h3 dir=\"auto\">Root cause</h3>\n<blockquote>\n<p dir=\"auto\">Why are there so many invalid nodes in the client's cluster?</p>\n</blockquote>\n<p dir=\"auto\">Finally, we found <code class=\"notranslate\">PulsarLedgerUnderreplicationManager</code> introduces the problem, after <code class=\"notranslate\">PulsarLedgerUnderreplicationManager</code> completes the ledger replication, it will mark the ledger as replicated. The mark operation will delete the node <code class=\"notranslate\">/ledgers/underreplication/ledgers/0000/0000/0000/4441/urL0000017473</code>, then leave the node <code class=\"notranslate\">/ledgers/underreplication/ledgers/0000/0000/0000/4441/</code>, so went an invalid node.<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/30073dbac0e941869b43e090d2682935e8f094e5/pulsar-metadata/src/main/java/org/apache/pulsar/metadata/bookkeeper/PulsarLedgerUnderreplicationManager.java#L393-L422\">pulsar/pulsar-metadata/src/main/java/org/apache/pulsar/metadata/bookkeeper/PulsarLedgerUnderreplicationManager.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 393 to 422\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/30073dbac0e941869b43e090d2682935e8f094e5\">30073db</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L393\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"393\"></td>\n          <td id=\"LC393\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">markLedgerReplicated</span>(<span class=\"pl-smi\">long</span> <span class=\"pl-s1\">ledgerId</span>) <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">ReplicationException</span>.<span class=\"pl-smi\">UnavailableException</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L394\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"394\"></td>\n          <td id=\"LC394\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">log</span>.<span class=\"pl-en\">isDebugEnabled</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L395\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"395\"></td>\n          <td id=\"LC395\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">debug</span>(<span class=\"pl-s\">\"markLedgerReplicated(ledgerId={})\"</span>, <span class=\"pl-s1\">ledgerId</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L396\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"396\"></td>\n          <td id=\"LC396\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L397\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"397\"></td>\n          <td id=\"LC397\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">try</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L398\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"398\"></td>\n          <td id=\"LC398\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-smi\">Lock</span> <span class=\"pl-s1\">l</span> = <span class=\"pl-s1\">heldLocks</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">ledgerId</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L399\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"399\"></td>\n          <td id=\"LC399\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">l</span> != <span class=\"pl-c1\">null</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L400\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"400\"></td>\n          <td id=\"LC400\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">store</span>.<span class=\"pl-en\">delete</span>(<span class=\"pl-en\">getUrLedgerPath</span>(<span class=\"pl-s1\">ledgerId</span>), <span class=\"pl-smi\">Optional</span>.<span class=\"pl-en\">of</span>(<span class=\"pl-s1\">l</span>.<span class=\"pl-en\">getLedgerNodeVersion</span>())) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L401\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"401\"></td>\n          <td id=\"LC401\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     .<span class=\"pl-en\">get</span>(<span class=\"pl-c1\">BLOCKING_CALL_TIMEOUT</span>, <span class=\"pl-c1\">MILLISECONDS</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L402\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"402\"></td>\n          <td id=\"LC402\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L403\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"403\"></td>\n          <td id=\"LC403\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">ExecutionException</span> <span class=\"pl-s1\">ee</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L404\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"404\"></td>\n          <td id=\"LC404\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">ee</span>.<span class=\"pl-en\">getCause</span>() <span class=\"pl-k\">instanceof</span> <span class=\"pl-smi\">MetadataStoreException</span>.<span class=\"pl-smi\">NotFoundException</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L405\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"405\"></td>\n          <td id=\"LC405\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-c\">// this is ok</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L406\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"406\"></td>\n          <td id=\"LC406\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">ee</span>.<span class=\"pl-en\">getCause</span>() <span class=\"pl-k\">instanceof</span> <span class=\"pl-smi\">MetadataStoreException</span>.<span class=\"pl-smi\">BadVersionException</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L407\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"407\"></td>\n          <td id=\"LC407\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-c\">// if this is the case, some has marked the ledger</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L408\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"408\"></td>\n          <td id=\"LC408\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-c\">// for rereplication again. Leave the underreplicated</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L409\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"409\"></td>\n          <td id=\"LC409\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-c\">// znode in place, so the ledger is checked.</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L410\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"410\"></td>\n          <td id=\"LC410\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L411\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"411\"></td>\n          <td id=\"LC411\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">error</span>(<span class=\"pl-s\">\"Error deleting underreplicated ledger node\"</span>, <span class=\"pl-s1\">ee</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L412\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"412\"></td>\n          <td id=\"LC412\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">throw</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ReplicationException</span>.<span class=\"pl-smi\">UnavailableException</span>(<span class=\"pl-s\">\"Error contacting metadata store\"</span>, <span class=\"pl-s1\">ee</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L413\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"413\"></td>\n          <td id=\"LC413\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L414\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"414\"></td>\n          <td id=\"LC414\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">TimeoutException</span> <span class=\"pl-s1\">ex</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L415\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"415\"></td>\n          <td id=\"LC415\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">throw</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ReplicationException</span>.<span class=\"pl-smi\">UnavailableException</span>(<span class=\"pl-s\">\"Error contacting metadata store\"</span>, <span class=\"pl-s1\">ex</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L416\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"416\"></td>\n          <td id=\"LC416\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">InterruptedException</span> <span class=\"pl-s1\">ie</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L417\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"417\"></td>\n          <td id=\"LC417\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-smi\">Thread</span>.<span class=\"pl-en\">currentThread</span>().<span class=\"pl-en\">interrupt</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L418\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"418\"></td>\n          <td id=\"LC418\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">throw</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ReplicationException</span>.<span class=\"pl-smi\">UnavailableException</span>(<span class=\"pl-s\">\"Interrupted while contacting metadata store\"</span>, <span class=\"pl-s1\">ie</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L419\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"419\"></td>\n          <td id=\"LC419\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } <span class=\"pl-k\">finally</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L420\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"420\"></td>\n          <td id=\"LC420\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-en\">releaseUnderreplicatedLedger</span>(<span class=\"pl-s1\">ledgerId</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L421\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"421\"></td>\n          <td id=\"LC421\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L422\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"422\"></td>\n          <td id=\"LC422\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">In <code class=\"notranslate\">ZkLedgerUnderreplicationManager</code>, after delete the node <code class=\"notranslate\">/ledgers/underreplication/ledgers/0000/0000/0000/4441/urL0000017473</code>, it checks if the child nodes are empty, and if they are, it deletes the parent node, so the node <code class=\"notranslate\">/ledgers/underreplication/ledgers/0000/0000/0000/4441</code> will also be removed, and leave the node <code class=\"notranslate\">/ledgers/underreplication/ledgers/0000/0000/0000</code>.<br>\n<a href=\"https://github.com/apache/bookkeeper/blob/5b5c05331757e7356579076970e61f119f5d34ae/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/ZkLedgerUnderreplicationManager.java#L391-L436\">https://github.com/apache/bookkeeper/blob/5b5c05331757e7356579076970e61f119f5d34ae/bookkeeper-server/src/main/java/org/apache/bookkeeper/meta/ZkLedgerUnderreplicationManager.java#L391-L436</a></p>\n<p dir=\"auto\"><em><strong>PulsarLedgerUnderreplicationManager is at pulsar side, when the user config -<code class=\"notranslate\">Dbookkeeper.metadata.client.drivers=org.apache.pulsar.metadata.bookkeeper.PulsarMetadataClientDriver</code>, the ReplicationWorker will use it.<br>\nZkLedgerUnderreplicationManager is at the bk side; it's the default.</strong></em></p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">PulsarLedgerUnderreplicationManager should also delete the empty parent nodes.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21058",
                "createdAt": "2023-08-24T03:16:00Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "category/performance"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Use MessageDigest.isEqual when comparing digests",
        "url": "https://github.com/apache/pulsar/pull/21061",
        "resourcePath": "/apache/pulsar/pull/21061",
        "createdAt": "2023-08-24T04:18:36Z",
        "number": 21061,
        "mergeCommit": {
          "oid": "c05954e66ff33098aeb848f4bde51613ace7e47e",
          "message": "[fix][broker] Use MessageDigest.isEqual when comparing digests (#21061)",
          "commitUrl": "https://github.com/apache/pulsar/commit/c05954e66ff33098aeb848f4bde51613ace7e47e",
          "parents": {
            "nodes": [
              {
                "oid": "30073dbac0e941869b43e090d2682935e8f094e5",
                "message": "[fix] [broker] Producer is blocked on creation because backlog exceeded on topic, when dedup is enabled and no producer is there (#20951)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-auth-sasl/src/main/java/org/apache/pulsar/broker/authentication/SaslRoleTokenSigner.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5YpyW52gAoMzMxOWFjZWFiMDJkMWUzZjFlYzQ0MzlkMzBkYzk3OGJkYTcxNDA0MA",
                "url": "https://github.com/apache/pulsar/pull/21061/commits/3319aceab02d1e3f1ec4439d30dc978bda714040"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21053,
                "url": "https://github.com/apache/pulsar/issues/21053",
                "title": "[Bug] Replace String.equals with MessageDigest.isEqual",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\"><a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/apache/pulsar/commit/e951cd05268bd4e01fd1ab161fa2df65d219c8fc/hovercard\" href=\"https://github.com/apache/pulsar/commit/e951cd05268bd4e01fd1ab161fa2df65d219c8fc\"><tt>e951cd0</tt></a></p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">I cannot be reproduced stably</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">During signature verification, no matter whether the verification is correct or not, the time spent should be the same</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The time spent in signature verification will be positively correlated with the correct substring length.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">Hi there,<br>\n\u200b\tI may have discovered a method in the newest version of <a href=\"https://github.com/apache/pulsar\">pulsar</a>, which has \"Observable Timing Discrepancy\" vulnerability. The vulnerability is located in the method <code class=\"notranslate\">org.apache.pulsar.broker.authentication.SaslRoleTokenSigner.verifyAndExtract(String signedStr)</code> . The vulnerability bears similarities to a recent CVE disclosure <em><a title=\"CVE-2020-1926\" data-hovercard-type=\"advisory\" data-hovercard-url=\"/advisories/GHSA-54g4-5cf6-hjp3/hovercard\" href=\"https://github.com/advisories/GHSA-54g4-5cf6-hjp3\">CVE-2020-1926</a></em> in the <em>\"apache/hive\"</em> project.<br>\nThe source vulnerability information is as follows:</p>\n<blockquote>\n<p dir=\"auto\">\u200b\t<strong>Vulnerability Detail:</strong></p>\n<p dir=\"auto\">\u200b\t<strong>CVE Identifier:</strong> CVE-2020-1926</p>\n<p dir=\"auto\"><strong>Description</strong>:Apache Hive cookie signature verification used a non constant time comparison which is known to be vulnerable to timing attacks. This could allow recovery of another users cookie signature. The issue was addressed in Apache Hive 2.3.8.</p>\n<p dir=\"auto\">\u200b\t**Reference:**<a href=\"https://nvd.nist.gov/vuln/detail/CVE-2020-1926\" rel=\"nofollow\">https://nvd.nist.gov/vuln/detail/CVE-2020-1926</a></p>\n<p dir=\"auto\">\u200b\t<strong>Patch</strong>: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/apache/hive/commit/ee5a6be81a87bb21b3779edad6e61b67b365997b/hovercard\" href=\"https://github.com/apache/hive/commit/ee5a6be81a87bb21b3779edad6e61b67b365997b\">apache/hive@<tt>ee5a6be</tt></a></p>\n</blockquote>\n<p dir=\"auto\"><strong>Vulnerability Description</strong>: The vulnerability exists within the String verifyAndExtract(String signedStr) method of the org.apache.pulsar.broker.authentication.SaslRoleTokenSigner class. It is responsible for authenticating and extracting SaslRoleToken. SaslRoleToken is a token used for authentication and authorization, which contains a signed string of information about roles and permissions.<strong>But the authentication snippet is similar to the vulnerable snippet for <a title=\"CVE-2020-1926\" data-hovercard-type=\"advisory\" data-hovercard-url=\"/advisories/GHSA-54g4-5cf6-hjp3/hovercard\" href=\"https://github.com/advisories/GHSA-54g4-5cf6-hjp3\">CVE-2020-1926</a> and may have the same consequence as <a title=\"CVE-2020-1926\" data-hovercard-type=\"advisory\" data-hovercard-url=\"/advisories/GHSA-54g4-5cf6-hjp3/hovercard\" href=\"https://github.com/advisories/GHSA-54g4-5cf6-hjp3\">CVE-2020-1926</a>, where isvulnerable to timing attacks.</strong> Therefore, maybe you need to fix the vulnerability with much the same fix code as the  <a title=\"CVE-2020-1926\" data-hovercard-type=\"advisory\" data-hovercard-url=\"/advisories/GHSA-54g4-5cf6-hjp3/hovercard\" href=\"https://github.com/advisories/GHSA-54g4-5cf6-hjp3\">CVE-2020-1926</a> patch.<br>\nConsidering the potential riskes it may have, I am willing to cooperate with your to verify, address, and report the identified vulnerability promptly through responsible means. If you require any further information or assistance, please do not hesitate to reach out to me.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21053",
                "createdAt": "2023-08-23T11:08:30Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][doc] Custom docker image build instructions README update",
        "url": "https://github.com/apache/pulsar/pull/21072",
        "resourcePath": "/apache/pulsar/pull/21072",
        "createdAt": "2023-08-26T14:25:28Z",
        "number": 21072,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "README.md"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Y2dP22gAoMjY1ODNmNjMxNjU3ZDQxNzg3OGY4OWRjOTRiYzhhMDg3N2UxZTM5MA",
                "url": "https://github.com/apache/pulsar/pull/21072/commits/26583f631657d417878f89dc94bc8a0877e1e390"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21071,
                "url": "https://github.com/apache/pulsar/issues/21071",
                "title": "[Doc] Docker image build instructions update",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">What issue do you find in Pulsar docs?</h3>\n<p dir=\"auto\">The commands:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"mvn clean install -DskipTests\nmvn package -Pdocker,-main -am -pl docker/pulsar-all -DskipTests\"><pre class=\"notranslate\">mvn clean install -DskipTests\nmvn package -Pdocker,-main -am -pl docker/pulsar-all -DskipTests</pre></div>\n<p dir=\"auto\">failes due to the fact, that now tagging is done by the maven-docker-plugin. To build the image, the parameter needs to be set first.</p>\n<h3 dir=\"auto\">What is your suggestion?</h3>\n<p dir=\"auto\">Update the command to:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"gitrev=$(git rev-parse HEAD | colrm 10)\nmvn clean install -DskipTests -Dgit.commit.id.abbrev=${gitrev}\nmvn package -Pdocker,-main -am -pl docker/pulsar-all -DskipTests -Dgit.commit.id.abbrev=${gitrev}\"><pre class=\"notranslate\">gitrev=<span class=\"pl-s\"><span class=\"pl-pds\">$(</span>git rev-parse HEAD <span class=\"pl-k\">|</span> colrm 10<span class=\"pl-pds\">)</span></span>\nmvn clean install -DskipTests -Dgit.commit.id.abbrev=<span class=\"pl-smi\">${gitrev}</span>\nmvn package -Pdocker,-main -am -pl docker/pulsar-all -DskipTests -Dgit.commit.id.abbrev=<span class=\"pl-smi\">${gitrev}</span></pre></div>\n<h3 dir=\"auto\">Any reference?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21071",
                "createdAt": "2023-08-26T14:02:13Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "doc-required"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][proxy] Fix Proxy 502 gateway error when it is configured with Keystore TLS and admin API is called",
        "url": "https://github.com/apache/pulsar/pull/21077",
        "resourcePath": "/apache/pulsar/pull/21077",
        "createdAt": "2023-08-28T08:18:32Z",
        "number": 21077,
        "mergeCommit": {
          "oid": "674c52a40a8e7bf4d428293d30744ba7d7f84278",
          "message": "[fix][proxy] Fix Proxy 502 gateway error when it is configured with Keystore TLS and admin API is called (#21077)",
          "commitUrl": "https://github.com/apache/pulsar/commit/674c52a40a8e7bf4d428293d30744ba7d7f84278",
          "parents": {
            "nodes": [
              {
                "oid": "c675a3dd6b4a3a6009d2a10c38ee79d8219b1920",
                "message": "[fix][broker] revert remove duplicate topics name when deleteNamespace (#21087)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/AdminProxyHandler.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/AdminProxyHandlerKeystoreTLSTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Y6F1x2gAoYjNkM2JmZmU2NDJlZDYyMDlhNzI3OGFiMzJjZGFkYWQxNjk0ZGM2OA",
                "url": "https://github.com/apache/pulsar/pull/21077/commits/b3d3bffe642ed6209a7278ab32cdadad1694dc68"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21076,
                "url": "https://github.com/apache/pulsar/issues/21076",
                "title": "[Bug] Pulsar Proxy returns 502 Gateway error when Keystore TLS is enabled on Proxy and Admin API is utilized",
                "bodyHTML": "<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Mac OS: Ventura 13.5<br>\nPulsar Commit ID: <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/apache/pulsar/commit/d099ac4fa2f217b9c5f0a5e660c83048e829c5d7/hovercard\" href=\"https://github.com/apache/pulsar/commit/d099ac4fa2f217b9c5f0a5e660c83048e829c5d7\"><tt>d099ac4</tt></a></p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Deploy Pulsar cluster with TLS configured on brokers.</li>\n<li>Deploy proxy with Keystore TLS enabled and respective keystores and truststores configured.</li>\n<li>Call proxy tls endpoint with admin client</li>\n</ol>\n<p dir=\"auto\">Eg. bin/pulsar-admin --admin-url <a href=\"https://localhost:8443\" rel=\"nofollow\">https://localhost:8443</a> tenants list</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Expected to see the list of tenants.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">HTTP 502 Bad Gateway</p>\n<p dir=\"auto\">Reason: HTTP 502 Bad Gateway</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21076",
                "createdAt": "2023-08-28T07:57:41Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix deleting topic not delete the related topic policy and schema.",
        "url": "https://github.com/apache/pulsar/pull/21093",
        "resourcePath": "/apache/pulsar/pull/21093",
        "createdAt": "2023-08-30T10:48:19Z",
        "number": 21093,
        "mergeCommit": {
          "oid": "a1405ea006f175b1bd0b9d28b9444d592fb4a010",
          "message": "[fix][broker] Fix deleting topic not delete the related topic policy and schema. (#21093)\n\nFixes #21075 \r\n\r\n### Motivation\r\n\r\nWhen the topic is loaded, it will delete the topic-level policy if it is enabled. But if the topic is not loaded, it will directly delete through managed ledger factory. But then we will leave the topic policy there. When the topic is created next time, it will use the old topic policy\r\n\r\n### Modifications\r\n\r\nWhen deleting the topic, delete the schema and topic policies even if the topic is not loaded.",
          "commitUrl": "https://github.com/apache/pulsar/commit/a1405ea006f175b1bd0b9d28b9444d592fb4a010",
          "parents": {
            "nodes": [
              {
                "oid": "927d1b2c12e7da88a0fc5406c148aa602cf3f58d",
                "message": "[fix][broker] Fix unsubscribe non-durable subscription error (#21099)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerBkEnsemblesTests.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/systopic/PartitionedSystemTopicTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ZIG4f2gAoZDIzZWRjMGM1NDgyZTE0NTI4Y2U0ZDQzN2E0YWJjYmYwNGRmNmI4Mg",
                "url": "https://github.com/apache/pulsar/pull/21093/commits/d23edc0c5482e14528ce4d437a4abcbf04df6b82"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21075,
                "url": "https://github.com/apache/pulsar/issues/21075",
                "title": "[Bug] Delete topic should delete the related topic policy",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">N/A</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Delete topic should also delete the topic policy</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">N/A</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">I found an interesting thing when deleting a topic through admin API. When the topic is loaded, it will delete the topic-level policy if it is enabled. But if the topic is not loaded, it will directly delete through managed ledger factory. But then we will leave the topic policy there. When the topic is created next time, it will use the old topic policy.<br>\nDo you think we should clean up the topic policy as well if the topic is not loaded?<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/ee91edc3e08c87db1e5662a553ff62af0c1886e5/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java#L1144\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 1144\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/ee91edc3e08c87db1e5662a553ff62af0c1886e5\">ee91edc</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L1144\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1144\"></td>\n          <td id=\"LC1144\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">return</span> <span class=\"pl-s1\">t</span>.<span class=\"pl-en\">delete</span>(); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21075",
                "createdAt": "2023-08-28T02:48:01Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "category/reliability"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix unsubscribe non-durable subscription error",
        "url": "https://github.com/apache/pulsar/pull/21099",
        "resourcePath": "/apache/pulsar/pull/21099",
        "createdAt": "2023-08-31T03:08:31Z",
        "number": 21099,
        "mergeCommit": {
          "oid": "927d1b2c12e7da88a0fc5406c148aa602cf3f58d",
          "message": "[fix][broker] Fix unsubscribe non-durable subscription error (#21099)",
          "commitUrl": "https://github.com/apache/pulsar/commit/927d1b2c12e7da88a0fc5406c148aa602cf3f58d",
          "parents": {
            "nodes": [
              {
                "oid": "a25125d685597edfba0cf8b92761e46ad43df276",
                "message": "[improve][pip] Implement getLastMessageIds API for Reader (#21052)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ZMgdn2gAoZTMwOWQ5N2Y0NzY1OGMzN2M0OWZiZjI2NTk2ZDE4ZDJhYTBmM2Y0OQ",
                "url": "https://github.com/apache/pulsar/pull/21099/commits/e309d97f47658c37c49fbf26596d18d2aa0f3f49"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20947,
                "url": "https://github.com/apache/pulsar/issues/20947",
                "title": "[improvement] Consumer#unsubscribe on NonDurable subscription has unclear error message",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">When creating a <code class=\"notranslate\">Consumer</code> using a <code class=\"notranslate\">NonDurable</code> subscription, when calling <code class=\"notranslate\">unsubscribe</code>, we get an Exception saying <code class=\"notranslate\">ManagedCursor not found: &lt;consumerNam&gt;</code>.  This is misleading because there is no cursor for non durable subscriptions.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Ideally, the Exception message should be something like <code class=\"notranslate\">NonDurable subscriptions do not need to be unsubscribed. They are automatically removed after all Consumers have disconnected.</code></p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20947",
                "createdAt": "2023-08-07T15:15:34Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Add addCustomizeMetrics method for BrokerInterceptor",
        "url": "https://github.com/apache/pulsar/pull/21102",
        "resourcePath": "/apache/pulsar/pull/21102",
        "createdAt": "2023-08-31T09:04:10Z",
        "number": 21102,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/intercept/BrokerInterceptor.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/intercept/BrokerInterceptorWithClassLoader.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/intercept/BrokerInterceptors.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/PrometheusMetricStreams.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/PrometheusMetricsGenerator.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/intercept/BrokerInterceptorTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/intercept/BrokerInterceptorWithClassLoaderTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/intercept/CounterBrokerInterceptor.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ZNzjt2gAoOGM5ZDAzNjMxNDk5MGEyZTNjNmMzYWZmNGQ5ZDdjOGE0MjVlNzk5Nw",
                "url": "https://github.com/apache/pulsar/pull/21102/commits/8c9d036314990a2e3c6c3aff4d9d7c8a425e7997"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20772,
                "url": "https://github.com/apache/pulsar/issues/20772",
                "title": "[improve][broker] Add metrics related interfaces for BrokerInterceptor",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">When I want to monitor the relevant data in the <code class=\"notranslate\">BrokerInterceptor</code>, currently the <code class=\"notranslate\">BrokerInterceptor</code> does not provide relevant interfaces.</p>\n<p dir=\"auto\">I think providing such extensions is necessary.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/blob/e96b3398912163eb6e0528c10aed3507c95952fd/pulsar-broker/src/main/java/org/apache/pulsar/broker/intercept/BrokerInterceptor.java\">https://github.com/apache/pulsar/blob/e96b3398912163eb6e0528c10aed3507c95952fd/pulsar-broker/src/main/java/org/apache/pulsar/broker/intercept/BrokerInterceptor.java</a></p>\n<p dir=\"auto\">Add a interface, like this:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"default void addCustomizeMetrics(PrometheusMetricStreams streams, PulsarService pulsar){\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">default</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">addCustomizeMetrics</span>(<span class=\"pl-smi\">PrometheusMetricStreams</span> <span class=\"pl-s1\">streams</span>, <span class=\"pl-smi\">PulsarService</span> <span class=\"pl-s1\">pulsar</span>){\n}</pre></div>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/e96b3398912163eb6e0528c10aed3507c95952fd/pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/PrometheusMetricsGenerator.java#L185-L187\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/PrometheusMetricsGenerator.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 185 to 187\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/e96b3398912163eb6e0528c10aed3507c95952fd\">e96b339</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L185\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"185\"></td>\n          <td id=\"LC185\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-smi\">PrometheusMetricStreams</span> <span class=\"pl-s1\">metricStreams</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">PrometheusMetricStreams</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L186\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"186\"></td>\n          <td id=\"LC186\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">try</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L187\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"187\"></td>\n          <td id=\"LC187\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">SimpleTextOutputStream</span> <span class=\"pl-s1\">stream</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">SimpleTextOutputStream</span>(<span class=\"pl-s1\">buf</span>); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">Then callback the <code class=\"notranslate\">addCustomizeMetrics(stream, pulsar)</code> method here.</p>\n<p dir=\"auto\">This is just a draft.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20772",
                "createdAt": "2023-07-10T15:37:15Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][misc] Fix bugs in hash bucket algorithm implementation in Pulsar collections",
        "url": "https://github.com/apache/pulsar/pull/21107",
        "resourcePath": "/apache/pulsar/pull/21107",
        "createdAt": "2023-09-01T08:54:13Z",
        "number": 21107,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentLongHashMap.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentLongLongPairHashMap.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentLongPairSet.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentOpenHashMap.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentOpenHashSet.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ZUXEU2gAoZWFiMmQyNDRmNTYyYmEzMTJiMTkwYmY2MzE4OWJjMjc5NjQxZDBlNA",
                "url": "https://github.com/apache/pulsar/pull/21107/commits/eab2d244f562ba312b190bf63189bc279641d0e4"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21106,
                "url": "https://github.com/apache/pulsar/issues/21106",
                "title": "[Bug] Pulsar collection classes with Long pair keys contain a bug in the hash bucket algorithm implementation",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">any</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Pulsar collection classes with Long pair keys contain a bug in the hash bucket algorithm implementation. This happens whenever the collections are used.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Hash bucket algorithm should be properly implemented.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">This bug wastes CPU cycles because of the inefficient storage and retrieval since collisions will be very likely when the used capacity of the collection implementation increases.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21106",
                "createdAt": "2023-09-01T08:47:57Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            },
            {
              "node": {
                "number": 21108,
                "url": "https://github.com/apache/pulsar/issues/21108",
                "title": "[Bug] Pulsar collection classes contain a bug in the hash bucket algorithm implementation when hash key is negative",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">any</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">signSafeMod</code> function used in Pulsar collection classes doesn't work with negative input values. This impacts the hash bucket algorithm.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"static final int signSafeMod(long n, int max) {\n         return (int) (n &amp; (max - 1)) &lt;&lt; 2;\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">static final int signSafeMod(long n, int max) {\n         return (int) (n &amp; (max - 1)) &lt;&lt; 2;\n}\n</code></pre></div>\n<p dir=\"auto\">Demonstration in <code class=\"notranslate\">jshell</code> with the invalid <code class=\"notranslate\">signSafeMod</code> implementation:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"jshell&gt; static final int signSafeMod(long n, int max) {\n   ...&gt;         return (int) (n &amp; (max - 1)) &lt;&lt; 2;\n   ...&gt;     }\n|  created method signSafeMod(long,int)\n\njshell&gt; signSafeMod(-2, 8)\n$2 ==&gt; 24\n\"><pre class=\"notranslate\"><code class=\"notranslate\">jshell&gt; static final int signSafeMod(long n, int max) {\n   ...&gt;         return (int) (n &amp; (max - 1)) &lt;&lt; 2;\n   ...&gt;     }\n|  created method signSafeMod(long,int)\n\njshell&gt; signSafeMod(-2, 8)\n$2 ==&gt; 24\n\n</code></pre></div>\n<p dir=\"auto\">The correct value for signSafeMod(-2, 8) is <code class=\"notranslate\">6</code>, not <code class=\"notranslate\">24</code>.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\"><code class=\"notranslate\">signSafeMod</code> function used should really be sign safe and work correctly with negative input values.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">This bug wastes CPU cycles because of the inefficient storage and retrieval since collisions will be very likely when the used capacity of the collection implementation increases.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21108",
                "createdAt": "2023-09-01T09:37:29Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve] [doc] Add doc for customized util class ",
        "url": "https://github.com/apache/pulsar/pull/21110",
        "resourcePath": "/apache/pulsar/pull/21110",
        "createdAt": "2023-09-02T01:42:20Z",
        "number": 21110,
        "mergeCommit": {
          "oid": "e9d1d99354bf6bee19e6d962dadb61f65dc81d5c",
          "message": "[improve] [doc] Add doc for customized util class  (#21110)",
          "commitUrl": "https://github.com/apache/pulsar/commit/e9d1d99354bf6bee19e6d962dadb61f65dc81d5c",
          "parents": {
            "nodes": [
              {
                "oid": "e5cf2160c197f99261fdf4f36ae6c34c88ca44e3",
                "message": "[cleanup][build] Bumped version to 3.2.0-SNAPSHOT (#21147)\n\nSigned-off-by: Jiwe Guo <technoboy@apache.org>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentLongHashMap.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentLongLongPairHashMap.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentLongPairSet.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentOpenHashMap.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentOpenHashSet.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ZYhRW2gAoZjBhYWQ5NzFlZDMwNzZhYTQxY2I5Y2NmYTFlMDYzOTFmNGVmNDQ5ZQ",
                "url": "https://github.com/apache/pulsar/pull/21110/commits/f0aad971ed3076aa41cb9ccfa1e06391f4ef449e"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21109,
                "url": "https://github.com/apache/pulsar/issues/21109",
                "title": "[Bug] [broker] concurrent write and iterate with ConcurrentLongLongPairHashMap.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">all.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Concurrent write while iterate the map.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    @Test\n    public void testConcurrentWriteAndIterate()  throws Throwable {\n        ConcurrentLongLongPairHashMap map = ConcurrentLongLongPairHashMap.newBuilder()\n                .expectedItems(2)\n                .concurrencyLevel(1)\n                .autoShrink(true)\n                .mapIdleFactor(0.25f)\n                .build();\n        assertEquals(map.capacity(), 4);\n\n        ExecutorService executor = Executors.newCachedThreadPool();\n        final int readThreads = 16;\n        final int writeThreads = 1;\n        final int n = 1_000;\n        final int numKeys = 10;\n        CyclicBarrier barrier = new CyclicBarrier(writeThreads + readThreads);\n        Future&lt;?&gt; future = null;\n        AtomicReference&lt;Exception&gt; ex = new AtomicReference&lt;&gt;();\n\n        for (int i = 0; i &lt; readThreads; i++) {\n            executor.submit(() -&gt; {\n                try {\n                    barrier.await();\n                } catch (Exception e) {\n                    throw new RuntimeException(e);\n                }\n                Set&lt;Long&gt; keys = new HashSet&lt;&gt;();\n                while (true) {\n                    map.forEach((k1, k2, v1, v2) -&gt; {\n                        keys.add(k1);\n                    });\n                    for(long j = 1; j &lt; numKeys; j++) {\n                        if (keys.contains(j) &amp;&amp; !keys.contains(j - 1)) {\n                            ex.set(new Exception(&quot;Missing key: &quot; + (j - 1) +&quot; keys: &quot; + keys));\n                        }\n                    }\n                    keys.clear();\n                }\n            });\n        }\n\n        future = executor.submit(() -&gt; {\n            try {\n                barrier.await();\n            } catch (Exception e) {\n                throw new RuntimeException(e);\n            }\n\n            for (int i = 0; i &lt; n; i++) {\n                // expand hashmap\n                for(int j = 0; j &lt; numKeys; j++) {\n                    assertTrue(map.put(j, j, j, j));\n                }\n                // shrink hashmap\n                map.clear();\n                assertEquals(map.capacity(), 4);\n            }\n        });\n\n        future.get();\n        System.out.println(ex.get());\n        assertTrue(ex.get() == null);\n        // shut down pool\n        executor.shutdown();\n    }\"><pre class=\"notranslate\"><code class=\"notranslate\">    @Test\n    public void testConcurrentWriteAndIterate()  throws Throwable {\n        ConcurrentLongLongPairHashMap map = ConcurrentLongLongPairHashMap.newBuilder()\n                .expectedItems(2)\n                .concurrencyLevel(1)\n                .autoShrink(true)\n                .mapIdleFactor(0.25f)\n                .build();\n        assertEquals(map.capacity(), 4);\n\n        ExecutorService executor = Executors.newCachedThreadPool();\n        final int readThreads = 16;\n        final int writeThreads = 1;\n        final int n = 1_000;\n        final int numKeys = 10;\n        CyclicBarrier barrier = new CyclicBarrier(writeThreads + readThreads);\n        Future&lt;?&gt; future = null;\n        AtomicReference&lt;Exception&gt; ex = new AtomicReference&lt;&gt;();\n\n        for (int i = 0; i &lt; readThreads; i++) {\n            executor.submit(() -&gt; {\n                try {\n                    barrier.await();\n                } catch (Exception e) {\n                    throw new RuntimeException(e);\n                }\n                Set&lt;Long&gt; keys = new HashSet&lt;&gt;();\n                while (true) {\n                    map.forEach((k1, k2, v1, v2) -&gt; {\n                        keys.add(k1);\n                    });\n                    for(long j = 1; j &lt; numKeys; j++) {\n                        if (keys.contains(j) &amp;&amp; !keys.contains(j - 1)) {\n                            ex.set(new Exception(\"Missing key: \" + (j - 1) +\" keys: \" + keys));\n                        }\n                    }\n                    keys.clear();\n                }\n            });\n        }\n\n        future = executor.submit(() -&gt; {\n            try {\n                barrier.await();\n            } catch (Exception e) {\n                throw new RuntimeException(e);\n            }\n\n            for (int i = 0; i &lt; n; i++) {\n                // expand hashmap\n                for(int j = 0; j &lt; numKeys; j++) {\n                    assertTrue(map.put(j, j, j, j));\n                }\n                // shrink hashmap\n                map.clear();\n                assertEquals(map.capacity(), 4);\n            }\n        });\n\n        future.get();\n        System.out.println(ex.get());\n        assertTrue(ex.get() == null);\n        // shut down pool\n        executor.shutdown();\n    }\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I expect that, if i can see the pair <code class=\"notranslate\">(n,n,n,n)</code> and <code class=\"notranslate\">n&gt;0</code>, i can see the pair <code class=\"notranslate\">(n-1,n-1,n-1,n-1)</code> because the pair <code class=\"notranslate\">(n,n,n,n)</code> is inserted after the pair <code class=\"notranslate\">(n-1,n-1,n-1,n-1)</code>.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">I can't see the pair <code class=\"notranslate\">(n-1,n-1,n-1,n-1)</code>.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21109",
                "createdAt": "2023-09-02T01:33:06Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            },
            {
              "node": {
                "number": 21113,
                "url": "https://github.com/apache/pulsar/issues/21113",
                "title": "[Bug] [broker] concurrent write and iterate with ConcurrentLongLongPairHashMap V2.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">all.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Concurrent write while iterate the map.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"@Test\n    public void testConcurrentWriteAndIterateV2()  throws Throwable {\n        ConcurrentLongLongPairHashMap map = ConcurrentLongLongPairHashMap.newBuilder()\n                .expectedItems(2)\n                .concurrencyLevel(1)\n                .autoShrink(true)\n                .mapIdleFactor(0.25f)\n                .build();\n        assertEquals(map.capacity(), 4);\n\n        ExecutorService executor = Executors.newCachedThreadPool();\n        final int readThreads = 16;\n        final int writeThreads = 1;\n        final int n = 2_000;\n        CyclicBarrier barrier = new CyclicBarrier(writeThreads + readThreads);\n        Future&lt;?&gt; future = null;\n        AtomicReference&lt;Exception&gt; ex = new AtomicReference&lt;&gt;();\n\n        for (int i = 0; i &lt; readThreads; i++) {\n            executor.submit(() -&gt; {\n                try {\n                    barrier.await();\n                } catch (Exception e) {\n                    throw new RuntimeException(e);\n                }\n                Map&lt;Long, Long&gt; keys = new HashMap&lt;&gt;();\n                while (true) {\n                    map.forEach((k1, k2, v1, v2) -&gt; {\n                        if(keys.containsKey(k1)) {\n                            ex.set(new Exception(&quot;Duplicate mapping pair with same key: (&quot; + k1\n                                    + &quot;,&quot; + keys.get(k1) + &quot;), (&quot; + k1 + &quot;,&quot; + v1 + &quot;)&quot;));\n                        }\n                        keys.put(k1, v1);\n                    });\n                    keys.clear();\n                }\n            });\n        }\n\n        future = executor.submit(() -&gt; {\n            try {\n                barrier.await();\n            } catch (Exception e) {\n                throw new RuntimeException(e);\n            }\n\n            for (int i = 0; i &lt; n; i++) {\n                // expand hashmap\n                assertTrue(map.put(9, 9, 99, 99));\n                assertTrue(map.put(10, 10, 1010, 1010));\n\n                // shrink hashmap\n                map.clear();\n                assertEquals(map.capacity(), 4);\n\n                // with different value\n                assertTrue(map.put(10, 10, 99, 99));\n                assertTrue(map.put(9, 9, 1010, 1010));\n\n//                // with same value\n//                assertTrue(map.put(10, 10, 1010, 1010));\n//                assertTrue(map.put(9, 9, 99, 99));\n\n                // shrink hashmap\n                map.clear();\n                assertEquals(map.capacity(), 4);\n            }\n        });\n\n        future.get();\n        System.out.println(ex.get());\n        assertTrue(ex.get() == null);\n        // shut down pool\n        executor.shutdown();\n    }\n\"><pre class=\"notranslate\"><code class=\"notranslate\">@Test\n    public void testConcurrentWriteAndIterateV2()  throws Throwable {\n        ConcurrentLongLongPairHashMap map = ConcurrentLongLongPairHashMap.newBuilder()\n                .expectedItems(2)\n                .concurrencyLevel(1)\n                .autoShrink(true)\n                .mapIdleFactor(0.25f)\n                .build();\n        assertEquals(map.capacity(), 4);\n\n        ExecutorService executor = Executors.newCachedThreadPool();\n        final int readThreads = 16;\n        final int writeThreads = 1;\n        final int n = 2_000;\n        CyclicBarrier barrier = new CyclicBarrier(writeThreads + readThreads);\n        Future&lt;?&gt; future = null;\n        AtomicReference&lt;Exception&gt; ex = new AtomicReference&lt;&gt;();\n\n        for (int i = 0; i &lt; readThreads; i++) {\n            executor.submit(() -&gt; {\n                try {\n                    barrier.await();\n                } catch (Exception e) {\n                    throw new RuntimeException(e);\n                }\n                Map&lt;Long, Long&gt; keys = new HashMap&lt;&gt;();\n                while (true) {\n                    map.forEach((k1, k2, v1, v2) -&gt; {\n                        if(keys.containsKey(k1)) {\n                            ex.set(new Exception(\"Duplicate mapping pair with same key: (\" + k1\n                                    + \",\" + keys.get(k1) + \"), (\" + k1 + \",\" + v1 + \")\"));\n                        }\n                        keys.put(k1, v1);\n                    });\n                    keys.clear();\n                }\n            });\n        }\n\n        future = executor.submit(() -&gt; {\n            try {\n                barrier.await();\n            } catch (Exception e) {\n                throw new RuntimeException(e);\n            }\n\n            for (int i = 0; i &lt; n; i++) {\n                // expand hashmap\n                assertTrue(map.put(9, 9, 99, 99));\n                assertTrue(map.put(10, 10, 1010, 1010));\n\n                // shrink hashmap\n                map.clear();\n                assertEquals(map.capacity(), 4);\n\n                // with different value\n                assertTrue(map.put(10, 10, 99, 99));\n                assertTrue(map.put(9, 9, 1010, 1010));\n\n//                // with same value\n//                assertTrue(map.put(10, 10, 1010, 1010));\n//                assertTrue(map.put(9, 9, 99, 99));\n\n                // shrink hashmap\n                map.clear();\n                assertEquals(map.capacity(), 4);\n            }\n        });\n\n        future.get();\n        System.out.println(ex.get());\n        assertTrue(ex.get() == null);\n        // shut down pool\n        executor.shutdown();\n    }\n\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I expect that the results of iteration of map, there can't be two mapping pair with the same key whatever the value is same or not.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">There are two mapping pair with the same key, with or without same value.<br>\nRunning the test code above, i get the result like this:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.lang.Exception: Duplicate mapping pair with same key: (9,99), (9,1010)\n\njava.lang.AssertionError\n\tat org.junit.Assert.fail(Assert.java:86)\n\tat org.junit.Assert.assertTrue(Assert.java:41)\n\tat org.junit.Assert.assertTrue(Assert.java:52)\n\tat org.apache.bookkeeper.util.collections.ConcurrentLongLongPairHashMapTest.testConcurrentWriteAndIterateV2(ConcurrentLongLongPairHashMapTest.java:397)\"><pre class=\"notranslate\"><code class=\"notranslate\">java.lang.Exception: Duplicate mapping pair with same key: (9,99), (9,1010)\n\njava.lang.AssertionError\n\tat org.junit.Assert.fail(Assert.java:86)\n\tat org.junit.Assert.assertTrue(Assert.java:41)\n\tat org.junit.Assert.assertTrue(Assert.java:52)\n\tat org.apache.bookkeeper.util.collections.ConcurrentLongLongPairHashMapTest.testConcurrentWriteAndIterateV2(ConcurrentLongLongPairHashMapTest.java:397)\n</code></pre></div>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/52550727/265253459-8fe79788-a06a-4300-b6ab-29251fc7c9e7.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIzODksIm5iZiI6MTcxNDk3MjA4OSwicGF0aCI6Ii81MjU1MDcyNy8yNjUyNTM0NTktOGZlNzk3ODgtYTA2YS00MzAwLWI2YWItMjkyNTFmYzdjOWU3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDgwOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTU0OGZhOWFhNjgzZThhM2ZmMDZmMTc5YWY3MDY4ZjQwMzAyNmM5Yjc1YWExMjM5OWQzMmU2ODEwNmQ1MzJjMjcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.SNPpP_nJQHwdEknKlIadjobH8icxiPA4oSNoPQ-tFuc\"><img width=\"885\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/52550727/265253459-8fe79788-a06a-4300-b6ab-29251fc7c9e7.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzIzODksIm5iZiI6MTcxNDk3MjA4OSwicGF0aCI6Ii81MjU1MDcyNy8yNjUyNTM0NTktOGZlNzk3ODgtYTA2YS00MzAwLWI2YWItMjkyNTFmYzdjOWU3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MDgwOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTU0OGZhOWFhNjgzZThhM2ZmMDZmMTc5YWY3MDY4ZjQwMzAyNmM5Yjc1YWExMjM5OWQzMmU2ODEwNmQ1MzJjMjcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.SNPpP_nJQHwdEknKlIadjobH8icxiPA4oSNoPQ-tFuc\" style=\"max-width: 100%;\"></a>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21113",
                "createdAt": "2023-09-03T09:13:13Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][cli] Add current option in the Clusters list cmd",
        "url": "https://github.com/apache/pulsar/pull/21139",
        "resourcePath": "/apache/pulsar/pull/21139",
        "createdAt": "2023-09-06T08:24:42Z",
        "number": 21139,
        "mergeCommit": {
          "oid": "d1f8f96ad1dbcd4f0e6f5ed03ad432af88c3f8f1",
          "message": "[improve][cli] Add current option in the Clusters list cmd (#21139)",
          "commitUrl": "https://github.com/apache/pulsar/commit/d1f8f96ad1dbcd4f0e6f5ed03ad432af88c3f8f1",
          "parents": {
            "nodes": [
              {
                "oid": "3cb79264c4476a2cd34b0807133afc29750c047d",
                "message": "[fix][test]Flaky test testMaxPendingChunkMessages (#21103)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdClusters.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/test/java/org/apache/pulsar/admin/cli/TestCmdClusters.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5Zp_gQ2gAoY2RhMDI0YmQ1NjVhMDc2MGMzZjczMzI3NTE0NzViMTA1NzU2YTJhOQ",
                "url": "https://github.com/apache/pulsar/pull/21139/commits/cda024bd565a0760c3f7332751475b105756a2a9"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20581,
                "url": "https://github.com/apache/pulsar/issues/20581",
                "title": "[Improve][Admin API] Clusters list API return clusters with local and remote flag",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">After configuring the geo-replication on Pulsar clusters, the <code class=\"notranslate\">clusters list</code> API will return multiple clusters, including the local Pulsar cluster and remote clusters like</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-admin clusters list\nus-west\nus-east\nus-cent\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-admin clusters list\nus-west\nus-east\nus-cent\n</code></pre></div>\n<p dir=\"auto\">But in this return, you can't distinguish the local and the remote cluster. When you need to remove the geo-replication configuration, it will be hard to decide which cluster should be removed on replicated tenants and namespaces unless you record the cluster information.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">I am thinking about whether it's possible to add some flags on the <code class=\"notranslate\">clusters list</code> API return data like</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-admin clusters list\nus-west(local)\nus-east(remote)\nus-cent(remote)\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-admin clusters list\nus-west(local)\nus-east(remote)\nus-cent(remote)\n</code></pre></div>\n<p dir=\"auto\">That will be easy for users to distinguish.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20581",
                "createdAt": "2023-06-15T06:48:50Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve] [broker] support load placement based on different dimensions",
        "url": "https://github.com/apache/pulsar/pull/21175",
        "resourcePath": "/apache/pulsar/pull/21175",
        "createdAt": "2023-09-13T11:40:09Z",
        "number": 21175,
        "mergeCommit": null,
        "potentialMergeCommit": {
          "oid": "83f9a7647e29e5be070c19f7d58d4405cdbbafdb",
          "message": "Merge 90039396c1747d633f0da647e53e2d69ba4ab015 into eee3694f00e269eef0f75d791521d0d35d8ff411",
          "commitUrl": "https://github.com/apache/pulsar/commit/83f9a7647e29e5be070c19f7d58d4405cdbbafdb",
          "parents": {
            "nodes": [
              {
                "oid": "eee3694f00e269eef0f75d791521d0d35d8ff411",
                "message": "[fix][storage] ReadonlyManagedLedger initialization does not fill in the properties (#22630)"
              },
              {
                "oid": "90039396c1747d633f0da647e53e2d69ba4ab015",
                "message": "add license header"
              }
            ]
          }
        },
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/UniformLoadManagerStrategy.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/ModularLoadManagerStrategyTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5aObcA2gAoOTAwMzkzOTZjMTc0N2Q2MzNmMGRhNjQ3ZTUzZTJkNjliYTRhYjAxNQ",
                "url": "https://github.com/apache/pulsar/pull/21175/commits/90039396c1747d633f0da647e53e2d69ba4ab015"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21174,
                "url": "https://github.com/apache/pulsar/issues/21174",
                "title": "[Bug] Brokers can't reach balanced state sometimes when using UnifromLoadShedder",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.10.5</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Start 3 brokers and create some topics</li>\n<li>Start producing and consuming for all these topics</li>\n<li>Enable load balance with Uniformloadshedder:</li>\n</ol>\n<ul dir=\"auto\">\n<li>loadBalancerMsgThroughputMultiplierDifferenceShedderThreshold=1.1</li>\n<li>loadBalancerMsgRateDifferenceShedderThreshold=0, means disable msgRate based shedding</li>\n</ul>\n<ol start=\"5\" dir=\"auto\">\n<li>Use the default loadBalancerLoadPlacementStrategy <code class=\"notranslate\">org.apache.pulsar.broker.loadbalance.impl.LeastLongTermMessageRate</code></li>\n<li>Restart brokers several times to trigger the load balance</li>\n<li>There is a chance to see brokers can't reach the balanced state for long time.</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">All brokers should reach a balanced state after rounds of shedding.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Brokers may stay in an un-balanced state for a long time.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21174",
                "createdAt": "2023-09-13T11:26:30Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Avoid consumers receiving acknowledged messages from compacted topic after reconnection",
        "url": "https://github.com/apache/pulsar/pull/21187",
        "resourcePath": "/apache/pulsar/pull/21187",
        "createdAt": "2023-09-15T03:07:36Z",
        "number": 21187,
        "mergeCommit": {
          "oid": "e81a20d667aef7c0f888e88dbcf972196012ebea",
          "message": "[fix][broker] Avoid consumers receiving acknowledged messages from compacted topic after reconnection (#21187)",
          "commitUrl": "https://github.com/apache/pulsar/commit/e81a20d667aef7c0f888e88dbcf972196012ebea",
          "parents": {
            "nodes": [
              {
                "oid": "434da8b5cc76a08215319be7ab066e1d1c23f6c4",
                "message": "[cleanup] [broker] fix doc for TransactionBuffer#isTxnAborted (#21956)\n\n### Motivation\r\n~~The argument `PositionImpl readPosition` of method `org.apache.pulsar.broker.transaction.buffer.TransactionBuffer#isTxnAborted` is weird and unneccessary, we have better remove it to avoid confusion.~~\r\nArgument `PositionImpl readPosition` is used for future.\r\n\r\n### Modifications\r\n~~Remove the argument `PositionImpl readPosition`.~~\r\nfix the doc and add to-do to avoid confusion."
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/ManagedCursor.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentDispatcherSingleActiveConsumer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/CompactedTopicImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/ReplicatorSubscriptionTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/transaction/TransactionTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/ReaderTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/compaction/CompactionTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5aZhYS2gAoYmFkNzE5ZjZiM2E3NjE1NTZjMmRiZjk0MjllMzA1ZjJiYjFjNmUwNg",
                "url": "https://github.com/apache/pulsar/pull/21187/commits/bad719f6b3a761556c2dbf9429e305f2bb1c6e06"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21074,
                "url": "https://github.com/apache/pulsar/issues/21074",
                "title": "[Bug] Topic unloading during Compaction leads to messages loss and messages redelivery loop",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">3.1.0 using official Helm chart<br>\nLatest build from master using official Helm chart</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Use 3 bookies, 3 brokers, 3 proxies</p>\n<ol dir=\"auto\">\n<li>Create compacted, partitioned topic with the compaction threshold set to 1GB</li>\n<li>Produce 100k of messages of 100 kb size</li>\n<li>Create exclusive consumer and start reading</li>\n<li>Produce 100k of messages with the same keys<br>\n-- wait for the messages to be produced and the compaction to finish</li>\n<li>Create new exclusive consumer and read all the messages</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Compaction finish successfully.<br>\nFirst consumer receives between 100k - 200k messages<br>\nSecond consumer receives 100k messages</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<ul dir=\"auto\">\n<li>I see in the error logs that the compaction fails.</li>\n</ul>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/4356553/263541725-b26ff482-de67-4b6c-96d9-6cec98bc8e13.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzI0OTcsIm5iZiI6MTcxNDk3MjE5NywicGF0aCI6Ii80MzU2NTUzLzI2MzU0MTcyNS1iMjZmZjQ4Mi1kZTY3LTRiNmMtOTZkOS02Y2VjOThiYzhlMTMucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDUwNiUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA1MDZUMDUwOTU3WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ZTU0NTliOTQ3Y2U2OGM3OWZjNGUwYmVlNzkxYmU5N2Y4YjgyYjg1OTQ4ZmEzNjQ2YmRiYzE4ZDM5OGI3ODAxMiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.UBf8KAmSnJgD_3Aj3NoPj1DW68VbSkbEkqJR2uGlzMs\"><img width=\"1618\" alt=\"Screenshot 2023-08-27 at 18 02 33\" src=\"https://private-user-images.githubusercontent.com/4356553/263541725-b26ff482-de67-4b6c-96d9-6cec98bc8e13.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzI0OTcsIm5iZiI6MTcxNDk3MjE5NywicGF0aCI6Ii80MzU2NTUzLzI2MzU0MTcyNS1iMjZmZjQ4Mi1kZTY3LTRiNmMtOTZkOS02Y2VjOThiYzhlMTMucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDUwNiUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA1MDZUMDUwOTU3WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ZTU0NTliOTQ3Y2U2OGM3OWZjNGUwYmVlNzkxYmU5N2Y4YjgyYjg1OTQ4ZmEzNjQ2YmRiYzE4ZDM5OGI3ODAxMiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.UBf8KAmSnJgD_3Aj3NoPj1DW68VbSkbEkqJR2uGlzMs\" style=\"max-width: 100%;\"></a>\n<ul dir=\"auto\">\n<li>The first consumer often starts to receive messages, that were already delivered (millions of messages, It never ends)</li>\n<li>The second consumer cannot receive all the messages. Sometimes it is able to finish, sometimes is not (falls into the loop)</li>\n<li>The backlog of the subscription does not change while the consumers are reading</li>\n</ul>\n<p dir=\"auto\">Reads come from one broker, the backlog is not changing (the screenshot is from my environment/system):<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/4356553/263541715-87803ebd-3488-4092-bb64-15444123c21b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzI0OTcsIm5iZiI6MTcxNDk3MjE5NywicGF0aCI6Ii80MzU2NTUzLzI2MzU0MTcxNS04NzgwM2ViZC0zNDg4LTQwOTItYmI2NC0xNTQ0NDEyM2MyMWIucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDUwNiUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA1MDZUMDUwOTU3WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ZmViNzVmNWVmZTlkNzdmODRmM2IyYWNlNzVjOTQwNTE2ZDUyYWNiMGU0MTliZDkwMWNlZmMyYTFjZTM0NzBiZSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.y0xh5G-mMAv3CfTc1_Extt2a7N2f1jJnuHr6hvh9yck\"><img width=\"1679\" alt=\"Screenshot 2023-08-27 at 18 29 22\" src=\"https://private-user-images.githubusercontent.com/4356553/263541715-87803ebd-3488-4092-bb64-15444123c21b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzI0OTcsIm5iZiI6MTcxNDk3MjE5NywicGF0aCI6Ii80MzU2NTUzLzI2MzU0MTcxNS04NzgwM2ViZC0zNDg4LTQwOTItYmI2NC0xNTQ0NDEyM2MyMWIucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDUwNiUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA1MDZUMDUwOTU3WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9ZmViNzVmNWVmZTlkNzdmODRmM2IyYWNlNzVjOTQwNTE2ZDUyYWNiMGU0MTliZDkwMWNlZmMyYTFjZTM0NzBiZSZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.y0xh5G-mMAv3CfTc1_Extt2a7N2f1jJnuHr6hvh9yck\" style=\"max-width: 100%;\"></a><br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/4356553/263542513-05f9ffdd-5253-4fd9-a024-03f98a5fa754.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzI0OTcsIm5iZiI6MTcxNDk3MjE5NywicGF0aCI6Ii80MzU2NTUzLzI2MzU0MjUxMy0wNWY5ZmZkZC01MjUzLTRmZDktYTAyNC0wM2Y5OGE1ZmE3NTQucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDUwNiUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA1MDZUMDUwOTU3WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9YjY0NjljZDdkZWQ0ZGQ3ZTgzYmY0ZWY0MWIyYjhiMmJiNjZlYWRmOTQ4ZGQ2MWZhOTg5YTAxZmY0MTE2NzdlYyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.OnwhN7k_Q30bCljelZQUd6QBGIoLrWIV-3OnQ3iWlCk\"><img width=\"728\" alt=\"Screenshot 2023-08-27 at 18 45 05\" src=\"https://private-user-images.githubusercontent.com/4356553/263542513-05f9ffdd-5253-4fd9-a024-03f98a5fa754.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzI0OTcsIm5iZiI6MTcxNDk3MjE5NywicGF0aCI6Ii80MzU2NTUzLzI2MzU0MjUxMy0wNWY5ZmZkZC01MjUzLTRmZDktYTAyNC0wM2Y5OGE1ZmE3NTQucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDUwNiUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA1MDZUMDUwOTU3WiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9YjY0NjljZDdkZWQ0ZGQ3ZTgzYmY0ZWY0MWIyYjhiMmJiNjZlYWRmOTQ4ZGQ2MWZhOTg5YTAxZmY0MTE2NzdlYyZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.OnwhN7k_Q30bCljelZQUd6QBGIoLrWIV-3OnQ3iWlCk\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The reproduction steps depends on the used setup, speed of the persistent storage. It's possible that the re balancing or adding new broker affects the steps. I cannot provide reproducible way, as it happens randomly. Nevertheless it happens to us almost every day.</p>\n<p dir=\"auto\">Now, I produced:<br>\n30 GB of 30kb files x 2<br>\n5 GB of 5MB files x 2<br>\n4,6 GB of 130kb files x 2</p>\n<p dir=\"auto\">I reconnected the client and started reading. Client received 5 048 330 messages, but only 661 897 unique.<br>\nThe consumer summary after 93 minutes:<br>\n<code class=\"notranslate\">#93 Processing 1 message(s). Totally received: 5140219, already processed: 5140218 (ACK: 5140218.0, NACK: 0.0, Invalid: 0.0, Failed to ACK/NACK: 0.0</code></p>\n<p dir=\"auto\">My internal stats:<br>\n<a href=\"https://github.com/apache/pulsar/files/12448404/internal.stats.txt\">internal.stats.txt</a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21074",
                "createdAt": "2023-08-27T16:32:40Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Avoid record inactiveproducers when deduplication is disable.",
        "url": "https://github.com/apache/pulsar/pull/21193",
        "resourcePath": "/apache/pulsar/pull/21193",
        "createdAt": "2023-09-16T13:19:59Z",
        "number": 21193,
        "mergeCommit": {
          "oid": "8beac8b12ef7c0ef54529fbb7e4e76c54dea6283",
          "message": "[improve][broker] Avoid record inactiveproducers when deduplication is disable. (#21193)\n\nCo-authored-by: Jiwe Guo <technoboy@apache.org>",
          "commitUrl": "https://github.com/apache/pulsar/commit/8beac8b12ef7c0ef54529fbb7e4e76c54dea6283",
          "parents": {
            "nodes": [
              {
                "oid": "b944f10d2a9bac2fbe19dc83bf250a276f1ed4d1",
                "message": "[fix][test] Don't reuse AsyncResponse mocks in PersistentTopicsTest (#21769)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/MessageDeduplication.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/MessageDuplicationTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5afjiu2gAoODlmNjBhZjMwY2MyY2I1MDE5NzM0ZjA2OWQ3ODgyNDRhZjAwMWNhOQ",
                "url": "https://github.com/apache/pulsar/pull/21193/commits/89f60af30cc2cb5019734f069d788244af001ca9"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21192,
                "url": "https://github.com/apache/pulsar/issues/21192",
                "title": "[Bug] Deduplication and short alive producers make broker in high gc frequency state.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">create a lot of short alive producer, create send one message and close. run for two hour.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">nothing happened.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">the broker heap grows slowly, gc start and finally oom.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">no</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21192",
                "createdAt": "2023-09-16T13:03:45Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][proxy] When adding new brokers resolve the DNS name more quickly",
        "url": "https://github.com/apache/pulsar/pull/21207",
        "resourcePath": "/apache/pulsar/pull/21207",
        "createdAt": "2023-09-19T14:32:40Z",
        "number": 21207,
        "mergeCommit": {
          "oid": "e5b0f170e4295a22148ef686bd4ddf8143a222d0",
          "message": "[improve][proxy] When adding new brokers resolve the DNS name more quickly (#21207)",
          "commitUrl": "https://github.com/apache/pulsar/commit/e5b0f170e4295a22148ef686bd4ddf8143a222d0",
          "parents": {
            "nodes": [
              {
                "oid": "1b7084b97a853ec45baf8f02c212783d6f2a3bc1",
                "message": "[fix][broker] Delete unused param (#20866)\n\nCo-authored-by: \u5f20\u6d69 <zhanghao60@100.me>\r\nCo-authored-by: tison <wander4096@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/pulsar/Dockerfile"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ar6Wd2gAoMGMzZDNiYjlkMzAyNTVhYmZhYTIxZTIzMTA5ZjYxOTI0MDMyMmM4NA",
                "url": "https://github.com/apache/pulsar/pull/21207/commits/0c3d3bb9d30255abfaa21e23109f619240322c84"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21206,
                "url": "https://github.com/apache/pulsar/issues/21206",
                "title": "[Bug] Proxy DNS resolution failure when brokers are autoscaling",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">OS: Linux<br>\nPulsar: 2.10.3<br>\nChart: 3.0.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Autoscale Brokers by driving load through pulsar</li>\n<li>Have a Pulsar client connection and operation time around 3 to 4 seconds (well below the default time of <code class=\"notranslate\">networkaddress.cache.negative.ttl</code> or 10 seconds)</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Proxies quickly detect any new brokers within a few seconds</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Proxy DNS Lookup failures result in client failures</p>\n<p dir=\"auto\">Proxy Logs show the following</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-09-15T14:25:06,331+0000 [pulsar-proxy-io-2-1] ERROR org.apache.pulsar.proxy.server.ProxyConnection - [/127.0.0.6:50675] Error validating target broker 'platform-pulsar-broker-4.platform-pulsar-broker.cogito-load.svc.cluster.local:6650'. authenticated with none role null.\njava.util.concurrent.CompletionException: java.net.UnknownHostException: Failed to resolve 'platform-pulsar-broker-4.platform-pulsar-broker.cogito-load.svc.cluster.local' after 2 queries\nat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:331) ~[?:?]\nat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:346) ~[?:?]\nat java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:1063) ~[?:?]\nat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:506) ~[?:?]\nat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088) ~[?:?]\nat org.apache.pulsar.common.util.netty.NettyFutureUtil.lambda$toCompletableFuture$0(NettyFutureUtil.java:51) ~[org.apache.pulsar-pulsar-common-2.10.3.jar:2.10.3]\nat io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:590) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:557) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:492) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:636) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:629) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.setFailure(DefaultPromise.java:110) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.InetSocketAddressResolver$1.operationComplete(InetSocketAddressResolver.java:62) ~[io.netty-netty-resolver-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:590) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:557) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.access$200(DefaultPromise.java:35) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise$1.run(DefaultPromise.java:503) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:174) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:167) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:403) ~[io.netty-netty-transport-classes-epoll-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat java.lang.Thread.run(Thread.java:829) ~[?:?]\nCaused by: java.net.UnknownHostException: Failed to resolve 'platform-pulsar-broker-4.platform-pulsar-broker.cogito-load.svc.cluster.local' after 2 queries\nat io.netty.resolver.dns.DnsResolveContext.finishResolve(DnsResolveContext.java:1047) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsResolveContext.tryToFinishResolve(DnsResolveContext.java:1000) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsResolveContext.query(DnsResolveContext.java:418) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsResolveContext.tryToFinishResolve(DnsResolveContext.java:971) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsResolveContext.access$700(DnsResolveContext.java:66) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsResolveContext$2.operationComplete(DnsResolveContext.java:471) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:590) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:583) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:559) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:492) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:636) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.setSuccess0(DefaultPromise.java:625) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.trySuccess(DefaultPromise.java:105) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsQueryContext.trySuccess(DnsQueryContext.java:232) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsQueryContext.finish(DnsQueryContext.java:224) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsNameResolver$DnsResponseHandler.channelRead(DnsNameResolver.java:1314) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103) ~[io.netty-netty-codec-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.epoll.EpollDatagramChannel.processPacket(EpollDatagramChannel.java:662) ~[io.netty-netty-transport-classes-epoll-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.epoll.EpollDatagramChannel.recvmsg(EpollDatagramChannel.java:697) ~[io.netty-netty-transport-classes-epoll-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.epoll.EpollDatagramChannel.access$300(EpollDatagramChannel.java:56) ~[io.netty-netty-transport-classes-epoll-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.epoll.EpollDatagramChannel$EpollDatagramChannelUnsafe.epollInReady(EpollDatagramChannel.java:536) ~[io.netty-netty-transport-classes-epoll-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:499) ~[io.netty-netty-transport-classes-epoll-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:397) ~[io.netty-netty-transport-classes-epoll-4.1.86.Final.jar:4.1.86.Final]\n... 4 more&quot;,\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-09-15T14:25:06,331+0000 [pulsar-proxy-io-2-1] ERROR org.apache.pulsar.proxy.server.ProxyConnection - [/127.0.0.6:50675] Error validating target broker 'platform-pulsar-broker-4.platform-pulsar-broker.cogito-load.svc.cluster.local:6650'. authenticated with none role null.\njava.util.concurrent.CompletionException: java.net.UnknownHostException: Failed to resolve 'platform-pulsar-broker-4.platform-pulsar-broker.cogito-load.svc.cluster.local' after 2 queries\nat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:331) ~[?:?]\nat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:346) ~[?:?]\nat java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:1063) ~[?:?]\nat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:506) ~[?:?]\nat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088) ~[?:?]\nat org.apache.pulsar.common.util.netty.NettyFutureUtil.lambda$toCompletableFuture$0(NettyFutureUtil.java:51) ~[org.apache.pulsar-pulsar-common-2.10.3.jar:2.10.3]\nat io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:590) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:557) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:492) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:636) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.setFailure0(DefaultPromise.java:629) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.setFailure(DefaultPromise.java:110) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.InetSocketAddressResolver$1.operationComplete(InetSocketAddressResolver.java:62) ~[io.netty-netty-resolver-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:590) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:557) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.access$200(DefaultPromise.java:35) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise$1.run(DefaultPromise.java:503) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.AbstractEventExecutor.runTask(AbstractEventExecutor.java:174) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.AbstractEventExecutor.safeExecute(AbstractEventExecutor.java:167) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.SingleThreadEventExecutor.runAllTasks(SingleThreadEventExecutor.java:470) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:403) ~[io.netty-netty-transport-classes-epoll-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat java.lang.Thread.run(Thread.java:829) ~[?:?]\nCaused by: java.net.UnknownHostException: Failed to resolve 'platform-pulsar-broker-4.platform-pulsar-broker.cogito-load.svc.cluster.local' after 2 queries\nat io.netty.resolver.dns.DnsResolveContext.finishResolve(DnsResolveContext.java:1047) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsResolveContext.tryToFinishResolve(DnsResolveContext.java:1000) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsResolveContext.query(DnsResolveContext.java:418) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsResolveContext.tryToFinishResolve(DnsResolveContext.java:971) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsResolveContext.access$700(DnsResolveContext.java:66) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsResolveContext$2.operationComplete(DnsResolveContext.java:471) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListener0(DefaultPromise.java:590) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListeners0(DefaultPromise.java:583) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListenersNow(DefaultPromise.java:559) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.notifyListeners(DefaultPromise.java:492) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.setValue0(DefaultPromise.java:636) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.setSuccess0(DefaultPromise.java:625) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.util.concurrent.DefaultPromise.trySuccess(DefaultPromise.java:105) ~[io.netty-netty-common-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsQueryContext.trySuccess(DnsQueryContext.java:232) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsQueryContext.finish(DnsQueryContext.java:224) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.resolver.dns.DnsNameResolver$DnsResponseHandler.channelRead(DnsNameResolver.java:1314) ~[io.netty-netty-resolver-dns-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103) ~[io.netty-netty-codec-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[io.netty-netty-transport-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.epoll.EpollDatagramChannel.processPacket(EpollDatagramChannel.java:662) ~[io.netty-netty-transport-classes-epoll-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.epoll.EpollDatagramChannel.recvmsg(EpollDatagramChannel.java:697) ~[io.netty-netty-transport-classes-epoll-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.epoll.EpollDatagramChannel.access$300(EpollDatagramChannel.java:56) ~[io.netty-netty-transport-classes-epoll-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.epoll.EpollDatagramChannel$EpollDatagramChannelUnsafe.epollInReady(EpollDatagramChannel.java:536) ~[io.netty-netty-transport-classes-epoll-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:499) ~[io.netty-netty-transport-classes-epoll-4.1.86.Final.jar:4.1.86.Final]\nat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:397) ~[io.netty-netty-transport-classes-epoll-4.1.86.Final.jar:4.1.86.Final]\n... 4 more\",\n</code></pre></div>\n<p dir=\"auto\">Client logs show the following</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-09-15 14:25:02,599 [pulsar-client-io-1-11] WARN  nt.impl.ConnectionHandler - \n[persistent://healthking/wav/22688263-d8ef-4c42-95e6-3f3de5c15eaf] [platform-pulsar-187-14152] Error connecting to \nbroker: org.apache.pulsar.client.api.PulsarClientException$LookupException: \n{&quot;errorMsg&quot;:&quot;org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: \njava.net.UnknownHostException: Failed to resolve 'platform-pulsar-broker-4.platform-pulsar-broker.cogito-\nload.svc.cluster.local' after 2 queries &quot;,&quot;reqId&quot;:2800630258978141960, &quot;remote&quot;:&quot;pulsar.cogito-load.saas-qua.us-east-\n1.cogitocorp.biz/44.209.61.91:7443&quot;, &quot;local&quot;:&quot;/10.5.61.171:34392&quot;}\n\n2023-09-15 14:25:02,621 [pulsar-client-io-1-16] ERROR sar.client.impl.ClientCnx - [id: 0x8e8021e9, L:/10.5.59.34:59450 - \nR:pulsar.cogito-load.saas-qua.us-east-1.cogitocorp.biz/44.209.61.91:7443] Close connection because received internal-\nserver error org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: \njava.net.UnknownHostException: Failed to resolve 'platform-pulsar-broker-4.platform-pulsar-broker.cogito-\nload.svc.cluster.local' after 2 queries \"><pre class=\"notranslate\"><code class=\"notranslate\">2023-09-15 14:25:02,599 [pulsar-client-io-1-11] WARN  nt.impl.ConnectionHandler - \n[persistent://healthking/wav/22688263-d8ef-4c42-95e6-3f3de5c15eaf] [platform-pulsar-187-14152] Error connecting to \nbroker: org.apache.pulsar.client.api.PulsarClientException$LookupException: \n{\"errorMsg\":\"org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: \njava.net.UnknownHostException: Failed to resolve 'platform-pulsar-broker-4.platform-pulsar-broker.cogito-\nload.svc.cluster.local' after 2 queries \",\"reqId\":2800630258978141960, \"remote\":\"pulsar.cogito-load.saas-qua.us-east-\n1.cogitocorp.biz/44.209.61.91:7443\", \"local\":\"/10.5.61.171:34392\"}\n\n2023-09-15 14:25:02,621 [pulsar-client-io-1-16] ERROR sar.client.impl.ClientCnx - [id: 0x8e8021e9, L:/10.5.59.34:59450 - \nR:pulsar.cogito-load.saas-qua.us-east-1.cogitocorp.biz/44.209.61.91:7443] Close connection because received internal-\nserver error org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.CompletionException: \njava.net.UnknownHostException: Failed to resolve 'platform-pulsar-broker-4.platform-pulsar-broker.cogito-\nload.svc.cluster.local' after 2 queries \n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21206",
                "createdAt": "2023-09-19T14:22:08Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] fix the global topic policy config override the local topic policy config",
        "url": "https://github.com/apache/pulsar/pull/21212",
        "resourcePath": "/apache/pulsar/pull/21212",
        "createdAt": "2023-09-20T18:08:48Z",
        "number": 21212,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/SystemTopicBasedTopicPoliciesService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/TopicPoliciesTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/SystemTopicBasedTopicPoliciesServiceTest.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/BeanUtil.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-common/src/test/java/org/apache/pulsar/common/util/BeanUtilTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5az4_62gAoODU0NTI4MWI4NDczZTNmNTBiZjBlODQxZGUyNGFhZjIwMTllZjkyNg",
                "url": "https://github.com/apache/pulsar/pull/21212/commits/8545281b8473e3f50bf0e841de24aaf2019ef926"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21202,
                "url": "https://github.com/apache/pulsar/issues/21202",
                "title": "[Bug] The global topic policy config override the local topic policy config",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.10.5</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>\n<p dir=\"auto\">create a Topic<br>\n<code class=\"notranslate\">./pulsar-admin --admin-url http://127.0.0.1:8881 topics create-partitioned-topic -p 2 persistent://geo/geo/geo_3</code></p>\n</li>\n<li>\n<p dir=\"auto\">set local topic policy (This problem exists in all configurations, max-message-size is used here to demonstrate)<br>\n<code class=\"notranslate\"> ./pulsar-admin --admin-url http://127.0.0.1:8880 topicPolicies set-max-message-size persistent://geo/geo/geo_3 -m 10000</code></p>\n</li>\n<li>\n<p dir=\"auto\">set global topic policy<br>\n<code class=\"notranslate\">  ./pulsar-admin --admin-url http://127.0.0.1:8880 topicPolicies set-max-message-size persistent://geo/geo/geo_3 -g -m 10</code></p>\n</li>\n<li>\n<p dir=\"auto\">check the topic policy<br>\n<code class=\"notranslate\">./pulsar-admin --admin-url http://127.0.0.1:8880 topicPolicies get-max-message-size persistent://geo/geo/geo_3</code><br>\nresult: 10000</p>\n<p dir=\"auto\"><code class=\"notranslate\">./pulsar-admin --admin-url http://127.0.0.1:8880 topicPolicies get-max-message-size persistent://geo/geo/geo_3 -g</code><br>\nresult: 10</p>\n</li>\n<li>\n<p dir=\"auto\">verify the configuration to take effect<br>\n<code class=\"notranslate\">./pulsar-client --url pulsar://127.0.0.1:6650 produce -m 0123456780123456789 persistent://geo/geo/geo_3</code></p>\n</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">2023-09-18T20:25:03,301+0800 [main] INFO  org.apache.pulsar.client.cli.PulsarClientTool - 1 messages successfully produced</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">2023-09-18T20:25:33,934+0800 [main] ERROR org.apache.pulsar.client.cli.PulsarClientTool - Exceed maximum message size<br>\norg.apache.pulsar.client.api.PulsarClientException$NotAllowedException: Exceed maximum message size<br>\nat org.apache.pulsar.client.api.PulsarClientException.unwrap(PulsarClientException.java:1048) ~[org.apache.pulsar-pulsar-client-api-2.10.4.jar:2.10.4]<br>\nat org.apache.pulsar.client.impl.TypedMessageBuilderImpl.send(TypedMessageBuilderImpl.java:90) ~[org.apache.pulsar-pulsar-client-original-2.10.4.jar:2.10.4]<br>\nat org.apache.pulsar.client.cli.CmdProduce.publish(CmdProduce.java:309) ~[org.apache.pulsar-pulsar-client-tools-2.10.4.jar:2.10.4]<br>\nat org.apache.pulsar.client.cli.CmdProduce.run(CmdProduce.java:241) ~[org.apache.pulsar-pulsar-client-tools-2.10.4.jar:2.10.4]<br>\nat org.apache.pulsar.client.cli.PulsarClientTool.run(PulsarClientTool.java:184) ~[org.apache.pulsar-pulsar-client-tools-2.10.4.jar:2.10.4]<br>\nat org.apache.pulsar.client.cli.PulsarClientTool.main(PulsarClientTool.java:220) ~[org.apache.pulsar-pulsar-client-tools-2.10.4.jar:2.10.4]<br>\n2023-09-18T20:25:33,937+0800 [main] INFO  org.apache.pulsar.client.cli.PulsarClientTool - 0 messages successfully produced</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">as <a href=\"https://github.com/apache/pulsar/wiki/PIP-92%3A-Topic-policy-across-multiple-clusters\">PIP-92</a> described:<br>\nAfter adding the global topic policy, the topic applied priority is:</p>\n<p dir=\"auto\">Local cluster topic &gt; policy Global topic policy &gt; Namespace policy &gt; Broker default configuration</p>\n<p dir=\"auto\">the global topic policy config shouldn't override the local topic policy config.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21202",
                "createdAt": "2023-09-18T12:33:20Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][client] Add a way to configure which DNS use",
        "url": "https://github.com/apache/pulsar/pull/21227",
        "resourcePath": "/apache/pulsar/pull/21227",
        "createdAt": "2023-09-21T13:47:12Z",
        "number": 21227,
        "mergeCommit": {
          "oid": "25c662d0de105a95ce39a5de695d774b60e8419e",
          "message": "[improve][client] Add a way to configure which DNS use (#21227)\n\nCo-authored-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/25c662d0de105a95ce39a5de695d774b60e8419e",
          "parents": {
            "nodes": [
              {
                "oid": "6947b7f665ef24b15ef21a759a88849c7675f9a7",
                "message": "[improve][pip] PIP-305: Customize DNS servers to use for Pulsar Client (#21352)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/ClientBuilder.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ClientBuilderImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConnectionPool.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/conf/ClientConfigurationData.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/ClientBuilderImplTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/PulsarClientImplTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/conf/ConfigurationDataUtilsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5a5Gan2gAoMjEzMGRjZTBkYWIxYTc1MGI5YzlmYzk4ODEzYTNkZmVmNjI5YmI0ZA",
                "url": "https://github.com/apache/pulsar/pull/21227/commits/2130dce0dab1a750b9c9fc98813a3dfef629bb4d"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21226,
                "url": "https://github.com/apache/pulsar/issues/21226",
                "title": "Add a configurable DNS server list",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Currently is not possibile to configure one or more dns servers that will be used by the client to resolve hostnames.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">In <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1083780247\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/13390\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/13390/hovercard\" href=\"https://github.com/apache/pulsar/pull/13390\">#13390</a> and 13503 has been added the capability to altering the dns binding address, we can enhance it more allowing DNS server list too</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\">You can try to set dns server addresses using netty properties like <code class=\"notranslate\">io.netty.resolver.dns.defaultNameServerFallback</code> (see DefaultDnsServerAddressStreamProvider) but it doesn't work on jdk 8 nor on Android systems.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21226",
                "createdAt": "2023-09-21T13:38:54Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Replicator failed to create remote producer",
        "url": "https://github.com/apache/pulsar/pull/21247",
        "resourcePath": "/apache/pulsar/pull/21247",
        "createdAt": "2023-09-25T14:30:17Z",
        "number": 21247,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractReplicator.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/ReplicatorTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5bIcDw2gAoYTdmYWY1NDhmMmM0ZDYwZWQ0NWEwMTFjMWY3ODEyMGQ0NWIzOTRiMQ",
                "url": "https://github.com/apache/pulsar/pull/21247/commits/a7faf548f2c4d60ed45a011c1f78120d45b394b1"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21242,
                "url": "https://github.com/apache/pulsar/issues/21242",
                "title": "[Bug] [geo-replication] Failed to create remote producer (org.apache.avro.AvroRuntimeException: Not a record: \"string\")",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.9.2 and above versions</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">1\u3001create topic [test-tenant/test-ns/test-topic] in cluster-1 and cluster-2</p>\n<p dir=\"auto\">2\u3001send message by producer use Schema.JSON(String.class) in cluster-1<br>\n<code class=\"notranslate\">Producer&lt;String&gt; producer = client.newProducer(Schema.JSON(String.class)).topic(\"test-tenant/test-ns/test-topic\").create();</code></p>\n<p dir=\"auto\">3\u3001start geo-replication from cluster-2 to cluster-1</p>\n<p dir=\"auto\">4\u3001We will encounter the following exception in cluster-2 broker log<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/16524922/270235520-676fc919-0d5e-400e-971f-f3c3f90035d4.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzI1ODAsIm5iZiI6MTcxNDk3MjI4MCwicGF0aCI6Ii8xNjUyNDkyMi8yNzAyMzU1MjAtNjc2ZmM5MTktMGQ1ZS00MDBlLTk3MWYtZjNjM2Y5MDAzNWQ0LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MTEyMFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTI0YmE0M2I0Y2EzMWUyNGM0ODkzNzdhNzUzMzAwNDlmZGE5NDhlY2M4ZTg5NjQzZjhlMDQ2MzVlNGM2MWY1OTQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.KjCvRAqV4RxBD_vGafOPw8UtAeeCwTqNuhIbG4ToFek\"><img src=\"https://private-user-images.githubusercontent.com/16524922/270235520-676fc919-0d5e-400e-971f-f3c3f90035d4.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzI1ODAsIm5iZiI6MTcxNDk3MjI4MCwicGF0aCI6Ii8xNjUyNDkyMi8yNzAyMzU1MjAtNjc2ZmM5MTktMGQ1ZS00MDBlLTk3MWYtZjNjM2Y5MDAzNWQ0LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MTEyMFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTI0YmE0M2I0Y2EzMWUyNGM0ODkzNzdhNzUzMzAwNDlmZGE5NDhlY2M4ZTg5NjQzZjhlMDQ2MzVlNGM2MWY1OTQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.KjCvRAqV4RxBD_vGafOPw8UtAeeCwTqNuhIbG4ToFek\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">No exceptions and geo-replicator working normally.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Encountered an exception and was unable to normal work.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">These two questions are similar: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1910614976\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/21241\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/21241/hovercard\" href=\"https://github.com/apache/pulsar/issues/21241\">#21241</a></p>\n<p dir=\"auto\">In AbstractReplicator class, a possible solution is to replace Schema.AUTO_PRODUCE_BYTES() with Schema.BYTES?</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21242",
                "createdAt": "2023-09-25T05:28:23Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][test]Support test metadatastore of etcd with url and not testcontainers",
        "url": "https://github.com/apache/pulsar/pull/21251",
        "resourcePath": "/apache/pulsar/pull/21251",
        "createdAt": "2023-09-26T05:35:12Z",
        "number": 21251,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/pulsar/metadata/BaseMetadataStoreTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/pulsar/metadata/impl/EtcdMetadataStoreTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5bMFOf2gAoNjE0ZWVkMTMyMDZhOWEzZjJhMjBmNWViZGNjNzk4NGM1MjZkZjQyNQ",
                "url": "https://github.com/apache/pulsar/pull/21251/commits/614eed13206a9a3f2a20f5ebdcc7984c526df425"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21252,
                "url": "https://github.com/apache/pulsar/issues/21252",
                "title": "Metadatastore etcd support test with url and not testcontainers",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Test metadata store etcd with url and not testcontainers.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21252",
                "createdAt": "2023-09-26T05:37:02Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Use byte schema for DLQ topic to avoid client side schema validation",
        "url": "https://github.com/apache/pulsar/pull/21294",
        "resourcePath": "/apache/pulsar/pull/21294",
        "createdAt": "2023-10-02T12:30:17Z",
        "number": 21294,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5bqwZr2gAoYTVkNmE3MDQ4MmIwMjIzM2I1ZmQ0MDFjODllZTM1MTJlM2NlNjBiMA",
                "url": "https://github.com/apache/pulsar/pull/21294/commits/a5d6a70482b02233b5fd401c89ee3512e3ce60b0"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20635,
                "url": "https://github.com/apache/pulsar/issues/20635",
                "title": "[Bug] pulsar keep creating dead letter queue producer and exceed the maximum limit",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.11</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Use pulsar java client library to create a consumer with dlq prodcer.</p>\n<ol dir=\"auto\">\n<li>after application starts, stop bookie</li>\n<li>produce some message to the queue and trigger the consumer</li>\n<li>check the log.<br>\nIt seems keep creating dead letter queue producer, and eventually hit the maximum limit</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">extra producer should not be created if there is an issue on pulsar</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">created over 10000 producers and eventually exceed the limits</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">see logs</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"--\nStarting Pulsar producer perf with config: {&quot;topicName&quot;:&quot;persistent://public/default/my-topic&quot;,&quot;producerName&quot;:null,&quot;sendTimeoutMs&quot;:30000,&quot;blockIfQueueFull&quot;:false,&quot;maxPendingMessages&quot;:0,&quot;maxPendingMessagesAcrossPartitions&quot;:0,&quot;messageRoutingMode&quot;:&quot;RoundRobinPartition&quot;,&quot;hashingScheme&quot;:&quot;JavaStringHash&quot;,&quot;cryptoFailureAction&quot;:&quot;FAIL&quot;,&quot;batchingMaxPublishDelayMicros&quot;:1000,&quot;batchingPartitionSwitchFrequencyByPublishDelay&quot;:10,&quot;batchingMaxMessages&quot;:1000,&quot;batchingMaxBytes&quot;:131072,&quot;batchingEnabled&quot;:true,&quot;chunkingEnabled&quot;:false,&quot;chunkMaxMessageSize&quot;:-1,&quot;compressionType&quot;:&quot;NONE&quot;,&quot;initialSequenceId&quot;:null,&quot;autoUpdatePartitions&quot;:true,&quot;autoUpdatePartitionsIntervalSeconds&quot;:60,&quot;multiSchema&quot;:true,&quot;accessMode&quot;:&quot;Shared&quot;,&quot;lazyStartPartitionedProducers&quot;:false,&quot;properties&quot;:{},&quot;initialSubscriptionName&quot;:null}\n--\nPulsar client config: {&quot;serviceUrl&quot;:&quot;pulsar://pulsar:6650&quot;,&quot;authPluginClassName&quot;:null,&quot;authParams&quot;:null,&quot;authParamMap&quot;:null,&quot;operationTimeoutMs&quot;:30000,&quot;lookupTimeoutMs&quot;:30000,&quot;statsIntervalSeconds&quot;:60,&quot;numIoThreads&quot;:1,&quot;numListenerThreads&quot;:1,&quot;connectionsPerBroker&quot;:1,&quot;connectionMaxIdleSeconds&quot;:180,&quot;useTcpNoDelay&quot;:true,&quot;useTls&quot;:false,&quot;tlsKeyFilePath&quot;:null,&quot;tlsCertificateFilePath&quot;:null,&quot;tlsTrustCertsFilePath&quot;:null,&quot;tlsAllowInsecureConnection&quot;:false,&quot;tlsHostnameVerificationEnable&quot;:false,&quot;concurrentLookupRequest&quot;:5000,&quot;maxLookupRequest&quot;:50000,&quot;maxLookupRedirects&quot;:20,&quot;maxNumberOfRejectedRequestPerConnection&quot;:50,&quot;keepAliveIntervalSeconds&quot;:30,&quot;connectionTimeoutMs&quot;:10000,&quot;requestTimeoutMs&quot;:60000,&quot;initialBackoffIntervalNanos&quot;:100000000,&quot;maxBackoffIntervalNanos&quot;:60000000000,&quot;enableBusyWait&quot;:false,&quot;listenerName&quot;:null,&quot;useKeyStoreTls&quot;:false,&quot;sslProvider&quot;:null,&quot;tlsKeyStoreType&quot;:&quot;JKS&quot;,&quot;tlsKeyStorePath&quot;:null,&quot;tlsKeyStorePassword&quot;:null,&quot;tlsTrustStoreType&quot;:&quot;JKS&quot;,&quot;tlsTrustStorePath&quot;:null,&quot;tlsTrustStorePassword&quot;:null,&quot;tlsCiphers&quot;:[],&quot;tlsProtocols&quot;:[],&quot;memoryLimitBytes&quot;:67108864,&quot;proxyServiceUrl&quot;:null,&quot;proxyProtocol&quot;:null,&quot;enableTransaction&quot;:true,&quot;dnsLookupBindAddress&quot;:null,&quot;dnsLookupBindPort&quot;:0,&quot;socks5ProxyAddress&quot;:null,&quot;socks5ProxyUsername&quot;:null,&quot;socks5ProxyPassword&quot;:null}\n[persistent://public/default/dlq] [null] Creating producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/dlq] [pulsar-dev-5-10032] Created producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/my-topic] failed to get schema : org.apache.pulsar.client.api.PulsarClientException: {&quot;errorMsg&quot;:&quot;org.apache.pulsar.broker.service.schema.exceptions.SchemaException: Bookie handle is not available - ledger=35399 - operation=Failed to read entry - entry=0&quot;,&quot;reqId&quot;:4059106653410978868, &quot;remote&quot;:&quot;pulsar/10.204.70.7:6650&quot;, &quot;local&quot;:&quot;/10.204.68.122:44372&quot;}\nDead letter producer exception with topic: persistent://public/default/dlq\nStarting Pulsar producer perf with config: {&quot;topicName&quot;:&quot;persistent://public/default/dlq&quot;,&quot;producerName&quot;:null,&quot;sendTimeoutMs&quot;:30000,&quot;blockIfQueueFull&quot;:false,&quot;maxPendingMessages&quot;:0,&quot;maxPendingMessagesAcrossPartitions&quot;:0,&quot;messageRoutingMode&quot;:&quot;RoundRobinPartition&quot;,&quot;hashingScheme&quot;:&quot;JavaStringHash&quot;,&quot;cryptoFailureAction&quot;:&quot;FAIL&quot;,&quot;batchingMaxPublishDelayMicros&quot;:1000,&quot;batchingPartitionSwitchFrequencyByPublishDelay&quot;:10,&quot;batchingMaxMessages&quot;:1000,&quot;batchingMaxBytes&quot;:131072,&quot;batchingEnabled&quot;:true,&quot;chunkingEnabled&quot;:false,&quot;chunkMaxMessageSize&quot;:-1,&quot;compressionType&quot;:&quot;NONE&quot;,&quot;initialSequenceId&quot;:null,&quot;autoUpdatePartitions&quot;:true,&quot;autoUpdatePartitionsIntervalSeconds&quot;:60,&quot;multiSchema&quot;:true,&quot;accessMode&quot;:&quot;Shared&quot;,&quot;lazyStartPartitionedProducers&quot;:false,&quot;properties&quot;:{},&quot;initialSubscriptionName&quot;:null}\nPulsar client config: {&quot;serviceUrl&quot;:&quot;pulsar://pulsar:6650&quot;,&quot;authPluginClassName&quot;:null,&quot;authParams&quot;:null,&quot;authParamMap&quot;:null,&quot;operationTimeoutMs&quot;:30000,&quot;lookupTimeoutMs&quot;:30000,&quot;statsIntervalSeconds&quot;:60,&quot;numIoThreads&quot;:1,&quot;numListenerThreads&quot;:1,&quot;connectionsPerBroker&quot;:1,&quot;connectionMaxIdleSeconds&quot;:180,&quot;useTcpNoDelay&quot;:true,&quot;useTls&quot;:false,&quot;tlsKeyFilePath&quot;:null,&quot;tlsCertificateFilePath&quot;:null,&quot;tlsTrustCertsFilePath&quot;:null,&quot;tlsAllowInsecureConnection&quot;:false,&quot;tlsHostnameVerificationEnable&quot;:false,&quot;concurrentLookupRequest&quot;:5000,&quot;maxLookupRequest&quot;:50000,&quot;maxLookupRedirects&quot;:20,&quot;maxNumberOfRejectedRequestPerConnection&quot;:50,&quot;keepAliveIntervalSeconds&quot;:30,&quot;connectionTimeoutMs&quot;:10000,&quot;requestTimeoutMs&quot;:60000,&quot;initialBackoffIntervalNanos&quot;:100000000,&quot;maxBackoffIntervalNanos&quot;:60000000000,&quot;enableBusyWait&quot;:false,&quot;listenerName&quot;:null,&quot;useKeyStoreTls&quot;:false,&quot;sslProvider&quot;:null,&quot;tlsKeyStoreType&quot;:&quot;JKS&quot;,&quot;tlsKeyStorePath&quot;:null,&quot;tlsKeyStorePassword&quot;:null,&quot;tlsTrustStoreType&quot;:&quot;JKS&quot;,&quot;tlsTrustStorePath&quot;:null,&quot;tlsTrustStorePassword&quot;:null,&quot;tlsCiphers&quot;:[],&quot;tlsProtocols&quot;:[],&quot;memoryLimitBytes&quot;:67108864,&quot;proxyServiceUrl&quot;:null,&quot;proxyProtocol&quot;:null,&quot;enableTransaction&quot;:true,&quot;dnsLookupBindAddress&quot;:null,&quot;dnsLookupBindPort&quot;:0,&quot;socks5ProxyAddress&quot;:null,&quot;socks5ProxyUsername&quot;:null,&quot;socks5ProxyPassword&quot;:null}\n[persistent://public/default/dlq] [null] Creating producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/dlq] [pulsar-dev-5-10033] Created producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/my-topic] failed to get schema : org.apache.pulsar.client.api.PulsarClientException: {&quot;errorMsg&quot;:&quot;org.apache.pulsar.broker.service.schema.exceptions.SchemaException: Bookie handle is not available - ledger=35399 - operation=Failed to read entry - entry=0&quot;,&quot;reqId&quot;:4059106653410978872, &quot;remote&quot;:&quot;pulsar/10.204.70.7:6650&quot;, &quot;local&quot;:&quot;/10.204.68.122:44372&quot;}\nDead letter producer exception with topic: persistent://public/default/dlq\nStarting Pulsar producer perf with config: {&quot;topicName&quot;:&quot;persistent://public/default/dlq&quot;,&quot;producerName&quot;:null,&quot;sendTimeoutMs&quot;:30000,&quot;blockIfQueueFull&quot;:false,&quot;maxPendingMessages&quot;:0,&quot;maxPendingMessagesAcrossPartitions&quot;:0,&quot;messageRoutingMode&quot;:&quot;RoundRobinPartition&quot;,&quot;hashingScheme&quot;:&quot;JavaStringHash&quot;,&quot;cryptoFailureAction&quot;:&quot;FAIL&quot;,&quot;batchingMaxPublishDelayMicros&quot;:1000,&quot;batchingPartitionSwitchFrequencyByPublishDelay&quot;:10,&quot;batchingMaxMessages&quot;:1000,&quot;batchingMaxBytes&quot;:131072,&quot;batchingEnabled&quot;:true,&quot;chunkingEnabled&quot;:false,&quot;chunkMaxMessageSize&quot;:-1,&quot;compressionType&quot;:&quot;NONE&quot;,&quot;initialSequenceId&quot;:null,&quot;autoUpdatePartitions&quot;:true,&quot;autoUpdatePartitionsIntervalSeconds&quot;:60,&quot;multiSchema&quot;:true,&quot;accessMode&quot;:&quot;Shared&quot;,&quot;lazyStartPartitionedProducers&quot;:false,&quot;properties&quot;:{},&quot;initialSubscriptionName&quot;:null}\nPulsar client config: {&quot;serviceUrl&quot;:&quot;pulsar://pulsar:6650&quot;,&quot;authPluginClassName&quot;:null,&quot;authParams&quot;:null,&quot;authParamMap&quot;:null,&quot;operationTimeoutMs&quot;:30000,&quot;lookupTimeoutMs&quot;:30000,&quot;statsIntervalSeconds&quot;:60,&quot;numIoThreads&quot;:1,&quot;numListenerThreads&quot;:1,&quot;connectionsPerBroker&quot;:1,&quot;connectionMaxIdleSeconds&quot;:180,&quot;useTcpNoDelay&quot;:true,&quot;useTls&quot;:false,&quot;tlsKeyFilePath&quot;:null,&quot;tlsCertificateFilePath&quot;:null,&quot;tlsTrustCertsFilePath&quot;:null,&quot;tlsAllowInsecureConnection&quot;:false,&quot;tlsHostnameVerificationEnable&quot;:false,&quot;concurrentLookupRequest&quot;:5000,&quot;maxLookupRequest&quot;:50000,&quot;maxLookupRedirects&quot;:20,&quot;maxNumberOfRejectedRequestPerConnection&quot;:50,&quot;keepAliveIntervalSeconds&quot;:30,&quot;connectionTimeoutMs&quot;:10000,&quot;requestTimeoutMs&quot;:60000,&quot;initialBackoffIntervalNanos&quot;:100000000,&quot;maxBackoffIntervalNanos&quot;:60000000000,&quot;enableBusyWait&quot;:false,&quot;listenerName&quot;:null,&quot;useKeyStoreTls&quot;:false,&quot;sslProvider&quot;:null,&quot;tlsKeyStoreType&quot;:&quot;JKS&quot;,&quot;tlsKeyStorePath&quot;:null,&quot;tlsKeyStorePassword&quot;:null,&quot;tlsTrustStoreType&quot;:&quot;JKS&quot;,&quot;tlsTrustStorePath&quot;:null,&quot;tlsTrustStorePassword&quot;:null,&quot;tlsCiphers&quot;:[],&quot;tlsProtocols&quot;:[],&quot;memoryLimitBytes&quot;:67108864,&quot;proxyServiceUrl&quot;:null,&quot;proxyProtocol&quot;:null,&quot;enableTransaction&quot;:true,&quot;dnsLookupBindAddress&quot;:null,&quot;dnsLookupBindPort&quot;:0,&quot;socks5ProxyAddress&quot;:null,&quot;socks5ProxyUsername&quot;:null,&quot;socks5ProxyPassword&quot;:null}\n[persistent://public/default/dlq] [null] Creating producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/dlq] [pulsar-dev-5-10034] Created producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/my-topic] failed to get schema : org.apache.pulsar.client.api.PulsarClientException: {&quot;errorMsg&quot;:&quot;org.apache.pulsar.broker.service.schema.exceptions.SchemaException: Bookie handle is not available - ledger=35399 - operation=Failed to read entry - entry=0&quot;,&quot;reqId&quot;:4059106653410978876, &quot;remote&quot;:&quot;pulsar/10.204.70.7:6650&quot;, &quot;local&quot;:&quot;/10.204.68.122:44372&quot;}\nDead letter producer exception with topic: persistent://public/default/dlq\nStarting Pulsar producer perf with config: {&quot;topicName&quot;:&quot;persistent://public/default/dlq&quot;,&quot;producerName&quot;:null,&quot;sendTimeoutMs&quot;:30000,&quot;blockIfQueueFull&quot;:false,&quot;maxPendingMessages&quot;:0,&quot;maxPendingMessagesAcrossPartitions&quot;:0,&quot;messageRoutingMode&quot;:&quot;RoundRobinPartition&quot;,&quot;hashingScheme&quot;:&quot;JavaStringHash&quot;,&quot;cryptoFailureAction&quot;:&quot;FAIL&quot;,&quot;batchingMaxPublishDelayMicros&quot;:1000,&quot;batchingPartitionSwitchFrequencyByPublishDelay&quot;:10,&quot;batchingMaxMessages&quot;:1000,&quot;batchingMaxBytes&quot;:131072,&quot;batchingEnabled&quot;:true,&quot;chunkingEnabled&quot;:false,&quot;chunkMaxMessageSize&quot;:-1,&quot;compressionType&quot;:&quot;NONE&quot;,&quot;initialSequenceId&quot;:null,&quot;autoUpdatePartitions&quot;:true,&quot;autoUpdatePartitionsIntervalSeconds&quot;:60,&quot;multiSchema&quot;:true,&quot;accessMode&quot;:&quot;Shared&quot;,&quot;lazyStartPartitionedProducers&quot;:false,&quot;properties&quot;:{},&quot;initialSubscriptionName&quot;:null}\nPulsar client config: {&quot;serviceUrl&quot;:&quot;pulsar://pulsar:6650&quot;,&quot;authPluginClassName&quot;:null,&quot;authParams&quot;:null,&quot;authParamMap&quot;:null,&quot;operationTimeoutMs&quot;:30000,&quot;lookupTimeoutMs&quot;:30000,&quot;statsIntervalSeconds&quot;:60,&quot;numIoThreads&quot;:1,&quot;numListenerThreads&quot;:1,&quot;connectionsPerBroker&quot;:1,&quot;connectionMaxIdleSeconds&quot;:180,&quot;useTcpNoDelay&quot;:true,&quot;useTls&quot;:false,&quot;tlsKeyFilePath&quot;:null,&quot;tlsCertificateFilePath&quot;:null,&quot;tlsTrustCertsFilePath&quot;:null,&quot;tlsAllowInsecureConnection&quot;:false,&quot;tlsHostnameVerificationEnable&quot;:false,&quot;concurrentLookupRequest&quot;:5000,&quot;maxLookupRequest&quot;:50000,&quot;maxLookupRedirects&quot;:20,&quot;maxNumberOfRejectedRequestPerConnection&quot;:50,&quot;keepAliveIntervalSeconds&quot;:30,&quot;connectionTimeoutMs&quot;:10000,&quot;requestTimeoutMs&quot;:60000,&quot;initialBackoffIntervalNanos&quot;:100000000,&quot;maxBackoffIntervalNanos&quot;:60000000000,&quot;enableBusyWait&quot;:false,&quot;listenerName&quot;:null,&quot;useKeyStoreTls&quot;:false,&quot;sslProvider&quot;:null,&quot;tlsKeyStoreType&quot;:&quot;JKS&quot;,&quot;tlsKeyStorePath&quot;:null,&quot;tlsKeyStorePassword&quot;:null,&quot;tlsTrustStoreType&quot;:&quot;JKS&quot;,&quot;tlsTrustStorePath&quot;:null,&quot;tlsTrustStorePassword&quot;:null,&quot;tlsCiphers&quot;:[],&quot;tlsProtocols&quot;:[],&quot;memoryLimitBytes&quot;:67108864,&quot;proxyServiceUrl&quot;:null,&quot;proxyProtocol&quot;:null,&quot;enableTransaction&quot;:true,&quot;dnsLookupBindAddress&quot;:null,&quot;dnsLookupBindPort&quot;:0,&quot;socks5ProxyAddress&quot;:null,&quot;socks5ProxyUsername&quot;:null,&quot;socks5ProxyPassword&quot;:null}\n[persistent://public/default/dlq] [null] Creating producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/dlq] [pulsar-dev-5-10035] Created producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/my-topic] failed to get schema : org.apache.pulsar.client.api.PulsarClientException: {&quot;errorMsg&quot;:&quot;org.apache.pulsar.broker.service.schema.exceptions.SchemaException: Bookie handle is not available - ledger=35399 - operation=Failed to read entry - entry=0&quot;,&quot;reqId&quot;:4059106653410978880, &quot;remote&quot;:&quot;pulsar/10.204.70.7:6650&quot;, &quot;local&quot;:&quot;/10.204.68.122:44372&quot;}\nDead letter producer exception with topic: persistent://public/default/dlq\n\"><pre class=\"notranslate\"><code class=\"notranslate\">--\nStarting Pulsar producer perf with config: {\"topicName\":\"persistent://public/default/my-topic\",\"producerName\":null,\"sendTimeoutMs\":30000,\"blockIfQueueFull\":false,\"maxPendingMessages\":0,\"maxPendingMessagesAcrossPartitions\":0,\"messageRoutingMode\":\"RoundRobinPartition\",\"hashingScheme\":\"JavaStringHash\",\"cryptoFailureAction\":\"FAIL\",\"batchingMaxPublishDelayMicros\":1000,\"batchingPartitionSwitchFrequencyByPublishDelay\":10,\"batchingMaxMessages\":1000,\"batchingMaxBytes\":131072,\"batchingEnabled\":true,\"chunkingEnabled\":false,\"chunkMaxMessageSize\":-1,\"compressionType\":\"NONE\",\"initialSequenceId\":null,\"autoUpdatePartitions\":true,\"autoUpdatePartitionsIntervalSeconds\":60,\"multiSchema\":true,\"accessMode\":\"Shared\",\"lazyStartPartitionedProducers\":false,\"properties\":{},\"initialSubscriptionName\":null}\n--\nPulsar client config: {\"serviceUrl\":\"pulsar://pulsar:6650\",\"authPluginClassName\":null,\"authParams\":null,\"authParamMap\":null,\"operationTimeoutMs\":30000,\"lookupTimeoutMs\":30000,\"statsIntervalSeconds\":60,\"numIoThreads\":1,\"numListenerThreads\":1,\"connectionsPerBroker\":1,\"connectionMaxIdleSeconds\":180,\"useTcpNoDelay\":true,\"useTls\":false,\"tlsKeyFilePath\":null,\"tlsCertificateFilePath\":null,\"tlsTrustCertsFilePath\":null,\"tlsAllowInsecureConnection\":false,\"tlsHostnameVerificationEnable\":false,\"concurrentLookupRequest\":5000,\"maxLookupRequest\":50000,\"maxLookupRedirects\":20,\"maxNumberOfRejectedRequestPerConnection\":50,\"keepAliveIntervalSeconds\":30,\"connectionTimeoutMs\":10000,\"requestTimeoutMs\":60000,\"initialBackoffIntervalNanos\":100000000,\"maxBackoffIntervalNanos\":60000000000,\"enableBusyWait\":false,\"listenerName\":null,\"useKeyStoreTls\":false,\"sslProvider\":null,\"tlsKeyStoreType\":\"JKS\",\"tlsKeyStorePath\":null,\"tlsKeyStorePassword\":null,\"tlsTrustStoreType\":\"JKS\",\"tlsTrustStorePath\":null,\"tlsTrustStorePassword\":null,\"tlsCiphers\":[],\"tlsProtocols\":[],\"memoryLimitBytes\":67108864,\"proxyServiceUrl\":null,\"proxyProtocol\":null,\"enableTransaction\":true,\"dnsLookupBindAddress\":null,\"dnsLookupBindPort\":0,\"socks5ProxyAddress\":null,\"socks5ProxyUsername\":null,\"socks5ProxyPassword\":null}\n[persistent://public/default/dlq] [null] Creating producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/dlq] [pulsar-dev-5-10032] Created producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/my-topic] failed to get schema : org.apache.pulsar.client.api.PulsarClientException: {\"errorMsg\":\"org.apache.pulsar.broker.service.schema.exceptions.SchemaException: Bookie handle is not available - ledger=35399 - operation=Failed to read entry - entry=0\",\"reqId\":4059106653410978868, \"remote\":\"pulsar/10.204.70.7:6650\", \"local\":\"/10.204.68.122:44372\"}\nDead letter producer exception with topic: persistent://public/default/dlq\nStarting Pulsar producer perf with config: {\"topicName\":\"persistent://public/default/dlq\",\"producerName\":null,\"sendTimeoutMs\":30000,\"blockIfQueueFull\":false,\"maxPendingMessages\":0,\"maxPendingMessagesAcrossPartitions\":0,\"messageRoutingMode\":\"RoundRobinPartition\",\"hashingScheme\":\"JavaStringHash\",\"cryptoFailureAction\":\"FAIL\",\"batchingMaxPublishDelayMicros\":1000,\"batchingPartitionSwitchFrequencyByPublishDelay\":10,\"batchingMaxMessages\":1000,\"batchingMaxBytes\":131072,\"batchingEnabled\":true,\"chunkingEnabled\":false,\"chunkMaxMessageSize\":-1,\"compressionType\":\"NONE\",\"initialSequenceId\":null,\"autoUpdatePartitions\":true,\"autoUpdatePartitionsIntervalSeconds\":60,\"multiSchema\":true,\"accessMode\":\"Shared\",\"lazyStartPartitionedProducers\":false,\"properties\":{},\"initialSubscriptionName\":null}\nPulsar client config: {\"serviceUrl\":\"pulsar://pulsar:6650\",\"authPluginClassName\":null,\"authParams\":null,\"authParamMap\":null,\"operationTimeoutMs\":30000,\"lookupTimeoutMs\":30000,\"statsIntervalSeconds\":60,\"numIoThreads\":1,\"numListenerThreads\":1,\"connectionsPerBroker\":1,\"connectionMaxIdleSeconds\":180,\"useTcpNoDelay\":true,\"useTls\":false,\"tlsKeyFilePath\":null,\"tlsCertificateFilePath\":null,\"tlsTrustCertsFilePath\":null,\"tlsAllowInsecureConnection\":false,\"tlsHostnameVerificationEnable\":false,\"concurrentLookupRequest\":5000,\"maxLookupRequest\":50000,\"maxLookupRedirects\":20,\"maxNumberOfRejectedRequestPerConnection\":50,\"keepAliveIntervalSeconds\":30,\"connectionTimeoutMs\":10000,\"requestTimeoutMs\":60000,\"initialBackoffIntervalNanos\":100000000,\"maxBackoffIntervalNanos\":60000000000,\"enableBusyWait\":false,\"listenerName\":null,\"useKeyStoreTls\":false,\"sslProvider\":null,\"tlsKeyStoreType\":\"JKS\",\"tlsKeyStorePath\":null,\"tlsKeyStorePassword\":null,\"tlsTrustStoreType\":\"JKS\",\"tlsTrustStorePath\":null,\"tlsTrustStorePassword\":null,\"tlsCiphers\":[],\"tlsProtocols\":[],\"memoryLimitBytes\":67108864,\"proxyServiceUrl\":null,\"proxyProtocol\":null,\"enableTransaction\":true,\"dnsLookupBindAddress\":null,\"dnsLookupBindPort\":0,\"socks5ProxyAddress\":null,\"socks5ProxyUsername\":null,\"socks5ProxyPassword\":null}\n[persistent://public/default/dlq] [null] Creating producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/dlq] [pulsar-dev-5-10033] Created producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/my-topic] failed to get schema : org.apache.pulsar.client.api.PulsarClientException: {\"errorMsg\":\"org.apache.pulsar.broker.service.schema.exceptions.SchemaException: Bookie handle is not available - ledger=35399 - operation=Failed to read entry - entry=0\",\"reqId\":4059106653410978872, \"remote\":\"pulsar/10.204.70.7:6650\", \"local\":\"/10.204.68.122:44372\"}\nDead letter producer exception with topic: persistent://public/default/dlq\nStarting Pulsar producer perf with config: {\"topicName\":\"persistent://public/default/dlq\",\"producerName\":null,\"sendTimeoutMs\":30000,\"blockIfQueueFull\":false,\"maxPendingMessages\":0,\"maxPendingMessagesAcrossPartitions\":0,\"messageRoutingMode\":\"RoundRobinPartition\",\"hashingScheme\":\"JavaStringHash\",\"cryptoFailureAction\":\"FAIL\",\"batchingMaxPublishDelayMicros\":1000,\"batchingPartitionSwitchFrequencyByPublishDelay\":10,\"batchingMaxMessages\":1000,\"batchingMaxBytes\":131072,\"batchingEnabled\":true,\"chunkingEnabled\":false,\"chunkMaxMessageSize\":-1,\"compressionType\":\"NONE\",\"initialSequenceId\":null,\"autoUpdatePartitions\":true,\"autoUpdatePartitionsIntervalSeconds\":60,\"multiSchema\":true,\"accessMode\":\"Shared\",\"lazyStartPartitionedProducers\":false,\"properties\":{},\"initialSubscriptionName\":null}\nPulsar client config: {\"serviceUrl\":\"pulsar://pulsar:6650\",\"authPluginClassName\":null,\"authParams\":null,\"authParamMap\":null,\"operationTimeoutMs\":30000,\"lookupTimeoutMs\":30000,\"statsIntervalSeconds\":60,\"numIoThreads\":1,\"numListenerThreads\":1,\"connectionsPerBroker\":1,\"connectionMaxIdleSeconds\":180,\"useTcpNoDelay\":true,\"useTls\":false,\"tlsKeyFilePath\":null,\"tlsCertificateFilePath\":null,\"tlsTrustCertsFilePath\":null,\"tlsAllowInsecureConnection\":false,\"tlsHostnameVerificationEnable\":false,\"concurrentLookupRequest\":5000,\"maxLookupRequest\":50000,\"maxLookupRedirects\":20,\"maxNumberOfRejectedRequestPerConnection\":50,\"keepAliveIntervalSeconds\":30,\"connectionTimeoutMs\":10000,\"requestTimeoutMs\":60000,\"initialBackoffIntervalNanos\":100000000,\"maxBackoffIntervalNanos\":60000000000,\"enableBusyWait\":false,\"listenerName\":null,\"useKeyStoreTls\":false,\"sslProvider\":null,\"tlsKeyStoreType\":\"JKS\",\"tlsKeyStorePath\":null,\"tlsKeyStorePassword\":null,\"tlsTrustStoreType\":\"JKS\",\"tlsTrustStorePath\":null,\"tlsTrustStorePassword\":null,\"tlsCiphers\":[],\"tlsProtocols\":[],\"memoryLimitBytes\":67108864,\"proxyServiceUrl\":null,\"proxyProtocol\":null,\"enableTransaction\":true,\"dnsLookupBindAddress\":null,\"dnsLookupBindPort\":0,\"socks5ProxyAddress\":null,\"socks5ProxyUsername\":null,\"socks5ProxyPassword\":null}\n[persistent://public/default/dlq] [null] Creating producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/dlq] [pulsar-dev-5-10034] Created producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/my-topic] failed to get schema : org.apache.pulsar.client.api.PulsarClientException: {\"errorMsg\":\"org.apache.pulsar.broker.service.schema.exceptions.SchemaException: Bookie handle is not available - ledger=35399 - operation=Failed to read entry - entry=0\",\"reqId\":4059106653410978876, \"remote\":\"pulsar/10.204.70.7:6650\", \"local\":\"/10.204.68.122:44372\"}\nDead letter producer exception with topic: persistent://public/default/dlq\nStarting Pulsar producer perf with config: {\"topicName\":\"persistent://public/default/dlq\",\"producerName\":null,\"sendTimeoutMs\":30000,\"blockIfQueueFull\":false,\"maxPendingMessages\":0,\"maxPendingMessagesAcrossPartitions\":0,\"messageRoutingMode\":\"RoundRobinPartition\",\"hashingScheme\":\"JavaStringHash\",\"cryptoFailureAction\":\"FAIL\",\"batchingMaxPublishDelayMicros\":1000,\"batchingPartitionSwitchFrequencyByPublishDelay\":10,\"batchingMaxMessages\":1000,\"batchingMaxBytes\":131072,\"batchingEnabled\":true,\"chunkingEnabled\":false,\"chunkMaxMessageSize\":-1,\"compressionType\":\"NONE\",\"initialSequenceId\":null,\"autoUpdatePartitions\":true,\"autoUpdatePartitionsIntervalSeconds\":60,\"multiSchema\":true,\"accessMode\":\"Shared\",\"lazyStartPartitionedProducers\":false,\"properties\":{},\"initialSubscriptionName\":null}\nPulsar client config: {\"serviceUrl\":\"pulsar://pulsar:6650\",\"authPluginClassName\":null,\"authParams\":null,\"authParamMap\":null,\"operationTimeoutMs\":30000,\"lookupTimeoutMs\":30000,\"statsIntervalSeconds\":60,\"numIoThreads\":1,\"numListenerThreads\":1,\"connectionsPerBroker\":1,\"connectionMaxIdleSeconds\":180,\"useTcpNoDelay\":true,\"useTls\":false,\"tlsKeyFilePath\":null,\"tlsCertificateFilePath\":null,\"tlsTrustCertsFilePath\":null,\"tlsAllowInsecureConnection\":false,\"tlsHostnameVerificationEnable\":false,\"concurrentLookupRequest\":5000,\"maxLookupRequest\":50000,\"maxLookupRedirects\":20,\"maxNumberOfRejectedRequestPerConnection\":50,\"keepAliveIntervalSeconds\":30,\"connectionTimeoutMs\":10000,\"requestTimeoutMs\":60000,\"initialBackoffIntervalNanos\":100000000,\"maxBackoffIntervalNanos\":60000000000,\"enableBusyWait\":false,\"listenerName\":null,\"useKeyStoreTls\":false,\"sslProvider\":null,\"tlsKeyStoreType\":\"JKS\",\"tlsKeyStorePath\":null,\"tlsKeyStorePassword\":null,\"tlsTrustStoreType\":\"JKS\",\"tlsTrustStorePath\":null,\"tlsTrustStorePassword\":null,\"tlsCiphers\":[],\"tlsProtocols\":[],\"memoryLimitBytes\":67108864,\"proxyServiceUrl\":null,\"proxyProtocol\":null,\"enableTransaction\":true,\"dnsLookupBindAddress\":null,\"dnsLookupBindPort\":0,\"socks5ProxyAddress\":null,\"socks5ProxyUsername\":null,\"socks5ProxyPassword\":null}\n[persistent://public/default/dlq] [null] Creating producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/dlq] [pulsar-dev-5-10035] Created producer on cnx [id: 0x910a07bb, L:/10.204.68.122:45104 - R:pulsar/10.204.67.17:6650]\n[persistent://public/default/my-topic] failed to get schema : org.apache.pulsar.client.api.PulsarClientException: {\"errorMsg\":\"org.apache.pulsar.broker.service.schema.exceptions.SchemaException: Bookie handle is not available - ledger=35399 - operation=Failed to read entry - entry=0\",\"reqId\":4059106653410978880, \"remote\":\"pulsar/10.204.70.7:6650\", \"local\":\"/10.204.68.122:44372\"}\nDead letter producer exception with topic: persistent://public/default/dlq\n\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20635",
                "createdAt": "2023-06-23T15:48:25Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][ml] Fix thread safe issue with RangeCache.put and RangeCache.clear",
        "url": "https://github.com/apache/pulsar/pull/21302",
        "resourcePath": "/apache/pulsar/pull/21302",
        "createdAt": "2023-10-05T18:45:36Z",
        "number": 21302,
        "mergeCommit": {
          "oid": "70d086f8f35d36800059d0d68e13d0ca017bf233",
          "message": "[fix][ml] Fix thread safe issue with RangeCache.put and RangeCache.clear (#21302)",
          "commitUrl": "https://github.com/apache/pulsar/commit/70d086f8f35d36800059d0d68e13d0ca017bf233",
          "parents": {
            "nodes": [
              {
                "oid": "643428bb295ee4781e86aa2c72e5ad5d61b98870",
                "message": "[fix][sec] Upgrade snappy-java to 1.1.10.5 (#21280)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/util/RangeCache.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5cCmk12gAoMGRiMDQ2NDk0NWY2M2FhMmQxYjk4MWJhYTg0Nzc1ZWI0MDYyNTNjMg",
                "url": "https://github.com/apache/pulsar/pull/21302/commits/0db0464945f63aa2d1b981baa84775eb406253c2"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 10433,
                "url": "https://github.com/apache/pulsar/issues/10433",
                "title": "NPE in broker: EntryImpl.getLength()",
                "bodyHTML": "<p dir=\"auto\">During a CHO test, one broker crashed with a NPE. We lost the logs due to a cleanup of files, but we have the general stack trace:<br>\nmanaged-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/EntryImpl.java: 132: return data.readableBytes();<br>\nmanaged-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/EntryCacheImpl.java: 115: manager.entryAdded(entry.getLength());</p>",
                "resourcePath": "/apache/pulsar/issues/10433",
                "createdAt": "2021-04-29T03:41:28Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "lifecycle/stale"
                      }
                    }
                  ]
                }
              }
            },
            {
              "node": {
                "number": 21301,
                "url": "https://github.com/apache/pulsar/issues/21301",
                "title": "[Bug] Incorrect usage of ConcurrentSkipListMap#computeIfAbsent",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">ConcurrentSkipListMap#computeIfAbsent does not guarantee only calling the supplier atomically when the value is not present. The following usage appears to be side effecting code that will likely break due to misuse of this method:</p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/82237d3684fe506bcb6426b3b23f413422e6e4fb/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/util/RangeCache.java#L78-L82\">pulsar/managed-ledger/src/main/java/org/apache/bookkeeper/mledger/util/RangeCache.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 78 to 82\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/82237d3684fe506bcb6426b3b23f413422e6e4fb\">82237d3</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L78\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"78\"></td>\n          <td id=\"LC78\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">entries</span>.<span class=\"pl-en\">computeIfAbsent</span>(<span class=\"pl-s1\">key</span>, (<span class=\"pl-s1\">k</span>) -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L79\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"79\"></td>\n          <td id=\"LC79\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">size</span>.<span class=\"pl-en\">addAndGet</span>(<span class=\"pl-s1\">weighter</span>.<span class=\"pl-en\">getSize</span>(<span class=\"pl-s1\">value</span>)); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L80\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"80\"></td>\n          <td id=\"LC80\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">flag</span>.<span class=\"pl-en\">setValue</span>(<span class=\"pl-c1\">true</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L81\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"81\"></td>\n          <td id=\"LC81\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-s1\">value</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L82\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"82\"></td>\n          <td id=\"LC82\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> }); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">We need to make sure that we only increment those atomic counters once.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">There is a chance we'll increment the counters in certain race conditions.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">Relevant context can be found here: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1926773338\" data-permission-text=\"Title is private\" data-url=\"https://github.com/datastax/cassandra/issues/789\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/datastax/cassandra/pull/789/hovercard?comment_id=1346445456&amp;comment_type=review_comment\" href=\"https://github.com/datastax/cassandra/pull/789#discussion_r1346445456\">datastax/cassandra#789 (comment)</a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21301",
                "createdAt": "2023-10-05T13:54:27Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [metadata] Fix zookeeper related flacky test",
        "url": "https://github.com/apache/pulsar/pull/21310",
        "resourcePath": "/apache/pulsar/pull/21310",
        "createdAt": "2023-10-07T03:58:32Z",
        "number": 21310,
        "mergeCommit": {
          "oid": "9ab7417edc20b6618bac8f66921815c7b9d5e5b8",
          "message": "[fix] [metadata] Fix zookeeper related flacky test (#21310)\n\nFix zookeeper related flacky test",
          "commitUrl": "https://github.com/apache/pulsar/commit/9ab7417edc20b6618bac8f66921815c7b9d5e5b8",
          "parents": {
            "nodes": [
              {
                "oid": "4ee5cd78147890ce3c23092edbfc11370972728e",
                "message": "[fix] [ml] Reader can set read-pos to a deleted ledger (#21248)\n\n### Motivation\r\n\r\nAfter trimming ledgers, the variable `lastConfirmedEntry` of the managed ledger might rely on a deleted ledger(the latest ledger which contains data).\r\n\r\nThere is a bug that makes pulsar allow users to set the start read position to an unexisting ledger or a deleted ledger when creating a subscription. This makes the `backlog` and `markDeletedPosition` wrong. \r\n\r\n### Modifications\r\n\r\nFix the bug."
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/bookkeeper/replication/AuthAutoRecoveryTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/bookkeeper/replication/AutoRecoveryMainTest.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-metadata/src/test/java/org/apache/bookkeeper/replication/BookKeeperClusterTestCase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/bookkeeper/replication/BookieAutoRecoveryTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/bookkeeper/replication/BookieLedgerIndexTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/bookkeeper/replication/TestAutoRecoveryAlongWithBookieServers.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/bookkeeper/replication/TestReplicationWorker.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-metadata/src/test/java/org/apache/bookkeeper/replication/ZooKeeperUtil.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-package-management/bookkeeper-storage/src/test/java/org/apache/pulsar/packages/management/storage/bookkeeper/bookkeeper/test/BookKeeperClusterTestCase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "testmocks/src/main/java/org/apache/bookkeeper/client/BookKeeperTestClient.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5cKYL62gAoZjBlM2E2OTUzMmUwNTkzMGY4NWM5YTI5NDdiOTY0NzcxYjg0ZjUxOA",
                "url": "https://github.com/apache/pulsar/pull/21310/commits/f0e3a69532e05930f85c9a2947b964771b84f518"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21286,
                "url": "https://github.com/apache/pulsar/issues/21286",
                "title": "Flaky-test: TestReplicationWorker.setUp / BookKeeperClusterTestCase.setUp / BookieResources.createMetadataDriver / AuditorBookieTest.setUp",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failures</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6354520087/job/17261402005#step:10:1985\">2023-09-29T17:04:18.4709789Z</a></li>\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6354520087/job/17267761930#step:9:1918\">2023-09-29T21:13:00.4526019Z</a></li>\n</ul>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"org.apache.bookkeeper.bookie.BookieException$MetadataStoreException: Failed to initialize metadata bookie driver\n\tat org.apache.bookkeeper.bookie.BookieResources.createMetadataDriver(BookieResources.java:61)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase$ServerTester.&lt;init&gt;(BookKeeperClusterTestCase.java:848)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.startBookie(BookKeeperClusterTestCase.java:673)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.startAndAddBookie(BookKeeperClusterTestCase.java:653)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.startNewBookieAndReturnAddress(BookKeeperClusterTestCase.java:642)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.startNewBookie(BookKeeperClusterTestCase.java:635)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.startBKCluster(BookKeeperClusterTestCase.java:263)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.setUp(BookKeeperClusterTestCase.java:177)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.setUp(BookKeeperClusterTestCase.java:162)\n\tat org.apache.bookkeeper.replication.TestReplicationWorker.setUp(TestReplicationWorker.java:143)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n\tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n\tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:590)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n\tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n\tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n\tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n\tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n\tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n\tat org.testng.TestRunner.run(TestRunner.java:602)\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n\tat org.testng.TestNG.runSuites(TestNG.java:1099)\n\tat org.testng.TestNG.run(TestNG.java:1067)\n\tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n\tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n\tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n\tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n\tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n\tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\nCaused by: org.apache.bookkeeper.meta.exceptions.MetadataException: Failed to create zookeeper client to localhost:43833\n\tat org.apache.bookkeeper.meta.zk.ZKMetadataDriverBase.initialize(ZKMetadataDriverBase.java:235)\n\tat org.apache.bookkeeper.meta.zk.ZKMetadataBookieDriver.initialize(ZKMetadataBookieDriver.java:55)\n\tat org.apache.bookkeeper.bookie.BookieResources.createMetadataDriver(BookieResources.java:58)\n\t... 47 more\nCaused by: org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss\n\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:102)\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperWatcherBase.waitForConnection(ZooKeeperWatcherBase.java:159)\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperClient$Builder.build(ZooKeeperClient.java:260)\n\tat org.apache.bookkeeper.meta.zk.ZKMetadataDriverBase.initialize(ZKMetadataDriverBase.java:215)\n\t... 49 more\n\"><pre class=\"notranslate\"><code class=\"notranslate\">org.apache.bookkeeper.bookie.BookieException$MetadataStoreException: Failed to initialize metadata bookie driver\n\tat org.apache.bookkeeper.bookie.BookieResources.createMetadataDriver(BookieResources.java:61)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase$ServerTester.&lt;init&gt;(BookKeeperClusterTestCase.java:848)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.startBookie(BookKeeperClusterTestCase.java:673)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.startAndAddBookie(BookKeeperClusterTestCase.java:653)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.startNewBookieAndReturnAddress(BookKeeperClusterTestCase.java:642)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.startNewBookie(BookKeeperClusterTestCase.java:635)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.startBKCluster(BookKeeperClusterTestCase.java:263)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.setUp(BookKeeperClusterTestCase.java:177)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.setUp(BookKeeperClusterTestCase.java:162)\n\tat org.apache.bookkeeper.replication.TestReplicationWorker.setUp(TestReplicationWorker.java:143)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n\tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n\tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:590)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n\tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n\tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n\tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n\tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n\tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n\tat org.testng.TestRunner.run(TestRunner.java:602)\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n\tat org.testng.TestNG.runSuites(TestNG.java:1099)\n\tat org.testng.TestNG.run(TestNG.java:1067)\n\tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n\tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n\tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n\tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n\tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n\tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\nCaused by: org.apache.bookkeeper.meta.exceptions.MetadataException: Failed to create zookeeper client to localhost:43833\n\tat org.apache.bookkeeper.meta.zk.ZKMetadataDriverBase.initialize(ZKMetadataDriverBase.java:235)\n\tat org.apache.bookkeeper.meta.zk.ZKMetadataBookieDriver.initialize(ZKMetadataBookieDriver.java:55)\n\tat org.apache.bookkeeper.bookie.BookieResources.createMetadataDriver(BookieResources.java:58)\n\t... 47 more\nCaused by: org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss\n\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:102)\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperWatcherBase.waitForConnection(ZooKeeperWatcherBase.java:159)\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperClient$Builder.build(ZooKeeperClient.java:260)\n\tat org.apache.bookkeeper.meta.zk.ZKMetadataDriverBase.initialize(ZKMetadataDriverBase.java:215)\n\t... 49 more\n\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.io.IOException: Failed to initialize metadata client driver\n\tat org.apache.bookkeeper.client.BookKeeper.&lt;init&gt;(BookKeeper.java:460)\n\tat org.apache.bookkeeper.client.BookKeeperTestClient.&lt;init&gt;(BookKeeperTestClient.java:48)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.startBKCluster(BookKeeperClusterTestCase.java:258)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.setUp(BookKeeperClusterTestCase.java:177)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.setUp(BookKeeperClusterTestCase.java:162)\n\tat org.apache.bookkeeper.replication.AuditorBookieTest.setUp(AuditorBookieTest.java:67)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n\tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n\tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:590)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n\tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n\tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n\tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n\tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n\tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n\tat org.testng.TestRunner.run(TestRunner.java:602)\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n\tat org.testng.TestNG.runSuites(TestNG.java:1099)\n\tat org.testng.TestNG.run(TestNG.java:1067)\n\tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n\tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n\tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n\tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n\tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n\tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\nCaused by: org.apache.bookkeeper.meta.exceptions.MetadataException: Failed to create zookeeper client to localhost:38465\n\tat org.apache.bookkeeper.meta.zk.ZKMetadataDriverBase.initialize(ZKMetadataDriverBase.java:235)\n\tat org.apache.bookkeeper.meta.zk.ZKMetadataClientDriver.initialize(ZKMetadataClientDriver.java:61)\n\tat org.apache.bookkeeper.client.BookKeeper.&lt;init&gt;(BookKeeper.java:450)\n\t... 43 more\nCaused by: org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss\n\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:102)\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperWatcherBase.waitForConnection(ZooKeeperWatcherBase.java:159)\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperClient$Builder.build(ZooKeeperClient.java:260)\n\tat org.apache.bookkeeper.meta.zk.ZKMetadataDriverBase.initialize(ZKMetadataDriverBase.java:215)\n\t... 45 more\n\"><pre class=\"notranslate\"><code class=\"notranslate\">java.io.IOException: Failed to initialize metadata client driver\n\tat org.apache.bookkeeper.client.BookKeeper.&lt;init&gt;(BookKeeper.java:460)\n\tat org.apache.bookkeeper.client.BookKeeperTestClient.&lt;init&gt;(BookKeeperTestClient.java:48)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.startBKCluster(BookKeeperClusterTestCase.java:258)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.setUp(BookKeeperClusterTestCase.java:177)\n\tat org.apache.bookkeeper.test.BookKeeperClusterTestCase.setUp(BookKeeperClusterTestCase.java:162)\n\tat org.apache.bookkeeper.replication.AuditorBookieTest.setUp(AuditorBookieTest.java:67)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n\tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n\tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:590)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n\tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n\tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n\tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n\tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n\tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n\tat org.testng.TestRunner.run(TestRunner.java:602)\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n\tat org.testng.TestNG.runSuites(TestNG.java:1099)\n\tat org.testng.TestNG.run(TestNG.java:1067)\n\tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n\tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n\tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n\tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n\tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n\tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\nCaused by: org.apache.bookkeeper.meta.exceptions.MetadataException: Failed to create zookeeper client to localhost:38465\n\tat org.apache.bookkeeper.meta.zk.ZKMetadataDriverBase.initialize(ZKMetadataDriverBase.java:235)\n\tat org.apache.bookkeeper.meta.zk.ZKMetadataClientDriver.initialize(ZKMetadataClientDriver.java:61)\n\tat org.apache.bookkeeper.client.BookKeeper.&lt;init&gt;(BookKeeper.java:450)\n\t... 43 more\nCaused by: org.apache.zookeeper.KeeperException$ConnectionLossException: KeeperErrorCode = ConnectionLoss\n\tat org.apache.zookeeper.KeeperException.create(KeeperException.java:102)\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperWatcherBase.waitForConnection(ZooKeeperWatcherBase.java:159)\n\tat org.apache.bookkeeper.zookeeper.ZooKeeperClient$Builder.build(ZooKeeperClient.java:260)\n\tat org.apache.bookkeeper.meta.zk.ZKMetadataDriverBase.initialize(ZKMetadataDriverBase.java:215)\n\t... 45 more\n\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21286",
                "createdAt": "2023-10-01T11:41:01Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [bk-client]  Fix bk client MinNumRacksPerWriteQuorum and EnforceMinNumRacksPerWriteQuorum not work problem. ",
        "url": "https://github.com/apache/pulsar/pull/21327",
        "resourcePath": "/apache/pulsar/pull/21327",
        "createdAt": "2023-10-09T05:23:28Z",
        "number": 21327,
        "mergeCommit": {
          "oid": "61a7adf08b14067500f9bd17b6da824ba58e9707",
          "message": "[fix] [bk-client]  Fix bk client MinNumRacksPerWriteQuorum and EnforceMinNumRacksPerWriteQuorum not work problem.  (#21327)",
          "commitUrl": "https://github.com/apache/pulsar/commit/61a7adf08b14067500f9bd17b6da824ba58e9707",
          "parents": {
            "nodes": [
              {
                "oid": "84204207c19cad0bf9986088af2bbd954b85288b",
                "message": "[fix][sec] Fix MultiRoles token provider when using anonymous clients (#21338)\n\nCo-authored-by: Lari Hotari <lhotari@apache.org>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/BookKeeperClientFactoryImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/BookKeeperClientFactoryImplTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5cOGJ62gAoN2VmOTRkZWYyOGI1NDQzNjdhMzk4OTdhODcwZWI4MTA1NTkxMDRhYg",
                "url": "https://github.com/apache/pulsar/pull/21327/commits/7ef94def28b544367a39897a870eb810559104ab"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21326,
                "url": "https://github.com/apache/pulsar/issues/21326",
                "title": "[Bug] Bk client MinNumRacksPerWriteQuorum and EnforceMinNumRacksPerWriteQuorum not work problem",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">The broker.conf content.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bookkeeperClientEnforceMinNumRacksPerWriteQuorum: &quot;true&quot;  \nbookkeeperClientRackawarePolicyEnabled: &quot;true&quot;  \nbookkeeperClientMinNumRacksPerWriteQuorum: &quot;2&quot;  \nmanagedLedgerDefaultEnsembleSize: &quot;2&quot;  \nmanagedLedgerDefaultWriteQuorum: &quot;2&quot;  \nmanagedLedgerDefaultAckQuorum: &quot;2&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">bookkeeperClientEnforceMinNumRacksPerWriteQuorum: \"true\"  \nbookkeeperClientRackawarePolicyEnabled: \"true\"  \nbookkeeperClientMinNumRacksPerWriteQuorum: \"2\"  \nmanagedLedgerDefaultEnsembleSize: \"2\"  \nmanagedLedgerDefaultWriteQuorum: \"2\"  \nmanagedLedgerDefaultAckQuorum: \"2\"\n</code></pre></div>\n<ol dir=\"auto\">\n<li>using <code class=\"notranslate\">bin/pulsar-admin bookies set-bookie-rack</code> to config bookie rack info.</li>\n<li>using <code class=\"notranslate\">bin/pulsar-admin namespaces set-bookie-affinity-group</code> to configure the primary group.</li>\n<li>Start a producer</li>\n<li>Observe the property <code class=\"notranslate\">ZkIsolatedBookieEnsemblePlacementPolicy#enforceMinNumRacksPerWriteQuorum</code>, the value is <code class=\"notranslate\">false</code>, instead of <code class=\"notranslate\">true</code>.</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">enforceMinNumRacksPerWriteQuorum</code> should be passing into ZkIsolatedBookieEnsemblePlacementPolicy.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">enforceMinNumRacksPerWriteQuorum</code> not be passing into ZkIsolatedBookieEnsemblePlacementPolicy.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21326",
                "createdAt": "2023-10-09T05:22:18Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky test NarUnpackerTest",
        "url": "https://github.com/apache/pulsar/pull/21328",
        "resourcePath": "/apache/pulsar/pull/21328",
        "createdAt": "2023-10-09T09:01:52Z",
        "number": 21328,
        "mergeCommit": {
          "oid": "e76a86e3cd1c362e9daa1c88eb8b888e6ab38ab4",
          "message": "[fix][test] Fix flaky test NarUnpackerTest (#21328)",
          "commitUrl": "https://github.com/apache/pulsar/commit/e76a86e3cd1c362e9daa1c88eb8b888e6ab38ab4",
          "parents": {
            "nodes": [
              {
                "oid": "8438e43fb02b6d8df29672c6460a2f3da924ab60",
                "message": "[fix][test] Move NarUnpackerTest to flaky group (#21316)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/test/java/org/apache/pulsar/common/nar/NarUnpackerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5cPCkx2gAoNmQzNjBkZmVjZDk2NzZhYjdlY2U4MDcyMWU5NTY5OGRiZjU4NjVmOA",
                "url": "https://github.com/apache/pulsar/pull/21328/commits/6d360dfecd9676ab7ece80721e95698dbf5865f8"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21285,
                "url": "https://github.com/apache/pulsar/issues/21285",
                "title": "Flaky-test: NarUnpackerTest.deleteSampleZipFile",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failures</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6354862390/job/17267802873#step:10:1677\">2023-09-29T21:07:56.3135966Z</a></li>\n</ul>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.io.IOException: Unable to delete /tmp/nar_unpack_dir172642347116808171\n\tat org.apache.pulsar.common.nar.FileUtils.deleteFile(FileUtils.java:216)\n\tat org.apache.pulsar.common.nar.NarUnpackerTest.deleteSampleZipFile(NarUnpackerTest.java:66)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n\tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n\tat org.testng.internal.invokers.TestInvoker.runAfterConfigurations(TestInvoker.java:792)\n\tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:613)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n\tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n\tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n\tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n\tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n\tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n\tat org.testng.TestRunner.run(TestRunner.java:602)\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n\tat org.testng.TestNG.runSuites(TestNG.java:1099)\n\tat org.testng.TestNG.run(TestNG.java:1067)\n\tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n\tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n\tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n\tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n\tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n\tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n\"><pre class=\"notranslate\"><code class=\"notranslate\">java.io.IOException: Unable to delete /tmp/nar_unpack_dir172642347116808171\n\tat org.apache.pulsar.common.nar.FileUtils.deleteFile(FileUtils.java:216)\n\tat org.apache.pulsar.common.nar.NarUnpackerTest.deleteSampleZipFile(NarUnpackerTest.java:66)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n\tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n\tat org.testng.internal.invokers.TestInvoker.runAfterConfigurations(TestInvoker.java:792)\n\tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:613)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n\tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n\tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n\tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n\tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1511)\n\tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n\tat org.testng.TestRunner.run(TestRunner.java:602)\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n\tat org.testng.TestNG.runSuites(TestNG.java:1099)\n\tat org.testng.TestNG.run(TestNG.java:1067)\n\tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n\tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n\tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n\tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n\tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n\tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21285",
                "createdAt": "2023-10-01T08:49:07Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            },
            {
              "node": {
                "number": 21291,
                "url": "https://github.com/apache/pulsar/issues/21291",
                "title": "Flaky-test: NarUnpackerTest.shouldExtractFilesOnceInDifferentProcess",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failures</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6354862390/job/17267802873#step:10:1657\">2023-09-29T21:07:56.3124841Z</a></li>\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6354862390/job/17265259914#step:10:1702\">2023-09-29T19:20:48.1844983Z</a></li>\n</ul>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.lang.AssertionError: expected [true] but found [false]\n\tat org.testng.Assert.fail(Assert.java:110)\n\tat org.testng.Assert.failNotEquals(Assert.java:1577)\n\tat org.testng.Assert.assertTrue(Assert.java:56)\n\tat org.testng.Assert.assertTrue(Assert.java:66)\n\tat org.apache.pulsar.common.nar.NarUnpackerTest.shouldExtractFilesOnceInDifferentProcess(NarUnpackerTest.java:150)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:833)\n\"><pre class=\"notranslate\"><code class=\"notranslate\">java.lang.AssertionError: expected [true] but found [false]\n\tat org.testng.Assert.fail(Assert.java:110)\n\tat org.testng.Assert.failNotEquals(Assert.java:1577)\n\tat org.testng.Assert.assertTrue(Assert.java:56)\n\tat org.testng.Assert.assertTrue(Assert.java:66)\n\tat org.apache.pulsar.common.nar.NarUnpackerTest.shouldExtractFilesOnceInDifferentProcess(NarUnpackerTest.java:150)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:833)\n\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21291",
                "createdAt": "2023-10-01T12:08:17Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky CompactionTest.testDispatcherMaxReadSizeBytes",
        "url": "https://github.com/apache/pulsar/pull/21329",
        "resourcePath": "/apache/pulsar/pull/21329",
        "createdAt": "2023-10-09T09:49:11Z",
        "number": 21329,
        "mergeCommit": {
          "oid": "c883f50e117ff9da310c879aa048993c28ea955a",
          "message": "[fix][test] Fix flaky CompactionTest.testDispatcherMaxReadSizeBytes (#21329)",
          "commitUrl": "https://github.com/apache/pulsar/commit/c883f50e117ff9da310c879aa048993c28ea955a",
          "parents": {
            "nodes": [
              {
                "oid": "66c5e1f1ae48e49ed27a72424c372ce444217d86",
                "message": "Revert \"[fix][broker] Miss headersAndPayload and messageIdData in MessagePublishContext (#21245) (#21309)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/compaction/CompactionTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5cPU--2gAoMWY3ZDQ5ZWY1NzI3NDkyZjk3NGI3ZWQ1MDRmOWI0Y2VkOGJiMzA5Yg",
                "url": "https://github.com/apache/pulsar/pull/21329/commits/1f7d49ef5727492f974b7ed504f9b4ced8bb309b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21284,
                "url": "https://github.com/apache/pulsar/issues/21284",
                "title": "Flaky-test: StrategicCompactionTest.testDispatcherMaxReadSizeBytes / CompactionTest testDispatcherMaxReadSizeBytes ",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failures</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6354520087/job/17268211341#step:10:768\">2023-09-29T21:29:57.9211789Z</a></li>\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6323018541/job/17170129864#step:10:1521\">2023-09-27T08:28:10.0360901Z</a></li>\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6322046709/job/17169919138#step:8:1401\">2023-09-27T08:25:04.0716479Z</a></li>\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6308905483/job/17130028682#step:8:2341\">2023-09-26T08:24:11.5409803Z</a></li>\n</ul>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Wanted but not invoked:\npulsarTopicCompactionService.readCompactedEntries(\n    &lt;any&gt;,\n    same(1)\n);\n-&gt; at org.apache.pulsar.compaction.PulsarTopicCompactionService.readCompactedEntries(PulsarTopicCompactionService.java:69)\nActually, there were zero interactions with this mock.\n\n\tat org.apache.pulsar.compaction.PulsarTopicCompactionService.readCompactedEntries(PulsarTopicCompactionService.java:69)\n\tat org.apache.pulsar.compaction.CompactionTest.testDispatcherMaxReadSizeBytes(CompactionTest.java:1917)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:833)\n\"><pre class=\"notranslate\"><code class=\"notranslate\">Wanted but not invoked:\npulsarTopicCompactionService.readCompactedEntries(\n    &lt;any&gt;,\n    same(1)\n);\n-&gt; at org.apache.pulsar.compaction.PulsarTopicCompactionService.readCompactedEntries(PulsarTopicCompactionService.java:69)\nActually, there were zero interactions with this mock.\n\n\tat org.apache.pulsar.compaction.PulsarTopicCompactionService.readCompactedEntries(PulsarTopicCompactionService.java:69)\n\tat org.apache.pulsar.compaction.CompactionTest.testDispatcherMaxReadSizeBytes(CompactionTest.java:1917)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:833)\n\n</code></pre></div>\n<p dir=\"auto\">Flaky-test: org.apache.pulsar.compaction.CompactionTest.testDispatcherMaxReadSizeBytes<br>\nNumber of failures: 2</p>\n<p dir=\"auto\">org.apache.pulsar.compaction.CompactionTest is flaky. The testDispatcherMaxReadSizeBytes test method fails sporadically.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Wanted but not invoked:\npulsarTopicCompactionService.readCompactedEntries(\n    &lt;any&gt;,\n    same(1)\n);\n-&gt; at org.apache.pulsar.compaction.PulsarTopicCompactionService.readCompactedEntries(PulsarTopicCompactionService.java:69)\nActually, there were zero interactions with this mock.\n\n\tat org.apache.pulsar.compaction.PulsarTopicCompactionService.readCompactedEntries(PulsarTopicCompactionService.java:69)\n\tat org.apache.pulsar.compaction.CompactionTest.testDispatcherMaxReadSizeBytes(CompactionTest.java:1917)\"><pre class=\"notranslate\"><code class=\"notranslate\">Wanted but not invoked:\npulsarTopicCompactionService.readCompactedEntries(\n    &lt;any&gt;,\n    same(1)\n);\n-&gt; at org.apache.pulsar.compaction.PulsarTopicCompactionService.readCompactedEntries(PulsarTopicCompactionService.java:69)\nActually, there were zero interactions with this mock.\n\n\tat org.apache.pulsar.compaction.PulsarTopicCompactionService.readCompactedEntries(PulsarTopicCompactionService.java:69)\n\tat org.apache.pulsar.compaction.CompactionTest.testDispatcherMaxReadSizeBytes(CompactionTest.java:1917)\n</code></pre></div>\n<p dir=\"auto\">Usage tip: To enable automatic navigation to failure message, open the following links with CTRL/CMD-click.<br>\n<a href=\"https://github.com/apache/pulsar/actions/runs/6354520087/job/17274931692#step:10:755\">example failure 2023-09-30T06:30:59.2955689Z</a><br>\n<a href=\"https://github.com/apache/pulsar/actions/runs/6354520087/job/17265229573#step:10:750\">example failure 2023-09-29T19:23:12.4282155Z</a></p>\n<details>\n<summary>Full exception stacktrace</summary>\n<code class=\"notranslate\"><pre class=\"notranslate\">Wanted but not invoked:\npulsarTopicCompactionService.readCompactedEntries(\n    ,\n    same(1)\n);\n-&gt; at org.apache.pulsar.compaction.PulsarTopicCompactionService.readCompactedEntries(PulsarTopicCompactionService.java:69)\nActually, there were zero interactions with this mock.\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"at org.apache.pulsar.compaction.PulsarTopicCompactionService.readCompactedEntries(PulsarTopicCompactionService.java:69)\nat org.apache.pulsar.compaction.CompactionTest.testDispatcherMaxReadSizeBytes(CompactionTest.java:1917)\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\nat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.base/java.lang.reflect.Method.invoke(Method.java:568)\nat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\nat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\nat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\nat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\nat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\nat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\nat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\nat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">at org.apache.pulsar.compaction.PulsarTopicCompactionService.readCompactedEntries(PulsarTopicCompactionService.java:69)\nat org.apache.pulsar.compaction.CompactionTest.testDispatcherMaxReadSizeBytes(CompactionTest.java:1917)\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\nat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\nat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\nat java.base/java.lang.reflect.Method.invoke(Method.java:568)\nat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\nat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\nat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\nat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\nat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\nat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\nat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\nat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<p dir=\"auto\"></p></pre></code><p dir=\"auto\"></p>\n</details>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21284",
                "createdAt": "2023-10-01T08:45:49Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix unload operation stuck when use ExtensibleLoadManager",
        "url": "https://github.com/apache/pulsar/pull/21332",
        "resourcePath": "/apache/pulsar/pull/21332",
        "createdAt": "2023-10-09T11:40:22Z",
        "number": 21332,
        "mergeCommit": {
          "oid": "ecd40e43a6b90b58e209bc9bced84b35d933619e",
          "message": "[fix][broker] Fix unload operation stuck when use ExtensibleLoadManager (#21332)",
          "commitUrl": "https://github.com/apache/pulsar/commit/ecd40e43a6b90b58e209bc9bced84b35d933619e",
          "parents": {
            "nodes": [
              {
                "oid": "700a29d5c877dcde5f3c8c1e946b00a8296b8d4f",
                "message": "[fix][broker] Fix heartbeat namespace create event topic and cannot delete heartbeat topic (#21360)\n\nCo-authored-by: fanjianye <fanjianye@bigo.sg>\r\nCo-authored-by: Jiwei Guo <technoboy@apache.org>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/ExtensibleLoadManagerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/channel/ServiceUnitStateChannelImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/manager/UnloadManager.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/namespace/NamespaceService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/extensions/ExtensibleLoadManagerImplTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/extensions/channel/ServiceUnitStateChannelTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5cP9Ct2gAoMGI2NjcwZDdiNzYzMzViMTQ1MDMwNjY4MmM4ZmRlNWE5YWU5ODhjYQ",
                "url": "https://github.com/apache/pulsar/pull/21332/commits/0b6670d7b76335b1450306682c8fde5a9ae988ca"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20157,
                "url": "https://github.com/apache/pulsar/issues/20157",
                "title": "Flaky-test: ExtensibleLoadManagerImplTest.initializeState",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4755217144/jobs/8449646027\">https://github.com/apache/pulsar/actions/runs/4755217144/jobs/8449646027</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<p dir=\"auto\">don't know how to find stacktrace.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20157",
                "createdAt": "2023-04-20T15:43:18Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky OneWayReplicatorTest.testReplicatorProducerStatInTopic",
        "url": "https://github.com/apache/pulsar/pull/21334",
        "resourcePath": "/apache/pulsar/pull/21334",
        "createdAt": "2023-10-09T13:34:57Z",
        "number": 21334,
        "mergeCommit": {
          "oid": "16199d2d15556ee5a19044eb739d88a01b1573e5",
          "message": "[fix][test] Fix flaky OneWayReplicatorTest.testReplicatorProducerStatInTopic (#21334)",
          "commitUrl": "https://github.com/apache/pulsar/commit/16199d2d15556ee5a19044eb739d88a01b1573e5",
          "parents": {
            "nodes": [
              {
                "oid": "c883f50e117ff9da310c879aa048993c28ea955a",
                "message": "[fix][test] Fix flaky CompactionTest.testDispatcherMaxReadSizeBytes (#21329)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/OneWayReplicatorTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5cQruv2gAoYTZiOTdkOGVhZGFkZDc0MzQyYWQ4ZWM5ODc2OGEzNWFlNzIzNDZlZg",
                "url": "https://github.com/apache/pulsar/pull/21334/commits/a6b97d8eadadd74342ad8ec98768a35ae72346ef"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21331,
                "url": "https://github.com/apache/pulsar/issues/21331",
                "title": "Flaky-test: OneWayReplicatorTest.testReplicatorProducerStatInTopic ",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/6454495353/job/17523189656?pr=21328#step:10:1272\">https://github.com/apache/pulsar/actions/runs/6454495353/job/17523189656?pr=21328#step:10:1272</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\" Error:  Tests run: 3, Failures: 1, Errors: 0, Skipped: 1, Time elapsed: 33.352 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.OneWayReplicatorTest\n  Error:  org.apache.pulsar.broker.service.OneWayReplicatorTest.testReplicatorProducerStatInTopic  Time elapsed: 0.674 s  &lt;&lt;&lt; FAILURE!\n  org.apache.pulsar.client.admin.PulsarAdminException$ConflictException: This topic already exists\n  \tat org.apache.pulsar.client.admin.PulsarAdminException.wrap(PulsarAdminException.java:252)\n  \tat org.apache.pulsar.client.admin.internal.BaseResource.sync(BaseResource.java:352)\n  \tat org.apache.pulsar.client.admin.internal.TopicsImpl.createNonPartitionedTopic(TopicsImpl.java:309)\n  \tat org.apache.pulsar.client.admin.Topics.createNonPartitionedTopic(Topics.java:539)\n  \tat org.apache.pulsar.broker.service.OneWayReplicatorTest.testReplicatorProducerStatInTopic(OneWayReplicatorTest.java:60)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  \tSuppressed: org.apache.pulsar.client.admin.PulsarAdminException$ConflictException: This topic already exists\n  \t\tat org.apache.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:287)\n  \t\tat org.apache.pulsar.client.admin.internal.BaseResource$1.failed(BaseResource.java:136)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation$1.failed(JerseyInvocation.java:882)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation$1.completed(JerseyInvocation.java:863)\n  \t\tat org.glassfish.jersey.client.ClientRuntime.processResponse(ClientRuntime.java:229)\n  \t\tat org.glassfish.jersey.client.ClientRuntime.access$200(ClientRuntime.java:62)\n  \t\tat org.glassfish.jersey.client.ClientRuntime$2.lambda$response$0(ClientRuntime.java:173)\n  \t\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)\n  \t\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:292)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:274)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:244)\n  \t\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:288)\n  \t\tat org.glassfish.jersey.client.ClientRuntime$2.response(ClientRuntime.java:173)\n  \t\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$apply$1(AsyncHttpConnector.java:254)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n  \t\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \t\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$retryOperation$4(AsyncHttpConnector.java:296)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n  \t\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \t\tat org.asynchttpclient.netty.NettyResponseFuture.loadContent(NettyResponseFuture.java:222)\n  \t\tat org.asynchttpclient.netty.NettyResponseFuture.done(NettyResponseFuture.java:257)\n  \t\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.finishUpdate(AsyncHttpClientHandler.java:241)\n  \t\tat org.asynchttpclient.netty.handler.HttpHandler.handleChunk(HttpHandler.java:114)\n  \t\tat org.asynchttpclient.netty.handler.HttpHandler.handleRead(HttpHandler.java:143)\n  \t\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.channelRead(AsyncHttpClientHandler.java:78)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelRead(CombinedChannelDuplexHandler.java:436)\n  \t\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)\n  \t\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)\n  \t\tat io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:251)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n  \t\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n  \t\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n  \t\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\n  \t\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n  \t\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \t\t... 1 more\n  \tCaused by: javax.ws.rs.ClientErrorException: HTTP 409 {&quot;reason&quot;:&quot;This topic already exists&quot;}\n  \t\tat org.glassfish.jersey.client.JerseyInvocation.createExceptionForFamily(JerseyInvocation.java:985)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation.convertToException(JerseyInvocation.java:967)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation.access$700(JerseyInvocation.java:82)\n  \t\t... 54 more\n  Caused by: [CIRCULAR REFERENCE: javax.ws.rs.ClientErrorException: HTTP 409 {&quot;reason&quot;:&quot;This topic already exists&quot;}]\"><pre class=\"notranslate\"><code class=\"notranslate\"> Error:  Tests run: 3, Failures: 1, Errors: 0, Skipped: 1, Time elapsed: 33.352 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.OneWayReplicatorTest\n  Error:  org.apache.pulsar.broker.service.OneWayReplicatorTest.testReplicatorProducerStatInTopic  Time elapsed: 0.674 s  &lt;&lt;&lt; FAILURE!\n  org.apache.pulsar.client.admin.PulsarAdminException$ConflictException: This topic already exists\n  \tat org.apache.pulsar.client.admin.PulsarAdminException.wrap(PulsarAdminException.java:252)\n  \tat org.apache.pulsar.client.admin.internal.BaseResource.sync(BaseResource.java:352)\n  \tat org.apache.pulsar.client.admin.internal.TopicsImpl.createNonPartitionedTopic(TopicsImpl.java:309)\n  \tat org.apache.pulsar.client.admin.Topics.createNonPartitionedTopic(Topics.java:539)\n  \tat org.apache.pulsar.broker.service.OneWayReplicatorTest.testReplicatorProducerStatInTopic(OneWayReplicatorTest.java:60)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  \tSuppressed: org.apache.pulsar.client.admin.PulsarAdminException$ConflictException: This topic already exists\n  \t\tat org.apache.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:287)\n  \t\tat org.apache.pulsar.client.admin.internal.BaseResource$1.failed(BaseResource.java:136)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation$1.failed(JerseyInvocation.java:882)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation$1.completed(JerseyInvocation.java:863)\n  \t\tat org.glassfish.jersey.client.ClientRuntime.processResponse(ClientRuntime.java:229)\n  \t\tat org.glassfish.jersey.client.ClientRuntime.access$200(ClientRuntime.java:62)\n  \t\tat org.glassfish.jersey.client.ClientRuntime$2.lambda$response$0(ClientRuntime.java:173)\n  \t\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)\n  \t\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:292)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:274)\n  \t\tat org.glassfish.jersey.internal.Errors.process(Errors.java:244)\n  \t\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:288)\n  \t\tat org.glassfish.jersey.client.ClientRuntime$2.response(ClientRuntime.java:173)\n  \t\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$apply$1(AsyncHttpConnector.java:254)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n  \t\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \t\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$retryOperation$4(AsyncHttpConnector.java:296)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n  \t\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n  \t\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n  \t\tat org.asynchttpclient.netty.NettyResponseFuture.loadContent(NettyResponseFuture.java:222)\n  \t\tat org.asynchttpclient.netty.NettyResponseFuture.done(NettyResponseFuture.java:257)\n  \t\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.finishUpdate(AsyncHttpClientHandler.java:241)\n  \t\tat org.asynchttpclient.netty.handler.HttpHandler.handleChunk(HttpHandler.java:114)\n  \t\tat org.asynchttpclient.netty.handler.HttpHandler.handleRead(HttpHandler.java:143)\n  \t\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.channelRead(AsyncHttpClientHandler.java:78)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelRead(CombinedChannelDuplexHandler.java:436)\n  \t\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)\n  \t\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)\n  \t\tat io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:251)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \t\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n  \t\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \t\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n  \t\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n  \t\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n  \t\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n  \t\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\n  \t\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n  \t\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \t\t... 1 more\n  \tCaused by: javax.ws.rs.ClientErrorException: HTTP 409 {\"reason\":\"This topic already exists\"}\n  \t\tat org.glassfish.jersey.client.JerseyInvocation.createExceptionForFamily(JerseyInvocation.java:985)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation.convertToException(JerseyInvocation.java:967)\n  \t\tat org.glassfish.jersey.client.JerseyInvocation.access$700(JerseyInvocation.java:82)\n  \t\t... 54 more\n  Caused by: [CIRCULAR REFERENCE: javax.ws.rs.ClientErrorException: HTTP 409 {\"reason\":\"This topic already exists\"}]\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21331",
                "createdAt": "2023-10-09T11:21:34Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky AdminApiMaxUnackedMessagesTest.testMaxUnackedMessagesPerConsumerPriority",
        "url": "https://github.com/apache/pulsar/pull/21335",
        "resourcePath": "/apache/pulsar/pull/21335",
        "createdAt": "2023-10-09T13:38:07Z",
        "number": 21335,
        "mergeCommit": {
          "oid": "c35524dae2d430d5ceb39b07e9124fac5d02648b",
          "message": "[fix][test] Fix flaky AdminApiMaxUnackedMessagesTest.testMaxUnackedMessagesPerConsumerPriority (#21335)",
          "commitUrl": "https://github.com/apache/pulsar/commit/c35524dae2d430d5ceb39b07e9124fac5d02648b",
          "parents": {
            "nodes": [
              {
                "oid": "9449ae41c77989f509d1b6dacfa2cc1b94d1cf15",
                "message": "[improve][offload] Avoid implementation details leak on getOffloadPolicies return value (#21336)\n\nSigned-off-by: tison <wander4096@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiMaxUnackedMessagesTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5cQtvT2gAoNGNjNDAzY2JiYzNlZjVmOTg3NGU0Mzg5NGM2MjlhODM3Y2Y2YTJmMQ",
                "url": "https://github.com/apache/pulsar/pull/21335/commits/4cc403cbbc3ef5f9874e43894c629a837cf6a2f1"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21330,
                "url": "https://github.com/apache/pulsar/issues/21330",
                "title": "Flaky-test: AdminApiMaxUnackedMessagesTest.testMaxUnackedMessagesPerConsumerPriority",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/6454992455/job/17522130798?pr=21329#step:10:938\">https://github.com/apache/pulsar/actions/runs/6454992455/job/17522130798?pr=21329#step:10:938</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 8, Failures: 1, Errors: 0, Skipped: 5, Time elapsed: 40.429 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.admin.AdminApiMaxUnackedMessagesTest\n  Error:  org.apache.pulsar.broker.admin.AdminApiMaxUnackedMessagesTest.testMaxUnackedMessagesPerConsumerPriority  Time elapsed: 7.833 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [3] but found [1]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n  \tat org.testng.Assert.assertEquals(Assert.java:131)\n  \tat org.testng.Assert.assertEquals(Assert.java:1418)\n  \tat org.testng.Assert.assertEquals(Assert.java:1382)\n  \tat org.testng.Assert.assertEquals(Assert.java:1428)\n  \tat org.apache.pulsar.broker.admin.AdminApiMaxUnackedMessagesTest.testMaxUnackedMessagesPerConsumerPriority(AdminApiMaxUnackedMessagesTest.java:192)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 8, Failures: 1, Errors: 0, Skipped: 5, Time elapsed: 40.429 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.admin.AdminApiMaxUnackedMessagesTest\n  Error:  org.apache.pulsar.broker.admin.AdminApiMaxUnackedMessagesTest.testMaxUnackedMessagesPerConsumerPriority  Time elapsed: 7.833 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [3] but found [1]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n  \tat org.testng.Assert.assertEquals(Assert.java:131)\n  \tat org.testng.Assert.assertEquals(Assert.java:1418)\n  \tat org.testng.Assert.assertEquals(Assert.java:1382)\n  \tat org.testng.Assert.assertEquals(Assert.java:1428)\n  \tat org.apache.pulsar.broker.admin.AdminApiMaxUnackedMessagesTest.testMaxUnackedMessagesPerConsumerPriority(AdminApiMaxUnackedMessagesTest.java:192)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21330",
                "createdAt": "2023-10-09T11:01:34Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Unblock stuck Key_Shared subscription after consumer reconnect",
        "url": "https://github.com/apache/pulsar/pull/21396",
        "resourcePath": "/apache/pulsar/pull/21396",
        "createdAt": "2023-10-19T05:49:09Z",
        "number": 21396,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentStickyKeyDispatcherMultipleConsumers.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5dOa6h2gAoNDRhNmEwZjg0YWQxNDFhOWQzMzYzZDFmZWZhN2M1NDgwNTY0YTI0Mw",
                "url": "https://github.com/apache/pulsar/pull/21396/commits/44a6a0f84ad141a9d3363d1fefa7c5480564a243"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21199,
                "url": "https://github.com/apache/pulsar/issues/21199",
                "title": "[Bug] Subscription consumption stuck on ",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar broker: 2.8.4<br>\nJava Pulsar client: 2.8.4</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Non-partitioned topic. Batching is disabled on both producer and consumer. No acknowledge timeout. 5 subscriptions, each has 12 consumers.</p>\n<p dir=\"auto\">One consumer of one subscription fails to process a message and doesn't ack it.<br>\nOn a fail, I give the consumer a minute more to try to process other messages and ack them, if they are processed successfully. After a minute, I recreate the consumer and try to reprocess the messages, which would help if the error was transient.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I expected to see the subscription backlog consumed further by the consumer with 1 failed message and by the other 11 consumers.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">If a consumer fails to process one message, processing of all other messages with other keys is also stalled.<br>\nIncluding the other 11 consumers of the subscription.<br>\nAll the other subscriptions and their consumers of the topic continue processing as expected.</p>\n<p dir=\"auto\">As a symptom, I see the stuck subscription has <em>\"waitingReadOp\" : false</em> and <em>\"subscriptionHavePendingRead\" : false</em>, while the other subscription has these fields at <em>true</em>.</p>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/files/12645485/stats.txt\">stats.txt</a><br>\n<a href=\"https://github.com/apache/pulsar/files/12645486/stats-internal.txt\">stats-internal.txt</a></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The message rate is about 50 messages per second. The same scenario with a few (1-2-5) messages per minute works as expected. So, I believe there might be some race condition.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21199",
                "createdAt": "2023-09-18T07:41:20Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][pip] PIP-313 Support force unsubscribe using consumer api",
        "url": "https://github.com/apache/pulsar/pull/21452",
        "resourcePath": "/apache/pulsar/pull/21452",
        "createdAt": "2023-10-27T00:14:42Z",
        "number": 21452,
        "mergeCommit": {
          "oid": "c34a5d816a12dcb108e94de6afc8108a8d86ebac",
          "message": "[improve][pip] PIP-313 Support force unsubscribe using consumer api (#21452)",
          "commitUrl": "https://github.com/apache/pulsar/commit/c34a5d816a12dcb108e94de6afc8108a8d86ebac",
          "parents": {
            "nodes": [
              {
                "oid": "b1900712c073bb83dd67326cb17561ce5383cf0c",
                "message": "[improve][build] Configure https timeout for apt, copy config to java-test-image (#21724)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": "pip/pip_313.md"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5d6_2A2gAoYTIwYjAxYTgzZTY0NjIyZmVkYzM4YmNhN2M0Njk4YThmNThmOGFlNA",
                "url": "https://github.com/apache/pulsar/pull/21452/commits/a20b01a83e64622fedc38bca7c4698a8f58f8ae4"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21451,
                "url": "https://github.com/apache/pulsar/issues/21451",
                "title": "Pulsar spout fails to unsubscribe and close consumers on a shared subscription",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Apache Pulsar provides a messaging queue using a Shared subscription to process unordered messages in parallel using multiple connected consumers. Shared subscription is also commonly used in data processing pipelines where they need to forcefully unsubscribe from the subscription after processing messages on the topic. One example is Pulsar-Storm adapter where <a href=\"https://github.com/apache/pulsar/blob/branch-2.4/pulsar-storm/src/main/java/org/apache/pulsar/storm/PulsarSpout.java#L126\">Pulsar spout</a> creates Pulsar consumers on a shared subscription for distributed processing and then unsubscribe on the topic. However, PulsarSpout always fails to unsubscribe shared subscriptions and it also doesn't close the pulsar consumers if there is more than one consumer connected to the subscription which causes a leaked subscription and consumer for that application. It also causes a backlog on a topic due to failed unsubscribe and application team has to build external service to just address such failures.<br>\nIn this usecases, client application can not successfully unsubscribe on a shared subscription when multiple consumers are connected because Pulsar client library first tries to unsubscribe which will not be successful as multiple consumers are still connected on the subscription and eventually Pulsar client lib fails to unsubscribe and close the consumer on the subscription. Because of that none of the consumers can disconnect or unsubscribe from the subscription. This will make it impossible for applications to unsubscribe on a shared subscription and they need an API to forcefully unsubscribe on a shared subscription using consumer API.<br>\nWe already have the admin-api to unsubscribe forcefully but adding such support in consumer API will allow applications like Pulsar-storm to unsubscribe successfully and also allow consumers to close gracefully.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">We already have the admin-api to unsubscribe forcefully but adding such support in consumer API will allow applications like Pulsar-storm to unsubscribe successfully and also allow consumers to close gracefully.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21451",
                "createdAt": "2023-10-27T00:03:27Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix issue with consumer read uncommitted messages from compacted topic",
        "url": "https://github.com/apache/pulsar/pull/21465",
        "resourcePath": "/apache/pulsar/pull/21465",
        "createdAt": "2023-10-29T11:51:29Z",
        "number": 21465,
        "mergeCommit": {
          "oid": "b5925ede2ef5652e36f252ab74a3463b8b3bfaf4",
          "message": "[fix][broker] Fix issue with consumer read uncommitted messages from compacted topic (#21465)",
          "commitUrl": "https://github.com/apache/pulsar/commit/b5925ede2ef5652e36f252ab74a3463b8b3bfaf4",
          "parents": {
            "nodes": [
              {
                "oid": "f3f5fbc27391e13ab76b0f2265f51ac3a5c0a90c",
                "message": "[fix][txn] OpRequestSend reuse problem cause tbClient commitTxnOnTopic timeout unexpectedly (#21505)\n\nCo-authored-by: fanjianye <fanjianye@bigo.sg>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentDispatcherSingleActiveConsumer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/CompactedTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/CompactedTopicImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/CompactedTopicUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/transaction/TransactionTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/compaction/CompactedTopicUtilsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5eC-Cm2gAoMTFkZWJlZTRlY2VlMDk5NTg2NGZjN2E2YjYwODliM2IxZTNlYmI3OQ",
                "url": "https://github.com/apache/pulsar/pull/21465/commits/11debee4ecee0995864fc7a6b6089b3b1e3ebb79"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21464,
                "url": "https://github.com/apache/pulsar/issues/21464",
                "title": "[Bug] Consumer reads uncommitted messages from compacted topic",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"        final String topic = &quot;test_transaction_topic_read_compacted&quot;;\n        admin.topics().createNonPartitionedTopic(topic);\n\n        admin.topicPolicies().setCompactionThreshold(topic, 100 * 1024 * 1024);\n\n        @Cleanup\n        Consumer&lt;String&gt; consumer = this.pulsarClient.newConsumer(Schema.STRING)\n                .topic(topic)\n                .subscriptionName(&quot;sub&quot;)\n                .subscriptionType(SubscriptionType.Exclusive)\n                .readCompacted(true)\n                .subscribe();\n\n        @Cleanup\n        Producer&lt;String&gt; producer = this.pulsarClient.newProducer(Schema.STRING)\n                .topic(topic)\n                .create();\n\n        producer.newMessage().key(&quot;K1&quot;).value(&quot;V1&quot;).send();\n\n        Transaction txn = pulsarClient.newTransaction()\n                .withTransactionTimeout(1, TimeUnit.MINUTES).build().get();\n        producer.newMessage(txn).key(&quot;K2&quot;).value(&quot;V2&quot;).send();\n        producer.newMessage(txn).key(&quot;K3&quot;).value(&quot;V3&quot;).send();\n\n        List&lt;String&gt; messages = new ArrayList&lt;&gt;();\n        while (true) {\n            Message&lt;String&gt; message = consumer.receive(5, TimeUnit.SECONDS);\n            if (message == null) {\n                break;\n            }\n            messages.add(message.getValue());\n        }\n\n        Assert.assertEquals(messages, List.of(&quot;V1&quot;));\"><pre class=\"notranslate\">        <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">topic</span> = <span class=\"pl-s\">\"test_transaction_topic_read_compacted\"</span>;\n        <span class=\"pl-s1\">admin</span>.<span class=\"pl-en\">topics</span>().<span class=\"pl-en\">createNonPartitionedTopic</span>(<span class=\"pl-s1\">topic</span>);\n\n        <span class=\"pl-s1\">admin</span>.<span class=\"pl-en\">topicPolicies</span>().<span class=\"pl-en\">setCompactionThreshold</span>(<span class=\"pl-s1\">topic</span>, <span class=\"pl-c1\">100</span> * <span class=\"pl-c1\">1024</span> * <span class=\"pl-c1\">1024</span>);\n\n        <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Cleanup</span>\n        <span class=\"pl-smi\">Consumer</span>&lt;<span class=\"pl-smi\">String</span>&gt; <span class=\"pl-s1\">consumer</span> = <span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">pulsarClient</span>.<span class=\"pl-en\">newConsumer</span>(<span class=\"pl-smi\">Schema</span>.<span class=\"pl-c1\">STRING</span>)\n                .<span class=\"pl-en\">topic</span>(<span class=\"pl-s1\">topic</span>)\n                .<span class=\"pl-en\">subscriptionName</span>(<span class=\"pl-s\">\"sub\"</span>)\n                .<span class=\"pl-en\">subscriptionType</span>(<span class=\"pl-smi\">SubscriptionType</span>.<span class=\"pl-s1\">Exclusive</span>)\n                .<span class=\"pl-en\">readCompacted</span>(<span class=\"pl-c1\">true</span>)\n                .<span class=\"pl-en\">subscribe</span>();\n\n        <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Cleanup</span>\n        <span class=\"pl-smi\">Producer</span>&lt;<span class=\"pl-smi\">String</span>&gt; <span class=\"pl-s1\">producer</span> = <span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">pulsarClient</span>.<span class=\"pl-en\">newProducer</span>(<span class=\"pl-smi\">Schema</span>.<span class=\"pl-c1\">STRING</span>)\n                .<span class=\"pl-en\">topic</span>(<span class=\"pl-s1\">topic</span>)\n                .<span class=\"pl-en\">create</span>();\n\n        <span class=\"pl-s1\">producer</span>.<span class=\"pl-en\">newMessage</span>().<span class=\"pl-en\">key</span>(<span class=\"pl-s\">\"K1\"</span>).<span class=\"pl-en\">value</span>(<span class=\"pl-s\">\"V1\"</span>).<span class=\"pl-en\">send</span>();\n\n        <span class=\"pl-smi\">Transaction</span> <span class=\"pl-s1\">txn</span> = <span class=\"pl-s1\">pulsarClient</span>.<span class=\"pl-en\">newTransaction</span>()\n                .<span class=\"pl-en\">withTransactionTimeout</span>(<span class=\"pl-c1\">1</span>, <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">MINUTES</span>).<span class=\"pl-en\">build</span>().<span class=\"pl-en\">get</span>();\n        <span class=\"pl-s1\">producer</span>.<span class=\"pl-en\">newMessage</span>(<span class=\"pl-s1\">txn</span>).<span class=\"pl-en\">key</span>(<span class=\"pl-s\">\"K2\"</span>).<span class=\"pl-en\">value</span>(<span class=\"pl-s\">\"V2\"</span>).<span class=\"pl-en\">send</span>();\n        <span class=\"pl-s1\">producer</span>.<span class=\"pl-en\">newMessage</span>(<span class=\"pl-s1\">txn</span>).<span class=\"pl-en\">key</span>(<span class=\"pl-s\">\"K3\"</span>).<span class=\"pl-en\">value</span>(<span class=\"pl-s\">\"V3\"</span>).<span class=\"pl-en\">send</span>();\n\n        <span class=\"pl-smi\">List</span>&lt;<span class=\"pl-smi\">String</span>&gt; <span class=\"pl-s1\">messages</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ArrayList</span>&lt;&gt;();\n        <span class=\"pl-k\">while</span> (<span class=\"pl-c1\">true</span>) {\n            <span class=\"pl-smi\">Message</span>&lt;<span class=\"pl-smi\">String</span>&gt; <span class=\"pl-s1\">message</span> = <span class=\"pl-s1\">consumer</span>.<span class=\"pl-en\">receive</span>(<span class=\"pl-c1\">5</span>, <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">SECONDS</span>);\n            <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">message</span> == <span class=\"pl-c1\">null</span>) {\n                <span class=\"pl-k\">break</span>;\n            }\n            <span class=\"pl-s1\">messages</span>.<span class=\"pl-en\">add</span>(<span class=\"pl-s1\">message</span>.<span class=\"pl-en\">getValue</span>());\n        }\n\n        <span class=\"pl-smi\">Assert</span>.<span class=\"pl-en\">assertEquals</span>(<span class=\"pl-s1\">messages</span>, <span class=\"pl-smi\">List</span>.<span class=\"pl-en\">of</span>(<span class=\"pl-s\">\"V1\"</span>));</pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Test pass, the consumer can't read uncommitted messages from compacted topic</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Test failed, the consumer read uncommitted messages from compacted topic</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21464",
                "createdAt": "2023-10-29T11:47:51Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "category/reliability"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix ExtensibleLoadManagerImplTest flaky test",
        "url": "https://github.com/apache/pulsar/pull/21479",
        "resourcePath": "/apache/pulsar/pull/21479",
        "createdAt": "2023-10-31T02:56:46Z",
        "number": 21479,
        "mergeCommit": {
          "oid": "469ce7e10483a8e8fece91dfe2fc90929277e2c0",
          "message": "[fix][test] Fix ExtensibleLoadManagerImplTest flaky test (#21479)",
          "commitUrl": "https://github.com/apache/pulsar/commit/469ce7e10483a8e8fece91dfe2fc90929277e2c0",
          "parents": {
            "nodes": [
              {
                "oid": "44abba9922e5e02099bab79591e2327845772f16",
                "message": "[improve][build] Change UBUNTU_MIRROR default value (#21520)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/extensions/ExtensibleLoadManagerImplTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5eLu772gAoMmVkNTY1MTcwOTA3ZjA5MGI2MjZhNWNiY2RhMjhmOWFlZDhjNWQwNw",
                "url": "https://github.com/apache/pulsar/pull/21479/commits/2ed565170907f090b626a5cbcda28f9aed8c5d07"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21469,
                "url": "https://github.com/apache/pulsar/issues/21469",
                "title": "Flaky-test: ExtensibleLoadManagerImplTest.testCheckOwnershipAsync",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/6688642113/job/18171194753?pr=21467#step:10:1340\">https://github.com/apache/pulsar/actions/runs/6688642113/job/18171194753?pr=21467#step:10:1340</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 95, Failures: 1, Errors: 0, Skipped: 91, Time elapsed: 41.599 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest\n  Error:  org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest.testCheckOwnershipAsync  Time elapsed: 2.053 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [false] but found [true]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertFalse(Assert.java:78)\n  \tat org.testng.Assert.assertFalse(Assert.java:88)\n  \tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest.testCheckOwnershipAsync(ExtensibleLoadManagerImplTest.java:268)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 95, Failures: 1, Errors: 0, Skipped: 91, Time elapsed: 41.599 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest\n  Error:  org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest.testCheckOwnershipAsync  Time elapsed: 2.053 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [false] but found [true]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertFalse(Assert.java:78)\n  \tat org.testng.Assert.assertFalse(Assert.java:88)\n  \tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest.testCheckOwnershipAsync(ExtensibleLoadManagerImplTest.java:268)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21469",
                "createdAt": "2023-10-30T06:23:06Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            },
            {
              "node": {
                "number": 21476,
                "url": "https://github.com/apache/pulsar/issues/21476",
                "title": "Flaky-test: ExtensibleLoadManagerImplTest.testMoreThenOneFilter",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/6692363258/job/18188949022?pr=21472#step:11:1405\">https://github.com/apache/pulsar/actions/runs/6692363258/job/18188949022?pr=21472#step:11:1405</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 48, Failures: 1, Errors: 0, Skipped: 32, Time elapsed: 165.607 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest\n  Error:  org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest.testMoreThenOneFilter  Time elapsed: 0.045 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [http://localhost:44641] but found [http://localhost:45515]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n  \tat org.testng.Assert.assertEquals(Assert.java:131)\n  \tat org.testng.Assert.assertEquals(Assert.java:655)\n  \tat org.testng.Assert.assertEquals(Assert.java:665)\n  \tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest.testMoreThenOneFilter(ExtensibleLoadManagerImplTest.java:576)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 48, Failures: 1, Errors: 0, Skipped: 32, Time elapsed: 165.607 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest\n  Error:  org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest.testMoreThenOneFilter  Time elapsed: 0.045 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [http://localhost:44641] but found [http://localhost:45515]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n  \tat org.testng.Assert.assertEquals(Assert.java:131)\n  \tat org.testng.Assert.assertEquals(Assert.java:655)\n  \tat org.testng.Assert.assertEquals(Assert.java:665)\n  \tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImplTest.testMoreThenOneFilter(ExtensibleLoadManagerImplTest.java:576)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21476",
                "createdAt": "2023-10-30T15:29:51Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix the deadlock when using BookieRackAffinityMapping with rackaware policy",
        "url": "https://github.com/apache/pulsar/pull/21481",
        "resourcePath": "/apache/pulsar/pull/21481",
        "createdAt": "2023-10-31T04:32:04Z",
        "number": 21481,
        "mergeCommit": {
          "oid": "2efef87e5d936df604633ba65e7a0595f1d3bb9e",
          "message": "[fix][broker] Fix the deadlock when using BookieRackAffinityMapping with rackaware policy (#21481)",
          "commitUrl": "https://github.com/apache/pulsar/commit/2efef87e5d936df604633ba65e7a0595f1d3bb9e",
          "parents": {
            "nodes": [
              {
                "oid": "3c067ce28025e116146977118312a1471ba284f5",
                "message": "[fix][broker] Fix create topic with different auto creation strategies causes race condition (#21545)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/bookie/rackawareness/BookieRackAffinityMapping.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/test/java/org/apache/pulsar/bookie/rackawareness/BookieRackAffinityMappingTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5eMA9c2gAoYjBhNTBiNTM4MGE4ZWM3ZTczMDJjNDRkODIzNjUxNDgyZWJjZDUwNg",
                "url": "https://github.com/apache/pulsar/pull/21481/commits/b0a50b5380a8ec7e7302c44d823651482ebcd506"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21480,
                "url": "https://github.com/apache/pulsar/issues/21480",
                "title": "[Bug] Deadlock occurs when using BookieRackAffinityMapping with rackaware policy",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">OS: Linux<br>\nPulsar: 2.10.4</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">There are race conditions here and executing the following two operations in parallel may trigger the deadlock:</p>\n<ul dir=\"auto\">\n<li>using set-bookie-rack to update rack config</li>\n<li>new bookie added</li>\n</ul>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">no deadlock</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Deadlock occurs.</p>\n<p dir=\"auto\">Info:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Found one Java-level deadlock:\n=============================\n&quot;main-EventThread&quot;:\n  waiting for ownable synchronizer 0x0000000301550fc8, (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync),\n  which is held by &quot;pulsar-registration-client-93-1&quot;\n&quot;pulsar-registration-client-93-1&quot;:\n  waiting to lock monitor 0x00007f8110008380 (object 0x00000003015511a0, a org.apache.pulsar.bookie.rackawareness.BookieRackAffinityMapping),\n  which is held by &quot;main-EventThread&quot;\n\nJava stack information for the threads listed above:\n===================================================\n&quot;main-EventThread&quot;:\n        at jdk.internal.misc.Unsafe.park(java.base@11.0.14-ga/Native Method)\n        - parking to wait for  &lt;0x0000000301550fc8&gt; (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)\n        at java.util.concurrent.locks.LockSupport.park(java.base@11.0.14-ga/LockSupport.java:194)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(java.base@11.0.14-ga/AbstractQueuedSynchronizer.java:885)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(java.base@11.0.14-ga/AbstractQueuedSynchronizer.java:917)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(java.base@11.0.14-ga/AbstractQueuedSynchronizer.java:1240)\n        at java.util.concurrent.locks.ReentrantReadWriteLock$WriteLock.lock(java.base@11.0.14-ga/ReentrantReadWriteLock.java:959)\n        at org.apache.bookkeeper.client.RegionAwareEnsemblePlacementPolicy.onBookieRackChange(RegionAwareEnsemblePlacementPolicy.java:174)\n        at org.apache.pulsar.bookie.rackawareness.BookieRackAffinityMapping.lambda$handleUpdates$3(BookieRackAffinityMapping.java:265)\n        - locked &lt;0x00000003015511a0&gt; (a org.apache.pulsar.bookie.rackawareness.BookieRackAffinityMapping)\n        at org.apache.pulsar.bookie.rackawareness.BookieRackAffinityMapping$$Lambda$1803/0x0000000800abb440.accept(Unknown Source)\n        at java.util.concurrent.CompletableFuture$UniAccept.tryFire(java.base@11.0.14-ga/CompletableFuture.java:714)\n        at java.util.concurrent.CompletableFuture.postComplete(java.base@11.0.14-ga/CompletableFuture.java:506)\n        at java.util.concurrent.CompletableFuture.complete(java.base@11.0.14-ga/CompletableFuture.java:2073)\n        at org.apache.pulsar.metadata.impl.ZKMetadataStore.handleGetResult(ZKMetadataStore.java:244)\n        at org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$7(ZKMetadataStore.java:188)\n        at org.apache.pulsar.metadata.impl.ZKMetadataStore$$Lambda$165/0x0000000800347c40.processResult(Unknown Source)\n        at org.apache.pulsar.metadata.impl.PulsarZooKeeperClient$3$1.processResult(PulsarZooKeeperClient.java:490)\n        at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:722)\n        at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:563)\n&quot;pulsar-registration-client-93-1&quot;:\n        at org.apache.pulsar.bookie.rackawareness.BookieRackAffinityMapping.resolve(BookieRackAffinityMapping.java:202)\n        - waiting to lock &lt;0x00000003015511a0&gt; (a org.apache.pulsar.bookie.rackawareness.BookieRackAffinityMapping)\n        at org.apache.bookkeeper.client.TopologyAwareEnsemblePlacementPolicy$DNSResolverDecorator.resolve(TopologyAwareEnsemblePlacementPolicy.java:563)\n        at org.apache.bookkeeper.net.NetUtils.resolveNetworkLocation(NetUtils.java:88)\n        at org.apache.bookkeeper.client.TopologyAwareEnsemblePlacementPolicy.resolveNetworkLocation(TopologyAwareEnsemblePlacementPolicy.java:804)\n        at org.apache.bookkeeper.client.TopologyAwareEnsemblePlacementPolicy.createBookieNode(TopologyAwareEnsemblePlacementPolicy.java:794)\n        at org.apache.bookkeeper.client.RegionAwareEnsemblePlacementPolicy.handleBookiesThatJoined(RegionAwareEnsemblePlacementPolicy.java:135)\n        at org.apache.bookkeeper.client.TopologyAwareEnsemblePlacementPolicy.onClusterChanged(TopologyAwareEnsemblePlacementPolicy.java:665)\n        at org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl.onClusterChanged(RackawareEnsemblePlacementPolicyImpl.java:80)\n        at org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicy.onClusterChanged(RackawareEnsemblePlacementPolicy.java:92)\n        at org.apache.bookkeeper.client.BookieWatcherImpl.processWritableBookiesChanged(BookieWatcherImpl.java:197)\n        - locked &lt;0x00000003015401c8&gt; (a org.apache.bookkeeper.client.BookieWatcherImpl)\n        at org.apache.bookkeeper.client.BookieWatcherImpl.lambda$initialBlockingBookieRead$1(BookieWatcherImpl.java:233)\n        at org.apache.bookkeeper.client.BookieWatcherImpl$$Lambda$186/0x0000000800386040.onBookiesChanged(Unknown Source)\n        at org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient.lambda$updatedBookies$6(PulsarRegistrationClient.java:183)\n        at org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient$$Lambda$1802/0x0000000800ab1c40.run(Unknown Source)\n        at java.util.concurrent.Executors$RunnableAdapter.call(java.base@11.0.14-ga/Executors.java:515)\n        at java.util.concurrent.FutureTask.run(java.base@11.0.14-ga/FutureTask.java:264)\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(java.base@11.0.14-ga/ScheduledThreadPoolExecutor.java:304)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@11.0.14-ga/ThreadPoolExecutor.java:1128)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@11.0.14-ga/ThreadPoolExecutor.java:628)\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n        at java.lang.Thread.run(java.base@11.0.14-ga/Thread.java:829)\n\"><pre class=\"notranslate\"><code class=\"notranslate\">Found one Java-level deadlock:\n=============================\n\"main-EventThread\":\n  waiting for ownable synchronizer 0x0000000301550fc8, (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync),\n  which is held by \"pulsar-registration-client-93-1\"\n\"pulsar-registration-client-93-1\":\n  waiting to lock monitor 0x00007f8110008380 (object 0x00000003015511a0, a org.apache.pulsar.bookie.rackawareness.BookieRackAffinityMapping),\n  which is held by \"main-EventThread\"\n\nJava stack information for the threads listed above:\n===================================================\n\"main-EventThread\":\n        at jdk.internal.misc.Unsafe.park(java.base@11.0.14-ga/Native Method)\n        - parking to wait for  &lt;0x0000000301550fc8&gt; (a java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync)\n        at java.util.concurrent.locks.LockSupport.park(java.base@11.0.14-ga/LockSupport.java:194)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.parkAndCheckInterrupt(java.base@11.0.14-ga/AbstractQueuedSynchronizer.java:885)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireQueued(java.base@11.0.14-ga/AbstractQueuedSynchronizer.java:917)\n        at java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(java.base@11.0.14-ga/AbstractQueuedSynchronizer.java:1240)\n        at java.util.concurrent.locks.ReentrantReadWriteLock$WriteLock.lock(java.base@11.0.14-ga/ReentrantReadWriteLock.java:959)\n        at org.apache.bookkeeper.client.RegionAwareEnsemblePlacementPolicy.onBookieRackChange(RegionAwareEnsemblePlacementPolicy.java:174)\n        at org.apache.pulsar.bookie.rackawareness.BookieRackAffinityMapping.lambda$handleUpdates$3(BookieRackAffinityMapping.java:265)\n        - locked &lt;0x00000003015511a0&gt; (a org.apache.pulsar.bookie.rackawareness.BookieRackAffinityMapping)\n        at org.apache.pulsar.bookie.rackawareness.BookieRackAffinityMapping$$Lambda$1803/0x0000000800abb440.accept(Unknown Source)\n        at java.util.concurrent.CompletableFuture$UniAccept.tryFire(java.base@11.0.14-ga/CompletableFuture.java:714)\n        at java.util.concurrent.CompletableFuture.postComplete(java.base@11.0.14-ga/CompletableFuture.java:506)\n        at java.util.concurrent.CompletableFuture.complete(java.base@11.0.14-ga/CompletableFuture.java:2073)\n        at org.apache.pulsar.metadata.impl.ZKMetadataStore.handleGetResult(ZKMetadataStore.java:244)\n        at org.apache.pulsar.metadata.impl.ZKMetadataStore.lambda$batchOperation$7(ZKMetadataStore.java:188)\n        at org.apache.pulsar.metadata.impl.ZKMetadataStore$$Lambda$165/0x0000000800347c40.processResult(Unknown Source)\n        at org.apache.pulsar.metadata.impl.PulsarZooKeeperClient$3$1.processResult(PulsarZooKeeperClient.java:490)\n        at org.apache.zookeeper.ClientCnxn$EventThread.processEvent(ClientCnxn.java:722)\n        at org.apache.zookeeper.ClientCnxn$EventThread.run(ClientCnxn.java:563)\n\"pulsar-registration-client-93-1\":\n        at org.apache.pulsar.bookie.rackawareness.BookieRackAffinityMapping.resolve(BookieRackAffinityMapping.java:202)\n        - waiting to lock &lt;0x00000003015511a0&gt; (a org.apache.pulsar.bookie.rackawareness.BookieRackAffinityMapping)\n        at org.apache.bookkeeper.client.TopologyAwareEnsemblePlacementPolicy$DNSResolverDecorator.resolve(TopologyAwareEnsemblePlacementPolicy.java:563)\n        at org.apache.bookkeeper.net.NetUtils.resolveNetworkLocation(NetUtils.java:88)\n        at org.apache.bookkeeper.client.TopologyAwareEnsemblePlacementPolicy.resolveNetworkLocation(TopologyAwareEnsemblePlacementPolicy.java:804)\n        at org.apache.bookkeeper.client.TopologyAwareEnsemblePlacementPolicy.createBookieNode(TopologyAwareEnsemblePlacementPolicy.java:794)\n        at org.apache.bookkeeper.client.RegionAwareEnsemblePlacementPolicy.handleBookiesThatJoined(RegionAwareEnsemblePlacementPolicy.java:135)\n        at org.apache.bookkeeper.client.TopologyAwareEnsemblePlacementPolicy.onClusterChanged(TopologyAwareEnsemblePlacementPolicy.java:665)\n        at org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicyImpl.onClusterChanged(RackawareEnsemblePlacementPolicyImpl.java:80)\n        at org.apache.bookkeeper.client.RackawareEnsemblePlacementPolicy.onClusterChanged(RackawareEnsemblePlacementPolicy.java:92)\n        at org.apache.bookkeeper.client.BookieWatcherImpl.processWritableBookiesChanged(BookieWatcherImpl.java:197)\n        - locked &lt;0x00000003015401c8&gt; (a org.apache.bookkeeper.client.BookieWatcherImpl)\n        at org.apache.bookkeeper.client.BookieWatcherImpl.lambda$initialBlockingBookieRead$1(BookieWatcherImpl.java:233)\n        at org.apache.bookkeeper.client.BookieWatcherImpl$$Lambda$186/0x0000000800386040.onBookiesChanged(Unknown Source)\n        at org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient.lambda$updatedBookies$6(PulsarRegistrationClient.java:183)\n        at org.apache.pulsar.metadata.bookkeeper.PulsarRegistrationClient$$Lambda$1802/0x0000000800ab1c40.run(Unknown Source)\n        at java.util.concurrent.Executors$RunnableAdapter.call(java.base@11.0.14-ga/Executors.java:515)\n        at java.util.concurrent.FutureTask.run(java.base@11.0.14-ga/FutureTask.java:264)\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(java.base@11.0.14-ga/ScheduledThreadPoolExecutor.java:304)\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@11.0.14-ga/ThreadPoolExecutor.java:1128)\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@11.0.14-ga/ThreadPoolExecutor.java:628)\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n        at java.lang.Thread.run(java.base@11.0.14-ga/Thread.java:829)\n\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21480",
                "createdAt": "2023-10-31T04:31:19Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Fix print error log 'Auto getting partitions failed' when expend partition.",
        "url": "https://github.com/apache/pulsar/pull/21485",
        "resourcePath": "/apache/pulsar/pull/21485",
        "createdAt": "2023-10-31T08:57:22Z",
        "number": 21485,
        "mergeCommit": {
          "oid": "08067451c0dc5e22d319c003d1834681422a03c2",
          "message": "[fix][client] Fix print error log 'Auto getting partitions failed' when expend partition. (#21485)",
          "commitUrl": "https://github.com/apache/pulsar/commit/08067451c0dc5e22d319c003d1834681422a03c2",
          "parents": {
            "nodes": [
              {
                "oid": "77cd942f51ea0fecdcae789504a2f5987b79a813",
                "message": "[fix][test] Fix that some test cases are not running as expected on CI (#21532)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PartitionedProducerImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5eNINh2gAoZDkyOTE5ZDZjMWE1OTMyYWYzMGJkOGFlNWU3NjYyNDQyNjE4NjIyOQ",
                "url": "https://github.com/apache/pulsar/pull/21485/commits/d92919d6c1a5932af30bd8ae5e76624426186229"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21484,
                "url": "https://github.com/apache/pulsar/issues/21484",
                "title": "[Bug][client] Print error log 'Auto getting partitions failed' when expend partition.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.9.2 and above versions</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">1\u3001Create a single-partition topic [test-tenant/test-ns/test-topic]</p>\n<p dir=\"auto\">2\u3001Create a producer on partitioned-topic [test-tenant/test-ns/test-topic]</p>\n<p dir=\"auto\">3\u3001Expand the number of partitions of the topic to 2.</p>\n<p dir=\"auto\">4\u3001Wait for some time, we will encounter the following error log in producer log.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/16524922/279296209-959a0cde-80a2-4036-a077-191ce0f947b8.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzI5MTIsIm5iZiI6MTcxNDk3MjYxMiwicGF0aCI6Ii8xNjUyNDkyMi8yNzkyOTYyMDktOTU5YTBjZGUtODBhMi00MDM2LWEwNzctMTkxY2UwZjk0N2I4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MTY1MlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWIzMWUwY2NmY2QyYjg4NDMwNWM4NDYyZDNjNTRhYTlkY2RjM2EwOTJjOGQ2NjE2MjAxNGE3ODlmYWJlZWVjZjEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.6pBlu8HmzCpJ3WhIuQdsm6ekaq9pAwIinYeCSzbWDSQ\"><img src=\"https://private-user-images.githubusercontent.com/16524922/279296209-959a0cde-80a2-4036-a077-191ce0f947b8.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzI5MTIsIm5iZiI6MTcxNDk3MjYxMiwicGF0aCI6Ii8xNjUyNDkyMi8yNzkyOTYyMDktOTU5YTBjZGUtODBhMi00MDM2LWEwNzctMTkxY2UwZjk0N2I4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MTY1MlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWIzMWUwY2NmY2QyYjg4NDMwNWM4NDYyZDNjNTRhYTlkY2RjM2EwOTJjOGQ2NjE2MjAxNGE3ODlmYWJlZWVjZjEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.6pBlu8HmzCpJ3WhIuQdsm6ekaq9pAwIinYeCSzbWDSQ\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">No error log.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Print error log 'Auto getting partitions failed'</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">Just print error log, but does not affect client normal</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21484",
                "createdAt": "2023-10-31T07:50:30Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "Create a producerName field for DeadLetterPolicy",
        "url": "https://github.com/apache/pulsar/pull/21493",
        "resourcePath": "/apache/pulsar/pull/21493",
        "createdAt": "2023-11-01T03:40:35Z",
        "number": 21493,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/DeadLetterTopicTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/DeadLetterPolicy.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5eS4jA2gAoMjBhZTZmNjQzZGEwYzQyMzU2NDc1NjdhYmJiMDk2YzE0YWNiNWVkMA",
                "url": "https://github.com/apache/pulsar/pull/21493/commits/20ae6f643da0c4235647567abbb096c14acb5ed0"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21441,
                "url": "https://github.com/apache/pulsar/issues/21441",
                "title": "DeadLetterPolicy supports specifying producerName",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">The current <code class=\"notranslate\">DeadLetterProducerName</code> is generated randomly, and It is difficult to query related logs by producerName.</p>\n<h3 dir=\"auto\">Solution</h3>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"public class DeadLetterPolicy {\n\n\t...\n\tprivate String producerName;\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-smi\">DeadLetterPolicy</span> {\n\n\t...\n\t<span class=\"pl-k\">private</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">producerName</span>;\n}</pre></div>\n<p dir=\"auto\">Add a new field <code class=\"notranslate\">producerName</code> in <code class=\"notranslate\">DeadLetterPolicy</code> class.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21441",
                "createdAt": "2023-10-25T07:53:58Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][txn] OpRequestSend reuse problem cause tbClient commitTxnOnTopic timeout unexpectedly",
        "url": "https://github.com/apache/pulsar/pull/21505",
        "resourcePath": "/apache/pulsar/pull/21505",
        "createdAt": "2023-11-02T06:52:58Z",
        "number": 21505,
        "mergeCommit": {
          "oid": "f3f5fbc27391e13ab76b0f2265f51ac3a5c0a90c",
          "message": "[fix][txn] OpRequestSend reuse problem cause tbClient commitTxnOnTopic timeout unexpectedly (#21505)\n\nCo-authored-by: fanjianye <fanjianye@bigo.sg>",
          "commitUrl": "https://github.com/apache/pulsar/commit/f3f5fbc27391e13ab76b0f2265f51ac3a5c0a90c",
          "parents": {
            "nodes": [
              {
                "oid": "d47637f70ebadcad2e87d45ea14d1ccbe01e1a8d",
                "message": "[fix][test] Fixed too short wait in ResourceGroupRateLimiterTest (#21509)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/impl/TransactionBufferHandlerImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5eZlyX2gAoOTIyZWI3ODQwOGM2OGVjMzJiNTBjY2U1MjZlMmI1MGZlMDg2MWY0NQ",
                "url": "https://github.com/apache/pulsar/pull/21505/commits/922eb78408c68ec32b50cce526e2b50fe0861f45"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21504,
                "url": "https://github.com/apache/pulsar/issues/21504",
                "title": "[Bug][txn] OpRequestSend reuse problem cause tbClient commitTxnOnTopic timeout unexpectedly",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">pulsar version: 2.9.5 (guess master branch also has this problem)</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">when enableTransaction, see that metric pulsar_txn_tb_client_commit_failed is not 0. tbClient commit timeout occur in pulsar log.</p>\n<p dir=\"auto\">However, tbClient commit latency is low, it should not cause tbClient timeout.</p>\n<p dir=\"auto\">transactionBufferClientOperationTimeoutInMills is set as 10 second.</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/13505225/279885986-884062a5-e6b6-44f9-89d8-54be94c96664.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzI5NDAsIm5iZiI6MTcxNDk3MjY0MCwicGF0aCI6Ii8xMzUwNTIyNS8yNzk4ODU5ODYtODg0MDYyYTUtZTZiNi00NGY5LTg5ZDgtNTRiZTk0Yzk2NjY0LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MTcyMFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTE1Zjg5MGUwMWM0ZTNhZjFjYTVlNDc0NTJhNTUwOWUxZGYxZmRjZDQzZDc1MDY3N2Q4OWMzMjg0NTBhZTRkYTkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.VcPudjRiPmMDYoB53J0LBn4LNyDFBIevKh6LovyrRdg\"><img src=\"https://private-user-images.githubusercontent.com/13505225/279885986-884062a5-e6b6-44f9-89d8-54be94c96664.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzI5NDAsIm5iZiI6MTcxNDk3MjY0MCwicGF0aCI6Ii8xMzUwNTIyNS8yNzk4ODU5ODYtODg0MDYyYTUtZTZiNi00NGY5LTg5ZDgtNTRiZTk0Yzk2NjY0LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MTcyMFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTE1Zjg5MGUwMWM0ZTNhZjFjYTVlNDc0NTJhNTUwOWUxZGYxZmRjZDQzZDc1MDY3N2Q4OWMzMjg0NTBhZTRkYTkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.VcPudjRiPmMDYoB53J0LBn4LNyDFBIevKh6LovyrRdg\" alt=\"\u4f01\u4e1a\u5fae\u4fe1\u622a\u56fe_3c130d64-35a0-458c-8dd6-354fdec2aa53\" style=\"max-width: 100%;\"></a><br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/13505225/279886065-8b774f02-8aa1-487f-aca5-36d5f76b1f52.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzI5NDAsIm5iZiI6MTcxNDk3MjY0MCwicGF0aCI6Ii8xMzUwNTIyNS8yNzk4ODYwNjUtOGI3NzRmMDItOGFhMS00ODdmLWFjYTUtMzZkNWY3NmIxZjUyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MTcyMFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWRlNDViNTg4NDkyYjI3OGI3MmIyNmYzZTE4MDNiZmI3N2ZjZjE5YmIxN2U4ZDNkYjU2ZGIxZjlkZjFkYTdkZDEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.j2N-490JF2F8JSR9Rm7Sb662hsHZAshf7yCCc0tPmmU\"><img src=\"https://private-user-images.githubusercontent.com/13505225/279886065-8b774f02-8aa1-487f-aca5-36d5f76b1f52.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzI5NDAsIm5iZiI6MTcxNDk3MjY0MCwicGF0aCI6Ii8xMzUwNTIyNS8yNzk4ODYwNjUtOGI3NzRmMDItOGFhMS00ODdmLWFjYTUtMzZkNWY3NmIxZjUyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MTcyMFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWRlNDViNTg4NDkyYjI3OGI3MmIyNmYzZTE4MDNiZmI3N2ZjZjE5YmIxN2U4ZDNkYjU2ZGIxZjlkZjFkYTdkZDEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.j2N-490JF2F8JSR9Rm7Sb662hsHZAshf7yCCc0tPmmU\" alt=\"\u4f01\u4e1a\u5fae\u4fe1\u622a\u56fe_b3ef38d0-381f-4849-b29e-bf4a229313f5\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">We add some log in pulsar, find that in the TransactionBufferHandlerImpl#timer's timeout task, OpRequestSend acquired from the outstandingRequests is not correct.</p>\n<p dir=\"auto\">The reason is OpRequestSend reuse problem. OpRequestSend is managed by netty recycler. When endTxnOnTopic is requested in TransactionBufferHandlerImpl, it would get OpRequestSend from netty pool. And when the request finish in handleEndTxnOnTopicResponse or request is timeout in transactionTimer, it would recycle OpRequestSend.</p>\n<p dir=\"auto\">If there are multiple endTxnOnTopic request, they may reuse the same OpRequestSend. Therefore, the previous timeout task trigger after 10 second, and then get the newest OpRequestSend from outstandingRequests. Since the OpRequestSend.requestId has been modified, OpRequestSend is not the previous one, so it cause this error.</p>\n<p dir=\"auto\">The relevant code is:<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/40f94d5710f66132926f301606a74d24b1098877/pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/impl/TransactionBufferHandlerImpl.java#L134-L166\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/impl/TransactionBufferHandlerImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 134 to 166\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/40f94d5710f66132926f301606a74d24b1098877\">40f94d5</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L134\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"134\"></td>\n          <td id=\"LC134\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">endTxn</span>(<span class=\"pl-smi\">OpRequestSend</span> <span class=\"pl-s1\">op</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L135\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"135\"></td>\n          <td id=\"LC135\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">op</span>.<span class=\"pl-s1\">cnx</span>.<span class=\"pl-en\">whenComplete</span>((<span class=\"pl-s1\">clientCnx</span>, <span class=\"pl-s1\">ex</span>) -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L136\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"136\"></td>\n          <td id=\"LC136\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">ex</span> == <span class=\"pl-c1\">null</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L137\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"137\"></td>\n          <td id=\"LC137\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">clientCnx</span>.<span class=\"pl-en\">ctx</span>().<span class=\"pl-en\">channel</span>().<span class=\"pl-en\">isActive</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L138\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"138\"></td>\n          <td id=\"LC138\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">clientCnx</span>.<span class=\"pl-en\">registerTransactionBufferHandler</span>(<span class=\"pl-smi\">TransactionBufferHandlerImpl</span>.<span class=\"pl-smi\">this</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L139\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"139\"></td>\n          <td id=\"LC139\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">outstandingRequests</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s1\">op</span>.<span class=\"pl-s1\">requestId</span>, <span class=\"pl-s1\">op</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L140\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"140\"></td>\n          <td id=\"LC140\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">timer</span>.<span class=\"pl-en\">newTimeout</span>(<span class=\"pl-s1\">timeout</span> -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L141\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"141\"></td>\n          <td id=\"LC141\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-smi\">OpRequestSend</span> <span class=\"pl-s1\">peek</span> = <span class=\"pl-s1\">outstandingRequests</span>.<span class=\"pl-en\">remove</span>(<span class=\"pl-s1\">op</span>.<span class=\"pl-s1\">requestId</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L142\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"142\"></td>\n          <td id=\"LC142\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">peek</span> != <span class=\"pl-c1\">null</span> &amp;&amp; !<span class=\"pl-s1\">peek</span>.<span class=\"pl-s1\">cb</span>.<span class=\"pl-en\">isDone</span>() &amp;&amp; !<span class=\"pl-s1\">peek</span>.<span class=\"pl-s1\">cb</span>.<span class=\"pl-en\">isCompletedExceptionally</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L143\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"143\"></td>\n          <td id=\"LC143\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">peek</span>.<span class=\"pl-s1\">cb</span>.<span class=\"pl-en\">completeExceptionally</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">TransactionBufferClientException</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L144\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"144\"></td>\n          <td id=\"LC144\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                 .<span class=\"pl-smi\">RequestTimeoutException</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L145\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"145\"></td>\n          <td id=\"LC145\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-en\">onResponse</span>(<span class=\"pl-s1\">peek</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L146\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"146\"></td>\n          <td id=\"LC146\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L147\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"147\"></td>\n          <td id=\"LC147\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 }, <span class=\"pl-s1\">operationTimeoutInMills</span>, <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">MILLISECONDS</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L148\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"148\"></td>\n          <td id=\"LC148\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">op</span>.<span class=\"pl-s1\">cmd</span>.<span class=\"pl-en\">retain</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L149\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"149\"></td>\n          <td id=\"LC149\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">clientCnx</span>.<span class=\"pl-en\">ctx</span>().<span class=\"pl-en\">writeAndFlush</span>(<span class=\"pl-s1\">op</span>.<span class=\"pl-s1\">cmd</span>, <span class=\"pl-s1\">clientCnx</span>.<span class=\"pl-en\">ctx</span>().<span class=\"pl-en\">voidPromise</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L150\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"150\"></td>\n          <td id=\"LC150\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L151\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"151\"></td>\n          <td id=\"LC151\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">op</span>.<span class=\"pl-s1\">cb</span>.<span class=\"pl-en\">completeExceptionally</span>( </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L152\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"152\"></td>\n          <td id=\"LC152\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-k\">new</span> <span class=\"pl-smi\">PulsarClientException</span>.<span class=\"pl-smi\">LookupException</span>(<span class=\"pl-s1\">op</span>.<span class=\"pl-s1\">topic</span> + <span class=\"pl-s\">\" endTxn channel is not active\"</span>)); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L153\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"153\"></td>\n          <td id=\"LC153\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-en\">onResponse</span>(<span class=\"pl-s1\">op</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L154\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"154\"></td>\n          <td id=\"LC154\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L155\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"155\"></td>\n          <td id=\"LC155\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L156\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"156\"></td>\n          <td id=\"LC156\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-smi\">Throwable</span> <span class=\"pl-s1\">cause</span> = <span class=\"pl-smi\">FutureUtil</span>.<span class=\"pl-en\">unwrapCompletionException</span>(<span class=\"pl-s1\">ex</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L157\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"157\"></td>\n          <td id=\"LC157\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">error</span>(<span class=\"pl-s\">\"endTxn error topic: [{}]\"</span>, <span class=\"pl-s1\">op</span>.<span class=\"pl-s1\">topic</span>, <span class=\"pl-s1\">cause</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L158\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"158\"></td>\n          <td id=\"LC158\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">cause</span> <span class=\"pl-k\">instanceof</span> <span class=\"pl-smi\">PulsarClientException</span>.<span class=\"pl-smi\">BrokerMetadataException</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L159\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"159\"></td>\n          <td id=\"LC159\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">op</span>.<span class=\"pl-s1\">cb</span>.<span class=\"pl-en\">complete</span>(<span class=\"pl-c1\">null</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L160\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"160\"></td>\n          <td id=\"LC160\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L161\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"161\"></td>\n          <td id=\"LC161\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">op</span>.<span class=\"pl-s1\">cb</span>.<span class=\"pl-en\">completeExceptionally</span>( </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L162\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"162\"></td>\n          <td id=\"LC162\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-k\">new</span> <span class=\"pl-smi\">PulsarClientException</span>.<span class=\"pl-smi\">LookupException</span>(<span class=\"pl-s1\">cause</span>.<span class=\"pl-en\">getMessage</span>())); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L163\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"163\"></td>\n          <td id=\"LC163\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L164\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"164\"></td>\n          <td id=\"LC164\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-en\">onResponse</span>(<span class=\"pl-s1\">op</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L165\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"165\"></td>\n          <td id=\"LC165\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L166\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"166\"></td>\n          <td id=\"LC166\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     }); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">TransactionBufferHandlerImpl#timer get the right OpRequestSend in timeout task</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">TransactionBufferHandlerImpl#timer get the error OpRequestSend in timeout task</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21504",
                "createdAt": "2023-11-02T06:43:57Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fixed too short wait in ResourceGroupRateLimiterTest",
        "url": "https://github.com/apache/pulsar/pull/21509",
        "resourcePath": "/apache/pulsar/pull/21509",
        "createdAt": "2023-11-03T01:21:24Z",
        "number": 21509,
        "mergeCommit": {
          "oid": "d47637f70ebadcad2e87d45ea14d1ccbe01e1a8d",
          "message": "[fix][test] Fixed too short wait in ResourceGroupRateLimiterTest (#21509)",
          "commitUrl": "https://github.com/apache/pulsar/commit/d47637f70ebadcad2e87d45ea14d1ccbe01e1a8d",
          "parents": {
            "nodes": [
              {
                "oid": "78fc853fc5291ab65b78613d662785a210cafa91",
                "message": "[fix] [build] Unified the version of the library org.checkerframework (#21503)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/resourcegroup/ResourceGroupRateLimiterTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5efSjo2gAoMDE5MTlkYjZjMTQ0ZjdhMTRkODM3ZjFkZjBiYTAyZGJmMDkzNTY4OQ",
                "url": "https://github.com/apache/pulsar/pull/21509/commits/01919db6c144f7a14d837f1df0ba02dbf0935689"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20385,
                "url": "https://github.com/apache/pulsar/issues/20385",
                "title": "Flaky-test: ResourceGroupRateLimiterTest.testResourceGroupPublishRateLimit",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/5067587816/jobs/9099067011?pr=20384#step:10:1264\">https://github.com/apache/pulsar/actions/runs/5067587816/jobs/9099067011?pr=20384#step:10:1264</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 6, Failures: 1, Errors: 0, Skipped: 5, Time elapsed: 21.799 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.resourcegroup.ResourceGroupRateLimiterTest\n  Error:  org.apache.pulsar.broker.resourcegroup.ResourceGroupRateLimiterTest.testResourceGroupPublishRateLimit  Time elapsed: 7.051 s  &lt;&lt;&lt; FAILURE!\n  org.awaitility.core.ConditionTimeoutException: Assertion condition defined as a org.apache.pulsar.broker.resourcegroup.ResourceGroupRateLimiterTest expected [null] but found [org.apache.pulsar.broker.resourcegroup.ResourceGroup@464bf589] within 1 seconds.\n  \tat org.awaitility.core.ConditionAwaiter.await(ConditionAwaiter.java:167)\n  \tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:119)\n  \tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:31)\n  \tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:985)\n  \tat org.awaitility.core.ConditionFactory.untilAsserted(ConditionFactory.java:769)\n  \tat org.apache.pulsar.broker.resourcegroup.ResourceGroupRateLimiterTest.deleteResourceGroup(ResourceGroupRateLimiterTest.java:80)\n  \tat org.apache.pulsar.broker.resourcegroup.ResourceGroupRateLimiterTest.testRateLimit(ResourceGroupRateLimiterTest.java:134)\n  \tat org.apache.pulsar.broker.resourcegroup.ResourceGroupRateLimiterTest.testResourceGroupPublishRateLimit(ResourceGroupRateLimiterTest.java:147)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: java.lang.AssertionError: expected [null] but found [org.apache.pulsar.broker.resourcegroup.ResourceGroup@464bf589]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotSame(Assert.java:1573)\n  \tat org.testng.Assert.assertNull(Assert.java:1506)\n  \tat org.testng.Assert.assertNull(Assert.java:1494)\n  \tat org.apache.pulsar.broker.resourcegroup.ResourceGroupRateLimiterTest.lambda$deleteResourceGroup$1(ResourceGroupRateLimiterTest.java:80)\n  \tat org.awaitility.core.AssertionCondition.lambda$new$0(AssertionCondition.java:53)\n  \tat org.awaitility.core.ConditionAwaiter$ConditionPoller.call(ConditionAwaiter.java:248)\n  \tat org.awaitility.core.ConditionAwaiter$ConditionPoller.call(ConditionAwaiter.java:235)\n  \t... 4 more\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 6, Failures: 1, Errors: 0, Skipped: 5, Time elapsed: 21.799 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.resourcegroup.ResourceGroupRateLimiterTest\n  Error:  org.apache.pulsar.broker.resourcegroup.ResourceGroupRateLimiterTest.testResourceGroupPublishRateLimit  Time elapsed: 7.051 s  &lt;&lt;&lt; FAILURE!\n  org.awaitility.core.ConditionTimeoutException: Assertion condition defined as a org.apache.pulsar.broker.resourcegroup.ResourceGroupRateLimiterTest expected [null] but found [org.apache.pulsar.broker.resourcegroup.ResourceGroup@464bf589] within 1 seconds.\n  \tat org.awaitility.core.ConditionAwaiter.await(ConditionAwaiter.java:167)\n  \tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:119)\n  \tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:31)\n  \tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:985)\n  \tat org.awaitility.core.ConditionFactory.untilAsserted(ConditionFactory.java:769)\n  \tat org.apache.pulsar.broker.resourcegroup.ResourceGroupRateLimiterTest.deleteResourceGroup(ResourceGroupRateLimiterTest.java:80)\n  \tat org.apache.pulsar.broker.resourcegroup.ResourceGroupRateLimiterTest.testRateLimit(ResourceGroupRateLimiterTest.java:134)\n  \tat org.apache.pulsar.broker.resourcegroup.ResourceGroupRateLimiterTest.testResourceGroupPublishRateLimit(ResourceGroupRateLimiterTest.java:147)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:833)\n  Caused by: java.lang.AssertionError: expected [null] but found [org.apache.pulsar.broker.resourcegroup.ResourceGroup@464bf589]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotSame(Assert.java:1573)\n  \tat org.testng.Assert.assertNull(Assert.java:1506)\n  \tat org.testng.Assert.assertNull(Assert.java:1494)\n  \tat org.apache.pulsar.broker.resourcegroup.ResourceGroupRateLimiterTest.lambda$deleteResourceGroup$1(ResourceGroupRateLimiterTest.java:80)\n  \tat org.awaitility.core.AssertionCondition.lambda$new$0(AssertionCondition.java:53)\n  \tat org.awaitility.core.ConditionAwaiter$ConditionPoller.call(ConditionAwaiter.java:248)\n  \tat org.awaitility.core.ConditionAwaiter$ConditionPoller.call(ConditionAwaiter.java:235)\n  \t... 4 more\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20385",
                "createdAt": "2023-05-24T11:17:16Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix setReplicatedSubscriptionStatus incorrect behavior",
        "url": "https://github.com/apache/pulsar/pull/21510",
        "resourcePath": "/apache/pulsar/pull/21510",
        "createdAt": "2023-11-03T01:34:00Z",
        "number": 21510,
        "mergeCommit": {
          "oid": "b949187e64638c231216a7220e4b93dff51ca3c5",
          "message": "[fix][broker] Fix setReplicatedSubscriptionStatus incorrect behavior (#21510)",
          "commitUrl": "https://github.com/apache/pulsar/commit/b949187e64638c231216a7220e4b93dff51ca3c5",
          "parents": {
            "nodes": [
              {
                "oid": "ea1fc0f20138bc35f54f55d32dabf3c3a3309c8e",
                "message": "[fix] [broker] Fix thousands orphan PersistentTopic caused OOM (#21540)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentSubscription.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/ReplicatorSubscriptionTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/ReplicatorTestBase.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5efUiI2gAoOWFhMTBjYWFkNjY5OWIyNjcxZWU5MGYxYjJlM2QzODAxM2RhNTdhMg",
                "url": "https://github.com/apache/pulsar/pull/21510/commits/9aa10caad6699b2671ee90f1b2e3d38013da57a2"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21506,
                "url": "https://github.com/apache/pulsar/issues/21506",
                "title": "[Bug] when unenable enableReplicatedSubscriptions, admin#setReplicatedSubscriptionStatus Incorrect behavior",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">pulsar version: 2.10.4</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Set<code class=\"notranslate\"> enableReplicatedSubscriptions=false</code> in the broker.conf file of Cluster A.</li>\n<li>Enable replication of Topic1 from Cluster A to Cluster B using the GEO feature. Please refer to the official documentation for specific configuration details.</li>\n<li>Produce and consume messages on Topic1 in Cluster A.</li>\n<li>Modify the subscription replication of Topic1 in Cluster A.</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-admin topics set-replicated-subscription-status --enable -s sub geo1\n# no errors\nbin/pulsar-admin topics get-replicated-subscription-status  -s sub geo1\npersistent://public/default/geo1-partition-1    false\npersistent://public/default/geo1-partition-0    false\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-admin topics set-replicated-subscription-status --enable -s sub geo1\n# no errors\nbin/pulsar-admin topics get-replicated-subscription-status  -s sub geo1\npersistent://public/default/geo1-partition-1    false\npersistent://public/default/geo1-partition-0    false\n</code></pre></div>\n<ol start=\"5\" dir=\"auto\">\n<li>As you can see, the configuration and viewing results are inconsistent.</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\"><code class=\"notranslate\">bin/pulsar-admin topics set-replicated-subscription-status --enable -s sub geo1</code> should throw an exception.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The configuration and viewing results are inconsistent.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21506",
                "createdAt": "2023-11-02T11:03:33Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix topic compaction is failed after compactedLedger's all quorum is being recover",
        "url": "https://github.com/apache/pulsar/pull/21552",
        "resourcePath": "/apache/pulsar/pull/21552",
        "createdAt": "2023-11-10T03:36:19Z",
        "number": 21552,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/compaction/CompactedTopicImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/compaction/CompactedTopicTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5fGMsr2gAoYzY0MDNjZTNkMjIzOWE1ODFmNTIxN2JiYWRhMzkyYzU1MjM3MzJhYg",
                "url": "https://github.com/apache/pulsar/pull/21552/commits/c6403ce3d2239a581f5217bbada392c5523732ab"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21551,
                "url": "https://github.com/apache/pulsar/issues/21551",
                "title": "[Bug][broker] topic compaction is failed after compactedLedger 3 quorum all being recover in bookie autoRecovery",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">branch-2.9 (guess master branch also have this problem)</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">reproduce step:</p>\n<ol dir=\"auto\">\n<li>__change_event policy topic, with compactedLedger 1705537, which has 3 quorum on bookie-1,bookie-2,bookie-3</li>\n<li>bookie-1,2,3 are shutdown one by one, trigger bookie autoRecovery</li>\n<li>compactedLedger 1705537 quorum become bookie-4,bookie-5,bookie-6</li>\n<li>use pulsar-admin api to setMessageTTL, trigger write message to __change_event topic</li>\n<li>broker log have many errors, show that compaction trigger in BrokerService#checkCompaction() is always failed</li>\n</ol>\n<p dir=\"auto\">The error log is as following:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"14:49:15.197 [compaction-76-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/__change_events-partition-2][__compaction] Get topic last message Id\n14:49:15.197 [broker-topic-workers-OrderedExecutor-1-0] ERROR org.apache.bookkeeper.proto.PerChannelBookieClient - Could not connect to bookie: null/bookie-1, current state CONNECTING : \norg.apache.bookkeeper.proto.BookieAddressResolver$BookieIdNotResolvedException: Cannot resolve bookieId bookie-1, bookie does not exist or it is not running\n        at org.apache.bookkeeper.client.DefaultBookieAddressResolver.resolve(DefaultBookieAddressResolver.java:67) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.proto.PerChannelBookieClient.connect(PerChannelBookieClient.java:531) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.proto.PerChannelBookieClient.connectIfNeededAndDoOp(PerChannelBookieClient.java:657) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.proto.DefaultPerChannelBookieClientPool.obtain(DefaultPerChannelBookieClientPool.java:121) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.proto.DefaultPerChannelBookieClientPool.obtain(DefaultPerChannelBookieClientPool.java:116) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.proto.BookieClientImpl.readEntry(BookieClientImpl.java:509) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.proto.BookieClientImpl.readEntry(BookieClientImpl.java:495) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.proto.BookieClientImpl.readEntry(BookieClientImpl.java:489) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.PendingReadOp.sendReadTo(PendingReadOp.java:576) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest.sendNextRead(PendingReadOp.java:405) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest.read(PendingReadOp.java:386) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.PendingReadOp.initiate(PendingReadOp.java:530) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.PendingReadOp.safeRun(PendingReadOp.java:540) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) ~[org.apache.bookkeeper-bookkeeper-common-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.LedgerHandle.readEntriesInternalAsync(LedgerHandle.java:896) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.LedgerHandle.asyncReadEntriesInternal(LedgerHandle.java:800) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.LedgerHandle.asyncReadEntries(LedgerHandle.java:694) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.pulsar.compaction.CompactedTopicImpl.readOneMessageId(CompactedTopicImpl.java:224) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at org.apache.pulsar.compaction.CompactedTopicImpl.lambda$createCache$7(CompactedTopicImpl.java:215) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at com.github.benmanes.caffeine.cache.LocalAsyncCache.lambda$get$2(LocalAsyncCache.java:92) ~[com.github.ben-manes.caffeine-caffeine-2.9.1.jar:?]\n        at com.github.benmanes.caffeine.cache.BoundedLocalCache.lambda$doComputeIfAbsent$14(BoundedLocalCache.java:2405) ~[com.github.ben-manes.caffeine-caffeine-2.9.1.jar:?]\n        at java.util.concurrent.ConcurrentHashMap.compute(ConcurrentHashMap.java:1908) ~[?:?]\n        at com.github.benmanes.caffeine.cache.BoundedLocalCache.doComputeIfAbsent(BoundedLocalCache.java:2403) ~[com.github.ben-manes.caffeine-caffeine-2.9.1.jar:?]\n        at com.github.benmanes.caffeine.cache.BoundedLocalCache.computeIfAbsent(BoundedLocalCache.java:2386) ~[com.github.ben-manes.caffeine-caffeine-2.9.1.jar:?]\n        at com.github.benmanes.caffeine.cache.LocalAsyncCache.get(LocalAsyncCache.java:91) ~[com.github.ben-manes.caffeine-caffeine-2.9.1.jar:?]\n        at com.github.benmanes.caffeine.cache.LocalAsyncCache.get(LocalAsyncCache.java:82) ~[com.github.ben-manes.caffeine-caffeine-2.9.1.jar:?]\n        at com.github.benmanes.caffeine.cache.LocalAsyncLoadingCache.get(LocalAsyncLoadingCache.java:79) ~[com.github.ben-manes.caffeine-caffeine-2.9.1.jar:?]\n        at org.apache.pulsar.compaction.CompactedTopicImpl.findStartPointLoop(CompactedTopicImpl.java:189) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at org.apache.pulsar.compaction.CompactedTopicImpl.findStartPoint(CompactedTopicImpl.java:179) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at org.apache.pulsar.compaction.CompactedTopicImpl.lambda$asyncReadEntriesOrWait$3(CompactedTopicImpl.java:106) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1106) ~[?:?]\n        at java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2235) ~[?:?]\n        at org.apache.pulsar.compaction.CompactedTopicImpl.asyncReadEntriesOrWait(CompactedTopicImpl.java:105) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at org.apache.pulsar.broker.service.persistent.PersistentDispatcherSingleActiveConsumer.readMoreEntries(PersistentDispatcherSingleActiveConsumer.java:343) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at org.apache.pulsar.broker.service.persistent.PersistentDispatcherSingleActiveConsumer.internalConsumerFlow(PersistentDispatcherSingleActiveConsumer.java:280) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at org.apache.pulsar.broker.service.persistent.PersistentDispatcherSingleActiveConsumer.lambda$consumerFlow$5(PersistentDispatcherSingleActiveConsumer.java:256) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at org.apache.bookkeeper.mledger.util.SafeRun$1.safeRun(SafeRun.java:32) ~[org.apache.pulsar-managed-ledger-2.9.5.4.jar:2.9.5.4]\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) ~[org.apache.bookkeeper-bookkeeper-common-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.common.util.OrderedExecutor$TimedRunnable.run(OrderedExecutor.java:204) ~[org.apache.bookkeeper-bookkeeper-common-4.14.1.jar:4.14.1]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.66.Final.jar:4.1.66.Final]\n        at java.lang.Thread.run(Thread.java:834) ~[?:?]\nCaused by: org.apache.bookkeeper.client.BKException$BKBookieHandleNotAvailableException: Bookie handle is not available\n        at org.apache.bookkeeper.discover.ZKRegistrationClient.getBookieServiceInfo(ZKRegistrationClient.java:248) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.DefaultBookieAddressResolver.resolve(DefaultBookieAddressResolver.java:47) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        ... 42 more\n14:49:15.198 [BookKeeperClientWorker-OrderedExecutor-1-0] ERROR org.apache.bookkeeper.client.PendingReadOp - Read of ledger entry failed: L1705537 E0-E0, Sent to [bookie-1, bookie-2, bookie-3], Heard from [] : bitset = {}, Error = 'Bookie handle is not available'. First unread entry is (-1, rc = null)\n14:49:15.199 [broker-topic-workers-OrderedExecutor-1-0] ERROR org.apache.pulsar.broker.service.persistent.PersistentDispatcherSingleActiveConsumer - [persistent://public/default/__change_events-partition-2 / __compaction-Consumer{subscription=CompactorSubscription{topic=persistent://public/default/__change_events-partition-2, name=__compaction}, consumerId=1011, consumerName=1bdee, address=/xxx}] Error reading entries at 1705285:48 : java.util.concurrent.CompletionException: org.apache.bookkeeper.client.BKException$BKBookieHandleNotAvailableException: Bookie handle is not available - Retrying to read in 54.759 seconds\n14:49:15.199 [pulsar-io-32-26] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/__change_events-partition-2][__compaction] Successfully getLastMessageId 1705285:48\n14:49:15.199 [pulsar-io-32-26] INFO  org.apache.pulsar.compaction.TwoPhaseCompactor - Commencing phase one of compaction for persistent://public/default/__change_events-partition-2, reading to 1705285:48:2\"><pre class=\"notranslate\"><code class=\"notranslate\">14:49:15.197 [compaction-76-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/__change_events-partition-2][__compaction] Get topic last message Id\n14:49:15.197 [broker-topic-workers-OrderedExecutor-1-0] ERROR org.apache.bookkeeper.proto.PerChannelBookieClient - Could not connect to bookie: null/bookie-1, current state CONNECTING : \norg.apache.bookkeeper.proto.BookieAddressResolver$BookieIdNotResolvedException: Cannot resolve bookieId bookie-1, bookie does not exist or it is not running\n        at org.apache.bookkeeper.client.DefaultBookieAddressResolver.resolve(DefaultBookieAddressResolver.java:67) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.proto.PerChannelBookieClient.connect(PerChannelBookieClient.java:531) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.proto.PerChannelBookieClient.connectIfNeededAndDoOp(PerChannelBookieClient.java:657) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.proto.DefaultPerChannelBookieClientPool.obtain(DefaultPerChannelBookieClientPool.java:121) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.proto.DefaultPerChannelBookieClientPool.obtain(DefaultPerChannelBookieClientPool.java:116) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.proto.BookieClientImpl.readEntry(BookieClientImpl.java:509) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.proto.BookieClientImpl.readEntry(BookieClientImpl.java:495) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.proto.BookieClientImpl.readEntry(BookieClientImpl.java:489) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.PendingReadOp.sendReadTo(PendingReadOp.java:576) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest.sendNextRead(PendingReadOp.java:405) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest.read(PendingReadOp.java:386) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.PendingReadOp.initiate(PendingReadOp.java:530) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.PendingReadOp.safeRun(PendingReadOp.java:540) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) ~[org.apache.bookkeeper-bookkeeper-common-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.LedgerHandle.readEntriesInternalAsync(LedgerHandle.java:896) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.LedgerHandle.asyncReadEntriesInternal(LedgerHandle.java:800) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.LedgerHandle.asyncReadEntries(LedgerHandle.java:694) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.pulsar.compaction.CompactedTopicImpl.readOneMessageId(CompactedTopicImpl.java:224) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at org.apache.pulsar.compaction.CompactedTopicImpl.lambda$createCache$7(CompactedTopicImpl.java:215) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at com.github.benmanes.caffeine.cache.LocalAsyncCache.lambda$get$2(LocalAsyncCache.java:92) ~[com.github.ben-manes.caffeine-caffeine-2.9.1.jar:?]\n        at com.github.benmanes.caffeine.cache.BoundedLocalCache.lambda$doComputeIfAbsent$14(BoundedLocalCache.java:2405) ~[com.github.ben-manes.caffeine-caffeine-2.9.1.jar:?]\n        at java.util.concurrent.ConcurrentHashMap.compute(ConcurrentHashMap.java:1908) ~[?:?]\n        at com.github.benmanes.caffeine.cache.BoundedLocalCache.doComputeIfAbsent(BoundedLocalCache.java:2403) ~[com.github.ben-manes.caffeine-caffeine-2.9.1.jar:?]\n        at com.github.benmanes.caffeine.cache.BoundedLocalCache.computeIfAbsent(BoundedLocalCache.java:2386) ~[com.github.ben-manes.caffeine-caffeine-2.9.1.jar:?]\n        at com.github.benmanes.caffeine.cache.LocalAsyncCache.get(LocalAsyncCache.java:91) ~[com.github.ben-manes.caffeine-caffeine-2.9.1.jar:?]\n        at com.github.benmanes.caffeine.cache.LocalAsyncCache.get(LocalAsyncCache.java:82) ~[com.github.ben-manes.caffeine-caffeine-2.9.1.jar:?]\n        at com.github.benmanes.caffeine.cache.LocalAsyncLoadingCache.get(LocalAsyncLoadingCache.java:79) ~[com.github.ben-manes.caffeine-caffeine-2.9.1.jar:?]\n        at org.apache.pulsar.compaction.CompactedTopicImpl.findStartPointLoop(CompactedTopicImpl.java:189) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at org.apache.pulsar.compaction.CompactedTopicImpl.findStartPoint(CompactedTopicImpl.java:179) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at org.apache.pulsar.compaction.CompactedTopicImpl.lambda$asyncReadEntriesOrWait$3(CompactedTopicImpl.java:106) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1106) ~[?:?]\n        at java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2235) ~[?:?]\n        at org.apache.pulsar.compaction.CompactedTopicImpl.asyncReadEntriesOrWait(CompactedTopicImpl.java:105) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at org.apache.pulsar.broker.service.persistent.PersistentDispatcherSingleActiveConsumer.readMoreEntries(PersistentDispatcherSingleActiveConsumer.java:343) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at org.apache.pulsar.broker.service.persistent.PersistentDispatcherSingleActiveConsumer.internalConsumerFlow(PersistentDispatcherSingleActiveConsumer.java:280) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at org.apache.pulsar.broker.service.persistent.PersistentDispatcherSingleActiveConsumer.lambda$consumerFlow$5(PersistentDispatcherSingleActiveConsumer.java:256) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at org.apache.bookkeeper.mledger.util.SafeRun$1.safeRun(SafeRun.java:32) ~[org.apache.pulsar-managed-ledger-2.9.5.4.jar:2.9.5.4]\n        at org.apache.bookkeeper.common.util.SafeRunnable.run(SafeRunnable.java:36) ~[org.apache.bookkeeper-bookkeeper-common-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.common.util.OrderedExecutor$TimedRunnable.run(OrderedExecutor.java:204) ~[org.apache.bookkeeper-bookkeeper-common-4.14.1.jar:4.14.1]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.66.Final.jar:4.1.66.Final]\n        at java.lang.Thread.run(Thread.java:834) ~[?:?]\nCaused by: org.apache.bookkeeper.client.BKException$BKBookieHandleNotAvailableException: Bookie handle is not available\n        at org.apache.bookkeeper.discover.ZKRegistrationClient.getBookieServiceInfo(ZKRegistrationClient.java:248) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        at org.apache.bookkeeper.client.DefaultBookieAddressResolver.resolve(DefaultBookieAddressResolver.java:47) ~[org.apache.bookkeeper-bookkeeper-server-4.14.1.jar:4.14.1]\n        ... 42 more\n14:49:15.198 [BookKeeperClientWorker-OrderedExecutor-1-0] ERROR org.apache.bookkeeper.client.PendingReadOp - Read of ledger entry failed: L1705537 E0-E0, Sent to [bookie-1, bookie-2, bookie-3], Heard from [] : bitset = {}, Error = 'Bookie handle is not available'. First unread entry is (-1, rc = null)\n14:49:15.199 [broker-topic-workers-OrderedExecutor-1-0] ERROR org.apache.pulsar.broker.service.persistent.PersistentDispatcherSingleActiveConsumer - [persistent://public/default/__change_events-partition-2 / __compaction-Consumer{subscription=CompactorSubscription{topic=persistent://public/default/__change_events-partition-2, name=__compaction}, consumerId=1011, consumerName=1bdee, address=/xxx}] Error reading entries at 1705285:48 : java.util.concurrent.CompletionException: org.apache.bookkeeper.client.BKException$BKBookieHandleNotAvailableException: Bookie handle is not available - Retrying to read in 54.759 seconds\n14:49:15.199 [pulsar-io-32-26] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/__change_events-partition-2][__compaction] Successfully getLastMessageId 1705285:48\n14:49:15.199 [pulsar-io-32-26] INFO  org.apache.pulsar.compaction.TwoPhaseCompactor - Commencing phase one of compaction for persistent://public/default/__change_events-partition-2, reading to 1705285:48:2\n</code></pre></div>\n<p dir=\"auto\">We found that the reason is reading compacted ledger 1705537 failed in the process of TwoPhaseCompaction.</p>\n<p dir=\"auto\">When do TwoPhaseCompaction. The step is :</p>\n<ol dir=\"auto\">\n<li>judge topic has message by reader.hasMessageAvailableAsync()</li>\n<li>do phaseOne compact. During the process it would getLastMessageId and trigger phaseOneLoop()</li>\n<li>do phaseTwo compact. create new compactedLedger and compact all keys to compactedLedger. trigger phaseTwoSeekThenLoop()</li>\n</ol>\n<p dir=\"auto\">In the phaseOneLoop(), it would try to read message, trigger CompactedTopicImpl#asyncReadEntriesOrWait(). And then it would use compactedTopicContext to findStartPoint. compactedTopicContext is a local variable, containing ReadOnlyLedgerHandle and AsyncLoadingCache. compactedTopicContext is updated in the previous compaction, and then it would not change until the next compaction finish.</p>\n<p dir=\"auto\">Previous compaction make compactedTopicContext, 1705537 LedgerHandle's metadata is [bookie-1, bookie-2, bookie-3]. However, after bookie shutdown and do bookie autoRecovery, the 3 quorum on 1705537 has been changed to [bookie-4, bookie-5, bookie-6]. But the LedgerHandle's metadata in broker is not change. So it still try to read message of 1705537 from bookie-1,2,3 and fail, causing the compaction process can not success.</p>\n<p dir=\"auto\">The relevant code is:<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/51202a6889582117bf790e9ff2325b9f3119510f/pulsar-broker/src/main/java/org/apache/pulsar/compaction/CompactedTopicImpl.java#L76-L209\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/compaction/CompactedTopicImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 76 to 209\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/51202a6889582117bf790e9ff2325b9f3119510f\">51202a6</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L76\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"76\"></td>\n          <td id=\"LC76\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">public</span> <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">CompactedTopicContext</span>&gt; <span class=\"pl-en\">newCompactedLedger</span>(<span class=\"pl-smi\">Position</span> <span class=\"pl-s1\">p</span>, <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">compactedLedgerId</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L77\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"77\"></td>\n          <td id=\"LC77\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">synchronized</span> (<span class=\"pl-smi\">this</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L78\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"78\"></td>\n          <td id=\"LC78\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">CompactedTopicContext</span>&gt; <span class=\"pl-s1\">previousContext</span> = <span class=\"pl-s1\">compactedTopicContext</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L79\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"79\"></td>\n          <td id=\"LC79\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">compactedTopicContext</span> = <span class=\"pl-en\">openCompactedLedger</span>(<span class=\"pl-s1\">bk</span>, <span class=\"pl-s1\">compactedLedgerId</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L80\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"80\"></td>\n          <td id=\"LC80\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L81\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"81\"></td>\n          <td id=\"LC81\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">compactionHorizon</span> = (<span class=\"pl-smi\">PositionImpl</span>) <span class=\"pl-s1\">p</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L82\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"82\"></td>\n          <td id=\"LC82\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L83\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"83\"></td>\n          <td id=\"LC83\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-c\">// delete the ledger from the old context once the new one is open</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L84\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"84\"></td>\n          <td id=\"LC84\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">return</span> <span class=\"pl-s1\">compactedTopicContext</span>.<span class=\"pl-en\">thenCompose</span>( </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L85\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"85\"></td>\n          <td id=\"LC85\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">__</span> -&gt; <span class=\"pl-s1\">previousContext</span> != <span class=\"pl-c1\">null</span> ? <span class=\"pl-s1\">previousContext</span> : <span class=\"pl-smi\">CompletableFuture</span>.<span class=\"pl-en\">completedFuture</span>(<span class=\"pl-c1\">null</span>)); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L86\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"86\"></td>\n          <td id=\"LC86\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L87\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"87\"></td>\n          <td id=\"LC87\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L88\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"88\"></td>\n          <td id=\"LC88\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L89\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"89\"></td>\n          <td id=\"LC89\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Override</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L90\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"90\"></td>\n          <td id=\"LC90\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">public</span> <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Void</span>&gt; <span class=\"pl-en\">deleteCompactedLedger</span>(<span class=\"pl-smi\">long</span> <span class=\"pl-s1\">compactedLedgerId</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L91\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"91\"></td>\n          <td id=\"LC91\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-en\">tryDeleteCompactedLedger</span>(<span class=\"pl-s1\">bk</span>, <span class=\"pl-s1\">compactedLedgerId</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L92\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"92\"></td>\n          <td id=\"LC92\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L93\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"93\"></td>\n          <td id=\"LC93\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L94\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"94\"></td>\n          <td id=\"LC94\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Override</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L95\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"95\"></td>\n          <td id=\"LC95\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Deprecated</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L96\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"96\"></td>\n          <td id=\"LC96\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">asyncReadEntriesOrWait</span>(<span class=\"pl-smi\">ManagedCursor</span> <span class=\"pl-s1\">cursor</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L97\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"97\"></td>\n          <td id=\"LC97\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                    <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">maxEntries</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L98\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"98\"></td>\n          <td id=\"LC98\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                    <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">bytesToRead</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L99\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"99\"></td>\n          <td id=\"LC99\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                    <span class=\"pl-smi\">PositionImpl</span> <span class=\"pl-s1\">maxReadPosition</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L100\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"100\"></td>\n          <td id=\"LC100\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                    <span class=\"pl-smi\">boolean</span> <span class=\"pl-s1\">isFirstRead</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L101\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"101\"></td>\n          <td id=\"LC101\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                    <span class=\"pl-smi\">ReadEntriesCallback</span> <span class=\"pl-s1\">callback</span>, <span class=\"pl-smi\">Consumer</span> <span class=\"pl-s1\">consumer</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L102\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"102\"></td>\n          <td id=\"LC102\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-smi\">PositionImpl</span> <span class=\"pl-s1\">cursorPosition</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L103\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"103\"></td>\n          <td id=\"LC103\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">isFirstRead</span> &amp;&amp; <span class=\"pl-smi\">MessageId</span>.<span class=\"pl-s1\">earliest</span>.<span class=\"pl-en\">equals</span>(<span class=\"pl-s1\">consumer</span>.<span class=\"pl-en\">getStartMessageId</span>())){ </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L104\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"104\"></td>\n          <td id=\"LC104\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">cursorPosition</span> = <span class=\"pl-smi\">PositionImpl</span>.<span class=\"pl-c1\">EARLIEST</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L105\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"105\"></td>\n          <td id=\"LC105\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L106\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"106\"></td>\n          <td id=\"LC106\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">cursorPosition</span> = (<span class=\"pl-smi\">PositionImpl</span>) <span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">getReadPosition</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L107\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"107\"></td>\n          <td id=\"LC107\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L108\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"108\"></td>\n          <td id=\"LC108\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L109\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"109\"></td>\n          <td id=\"LC109\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-c\">// TODO: redeliver epoch link https://github.com/apache/pulsar/issues/13690</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L110\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"110\"></td>\n          <td id=\"LC110\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-smi\">ReadEntriesCtx</span> <span class=\"pl-s1\">readEntriesCtx</span> = <span class=\"pl-smi\">ReadEntriesCtx</span>.<span class=\"pl-en\">create</span>(<span class=\"pl-s1\">consumer</span>, <span class=\"pl-c1\">DEFAULT_CONSUMER_EPOCH</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L111\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"111\"></td>\n          <td id=\"LC111\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L112\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"112\"></td>\n          <td id=\"LC112\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">final</span> <span class=\"pl-smi\">PositionImpl</span> <span class=\"pl-s1\">currentCompactionHorizon</span> = <span class=\"pl-s1\">compactionHorizon</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L113\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"113\"></td>\n          <td id=\"LC113\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L114\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"114\"></td>\n          <td id=\"LC114\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">currentCompactionHorizon</span> == <span class=\"pl-c1\">null</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L115\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"115\"></td>\n          <td id=\"LC115\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             || <span class=\"pl-s1\">currentCompactionHorizon</span>.<span class=\"pl-en\">compareTo</span>(<span class=\"pl-s1\">cursorPosition</span>) &lt; <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L116\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"116\"></td>\n          <td id=\"LC116\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">asyncReadEntriesOrWait</span>(<span class=\"pl-s1\">maxEntries</span>, <span class=\"pl-s1\">bytesToRead</span>, <span class=\"pl-s1\">callback</span>, <span class=\"pl-s1\">readEntriesCtx</span>, <span class=\"pl-s1\">maxReadPosition</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L117\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"117\"></td>\n          <td id=\"LC117\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L118\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"118\"></td>\n          <td id=\"LC118\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-smi\">ManagedCursorImpl</span> <span class=\"pl-s1\">managedCursor</span> = (<span class=\"pl-smi\">ManagedCursorImpl</span>) <span class=\"pl-s1\">cursor</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L119\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"119\"></td>\n          <td id=\"LC119\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">numberOfEntriesToRead</span> = <span class=\"pl-s1\">managedCursor</span>.<span class=\"pl-en\">applyMaxSizeCap</span>(<span class=\"pl-s1\">maxEntries</span>, <span class=\"pl-s1\">bytesToRead</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L120\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"120\"></td>\n          <td id=\"LC120\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L121\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"121\"></td>\n          <td id=\"LC121\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">compactedTopicContext</span>.<span class=\"pl-en\">thenCompose</span>( </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L122\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"122\"></td>\n          <td id=\"LC122\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 (<span class=\"pl-s1\">context</span>) -&gt; <span class=\"pl-en\">findStartPoint</span>(<span class=\"pl-s1\">cursorPosition</span>, <span class=\"pl-s1\">context</span>.<span class=\"pl-s1\">ledger</span>.<span class=\"pl-en\">getLastAddConfirmed</span>(), <span class=\"pl-s1\">context</span>.<span class=\"pl-s1\">cache</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L123\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"123\"></td>\n          <td id=\"LC123\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     .<span class=\"pl-en\">thenCompose</span>((<span class=\"pl-s1\">startPoint</span>) -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L124\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"124\"></td>\n          <td id=\"LC124\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-c\">// do not need to read the compaction ledger if it is empty.</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L125\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"125\"></td>\n          <td id=\"LC125\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-c\">// the cursor just needs to be set to the compaction horizon</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L126\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"126\"></td>\n          <td id=\"LC126\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">startPoint</span> == <span class=\"pl-c1\">COMPACT_LEDGER_EMPTY</span> || <span class=\"pl-s1\">startPoint</span> == <span class=\"pl-c1\">NEWER_THAN_COMPACTED</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L127\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"127\"></td>\n          <td id=\"LC127\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">seek</span>(<span class=\"pl-s1\">currentCompactionHorizon</span>.<span class=\"pl-en\">getNext</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L128\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"128\"></td>\n          <td id=\"LC128\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-s1\">callback</span>.<span class=\"pl-en\">readEntriesComplete</span>(<span class=\"pl-smi\">Collections</span>.<span class=\"pl-en\">emptyList</span>(), <span class=\"pl-s1\">readEntriesCtx</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L129\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"129\"></td>\n          <td id=\"LC129\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-k\">return</span> <span class=\"pl-smi\">CompletableFuture</span>.<span class=\"pl-en\">completedFuture</span>(<span class=\"pl-c1\">null</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L130\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"130\"></td>\n          <td id=\"LC130\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L131\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"131\"></td>\n          <td id=\"LC131\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">endPoint</span> = <span class=\"pl-smi\">Math</span>.<span class=\"pl-en\">min</span>(<span class=\"pl-s1\">context</span>.<span class=\"pl-s1\">ledger</span>.<span class=\"pl-en\">getLastAddConfirmed</span>(), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L132\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"132\"></td>\n          <td id=\"LC132\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                                      <span class=\"pl-s1\">startPoint</span> + (<span class=\"pl-s1\">numberOfEntriesToRead</span> - <span class=\"pl-c1\">1</span>)); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L133\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"133\"></td>\n          <td id=\"LC133\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-k\">return</span> <span class=\"pl-en\">readEntries</span>(<span class=\"pl-s1\">context</span>.<span class=\"pl-s1\">ledger</span>, <span class=\"pl-s1\">startPoint</span>, <span class=\"pl-s1\">endPoint</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L134\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"134\"></td>\n          <td id=\"LC134\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                 .<span class=\"pl-en\">thenAccept</span>((<span class=\"pl-s1\">entries</span>) -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L135\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"135\"></td>\n          <td id=\"LC135\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">entriesSize</span> = <span class=\"pl-c1\">0</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L136\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"136\"></td>\n          <td id=\"LC136\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">Entry</span> <span class=\"pl-s1\">entry</span> : <span class=\"pl-s1\">entries</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L137\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"137\"></td>\n          <td id=\"LC137\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                         <span class=\"pl-s1\">entriesSize</span> += <span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getLength</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L138\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"138\"></td>\n          <td id=\"LC138\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L139\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"139\"></td>\n          <td id=\"LC139\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     <span class=\"pl-s1\">managedCursor</span>.<span class=\"pl-en\">updateReadStats</span>(<span class=\"pl-s1\">entries</span>.<span class=\"pl-en\">size</span>(), <span class=\"pl-s1\">entriesSize</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L140\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"140\"></td>\n          <td id=\"LC140\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L141\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"141\"></td>\n          <td id=\"LC141\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     <span class=\"pl-smi\">Entry</span> <span class=\"pl-s1\">lastEntry</span> = <span class=\"pl-s1\">entries</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">entries</span>.<span class=\"pl-en\">size</span>() - <span class=\"pl-c1\">1</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L142\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"142\"></td>\n          <td id=\"LC142\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     <span class=\"pl-c\">// The compaction task depends on the last snapshot and the incremental</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L143\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"143\"></td>\n          <td id=\"LC143\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     <span class=\"pl-c\">// entries to build the new snapshot. So for the compaction cursor, we</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L144\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"144\"></td>\n          <td id=\"LC144\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     <span class=\"pl-c\">// need to force seek the read position to ensure the compactor can read</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L145\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"145\"></td>\n          <td id=\"LC145\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     <span class=\"pl-c\">// the complete last snapshot because of the compactor will read the data</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L146\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"146\"></td>\n          <td id=\"LC146\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     <span class=\"pl-c\">// before the compaction cursor mark delete position</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L147\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"147\"></td>\n          <td id=\"LC147\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     <span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">seek</span>(<span class=\"pl-s1\">lastEntry</span>.<span class=\"pl-en\">getPosition</span>().<span class=\"pl-en\">getNext</span>(), <span class=\"pl-c1\">true</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L148\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"148\"></td>\n          <td id=\"LC148\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     <span class=\"pl-s1\">callback</span>.<span class=\"pl-en\">readEntriesComplete</span>(<span class=\"pl-s1\">entries</span>, <span class=\"pl-s1\">readEntriesCtx</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L149\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"149\"></td>\n          <td id=\"LC149\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                 }); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L150\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"150\"></td>\n          <td id=\"LC150\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L151\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"151\"></td>\n          <td id=\"LC151\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     })) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L152\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"152\"></td>\n          <td id=\"LC152\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 .<span class=\"pl-en\">exceptionally</span>((<span class=\"pl-s1\">exception</span>) -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L153\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"153\"></td>\n          <td id=\"LC153\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">exception</span>.<span class=\"pl-en\">getCause</span>() <span class=\"pl-k\">instanceof</span> <span class=\"pl-smi\">NoSuchElementException</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L154\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"154\"></td>\n          <td id=\"LC154\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">cursor</span>.<span class=\"pl-en\">seek</span>(<span class=\"pl-s1\">currentCompactionHorizon</span>.<span class=\"pl-en\">getNext</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L155\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"155\"></td>\n          <td id=\"LC155\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">callback</span>.<span class=\"pl-en\">readEntriesComplete</span>(<span class=\"pl-smi\">Collections</span>.<span class=\"pl-en\">emptyList</span>(), <span class=\"pl-s1\">readEntriesCtx</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L156\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"156\"></td>\n          <td id=\"LC156\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L157\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"157\"></td>\n          <td id=\"LC157\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">callback</span>.<span class=\"pl-en\">readEntriesFailed</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">ManagedLedgerException</span>(<span class=\"pl-s1\">exception</span>), <span class=\"pl-s1\">readEntriesCtx</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L158\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"158\"></td>\n          <td id=\"LC158\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L159\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"159\"></td>\n          <td id=\"LC159\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-k\">return</span> <span class=\"pl-c1\">null</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L160\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"160\"></td>\n          <td id=\"LC160\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 }); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L161\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"161\"></td>\n          <td id=\"LC161\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L162\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"162\"></td>\n          <td id=\"LC162\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L163\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"163\"></td>\n          <td id=\"LC163\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L164\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"164\"></td>\n          <td id=\"LC164\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Long</span>&gt; <span class=\"pl-en\">findStartPoint</span>(<span class=\"pl-smi\">PositionImpl</span> <span class=\"pl-s1\">p</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L165\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"165\"></td>\n          <td id=\"LC165\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                               <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">lastEntryId</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L166\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"166\"></td>\n          <td id=\"LC166\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                               <span class=\"pl-smi\">AsyncLoadingCache</span>&lt;<span class=\"pl-smi\">Long</span>, <span class=\"pl-smi\">MessageIdData</span>&gt; <span class=\"pl-s1\">cache</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L167\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"167\"></td>\n          <td id=\"LC167\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Long</span>&gt; <span class=\"pl-s1\">promise</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">CompletableFuture</span>&lt;&gt;(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L168\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"168\"></td>\n          <td id=\"LC168\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-c\">// if lastEntryId is less than zero it means there are no entries in the compact ledger</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L169\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"169\"></td>\n          <td id=\"LC169\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">lastEntryId</span> &lt; <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L170\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"170\"></td>\n          <td id=\"LC170\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">promise</span>.<span class=\"pl-en\">complete</span>(<span class=\"pl-c1\">COMPACT_LEDGER_EMPTY</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L171\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"171\"></td>\n          <td id=\"LC171\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L172\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"172\"></td>\n          <td id=\"LC172\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-en\">findStartPointLoop</span>(<span class=\"pl-s1\">p</span>, <span class=\"pl-c1\">0</span>, <span class=\"pl-s1\">lastEntryId</span>, <span class=\"pl-s1\">promise</span>, <span class=\"pl-s1\">cache</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L173\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"173\"></td>\n          <td id=\"LC173\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L174\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"174\"></td>\n          <td id=\"LC174\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-s1\">promise</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L175\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"175\"></td>\n          <td id=\"LC175\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L176\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"176\"></td>\n          <td id=\"LC176\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L177\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"177\"></td>\n          <td id=\"LC177\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c1\">@</span><span class=\"pl-c1\">VisibleForTesting</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L178\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"178\"></td>\n          <td id=\"LC178\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">findStartPointLoop</span>(<span class=\"pl-smi\">PositionImpl</span> <span class=\"pl-s1\">p</span>, <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">start</span>, <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">end</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L179\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"179\"></td>\n          <td id=\"LC179\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                        <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Long</span>&gt; <span class=\"pl-s1\">promise</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L180\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"180\"></td>\n          <td id=\"LC180\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                        <span class=\"pl-smi\">AsyncLoadingCache</span>&lt;<span class=\"pl-smi\">Long</span>, <span class=\"pl-smi\">MessageIdData</span>&gt; <span class=\"pl-s1\">cache</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L181\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"181\"></td>\n          <td id=\"LC181\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">midpoint</span> = <span class=\"pl-s1\">start</span> + ((<span class=\"pl-s1\">end</span> - <span class=\"pl-s1\">start</span>) / <span class=\"pl-c1\">2</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L182\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"182\"></td>\n          <td id=\"LC182\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L183\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"183\"></td>\n          <td id=\"LC183\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">MessageIdData</span>&gt; <span class=\"pl-s1\">startEntry</span> = <span class=\"pl-s1\">cache</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">start</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L184\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"184\"></td>\n          <td id=\"LC184\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">MessageIdData</span>&gt; <span class=\"pl-s1\">middleEntry</span> = <span class=\"pl-s1\">cache</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">midpoint</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L185\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"185\"></td>\n          <td id=\"LC185\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">MessageIdData</span>&gt; <span class=\"pl-s1\">endEntry</span> = <span class=\"pl-s1\">cache</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">end</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L186\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"186\"></td>\n          <td id=\"LC186\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L187\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"187\"></td>\n          <td id=\"LC187\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">CompletableFuture</span>.<span class=\"pl-en\">allOf</span>(<span class=\"pl-s1\">startEntry</span>, <span class=\"pl-s1\">middleEntry</span>, <span class=\"pl-s1\">endEntry</span>).<span class=\"pl-en\">thenRun</span>( </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L188\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"188\"></td>\n          <td id=\"LC188\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             () -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L189\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"189\"></td>\n          <td id=\"LC189\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">if</span> (<span class=\"pl-en\">comparePositionAndMessageId</span>(<span class=\"pl-s1\">p</span>, <span class=\"pl-s1\">startEntry</span>.<span class=\"pl-en\">join</span>()) &lt;= <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L190\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"190\"></td>\n          <td id=\"LC190\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-s1\">promise</span>.<span class=\"pl-en\">complete</span>(<span class=\"pl-s1\">start</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L191\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"191\"></td>\n          <td id=\"LC191\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (<span class=\"pl-en\">comparePositionAndMessageId</span>(<span class=\"pl-s1\">p</span>, <span class=\"pl-s1\">middleEntry</span>.<span class=\"pl-en\">join</span>()) &lt;= <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L192\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"192\"></td>\n          <td id=\"LC192\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-en\">findStartPointLoop</span>(<span class=\"pl-s1\">p</span>, <span class=\"pl-s1\">start</span> + <span class=\"pl-c1\">1</span>, <span class=\"pl-s1\">midpoint</span>, <span class=\"pl-s1\">promise</span>, <span class=\"pl-s1\">cache</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L193\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"193\"></td>\n          <td id=\"LC193\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (<span class=\"pl-en\">comparePositionAndMessageId</span>(<span class=\"pl-s1\">p</span>, <span class=\"pl-s1\">endEntry</span>.<span class=\"pl-en\">join</span>()) &lt;= <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L194\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"194\"></td>\n          <td id=\"LC194\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-en\">findStartPointLoop</span>(<span class=\"pl-s1\">p</span>, <span class=\"pl-s1\">midpoint</span> + <span class=\"pl-c1\">1</span>, <span class=\"pl-s1\">end</span>, <span class=\"pl-s1\">promise</span>, <span class=\"pl-s1\">cache</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L195\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"195\"></td>\n          <td id=\"LC195\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L196\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"196\"></td>\n          <td id=\"LC196\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-s1\">promise</span>.<span class=\"pl-en\">complete</span>(<span class=\"pl-c1\">NEWER_THAN_COMPACTED</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L197\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"197\"></td>\n          <td id=\"LC197\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L198\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"198\"></td>\n          <td id=\"LC198\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             }).<span class=\"pl-en\">exceptionally</span>((<span class=\"pl-s1\">exception</span>) -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L199\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"199\"></td>\n          <td id=\"LC199\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-s1\">promise</span>.<span class=\"pl-en\">completeExceptionally</span>(<span class=\"pl-s1\">exception</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L200\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"200\"></td>\n          <td id=\"LC200\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-k\">return</span> <span class=\"pl-c1\">null</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L201\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"201\"></td>\n          <td id=\"LC201\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 }); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L202\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"202\"></td>\n          <td id=\"LC202\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L203\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"203\"></td>\n          <td id=\"LC203\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L204\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"204\"></td>\n          <td id=\"LC204\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">AsyncLoadingCache</span>&lt;<span class=\"pl-smi\">Long</span>, <span class=\"pl-smi\">MessageIdData</span>&gt; <span class=\"pl-en\">createCache</span>(<span class=\"pl-smi\">LedgerHandle</span> <span class=\"pl-s1\">lh</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L205\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"205\"></td>\n          <td id=\"LC205\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                                           <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">maxSize</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L206\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"206\"></td>\n          <td id=\"LC206\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-smi\">Caffeine</span>.<span class=\"pl-en\">newBuilder</span>() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L207\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"207\"></td>\n          <td id=\"LC207\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             .<span class=\"pl-en\">maximumSize</span>(<span class=\"pl-s1\">maxSize</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L208\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"208\"></td>\n          <td id=\"LC208\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             .<span class=\"pl-en\">buildAsync</span>((<span class=\"pl-s1\">entryId</span>, <span class=\"pl-s1\">executor</span>) -&gt; <span class=\"pl-en\">readOneMessageId</span>(<span class=\"pl-s1\">lh</span>, <span class=\"pl-s1\">entryId</span>)); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L209\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"209\"></td>\n          <td id=\"LC209\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/51202a6889582117bf790e9ff2325b9f3119510f/pulsar-broker/src/main/java/org/apache/pulsar/compaction/TwoPhaseCompactor.java#L74-L199\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/compaction/TwoPhaseCompactor.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 74 to 199\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/51202a6889582117bf790e9ff2325b9f3119510f\">51202a6</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L74\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"74\"></td>\n          <td id=\"LC74\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Override</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L75\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"75\"></td>\n          <td id=\"LC75\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">protected</span> <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Long</span>&gt; <span class=\"pl-en\">doCompaction</span>(<span class=\"pl-smi\">RawReader</span> <span class=\"pl-s1\">reader</span>, <span class=\"pl-smi\">BookKeeper</span> <span class=\"pl-s1\">bk</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L76\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"76\"></td>\n          <td id=\"LC76\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-s1\">reader</span>.<span class=\"pl-en\">hasMessageAvailableAsync</span>() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L77\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"77\"></td>\n          <td id=\"LC77\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             .<span class=\"pl-en\">thenCompose</span>(<span class=\"pl-s1\">available</span> -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L78\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"78\"></td>\n          <td id=\"LC78\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">available</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L79\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"79\"></td>\n          <td id=\"LC79\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-k\">return</span> <span class=\"pl-en\">phaseOne</span>(<span class=\"pl-s1\">reader</span>).<span class=\"pl-en\">thenCompose</span>( </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L80\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"80\"></td>\n          <td id=\"LC80\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             (<span class=\"pl-s1\">r</span>) -&gt; <span class=\"pl-en\">phaseTwo</span>(<span class=\"pl-s1\">reader</span>, <span class=\"pl-s1\">r</span>.<span class=\"pl-s1\">from</span>, <span class=\"pl-s1\">r</span>.<span class=\"pl-s1\">to</span>, <span class=\"pl-s1\">r</span>.<span class=\"pl-s1\">lastReadId</span>, <span class=\"pl-s1\">r</span>.<span class=\"pl-s1\">latestForKey</span>, <span class=\"pl-s1\">bk</span>)); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L81\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"81\"></td>\n          <td id=\"LC81\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L82\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"82\"></td>\n          <td id=\"LC82\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"Skip compaction of the empty topic {}\"</span>, <span class=\"pl-s1\">reader</span>.<span class=\"pl-en\">getTopic</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L83\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"83\"></td>\n          <td id=\"LC83\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-k\">return</span> <span class=\"pl-smi\">CompletableFuture</span>.<span class=\"pl-en\">completedFuture</span>(-<span class=\"pl-c1\">1L</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L84\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"84\"></td>\n          <td id=\"LC84\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L85\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"85\"></td>\n          <td id=\"LC85\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             }); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L86\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"86\"></td>\n          <td id=\"LC86\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L87\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"87\"></td>\n          <td id=\"LC87\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L88\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"88\"></td>\n          <td id=\"LC88\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">private</span> <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">PhaseOneResult</span>&gt; <span class=\"pl-en\">phaseOne</span>(<span class=\"pl-smi\">RawReader</span> <span class=\"pl-s1\">reader</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L89\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"89\"></td>\n          <td id=\"LC89\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">MessageId</span>&gt; <span class=\"pl-s1\">latestForKey</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">HashMap</span>&lt;&gt;(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L90\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"90\"></td>\n          <td id=\"LC90\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">PhaseOneResult</span>&gt; <span class=\"pl-s1\">loopPromise</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">CompletableFuture</span>&lt;&gt;(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L91\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"91\"></td>\n          <td id=\"LC91\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L92\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"92\"></td>\n          <td id=\"LC92\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">reader</span>.<span class=\"pl-en\">getLastMessageIdAsync</span>() </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L93\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"93\"></td>\n          <td id=\"LC93\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             .<span class=\"pl-en\">thenAccept</span>(<span class=\"pl-s1\">lastMessageId</span> -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L94\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"94\"></td>\n          <td id=\"LC94\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"Commencing phase one of compaction for {}, reading to {}\"</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L95\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"95\"></td>\n          <td id=\"LC95\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">reader</span>.<span class=\"pl-en\">getTopic</span>(), <span class=\"pl-s1\">lastMessageId</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L96\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"96\"></td>\n          <td id=\"LC96\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-c\">// Each entry is processed as a whole, discard the batchIndex part deliberately.</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L97\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"97\"></td>\n          <td id=\"LC97\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-smi\">MessageIdImpl</span> <span class=\"pl-s1\">lastImpl</span> = (<span class=\"pl-smi\">MessageIdImpl</span>) <span class=\"pl-s1\">lastMessageId</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L98\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"98\"></td>\n          <td id=\"LC98\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-smi\">MessageIdImpl</span> <span class=\"pl-s1\">lastEntryMessageId</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">MessageIdImpl</span>(<span class=\"pl-s1\">lastImpl</span>.<span class=\"pl-en\">getLedgerId</span>(), <span class=\"pl-s1\">lastImpl</span>.<span class=\"pl-en\">getEntryId</span>(), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L99\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"99\"></td>\n          <td id=\"LC99\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">lastImpl</span>.<span class=\"pl-en\">getPartitionIndex</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L100\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"100\"></td>\n          <td id=\"LC100\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-en\">phaseOneLoop</span>(<span class=\"pl-s1\">reader</span>, <span class=\"pl-smi\">Optional</span>.<span class=\"pl-en\">empty</span>(), <span class=\"pl-smi\">Optional</span>.<span class=\"pl-en\">empty</span>(), <span class=\"pl-s1\">lastEntryMessageId</span>, <span class=\"pl-s1\">latestForKey</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L101\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"101\"></td>\n          <td id=\"LC101\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">loopPromise</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L102\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"102\"></td>\n          <td id=\"LC102\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             }).<span class=\"pl-en\">exceptionally</span>(<span class=\"pl-s1\">ex</span> -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L103\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"103\"></td>\n          <td id=\"LC103\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">loopPromise</span>.<span class=\"pl-en\">completeExceptionally</span>(<span class=\"pl-s1\">ex</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L104\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"104\"></td>\n          <td id=\"LC104\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">return</span> <span class=\"pl-c1\">null</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L105\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"105\"></td>\n          <td id=\"LC105\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             }); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L106\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"106\"></td>\n          <td id=\"LC106\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L107\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"107\"></td>\n          <td id=\"LC107\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-s1\">loopPromise</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L108\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"108\"></td>\n          <td id=\"LC108\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L109\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"109\"></td>\n          <td id=\"LC109\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L110\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"110\"></td>\n          <td id=\"LC110\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">private</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">phaseOneLoop</span>(<span class=\"pl-smi\">RawReader</span> <span class=\"pl-s1\">reader</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L111\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"111\"></td>\n          <td id=\"LC111\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                           <span class=\"pl-smi\">Optional</span>&lt;<span class=\"pl-smi\">MessageId</span>&gt; <span class=\"pl-s1\">firstMessageId</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L112\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"112\"></td>\n          <td id=\"LC112\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                           <span class=\"pl-smi\">Optional</span>&lt;<span class=\"pl-smi\">MessageId</span>&gt; <span class=\"pl-s1\">toMessageId</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L113\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"113\"></td>\n          <td id=\"LC113\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                           <span class=\"pl-smi\">MessageId</span> <span class=\"pl-s1\">lastMessageId</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L114\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"114\"></td>\n          <td id=\"LC114\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                           <span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">MessageId</span>&gt; <span class=\"pl-s1\">latestForKey</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L115\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"115\"></td>\n          <td id=\"LC115\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                           <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">PhaseOneResult</span>&gt; <span class=\"pl-s1\">loopPromise</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L116\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"116\"></td>\n          <td id=\"LC116\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">loopPromise</span>.<span class=\"pl-en\">isDone</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L117\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"117\"></td>\n          <td id=\"LC117\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">return</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L118\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"118\"></td>\n          <td id=\"LC118\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L119\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"119\"></td>\n          <td id=\"LC119\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">RawMessage</span>&gt; <span class=\"pl-s1\">future</span> = <span class=\"pl-s1\">reader</span>.<span class=\"pl-en\">readNextAsync</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L120\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"120\"></td>\n          <td id=\"LC120\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">FutureUtil</span>.<span class=\"pl-en\">addTimeoutHandling</span>(<span class=\"pl-s1\">future</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L121\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"121\"></td>\n          <td id=\"LC121\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">phaseOneLoopReadTimeout</span>, <span class=\"pl-s1\">scheduler</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L122\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"122\"></td>\n          <td id=\"LC122\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             () -&gt; <span class=\"pl-smi\">FutureUtil</span>.<span class=\"pl-en\">createTimeoutException</span>(<span class=\"pl-s\">\"Timeout\"</span>, <span class=\"pl-en\">getClass</span>(), <span class=\"pl-s\">\"phaseOneLoop(...)\"</span>)); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L123\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"123\"></td>\n          <td id=\"LC123\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L124\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"124\"></td>\n          <td id=\"LC124\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">future</span>.<span class=\"pl-en\">thenAcceptAsync</span>(<span class=\"pl-s1\">m</span> -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L125\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"125\"></td>\n          <td id=\"LC125\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">try</span> (<span class=\"pl-s1\">m</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L126\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"126\"></td>\n          <td id=\"LC126\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-smi\">MessageId</span> <span class=\"pl-s1\">id</span> = <span class=\"pl-s1\">m</span>.<span class=\"pl-en\">getMessageId</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L127\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"127\"></td>\n          <td id=\"LC127\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-smi\">boolean</span> <span class=\"pl-s1\">deletedMessage</span> = <span class=\"pl-c1\">false</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L128\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"128\"></td>\n          <td id=\"LC128\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-smi\">boolean</span> <span class=\"pl-s1\">replaceMessage</span> = <span class=\"pl-c1\">false</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L129\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"129\"></td>\n          <td id=\"LC129\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">mxBean</span>.<span class=\"pl-en\">addCompactionReadOp</span>(<span class=\"pl-s1\">reader</span>.<span class=\"pl-en\">getTopic</span>(), <span class=\"pl-s1\">m</span>.<span class=\"pl-en\">getHeadersAndPayload</span>().<span class=\"pl-en\">readableBytes</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L130\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"130\"></td>\n          <td id=\"LC130\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-smi\">MessageMetadata</span> <span class=\"pl-s1\">metadata</span> = <span class=\"pl-smi\">Commands</span>.<span class=\"pl-en\">parseMessageMetadata</span>(<span class=\"pl-s1\">m</span>.<span class=\"pl-en\">getHeadersAndPayload</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L131\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"131\"></td>\n          <td id=\"LC131\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">if</span> (<span class=\"pl-smi\">RawBatchConverter</span>.<span class=\"pl-en\">isReadableBatch</span>(<span class=\"pl-s1\">metadata</span>)) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L132\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"132\"></td>\n          <td id=\"LC132\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">try</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L133\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"133\"></td>\n          <td id=\"LC133\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">numMessagesInBatch</span> = <span class=\"pl-s1\">metadata</span>.<span class=\"pl-en\">getNumMessagesInBatch</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L134\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"134\"></td>\n          <td id=\"LC134\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">deleteCnt</span> = <span class=\"pl-c1\">0</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L135\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"135\"></td>\n          <td id=\"LC135\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">ImmutableTriple</span>&lt;<span class=\"pl-smi\">MessageId</span>, <span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Integer</span>&gt; <span class=\"pl-s1\">e</span> : <span class=\"pl-en\">extractIdsAndKeysAndSizeFromBatch</span>(<span class=\"pl-s1\">m</span>)) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L136\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"136\"></td>\n          <td id=\"LC136\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">e</span> != <span class=\"pl-c1\">null</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L137\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"137\"></td>\n          <td id=\"LC137\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">e</span>.<span class=\"pl-en\">getRight</span>() &gt; <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L138\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"138\"></td>\n          <td id=\"LC138\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                 <span class=\"pl-smi\">MessageId</span> <span class=\"pl-s1\">old</span> = <span class=\"pl-s1\">latestForKey</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s1\">e</span>.<span class=\"pl-en\">getMiddle</span>(), <span class=\"pl-s1\">e</span>.<span class=\"pl-en\">getLeft</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L139\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"139\"></td>\n          <td id=\"LC139\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                 <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">old</span> != <span class=\"pl-c1\">null</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L140\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"140\"></td>\n          <td id=\"LC140\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                     <span class=\"pl-s1\">mxBean</span>.<span class=\"pl-en\">addCompactionRemovedEvent</span>(<span class=\"pl-s1\">reader</span>.<span class=\"pl-en\">getTopic</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L141\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"141\"></td>\n          <td id=\"LC141\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                 } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L142\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"142\"></td>\n          <td id=\"LC142\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L143\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"143\"></td>\n          <td id=\"LC143\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                 <span class=\"pl-s1\">latestForKey</span>.<span class=\"pl-en\">remove</span>(<span class=\"pl-s1\">e</span>.<span class=\"pl-en\">getMiddle</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L144\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"144\"></td>\n          <td id=\"LC144\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                 <span class=\"pl-s1\">deleteCnt</span>++; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L145\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"145\"></td>\n          <td id=\"LC145\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                                 <span class=\"pl-s1\">mxBean</span>.<span class=\"pl-en\">addCompactionRemovedEvent</span>(<span class=\"pl-s1\">reader</span>.<span class=\"pl-en\">getTopic</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L146\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"146\"></td>\n          <td id=\"LC146\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L147\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"147\"></td>\n          <td id=\"LC147\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L148\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"148\"></td>\n          <td id=\"LC148\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L149\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"149\"></td>\n          <td id=\"LC149\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">deleteCnt</span> == <span class=\"pl-s1\">numMessagesInBatch</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L150\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"150\"></td>\n          <td id=\"LC150\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">deletedMessage</span> = <span class=\"pl-c1\">true</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L151\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"151\"></td>\n          <td id=\"LC151\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L152\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"152\"></td>\n          <td id=\"LC152\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">IOException</span> <span class=\"pl-s1\">ioe</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L153\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"153\"></td>\n          <td id=\"LC153\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"Error decoding batch for message {}. Whole batch will be included in output\"</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L154\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"154\"></td>\n          <td id=\"LC154\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                             <span class=\"pl-s1\">id</span>, <span class=\"pl-s1\">ioe</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L155\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"155\"></td>\n          <td id=\"LC155\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L156\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"156\"></td>\n          <td id=\"LC156\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L157\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"157\"></td>\n          <td id=\"LC157\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-smi\">Pair</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">Integer</span>&gt; <span class=\"pl-s1\">keyAndSize</span> = <span class=\"pl-en\">extractKeyAndSize</span>(<span class=\"pl-s1\">m</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L158\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"158\"></td>\n          <td id=\"LC158\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">keyAndSize</span> != <span class=\"pl-c1\">null</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L159\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"159\"></td>\n          <td id=\"LC159\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">keyAndSize</span>.<span class=\"pl-en\">getRight</span>() &gt; <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L160\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"160\"></td>\n          <td id=\"LC160\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-smi\">MessageId</span> <span class=\"pl-s1\">old</span> = <span class=\"pl-s1\">latestForKey</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s1\">keyAndSize</span>.<span class=\"pl-en\">getLeft</span>(), <span class=\"pl-s1\">id</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L161\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"161\"></td>\n          <td id=\"LC161\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">replaceMessage</span> = <span class=\"pl-s1\">old</span> != <span class=\"pl-c1\">null</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L162\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"162\"></td>\n          <td id=\"LC162\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L163\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"163\"></td>\n          <td id=\"LC163\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">deletedMessage</span> = <span class=\"pl-c1\">true</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L164\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"164\"></td>\n          <td id=\"LC164\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">latestForKey</span>.<span class=\"pl-en\">remove</span>(<span class=\"pl-s1\">keyAndSize</span>.<span class=\"pl-en\">getLeft</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L165\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"165\"></td>\n          <td id=\"LC165\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L166\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"166\"></td>\n          <td id=\"LC166\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L167\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"167\"></td>\n          <td id=\"LC167\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">replaceMessage</span> || <span class=\"pl-s1\">deletedMessage</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L168\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"168\"></td>\n          <td id=\"LC168\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                     <span class=\"pl-s1\">mxBean</span>.<span class=\"pl-en\">addCompactionRemovedEvent</span>(<span class=\"pl-s1\">reader</span>.<span class=\"pl-en\">getTopic</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L169\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"169\"></td>\n          <td id=\"LC169\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L170\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"170\"></td>\n          <td id=\"LC170\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L171\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"171\"></td>\n          <td id=\"LC171\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-smi\">MessageId</span> <span class=\"pl-s1\">first</span> = <span class=\"pl-s1\">firstMessageId</span>.<span class=\"pl-en\">orElse</span>(<span class=\"pl-s1\">deletedMessage</span> ? <span class=\"pl-c1\">null</span> : <span class=\"pl-s1\">id</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L172\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"172\"></td>\n          <td id=\"LC172\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-smi\">MessageId</span> <span class=\"pl-s1\">to</span> = <span class=\"pl-s1\">deletedMessage</span> ? <span class=\"pl-s1\">toMessageId</span>.<span class=\"pl-en\">orElse</span>(<span class=\"pl-c1\">null</span>) : <span class=\"pl-s1\">id</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L173\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"173\"></td>\n          <td id=\"LC173\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">id</span>.<span class=\"pl-en\">compareTo</span>(<span class=\"pl-s1\">lastMessageId</span>) == <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L174\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"174\"></td>\n          <td id=\"LC174\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">loopPromise</span>.<span class=\"pl-en\">complete</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">PhaseOneResult</span>(<span class=\"pl-s1\">first</span> == <span class=\"pl-c1\">null</span> ? <span class=\"pl-s1\">id</span> : <span class=\"pl-s1\">first</span>, <span class=\"pl-s1\">to</span> == <span class=\"pl-c1\">null</span> ? <span class=\"pl-s1\">id</span> : <span class=\"pl-s1\">to</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L175\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"175\"></td>\n          <td id=\"LC175\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">lastMessageId</span>, <span class=\"pl-s1\">latestForKey</span>)); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L176\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"176\"></td>\n          <td id=\"LC176\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L177\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"177\"></td>\n          <td id=\"LC177\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-en\">phaseOneLoop</span>(<span class=\"pl-s1\">reader</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L178\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"178\"></td>\n          <td id=\"LC178\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-smi\">Optional</span>.<span class=\"pl-en\">ofNullable</span>(<span class=\"pl-s1\">first</span>), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L179\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"179\"></td>\n          <td id=\"LC179\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-smi\">Optional</span>.<span class=\"pl-en\">ofNullable</span>(<span class=\"pl-s1\">to</span>), </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L180\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"180\"></td>\n          <td id=\"LC180\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">lastMessageId</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L181\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"181\"></td>\n          <td id=\"LC181\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                         <span class=\"pl-s1\">latestForKey</span>, <span class=\"pl-s1\">loopPromise</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L182\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"182\"></td>\n          <td id=\"LC182\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L183\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"183\"></td>\n          <td id=\"LC183\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L184\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"184\"></td>\n          <td id=\"LC184\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     }, <span class=\"pl-s1\">scheduler</span>).<span class=\"pl-en\">exceptionally</span>(<span class=\"pl-s1\">ex</span> -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L185\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"185\"></td>\n          <td id=\"LC185\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">loopPromise</span>.<span class=\"pl-en\">completeExceptionally</span>(<span class=\"pl-s1\">ex</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L186\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"186\"></td>\n          <td id=\"LC186\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">return</span> <span class=\"pl-c1\">null</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L187\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"187\"></td>\n          <td id=\"LC187\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     }); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L188\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"188\"></td>\n          <td id=\"LC188\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L189\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"189\"></td>\n          <td id=\"LC189\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L190\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"190\"></td>\n          <td id=\"LC190\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">private</span> <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Long</span>&gt; <span class=\"pl-en\">phaseTwo</span>(<span class=\"pl-smi\">RawReader</span> <span class=\"pl-s1\">reader</span>, <span class=\"pl-smi\">MessageId</span> <span class=\"pl-s1\">from</span>, <span class=\"pl-smi\">MessageId</span> <span class=\"pl-s1\">to</span>, <span class=\"pl-smi\">MessageId</span> <span class=\"pl-s1\">lastReadId</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L191\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"191\"></td>\n          <td id=\"LC191\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">MessageId</span>&gt; <span class=\"pl-s1\">latestForKey</span>, <span class=\"pl-smi\">BookKeeper</span> <span class=\"pl-s1\">bk</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L192\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"192\"></td>\n          <td id=\"LC192\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">Map</span>&lt;<span class=\"pl-smi\">String</span>, <span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">metadata</span> = </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L193\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"193\"></td>\n          <td id=\"LC193\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-smi\">LedgerMetadataUtils</span>.<span class=\"pl-en\">buildMetadataForCompactedLedger</span>(<span class=\"pl-s1\">reader</span>.<span class=\"pl-en\">getTopic</span>(), <span class=\"pl-s1\">to</span>.<span class=\"pl-en\">toByteArray</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L194\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"194\"></td>\n          <td id=\"LC194\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-en\">createLedger</span>(<span class=\"pl-s1\">bk</span>, <span class=\"pl-s1\">metadata</span>).<span class=\"pl-en\">thenCompose</span>((<span class=\"pl-s1\">ledger</span>) -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L195\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"195\"></td>\n          <td id=\"LC195\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"Commencing phase two of compaction for {}, from {} to {}, compacting {} keys to ledger {}\"</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L196\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"196\"></td>\n          <td id=\"LC196\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 <span class=\"pl-s1\">reader</span>.<span class=\"pl-en\">getTopic</span>(), <span class=\"pl-s1\">from</span>, <span class=\"pl-s1\">to</span>, <span class=\"pl-s1\">latestForKey</span>.<span class=\"pl-en\">size</span>(), <span class=\"pl-s1\">ledger</span>.<span class=\"pl-en\">getId</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L197\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"197\"></td>\n          <td id=\"LC197\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">return</span> <span class=\"pl-en\">phaseTwoSeekThenLoop</span>(<span class=\"pl-s1\">reader</span>, <span class=\"pl-s1\">from</span>, <span class=\"pl-s1\">to</span>, <span class=\"pl-s1\">lastReadId</span>, <span class=\"pl-s1\">latestForKey</span>, <span class=\"pl-s1\">bk</span>, <span class=\"pl-s1\">ledger</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L198\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"198\"></td>\n          <td id=\"LC198\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     }); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L199\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"199\"></td>\n          <td id=\"LC199\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">We temporarily fix the problem  by restart all the broker. Because after broker restart, the previous compactedTopicContext is not exist, compaction can succeed.</p>\n<p dir=\"auto\">But this is not a user-friendly way since each time bookie shutdown, we may need to restart broker. We\u2018d better fix this issue.</p>\n<p dir=\"auto\">After diving to the code, we found that there are two way to open ReadOnlyLedgerHandle in bookie, asyncOpenLedgerNoRecovery and asyncOpenLedger.</p>\n<ul dir=\"auto\">\n<li>asyncOpenLedger would try to open ledger and if the ledger\u2018s metadata\u2018s state is OPEN, it may try to recover. But it would not register the metadata zk node update listener.</li>\n<li>Only in asyncOpenLedgerNoRecovery would watch the zk metadata and update the local metadata.</li>\n</ul>\n<p dir=\"auto\">We can replace asyncOpenLedger to asyncOpenLedgerNoRecovery. I guess the compactedLedger would not in open state, and it need to update metadata.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">compaction can succeed after compactedLedger 3 quorum is autoRecover</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">compaction keep failed after compactedLedger 3 quorum is autoRecover</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21551",
                "createdAt": "2023-11-10T03:27:21Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][readme]update deploy-kubernetes url",
        "url": "https://github.com/apache/pulsar/pull/21558",
        "resourcePath": "/apache/pulsar/pull/21558",
        "createdAt": "2023-11-10T07:51:29Z",
        "number": 21558,
        "mergeCommit": {
          "oid": "62afe0194e0636be2a0468fa7f47f271442ba0c8",
          "message": "[fix][docs] Update deploy-kubernetes url (#21558)\n\nCo-authored-by: sunheyi <50973219+shy-share@users.noreply.github.com>\r\nCo-authored-by: tison <wander4096@gmail.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/62afe0194e0636be2a0468fa7f47f271442ba0c8",
          "parents": {
            "nodes": [
              {
                "oid": "b949187e64638c231216a7220e4b93dff51ca3c5",
                "message": "[fix][broker] Fix setReplicatedSubscriptionStatus incorrect behavior (#21510)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "deployment/kubernetes/README.md"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5fHPPi2gAoZTc4YWY1YTBhOTEzMTI2ZjNhZjBlODZjYTUzMTM5MGEyZTVhMDkzNA",
                "url": "https://github.com/apache/pulsar/pull/21558/commits/e78af5a0a913126f3af0e86ca531390a2e5a0934"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21195,
                "url": "https://github.com/apache/pulsar/issues/21195",
                "title": "[Doc] Kubernetes installation doc link broken",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">What issue do you find in Pulsar docs?</h3>\n<p dir=\"auto\">The current link available <a href=\"https://github.com/apache/pulsar/tree/master/deployment/kubernetes\">here</a> to Kubernetes installation is forwarding to a broken link <a href=\"https://github.com/apache/pulsar/blob/master/site2/docs/deploy-kubernetes.md\">https://github.com/apache/pulsar/blob/master/site2/docs/deploy-kubernetes.md</a></p>\n<h3 dir=\"auto\">What is your suggestion?</h3>\n<p dir=\"auto\">Fix the link to the official Kubernetes installation guide</p>\n<h3 dir=\"auto\">Any reference?</h3>\n<p dir=\"auto\">This seems to be the correct link for this case: <a href=\"https://pulsar.apache.org/docs/3.1.x/deploy-kubernetes/\" rel=\"nofollow\">https://pulsar.apache.org/docs/3.1.x/deploy-kubernetes/</a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21195",
                "createdAt": "2023-09-17T09:18:50Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "doc-required"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Unblock stuck Key_Shared subscription after consumer reconnect",
        "url": "https://github.com/apache/pulsar/pull/21576",
        "resourcePath": "/apache/pulsar/pull/21576",
        "createdAt": "2023-11-14T07:39:13Z",
        "number": 21576,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/main/java/org/apache/pulsar/websocket/service/WebSocketServiceStarter.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/main/resources/findbugsExclude.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/test/java/org/apache/pulsar/websocket/AbstractWebSocketHandlerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/test/java/org/apache/pulsar/websocket/PingPongSupportTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "testmocks/src/main/java/org/apache/zookeeper/MockZooKeeper.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/docker-images/java-test-image/Dockerfile"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tiered-storage/file-system/src/main/java/org/apache/bookkeeper/mledger/offload/filesystem/impl/FileSystemManagedLedgerOffloader.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tiered-storage/file-system/src/test/java/org/apache/bookkeeper/mledger/offload/filesystem/FileStoreTestBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tiered-storage/file-system/src/test/java/org/apache/bookkeeper/mledger/offload/filesystem/impl/FileSystemManagedLedgerOffloaderTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tiered-storage/jcloud/src/test/java/org/apache/bookkeeper/mledger/offload/jcloud/impl/MockManagedLedger.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5fYUfU2gAoYzIxYTg1NDk4ZWRiZjlmNDkyMWYzNDJiYmM2NTI2ZjBhOTU1NzMyNA",
                "url": "https://github.com/apache/pulsar/pull/21576/commits/c21a85498edbf9f4921f342bbc6526f0a9557324"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21199,
                "url": "https://github.com/apache/pulsar/issues/21199",
                "title": "[Bug] Subscription consumption stuck on ",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar broker: 2.8.4<br>\nJava Pulsar client: 2.8.4</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Non-partitioned topic. Batching is disabled on both producer and consumer. No acknowledge timeout. 5 subscriptions, each has 12 consumers.</p>\n<p dir=\"auto\">One consumer of one subscription fails to process a message and doesn't ack it.<br>\nOn a fail, I give the consumer a minute more to try to process other messages and ack them, if they are processed successfully. After a minute, I recreate the consumer and try to reprocess the messages, which would help if the error was transient.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I expected to see the subscription backlog consumed further by the consumer with 1 failed message and by the other 11 consumers.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">If a consumer fails to process one message, processing of all other messages with other keys is also stalled.<br>\nIncluding the other 11 consumers of the subscription.<br>\nAll the other subscriptions and their consumers of the topic continue processing as expected.</p>\n<p dir=\"auto\">As a symptom, I see the stuck subscription has <em>\"waitingReadOp\" : false</em> and <em>\"subscriptionHavePendingRead\" : false</em>, while the other subscription has these fields at <em>true</em>.</p>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/files/12645485/stats.txt\">stats.txt</a><br>\n<a href=\"https://github.com/apache/pulsar/files/12645486/stats-internal.txt\">stats-internal.txt</a></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The message rate is about 50 messages per second. The same scenario with a few (1-2-5) messages per minute works as expected. So, I believe there might be some race condition.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21199",
                "createdAt": "2023-09-18T07:41:20Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Unblock stuck Key_Shared subscription after consumer reconnect",
        "url": "https://github.com/apache/pulsar/pull/21579",
        "resourcePath": "/apache/pulsar/pull/21579",
        "createdAt": "2023-11-14T11:22:10Z",
        "number": 21579,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "conf/broker.conf"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Consumer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Subscription.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentDispatcherMultipleConsumers.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentStickyKeyDispatcherMultipleConsumers.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentSubscription.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/KeySharedSubscriptionTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5fZnr12gAoZWM5MDdhMjcyNzM1MjE1YWNmNmM2NjliMjU0OGU0ZGI2Y2Q0NzJhNQ",
                "url": "https://github.com/apache/pulsar/pull/21579/commits/ec907a272735215acf6c669b2548e4db6cd472a5"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21199,
                "url": "https://github.com/apache/pulsar/issues/21199",
                "title": "[Bug] Subscription consumption stuck on ",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar broker: 2.8.4<br>\nJava Pulsar client: 2.8.4</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Non-partitioned topic. Batching is disabled on both producer and consumer. No acknowledge timeout. 5 subscriptions, each has 12 consumers.</p>\n<p dir=\"auto\">One consumer of one subscription fails to process a message and doesn't ack it.<br>\nOn a fail, I give the consumer a minute more to try to process other messages and ack them, if they are processed successfully. After a minute, I recreate the consumer and try to reprocess the messages, which would help if the error was transient.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I expected to see the subscription backlog consumed further by the consumer with 1 failed message and by the other 11 consumers.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">If a consumer fails to process one message, processing of all other messages with other keys is also stalled.<br>\nIncluding the other 11 consumers of the subscription.<br>\nAll the other subscriptions and their consumers of the topic continue processing as expected.</p>\n<p dir=\"auto\">As a symptom, I see the stuck subscription has <em>\"waitingReadOp\" : false</em> and <em>\"subscriptionHavePendingRead\" : false</em>, while the other subscription has these fields at <em>true</em>.</p>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/files/12645485/stats.txt\">stats.txt</a><br>\n<a href=\"https://github.com/apache/pulsar/files/12645486/stats-internal.txt\">stats-internal.txt</a></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The message rate is about 50 messages per second. The same scenario with a few (1-2-5) messages per minute works as expected. So, I believe there might be some race condition.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21199",
                "createdAt": "2023-09-18T07:41:20Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Detects whether an empty object is returned, prevent NPE exception",
        "url": "https://github.com/apache/pulsar/pull/21585",
        "resourcePath": "/apache/pulsar/pull/21585",
        "createdAt": "2023-11-16T12:19:55Z",
        "number": 21585,
        "mergeCommit": {
          "oid": "2cb54f3d8585f5c27d20fb6ac958ce29a400c878",
          "message": "[fix][test] Detects whether an empty object is returned, prevent NPE exception (#21585)",
          "commitUrl": "https://github.com/apache/pulsar/commit/2cb54f3d8585f5c27d20fb6ac958ce29a400c878",
          "parents": {
            "nodes": [
              {
                "oid": "9fbb92a69b5f392212e086cbac8cd24c49fecb29",
                "message": "[improve][pip] PIP-303: Add optional parameters for getPartitionedStats (#21228)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/PartitionedProducerImplTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5fn4fs2gAoOWVkODU5MjMzZDMzOTM0ZGYzYjdmYTI2NmIyYmI3M2E1Njc1MmE1NA",
                "url": "https://github.com/apache/pulsar/pull/21585/commits/9ed859233d33934df3b7fa266b2bb73a56752a54"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21559,
                "url": "https://github.com/apache/pulsar/issues/21559",
                "title": "Add related test for #21485",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Add a test to enhance the stability and avoid regression related to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1969952957\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/21485\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/21485/hovercard\" href=\"https://github.com/apache/pulsar/pull/21485\">#21485</a></p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21559",
                "createdAt": "2023-11-10T11:13:53Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "good first issue"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve] [client] Add producerName for deadLetterProducer",
        "url": "https://github.com/apache/pulsar/pull/21589",
        "resourcePath": "/apache/pulsar/pull/21589",
        "createdAt": "2023-11-17T03:07:18Z",
        "number": 21589,
        "mergeCommit": {
          "oid": "c87cfb3f50b32f5c032b5d1c3a6a0b91cde2bbe9",
          "message": "[improve] [client] Add producerName for deadLetterProducer (#21589)\n\nFixes #21441\r\nRelated PR: https://github.com/apache/pulsar/pull/21507\r\n\r\n### Motivation\r\n\r\nAdd producerName for dead letter producer, easier to locate problems.\r\n\r\n### Modifications\r\n\r\n```java\r\n.producerName(String.format(\"%s-%s-DLQ\", this.topicName, this.subscription))\r\n```\r\n\r\nWhen creating a `deadLetterProducer`, specify the `producerName` to replace the randomly generated name.",
          "commitUrl": "https://github.com/apache/pulsar/commit/c87cfb3f50b32f5c032b5d1c3a6a0b91cde2bbe9",
          "parents": {
            "nodes": [
              {
                "oid": "b2f2b53907e43d0eb6757bfc4b77bf3db027f251",
                "message": "[fix] [broker] Delete topic timeout due to NPE (#21595)\n\n### Issue:\r\nThere is an NPE that causes the Future of Delay message indexes bucket deletion to be no longer complete, which leads to the topic deletion timeout. You can reproduce this issue by the test `testDeletePartitionedTopicIfCursorPropsEmpty` and `testDeleteTopicIfCursorPropsEmpty`\r\n\r\n### Modifications\r\nFix the NPE."
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/DeadLetterTopicTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5fs3Qi2gAoODMwYjA1YmU2Y2Q4YmNlODk0YWI3OGY1M2I2MTdjYmRmZTIyMWQ3Zg",
                "url": "https://github.com/apache/pulsar/pull/21589/commits/830b05be6cd8bce894ab78f53b617cbdfe221d7f"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21441,
                "url": "https://github.com/apache/pulsar/issues/21441",
                "title": "DeadLetterPolicy supports specifying producerName",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">The current <code class=\"notranslate\">DeadLetterProducerName</code> is generated randomly, and It is difficult to query related logs by producerName.</p>\n<h3 dir=\"auto\">Solution</h3>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"public class DeadLetterPolicy {\n\n\t...\n\tprivate String producerName;\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-smi\">DeadLetterPolicy</span> {\n\n\t...\n\t<span class=\"pl-k\">private</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">producerName</span>;\n}</pre></div>\n<p dir=\"auto\">Add a new field <code class=\"notranslate\">producerName</code> in <code class=\"notranslate\">DeadLetterPolicy</code> class.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21441",
                "createdAt": "2023-10-25T07:53:58Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix incorrect unack count when using shared subscription on non-persistent topic",
        "url": "https://github.com/apache/pulsar/pull/21592",
        "resourcePath": "/apache/pulsar/pull/21592",
        "createdAt": "2023-11-20T00:36:00Z",
        "number": 21592,
        "mergeCommit": {
          "oid": "7508700f53d0c2063961308f2fb279a36f5fc1d8",
          "message": "[fix][broker] Fix incorrect unack count when using shared subscription on non-persistent topic (#21592)\n\nFixes #21568\r\n\r\nMotivation\r\nFix incorrect unack count when using shared subscription on non-persistent topic\r\n\r\nModifications\r\nIn the case of a non-persistent topic, the consumer does not send an ack to the broker (see org.apache.pulsar.client.impl.NonPersistentAcknowledgmentGroupingTracker# addAcknowledgment)\r\n\r\nTo work around this, we can update unackedMessages when the broker sends a message to the consumer successfully.",
          "commitUrl": "https://github.com/apache/pulsar/commit/7508700f53d0c2063961308f2fb279a36f5fc1d8",
          "parents": {
            "nodes": [
              {
                "oid": "e27070afffbda7ebe22d8ba001bb26123e5e3674",
                "message": "[fix][admin] Fix KeyValue schema compatibility check caused OOM (#21645)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Consumer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/stats/ConsumerStatsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5f2uYo2gAoMmZkMDI3ZGE5ZDBmOWUyMjBmMWFjM2MxMzFiZWY2ZjQ1ZmMwZDM0Zg",
                "url": "https://github.com/apache/pulsar/pull/21592/commits/2fd027da9d0f9e220f1ac3c131bef6f45fc0d34f"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21568,
                "url": "https://github.com/apache/pulsar/issues/21568",
                "title": "[Bug] Unacked message counter is wrong",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Both 2.11.2 and 3.1.1 images</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Start Pulsar standalone docker image</li>\n<li>Create a Producer publishing to a non-persistent topic</li>\n<li>Create a Shared Consumer that listens to the topic, consumes messages, ack messages</li>\n</ol>\n<p dir=\"auto\">Code example:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"import org.apache.pulsar.client.api.PulsarClient;\nimport org.apache.pulsar.client.api.Producer;\nimport org.apache.pulsar.client.api.Schema;\n\npublic class PulsarProducer {\n\n    public static void main(String[] args) throws Exception {\n        PulsarClient client = PulsarClient.builder()\n                .serviceUrl(&quot;pulsar://localhost:6650&quot;)\n                .build();\n\n        Producer&lt;String&gt; producer = client.newProducer(Schema.STRING)\n                .topic(&quot;non-persistent://public/default/my-topic&quot;)\n                .create();\n\n        while (true) {\n            System.out.println(&quot;Sending message...&quot;);\n            String msg = &quot;&quot;&quot;\n                    { &quot;foo&quot;: &quot;bar&quot; }&quot;&quot;&quot;;\n            producer.send(msg);\n            Thread.sleep(5000); // Sleep for 5 seconds\n        }\n\n        // Never reaches here in this example\n        // producer.close();\n        // client.close();\n    }\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">import org.apache.pulsar.client.api.PulsarClient;\nimport org.apache.pulsar.client.api.Producer;\nimport org.apache.pulsar.client.api.Schema;\n\npublic class PulsarProducer {\n\n    public static void main(String[] args) throws Exception {\n        PulsarClient client = PulsarClient.builder()\n                .serviceUrl(\"pulsar://localhost:6650\")\n                .build();\n\n        Producer&lt;String&gt; producer = client.newProducer(Schema.STRING)\n                .topic(\"non-persistent://public/default/my-topic\")\n                .create();\n\n        while (true) {\n            System.out.println(\"Sending message...\");\n            String msg = \"\"\"\n                    { \"foo\": \"bar\" }\"\"\";\n            producer.send(msg);\n            Thread.sleep(5000); // Sleep for 5 seconds\n        }\n\n        // Never reaches here in this example\n        // producer.close();\n        // client.close();\n    }\n}\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"import org.apache.pulsar.client.api.*;\n\npublic class PulsarConsumer {\n\n    public static void main(String[] args) throws Exception {\n        PulsarClient client = PulsarClient.builder()\n                .serviceUrl(&quot;pulsar://localhost:6650&quot;)\n                .build();\n\n        Consumer&lt;String&gt; consumer = client.newConsumer(Schema.STRING)\n                .topic(&quot;non-persistent://public/default/my-topic&quot;)\n                .subscriptionName(&quot;my-shared-subscription&quot;)\n                .subscriptionType(SubscriptionType.Shared)\n                .subscribe();\n\n        while (true) {\n            // Wait for a message\n            Message&lt;String&gt; msg = consumer.receive();\n            try {\n                System.out.printf(&quot;Message received: %s\\n&quot;, new String(msg.getData()));\n                // Acknowledge the message so that it can be deleted by the message broker\n                consumer.acknowledge(msg);\n            } catch (Exception e) {\n                consumer.negativeAcknowledge(msg);\n            }\n        }\n\n        // Never reaches here in this example\n        // consumer.close();\n        // client.close();\n    }\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">import org.apache.pulsar.client.api.*;\n\npublic class PulsarConsumer {\n\n    public static void main(String[] args) throws Exception {\n        PulsarClient client = PulsarClient.builder()\n                .serviceUrl(\"pulsar://localhost:6650\")\n                .build();\n\n        Consumer&lt;String&gt; consumer = client.newConsumer(Schema.STRING)\n                .topic(\"non-persistent://public/default/my-topic\")\n                .subscriptionName(\"my-shared-subscription\")\n                .subscriptionType(SubscriptionType.Shared)\n                .subscribe();\n\n        while (true) {\n            // Wait for a message\n            Message&lt;String&gt; msg = consumer.receive();\n            try {\n                System.out.printf(\"Message received: %s\\n\", new String(msg.getData()));\n                // Acknowledge the message so that it can be deleted by the message broker\n                consumer.acknowledge(msg);\n            } catch (Exception e) {\n                consumer.negativeAcknowledge(msg);\n            }\n        }\n\n        // Never reaches here in this example\n        // consumer.close();\n        // client.close();\n    }\n}\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">When I run</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"pulsar-admin topics stats &quot;non-persistent://public/default/my-topic&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">pulsar-admin topics stats \"non-persistent://public/default/my-topic\"\n</code></pre></div>\n<p dir=\"auto\">I expected to see unackedMessages equal to zero</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Instead, I'm seeing unackedMessages not equal to zero but it's growing with every processed message</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21568",
                "createdAt": "2023-11-13T08:43:10Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][sec] Support for Elliptic Curve Cryptography (EC, ECC) (certificates/private keys)",
        "url": "https://github.com/apache/pulsar/pull/21621",
        "resourcePath": "/apache/pulsar/pull/21621",
        "createdAt": "2023-11-24T13:19:35Z",
        "number": 21621,
        "mergeCommit": {
          "oid": "e1d06b5f54f08c09debab7a9a513b7c173c1779b",
          "message": "[improve][sec] Support for Elliptic Curve Cryptography (EC, ECC) (certificates/private keys) (#21621)",
          "commitUrl": "https://github.com/apache/pulsar/commit/e1d06b5f54f08c09debab7a9a513b7c173c1779b",
          "parents": {
            "nodes": [
              {
                "oid": "8dac8a5dbfb9fb6d3338310de13080d4816c477f",
                "message": "[improve][doc] Clarify to check numbering when creating the PIP doc (#21623)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/certificate-authority/ec/jks/client.signed.cert.pem"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/certificate-authority/ec/jks/key_store_generation.txt"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/certificate-authority/ec/jks/server.cert.pem"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/certificate-authority/ec/jks/server.keystore.jks"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/certificate-authority/ec/jks/server.signed.cert.pem"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/certificate-authority/ec/server.cert.pem"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/certificate-authority/ec/server.conf"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/certificate-authority/ec/server.csr.pem"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/certificate-authority/ec/server.key-pk8.pem"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/certificate-authority/ec/server.key.pem"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5gTuu32gAoNzk1OGIyZDg5NWQ5YWU1M2Q2YmU4ZDVlOTQ3NmE1NmM5YjZjNTRlYQ",
                "url": "https://github.com/apache/pulsar/pull/21621/commits/7958b2d895d9ae53d6be8d5e9476a56c9b6c54ea"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21599,
                "url": "https://github.com/apache/pulsar/issues/21599",
                "title": "[Bug] ECDSA X509 private keys are crashing the brokers",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">3.1.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Configure the Apache Pulsar as per standard docs and use ECDSA keys instead of RSA.</p>\n<p dir=\"auto\">Sample Private key</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"-----BEGIN EC PRIVATE KEY-----\nMIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgazGsqbEbxfbPuPvi\nO6jXRPNqmktZmB/qbaW36dcyRL6hRANCAASTE+XBhDy+ZKdqx3VxBrkfsTRkXUKe\nNN4mW12RLkk1jzU0NIVAjIJ+s939X/6WfC84bpFotR4J5aNcBV7G4hKF\n-----END EC PRIVATE KEY-----\"><pre class=\"notranslate\"><code class=\"notranslate\">-----BEGIN EC PRIVATE KEY-----\nMIGHAgEAMBMGByqGSM49AgEGCCqGSM49AwEHBG0wawIBAQQgazGsqbEbxfbPuPvi\nO6jXRPNqmktZmB/qbaW36dcyRL6hRANCAASTE+XBhDy+ZKdqx3VxBrkfsTRkXUKe\nNN4mW12RLkk1jzU0NIVAjIJ+s939X/6WfC84bpFotR4J5aNcBV7G4hKF\n-----END EC PRIVATE KEY-----\n</code></pre></div>\n<p dir=\"auto\">Sample Cert</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"-----BEGIN CERTIFICATE-----\nMIICEDCCAbagAwIBAgIQcz6Xu7uN65O1zZfSXJtAVTAKBggqhkjOPQQDAjAeMQsw\nCQYDVQQGEwJVUzEPMA0GA1UEChMGU1BJRkZFMB4XDTIzMTEyMDEwNTMxNloXDTIz\nMTEyMDExNTMyNlowSDELMAkGA1UEBhMCVVMxDjAMBgNVBAoTBVNQSVJFMSkwJwYD\nVQQtEyBmN2ZhMDUxYjY2MGYyYmUzNGU1NDA1NmE4YzRlMjgxYTBZMBMGByqGSM49\nAgEGCCqGSM49AwEHA0IABJMT5cGEPL5kp2rHdXEGuR+xNGRdQp403iZbXZEuSTWP\nNTQ0hUCMgn6z3f1f/pZ8LzhukWi1Hgnlo1wFXsbiEoWjgaswgagwDgYDVR0PAQH/\nBAQDAgOoMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAMBgNVHRMBAf8E\nAjAAMB0GA1UdDgQWBBRcM/qknVmhjlPic4nTtw6qvr9G9zAfBgNVHSMEGDAWgBR6\nZnTUlLssxViFpo6o1HKXj5uPETApBgNVHREEIjAghh5zcGlmZmU6Ly9leGFtcGxl\nLm9yZy9teXNlcnZpY2UwCgYIKoZIzj0EAwIDSAAwRQIhAO9TxcbIsfASe0oeek1o\n42Fjo2f7NfRf4cdoptB9/e7NAiBPK6AtBUF/YpKIbiNoKbx7gpr6n+mzgZ8KzFee\na5luJQ==\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIB4TCCAWegAwIBAgIRANYwzjm+dA9oi34juhIXLRUwCgYIKoZIzj0EAwMwHjEL\nMAkGA1UEBhMCVVMxDzANBgNVBAoMBlNQSUZGRTAeFw0yMzExMjAwMDIwMDRaFw0y\nMzExMjEwMDIwMTRaMB4xCzAJBgNVBAYTAlVTMQ8wDQYDVQQKEwZTUElGRkUwWTAT\nBgcqhkjOPQIBBggqhkjOPQMBBwNCAAR/0PbgQ2xi9Keze7TLmB7g0QwKVxxAziYD\n9ZaSlNCmSksms3aFZDmTD40LDQEvGVpUsH5y6JblvijeEzVSeyqXo4GFMIGCMA4G\nA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBR6ZnTUlLss\nxViFpo6o1HKXj5uPETAfBgNVHSMEGDAWgBSSiuNgxqqnz2r/jRcWsARqphwQ/zAf\nBgNVHREEGDAWhhRzcGlmZmU6Ly9leGFtcGxlLm9yZzAKBggqhkjOPQQDAwNoADBl\nAjAD6QMk7G1f4ydvhl6DGiKbFdqMsJl1NwLAKDAeqi+LRyeBjvaNb7aPD4o8Nebx\ndTMCMQDUC6+52Dbt97JqYfmVwsTmrj9wmLvBOVqiBfsHWr8kE/5m93QBwSXozlgl\nmB8tb3U=\n-----END CERTIFICATE-----\"><pre class=\"notranslate\"><code class=\"notranslate\">-----BEGIN CERTIFICATE-----\nMIICEDCCAbagAwIBAgIQcz6Xu7uN65O1zZfSXJtAVTAKBggqhkjOPQQDAjAeMQsw\nCQYDVQQGEwJVUzEPMA0GA1UEChMGU1BJRkZFMB4XDTIzMTEyMDEwNTMxNloXDTIz\nMTEyMDExNTMyNlowSDELMAkGA1UEBhMCVVMxDjAMBgNVBAoTBVNQSVJFMSkwJwYD\nVQQtEyBmN2ZhMDUxYjY2MGYyYmUzNGU1NDA1NmE4YzRlMjgxYTBZMBMGByqGSM49\nAgEGCCqGSM49AwEHA0IABJMT5cGEPL5kp2rHdXEGuR+xNGRdQp403iZbXZEuSTWP\nNTQ0hUCMgn6z3f1f/pZ8LzhukWi1Hgnlo1wFXsbiEoWjgaswgagwDgYDVR0PAQH/\nBAQDAgOoMB0GA1UdJQQWMBQGCCsGAQUFBwMBBggrBgEFBQcDAjAMBgNVHRMBAf8E\nAjAAMB0GA1UdDgQWBBRcM/qknVmhjlPic4nTtw6qvr9G9zAfBgNVHSMEGDAWgBR6\nZnTUlLssxViFpo6o1HKXj5uPETApBgNVHREEIjAghh5zcGlmZmU6Ly9leGFtcGxl\nLm9yZy9teXNlcnZpY2UwCgYIKoZIzj0EAwIDSAAwRQIhAO9TxcbIsfASe0oeek1o\n42Fjo2f7NfRf4cdoptB9/e7NAiBPK6AtBUF/YpKIbiNoKbx7gpr6n+mzgZ8KzFee\na5luJQ==\n-----END CERTIFICATE-----\n-----BEGIN CERTIFICATE-----\nMIIB4TCCAWegAwIBAgIRANYwzjm+dA9oi34juhIXLRUwCgYIKoZIzj0EAwMwHjEL\nMAkGA1UEBhMCVVMxDzANBgNVBAoMBlNQSUZGRTAeFw0yMzExMjAwMDIwMDRaFw0y\nMzExMjEwMDIwMTRaMB4xCzAJBgNVBAYTAlVTMQ8wDQYDVQQKEwZTUElGRkUwWTAT\nBgcqhkjOPQIBBggqhkjOPQMBBwNCAAR/0PbgQ2xi9Keze7TLmB7g0QwKVxxAziYD\n9ZaSlNCmSksms3aFZDmTD40LDQEvGVpUsH5y6JblvijeEzVSeyqXo4GFMIGCMA4G\nA1UdDwEB/wQEAwIBBjAPBgNVHRMBAf8EBTADAQH/MB0GA1UdDgQWBBR6ZnTUlLss\nxViFpo6o1HKXj5uPETAfBgNVHSMEGDAWgBSSiuNgxqqnz2r/jRcWsARqphwQ/zAf\nBgNVHREEGDAWhhRzcGlmZmU6Ly9leGFtcGxlLm9yZzAKBggqhkjOPQQDAwNoADBl\nAjAD6QMk7G1f4ydvhl6DGiKbFdqMsJl1NwLAKDAeqi+LRyeBjvaNb7aPD4o8Nebx\ndTMCMQDUC6+52Dbt97JqYfmVwsTmrj9wmLvBOVqiBfsHWr8kE/5m93QBwSXozlgl\nmB8tb3U=\n-----END CERTIFICATE-----\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Pulsar Proxy/Brokers should start normally</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Exception in the startup logs</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-11-20T20:59:45,765+0530 [main] ERROR org.apache.pulsar.common.util.SslContextAutoRefreshBuilder - Exception while trying to refresh ssl Context Private key loading error\njava.security.KeyManagementException: Private key loading error\n\tat org.apache.pulsar.common.util.SecurityUtility.loadPrivateKeyFromPemStream(SecurityUtility.java:520) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.common.util.SecurityUtility.loadPrivateKeyFromPemFile(SecurityUtility.java:484) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.common.util.SecurityUtility.createSslContext(SecurityUtility.java:228) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.common.util.DefaultSslContextBuilder.update(DefaultSslContextBuilder.java:59) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.common.util.DefaultSslContextBuilder.update(DefaultSslContextBuilder.java:24) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.common.util.SslContextAutoRefreshBuilder.get(SslContextAutoRefreshBuilder.java:79) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.jetty.tls.JettySslContextFactory$Server.getSslContext(JettySslContextFactory.java:113) ~[org.apache.pulsar-pulsar-broker-common-3.1.1.jar:3.1.1]\n\tat org.eclipse.jetty.util.ssl.SslContextFactory.newSSLEngine(SslContextFactory.java:1903) ~[org.eclipse.jetty-jetty-util-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.server.SslConnectionFactory.doStart(SslConnectionFactory.java:99) ~[org.eclipse.jetty-jetty-server-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:73) ~[org.eclipse.jetty-jetty-util-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:169) ~[org.eclipse.jetty-jetty-util-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:117) ~[org.eclipse.jetty-jetty-util-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.server.AbstractConnector.doStart(AbstractConnector.java:323) ~[org.eclipse.jetty-jetty-server-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.server.AbstractNetworkConnector.doStart(AbstractNetworkConnector.java:81) ~[org.eclipse.jetty-jetty-server-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.server.ServerConnector.doStart(ServerConnector.java:234) ~[org.eclipse.jetty-jetty-server-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:73) ~[org.eclipse.jetty-jetty-util-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.server.Server.doStart(Server.java:401) ~[org.eclipse.jetty-jetty-server-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:73) ~[org.eclipse.jetty-jetty-util-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.apache.pulsar.broker.web.WebService.start(WebService.java:309) ~[org.apache.pulsar-pulsar-broker-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.broker.PulsarService.start(PulsarService.java:813) ~[org.apache.pulsar-pulsar-broker-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.PulsarStandalone.start(PulsarStandalone.java:349) ~[org.apache.pulsar-pulsar-broker-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.PulsarStandaloneStarter.main(PulsarStandaloneStarter.java:141) ~[org.apache.pulsar-pulsar-broker-3.1.1.jar:3.1.1]\nCaused by: java.security.spec.InvalidKeySpecException: java.security.InvalidKeyException: Invalid RSA private key\n\tat sun.security.rsa.RSAKeyFactory.engineGeneratePrivate(RSAKeyFactory.java:253) ~[?:?]\n\tat java.security.KeyFactory.generatePrivate(KeyFactory.java:389) ~[?:?]\n\tat org.apache.pulsar.common.util.SecurityUtility.loadPrivateKeyFromPemStream(SecurityUtility.java:518) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\t... 21 more\nCaused by: java.security.InvalidKeyException: Invalid RSA private key\n\tat sun.security.rsa.RSAPrivateCrtKeyImpl.parseKeyBits(RSAPrivateCrtKeyImpl.java:358) ~[?:?]\n\tat sun.security.rsa.RSAPrivateCrtKeyImpl.&lt;init&gt;(RSAPrivateCrtKeyImpl.java:163) ~[?:?]\n\tat sun.security.rsa.RSAPrivateCrtKeyImpl.newKey(RSAPrivateCrtKeyImpl.java:92) ~[?:?]\n\tat sun.security.rsa.RSAKeyFactory.generatePrivate(RSAKeyFactory.java:348) ~[?:?]\n\tat sun.security.rsa.RSAKeyFactory.engineGeneratePrivate(RSAKeyFactory.java:249) ~[?:?]\n\tat java.security.KeyFactory.generatePrivate(KeyFactory.java:389) ~[?:?]\n\tat org.apache.pulsar.common.util.SecurityUtility.loadPrivateKeyFromPemStream(SecurityUtility.java:518) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\t... 21 more\nCaused by: java.io.IOException: Version must be 0\n\tat sun.security.rsa.RSAPrivateCrtKeyImpl.parseASN1(RSAPrivateCrtKeyImpl.java:323) ~[?:?]\n\tat sun.security.rsa.RSAPrivateCrtKeyImpl.parseKeyBits(RSAPrivateCrtKeyImpl.java:348) ~[?:?]\n\tat sun.security.rsa.RSAPrivateCrtKeyImpl.&lt;init&gt;(RSAPrivateCrtKeyImpl.java:163) ~[?:?]\n\tat sun.security.rsa.RSAPrivateCrtKeyImpl.newKey(RSAPrivateCrtKeyImpl.java:92) ~[?:?]\n\tat sun.security.rsa.RSAKeyFactory.generatePrivate(RSAKeyFactory.java:348) ~[?:?]\n\tat sun.security.rsa.RSAKeyFactory.engineGeneratePrivate(RSAKeyFactory.java:249) ~[?:?]\n\tat java.security.KeyFactory.generatePrivate(KeyFactory.java:389) ~[?:?]\n\tat org.apache.pulsar.common.util.SecurityUtility.loadPrivateKeyFromPemStream(SecurityUtility.java:518) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\t... 21 more\n2023-11-20T20:59:45,770+0530 [main] ERROR org.apache.pulsar.broker.PulsarService - Failed to start Pulsar service: java.lang.NullPointerException: Cannot invoke &quot;javax.net.ssl.SSLContext.createSSLEngine()&quot; because &quot;context&quot; is null\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-11-20T20:59:45,765+0530 [main] ERROR org.apache.pulsar.common.util.SslContextAutoRefreshBuilder - Exception while trying to refresh ssl Context Private key loading error\njava.security.KeyManagementException: Private key loading error\n\tat org.apache.pulsar.common.util.SecurityUtility.loadPrivateKeyFromPemStream(SecurityUtility.java:520) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.common.util.SecurityUtility.loadPrivateKeyFromPemFile(SecurityUtility.java:484) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.common.util.SecurityUtility.createSslContext(SecurityUtility.java:228) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.common.util.DefaultSslContextBuilder.update(DefaultSslContextBuilder.java:59) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.common.util.DefaultSslContextBuilder.update(DefaultSslContextBuilder.java:24) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.common.util.SslContextAutoRefreshBuilder.get(SslContextAutoRefreshBuilder.java:79) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.jetty.tls.JettySslContextFactory$Server.getSslContext(JettySslContextFactory.java:113) ~[org.apache.pulsar-pulsar-broker-common-3.1.1.jar:3.1.1]\n\tat org.eclipse.jetty.util.ssl.SslContextFactory.newSSLEngine(SslContextFactory.java:1903) ~[org.eclipse.jetty-jetty-util-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.server.SslConnectionFactory.doStart(SslConnectionFactory.java:99) ~[org.eclipse.jetty-jetty-server-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:73) ~[org.eclipse.jetty-jetty-util-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.util.component.ContainerLifeCycle.start(ContainerLifeCycle.java:169) ~[org.eclipse.jetty-jetty-util-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.util.component.ContainerLifeCycle.doStart(ContainerLifeCycle.java:117) ~[org.eclipse.jetty-jetty-util-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.server.AbstractConnector.doStart(AbstractConnector.java:323) ~[org.eclipse.jetty-jetty-server-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.server.AbstractNetworkConnector.doStart(AbstractNetworkConnector.java:81) ~[org.eclipse.jetty-jetty-server-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.server.ServerConnector.doStart(ServerConnector.java:234) ~[org.eclipse.jetty-jetty-server-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:73) ~[org.eclipse.jetty-jetty-util-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.server.Server.doStart(Server.java:401) ~[org.eclipse.jetty-jetty-server-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.eclipse.jetty.util.component.AbstractLifeCycle.start(AbstractLifeCycle.java:73) ~[org.eclipse.jetty-jetty-util-9.4.51.v20230217.jar:9.4.51.v20230217]\n\tat org.apache.pulsar.broker.web.WebService.start(WebService.java:309) ~[org.apache.pulsar-pulsar-broker-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.broker.PulsarService.start(PulsarService.java:813) ~[org.apache.pulsar-pulsar-broker-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.PulsarStandalone.start(PulsarStandalone.java:349) ~[org.apache.pulsar-pulsar-broker-3.1.1.jar:3.1.1]\n\tat org.apache.pulsar.PulsarStandaloneStarter.main(PulsarStandaloneStarter.java:141) ~[org.apache.pulsar-pulsar-broker-3.1.1.jar:3.1.1]\nCaused by: java.security.spec.InvalidKeySpecException: java.security.InvalidKeyException: Invalid RSA private key\n\tat sun.security.rsa.RSAKeyFactory.engineGeneratePrivate(RSAKeyFactory.java:253) ~[?:?]\n\tat java.security.KeyFactory.generatePrivate(KeyFactory.java:389) ~[?:?]\n\tat org.apache.pulsar.common.util.SecurityUtility.loadPrivateKeyFromPemStream(SecurityUtility.java:518) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\t... 21 more\nCaused by: java.security.InvalidKeyException: Invalid RSA private key\n\tat sun.security.rsa.RSAPrivateCrtKeyImpl.parseKeyBits(RSAPrivateCrtKeyImpl.java:358) ~[?:?]\n\tat sun.security.rsa.RSAPrivateCrtKeyImpl.&lt;init&gt;(RSAPrivateCrtKeyImpl.java:163) ~[?:?]\n\tat sun.security.rsa.RSAPrivateCrtKeyImpl.newKey(RSAPrivateCrtKeyImpl.java:92) ~[?:?]\n\tat sun.security.rsa.RSAKeyFactory.generatePrivate(RSAKeyFactory.java:348) ~[?:?]\n\tat sun.security.rsa.RSAKeyFactory.engineGeneratePrivate(RSAKeyFactory.java:249) ~[?:?]\n\tat java.security.KeyFactory.generatePrivate(KeyFactory.java:389) ~[?:?]\n\tat org.apache.pulsar.common.util.SecurityUtility.loadPrivateKeyFromPemStream(SecurityUtility.java:518) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\t... 21 more\nCaused by: java.io.IOException: Version must be 0\n\tat sun.security.rsa.RSAPrivateCrtKeyImpl.parseASN1(RSAPrivateCrtKeyImpl.java:323) ~[?:?]\n\tat sun.security.rsa.RSAPrivateCrtKeyImpl.parseKeyBits(RSAPrivateCrtKeyImpl.java:348) ~[?:?]\n\tat sun.security.rsa.RSAPrivateCrtKeyImpl.&lt;init&gt;(RSAPrivateCrtKeyImpl.java:163) ~[?:?]\n\tat sun.security.rsa.RSAPrivateCrtKeyImpl.newKey(RSAPrivateCrtKeyImpl.java:92) ~[?:?]\n\tat sun.security.rsa.RSAKeyFactory.generatePrivate(RSAKeyFactory.java:348) ~[?:?]\n\tat sun.security.rsa.RSAKeyFactory.engineGeneratePrivate(RSAKeyFactory.java:249) ~[?:?]\n\tat java.security.KeyFactory.generatePrivate(KeyFactory.java:389) ~[?:?]\n\tat org.apache.pulsar.common.util.SecurityUtility.loadPrivateKeyFromPemStream(SecurityUtility.java:518) ~[org.apache.pulsar-pulsar-common-3.1.1.jar:3.1.1]\n\t... 21 more\n2023-11-20T20:59:45,770+0530 [main] ERROR org.apache.pulsar.broker.PulsarService - Failed to start Pulsar service: java.lang.NullPointerException: Cannot invoke \"javax.net.ssl.SSLContext.createSSLEngine()\" because \"context\" is null\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The bug is in the code </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/98bf9dd72910e1b02dea17148a4199e3b26d7147/pulsar-common/src/main/java/org/apache/pulsar/common/util/SecurityUtility.java#L516\">pulsar/pulsar-common/src/main/java/org/apache/pulsar/common/util/SecurityUtility.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 516\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/98bf9dd72910e1b02dea17148a4199e3b26d7147\">98bf9dd</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L516\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"516\"></td>\n          <td id=\"LC516\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-smi\">KeyFactory</span> <span class=\"pl-s1\">kf</span> = <span class=\"pl-smi\">KeyFactory</span>.<span class=\"pl-en\">getInstance</span>(<span class=\"pl-s\">\"RSA\"</span>); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n where its supporting only <strong>RSA</strong> keys.<p></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21599",
                "createdAt": "2023-11-20T15:59:47Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fixed getting incorrect KeyValue schema version",
        "url": "https://github.com/apache/pulsar/pull/21632",
        "resourcePath": "/apache/pulsar/pull/21632",
        "createdAt": "2023-11-28T08:16:49Z",
        "number": 21632,
        "mergeCommit": {
          "oid": "81a9a527b353c07db0743f970edb009a929888fe",
          "message": "[fix][broker] Fixed getting incorrect KeyValue schema version (#21632)",
          "commitUrl": "https://github.com/apache/pulsar/commit/81a9a527b353c07db0743f970edb009a929888fe",
          "parents": {
            "nodes": [
              {
                "oid": "e820f90c925efdcab781771e485c5370a0f2fd4f",
                "message": "[improve][sec] Align the default mechanism for server to request certificates (#21625)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/SchemasResourceBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/SchemaServiceTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/HttpLookupService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/client/impl/schema/SchemaUtils.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ghmyJ2gAoZTU4YmUyYmUxODM1ZmU0NWRlY2IwMTY4ODg3MjUxNTFiY2U3MDMxZg",
                "url": "https://github.com/apache/pulsar/pull/21632/commits/e58be2be1835fe45decb016888725151bce7031f"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21587,
                "url": "https://github.com/apache/pulsar/issues/21587",
                "title": "[Bug] Pulsar Admin getVersionBySchema with KeyValue schema responds with -1",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Ubuntu 23.04 x64.<br>\nApache Pulsar 3.1.1.<br>\nDocker image: apachepulsar/pulsar-all:3.1.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">In Scala 3.3.0:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"val pulsarAdmin = PulsarAdmin.builder.serviceHttpUrl(&quot;*some http url*&quot;).build\nval topicFqn = &quot;*some topic fqn*&quot;\n\n//Create KeyValue schema \npulsarAdmin.schemas.createSchema(\n  topicFqn, \n  KeyValueSchemaInfo.encodeKeyValueSchemaInfo(\n    &quot;keyValue&quot;, \n    SchemaInfo.builder\n       .name(&quot;&quot;)\n       .`type`(SchemaType.STRING)\n       .properties(Map.empty.asJava)\n       .schema(Array.empty[Byte])\n       .build,\n    SchemaInfo.builder\n       .name(&quot;&quot;)\n       .`type`(SchemaType.BOOLEAN)\n       .properties(Map.empty.asJava)\n       .schema(Array.empty[Byte])\n       .build,\n    KeyValueEncodingType.SEPARATED // or KeyValueEncodingType.INLINE\n  )\n)\n\nval schemaInfoWithVersion = pulsarAdmin.schemas.getSchemaInfoWithVersion(topicFqn) \n// schemaInfoWithVersion.getVersion gives correct value\n\nval version = pulsarAdmin.schemas.getVersionBySchema(topicFqn, schemaInfoWithVersion.getSchemaInfo) // gives -1\"><pre class=\"notranslate\"><code class=\"notranslate\">val pulsarAdmin = PulsarAdmin.builder.serviceHttpUrl(\"*some http url*\").build\nval topicFqn = \"*some topic fqn*\"\n\n//Create KeyValue schema \npulsarAdmin.schemas.createSchema(\n  topicFqn, \n  KeyValueSchemaInfo.encodeKeyValueSchemaInfo(\n    \"keyValue\", \n    SchemaInfo.builder\n       .name(\"\")\n       .`type`(SchemaType.STRING)\n       .properties(Map.empty.asJava)\n       .schema(Array.empty[Byte])\n       .build,\n    SchemaInfo.builder\n       .name(\"\")\n       .`type`(SchemaType.BOOLEAN)\n       .properties(Map.empty.asJava)\n       .schema(Array.empty[Byte])\n       .build,\n    KeyValueEncodingType.SEPARATED // or KeyValueEncodingType.INLINE\n  )\n)\n\nval schemaInfoWithVersion = pulsarAdmin.schemas.getSchemaInfoWithVersion(topicFqn) \n// schemaInfoWithVersion.getVersion gives correct value\n\nval version = pulsarAdmin.schemas.getVersionBySchema(topicFqn, schemaInfoWithVersion.getSchemaInfo) // gives -1\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Expected to see correct schema version as a Long value.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Always receive response -1.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21587",
                "createdAt": "2023-11-16T17:30:39Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix the bug caused by unload topic and compaction task failure after task is triggered",
        "url": "https://github.com/apache/pulsar/pull/21634",
        "resourcePath": "/apache/pulsar/pull/21634",
        "createdAt": "2023-11-28T16:16:33Z",
        "number": 21634,
        "mergeCommit": {
          "oid": "2bf13547bf4b4ec9babd6513a87dffbd53d678bb",
          "message": "[fix][test] Fix the bug caused by unload topic and compaction task failure after task is triggered (#21634)",
          "commitUrl": "https://github.com/apache/pulsar/commit/2bf13547bf4b4ec9babd6513a87dffbd53d678bb",
          "parents": {
            "nodes": [
              {
                "oid": "575a4840fcb627ad04fef29424824433a0f0a110",
                "message": "[improve][pip] PIP-315: Configurable max delay limit for delayed delivery (#21490)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/compaction/CompactionTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5gkwDu2gAoNWFlMzQwZjlhYTJkYzM2YzUxNWZiYTRhMzg0NDcwYWVhMmI2MDkyZA",
                "url": "https://github.com/apache/pulsar/pull/21634/commits/5ae340f9aa2dc36c515fba4a384470aea2b6092d"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21537,
                "url": "https://github.com/apache/pulsar/issues/21537",
                "title": "Flaky-test: StrategicCompactionTest.testCompactionDuplicate",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failures</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6692097300/job/18185345590#step:11:687\">2023-10-30T13:50:59.0671658Z</a></li>\n</ul>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"org.awaitility.core.ConditionTimeoutException: Assertion condition defined as a org.apache.pulsar.compaction.CompactionTest expected [568] but found [-1] within 10 seconds.\n\tat org.awaitility.core.ConditionAwaiter.await(ConditionAwaiter.java:167)\n\tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:119)\n\tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:31)\n\tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:985)\n\tat org.awaitility.core.ConditionFactory.untilAsserted(ConditionFactory.java:769)\n\tat org.apache.pulsar.compaction.CompactionTest.testCompactionDuplicate(CompactionTest.java:1967)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:833)\nCaused by: java.lang.AssertionError: expected [568] but found [-1]\n\tat org.testng.Assert.fail(Assert.java:110)\n\tat org.testng.Assert.failNotEquals(Assert.java:1577)\n\tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n\tat org.testng.Assert.assertEquals(Assert.java:131)\n\tat org.testng.Assert.assertEquals(Assert.java:979)\n\tat org.testng.Assert.assertEquals(Assert.java:955)\n\tat org.testng.Assert.assertEquals(Assert.java:989)\n\tat org.apache.pulsar.compaction.CompactionTest.lambda$testCompactionDuplicate$8(CompactionTest.java:1970)\n\tat org.awaitility.core.AssertionCondition.lambda$new$0(AssertionCondition.java:53)\n\tat org.awaitility.core.ConditionAwaiter$ConditionPoller.call(ConditionAwaiter.java:248)\n\tat org.awaitility.core.ConditionAwaiter$ConditionPoller.call(ConditionAwaiter.java:235)\n\t... 4 more\n\"><pre class=\"notranslate\"><code class=\"notranslate\">org.awaitility.core.ConditionTimeoutException: Assertion condition defined as a org.apache.pulsar.compaction.CompactionTest expected [568] but found [-1] within 10 seconds.\n\tat org.awaitility.core.ConditionAwaiter.await(ConditionAwaiter.java:167)\n\tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:119)\n\tat org.awaitility.core.AssertionCondition.await(AssertionCondition.java:31)\n\tat org.awaitility.core.ConditionFactory.until(ConditionFactory.java:985)\n\tat org.awaitility.core.ConditionFactory.untilAsserted(ConditionFactory.java:769)\n\tat org.apache.pulsar.compaction.CompactionTest.testCompactionDuplicate(CompactionTest.java:1967)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:833)\nCaused by: java.lang.AssertionError: expected [568] but found [-1]\n\tat org.testng.Assert.fail(Assert.java:110)\n\tat org.testng.Assert.failNotEquals(Assert.java:1577)\n\tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n\tat org.testng.Assert.assertEquals(Assert.java:131)\n\tat org.testng.Assert.assertEquals(Assert.java:979)\n\tat org.testng.Assert.assertEquals(Assert.java:955)\n\tat org.testng.Assert.assertEquals(Assert.java:989)\n\tat org.apache.pulsar.compaction.CompactionTest.lambda$testCompactionDuplicate$8(CompactionTest.java:1970)\n\tat org.awaitility.core.AssertionCondition.lambda$new$0(AssertionCondition.java:53)\n\tat org.awaitility.core.ConditionAwaiter$ConditionPoller.call(ConditionAwaiter.java:248)\n\tat org.awaitility.core.ConditionAwaiter$ConditionPoller.call(ConditionAwaiter.java:235)\n\t... 4 more\n\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21537",
                "createdAt": "2023-11-07T12:58:36Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve] #21580 @Deprecated added for newAck() methods",
        "url": "https://github.com/apache/pulsar/pull/21636",
        "resourcePath": "/apache/pulsar/pull/21636",
        "createdAt": "2023-11-28T19:44:07Z",
        "number": 21636,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Commands.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5gmBw42gAoZTRlMDY5NDdkNTRhNTA2NGI3YWY5NmYzOGNiYjA5YWQ3N2NjODQ1MQ",
                "url": "https://github.com/apache/pulsar/pull/21636/commits/e4e06947d54a5064b7af96f38cbb09ad77cc8451"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21580,
                "url": "https://github.com/apache/pulsar/issues/21580",
                "title": "Clean up methods used to create ack command",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Now we have 8 methods to create an ack command. We should consider to check which one is redundant.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/12592133/277639149-a833955f-e1e5-4df9-bb7e-f9cb78917239.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzMxMTgsIm5iZiI6MTcxNDk3MjgxOCwicGF0aCI6Ii8xMjU5MjEzMy8yNzc2MzkxNDktYTgzMzk1NWYtZTFlNS00ZGY5LWJiN2UtZjljYjc4OTE3MjM5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjAxOFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTJhYTJhODNhMDRjNmUzNDZhMzU5M2Y3ZGYwN2Y2NzFhM2FmNGI2YTY1NTk1Yzc0YzdhMWYwYWFjNjVmMGI3NWQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.FHJfsL2Rb2VLlToLORFmq4yGaW6Y0ldU1u64sXLQyNs\"><img width=\"638\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/12592133/277639149-a833955f-e1e5-4df9-bb7e-f9cb78917239.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzMxMTgsIm5iZiI6MTcxNDk3MjgxOCwicGF0aCI6Ii8xMjU5MjEzMy8yNzc2MzkxNDktYTgzMzk1NWYtZTFlNS00ZGY5LWJiN2UtZjljYjc4OTE3MjM5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjAxOFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTJhYTJhODNhMDRjNmUzNDZhMzU5M2Y3ZGYwN2Y2NzFhM2FmNGI2YTY1NTk1Yzc0YzdhMWYwYWFjNjVmMGI3NWQmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.FHJfsL2Rb2VLlToLORFmq4yGaW6Y0ldU1u64sXLQyNs\" style=\"max-width: 100%;\"></a><br>\nSee more details at <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1956860233\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/21419\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/21419/hovercard\" href=\"https://github.com/apache/pulsar/pull/21419\">#21419</a>.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Only keep <code class=\"notranslate\">public static ByteBuf newMultiMessageAck(long consumerId, TxnID txnID, List&lt;Triple&lt;Long, Long, ConcurrentBitSetRecyclable&gt;&gt; entries, long requestID) </code> and mark other methods as deprecated.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21580",
                "createdAt": "2023-11-14T12:14:19Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky test SimpleProducerConsumerStatTest#testPartitionTopicStats",
        "url": "https://github.com/apache/pulsar/pull/21642",
        "resourcePath": "/apache/pulsar/pull/21642",
        "createdAt": "2023-11-29T12:09:51Z",
        "number": 21642,
        "mergeCommit": {
          "oid": "93ed61bf9bf3470af8f44c170c4ae41b8a57f466",
          "message": "[fix][test] Fix flaky test SimpleProducerConsumerStatTest#testPartitionTopicStats (#21642)",
          "commitUrl": "https://github.com/apache/pulsar/commit/93ed61bf9bf3470af8f44c170c4ae41b8a57f466",
          "parents": {
            "nodes": [
              {
                "oid": "81a9a527b353c07db0743f970edb009a929888fe",
                "message": "[fix][broker] Fixed getting incorrect KeyValue schema version (#21632)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerStatTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5gqWJc2gAoOTFiMjBkMDJjNTlmYWQwZGQzOGMwZDE0MWY1NGI5NmRjMzA0MGU1Yg",
                "url": "https://github.com/apache/pulsar/pull/21642/commits/91b20d02c59fad0dd38c0d141f54b96dc3040e5b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21614,
                "url": "https://github.com/apache/pulsar/issues/21614",
                "title": "Flaky-test: SimpleProducerConsumerStatTest.testPartitionTopicStats",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failures</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6924059347/job/18832938299#step:11:1414\">2023-11-20T01:02:53.7594231Z</a></li>\n</ul>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.lang.AssertionError: Received message my-message-2 did not match the expected message my-message-1 expected [my-message-1] but found [my-message-2]\n\tat org.testng.Assert.fail(Assert.java:110)\n\tat org.testng.Assert.failNotEquals(Assert.java:1577)\n\tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n\tat org.testng.Assert.assertEquals(Assert.java:131)\n\tat org.apache.pulsar.client.api.ProducerConsumerBase.testMessageOrderAndDuplicates(ProducerConsumerBase.java:59)\n\tat org.apache.pulsar.client.api.SimpleProducerConsumerStatTest.testPartitionTopicStats(SimpleProducerConsumerStatTest.java:499)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:840)\n\"><pre class=\"notranslate\"><code class=\"notranslate\">java.lang.AssertionError: Received message my-message-2 did not match the expected message my-message-1 expected [my-message-1] but found [my-message-2]\n\tat org.testng.Assert.fail(Assert.java:110)\n\tat org.testng.Assert.failNotEquals(Assert.java:1577)\n\tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n\tat org.testng.Assert.assertEquals(Assert.java:131)\n\tat org.apache.pulsar.client.api.ProducerConsumerBase.testMessageOrderAndDuplicates(ProducerConsumerBase.java:59)\n\tat org.apache.pulsar.client.api.SimpleProducerConsumerStatTest.testPartitionTopicStats(SimpleProducerConsumerStatTest.java:499)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:840)\n\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21614",
                "createdAt": "2023-11-23T12:27:34Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][admin] Fix KeyValue schema compatibility check caused OOM",
        "url": "https://github.com/apache/pulsar/pull/21645",
        "resourcePath": "/apache/pulsar/pull/21645",
        "createdAt": "2023-11-30T01:55:53Z",
        "number": 21645,
        "mergeCommit": {
          "oid": "e27070afffbda7ebe22d8ba001bb26123e5e3674",
          "message": "[fix][admin] Fix KeyValue schema compatibility check caused OOM (#21645)",
          "commitUrl": "https://github.com/apache/pulsar/commit/e27070afffbda7ebe22d8ba001bb26123e5e3674",
          "parents": {
            "nodes": [
              {
                "oid": "4e7bff7f1d2a5fb5ef04c1e6428178675474ad39",
                "message": "[improve][sec] Delete announced deprecate method. (#21637)\n\nCo-authored-by: Jiwe Guo <technoboy@apache.org>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/SchemasResourceBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/SchemaServiceTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5guvBa2gAoZDczZTE3NjU4NzFkOGYyMmE1ZmE3YzA0ZTc2OWJiYWFkMTQ3ZjBlOQ",
                "url": "https://github.com/apache/pulsar/pull/21645/commits/d73e1765871d8f22a5fa7c04e769bbaad147f0e9"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21584,
                "url": "https://github.com/apache/pulsar/issues/21584",
                "title": "[Bug] Broker fails with OOM on KeyValue schema compatibility check",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Ubuntu 23.04 x64.<br>\nApache Pulsar 3.1.1.<br>\nDocker image: apachepulsar/pulsar-all:3.1.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">In Scala 3.3.0 implying that the topic doesn't have any schema applied to it:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"val pulsarAdmin = PulsarAdmin.builder.serviceHttpUrl(&quot;*some http url*&quot;).build\n\npulsarAdmin.schemas.testCompatibility(\n  &quot;*some topic fqn*&quot;, \n  KeyValueSchemaInfo.encodeKeyValueSchemaInfo(\n    &quot;keyValue&quot;, \n    SchemaInfo.builder\n       .name(&quot;&quot;)\n       .`type`(SchemaType.STRING)\n       .properties(Map.empty.asJava)\n       .schema(Array.empty[Byte])\n       .build,\n    SchemaInfo.builder\n       .name(&quot;&quot;)\n       .`type`(SchemaType.BOOLEAN)\n       .properties(Map.empty.asJava)\n       .schema(Array.empty[Byte])\n       .build,\n    KeyValueEncodingType.SEPARATED // or KeyValueEncodingType.INLINE\n  )\n)\"><pre class=\"notranslate\"><code class=\"notranslate\">val pulsarAdmin = PulsarAdmin.builder.serviceHttpUrl(\"*some http url*\").build\n\npulsarAdmin.schemas.testCompatibility(\n  \"*some topic fqn*\", \n  KeyValueSchemaInfo.encodeKeyValueSchemaInfo(\n    \"keyValue\", \n    SchemaInfo.builder\n       .name(\"\")\n       .`type`(SchemaType.STRING)\n       .properties(Map.empty.asJava)\n       .schema(Array.empty[Byte])\n       .build,\n    SchemaInfo.builder\n       .name(\"\")\n       .`type`(SchemaType.BOOLEAN)\n       .properties(Map.empty.asJava)\n       .schema(Array.empty[Byte])\n       .build,\n    KeyValueEncodingType.SEPARATED // or KeyValueEncodingType.INLINE\n  )\n)\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Expected to see the response object like:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"IsCompatibilityResponse(\n  isCompatibility=true,\n  schemaCompatibilityStrategy=FULL\n)\"><pre class=\"notranslate\"><code class=\"notranslate\">IsCompatibilityResponse(\n  isCompatibility=true,\n  schemaCompatibilityStrategy=FULL\n)\n</code></pre></div>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Code invocation above throws</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"--- An unexpected error occurred in the server ---\n\nMessage: Java heap space\n\nStacktrace:\n\njava.lang.OutOfMemoryError: Java heap space \"><pre class=\"notranslate\"><code class=\"notranslate\">--- An unexpected error occurred in the server ---\n\nMessage: Java heap space\n\nStacktrace:\n\njava.lang.OutOfMemoryError: Java heap space \n</code></pre></div>\n<p dir=\"auto\">despite the Key schema type and Value schema type.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">There's only one PR that is related to the problem somehow:<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"439496537\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/4192\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/4192/hovercard\" href=\"https://github.com/apache/pulsar/pull/4192\">#4192</a></p>\n<p dir=\"auto\">After increase of heap memory up to 2048mb it fails with:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\" --- An unexpected error occurred in the server ---\n\nMessage: Java heap space\n\nStacktrace:\n\njava.lang.OutOfMemoryError: Java heap space\n\tat org.apache.pulsar.common.schema.KeyValue.decode(KeyValue.java:135)\n\tat org.apache.pulsar.client.impl.schema.KeyValueSchemaInfo.decodeKeyValueSchemaInfo(KeyValueSchemaInfo.java:201)\n\tat org.apache.pulsar.broker.service.schema.KeyValueSchemaCompatibilityCheck.decodeKeyValueSchemaData(KeyValueSchemaCompatibilityCheck.java:45)\n\tat org.apache.pulsar.broker.service.schema.validator.SchemaDataValidator.validateSchemaData(SchemaDataValidator.java:77)\n\tat org.apache.pulsar.broker.service.schema.validator.SchemaRegistryServiceWithSchemaDataValidator.isCompatible(SchemaRegistryServiceWithSchemaDataValidator.java:118)\n\tat org.apache.pulsar.broker.admin.impl.SchemasResourceBase.lambda$testCompatibilityAsync$10(SchemasResourceBase.java:149)\n\tat org.apache.pulsar.broker.admin.impl.SchemasResourceBase$$Lambda$1581/0x00007f72a89b2920.apply(Unknown Source)\n\tat java.base/java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:1150)\n\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n\tat org.apache.pulsar.client.util.RetryUtil.lambda$executeWithRetry$2(RetryUtil.java:62)\n\tat org.apache.pulsar.client.util.RetryUtil$$Lambda$863/0x00007f72a87534a0.accept(Unknown Source)\n\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n\tat java.base/java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:887)\n\tat java.base/java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2325)\n\tat org.apache.pulsar.client.util.RetryUtil.executeWithRetry(RetryUtil.java:48)\n\tat org.apache.pulsar.client.util.RetryUtil.lambda$retryAsynchronously$0(RetryUtil.java:42)\n\tat org.apache.pulsar.client.util.RetryUtil$$Lambda$756/0x00007f72a8700db0.run(Unknown Source)\n\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\"> --- An unexpected error occurred in the server ---\n\nMessage: Java heap space\n\nStacktrace:\n\njava.lang.OutOfMemoryError: Java heap space\n\tat org.apache.pulsar.common.schema.KeyValue.decode(KeyValue.java:135)\n\tat org.apache.pulsar.client.impl.schema.KeyValueSchemaInfo.decodeKeyValueSchemaInfo(KeyValueSchemaInfo.java:201)\n\tat org.apache.pulsar.broker.service.schema.KeyValueSchemaCompatibilityCheck.decodeKeyValueSchemaData(KeyValueSchemaCompatibilityCheck.java:45)\n\tat org.apache.pulsar.broker.service.schema.validator.SchemaDataValidator.validateSchemaData(SchemaDataValidator.java:77)\n\tat org.apache.pulsar.broker.service.schema.validator.SchemaRegistryServiceWithSchemaDataValidator.isCompatible(SchemaRegistryServiceWithSchemaDataValidator.java:118)\n\tat org.apache.pulsar.broker.admin.impl.SchemasResourceBase.lambda$testCompatibilityAsync$10(SchemasResourceBase.java:149)\n\tat org.apache.pulsar.broker.admin.impl.SchemasResourceBase$$Lambda$1581/0x00007f72a89b2920.apply(Unknown Source)\n\tat java.base/java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:1150)\n\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n\tat org.apache.pulsar.client.util.RetryUtil.lambda$executeWithRetry$2(RetryUtil.java:62)\n\tat org.apache.pulsar.client.util.RetryUtil$$Lambda$863/0x00007f72a87534a0.accept(Unknown Source)\n\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n\tat java.base/java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:887)\n\tat java.base/java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2325)\n\tat org.apache.pulsar.client.util.RetryUtil.executeWithRetry(RetryUtil.java:48)\n\tat org.apache.pulsar.client.util.RetryUtil.lambda$retryAsynchronously$0(RetryUtil.java:42)\n\tat org.apache.pulsar.client.util.RetryUtil$$Lambda$756/0x00007f72a8700db0.run(Unknown Source)\n\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<p dir=\"auto\">After increase of heap memory up to 4096mb it fails with:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\" --- An unexpected error occurred in the server ---\n\nMessage: null\n\nStacktrace:\n\njava.nio.BufferUnderflowException\n\tat java.base/java.nio.HeapByteBuffer.get(HeapByteBuffer.java:183)\n\tat java.base/java.nio.ByteBuffer.get(ByteBuffer.java:826)\n\tat org.apache.pulsar.common.schema.KeyValue.decode(KeyValue.java:137)\n\tat org.apache.pulsar.client.impl.schema.KeyValueSchemaInfo.decodeKeyValueSchemaInfo(KeyValueSchemaInfo.java:201)\n\tat org.apache.pulsar.broker.service.schema.KeyValueSchemaCompatibilityCheck.decodeKeyValueSchemaData(KeyValueSchemaCompatibilityCheck.java:45)\n\tat org.apache.pulsar.broker.service.schema.validator.SchemaDataValidator.validateSchemaData(SchemaDataValidator.java:77)\n\tat org.apache.pulsar.broker.service.schema.validator.SchemaRegistryServiceWithSchemaDataValidator.isCompatible(SchemaRegistryServiceWithSchemaDataValidator.java:118)\n\tat org.apache.pulsar.broker.admin.impl.SchemasResourceBase.lambda$testCompatibilityAsync$10(SchemasResourceBase.java:149)\n\tat java.base/java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:1150)\n\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n\tat org.apache.pulsar.client.util.RetryUtil.lambda$executeWithRetry$2(RetryUtil.java:62)\n\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n\tat java.base/java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:887)\n\tat java.base/java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2325)\n\tat org.apache.pulsar.client.util.RetryUtil.executeWithRetry(RetryUtil.java:48)\n\tat org.apache.pulsar.client.util.RetryUtil.lambda$retryAsynchronously$0(RetryUtil.java:42)\n\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\"> --- An unexpected error occurred in the server ---\n\nMessage: null\n\nStacktrace:\n\njava.nio.BufferUnderflowException\n\tat java.base/java.nio.HeapByteBuffer.get(HeapByteBuffer.java:183)\n\tat java.base/java.nio.ByteBuffer.get(ByteBuffer.java:826)\n\tat org.apache.pulsar.common.schema.KeyValue.decode(KeyValue.java:137)\n\tat org.apache.pulsar.client.impl.schema.KeyValueSchemaInfo.decodeKeyValueSchemaInfo(KeyValueSchemaInfo.java:201)\n\tat org.apache.pulsar.broker.service.schema.KeyValueSchemaCompatibilityCheck.decodeKeyValueSchemaData(KeyValueSchemaCompatibilityCheck.java:45)\n\tat org.apache.pulsar.broker.service.schema.validator.SchemaDataValidator.validateSchemaData(SchemaDataValidator.java:77)\n\tat org.apache.pulsar.broker.service.schema.validator.SchemaRegistryServiceWithSchemaDataValidator.isCompatible(SchemaRegistryServiceWithSchemaDataValidator.java:118)\n\tat org.apache.pulsar.broker.admin.impl.SchemasResourceBase.lambda$testCompatibilityAsync$10(SchemasResourceBase.java:149)\n\tat java.base/java.util.concurrent.CompletableFuture$UniCompose.tryFire(CompletableFuture.java:1150)\n\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n\tat org.apache.pulsar.client.util.RetryUtil.lambda$executeWithRetry$2(RetryUtil.java:62)\n\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n\tat java.base/java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:887)\n\tat java.base/java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2325)\n\tat org.apache.pulsar.client.util.RetryUtil.executeWithRetry(RetryUtil.java:48)\n\tat org.apache.pulsar.client.util.RetryUtil.lambda$retryAsynchronously$0(RetryUtil.java:42)\n\tat java.base/java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:539)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21584",
                "createdAt": "2023-11-16T11:01:03Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Key-shared subscription must follow consumer redelivery as per shared sub semantic",
        "url": "https://github.com/apache/pulsar/pull/21657",
        "resourcePath": "/apache/pulsar/pull/21657",
        "createdAt": "2023-12-02T00:51:18Z",
        "number": 21657,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/ManagedCursor.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedCursorContainerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Consumer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentStickyKeyDispatcherMultipleConsumers.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/delayed/MockManagedCursor.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/KeySharedSubscriptionTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5g8lJw2gAoZjQxOTcwMTc5MTQwNTdlMmJkOTI4YzhjYTYyZmZjNGZlZjBlM2E1Mw",
                "url": "https://github.com/apache/pulsar/pull/21657/commits/f4197017914057e2bd928c8ca62ffc4fef0e3a53"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21656,
                "url": "https://github.com/apache/pulsar/issues/21656",
                "title": "[Bug] key-SHARED subscription is not performing redelivery and going in infinite while loop of reading messages from disk and not dispatching any messages",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">SHARED or key-SHARED subscription must dispatch redelivered messages in any scenario. every shared subscription should dispatch already delivered unack messages. You can follow strict ordering for new messages which broker is reading first time by advancing <code class=\"notranslate\">readPosition</code> of the cursor but broker can dispatch already delivered unack messages when its required without restricting any scenario.</p>\n<p dir=\"auto\">However, key-shared subscription is incorrectly handling redelivered messages by keep reading redelivered messages , discarding them and not dispatching any single messages to the consumer by incorrectly changing the semantics of consumer delivery ordering. broker doesn't dispatch redelivery message if that message id is smaller than consumer's assigned offset-message-id when it joined. broker assigns cursor's current read position as consumer's min-message-id offset to manage ordering but delivered messageId can be smaller than that position and redelivery should not be restricted by ordering as we already discussed semantics of shared subscription earlier. But as broker handles it incorrectly in key-shared because of that key-shared subscription topics which have connected consumers with positive permits are not able to receive any messages and dispatching is stuck also broker is keep performing same cold reads across those stuck topics and wasting storage and CPU resources by discarding read messages. which impacts application, broker and bookies and such buggy handling is semantically and practically invalid.</p>\n<p dir=\"auto\">Right now, such multiple topics with key-shared subscription and redelivery messages can significantly impact broker and bookies by keep reading large number of messages without dispatching them and client application are not able to consume any messages which also impacts application significantly.</p>\n<p dir=\"auto\">Test case</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"\n    @Test\n    public void test()\n            throws Exception {\n        String topic = &quot;persistent://public/default/key_shared-&quot; + UUID.randomUUID();\n        boolean enableBatch = false;\n        Set&lt;Integer&gt; values = new HashSet&lt;&gt;();\n\n        @Cleanup\n        Consumer&lt;Integer&gt; consumer1 = createConsumer(topic);\n\n        @Cleanup\n        Producer&lt;Integer&gt; producer = createProducer(topic, enableBatch);\n        int count = 0;\n        for (int i = 0; i &lt; 10; i++) {\n            // Send the same key twice so that we'll have a batch message\n            String key = String.valueOf(random.nextInt(NUMBER_OF_KEYS));\n            producer.newMessage().key(key).value(count++).send();\n        }\n\n        @Cleanup\n        Consumer&lt;Integer&gt; consumer2 = createConsumer(topic);\n\n        for (int i = 0; i &lt; 10; i++) {\n            // Send the same key twice so that we'll have a batch message\n            String key = String.valueOf(random.nextInt(NUMBER_OF_KEYS));\n            producer.newMessage().key(key).value(count++).send();\n        }\n\n        @Cleanup\n        Consumer&lt;Integer&gt; consumer3 = createConsumer(topic);\n\n        consumer2.redeliverUnacknowledgedMessages();\n\n        for (int i = 0; i &lt; 10; i++) {\n            // Send the same key twice so that we'll have a batch message\n            String key = String.valueOf(random.nextInt(NUMBER_OF_KEYS));\n            producer.newMessage().key(key).value(count++).send();\n        }\n        consumer1.close();\n\n        for(int i = 0; i &lt; count; i++) {\n            Message&lt;Integer&gt; msg = consumer2.receive(100, TimeUnit.MILLISECONDS);\n            if (msg!=null) {\n                values.add(msg.getValue());\n            } else {\n                break;\n            }\n        }\n        for(int i = 0; i &lt; count; i++) {\n            Message&lt;Integer&gt; msg = consumer3.receive(1, TimeUnit.MILLISECONDS);\n            if (msg!=null) {\n                values.add(msg.getValue());\n            } else {\n                break;\n            }\n        }\n        assertEquals(values.size(), count);\n    }\"><pre class=\"notranslate\"><code class=\"notranslate\">\n    @Test\n    public void test()\n            throws Exception {\n        String topic = \"persistent://public/default/key_shared-\" + UUID.randomUUID();\n        boolean enableBatch = false;\n        Set&lt;Integer&gt; values = new HashSet&lt;&gt;();\n\n        @Cleanup\n        Consumer&lt;Integer&gt; consumer1 = createConsumer(topic);\n\n        @Cleanup\n        Producer&lt;Integer&gt; producer = createProducer(topic, enableBatch);\n        int count = 0;\n        for (int i = 0; i &lt; 10; i++) {\n            // Send the same key twice so that we'll have a batch message\n            String key = String.valueOf(random.nextInt(NUMBER_OF_KEYS));\n            producer.newMessage().key(key).value(count++).send();\n        }\n\n        @Cleanup\n        Consumer&lt;Integer&gt; consumer2 = createConsumer(topic);\n\n        for (int i = 0; i &lt; 10; i++) {\n            // Send the same key twice so that we'll have a batch message\n            String key = String.valueOf(random.nextInt(NUMBER_OF_KEYS));\n            producer.newMessage().key(key).value(count++).send();\n        }\n\n        @Cleanup\n        Consumer&lt;Integer&gt; consumer3 = createConsumer(topic);\n\n        consumer2.redeliverUnacknowledgedMessages();\n\n        for (int i = 0; i &lt; 10; i++) {\n            // Send the same key twice so that we'll have a batch message\n            String key = String.valueOf(random.nextInt(NUMBER_OF_KEYS));\n            producer.newMessage().key(key).value(count++).send();\n        }\n        consumer1.close();\n\n        for(int i = 0; i &lt; count; i++) {\n            Message&lt;Integer&gt; msg = consumer2.receive(100, TimeUnit.MILLISECONDS);\n            if (msg!=null) {\n                values.add(msg.getValue());\n            } else {\n                break;\n            }\n        }\n        for(int i = 0; i &lt; count; i++) {\n            Message&lt;Integer&gt; msg = consumer3.receive(1, TimeUnit.MILLISECONDS);\n            if (msg!=null) {\n                values.add(msg.getValue());\n            } else {\n                break;\n            }\n        }\n        assertEquals(values.size(), count);\n    }\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<ul dir=\"auto\">\n<li>Consumers with available permits, must be able to consume delivered messages</li>\n<li>It should not be end of world scenario for brokers to serve such subscription consumers</li>\n</ul>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Broker should not have broken logic to stuck delivery with such incorrect assumptions</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21656",
                "createdAt": "2023-12-02T00:48:20Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][build] Fix Stage Docker images fail on M1 Mac",
        "url": "https://github.com/apache/pulsar/pull/21659",
        "resourcePath": "/apache/pulsar/pull/21659",
        "createdAt": "2023-12-02T03:15:53Z",
        "number": 21659,
        "mergeCommit": {
          "oid": "9872daab50bc266bc6f834582c438caa3ecf6e4c",
          "message": "[fix][build] Fix Stage Docker images fail on M1 Mac (#21659)",
          "commitUrl": "https://github.com/apache/pulsar/commit/9872daab50bc266bc6f834582c438caa3ecf6e4c",
          "parents": {
            "nodes": [
              {
                "oid": "d5457d35a68e3752e8d830bb0fbd7cc520127b9f",
                "message": "[fix][broker] Fix memory leak during topic compaction (#21647)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5g8wSE2gAoZWJjYTFlMTk2YzA4NWMyMGRkMzM5MmI0YmU1ODRhYTUzMGUxZmVjZQ",
                "url": "https://github.com/apache/pulsar/pull/21659/commits/ebca1e196c085c20dd3392b4be584aa530e1fece"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21658,
                "url": "https://github.com/apache/pulsar/issues/21658",
                "title": "[Bug] Stage Docker images fail on M1 Mac",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<ul dir=\"auto\">\n<li>branch-3.1 also lastest master branch</li>\n<li>environment<br>\nmvn -v</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Maven home: /Users/tom/Documents/apache-maven-3.8.6\nJava version: 17.0.1, vendor: Oracle Corporation, runtime: /Users/tom/Documents/jdk-17.0.1.jdk/Contents/Home\nDefault locale: en_CN, platform encoding: UTF-8\nOS name: &quot;mac os x&quot;, version: &quot;14.1&quot;, arch: &quot;aarch64&quot;, family: &quot;mac&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">Maven home: /Users/tom/Documents/apache-maven-3.8.6\nJava version: 17.0.1, vendor: Oracle Corporation, runtime: /Users/tom/Documents/jdk-17.0.1.jdk/Contents/Home\nDefault locale: en_CN, platform encoding: UTF-8\nOS name: \"mac os x\", version: \"14.1\", arch: \"aarch64\", family: \"mac\"\n</code></pre></div>\n<ul dir=\"auto\">\n<li>docker version</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Client:\n Cloud integration: v1.0.31\n Version:           20.10.24\n API version:       1.41\n Go version:        go1.19.7\n Git commit:        297e128\n Built:             Tue Apr  4 18:21:21 2023\n OS/Arch:           darwin/arm64\n Context:           desktop-linux\n Experimental:      true\n\nServer: Docker Desktop 4.18.0 (104112)\n Engine:\n  Version:          20.10.24\n  API version:      1.41 (minimum version 1.12)\n  Go version:       go1.19.7\n  Git commit:       5d6db84\n  Built:            Tue Apr  4 18:17:07 2023\n  OS/Arch:          linux/arm64\n  Experimental:     false\n containerd:\n  Version:          1.6.18\n  GitCommit:        2456e983eb9e37e47538f59ea18f2043c9a73640\n runc:\n  Version:          1.1.4\n  GitCommit:        v1.1.4-0-g5fd4c4d\n docker-init:\n  Version:          0.19.0\n  GitCommit:        de40ad0\"><pre class=\"notranslate\"><code class=\"notranslate\">Client:\n Cloud integration: v1.0.31\n Version:           20.10.24\n API version:       1.41\n Go version:        go1.19.7\n Git commit:        297e128\n Built:             Tue Apr  4 18:21:21 2023\n OS/Arch:           darwin/arm64\n Context:           desktop-linux\n Experimental:      true\n\nServer: Docker Desktop 4.18.0 (104112)\n Engine:\n  Version:          20.10.24\n  API version:      1.41 (minimum version 1.12)\n  Go version:       go1.19.7\n  Git commit:       5d6db84\n  Built:            Tue Apr  4 18:17:07 2023\n  OS/Arch:          linux/arm64\n  Experimental:     false\n containerd:\n  Version:          1.6.18\n  GitCommit:        2456e983eb9e37e47538f59ea18f2043c9a73640\n runc:\n  Version:          1.1.4\n  GitCommit:        v1.1.4-0-g5fd4c4d\n docker-init:\n  Version:          0.19.0\n  GitCommit:        de40ad0\n</code></pre></div>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">When release branch-3.1 on M1 mac at phase <code class=\"notranslate\">Stage Docker images</code> of <a href=\"https://pulsar.apache.org/contribute/release-process/\" rel=\"nofollow\">release-process</a>,  we run the following commands:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"mvn install -DUBUNTU_MIRROR=http://azure.archive.ubuntu.com/ubuntu/ \\\n    -DskipTests \\\n    -Pmain,docker -Pdocker-push \\\n    -Ddocker.platforms=linux/amd64,linux/arm64 \\\n    -Ddocker.organization=$DOCKER_ORG \\\n    -pl docker/pulsar,docker/pulsar-all\"><pre class=\"notranslate\"><code class=\"notranslate\">mvn install -DUBUNTU_MIRROR=http://azure.archive.ubuntu.com/ubuntu/ \\\n    -DskipTests \\\n    -Pmain,docker -Pdocker-push \\\n    -Ddocker.platforms=linux/amd64,linux/arm64 \\\n    -Ddocker.organization=$DOCKER_ORG \\\n    -pl docker/pulsar,docker/pulsar-all\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">docker build success</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Docker  throw  <code class=\"notranslate\">unknown flag: --driver</code> exception like following:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[INFO] DOCKER&gt; docker --config /Users/tom/Documents/release/pulsar/docker/pulsar/target/docker/hxy/pulsar/docker buildx create --driver docker-container --name maven\n[INFO] DOCKER&gt; unknown flag: --driver\n[INFO] DOCKER&gt; See 'docker --help'.\n[INFO] DOCKER&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">[INFO] DOCKER&gt; docker --config /Users/tom/Documents/release/pulsar/docker/pulsar/target/docker/hxy/pulsar/docker buildx create --driver docker-container --name maven\n[INFO] DOCKER&gt; unknown flag: --driver\n[INFO] DOCKER&gt; See 'docker --help'.\n[INFO] DOCKER&gt;\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">I have tried to install different docker versions but the issuse still exists</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21658",
                "createdAt": "2023-12-02T02:58:32Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve] [broker] Servlet support response compression",
        "url": "https://github.com/apache/pulsar/pull/21667",
        "resourcePath": "/apache/pulsar/pull/21667",
        "createdAt": "2023-12-04T16:26:55Z",
        "number": 21667,
        "mergeCommit": {
          "oid": "7a4e16a8373754a6bc4713dcfe9d06c674ce3758",
          "message": "[improve] [broker] Servlet support response compression (#21667)",
          "commitUrl": "https://github.com/apache/pulsar/commit/7a4e16a8373754a6bc4713dcfe9d06c674ce3758",
          "parents": {
            "nodes": [
              {
                "oid": "ade9c10e934e4ff9f08ac94153d9c1641be08ac3",
                "message": "[fix][test] Fix thread leak in TopicPoliciesAuthZTest (#22257)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/web/WebService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/web/WebServiceTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5hE1KF2gAoZTA1MTU0NGZkNTM1NTViMGMwNGJiOWI1MjhkZmZjOTAxZTIyMzRjNA",
                "url": "https://github.com/apache/pulsar/pull/21667/commits/e051544fd53555b0c04bb9b528dffc901e2234c4"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 16321,
                "url": "https://github.com/apache/pulsar/issues/16321",
                "title": "Add gzip compression before http service response",
                "bodyHTML": "<p dir=\"auto\"><strong>Is your feature request related to a problem? Please describe.</strong><br>\nWith the continuous expansion of the tenant / namespace /topic/ application of pulsar cluster, the index text output by the broker is getting larger and larger. If promethues requests the /metrics URL time of the broker to be fixed, such as 10s, with the index getting larger and larger, this 10s will definitely timeout, so the following error will be reported:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/54351417/176842173-1f74a682-b88b-493a-8f13-3f1293d29ab9.png\"><img src=\"https://user-images.githubusercontent.com/54351417/176842173-1f74a682-b88b-493a-8f13-3f1293d29ab9.png\" alt=\"3ae6e378bc103bb1afcea9db85ddec2\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">This will sometimes lead to incomplete indicators of promethues, and sometimes there are problems in the display on grafana, so we add gzip handler to the HTTP response of /metrics to reduce the network transmission volume.</p>\n<p dir=\"auto\"><strong>Describe the solution you'd like</strong><br>\nAdd gzip handler to the HTTP response of /metrics</p>",
                "resourcePath": "/apache/pulsar/issues/16321",
                "createdAt": "2022-07-01T07:04:21Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/feature"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] PIP-307 Expose inflight state waiting time and service channel monitor interval configs. Handle AddEntry failure during topic transfer",
        "url": "https://github.com/apache/pulsar/pull/21668",
        "resourcePath": "/apache/pulsar/pull/21668",
        "createdAt": "2023-12-04T20:05:21Z",
        "number": 21668,
        "mergeCommit": {
          "oid": "93df34436f9c818fed9f275dbc12557eb2e9f0e7",
          "message": "[improve][broker] PIP-307 Expose inflight state waiting time and service channel monitor interval configs. Handle AddEntry failure during topic transfer (#21668)",
          "commitUrl": "https://github.com/apache/pulsar/commit/93df34436f9c818fed9f275dbc12557eb2e9f0e7",
          "parents": {
            "nodes": [
              {
                "oid": "91c9e0a48ef9a0b86727485a1b16fbc95aa58eb3",
                "message": "[fix][test] add unit test to testing the lookupRequestSemaphore would leaked when lookuping topic is not exist. (#21670)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/ExtensibleLoadManagerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/channel/ServiceUnitStateChannelImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Producer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Topic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/extensions/ExtensibleLoadManagerImplTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/extensions/channel/ServiceUnitStateChannelTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5hGIde2gAoMTI2NDU0M2JlMWRhMTAyZGI2NDliNTJjZjRhMTBkYzFjMzRiZWVkYw",
                "url": "https://github.com/apache/pulsar/pull/21668/commits/1264543be1da102db649b52cf4a10dc1c34beedc"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21654,
                "url": "https://github.com/apache/pulsar/issues/21654",
                "title": "Flaky-test: ClassCastException in ExtensibleLoadManagerImpl.checkOwnershipAsync",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failures</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6993786233/job/19026941485#step:11:1122\">2023-11-26T06:33:53.3405489Z</a></li>\n</ul>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"org.apache.pulsar.client.admin.PulsarAdminException$ServerSideErrorException:\n\n --- An unexpected error occurred in the server ---\n\nMessage: class java.util.ImmutableCollections$List12 cannot be cast to class java.util.concurrent.CompletableFuture (java.util.ImmutableCollections$List12 and java.util.concurrent.CompletableFuture are in module java.base of loader 'bootstrap')\n\nStacktrace:\n\njava.lang.ClassCastException: class java.util.ImmutableCollections$List12 cannot be cast to class java.util.concurrent.CompletableFuture (java.util.ImmutableCollections$List12 and java.util.concurrent.CompletableFuture are in module java.base of loader 'bootstrap')\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl.checkOwnershipAsync(ExtensibleLoadManagerImpl.java:625)\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerWrapper.checkOwnershipAsync(ExtensibleLoadManagerWrapper.java:72)\n\tat org.apache.pulsar.broker.namespace.NamespaceService.lambda$checkTopicOwnership$47(NamespaceService.java:1230)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2341)\n\tat org.apache.pulsar.broker.namespace.NamespaceService.checkTopicOwnership(NamespaceService.java:1230)\n\tat java.base/java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:733)\n\tat org.mockito.internal.util.reflection.InstrumentationMemberAccessor$Dispatcher$ByteBuddy$sc8ugsJW.invokeWithArguments(Unknown Source)\n\tat org.mockito.internal.util.reflection.InstrumentationMemberAccessor.invoke(InstrumentationMemberAccessor.java:251)\n\tat org.mockito.internal.util.reflection.ModuleMemberAccessor.invoke(ModuleMemberAccessor.java:55)\n\tat org.mockito.internal.creation.bytebuddy.MockMethodAdvice.tryInvoke(MockMethodAdvice.java:314)\n\tat org.mockito.internal.creation.bytebuddy.MockMethodAdvice$RealMethodCall.invoke(MockMethodAdvice.java:234)\n\tat org.mockito.internal.invocation.InterceptedInvocation.callRealMethod(InterceptedInvocation.java:142)\n\tat org.mockito.internal.stubbing.answers.CallsRealMethods.answer(CallsRealMethods.java:45)\n\tat org.mockito.Answers.answer(Answers.java:90)\n\tat org.mockito.internal.handler.MockHandlerImpl.handle(MockHandlerImpl.java:111)\n\tat org.mockito.internal.handler.NullResultGuardian.handle(NullResultGuardian.java:29)\n\tat org.mockito.internal.handler.InvocationNotifierHandler.handle(InvocationNotifierHandler.java:34)\n\tat org.mockito.internal.creation.bytebuddy.MockMethodInterceptor.doIntercept(MockMethodInterceptor.java:82)\n\tat org.mockito.internal.creation.bytebuddy.MockMethodAdvice.handle(MockMethodAdvice.java:134)\n\tat org.apache.pulsar.broker.namespace.NamespaceService.checkTopicOwnership(NamespaceService.java:1228)\n\tat org.apache.pulsar.broker.service.BrokerService.checkTopicNsOwnership(BrokerService.java:2221)\n\tat org.apache.pulsar.broker.service.BrokerService.loadOrCreatePersistentTopic(BrokerService.java:1562)\n\tat org.apache.pulsar.broker.service.BrokerService.lambda$getTopic$30(BrokerService.java:1086)\n\tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.put(ConcurrentOpenHashMap.java:438)\n\tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.computeIfAbsent(ConcurrentOpenHashMap.java:257)\n\tat org.apache.pulsar.broker.service.BrokerService.lambda$getTopic$32(BrokerService.java:1067)\"><pre class=\"notranslate\"><code class=\"notranslate\">org.apache.pulsar.client.admin.PulsarAdminException$ServerSideErrorException:\n\n --- An unexpected error occurred in the server ---\n\nMessage: class java.util.ImmutableCollections$List12 cannot be cast to class java.util.concurrent.CompletableFuture (java.util.ImmutableCollections$List12 and java.util.concurrent.CompletableFuture are in module java.base of loader 'bootstrap')\n\nStacktrace:\n\njava.lang.ClassCastException: class java.util.ImmutableCollections$List12 cannot be cast to class java.util.concurrent.CompletableFuture (java.util.ImmutableCollections$List12 and java.util.concurrent.CompletableFuture are in module java.base of loader 'bootstrap')\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerImpl.checkOwnershipAsync(ExtensibleLoadManagerImpl.java:625)\n\tat org.apache.pulsar.broker.loadbalance.extensions.ExtensibleLoadManagerWrapper.checkOwnershipAsync(ExtensibleLoadManagerWrapper.java:72)\n\tat org.apache.pulsar.broker.namespace.NamespaceService.lambda$checkTopicOwnership$47(NamespaceService.java:1230)\n\tat java.base/java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187)\n\tat java.base/java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2341)\n\tat org.apache.pulsar.broker.namespace.NamespaceService.checkTopicOwnership(NamespaceService.java:1230)\n\tat java.base/java.lang.invoke.MethodHandle.invokeWithArguments(MethodHandle.java:733)\n\tat org.mockito.internal.util.reflection.InstrumentationMemberAccessor$Dispatcher$ByteBuddy$sc8ugsJW.invokeWithArguments(Unknown Source)\n\tat org.mockito.internal.util.reflection.InstrumentationMemberAccessor.invoke(InstrumentationMemberAccessor.java:251)\n\tat org.mockito.internal.util.reflection.ModuleMemberAccessor.invoke(ModuleMemberAccessor.java:55)\n\tat org.mockito.internal.creation.bytebuddy.MockMethodAdvice.tryInvoke(MockMethodAdvice.java:314)\n\tat org.mockito.internal.creation.bytebuddy.MockMethodAdvice$RealMethodCall.invoke(MockMethodAdvice.java:234)\n\tat org.mockito.internal.invocation.InterceptedInvocation.callRealMethod(InterceptedInvocation.java:142)\n\tat org.mockito.internal.stubbing.answers.CallsRealMethods.answer(CallsRealMethods.java:45)\n\tat org.mockito.Answers.answer(Answers.java:90)\n\tat org.mockito.internal.handler.MockHandlerImpl.handle(MockHandlerImpl.java:111)\n\tat org.mockito.internal.handler.NullResultGuardian.handle(NullResultGuardian.java:29)\n\tat org.mockito.internal.handler.InvocationNotifierHandler.handle(InvocationNotifierHandler.java:34)\n\tat org.mockito.internal.creation.bytebuddy.MockMethodInterceptor.doIntercept(MockMethodInterceptor.java:82)\n\tat org.mockito.internal.creation.bytebuddy.MockMethodAdvice.handle(MockMethodAdvice.java:134)\n\tat org.apache.pulsar.broker.namespace.NamespaceService.checkTopicOwnership(NamespaceService.java:1228)\n\tat org.apache.pulsar.broker.service.BrokerService.checkTopicNsOwnership(BrokerService.java:2221)\n\tat org.apache.pulsar.broker.service.BrokerService.loadOrCreatePersistentTopic(BrokerService.java:1562)\n\tat org.apache.pulsar.broker.service.BrokerService.lambda$getTopic$30(BrokerService.java:1086)\n\tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.put(ConcurrentOpenHashMap.java:438)\n\tat org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.computeIfAbsent(ConcurrentOpenHashMap.java:257)\n\tat org.apache.pulsar.broker.service.BrokerService.lambda$getTopic$32(BrokerService.java:1067)\n</code></pre></div>",
                "resourcePath": "/apache/pulsar/issues/21654",
                "createdAt": "2023-12-01T12:13:58Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] add unit test to testing the lookupRequestSemaphore would leaked when lookuping topic is not exist.",
        "url": "https://github.com/apache/pulsar/pull/21670",
        "resourcePath": "/apache/pulsar/pull/21670",
        "createdAt": "2023-12-05T09:15:06Z",
        "number": 21670,
        "mergeCommit": {
          "oid": "91c9e0a48ef9a0b86727485a1b16fbc95aa58eb3",
          "message": "[fix][test] add unit test to testing the lookupRequestSemaphore would leaked when lookuping topic is not exist. (#21670)",
          "commitUrl": "https://github.com/apache/pulsar/commit/91c9e0a48ef9a0b86727485a1b16fbc95aa58eb3",
          "parents": {
            "nodes": [
              {
                "oid": "f8067b50c0d68cb723e5e5cd681b1697329ae012",
                "message": "[fix][broker] Fix returns wrong webServiceUrl when both webServicePort and webServicePortTls are set (#21633)\n\nCo-authored-by: Jiwe Guo <technoboy@apache.org>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/lookup/http/HttpTopicLookupv2Test.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5hJwCF2gAoZmM2MjY1NTc1ZDc4NTFiZTljNDQ4N2JiYWM0NzgzOWFkNDlhNDAwYQ",
                "url": "https://github.com/apache/pulsar/pull/21670/commits/fc6265575d7851be9c4487bbac47839ad49a400a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21661,
                "url": "https://github.com/apache/pulsar/issues/21661",
                "title": "Add a test to cover the fix of #21646",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Add a test to cover the fix of <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2017778231\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/21646\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/21646/hovercard\" href=\"https://github.com/apache/pulsar/pull/21646\">#21646</a></p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21661",
                "createdAt": "2023-12-04T01:44:42Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][io] Make connectors load sensitive fields from secrets",
        "url": "https://github.com/apache/pulsar/pull/21675",
        "resourcePath": "/apache/pulsar/pull/21675",
        "createdAt": "2023-12-06T06:53:28Z",
        "number": 21675,
        "mergeCommit": {
          "oid": "495b141c7bebc0356297546e9db88c9e087f5039",
          "message": "[improve][io] Make connectors load sensitive fields from secrets (#21675)",
          "commitUrl": "https://github.com/apache/pulsar/commit/495b141c7bebc0356297546e9db88c9e087f5039",
          "parents": {
            "nodes": [
              {
                "oid": "2e31e71098d63dfe111b225d8f8219ea05d1951f",
                "message": "[cleanup][broker] cleanup deprecated method of metadata store etcd (#21253)\n\nSigned-off-by: Lan Liang <gcslyp@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/redis/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/redis/src/main/java/org/apache/pulsar/io/redis/RedisAbstractConfig.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/redis/src/main/java/org/apache/pulsar/io/redis/sink/RedisSink.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/redis/src/main/java/org/apache/pulsar/io/redis/sink/RedisSinkConfig.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/redis/src/test/java/org/apache/pulsar/io/redis/sink/RedisSinkConfigTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/redis/src/test/java/org/apache/pulsar/io/redis/sink/RedisSinkTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/solr/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/solr/src/main/java/org/apache/pulsar/io/solr/SolrAbstractSink.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/solr/src/main/java/org/apache/pulsar/io/solr/SolrSinkConfig.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/solr/src/test/java/org/apache/pulsar/io/solr/SolrSinkConfigTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5hQ5XH2gAoYTY1ZGI3MDcxYzYxZDBmYmY2YjUwMGVmMzRjYzMyMGNkMTUyMTZmZg",
                "url": "https://github.com/apache/pulsar/pull/21675/commits/a65db7071c61d0fbf6b500ef34cc320cd15216ff"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21674,
                "url": "https://github.com/apache/pulsar/issues/21674",
                "title": "[feat] Support load sensitive fields from secret for connectors",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Now, although some connectors' config has annotated sensitive fields with <code class=\"notranslate\">sensitive = true</code>, but they still read those fields from raw configs, so It's better to make them use the <code class=\"notranslate\">IOConfileUtils.loadWithSecrets</code> to load config</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21674",
                "createdAt": "2023-12-06T06:50:02Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Automatically create topic for remote cluster in geo",
        "url": "https://github.com/apache/pulsar/pull/21679",
        "resourcePath": "/apache/pulsar/pull/21679",
        "createdAt": "2023-12-06T10:54:49Z",
        "number": 21679,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/containers/CSContainer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/containers/ChaosContainer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/containers/PulsarContainer.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/messaging/GeoReplicationOnTopicLevelTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/messaging/GeoReplicationTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/topologies/PulsarCluster.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/topologies/PulsarGeoCluster.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5hSiF22gAoZDhkNjg5ZDJmY2Y4NzdkYmUwZmE5NGRkYWM0NDQ2Mzk2NThlMDNjYQ",
                "url": "https://github.com/apache/pulsar/pull/21679/commits/d8d689d2fcf877dbe0fa94ddac444639658e03ca"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21153,
                "url": "https://github.com/apache/pulsar/issues/21153",
                "title": "[Bug]  Topic  level geo configure, the  partitioned topics can not  auto created on  remote cluster.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.10.5</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Create a Topic with partition 2  on cluster1<br>\n<code class=\"notranslate\">bin/pulsar-admin topics create-partitioned-topic -p 2 public/geo-1/test-1</code></li>\n<li>Topic  level GEO Configure<br>\n<code class=\"notranslate\">bin/pulsar-admin topics set-replication-clusters  -c cluster1,cluster2 public/geo-1/test-1</code></li>\n<li>View the list of partitioned topics and non-partitioned topics in Cluster2.</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-admin topics list-partitioned-topics public/geo-1\nempty\n\nbin/pulsar-admin topics list public/geo-1\npublic/geo-1/test-1-partition-0\npublic/geo-1/test-1-partition-1\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-admin topics list-partitioned-topics public/geo-1\nempty\n\nbin/pulsar-admin topics list public/geo-1\npublic/geo-1/test-1-partition-0\npublic/geo-1/test-1-partition-1\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">View the list of partitioned topics and non-partitioned topics in Cluster2.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-admin topics list-partitioned-topics public/geo-1\npublic/geo-1/test-1\n\nbin/pulsar-admin topics list public/geo-1\npublic/geo-1/test-1-partition-0\npublic/geo-1/test-1-partition-1\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-admin topics list-partitioned-topics public/geo-1\npublic/geo-1/test-1\n\nbin/pulsar-admin topics list public/geo-1\npublic/geo-1/test-1-partition-0\npublic/geo-1/test-1-partition-1\n</code></pre></div>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">View the list of partitioned topics and non-partitioned topics in Cluster2.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-admin topics list-partitioned-topics public/geo-1\nempty\n\nbin/pulsar-admin topics list public/geo-1\npublic/geo-1/test-1-partition-0\npublic/geo-1/test-1-partition-1\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-admin topics list-partitioned-topics public/geo-1\nempty\n\nbin/pulsar-admin topics list public/geo-1\npublic/geo-1/test-1-partition-0\npublic/geo-1/test-1-partition-1\n</code></pre></div>\n<p dir=\"auto\">Partitioned topics are not created in the remote cluster.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21153",
                "createdAt": "2023-09-10T13:29:11Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Pulsar Rate Limiting Refactoring changes (PIP-322)",
        "url": "https://github.com/apache/pulsar/pull/21681",
        "resourcePath": "/apache/pulsar/pull/21681",
        "createdAt": "2023-12-06T16:45:48Z",
        "number": 21681,
        "mergeCommit": {
          "oid": "c4cff0ab3dac169c0a1418ef2f63f61604f6278e",
          "message": "[improve][broker] Pulsar Rate Limiting Refactoring changes (PIP-322) (#21681)",
          "commitUrl": "https://github.com/apache/pulsar/commit/c4cff0ab3dac169c0a1418ef2f63f61604f6278e",
          "parents": {
            "nodes": [
              {
                "oid": "60522c61a3f22e534d39992d374d3fa4b5856037",
                "message": "[fix][sec] Upgrade org.bouncycastle:bc-fips to 1.0.2.4 (#21730)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/stats/PrometheusMetricsTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/MessageDispatchThrottlingTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/MessagePublishThrottlingTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/TopicPublishThrottlingInitTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/resources/prometheus_metrics_sample.txt"
              }
            },
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/RateLimiter.java"
              }
            },
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-common/src/test/java/org/apache/pulsar/common/util/RateLimiterTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/stats/FunctionStatsManager.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/stats/SinkStatsManager.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/stats/SourceStatsManager.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5hU9De2gAoMzI0YmI5NjBlNDljZjJlNjk4N2QyYTA1Y2JlOTg5ZjJkNjM3MGMxNQ",
                "url": "https://github.com/apache/pulsar/pull/21681/commits/324bb960e49cf2e6987d2a05cbe989f2d6370c15"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21442,
                "url": "https://github.com/apache/pulsar/issues/21442",
                "title": "[Bug] RateLimiter lock contention when use precise publish rate limiter",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<p dir=\"auto\">After enabled the <code class=\"notranslate\">preciseTopicPublishRateLimiterEnable</code> configuration in <code class=\"notranslate\">broker.conf</code>, if one topic on the broker exceeds the publish rate limit (for example, 1MB/s), it will cause lock contention, leading to an increase in the 99th percentile write latency for other topics that have not reached the rate limit.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/5058708/280208140-3dd86f3a-a2e5-4da8-9f59-9864d27608f9.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzMxODAsIm5iZiI6MTcxNDk3Mjg4MCwicGF0aCI6Ii81MDU4NzA4LzI4MDIwODE0MC0zZGQ4NmYzYS1hMmU1LTRkYTgtOWY1OS05ODY0ZDI3NjA4ZjkucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDUwNiUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA1MDZUMDUyMTIwWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NTgxZjhhZGYxN2EyODkzOGJjMjQ3NzBmMjlkMzdlZWJlODgwNDdiNGJlMDQ0NTM0ZWIwMzRmOTZiYjc1M2M3NiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.1PQtcfiDO-4SgYVGKkEVgKBguktAHTpl6gGpXZMZ10k\"><img width=\"830\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/5058708/280208140-3dd86f3a-a2e5-4da8-9f59-9864d27608f9.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzMxODAsIm5iZiI6MTcxNDk3Mjg4MCwicGF0aCI6Ii81MDU4NzA4LzI4MDIwODE0MC0zZGQ4NmYzYS1hMmU1LTRkYTgtOWY1OS05ODY0ZDI3NjA4ZjkucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDUwNiUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA1MDZUMDUyMTIwWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NTgxZjhhZGYxN2EyODkzOGJjMjQ3NzBmMjlkMzdlZWJlODgwNDdiNGJlMDQ0NTM0ZWIwMzRmOTZiYjc1M2M3NiZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.1PQtcfiDO-4SgYVGKkEVgKBguktAHTpl6gGpXZMZ10k\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">The profile shows that there is lock content inside the method <code class=\"notranslate\">org.apache.pulsar.broker.service.PrecisPublishLimiter#tryAcquire</code>.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/5058708/277953123-4d2f69ab-f827-448c-92f3-5c69f7029d0b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzMxODAsIm5iZiI6MTcxNDk3Mjg4MCwicGF0aCI6Ii81MDU4NzA4LzI3Nzk1MzEyMy00ZDJmNjlhYi1mODI3LTQ0OGMtOTJmMy01YzY5ZjcwMjlkMGIucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDUwNiUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA1MDZUMDUyMTIwWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NDRmMTQyZTUxNTYxZTZlY2M0YmVlOGE3OGFhOThlMzFkMmFhZDAyN2ZmMzRiOWMyZTcyODE2OTQ0MjliMmU0NCZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.eDUMXe_Xo9tuKWcmAhG_mZZ_cE9RMS72-6ptrDLPUY0\"><img width=\"1728\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/5058708/277953123-4d2f69ab-f827-448c-92f3-5c69f7029d0b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzMxODAsIm5iZiI6MTcxNDk3Mjg4MCwicGF0aCI6Ii81MDU4NzA4LzI3Nzk1MzEyMy00ZDJmNjlhYi1mODI3LTQ0OGMtOTJmMy01YzY5ZjcwMjlkMGIucG5nP1gtQW16LUFsZ29yaXRobT1BV1M0LUhNQUMtU0hBMjU2JlgtQW16LUNyZWRlbnRpYWw9QUtJQVZDT0RZTFNBNTNQUUs0WkElMkYyMDI0MDUwNiUyRnVzLWVhc3QtMSUyRnMzJTJGYXdzNF9yZXF1ZXN0JlgtQW16LURhdGU9MjAyNDA1MDZUMDUyMTIwWiZYLUFtei1FeHBpcmVzPTMwMCZYLUFtei1TaWduYXR1cmU9NDRmMTQyZTUxNTYxZTZlY2M0YmVlOGE3OGFhOThlMzFkMmFhZDAyN2ZmMzRiOWMyZTcyODE2OTQ0MjliMmU0NCZYLUFtei1TaWduZWRIZWFkZXJzPWhvc3QmYWN0b3JfaWQ9MCZrZXlfaWQ9MCZyZXBvX2lkPTAifQ.eDUMXe_Xo9tuKWcmAhG_mZZ_cE9RMS72-6ptrDLPUY0\" style=\"max-width: 100%;\"></a><br>\n<a href=\"https://github.com/apache/pulsar/files/13164263/pulsar-3.0.1.lock.profile.008.html.zip\">pulsar-3.0.1.lock.profile.008.html.zip</a></p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Noticed in a fork of <code class=\"notranslate\">2.8.1</code>, reproduced in <code class=\"notranslate\">3.0.1</code> on Linux CentOS 7.9 <code class=\"notranslate\">3.10.0-1160.99.1.el7.x86_64</code></p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"pulsar-admin namespaces create public/ratelimited\npulsar-admin namespaces set-publish-rate -b 1048576 public/ratelimited\npulsar-admin namespaces policies public/ratelimited\npulsar-perf produce persistent://public/default/no-rate-limit\npulsar-perf produce -r 1600 -ioThreads 4 -n 100 persistent://public/ratelimited/topic-1\"><pre class=\"notranslate\">pulsar-admin namespaces create public/ratelimited\npulsar-admin namespaces set-publish-rate -b 1048576 public/ratelimited\npulsar-admin namespaces policies public/ratelimited\npulsar-perf produce persistent://public/default/no-rate-limit\npulsar-perf produce -r 1600 -ioThreads 4 -n 100 persistent://public/ratelimited/topic-1</pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">One topic exceeds publish rate limit should not effect other topics write latency.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Another topic write latency also increased.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21442",
                "createdAt": "2023-10-25T10:04:25Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [broker] network package lost if enable haProxyProtocolEnabled",
        "url": "https://github.com/apache/pulsar/pull/21684",
        "resourcePath": "/apache/pulsar/pull/21684",
        "createdAt": "2023-12-07T04:56:52Z",
        "number": 21684,
        "mergeCommit": {
          "oid": "6e18874d6f007be501827550b9894422ecd8eda8",
          "message": "[fix] [broker] network package lost if enable haProxyProtocolEnabled (#21684)\n\nFixes #21557\r\n\r\n### Motivation\r\n\r\nThere is a network package loss issue after enabling `haProxyProtocolEnabled`, which leads the error `Checksum failed on the broker` and `Adjusted frame length exceeds`, you can reproduce the issue by the test `testSlowNetwork`. \r\n\r\n### Modifications\r\n\r\nFix the bug.",
          "commitUrl": "https://github.com/apache/pulsar/commit/6e18874d6f007be501827550b9894422ecd8eda8",
          "parents": {
            "nodes": [
              {
                "oid": "7e76c45264a2730fdbe15d4cf460c04bfc3e00d5",
                "message": "[improve][sec] Revert \"Add group pulsar and add user pulsar to it instead of root\" (#21691)\n\nReverts #21084. Because the change breaks OpenShift support."
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/EnableProxyProtocolTest.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/InjectedClientCnxClientBuilder.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/protocol/OptionalProxyProtocolDecoder.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5hYEyu2gAoNTgyMjgzZmFlMTYxY2EwNTViNzBkNjNiNzI0NDM3M2VhNmIyYWNhNA",
                "url": "https://github.com/apache/pulsar/pull/21684/commits/582283fae161ca055b70d63b7244373ea6b2aca4"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21557,
                "url": "https://github.com/apache/pulsar/issues/21557",
                "title": "[Bug] Failed to verify checksum",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">brokers : 3.0.1<br>\nclients : 2.5.2 and 3.0.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">When I upgraded the broker to version 3.0.1, I started experiencing an issue with the producer sending messages. This issue doesn't always occur and seems to be related to the size of the messages being sent. It happens intermittently, with intervals ranging from a few hours to a few minutes.I can confirm that the message length is very short, less than 1k.And when I upgraded the client version from 2.5.2 to 3.0.1, the errors did not decrease, but instead became more frequent.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">No error is occurring.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">2023-11-09T08:05:10,961+0000 [pulsar-io-4-3] ERROR org.apache.pulsar.broker.service.Producer - [PersistentTopic{topic=persistent://testa/out/event-partition-19}] [mqe-71-347] Failed to verify checksum<br>\n2023-11-09T08:05:10,964+0000 [pulsar-io-4-3] WARN  org.apache.pulsar.broker.service.ServerCnx - [/172.0.3.33:53878] Got exception io.netty.handler.codec.TooLongFrameException: Adjusted frame length exceeds 5253120: 101194516 - discarded<br>\nat io.netty.handler.codec.LengthFieldBasedFrameDecoder.fail(LengthFieldBasedFrameDecoder.java:507)<br>\nat io.netty.handler.codec.LengthFieldBasedFrameDecoder.failIfNecessary(LengthFieldBasedFrameDecoder.java:493)<br>\nat io.netty.handler.codec.LengthFieldBasedFrameDecoder.exceededFrameLength(LengthFieldBasedFrameDecoder.java:377)<br>\nat io.netty.handler.codec.LengthFieldBasedFrameDecoder.decode(LengthFieldBasedFrameDecoder.java:423)<br>\nat io.netty.handler.codec.LengthFieldBasedFrameDecoder.decode(LengthFieldBasedFrameDecoder.java:333)<br>\nat io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:529)<br>\nat io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:468)<br>\nat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:290)<br>\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)<br>\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)<br>\nat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)<br>\nat io.netty.channel.ChannelInboundHandlerAdapter.channelRead(ChannelInboundHandlerAdapter.java:93)<br>\nat org.apache.pulsar.common.protocol.OptionalProxyProtocolDecoder.channelRead(OptionalProxyProtocolDecoder.java:52)<br>\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)<br>\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)<br>\nat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)<br>\nat io.netty.handler.flush.FlushConsolidationHandler.channelRead(FlushConsolidationHandler.java:152)<br>\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)<br>\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)<br>\nat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)<br>\nat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)<br>\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)<br>\nat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)<br>\nat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)<br>\nat io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:800)<br>\nat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:499)<br>\nat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:397)<br>\nat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)<br>\nat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)<br>\nat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)<br>\nat java.base/java.lang.Thread.run(Thread.java:842)</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21557",
                "createdAt": "2023-11-10T07:32:09Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve] Add @Deprecated for redundant newAck() methods (#21580)",
        "url": "https://github.com/apache/pulsar/pull/21698",
        "resourcePath": "/apache/pulsar/pull/21698",
        "createdAt": "2023-12-08T16:04:38Z",
        "number": 21698,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Commands.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5hifst2gAoYjJmNDgxODg2MjU3NDQ4ZGFiYzIwMTllNTc1OWNlYTEwNTRhYzZjNQ",
                "url": "https://github.com/apache/pulsar/pull/21698/commits/b2f481886257448dabc2019e5759cea1054ac6c5"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21580,
                "url": "https://github.com/apache/pulsar/issues/21580",
                "title": "Clean up methods used to create ack command",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Now we have 8 methods to create an ack command. We should consider to check which one is redundant.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/12592133/277639149-a833955f-e1e5-4df9-bb7e-f9cb78917239.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzMyMDMsIm5iZiI6MTcxNDk3MjkwMywicGF0aCI6Ii8xMjU5MjEzMy8yNzc2MzkxNDktYTgzMzk1NWYtZTFlNS00ZGY5LWJiN2UtZjljYjc4OTE3MjM5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjE0M1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWE3NGIwZWYyOWI3YjU0YjM2ZmZjNWJkNzJiOWM4MGM0YTNlNmIwYjQ4NjE1ZGJhODk1ZGU5MDI2ZmQxMWQyNTUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.FSuS9phkYl2UIXAFYP07M9a_fFCY7tCZAgxEn6caMG4\"><img width=\"638\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/12592133/277639149-a833955f-e1e5-4df9-bb7e-f9cb78917239.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzMyMDMsIm5iZiI6MTcxNDk3MjkwMywicGF0aCI6Ii8xMjU5MjEzMy8yNzc2MzkxNDktYTgzMzk1NWYtZTFlNS00ZGY5LWJiN2UtZjljYjc4OTE3MjM5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjE0M1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWE3NGIwZWYyOWI3YjU0YjM2ZmZjNWJkNzJiOWM4MGM0YTNlNmIwYjQ4NjE1ZGJhODk1ZGU5MDI2ZmQxMWQyNTUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.FSuS9phkYl2UIXAFYP07M9a_fFCY7tCZAgxEn6caMG4\" style=\"max-width: 100%;\"></a><br>\nSee more details at <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1956860233\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/21419\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/21419/hovercard\" href=\"https://github.com/apache/pulsar/pull/21419\">#21419</a>.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Only keep <code class=\"notranslate\">public static ByteBuf newMultiMessageAck(long consumerId, TxnID txnID, List&lt;Triple&lt;Long, Long, ConcurrentBitSetRecyclable&gt;&gt; entries, long requestID) </code> and mark other methods as deprecated.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21580",
                "createdAt": "2023-11-14T12:14:19Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix the issue of topics possibly being deleted.",
        "url": "https://github.com/apache/pulsar/pull/21704",
        "resourcePath": "/apache/pulsar/pull/21704",
        "createdAt": "2023-12-10T10:19:36Z",
        "number": 21704,
        "mergeCommit": {
          "oid": "84ea1ca05decbcb5d3a3bd1812e53ad10773b259",
          "message": "[fix][broker] Fix the issue of topics possibly being deleted. (#21704)\n\nCo-authored-by: Jiwe Guo <technoboy@apache.org>",
          "commitUrl": "https://github.com/apache/pulsar/commit/84ea1ca05decbcb5d3a3bd1812e53ad10773b259",
          "parents": {
            "nodes": [
              {
                "oid": "58ae0861825076efb7aadd69e460b9d877b90745",
                "message": "[improve][pip] PIP-322: Pulsar Rate Limiting Refactoring (#21680)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentTopicInitializeDelayTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5hnCzM2gAoY2EyZDI4YzcyZTQ5NTFlOWMyMjAxZTIzMGY1Y2ExZjliNTA2MzRjMA",
                "url": "https://github.com/apache/pulsar/pull/21704/commits/ca2d28c72e4951e9c2201e230f5ca1f9b50634c0"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21653,
                "url": "https://github.com/apache/pulsar/issues/21653",
                "title": "[Bug] After upgrading to the 3.0.1, the topic was deleted!",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">3.0.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>broker.conf:</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    systemTopicEnabled: &quot;true&quot;\n    topicLevelPoliciesEnabled: &quot;true&quot;\"><pre class=\"notranslate\"><code class=\"notranslate\">    systemTopicEnabled: \"true\"\n    topicLevelPoliciesEnabled: \"true\"\n</code></pre></div>\n<p dir=\"auto\">3.Setting the <code class=\"notranslate\">publishRate</code> is to ensure the system topic has data</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"        String namespace = &quot;xxx/xxx&quot;;\n        List&lt;String&gt; topicList = pulsarAdmin.topics().getPartitionedTopicList(namespace);\n        topicList = topicList.subList(0, 20);\n        for (String topic : topicList) {\n            PublishRate publishRate = new PublishRate();\n            publishRate.publishThrottlingRateInMsg = 100;\n            pulsarAdmin.topicPolicies().setPublishRate(topic, publishRate);\n        }\"><pre class=\"notranslate\">        <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">namespace</span> = <span class=\"pl-s\">\"xxx/xxx\"</span>;\n        <span class=\"pl-smi\">List</span>&lt;<span class=\"pl-smi\">String</span>&gt; <span class=\"pl-s1\">topicList</span> = <span class=\"pl-s1\">pulsarAdmin</span>.<span class=\"pl-en\">topics</span>().<span class=\"pl-en\">getPartitionedTopicList</span>(<span class=\"pl-s1\">namespace</span>);\n        <span class=\"pl-s1\">topicList</span> = <span class=\"pl-s1\">topicList</span>.<span class=\"pl-en\">subList</span>(<span class=\"pl-c1\">0</span>, <span class=\"pl-c1\">20</span>);\n        <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">String</span> <span class=\"pl-s1\">topic</span> : <span class=\"pl-s1\">topicList</span>) {\n            <span class=\"pl-smi\">PublishRate</span> <span class=\"pl-s1\">publishRate</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">PublishRate</span>();\n            <span class=\"pl-s1\">publishRate</span>.<span class=\"pl-s1\">publishThrottlingRateInMsg</span> = <span class=\"pl-c1\">100</span>;\n            <span class=\"pl-s1\">pulsarAdmin</span>.<span class=\"pl-en\">topicPolicies</span>().<span class=\"pl-en\">setPublishRate</span>(<span class=\"pl-s1\">topic</span>, <span class=\"pl-s1\">publishRate</span>);\n        }</pre></div>\n<ol start=\"4\" dir=\"auto\">\n<li>Concurrent query lookup:</li>\n</ol>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"            topicList = pulsarAdmin.topics().getPartitionedTopicList(namespace);\n            topicList = topicList.subList(0, 20);\n            for (String topic : topicList) {\n                customThreadPool.execute(()-&gt;{\n                    try {\n                        while (true){\n                            pulsarAdmin.lookups().lookupPartitionedTopic(topic);\n                        }\n                    } catch (PulsarAdminException e) {\n                        throw new RuntimeException(e);\n                    }\n                });\n            }\"><pre class=\"notranslate\">            <span class=\"pl-s1\">topicList</span> = <span class=\"pl-s1\">pulsarAdmin</span>.<span class=\"pl-en\">topics</span>().<span class=\"pl-en\">getPartitionedTopicList</span>(<span class=\"pl-s1\">namespace</span>);\n            <span class=\"pl-s1\">topicList</span> = <span class=\"pl-s1\">topicList</span>.<span class=\"pl-en\">subList</span>(<span class=\"pl-c1\">0</span>, <span class=\"pl-c1\">20</span>);\n            <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">String</span> <span class=\"pl-s1\">topic</span> : <span class=\"pl-s1\">topicList</span>) {\n                <span class=\"pl-s1\">customThreadPool</span>.<span class=\"pl-en\">execute</span>(()-&gt;{\n                    <span class=\"pl-k\">try</span> {\n                        <span class=\"pl-k\">while</span> (<span class=\"pl-c1\">true</span>){\n                            <span class=\"pl-s1\">pulsarAdmin</span>.<span class=\"pl-en\">lookups</span>().<span class=\"pl-en\">lookupPartitionedTopic</span>(<span class=\"pl-s1\">topic</span>);\n                        }\n                    } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">PulsarAdminException</span> <span class=\"pl-s1\">e</span>) {\n                        <span class=\"pl-k\">throw</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">RuntimeException</span>(<span class=\"pl-s1\">e</span>);\n                    }\n                });\n            }</pre></div>\n<ol start=\"6\" dir=\"auto\">\n<li>Upgrade 3.0.1 from 2.11.1, this will restart broker(Or <code class=\"notranslate\">unload</code> namespace/topic).</li>\n</ol>\n<p dir=\"auto\">If version 3.0.1 has already been installed, It can also be restart broker:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"k rollout restart statefulset/pulsar-broker\"><pre class=\"notranslate\">k rollout restart statefulset/pulsar-broker</pre></div>\n<p dir=\"auto\">Eventually it was discovered that some topic partitions had been deleted.</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"                try {\n                    stats = pulsarAdmin.topics().getPartitionedStats(topic, true);\n                } catch (PulsarAdminException e) {\n                    throw new RuntimeException(e);\n                }\n                int partitions = stats.getMetadata().partitions;\n                int size = stats.getPartitions().size();\n                if (partitions != size) {\n                    log.info(&quot;**********topic={},partitions={},size={}&quot;, topic, partitions, size);\n//                pulsarAdmin.topics().updatePartitionedTopic(topic, partitions);\n                }\"><pre class=\"notranslate\">                <span class=\"pl-k\">try</span> {\n                    <span class=\"pl-s1\">stats</span> = <span class=\"pl-s1\">pulsarAdmin</span>.<span class=\"pl-en\">topics</span>().<span class=\"pl-en\">getPartitionedStats</span>(<span class=\"pl-s1\">topic</span>, <span class=\"pl-c1\">true</span>);\n                } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">PulsarAdminException</span> <span class=\"pl-s1\">e</span>) {\n                    <span class=\"pl-k\">throw</span> <span class=\"pl-k\">new</span> <span class=\"pl-smi\">RuntimeException</span>(<span class=\"pl-s1\">e</span>);\n                }\n                <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">partitions</span> = <span class=\"pl-s1\">stats</span>.<span class=\"pl-en\">getMetadata</span>().<span class=\"pl-s1\">partitions</span>;\n                <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">size</span> = <span class=\"pl-s1\">stats</span>.<span class=\"pl-en\">getPartitions</span>().<span class=\"pl-en\">size</span>();\n                <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">partitions</span> != <span class=\"pl-s1\">size</span>) {\n                    <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"**********topic={},partitions={},size={}\"</span>, <span class=\"pl-s1\">topic</span>, <span class=\"pl-s1\">partitions</span>, <span class=\"pl-s1\">size</span>);\n<span class=\"pl-c\">//                pulsarAdmin.topics().updatePartitionedTopic(topic, partitions);</span>\n                }</pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Data integrity.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">About 200+ topics were deleted.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The logs of deleted topics:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/15684156/287211799-8ae53e00-491d-4fb4-b75b-8c8ed3a711d3.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzMyMTIsIm5iZiI6MTcxNDk3MjkxMiwicGF0aCI6Ii8xNTY4NDE1Ni8yODcyMTE3OTktOGFlNTNlMDAtNDkxZC00ZmI0LWI3NWItOGM4ZWQzYTcxMWQzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjE1MlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWY5ODNkODQwM2NlYzBmN2VkZjg2NGUwYTNmNjc4MDFkMTA3MjcyZDY3YjJjNGVmOWZmNWMxMzVmNzI5MTliNTEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0._fb-9eHTAzL3kLLl08cd_HuhGO925NS8UMWm0Xd62c8\"><img src=\"https://private-user-images.githubusercontent.com/15684156/287211799-8ae53e00-491d-4fb4-b75b-8c8ed3a711d3.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzMyMTIsIm5iZiI6MTcxNDk3MjkxMiwicGF0aCI6Ii8xNTY4NDE1Ni8yODcyMTE3OTktOGFlNTNlMDAtNDkxZC00ZmI0LWI3NWItOGM4ZWQzYTcxMWQzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjE1MlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWY5ODNkODQwM2NlYzBmN2VkZjg2NGUwYTNmNjc4MDFkMTA3MjcyZDY3YjJjNGVmOWZmNWMxMzVmNzI5MTliNTEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0._fb-9eHTAzL3kLLl08cd_HuhGO925NS8UMWm0Xd62c8\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">The relevant stack logs:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/15684156/287212057-8c5ca03a-a55e-4c01-9525-e80696ed9bf0.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzMyMTIsIm5iZiI6MTcxNDk3MjkxMiwicGF0aCI6Ii8xNTY4NDE1Ni8yODcyMTIwNTctOGM1Y2EwM2EtYTU1ZS00YzAxLTk1MjUtZTgwNjk2ZWQ5YmYwLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjE1MlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVlMWM2NzQzNjVhMTQxZjU2NWEwNjQ4YzUwNDBmMGI4ZDkwZjIyOTc5NDAwZTkxMGVmZDg3YTE4M2MwMjBiNDMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.ck7X7XJG_xX2dPJNCdLPolpT-rgpTbBj9XyZEU3V8d8\"><img src=\"https://private-user-images.githubusercontent.com/15684156/287212057-8c5ca03a-a55e-4c01-9525-e80696ed9bf0.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzMyMTIsIm5iZiI6MTcxNDk3MjkxMiwicGF0aCI6Ii8xNTY4NDE1Ni8yODcyMTIwNTctOGM1Y2EwM2EtYTU1ZS00YzAxLTk1MjUtZTgwNjk2ZWQ5YmYwLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjE1MlomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVlMWM2NzQzNjVhMTQxZjU2NWEwNjQ4YzUwNDBmMGI4ZDkwZjIyOTc5NDAwZTkxMGVmZDg3YTE4M2MwMjBiNDMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.ck7X7XJG_xX2dPJNCdLPolpT-rgpTbBj9XyZEU3V8d8\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">Releted code:<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/90a82aea99fcacdd72fdead672d6e4787ad24760/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java#L1569-L1590\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 1569 to 1590\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/90a82aea99fcacdd72fdead672d6e4787ad24760\">90a82ae</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L1569\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1569\"></td>\n          <td id=\"LC1569\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">public</span> <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Void</span>&gt; <span class=\"pl-en\">checkReplication</span>() { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1570\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1570\"></td>\n          <td id=\"LC1570\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">TopicName</span> <span class=\"pl-s1\">name</span> = <span class=\"pl-smi\">TopicName</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">topic</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1571\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1571\"></td>\n          <td id=\"LC1571\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (!<span class=\"pl-s1\">name</span>.<span class=\"pl-en\">isGlobal</span>() || <span class=\"pl-smi\">NamespaceService</span>.<span class=\"pl-en\">isHeartbeatNamespace</span>(<span class=\"pl-s1\">name</span>)) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1572\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1572\"></td>\n          <td id=\"LC1572\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">return</span> <span class=\"pl-smi\">CompletableFuture</span>.<span class=\"pl-en\">completedFuture</span>(<span class=\"pl-c1\">null</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1573\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1573\"></td>\n          <td id=\"LC1573\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1574\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1574\"></td>\n          <td id=\"LC1574\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1575\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1575\"></td>\n          <td id=\"LC1575\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">log</span>.<span class=\"pl-en\">isDebugEnabled</span>()) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1576\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1576\"></td>\n          <td id=\"LC1576\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">debug</span>(<span class=\"pl-s\">\"[{}] Checking replication status\"</span>, <span class=\"pl-s1\">name</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1577\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1577\"></td>\n          <td id=\"LC1577\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1578\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1578\"></td>\n          <td id=\"LC1578\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1579\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1579\"></td>\n          <td id=\"LC1579\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">List</span>&lt;<span class=\"pl-smi\">String</span>&gt; <span class=\"pl-s1\">configuredClusters</span> = <span class=\"pl-s1\">topicPolicies</span>.<span class=\"pl-en\">getReplicationClusters</span>().<span class=\"pl-en\">get</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1580\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1580\"></td>\n          <td id=\"LC1580\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">newMessageTTLInSeconds</span> = <span class=\"pl-s1\">topicPolicies</span>.<span class=\"pl-en\">getMessageTTLInSeconds</span>().<span class=\"pl-en\">get</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1581\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1581\"></td>\n          <td id=\"LC1581\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1582\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1582\"></td>\n          <td id=\"LC1582\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">localCluster</span> = <span class=\"pl-s1\">brokerService</span>.<span class=\"pl-en\">pulsar</span>().<span class=\"pl-en\">getConfiguration</span>().<span class=\"pl-en\">getClusterName</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1583\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1583\"></td>\n          <td id=\"LC1583\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">  </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1584\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1584\"></td>\n          <td id=\"LC1584\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-c\">// if local cluster is removed from global namespace cluster-list : then delete topic forcefully</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1585\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1585\"></td>\n          <td id=\"LC1585\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-c\">// because pulsar doesn't serve global topic without local repl-cluster configured.</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1586\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1586\"></td>\n          <td id=\"LC1586\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-smi\">TopicName</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">topic</span>).<span class=\"pl-en\">isGlobal</span>() &amp;&amp; !<span class=\"pl-s1\">configuredClusters</span>.<span class=\"pl-en\">contains</span>(<span class=\"pl-s1\">localCluster</span>)) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1587\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1587\"></td>\n          <td id=\"LC1587\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"Deleting topic [{}] because local cluster is not part of \"</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1588\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1588\"></td>\n          <td id=\"LC1588\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                 + <span class=\"pl-s\">\" global namespace repl list {}\"</span>, <span class=\"pl-s1\">topic</span>, <span class=\"pl-s1\">configuredClusters</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1589\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1589\"></td>\n          <td id=\"LC1589\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">return</span> <span class=\"pl-en\">deleteForcefully</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1590\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1590\"></td>\n          <td id=\"LC1590\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21653",
                "createdAt": "2023-12-01T08:52:23Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix PerformanceProducer send count error",
        "url": "https://github.com/apache/pulsar/pull/21706",
        "resourcePath": "/apache/pulsar/pull/21706",
        "createdAt": "2023-12-11T11:14:09Z",
        "number": 21706,
        "mergeCommit": {
          "oid": "19b93442546656b336c3a71adcb23dc12698632a",
          "message": "[fix][test] Fix PerformanceProducer send count error (#21706)",
          "commitUrl": "https://github.com/apache/pulsar/commit/19b93442546656b336c3a71adcb23dc12698632a",
          "parents": {
            "nodes": [
              {
                "oid": "51fc406bfbfd14923245b4e95a2eb8c3cee70307",
                "message": "[cleanup][broker] Remove internalGetListAsync and validatePartitionTopicUpdateAsync (#21699)\n\nSigned-off-by: Zixuan Liu <nodeces@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-testclient/src/main/java/org/apache/pulsar/testclient/PerformanceProducer.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5hq0YN2gAoNzc4NTZhODE4MjVlYjliZGZiOWEwYmNkZGZhYTk4NWEwYTMxNzcwYw",
                "url": "https://github.com/apache/pulsar/pull/21706/commits/77856a81825eb9bdfb9a0bcddfaa985a0a31770c"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21703,
                "url": "https://github.com/apache/pulsar/issues/21703",
                "title": "Flaky-test: PerfToolTest.testConsume",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failures</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/7149428670/job/19471880660#step:12:29252\">2023-12-09T07:00:19.0256656Z</a></li>\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/7124384472/job/19398907019#step:12:30270\">2023-12-07T06:57:11.2570958Z</a></li>\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/7096812955/job/19316320904#step:12:29409\">2023-12-05T06:56:16.4068540Z</a></li>\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/7075039658/job/19256939740#step:12:30763\">2023-12-03T06:55:49.9618583Z</a></li>\n</ul>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.util.concurrent.TimeoutException\n\tat java.base/java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1960)\n\tat java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2095)\n\tat org.apache.pulsar.tests.integration.cli.PerfToolTest.consumeWithPerfTool(PerfToolTest.java:80)\n\tat org.apache.pulsar.tests.integration.cli.PerfToolTest.testConsume(PerfToolTest.java:53)\n\tat java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:580)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\"><pre class=\"notranslate\"><code class=\"notranslate\">java.util.concurrent.TimeoutException\n\tat java.base/java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1960)\n\tat java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2095)\n\tat org.apache.pulsar.tests.integration.cli.PerfToolTest.consumeWithPerfTool(PerfToolTest.java:80)\n\tat org.apache.pulsar.tests.integration.cli.PerfToolTest.testConsume(PerfToolTest.java:53)\n\tat java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:580)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21703",
                "createdAt": "2023-12-09T18:48:09Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky test ReplicatorGlobalNSTest#testRemoveLocalClusterOnGlobalNamespace",
        "url": "https://github.com/apache/pulsar/pull/21708",
        "resourcePath": "/apache/pulsar/pull/21708",
        "createdAt": "2023-12-11T14:32:10Z",
        "number": 21708,
        "mergeCommit": {
          "oid": "757723e4c03b2aa2e5203e90fdb9ecb255e18a3b",
          "message": "[fix][test] Fix flaky test ReplicatorGlobalNSTest#testRemoveLocalClusterOnGlobalNamespace (#21708)",
          "commitUrl": "https://github.com/apache/pulsar/commit/757723e4c03b2aa2e5203e90fdb9ecb255e18a3b",
          "parents": {
            "nodes": [
              {
                "oid": "3396065a3a62af3e3586700f0bbfcbff93716b48",
                "message": "[fix][fn] Fix Deadlock in Functions Worker LeaderService (#21711)\n\nFixes #21501\r\n\r\n### Motivation\r\n\r\nNo need to `synchronized` the method `isLeader` in LeaderService\r\n\r\nSee the deadlock stack :\r\n```\r\n\"pulsar-external-listener-44525-1\":\r\n\tat org.apache.pulsar.functions.worker.FunctionMetaDataManager.giveupLeadership(FunctionMetaDataManager.java)\r\n\t- waiting to lock <0x0000100013535c90> (a org.apache.pulsar.functions.worker.FunctionMetaDataManager)\r\n\tat org.apache.pulsar.functions.worker.LeaderService.becameInactive(LeaderService.java:167)\r\n\t- locked <0x000010001344c6d8> (a org.apache.pulsar.functions.worker.LeaderService)\r\n\tat org.apache.pulsar.client.impl.ConsumerImpl.lambda$activeConsumerChanged$27(ConsumerImpl.java:1136)\r\n\tat org.apache.pulsar.client.impl.ConsumerImpl$$Lambda$2606/0x00007f854ce9cb10.run(Unknown Source)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@17.0.8.1/ThreadPoolExecutor.java:1136)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@17.0.8.1/ThreadPoolExecutor.java:635)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(java.base@17.0.8.1/Thread.java:833)\r\n\"pulsar-web-44514-6\":\r\n\tat org.apache.pulsar.functions.worker.LeaderService.isLeader(LeaderService.java)\r\n\t- waiting to lock <0x000010001344c6d8> (a org.apache.pulsar.functions.worker.LeaderService)\r\n\tat org.apache.pulsar.functions.worker.SchedulerManager.scheduleInternal(SchedulerManager.java:200)\r\n\tat org.apache.pulsar.functions.worker.SchedulerManager.schedule(SchedulerManager.java:229)\r\n\tat org.apache.pulsar.functions.worker.FunctionMetaDataManager.updateFunctionOnLeader(FunctionMetaDataManager.java:251)\r\n\t- locked <0x0000100013535c90> (a org.apache.pulsar.functions.worker.FunctionMetaDataManager)\r\n\tat org.apache.pulsar.functions.worker.rest.api.ComponentImpl.internalProcessFunctionRequest(ComponentImpl.java:1775)\r\n\tat org.apache.pulsar.functions.worker.rest.api.ComponentImpl.updateRequest(ComponentImpl.java:996)\r\n\tat org.apache.pulsar.functions.worker.rest.api.FunctionsImpl.registerFunction(FunctionsImpl.java:222)\r\n\tat org.apache.pulsar.broker.admin.impl.FunctionsBase.registerFunction(FunctionsBase.java:196)\r\n```"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/ReplicatorGlobalNSTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5hsJCk2gAoMzA5MjhkZjhkYTk4MDZkYTM2MWI2ZDEyMGY3NWNhNzkzYzA2M2U5Mg",
                "url": "https://github.com/apache/pulsar/pull/21708/commits/30928df8da9806da361b6d120f75ca793c063e92"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21534,
                "url": "https://github.com/apache/pulsar/issues/21534",
                "title": "Flaky-test: ReplicatorGlobalNSTest.testRemoveLocalClusterOnGlobalNamespace",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failures</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6692097300/job/18181072908#step:11:1535\">2023-10-30T12:02:20.4890618Z</a></li>\n</ul>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.lang.AssertionError: expected [false] but found [true]\n\tat org.testng.Assert.fail(Assert.java:110)\n\tat org.testng.Assert.failNotEquals(Assert.java:1577)\n\tat org.testng.Assert.assertFalse(Assert.java:78)\n\tat org.testng.Assert.assertFalse(Assert.java:88)\n\tat org.apache.pulsar.broker.service.ReplicatorGlobalNSTest.testRemoveLocalClusterOnGlobalNamespace(ReplicatorGlobalNSTest.java:97)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:833)\n\"><pre class=\"notranslate\"><code class=\"notranslate\">java.lang.AssertionError: expected [false] but found [true]\n\tat org.testng.Assert.fail(Assert.java:110)\n\tat org.testng.Assert.failNotEquals(Assert.java:1577)\n\tat org.testng.Assert.assertFalse(Assert.java:78)\n\tat org.testng.Assert.assertFalse(Assert.java:88)\n\tat org.apache.pulsar.broker.service.ReplicatorGlobalNSTest.testRemoveLocalClusterOnGlobalNamespace(ReplicatorGlobalNSTest.java:97)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:833)\n\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21534",
                "createdAt": "2023-11-07T12:55:08Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Fix Deadlock in Functions Worker LeaderService",
        "url": "https://github.com/apache/pulsar/pull/21711",
        "resourcePath": "/apache/pulsar/pull/21711",
        "createdAt": "2023-12-12T02:45:17Z",
        "number": 21711,
        "mergeCommit": {
          "oid": "3396065a3a62af3e3586700f0bbfcbff93716b48",
          "message": "[fix][fn] Fix Deadlock in Functions Worker LeaderService (#21711)\n\nFixes #21501\r\n\r\n### Motivation\r\n\r\nNo need to `synchronized` the method `isLeader` in LeaderService\r\n\r\nSee the deadlock stack :\r\n```\r\n\"pulsar-external-listener-44525-1\":\r\n\tat org.apache.pulsar.functions.worker.FunctionMetaDataManager.giveupLeadership(FunctionMetaDataManager.java)\r\n\t- waiting to lock <0x0000100013535c90> (a org.apache.pulsar.functions.worker.FunctionMetaDataManager)\r\n\tat org.apache.pulsar.functions.worker.LeaderService.becameInactive(LeaderService.java:167)\r\n\t- locked <0x000010001344c6d8> (a org.apache.pulsar.functions.worker.LeaderService)\r\n\tat org.apache.pulsar.client.impl.ConsumerImpl.lambda$activeConsumerChanged$27(ConsumerImpl.java:1136)\r\n\tat org.apache.pulsar.client.impl.ConsumerImpl$$Lambda$2606/0x00007f854ce9cb10.run(Unknown Source)\r\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@17.0.8.1/ThreadPoolExecutor.java:1136)\r\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@17.0.8.1/ThreadPoolExecutor.java:635)\r\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\r\n\tat java.lang.Thread.run(java.base@17.0.8.1/Thread.java:833)\r\n\"pulsar-web-44514-6\":\r\n\tat org.apache.pulsar.functions.worker.LeaderService.isLeader(LeaderService.java)\r\n\t- waiting to lock <0x000010001344c6d8> (a org.apache.pulsar.functions.worker.LeaderService)\r\n\tat org.apache.pulsar.functions.worker.SchedulerManager.scheduleInternal(SchedulerManager.java:200)\r\n\tat org.apache.pulsar.functions.worker.SchedulerManager.schedule(SchedulerManager.java:229)\r\n\tat org.apache.pulsar.functions.worker.FunctionMetaDataManager.updateFunctionOnLeader(FunctionMetaDataManager.java:251)\r\n\t- locked <0x0000100013535c90> (a org.apache.pulsar.functions.worker.FunctionMetaDataManager)\r\n\tat org.apache.pulsar.functions.worker.rest.api.ComponentImpl.internalProcessFunctionRequest(ComponentImpl.java:1775)\r\n\tat org.apache.pulsar.functions.worker.rest.api.ComponentImpl.updateRequest(ComponentImpl.java:996)\r\n\tat org.apache.pulsar.functions.worker.rest.api.FunctionsImpl.registerFunction(FunctionsImpl.java:222)\r\n\tat org.apache.pulsar.broker.admin.impl.FunctionsBase.registerFunction(FunctionsBase.java:196)\r\n```",
          "commitUrl": "https://github.com/apache/pulsar/commit/3396065a3a62af3e3586700f0bbfcbff93716b48",
          "parents": {
            "nodes": [
              {
                "oid": "19b93442546656b336c3a71adcb23dc12698632a",
                "message": "[fix][test] Fix PerformanceProducer send count error (#21706)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/functions/worker/PulsarFunctionTlsTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/LeaderService.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5hvxWi2gAoYjBmODc3MjVmOGY4YjBmMTNlZGYyMzQ1MGNiZjMxNDE5OTAwYmYzYQ",
                "url": "https://github.com/apache/pulsar/pull/21711/commits/b0f87725f8f8b0f13edf23450cbf31419900bf3a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21501,
                "url": "https://github.com/apache/pulsar/issues/21501",
                "title": "[Bug] Deadlock in Functions Worker service at shutdown in tests",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">current master <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/apache/pulsar/commit/6ab322ed39901ca1b3e375ccf66d26a24da5874f/hovercard\" href=\"https://github.com/apache/pulsar/commit/6ab322ed39901ca1b3e375ccf66d26a24da5874f\"><tt>6ab322e</tt></a></p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">happens in PulsarFunctionTlsTest</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">no deadlocks</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">a deadlock between threads</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">jstack review UI for thread dump: <a href=\"https://jstack.review/?https://gist.github.com/lhotari/58eb0d30def7a316a28626aea8037c26#tda_1_dump\" rel=\"nofollow\">https://jstack.review/?https://gist.github.com/lhotari/58eb0d30def7a316a28626aea8037c26#tda_1_dump</a><br>\nRaw thread dump: <a href=\"https://gist.github.com/lhotari/58eb0d30def7a316a28626aea8037c26\">https://gist.github.com/lhotari/58eb0d30def7a316a28626aea8037c26</a></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Found one Java-level deadlock:\n=============================\n&quot;main&quot;:\n  waiting for ownable synchronizer 0x0000100013535bc8, (a java.util.concurrent.locks.ReentrantLock$FairSync),\n  which is held by &quot;worker-scheduler-0&quot;\n\n&quot;worker-scheduler-0&quot;:\n  waiting to lock monitor 0x00007f85944412f0 (object 0x000010001344c6d8, a org.apache.pulsar.functions.worker.LeaderService),\n  which is held by &quot;pulsar-external-listener-44525-1&quot;\n\n&quot;pulsar-external-listener-44525-1&quot;:\n  waiting to lock monitor 0x00007f85182825a0 (object 0x0000100013535c90, a org.apache.pulsar.functions.worker.FunctionMetaDataManager),\n  which is held by &quot;pulsar-web-44514-6&quot;\n\n&quot;pulsar-web-44514-6&quot;:\n  waiting to lock monitor 0x00007f85944412f0 (object 0x000010001344c6d8, a org.apache.pulsar.functions.worker.LeaderService),\n  which is held by &quot;pulsar-external-listener-44525-1&quot;\n\nJava stack information for the threads listed above:\n===================================================\n&quot;main&quot;:\n\tat jdk.internal.misc.Unsafe.park(java.base@17.0.8.1/Native Method)\n\t- parking to wait for  &lt;0x0000100013535bc8&gt; (a java.util.concurrent.locks.ReentrantLock$FairSync)\n\tat java.util.concurrent.locks.LockSupport.park(java.base@17.0.8.1/LockSupport.java:211)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(java.base@17.0.8.1/AbstractQueuedSynchronizer.java:715)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(java.base@17.0.8.1/AbstractQueuedSynchronizer.java:938)\n\tat java.util.concurrent.locks.ReentrantLock$Sync.lock(java.base@17.0.8.1/ReentrantLock.java:153)\n\tat java.util.concurrent.locks.ReentrantLock.lock(java.base@17.0.8.1/ReentrantLock.java:322)\n\tat org.apache.pulsar.functions.worker.SchedulerManager.close(SchedulerManager.java:744)\n\t- locked &lt;0x0000100013535af8&gt; (a org.apache.pulsar.functions.worker.SchedulerManager)\n\tat org.apache.pulsar.functions.worker.PulsarWorkerService.stop(PulsarWorkerService.java:623)\n\tat org.apache.pulsar.functions.worker.PulsarFunctionTlsTest.tearDown(PulsarFunctionTlsTest.java:198)\n\tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(java.base@17.0.8.1/Native Method)\n\tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke(java.base@17.0.8.1/NativeMethodAccessorImpl.java:77)\n\tat jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(java.base@17.0.8.1/DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(java.base@17.0.8.1/Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n\tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n\tat org.testng.internal.invokers.TestInvoker.runAfterConfigurations(TestInvoker.java:792)\n\tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:768)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n\tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n\tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n\tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n\tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n\tat org.testng.TestRunner$$Lambda$254/0x00007f854c23a680.accept(Unknown Source)\n\tat java.util.ArrayList.forEach(java.base@17.0.8.1/ArrayList.java:1511)\n\tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n\tat org.testng.TestRunner.run(TestRunner.java:602)\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n\tat org.testng.TestNG.runSuites(TestNG.java:1099)\n\tat org.testng.TestNG.run(TestNG.java:1067)\n\tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n\tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n\tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n\tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n\tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n\tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n&quot;worker-scheduler-0&quot;:\n\tat org.apache.pulsar.functions.worker.LeaderService.isLeader(LeaderService.java)\n\t- waiting to lock &lt;0x000010001344c6d8&gt; (a org.apache.pulsar.functions.worker.LeaderService)\n\tat org.apache.pulsar.functions.worker.SchedulerManager.lambda$scheduleInternal$0(SchedulerManager.java:208)\n\tat org.apache.pulsar.functions.worker.SchedulerManager$$Lambda$2610/0x00007f854ce9d3b0.run(Unknown Source)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(java.base@17.0.8.1/Executors.java:539)\n\tat java.util.concurrent.FutureTask.run(java.base@17.0.8.1/FutureTask.java:264)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@17.0.8.1/ThreadPoolExecutor.java:1136)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@17.0.8.1/ThreadPoolExecutor.java:635)\n\tat java.lang.Thread.run(java.base@17.0.8.1/Thread.java:833)\n&quot;pulsar-external-listener-44525-1&quot;:\n\tat org.apache.pulsar.functions.worker.FunctionMetaDataManager.giveupLeadership(FunctionMetaDataManager.java)\n\t- waiting to lock &lt;0x0000100013535c90&gt; (a org.apache.pulsar.functions.worker.FunctionMetaDataManager)\n\tat org.apache.pulsar.functions.worker.LeaderService.becameInactive(LeaderService.java:167)\n\t- locked &lt;0x000010001344c6d8&gt; (a org.apache.pulsar.functions.worker.LeaderService)\n\tat org.apache.pulsar.client.impl.ConsumerImpl.lambda$activeConsumerChanged$27(ConsumerImpl.java:1136)\n\tat org.apache.pulsar.client.impl.ConsumerImpl$$Lambda$2606/0x00007f854ce9cb10.run(Unknown Source)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@17.0.8.1/ThreadPoolExecutor.java:1136)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@17.0.8.1/ThreadPoolExecutor.java:635)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.lang.Thread.run(java.base@17.0.8.1/Thread.java:833)\n&quot;pulsar-web-44514-6&quot;:\n\tat org.apache.pulsar.functions.worker.LeaderService.isLeader(LeaderService.java)\n\t- waiting to lock &lt;0x000010001344c6d8&gt; (a org.apache.pulsar.functions.worker.LeaderService)\n\tat org.apache.pulsar.functions.worker.SchedulerManager.scheduleInternal(SchedulerManager.java:200)\n\tat org.apache.pulsar.functions.worker.SchedulerManager.schedule(SchedulerManager.java:229)\n\tat org.apache.pulsar.functions.worker.FunctionMetaDataManager.updateFunctionOnLeader(FunctionMetaDataManager.java:251)\n\t- locked &lt;0x0000100013535c90&gt; (a org.apache.pulsar.functions.worker.FunctionMetaDataManager)\n\tat org.apache.pulsar.functions.worker.rest.api.ComponentImpl.internalProcessFunctionRequest(ComponentImpl.java:1775)\n\tat org.apache.pulsar.functions.worker.rest.api.ComponentImpl.updateRequest(ComponentImpl.java:996)\n\tat org.apache.pulsar.functions.worker.rest.api.FunctionsImpl.registerFunction(FunctionsImpl.java:222)\n\tat org.apache.pulsar.broker.admin.impl.FunctionsBase.registerFunction(FunctionsBase.java:196)\n\tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(java.base@17.0.8.1/Native Method)\n\tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke(java.base@17.0.8.1/NativeMethodAccessorImpl.java:77)\n\tat jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(java.base@17.0.8.1/DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(java.base@17.0.8.1/Method.java:568)\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:52)\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$$Lambda$752/0x00007f854c6b6410.invoke(Unknown Source)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:124)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:167)\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:159)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:79)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:475)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:397)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:81)\n\tat org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:255)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:292)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:274)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:244)\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:265)\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:234)\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:680)\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:394)\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:346)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:366)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:319)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:205)\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:799)\n\tat org.eclipse.jetty.servlet.ServletHandler$ChainEnd.doFilter(ServletHandler.java:1656)\n\tat org.apache.pulsar.broker.web.AuthenticationFilter.doFilter(AuthenticationFilter.java:73)\n\tat org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193)\n\tat org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626)\n\tat org.eclipse.jetty.servlets.QoSFilter.doFilter(QoSFilter.java:202)\n\tat org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193)\n\tat org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:552)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1624)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1440)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:505)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1594)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1355)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:234)\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146)\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:181)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:516)\n\tat org.eclipse.jetty.server.HttpChannel.lambda$handle$1(HttpChannel.java:487)\n\tat org.eclipse.jetty.server.HttpChannel$$Lambda$904/0x00007f854c9596e8.dispatch(Unknown Source)\n\tat org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:732)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:479)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:277)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105)\n\tat org.eclipse.jetty.io.ssl.SslConnection$DecryptedEndPoint.onFillable(SslConnection.java:555)\n\tat org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:410)\n\tat org.eclipse.jetty.io.ssl.SslConnection$2.succeeded(SslConnection.java:164)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105)\n\tat org.eclipse.jetty.io.ChannelEndPoint$1.run(ChannelEndPoint.java:104)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:338)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:315)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:173)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:131)\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:409)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@17.0.8.1/ThreadPoolExecutor.java:1136)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@17.0.8.1/ThreadPoolExecutor.java:635)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.lang.Thread.run(java.base@17.0.8.1/Thread.java:833)\n\nFound 1 deadlock.\"><pre class=\"notranslate\"><code class=\"notranslate\">Found one Java-level deadlock:\n=============================\n\"main\":\n  waiting for ownable synchronizer 0x0000100013535bc8, (a java.util.concurrent.locks.ReentrantLock$FairSync),\n  which is held by \"worker-scheduler-0\"\n\n\"worker-scheduler-0\":\n  waiting to lock monitor 0x00007f85944412f0 (object 0x000010001344c6d8, a org.apache.pulsar.functions.worker.LeaderService),\n  which is held by \"pulsar-external-listener-44525-1\"\n\n\"pulsar-external-listener-44525-1\":\n  waiting to lock monitor 0x00007f85182825a0 (object 0x0000100013535c90, a org.apache.pulsar.functions.worker.FunctionMetaDataManager),\n  which is held by \"pulsar-web-44514-6\"\n\n\"pulsar-web-44514-6\":\n  waiting to lock monitor 0x00007f85944412f0 (object 0x000010001344c6d8, a org.apache.pulsar.functions.worker.LeaderService),\n  which is held by \"pulsar-external-listener-44525-1\"\n\nJava stack information for the threads listed above:\n===================================================\n\"main\":\n\tat jdk.internal.misc.Unsafe.park(java.base@17.0.8.1/Native Method)\n\t- parking to wait for  &lt;0x0000100013535bc8&gt; (a java.util.concurrent.locks.ReentrantLock$FairSync)\n\tat java.util.concurrent.locks.LockSupport.park(java.base@17.0.8.1/LockSupport.java:211)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(java.base@17.0.8.1/AbstractQueuedSynchronizer.java:715)\n\tat java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(java.base@17.0.8.1/AbstractQueuedSynchronizer.java:938)\n\tat java.util.concurrent.locks.ReentrantLock$Sync.lock(java.base@17.0.8.1/ReentrantLock.java:153)\n\tat java.util.concurrent.locks.ReentrantLock.lock(java.base@17.0.8.1/ReentrantLock.java:322)\n\tat org.apache.pulsar.functions.worker.SchedulerManager.close(SchedulerManager.java:744)\n\t- locked &lt;0x0000100013535af8&gt; (a org.apache.pulsar.functions.worker.SchedulerManager)\n\tat org.apache.pulsar.functions.worker.PulsarWorkerService.stop(PulsarWorkerService.java:623)\n\tat org.apache.pulsar.functions.worker.PulsarFunctionTlsTest.tearDown(PulsarFunctionTlsTest.java:198)\n\tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(java.base@17.0.8.1/Native Method)\n\tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke(java.base@17.0.8.1/NativeMethodAccessorImpl.java:77)\n\tat jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(java.base@17.0.8.1/DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(java.base@17.0.8.1/Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n\tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n\tat org.testng.internal.invokers.TestInvoker.runAfterConfigurations(TestInvoker.java:792)\n\tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:768)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n\tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n\tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n\tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n\tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n\tat org.testng.TestRunner$$Lambda$254/0x00007f854c23a680.accept(Unknown Source)\n\tat java.util.ArrayList.forEach(java.base@17.0.8.1/ArrayList.java:1511)\n\tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n\tat org.testng.TestRunner.run(TestRunner.java:602)\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n\tat org.testng.TestNG.runSuites(TestNG.java:1099)\n\tat org.testng.TestNG.run(TestNG.java:1067)\n\tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n\tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n\tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n\tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n\tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n\tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n\"worker-scheduler-0\":\n\tat org.apache.pulsar.functions.worker.LeaderService.isLeader(LeaderService.java)\n\t- waiting to lock &lt;0x000010001344c6d8&gt; (a org.apache.pulsar.functions.worker.LeaderService)\n\tat org.apache.pulsar.functions.worker.SchedulerManager.lambda$scheduleInternal$0(SchedulerManager.java:208)\n\tat org.apache.pulsar.functions.worker.SchedulerManager$$Lambda$2610/0x00007f854ce9d3b0.run(Unknown Source)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(java.base@17.0.8.1/Executors.java:539)\n\tat java.util.concurrent.FutureTask.run(java.base@17.0.8.1/FutureTask.java:264)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@17.0.8.1/ThreadPoolExecutor.java:1136)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@17.0.8.1/ThreadPoolExecutor.java:635)\n\tat java.lang.Thread.run(java.base@17.0.8.1/Thread.java:833)\n\"pulsar-external-listener-44525-1\":\n\tat org.apache.pulsar.functions.worker.FunctionMetaDataManager.giveupLeadership(FunctionMetaDataManager.java)\n\t- waiting to lock &lt;0x0000100013535c90&gt; (a org.apache.pulsar.functions.worker.FunctionMetaDataManager)\n\tat org.apache.pulsar.functions.worker.LeaderService.becameInactive(LeaderService.java:167)\n\t- locked &lt;0x000010001344c6d8&gt; (a org.apache.pulsar.functions.worker.LeaderService)\n\tat org.apache.pulsar.client.impl.ConsumerImpl.lambda$activeConsumerChanged$27(ConsumerImpl.java:1136)\n\tat org.apache.pulsar.client.impl.ConsumerImpl$$Lambda$2606/0x00007f854ce9cb10.run(Unknown Source)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@17.0.8.1/ThreadPoolExecutor.java:1136)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@17.0.8.1/ThreadPoolExecutor.java:635)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.lang.Thread.run(java.base@17.0.8.1/Thread.java:833)\n\"pulsar-web-44514-6\":\n\tat org.apache.pulsar.functions.worker.LeaderService.isLeader(LeaderService.java)\n\t- waiting to lock &lt;0x000010001344c6d8&gt; (a org.apache.pulsar.functions.worker.LeaderService)\n\tat org.apache.pulsar.functions.worker.SchedulerManager.scheduleInternal(SchedulerManager.java:200)\n\tat org.apache.pulsar.functions.worker.SchedulerManager.schedule(SchedulerManager.java:229)\n\tat org.apache.pulsar.functions.worker.FunctionMetaDataManager.updateFunctionOnLeader(FunctionMetaDataManager.java:251)\n\t- locked &lt;0x0000100013535c90&gt; (a org.apache.pulsar.functions.worker.FunctionMetaDataManager)\n\tat org.apache.pulsar.functions.worker.rest.api.ComponentImpl.internalProcessFunctionRequest(ComponentImpl.java:1775)\n\tat org.apache.pulsar.functions.worker.rest.api.ComponentImpl.updateRequest(ComponentImpl.java:996)\n\tat org.apache.pulsar.functions.worker.rest.api.FunctionsImpl.registerFunction(FunctionsImpl.java:222)\n\tat org.apache.pulsar.broker.admin.impl.FunctionsBase.registerFunction(FunctionsBase.java:196)\n\tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(java.base@17.0.8.1/Native Method)\n\tat jdk.internal.reflect.NativeMethodAccessorImpl.invoke(java.base@17.0.8.1/NativeMethodAccessorImpl.java:77)\n\tat jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(java.base@17.0.8.1/DelegatingMethodAccessorImpl.java:43)\n\tat java.lang.reflect.Method.invoke(java.base@17.0.8.1/Method.java:568)\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:52)\n\tat org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory$$Lambda$752/0x00007f854c6b6410.invoke(Unknown Source)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:124)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:167)\n\tat org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:159)\n\tat org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:79)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:475)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:397)\n\tat org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:81)\n\tat org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:255)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:292)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:274)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:244)\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:265)\n\tat org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:234)\n\tat org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:680)\n\tat org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:394)\n\tat org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:346)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:366)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:319)\n\tat org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:205)\n\tat org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:799)\n\tat org.eclipse.jetty.servlet.ServletHandler$ChainEnd.doFilter(ServletHandler.java:1656)\n\tat org.apache.pulsar.broker.web.AuthenticationFilter.doFilter(AuthenticationFilter.java:73)\n\tat org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193)\n\tat org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626)\n\tat org.eclipse.jetty.servlets.QoSFilter.doFilter(QoSFilter.java:202)\n\tat org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193)\n\tat org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626)\n\tat org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:552)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)\n\tat org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1624)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1440)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188)\n\tat org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:505)\n\tat org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1594)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186)\n\tat org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1355)\n\tat org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141)\n\tat org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:234)\n\tat org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146)\n\tat org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:181)\n\tat org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127)\n\tat org.eclipse.jetty.server.Server.handle(Server.java:516)\n\tat org.eclipse.jetty.server.HttpChannel.lambda$handle$1(HttpChannel.java:487)\n\tat org.eclipse.jetty.server.HttpChannel$$Lambda$904/0x00007f854c9596e8.dispatch(Unknown Source)\n\tat org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:732)\n\tat org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:479)\n\tat org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:277)\n\tat org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105)\n\tat org.eclipse.jetty.io.ssl.SslConnection$DecryptedEndPoint.onFillable(SslConnection.java:555)\n\tat org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:410)\n\tat org.eclipse.jetty.io.ssl.SslConnection$2.succeeded(SslConnection.java:164)\n\tat org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105)\n\tat org.eclipse.jetty.io.ChannelEndPoint$1.run(ChannelEndPoint.java:104)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:338)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:315)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:173)\n\tat org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:131)\n\tat org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:409)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(java.base@17.0.8.1/ThreadPoolExecutor.java:1136)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(java.base@17.0.8.1/ThreadPoolExecutor.java:635)\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.lang.Thread.run(java.base@17.0.8.1/Thread.java:833)\n\nFound 1 deadlock.\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21501",
                "createdAt": "2023-11-01T22:02:55Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky test FilterEntryTest.testFilter",
        "url": "https://github.com/apache/pulsar/pull/21713",
        "resourcePath": "/apache/pulsar/pull/21713",
        "createdAt": "2023-12-12T12:50:45Z",
        "number": 21713,
        "mergeCommit": {
          "oid": "7bb6af2209796b714115092938e233c1272e3ca7",
          "message": "[fix][test] Fix flaky test FilterEntryTest.testFilter (#21713)",
          "commitUrl": "https://github.com/apache/pulsar/commit/7bb6af2209796b714115092938e233c1272e3ca7",
          "parents": {
            "nodes": [
              {
                "oid": "c34a5d816a12dcb108e94de6afc8108a8d86ebac",
                "message": "[improve][pip] PIP-313 Support force unsubscribe using consumer api (#21452)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/plugin/FilterEntryTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5hyh4K2gAoOGJlYjE3OThhOGYzM2Q4Y2U1MGZkYmM4NTVlNDBhZDcwNDM0YjMyNA",
                "url": "https://github.com/apache/pulsar/pull/21713/commits/8beb1798a8f33d8ce50fdbc855e40ad70434b324"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21712,
                "url": "https://github.com/apache/pulsar/issues/21712",
                "title": "Flaky-test: FilterEntryTest. testFilter",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/7176247224/job/19541021647?pr=21711\">https://github.com/apache/pulsar/actions/runs/7176247224/job/19541021647?pr=21711</a><br>\n<a href=\"https://github.com/apache/pulsar/actions/runs/7208049048/job/19637548110?pr=21704\">https://github.com/apache/pulsar/actions/runs/7208049048/job/19637548110?pr=21704</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error:  Tests run: 20, Failures: 1, Errors: 0, Skipped: 16, Time elapsed: 24.003 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.plugin.FilterEntryTest\n  Error:  org.apache.pulsar.broker.service.plugin.FilterEntryTest.testFilter  Time elapsed: 1.917 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected:&lt;10&gt; but was:&lt;8&gt;\n  \tat org.testng.AssertJUnit.fail(AssertJUnit.java:65)\n  \tat org.testng.AssertJUnit.failNotEquals(AssertJUnit.java:467)\n  \tat org.testng.AssertJUnit.assertEquals(AssertJUnit.java:88)\n  \tat org.testng.AssertJUnit.assertEquals(AssertJUnit.java:318)\n  \tat org.testng.AssertJUnit.assertEquals(AssertJUnit.java:328)\n  \tat org.apache.pulsar.broker.service.plugin.FilterEntryTest.testFilter(FilterEntryTest.java:267)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:840)\"><pre class=\"notranslate\"><code class=\"notranslate\">Error:  Tests run: 20, Failures: 1, Errors: 0, Skipped: 16, Time elapsed: 24.003 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.plugin.FilterEntryTest\n  Error:  org.apache.pulsar.broker.service.plugin.FilterEntryTest.testFilter  Time elapsed: 1.917 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected:&lt;10&gt; but was:&lt;8&gt;\n  \tat org.testng.AssertJUnit.fail(AssertJUnit.java:65)\n  \tat org.testng.AssertJUnit.failNotEquals(AssertJUnit.java:467)\n  \tat org.testng.AssertJUnit.assertEquals(AssertJUnit.java:88)\n  \tat org.testng.AssertJUnit.assertEquals(AssertJUnit.java:318)\n  \tat org.testng.AssertJUnit.assertEquals(AssertJUnit.java:328)\n  \tat org.apache.pulsar.broker.service.plugin.FilterEntryTest.testFilter(FilterEntryTest.java:267)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:840)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21712",
                "createdAt": "2023-12-12T04:42:55Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix closing of AbstractDispatcherSingleActiveConsumer and reduce flakiness of test",
        "url": "https://github.com/apache/pulsar/pull/21736",
        "resourcePath": "/apache/pulsar/pull/21736",
        "createdAt": "2023-12-15T20:57:16Z",
        "number": 21736,
        "mergeCommit": {
          "oid": "ed68ec106fed34ea39fc52810e270094b35e2ca3",
          "message": "[fix][broker] Fix closing of AbstractDispatcherSingleActiveConsumer and reduce flakiness of test (#21736)",
          "commitUrl": "https://github.com/apache/pulsar/commit/ed68ec106fed34ea39fc52810e270094b35e2ca3",
          "parents": {
            "nodes": [
              {
                "oid": "0ad18670263d1331ffa220f36883db8615abac89",
                "message": "[fix][test] Fix flaky PersistentTopicTest.setup (#21755)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractDispatcherSingleActiveConsumer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/Dispatcher.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentDispatcherMultipleConsumers.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentDispatcherMultipleConsumers.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentDispatcherSingleActiveConsumer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SubscriptionMessageDispatchThrottlingTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5iJQ0Z2gAoMjJlMDE2Y2I2MzI4MzlhMTQ2NDIwZjg2YTI1MWMzOGU1OGM2MjhlYw",
                "url": "https://github.com/apache/pulsar/pull/21736/commits/22e016cb632839a146420f86a251c38e58c628ec"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21756,
                "url": "https://github.com/apache/pulsar/issues/21756",
                "title": "Flaky-test: SubscriptionMessageDispatchThrottlingTest.testClosingRateLimiter",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failures</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/7258004430/job/19772661615#step:9:2165\">2023-12-19T06:28:09.7491887Z</a></li>\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/7244255862/job/19732299740#step:9:2165\">2023-12-18T06:27:21.4417513Z</a></li>\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/7236708045/job/19715534805#step:9:2229\">2023-12-17T06:27:12.5417636Z</a></li>\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/7230194114/job/19701980223#step:9:2165\">2023-12-16T06:27:12.6309426Z</a></li>\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/7218583714/job/19668197509#step:9:2165\">2023-12-15T06:27:56.4802059Z</a></li>\n</ul>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.lang.AssertionError: expected [-1] but found [10]\n\tat org.testng.Assert.fail(Assert.java:110)\n\tat org.testng.Assert.failNotEquals(Assert.java:1577)\n\tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n\tat org.testng.Assert.assertEquals(Assert.java:131)\n\tat org.testng.Assert.assertEquals(Assert.java:979)\n\tat org.testng.Assert.assertEquals(Assert.java:955)\n\tat org.testng.Assert.assertEquals(Assert.java:989)\n\tat org.apache.pulsar.client.api.SubscriptionMessageDispatchThrottlingTest.testClosingRateLimiter(SubscriptionMessageDispatchThrottlingTest.java:915)\n\tat java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:580)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\"><pre class=\"notranslate\"><code class=\"notranslate\">java.lang.AssertionError: expected [-1] but found [10]\n\tat org.testng.Assert.fail(Assert.java:110)\n\tat org.testng.Assert.failNotEquals(Assert.java:1577)\n\tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n\tat org.testng.Assert.assertEquals(Assert.java:131)\n\tat org.testng.Assert.assertEquals(Assert.java:979)\n\tat org.testng.Assert.assertEquals(Assert.java:955)\n\tat org.testng.Assert.assertEquals(Assert.java:989)\n\tat org.apache.pulsar.client.api.SubscriptionMessageDispatchThrottlingTest.testClosingRateLimiter(SubscriptionMessageDispatchThrottlingTest.java:915)\n\tat java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:580)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:317)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1144)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:642)\n\tat java.base/java.lang.Thread.run(Thread.java:1583)\n\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21756",
                "createdAt": "2023-12-19T09:45:33Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Fix tenant's `allowedClusters` is not updated when removing cluster",
        "url": "https://github.com/apache/pulsar/pull/21740",
        "resourcePath": "/apache/pulsar/pull/21740",
        "createdAt": "2023-12-17T11:56:26Z",
        "number": 21740,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": []
        },
        "commits": {
          "edges": []
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21546,
                "url": "https://github.com/apache/pulsar/issues/21546",
                "title": "[Bug] tenant's allowedClusters is not updated when removing a cluster from /clusters admin API",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">3.1.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Create two clusters, and create one tenant with both clusters allowed. Remove one cluster and see that the old one is still displayed in the tenant's allowed cluster.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Once cluster (the one that hasn't been deleted).</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Both clusters.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21546",
                "createdAt": "2023-11-08T13:49:50Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][pip] PIP-327: Support force topic loading for unrecoverable errors",
        "url": "https://github.com/apache/pulsar/pull/21752",
        "resourcePath": "/apache/pulsar/pull/21752",
        "createdAt": "2023-12-19T06:42:05Z",
        "number": 21752,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": "pip/pip-327.md"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5iVf-A2gAoZWRlMDliZTIwODRiODNjNWQxNjU1ZGU4NTE3ZWM1NTJjMTdkYmZmNg",
                "url": "https://github.com/apache/pulsar/pull/21752/commits/ede09be2084b83c5d1655de8517ec552c17dbff6"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21751,
                "url": "https://github.com/apache/pulsar/issues/21751",
                "title": "Brokers are not able to load topics in non-recoverable situation",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">We have introduced a configuration called \u201cautoSkipNonRecoverableData\u201d before open-sourcing Pulsar as we have come across with various situations when it was not possible to recover ledgers belonging to managed-ledger or managed-cursors and the broker was not able to load the topics. In such situations,\u201dautoSkipNonRecoverableData\u201d flag helps to skip non-recoverable leger-recovery errors such as ledger_not_found and allows the broker to load topics by skipping such ledgers in disaster recovery.<br>\nBrokers can recognize such non-recoverable errors using bookkeeper error codes but in some cases, it\u2019s very tricky and not possible to conclude non-recoverable errors. For example, the broker can not differentiate between all the ensemble bookies of the ledgers that are temporarily unavailable or are permanently removed from the cluster without graceful recovery, and because of that broker doesn\u2019t consider all the bookies deleted as a non-recoverable error though we can not recover ledgers in such situations where all the bookies are removed due to various reasons such as Dev cluster clean up or system faced data disaster with multiple bookie loss. In such situations, the system admin has to manually identify such non-recoverable topics and update those topics\u2019 managed-ledger and managed-cursor\u2019s metadata and reload topics again which requires a lot of manual effort and sometimes it might not be feasible to handle such situations with a large number of topics that require this manual procedure to fix those topics.<br>\n<strong>Error:</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Opened ledger 94267 for consumer pulsar.repl.dev-eastb. rc=0\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.DefaultBookieAddressResolver - Cannot resolve euw1bk--prod-booki\ne-0.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie is unknown org.apache.bookkeeper.client.BKException$BKBookieHandleNotAvailableException: Bookie handle i\ns not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] ERROR org.apache.bookkeeper.proto.PerChannelBookieClient - Cannot connect to euw1bk--prod-bookie-0.\neuw1bk--prod-bookie.bk-.svc.cluster.local:3181 as endpoint resolution failed (probably bookie is down) err org.apache.bookkeeper.proto.BookieAddressResolver$Bookie\nIdNotResolvedException: Cannot resolve bookieId euw1bk--prod-bookie-0.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie does not exist or it is not \nrunning\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.PendingReadOp - Error: Bookie handle is not available while reading L94267\n E46 from bookie: euw1bk--prod-bookie-0.euw1bk--prod-bookie.bk-.svc.cluster.local:3181\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.DefaultBookieAddressResolver - Cannot resolve euw1bk--prod-booki\ne-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie is unknown org.apache.bookkeeper.client.BKException$BKBookieHandleNotAvailableException: Bookie handle i\ns not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] ERROR org.apache.bookkeeper.proto.PerChannelBookieClient - Cannot connect to euw1bk--prod-bookie-2.\neuw1bk--prod-bookie.bk-.svc.cluster.local:3181 as endpoint resolution failed (probably bookie is down) err org.apache.bookkeeper.proto.BookieAddressResolver$Bookie\nIdNotResolvedException: Cannot resolve bookieId euw1bk--prod-bookie-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie does not exist or it is not \nrunning\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.PendingReadOp - Error: Bookie handle is not available while reading L94267\n E46 from bookie: euw1bk--prod-bookie-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] ERROR org.apache.bookkeeper.client.PendingReadOp - Read of ledger entry failed: L94267 E46-E46, Sent to [euw1\nbk--prod-bookie-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, euw1bk--prod-bookie-0.euw1bk--prod-bookie.bk-.svc.cluster\n.local:3181], Heard from [] : bitset = {}, Error = 'Bookie handle is not available'. First unread entry is (-1, rc = null)\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Error reading from metadata ledger 94267 for consumer pulsar.repl.dev-eastb: Bookie handle is not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Recovery for cursor pulsar.repl.dev-eastb failed\norg.apache.bookkeeper.mledger.ManagedLedgerException: Bookie handle is not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Closing managed ledger\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.pulsar.broker.service.BrokerService - Failed to create topic persistent://prop/us-west2/ns1/per\nsistent/t1-partition-220\norg.apache.bookkeeper.mledger.ManagedLedgerException: Bookie handle is not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:59962][persistent://prop/us-west2/ns1/t1-partition-220][my-local] Failed to create consumer: consumerId=5369828, org.apache.bookkeeper.mledger.ManagedLedgerException: Bookie handle is not available\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Opened ledger 94267 for consumer pulsar.repl.dev-eastb. rc=0\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.DefaultBookieAddressResolver - Cannot resolve euw1bk--prod-booki\ne-0.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie is unknown org.apache.bookkeeper.client.BKException$BKBookieHandleNotAvailableException: Bookie handle i\ns not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] ERROR org.apache.bookkeeper.proto.PerChannelBookieClient - Cannot connect to euw1bk--prod-bookie-0.\neuw1bk--prod-bookie.bk-.svc.cluster.local:3181 as endpoint resolution failed (probably bookie is down) err org.apache.bookkeeper.proto.BookieAddressResolver$Bookie\nIdNotResolvedException: Cannot resolve bookieId euw1bk--prod-bookie-0.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie does not exist or it is not \nrunning\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.PendingReadOp - Error: Bookie handle is not available while reading L94267\n E46 from bookie: euw1bk--prod-bookie-0.euw1bk--prod-bookie.bk-.svc.cluster.local:3181\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.DefaultBookieAddressResolver - Cannot resolve euw1bk--prod-booki\ne-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie is unknown org.apache.bookkeeper.client.BKException$BKBookieHandleNotAvailableException: Bookie handle i\ns not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] ERROR org.apache.bookkeeper.proto.PerChannelBookieClient - Cannot connect to euw1bk--prod-bookie-2.\neuw1bk--prod-bookie.bk-.svc.cluster.local:3181 as endpoint resolution failed (probably bookie is down) err org.apache.bookkeeper.proto.BookieAddressResolver$Bookie\nIdNotResolvedException: Cannot resolve bookieId euw1bk--prod-bookie-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie does not exist or it is not \nrunning\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.PendingReadOp - Error: Bookie handle is not available while reading L94267\n E46 from bookie: euw1bk--prod-bookie-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] ERROR org.apache.bookkeeper.client.PendingReadOp - Read of ledger entry failed: L94267 E46-E46, Sent to [euw1\nbk--prod-bookie-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, euw1bk--prod-bookie-0.euw1bk--prod-bookie.bk-.svc.cluster\n.local:3181], Heard from [] : bitset = {}, Error = 'Bookie handle is not available'. First unread entry is (-1, rc = null)\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Error reading from metadata ledger 94267 for consumer pulsar.repl.dev-eastb: Bookie handle is not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Recovery for cursor pulsar.repl.dev-eastb failed\norg.apache.bookkeeper.mledger.ManagedLedgerException: Bookie handle is not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Closing managed ledger\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.pulsar.broker.service.BrokerService - Failed to create topic persistent://prop/us-west2/ns1/per\nsistent/t1-partition-220\norg.apache.bookkeeper.mledger.ManagedLedgerException: Bookie handle is not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:59962][persistent://prop/us-west2/ns1/t1-partition-220][my-local] Failed to create consumer: consumerId=5369828, org.apache.bookkeeper.mledger.ManagedLedgerException: Bookie handle is not available\n</code></pre></div>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Therefore, the system admin should have a dynamic configuration called managedLedgerForceRecovery to use in such situations to allow brokers to forcefully load topics by skipping ledger failures to avoid topic unavailability and perform auto repairs of the topics. This will allow the admin to handle disaster recovery situations in a controlled and automated manner and maintain the topic availability by mitigating such failures.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21751",
                "createdAt": "2023-12-19T04:22:55Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky PersistentTopicTest.setup",
        "url": "https://github.com/apache/pulsar/pull/21755",
        "resourcePath": "/apache/pulsar/pull/21755",
        "createdAt": "2023-12-19T09:44:10Z",
        "number": 21755,
        "mergeCommit": {
          "oid": "0ad18670263d1331ffa220f36883db8615abac89",
          "message": "[fix][test] Fix flaky PersistentTopicTest.setup (#21755)",
          "commitUrl": "https://github.com/apache/pulsar/commit/0ad18670263d1331ffa220f36883db8615abac89",
          "parents": {
            "nodes": [
              {
                "oid": "631b13ad23d7e48c6e82d38f97c23d129062cb7c",
                "message": "[improve][client] PIP-313 Support force unsubscribe using consumer api (#21687)\n\nCo-authored-by: Jiwe Guo <technoboy@apache.org>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentDispatcherFailoverConsumerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentTopicTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5iWZIP2gAoMTZiNDFiNGZmZmZjOTgwYTQyMzZlMDFjMDNjM2I0OWU0YWQwMTQ1ZA",
                "url": "https://github.com/apache/pulsar/pull/21755/commits/16b41b4ffffc980a4236e01c03c3b49e4ad0145d"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21754,
                "url": "https://github.com/apache/pulsar/issues/21754",
                "title": "Flaky-test: PersistentTopicTest.setup",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failures</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/7257984423/job/19772827749#step:11:1117\">2023-12-19T06:32:08.7068620Z</a></li>\n</ul>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"org.mockito.exceptions.misusing.WrongTypeOfReturnValue:\n\nNamespaceService cannot be returned by getPulsarResources()\ngetPulsarResources() should return PulsarResources\n***\nIf you're unsure why you're getting above error read on.\nDue to the nature of the syntax above problem might occur because:\n1. This exception *might* occur in wrongly written multi-threaded tests.\n   Please refer to Mockito FAQ on limitations of concurrency testing.\n2. A spy is stubbed using when(spy.foo()).then() syntax. It is safer to stub spies -\n   - with doReturn|Throw() family of methods. More in javadocs for Mockito.spy() method.\n\n\tat org.apache.pulsar.broker.PulsarService.getNamespaceService(PulsarService.java:1350)\n\tat org.apache.pulsar.broker.service.PersistentTopicTest.setup(PersistentTopicTest.java:217)\n\tat java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:580)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n\tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n\tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:590)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n\tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n\tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n\tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n\tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n\tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n\tat org.testng.TestRunner.run(TestRunner.java:602)\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n\tat org.testng.TestNG.runSuites(TestNG.java:1099)\n\tat org.testng.TestNG.run(TestNG.java:1067)\n\tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n\tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n\tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n\tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n\tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n\tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n\"><pre class=\"notranslate\"><code class=\"notranslate\">org.mockito.exceptions.misusing.WrongTypeOfReturnValue:\n\nNamespaceService cannot be returned by getPulsarResources()\ngetPulsarResources() should return PulsarResources\n***\nIf you're unsure why you're getting above error read on.\nDue to the nature of the syntax above problem might occur because:\n1. This exception *might* occur in wrongly written multi-threaded tests.\n   Please refer to Mockito FAQ on limitations of concurrency testing.\n2. A spy is stubbed using when(spy.foo()).then() syntax. It is safer to stub spies -\n   - with doReturn|Throw() family of methods. More in javadocs for Mockito.spy() method.\n\n\tat org.apache.pulsar.broker.PulsarService.getNamespaceService(PulsarService.java:1350)\n\tat org.apache.pulsar.broker.service.PersistentTopicTest.setup(PersistentTopicTest.java:217)\n\tat java.base/jdk.internal.reflect.DirectMethodHandleAccessor.invoke(DirectMethodHandleAccessor.java:103)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:580)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethodConsideringTimeout(MethodInvocationHelper.java:69)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurationMethod(ConfigInvoker.java:361)\n\tat org.testng.internal.invokers.ConfigInvoker.invokeConfigurations(ConfigInvoker.java:296)\n\tat org.testng.internal.invokers.TestInvoker.runConfigMethods(TestInvoker.java:823)\n\tat org.testng.internal.invokers.TestInvoker.invokeMethod(TestInvoker.java:590)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethod(TestInvoker.java:221)\n\tat org.testng.internal.invokers.MethodRunner.runInSequence(MethodRunner.java:50)\n\tat org.testng.internal.invokers.TestInvoker$MethodInvocationAgent.invoke(TestInvoker.java:969)\n\tat org.testng.internal.invokers.TestInvoker.invokeTestMethods(TestInvoker.java:194)\n\tat org.testng.internal.invokers.TestMethodWorker.invokeTestMethods(TestMethodWorker.java:148)\n\tat org.testng.internal.invokers.TestMethodWorker.run(TestMethodWorker.java:128)\n\tat java.base/java.util.ArrayList.forEach(ArrayList.java:1596)\n\tat org.testng.TestRunner.privateRun(TestRunner.java:829)\n\tat org.testng.TestRunner.run(TestRunner.java:602)\n\tat org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n\tat org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n\tat org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n\tat org.testng.SuiteRunner.run(SuiteRunner.java:330)\n\tat org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n\tat org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n\tat org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n\tat org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n\tat org.testng.TestNG.runSuites(TestNG.java:1099)\n\tat org.testng.TestNG.run(TestNG.java:1067)\n\tat org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n\tat org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n\tat org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n\tat org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n\tat org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n\tat org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n\tat org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21754",
                "createdAt": "2023-12-19T09:36:57Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] PIP-327: Support force topic loading for unrecoverable errors",
        "url": "https://github.com/apache/pulsar/pull/21759",
        "resourcePath": "/apache/pulsar/pull/21759",
        "createdAt": "2023-12-19T18:57:16Z",
        "number": 21759,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/ManagedLedgerConfig.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedCursorTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-common/src/main/java/org/apache/pulsar/broker/ServiceConfiguration.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/schema/BookkeeperSchemaStorage.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/schema/BookkeeperSchemaStorageTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5iZwmM2gAoZWM1MmI2ZGE2NmE0MmUzYWRiMWIyOGEwODQ1MzY4ZmM2Mzc0MDZkMA",
                "url": "https://github.com/apache/pulsar/pull/21759/commits/ec52b6da66a42e3adb1b28a0845368fc637406d0"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21751,
                "url": "https://github.com/apache/pulsar/issues/21751",
                "title": "Brokers are not able to load topics in non-recoverable situation",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">We have introduced a configuration called \u201cautoSkipNonRecoverableData\u201d before open-sourcing Pulsar as we have come across with various situations when it was not possible to recover ledgers belonging to managed-ledger or managed-cursors and the broker was not able to load the topics. In such situations,\u201dautoSkipNonRecoverableData\u201d flag helps to skip non-recoverable leger-recovery errors such as ledger_not_found and allows the broker to load topics by skipping such ledgers in disaster recovery.<br>\nBrokers can recognize such non-recoverable errors using bookkeeper error codes but in some cases, it\u2019s very tricky and not possible to conclude non-recoverable errors. For example, the broker can not differentiate between all the ensemble bookies of the ledgers that are temporarily unavailable or are permanently removed from the cluster without graceful recovery, and because of that broker doesn\u2019t consider all the bookies deleted as a non-recoverable error though we can not recover ledgers in such situations where all the bookies are removed due to various reasons such as Dev cluster clean up or system faced data disaster with multiple bookie loss. In such situations, the system admin has to manually identify such non-recoverable topics and update those topics\u2019 managed-ledger and managed-cursor\u2019s metadata and reload topics again which requires a lot of manual effort and sometimes it might not be feasible to handle such situations with a large number of topics that require this manual procedure to fix those topics.<br>\n<strong>Error:</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Opened ledger 94267 for consumer pulsar.repl.dev-eastb. rc=0\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.DefaultBookieAddressResolver - Cannot resolve euw1bk--prod-booki\ne-0.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie is unknown org.apache.bookkeeper.client.BKException$BKBookieHandleNotAvailableException: Bookie handle i\ns not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] ERROR org.apache.bookkeeper.proto.PerChannelBookieClient - Cannot connect to euw1bk--prod-bookie-0.\neuw1bk--prod-bookie.bk-.svc.cluster.local:3181 as endpoint resolution failed (probably bookie is down) err org.apache.bookkeeper.proto.BookieAddressResolver$Bookie\nIdNotResolvedException: Cannot resolve bookieId euw1bk--prod-bookie-0.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie does not exist or it is not \nrunning\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.PendingReadOp - Error: Bookie handle is not available while reading L94267\n E46 from bookie: euw1bk--prod-bookie-0.euw1bk--prod-bookie.bk-.svc.cluster.local:3181\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.DefaultBookieAddressResolver - Cannot resolve euw1bk--prod-booki\ne-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie is unknown org.apache.bookkeeper.client.BKException$BKBookieHandleNotAvailableException: Bookie handle i\ns not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] ERROR org.apache.bookkeeper.proto.PerChannelBookieClient - Cannot connect to euw1bk--prod-bookie-2.\neuw1bk--prod-bookie.bk-.svc.cluster.local:3181 as endpoint resolution failed (probably bookie is down) err org.apache.bookkeeper.proto.BookieAddressResolver$Bookie\nIdNotResolvedException: Cannot resolve bookieId euw1bk--prod-bookie-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie does not exist or it is not \nrunning\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.PendingReadOp - Error: Bookie handle is not available while reading L94267\n E46 from bookie: euw1bk--prod-bookie-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] ERROR org.apache.bookkeeper.client.PendingReadOp - Read of ledger entry failed: L94267 E46-E46, Sent to [euw1\nbk--prod-bookie-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, euw1bk--prod-bookie-0.euw1bk--prod-bookie.bk-.svc.cluster\n.local:3181], Heard from [] : bitset = {}, Error = 'Bookie handle is not available'. First unread entry is (-1, rc = null)\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Error reading from metadata ledger 94267 for consumer pulsar.repl.dev-eastb: Bookie handle is not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Recovery for cursor pulsar.repl.dev-eastb failed\norg.apache.bookkeeper.mledger.ManagedLedgerException: Bookie handle is not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Closing managed ledger\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.pulsar.broker.service.BrokerService - Failed to create topic persistent://prop/us-west2/ns1/per\nsistent/t1-partition-220\norg.apache.bookkeeper.mledger.ManagedLedgerException: Bookie handle is not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:59962][persistent://prop/us-west2/ns1/t1-partition-220][my-local] Failed to create consumer: consumerId=5369828, org.apache.bookkeeper.mledger.ManagedLedgerException: Bookie handle is not available\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Opened ledger 94267 for consumer pulsar.repl.dev-eastb. rc=0\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.DefaultBookieAddressResolver - Cannot resolve euw1bk--prod-booki\ne-0.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie is unknown org.apache.bookkeeper.client.BKException$BKBookieHandleNotAvailableException: Bookie handle i\ns not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] ERROR org.apache.bookkeeper.proto.PerChannelBookieClient - Cannot connect to euw1bk--prod-bookie-0.\neuw1bk--prod-bookie.bk-.svc.cluster.local:3181 as endpoint resolution failed (probably bookie is down) err org.apache.bookkeeper.proto.BookieAddressResolver$Bookie\nIdNotResolvedException: Cannot resolve bookieId euw1bk--prod-bookie-0.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie does not exist or it is not \nrunning\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.PendingReadOp - Error: Bookie handle is not available while reading L94267\n E46 from bookie: euw1bk--prod-bookie-0.euw1bk--prod-bookie.bk-.svc.cluster.local:3181\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.DefaultBookieAddressResolver - Cannot resolve euw1bk--prod-booki\ne-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie is unknown org.apache.bookkeeper.client.BKException$BKBookieHandleNotAvailableException: Bookie handle i\ns not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] ERROR org.apache.bookkeeper.proto.PerChannelBookieClient - Cannot connect to euw1bk--prod-bookie-2.\neuw1bk--prod-bookie.bk-.svc.cluster.local:3181 as endpoint resolution failed (probably bookie is down) err org.apache.bookkeeper.proto.BookieAddressResolver$Bookie\nIdNotResolvedException: Cannot resolve bookieId euw1bk--prod-bookie-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, bookie does not exist or it is not \nrunning\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.client.PendingReadOp - Error: Bookie handle is not available while reading L94267\n E46 from bookie: euw1bk--prod-bookie-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] ERROR org.apache.bookkeeper.client.PendingReadOp - Read of ledger entry failed: L94267 E46-E46, Sent to [euw1\nbk--prod-bookie-2.euw1bk--prod-bookie.bk-.svc.cluster.local:3181, euw1bk--prod-bookie-0.euw1bk--prod-bookie.bk-.svc.cluster\n.local:3181], Heard from [] : bitset = {}, Error = 'Bookie handle is not available'. First unread entry is (-1, rc = null)\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.bookkeeper.mledger.impl.ManagedCursorImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Error reading from metadata ledger 94267 for consumer pulsar.repl.dev-eastb: Bookie handle is not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Recovery for cursor pulsar.repl.dev-eastb failed\norg.apache.bookkeeper.mledger.ManagedLedgerException: Bookie handle is not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] INFO  org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl - [prop/us-west2/ns1/per\nsistent/t1-partition-220] Closing managed ledger\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.pulsar.broker.service.BrokerService - Failed to create topic persistent://prop/us-west2/ns1/per\nsistent/t1-partition-220\norg.apache.bookkeeper.mledger.ManagedLedgerException: Bookie handle is not available\n2023-11-02T00:35:35,582+0000 [BookKeeperClientWorker-OrderedExecutor-5-0] WARN  org.apache.pulsar.broker.service.ServerCnx - [/1.1.1.1:59962][persistent://prop/us-west2/ns1/t1-partition-220][my-local] Failed to create consumer: consumerId=5369828, org.apache.bookkeeper.mledger.ManagedLedgerException: Bookie handle is not available\n</code></pre></div>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Therefore, the system admin should have a dynamic configuration called managedLedgerForceRecovery to use in such situations to allow brokers to forcefully load topics by skipping ledger failures to avoid topic unavailability and perform auto repairs of the topics. This will allow the admin to handle disaster recovery situations in a controlled and automated manner and maintain the topic availability by mitigating such failures.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21751",
                "createdAt": "2023-12-19T04:22:55Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Don't reuse AsyncResponse mocks in PersistentTopicsTest",
        "url": "https://github.com/apache/pulsar/pull/21769",
        "resourcePath": "/apache/pulsar/pull/21769",
        "createdAt": "2023-12-20T15:40:01Z",
        "number": 21769,
        "mergeCommit": {
          "oid": "b944f10d2a9bac2fbe19dc83bf250a276f1ed4d1",
          "message": "[fix][test] Don't reuse AsyncResponse mocks in PersistentTopicsTest (#21769)",
          "commitUrl": "https://github.com/apache/pulsar/commit/b944f10d2a9bac2fbe19dc83bf250a276f1ed4d1",
          "parents": {
            "nodes": [
              {
                "oid": "69a45a11e22c1d963391110fb3488c9b9f98f759",
                "message": "[fix][broker] Fixed the ExtensibleLoadManagerImpl internal system getTopic failure when the leadership changes (#21764)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ifGL32gAoZDc5NDU2YjZhZGJjMjcyNmZiOWIxMTY4NzNiNTc1YWQxNDc2ZDlmMA",
                "url": "https://github.com/apache/pulsar/pull/21769/commits/d79456b6adbc2726fb9b116873b575ad1476d9f0"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21768,
                "url": "https://github.com/apache/pulsar/issues/21768",
                "title": "Flaky-test: PersistentTopicsTest.testTerminate",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/7276618728/job/19827396943?pr=21767#step:11:1556\">https://github.com/apache/pulsar/actions/runs/7276618728/job/19827396943?pr=21767#step:11:1556</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 62, Failures: 1, Errors: 0, Skipped: 29, Time elapsed: 155.549 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.admin.PersistentTopicsTest\n  Error:  org.apache.pulsar.broker.admin.PersistentTopicsTest.testTerminate  Time elapsed: 5.022 s  &lt;&lt;&lt; FAILURE!\n  org.mockito.exceptions.verification.TooManyActualInvocations: \n  \n  asyncResponse.resume(\n      &lt;Capturing argument: Response&gt;\n  );\n  Wanted 1 time:\n  -&gt; at org.apache.pulsar.broker.admin.PersistentTopicsTest.testTerminate(PersistentTopicsTest.java:435)\n  But was 2 times:\n  -&gt; at org.apache.pulsar.broker.admin.v2.PersistentTopics.lambda$createNonPartitionedTopic$6(PersistentTopics.java:336)\n  -&gt; at org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.lambda$internalCreateSubscriptionForNonPartitionedTopic$237(PersistentTopicsBase.java:2385)\n  \n  \n  \tat org.apache.pulsar.broker.admin.PersistentTopicsTest.testTerminate(PersistentTopicsTest.java:435)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:840)\n\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 62, Failures: 1, Errors: 0, Skipped: 29, Time elapsed: 155.549 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.admin.PersistentTopicsTest\n  Error:  org.apache.pulsar.broker.admin.PersistentTopicsTest.testTerminate  Time elapsed: 5.022 s  &lt;&lt;&lt; FAILURE!\n  org.mockito.exceptions.verification.TooManyActualInvocations: \n  \n  asyncResponse.resume(\n      &lt;Capturing argument: Response&gt;\n  );\n  Wanted 1 time:\n  -&gt; at org.apache.pulsar.broker.admin.PersistentTopicsTest.testTerminate(PersistentTopicsTest.java:435)\n  But was 2 times:\n  -&gt; at org.apache.pulsar.broker.admin.v2.PersistentTopics.lambda$createNonPartitionedTopic$6(PersistentTopics.java:336)\n  -&gt; at org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.lambda$internalCreateSubscriptionForNonPartitionedTopic$237(PersistentTopicsBase.java:2385)\n  \n  \n  \tat org.apache.pulsar.broker.admin.PersistentTopicsTest.testTerminate(PersistentTopicsTest.java:435)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:840)\n\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21768",
                "createdAt": "2023-12-20T15:34:20Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][ci] Exclude jose4j to avoid CVE-2023-31582",
        "url": "https://github.com/apache/pulsar/pull/21791",
        "resourcePath": "/apache/pulsar/pull/21791",
        "createdAt": "2023-12-22T07:34:52Z",
        "number": 21791,
        "mergeCommit": {
          "oid": "d9c55b4f5c70fa13185fdf0290d4513b0380f216",
          "message": "[improve][ci] Exclude jose4j to avoid CVE-2023-31582 (#21791)",
          "commitUrl": "https://github.com/apache/pulsar/commit/d9c55b4f5c70fa13185fdf0290d4513b0380f216",
          "parents": {
            "nodes": [
              {
                "oid": "6169e3da9569b6f109546c44a1babf41da6c527e",
                "message": "[fix][sec] Bump org.apache.avro:avro from 1.8.2 to 1.11.3 in /pulsar-io/flume (#21283)\n\nSigned-off-by: dependabot[bot] <support@github.com>\r\nCo-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>\r\nCo-authored-by: Matteo Merli <mmerli@apache.org>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/debezium/core/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/kafka-connect-adaptor/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/kafka/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/solr/pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ioTCK2gAoYzBkYmYzMTY3MDdjNDc5MGRkOWRlNjFjOTQ5M2IxYjUxYTI1ZmFlNg",
                "url": "https://github.com/apache/pulsar/pull/21791/commits/c0dbf316707c4790dd9de61c9493b1b51a25fae6"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21787,
                "url": "https://github.com/apache/pulsar/issues/21787",
                "title": "[Bug] Jose4j version has a vulnerability CVE-2023-31582",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">For pulsar version: <code class=\"notranslate\">3.1.2</code> on branch: <code class=\"notranslate\">branch-3.1</code> facing moderate vulnerability <a href=\"https://github.com/advisories/GHSA-7g24-qg88-p43q\">CVE-2023-31582</a>, related to packages:</p>\n<ul dir=\"auto\">\n<li>org.bitbucket.b_c:jose4j</li>\n</ul>\n<p dir=\"auto\">Maven Dependency</p>\n<ul dir=\"auto\">\n<li>pulsar - org.apache.pulsar 3.1.2</li>\n</ul>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Run Pulsar CI workflow on pulsar branch - <code class=\"notranslate\">branch-3.1</code></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Expected to pass the <code class=\"notranslate\">OWASP dependency check</code> under <code class=\"notranslate\">Pulsar CI</code> workflow.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Vulnerability</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\" Error:  Failed to execute goal org.owasp:dependency-check-maven:8.2.1:aggregate (default) on project pulsar: \n Error:  \n Error:  One or more dependencies were identified with vulnerabilities that have a CVSS score greater than or equal to '7.0': \n Error:  \n Error:  jose4j-0.6.5.jar: CVE-2023-31582(7.5)\n Error:  jose4j-0.7.9.jar: CVE-2023-31582(7.5)\"><pre class=\"notranslate\"><code class=\"notranslate\"> Error:  Failed to execute goal org.owasp:dependency-check-maven:8.2.1:aggregate (default) on project pulsar: \n Error:  \n Error:  One or more dependencies were identified with vulnerabilities that have a CVSS score greater than or equal to '7.0': \n Error:  \n Error:  jose4j-0.6.5.jar: CVE-2023-31582(7.5)\n Error:  jose4j-0.7.9.jar: CVE-2023-31582(7.5)\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21787",
                "createdAt": "2023-12-21T14:04:28Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][ci] Upgrade Aerospike java client to 4.5.0 to avoid CVE-2023-36480",
        "url": "https://github.com/apache/pulsar/pull/21792",
        "resourcePath": "/apache/pulsar/pull/21792",
        "createdAt": "2023-12-22T07:40:18Z",
        "number": 21792,
        "mergeCommit": {
          "oid": "9a5c2f229e11ea1dd59737afc8b2308fac78f16d",
          "message": "[improve][ci] Upgrade Aerospike java client to 4.5.0 to avoid CVE-2023-36480 (#21792)",
          "commitUrl": "https://github.com/apache/pulsar/commit/9a5c2f229e11ea1dd59737afc8b2308fac78f16d",
          "parents": {
            "nodes": [
              {
                "oid": "8beac8b12ef7c0ef54529fbb7e4e76c54dea6283",
                "message": "[improve][broker] Avoid record inactiveproducers when deduplication is disable. (#21193)\n\nCo-authored-by: Jiwe Guo <technoboy@apache.org>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ioUJS2gAoMjg1MWVhYmU2OTg4ZTI1MTM5NjYxZmE1YzJjMDRlYjNlYTRjZWI2Yg",
                "url": "https://github.com/apache/pulsar/pull/21792/commits/2851eabe6988e25139661fa5c2c04eb3ea4ceb6b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21779,
                "url": "https://github.com/apache/pulsar/issues/21779",
                "title": "[Bug] Aerospike Java Client version has a vulnerability  CVE-2023-36480",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">For pulsar version: <code class=\"notranslate\">3.1.2</code> on branch: <code class=\"notranslate\">branch-3.1</code> facing critical vulnerability <a href=\"https://github.com/advisories/GHSA-jj95-55cr-9597\">CVE-2023-36480</a> related to packages:</p>\n<ul dir=\"auto\">\n<li>com.aerospike:aerospike-client-bc</li>\n<li>com.aerospike:aerospike-client</li>\n</ul>\n<p dir=\"auto\">Below is the versions available in pulsar -</p>\n<ul dir=\"auto\">\n<li>&lt;aerospike-client.version&gt;4.4.20&lt;/aerospike-client.version&gt;</li>\n</ul>\n<p dir=\"auto\">Maven Dependency</p>\n<ul dir=\"auto\">\n<li>pulsar - org.apache.pulsar 3.1.2</li>\n</ul>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Run Pulsar CI workflow on pulsar branch - <code class=\"notranslate\">branch-3.1</code></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Expected to pass the <code class=\"notranslate\">OWASP dependency check</code> under <code class=\"notranslate\">Pulsar CI</code> workflow.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Vulnerability</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\" Error:  Failed to execute goal org.owasp:dependency-check-maven:8.2.1:aggregate (default) on project pulsar: \n Error:  \n Error:  One or more dependencies were identified with vulnerabilities that have a CVSS score greater than or equal to '7.0': \n Error:  \n Error:  aerospike-client-bc-4.4.20.jar: CVE-2023-36480(9.8)\"><pre class=\"notranslate\"><code class=\"notranslate\"> Error:  Failed to execute goal org.owasp:dependency-check-maven:8.2.1:aggregate (default) on project pulsar: \n Error:  \n Error:  One or more dependencies were identified with vulnerabilities that have a CVSS score greater than or equal to '7.0': \n Error:  \n Error:  aerospike-client-bc-4.4.20.jar: CVE-2023-36480(9.8)\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21779",
                "createdAt": "2023-12-21T12:06:26Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][build] Upgrade mysql connector version from 8.0.30 to 8.1.0 to avoid CVE-202\u2026",
        "url": "https://github.com/apache/pulsar/pull/21807",
        "resourcePath": "/apache/pulsar/pull/21807",
        "createdAt": "2023-12-27T02:35:56Z",
        "number": 21807,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5izTQA2gAoZWViOTcxMDNkMzc3MTE2MDEyYTJjMzA0NDQ3NWEyZWNlNmQ3ZTViMg",
                "url": "https://github.com/apache/pulsar/pull/21807/commits/eeb97103d377116012a2c3044475a2ece6d7e5b2"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21784,
                "url": "https://github.com/apache/pulsar/issues/21784",
                "title": "[Bug] MySQL Connectors has a vulnerability CVE-2023-22102",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">For pulsar version: <code class=\"notranslate\">3.1.2</code> on branch: <code class=\"notranslate\">branch-3.1</code> facing high vulnerability <a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-22102#range-9716778\" rel=\"nofollow\">CVE-2023-22102</a>, related to packages:</p>\n<ul dir=\"auto\">\n<li>mysql:mysql-connector-java</li>\n</ul>\n<p dir=\"auto\">Below is the versions available in pulsar -</p>\n<ul dir=\"auto\">\n<li>&lt;mysql-jdbc.version&gt;8.0.11&lt;/mysql-jdbc.version&gt;</li>\n<li>&lt;debezium.mysql.version&gt;8.0.30&lt;/debezium.mysql.version&gt;</li>\n</ul>\n<p dir=\"auto\">Maven Dependency</p>\n<ul dir=\"auto\">\n<li>pulsar - org.apache.pulsar 3.1.2</li>\n</ul>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Run Pulsar CI workflow on pulsar branch - <code class=\"notranslate\">branch-3.1</code></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Expected to pass the <code class=\"notranslate\">OWASP dependency check</code> under <code class=\"notranslate\">Pulsar CI</code> workflow.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Vulnerability</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\" Error:  Failed to execute goal org.owasp:dependency-check-maven:8.2.1:aggregate (default) on project pulsar: \n Error:  \n Error:  One or more dependencies were identified with vulnerabilities that have a CVSS score greater than or equal to '7.0': \n Error:  \n Error:  mysql-connector-java-8.0.30.jar: CVE-2023-22102(8.3)\"><pre class=\"notranslate\"><code class=\"notranslate\"> Error:  Failed to execute goal org.owasp:dependency-check-maven:8.2.1:aggregate (default) on project pulsar: \n Error:  \n Error:  One or more dependencies were identified with vulnerabilities that have a CVSS score greater than or equal to '7.0': \n Error:  \n Error:  mysql-connector-java-8.0.30.jar: CVE-2023-22102(8.3)\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21784",
                "createdAt": "2023-12-21T13:43:18Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][functions] EFFECTIVELY_ONCE mode support input topic batching",
        "url": "https://github.com/apache/pulsar/pull/21812",
        "resourcePath": "/apache/pulsar/pull/21812",
        "createdAt": "2023-12-28T03:50:40Z",
        "number": 21812,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/source/PulsarRecord.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/FunctionCommon.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5i3Bih2gAoOTY5YmI2NWZhNjY0Y2NjZDUyZjRhY2FiZmUwMGMwNjdmNTE5NzJkNA",
                "url": "https://github.com/apache/pulsar/pull/21812/commits/969bb65fa664cccd52f4acabfe00c067f51972d4"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 17061,
                "url": "https://github.com/apache/pulsar/issues/17061",
                "title": "function EFFECTIVELY_ONCE cannot support input topic batching",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">In pulsar function EFFECTIVELY_ONCE semantic, producer attach a sequenceId to output topic for deduplication, the sequenceId consists of ledgerId and entryId. But for batched messages, the share the same entryId so they have same sequenceId, others will become duplicated and dropped, this may cause data loss.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">maybe put batchIndex in sequenceId</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/17061",
                "createdAt": "2022-08-11T06:21:33Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix messages could not expire due to incorrect client clock",
        "url": "https://github.com/apache/pulsar/pull/21835",
        "resourcePath": "/apache/pulsar/pull/21835",
        "createdAt": "2024-01-02T12:27:37Z",
        "number": 21835,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/protocol/Commands.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/test/java/org/apache/pulsar/common/protocol/CommandUtilsTests.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5jDJHr2gAoNTIzYWM3Njc5Y2I0ZTMxZDljOWUyMmY2ZWRmODNlM2I4NTNiNTVjNw",
                "url": "https://github.com/apache/pulsar/pull/21835/commits/523ac7679cb4e31d9c9e22f6edf83e3b853b55c7"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21347,
                "url": "https://github.com/apache/pulsar/issues/21347",
                "title": "[DISK Dos Attack Warning] should not use message publish time in checkMessageExpiry and AppendBrokerTimesampMetadataInterceptor should be config to brokerEntryMetadataInterceptors",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">all pulsar version</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">1\u3001brokerEntryMetadataInterceptors config not contain AppendBrokerTimesampMetadataInterceptor<br>\n2\u3001create a topic and set retention and ttl to 5 min<br>\n3\u3001pulsar client server change system time to some years later<br>\n4\u3001publish message and start a pulsar consumer<br>\n5\u3001stop  pulsar consumer and continue publish message<br>\n6\u3001message can not expire when ledger close and time reach</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">NA</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">PersistentMessageExpiryMonitor<br>\nexpireMessages(int messageTTLInSeconds)  --&gt;call Commands/MessageImpl.getEntryTimestamp(entry.getDataBuffer());</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"// get broker timestamp first if BrokerEntryMetadata is enabled with AppendBrokerTimestampMetadataInterceptor\nBrokerEntryMetadata brokerEntryMetadata =Commands.parseBrokerEntryMetadataIfExist(headersAndPayloadWithBrokerEntryMetadata);\nif (brokerEntryMetadata != null &amp;&amp; brokerEntryMetadata.hasBrokerTimestamp()) {\n    return brokerEntryMetadata.getBrokerTimestamp();\n }\n// otherwise get the publish_time\nreturn Commands.parseMessageMetadata(headersAndPayloadWithBrokerEntryMetadata).getPublishTime();\"><pre class=\"notranslate\"><code class=\"notranslate\">// get broker timestamp first if BrokerEntryMetadata is enabled with AppendBrokerTimestampMetadataInterceptor\nBrokerEntryMetadata brokerEntryMetadata =Commands.parseBrokerEntryMetadataIfExist(headersAndPayloadWithBrokerEntryMetadata);\nif (brokerEntryMetadata != null &amp;&amp; brokerEntryMetadata.hasBrokerTimestamp()) {\n    return brokerEntryMetadata.getBrokerTimestamp();\n }\n// otherwise get the publish_time\nreturn Commands.parseMessageMetadata(headersAndPayloadWithBrokerEntryMetadata).getPublishTime();\n</code></pre></div>\n<p dir=\"auto\">when brokerEntryMetadata.hasBrokerTimestamp() == false , pulsar server will use mesage publishTime<br>\nthis will introduce vulnerability attack , server can not trust any client message data</p>\n<p dir=\"auto\">Suggestions\uff1a<br>\nadd AppendBrokerTimesampMetadataInterceptor to brokerEntryMetadataInterceptors</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">Others:<br>\nin transaction scenario , even when we config brokerEntryMetadataInterceptors=org.apache.pulsar.common.intercept.AppendIndexMetadataInterceptor, we can not get offset , i am not sure if brokerEntryMetadataInterceptors works in transaction produce</p>\n<p dir=\"auto\">if brokerEntryMetadataInterceptors not work<br>\nmaybe we need verify client publish time when server receive mesage .</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21347",
                "createdAt": "2023-10-12T03:28:18Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][doc] Improve doc for `maxTotalReceiverQueueSizeAcrossPartitions` and `receiverQueueSize` of ConsumerBuilder",
        "url": "https://github.com/apache/pulsar/pull/21841",
        "resourcePath": "/apache/pulsar/pull/21841",
        "createdAt": "2024-01-03T09:28:19Z",
        "number": 21841,
        "mergeCommit": {
          "oid": "6560a213123e9f4ab058ab8b865291f22fa4c43c",
          "message": "[improve][doc] Improve doc for `maxTotalReceiverQueueSizeAcrossPartitions` and `receiverQueueSize` of ConsumerBuilder (#21841)\n\nFixes #21838 \r\n\r\n### Motivation\r\n\r\nFrom the implementation, the maximum number of messages actually cached by multi-topics consumer is approximately receiverQueueSize+maxTotalReceiverQueueSizeAcrossPartitions.This seems to go against the case described in the documentation.\r\n\r\nPlease see more details in https://github.com/apache/pulsar/issues/21838\r\n\r\n### Modifications\r\n\r\n- Improve the doc to clarify the correct behavior of `maxTotalReceiverQueueSizeAcrossPartitions`",
          "commitUrl": "https://github.com/apache/pulsar/commit/6560a213123e9f4ab058ab8b865291f22fa4c43c",
          "parents": {
            "nodes": [
              {
                "oid": "042e7691b6ef7b7e826b3ec27740fb1f96fbc0b0",
                "message": "[fix] [client] Messages lost due to TopicListWatcher reconnect (#21853)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/ConsumerBuilder.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5jHWWX2gAoYjZlNGJhNTkwZDM1NTUzMGQyNGYyZjFjYzk0Mjc4YjhlZTY1NGU3OQ",
                "url": "https://github.com/apache/pulsar/pull/21841/commits/b6e4ba590d355530d24f2f1cc94278b8ee654e79"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21838,
                "url": "https://github.com/apache/pulsar/issues/21838",
                "title": "[Bug] maxTotalReceiverQueueSizeAcrossPartitions doesn't actually limit the receiver queue size for MultiTopicConsumer",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\"><a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/apache/pulsar/commit/b944f10d2a9bac2fbe19dc83bf250a276f1ed4d1/hovercard\" href=\"https://github.com/apache/pulsar/commit/b944f10d2a9bac2fbe19dc83bf250a276f1ed4d1\"><tt>b944f10</tt></a></p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Here is the reproduction code:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"PulsarAdmin admin = buildAdminClient();\n        String topic = &quot;test&quot;;\n        admin.topics().createPartitionedTopic(topic, 1);\n\n        Consumer&lt;byte[]&gt; consumer = pulsarClient.newConsumer()\n                .topic(topic)\n                .subscriptionName(&quot;sub&quot;)\n                .subscriptionType(SubscriptionType.Shared)\n                .subscriptionInitialPosition(SubscriptionInitialPosition.Earliest)\n                .maxTotalReceiverQueueSizeAcrossPartitions(10)\n                .receiverQueueSize(10)\n                .consumerName(&quot;A&quot;)\n                .subscribe();\n\n        Producer&lt;byte[]&gt; producer = pulsarClient.newProducer()\n                .topic(topic)\n                .enableBatching(false)\n                .create();\n\n        for (int i = 0; i &lt; 20; i++) {\n            producer.send((&quot;test&quot; + i).getBytes());\n        }\n\n        Message&lt;byte[]&gt; msg = consumer.receive(100, TimeUnit.MILLISECONDS);\n        log.info(&quot;Received message: {}&quot;, msg.getMessageId());\n\n        Thread.sleep(1000);\n\n        Consumer&lt;byte[]&gt; consumer2 = pulsarClient.newConsumer()\n                .topic(topic)\n                .subscriptionName(&quot;sub&quot;)\n                .subscriptionType(SubscriptionType.Shared)\n                .subscriptionInitialPosition(SubscriptionInitialPosition.Earliest)\n                .maxTotalReceiverQueueSizeAcrossPartitions(10)\n                .receiverQueueSize(10)\n                .consumerName(&quot;B&quot;)\n                .subscribe();\n\n        msg = consumer2.receive(1000, TimeUnit.MILLISECONDS);\n        Assert.assertNotNull(msg);\n        log.info(&quot;Received message: {}&quot;, msg.getMessageId());\"><pre class=\"notranslate\"><span class=\"pl-smi\">PulsarAdmin</span> <span class=\"pl-s1\">admin</span> = <span class=\"pl-en\">buildAdminClient</span>();\n        <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">topic</span> = <span class=\"pl-s\">\"test\"</span>;\n        <span class=\"pl-s1\">admin</span>.<span class=\"pl-en\">topics</span>().<span class=\"pl-en\">createPartitionedTopic</span>(<span class=\"pl-s1\">topic</span>, <span class=\"pl-c1\">1</span>);\n\n        <span class=\"pl-smi\">Consumer</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">consumer</span> = <span class=\"pl-s1\">pulsarClient</span>.<span class=\"pl-en\">newConsumer</span>()\n                .<span class=\"pl-en\">topic</span>(<span class=\"pl-s1\">topic</span>)\n                .<span class=\"pl-en\">subscriptionName</span>(<span class=\"pl-s\">\"sub\"</span>)\n                .<span class=\"pl-en\">subscriptionType</span>(<span class=\"pl-smi\">SubscriptionType</span>.<span class=\"pl-s1\">Shared</span>)\n                .<span class=\"pl-en\">subscriptionInitialPosition</span>(<span class=\"pl-smi\">SubscriptionInitialPosition</span>.<span class=\"pl-s1\">Earliest</span>)\n                .<span class=\"pl-en\">maxTotalReceiverQueueSizeAcrossPartitions</span>(<span class=\"pl-c1\">10</span>)\n                .<span class=\"pl-en\">receiverQueueSize</span>(<span class=\"pl-c1\">10</span>)\n                .<span class=\"pl-en\">consumerName</span>(<span class=\"pl-s\">\"A\"</span>)\n                .<span class=\"pl-en\">subscribe</span>();\n\n        <span class=\"pl-smi\">Producer</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">producer</span> = <span class=\"pl-s1\">pulsarClient</span>.<span class=\"pl-en\">newProducer</span>()\n                .<span class=\"pl-en\">topic</span>(<span class=\"pl-s1\">topic</span>)\n                .<span class=\"pl-en\">enableBatching</span>(<span class=\"pl-c1\">false</span>)\n                .<span class=\"pl-en\">create</span>();\n\n        <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">int</span> <span class=\"pl-s1\">i</span> = <span class=\"pl-c1\">0</span>; <span class=\"pl-s1\">i</span> &lt; <span class=\"pl-c1\">20</span>; <span class=\"pl-s1\">i</span>++) {\n            <span class=\"pl-s1\">producer</span>.<span class=\"pl-en\">send</span>((<span class=\"pl-s\">\"test\"</span> + <span class=\"pl-s1\">i</span>).<span class=\"pl-en\">getBytes</span>());\n        }\n\n        <span class=\"pl-smi\">Message</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">msg</span> = <span class=\"pl-s1\">consumer</span>.<span class=\"pl-en\">receive</span>(<span class=\"pl-c1\">100</span>, <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">MILLISECONDS</span>);\n        <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"Received message: {}\"</span>, <span class=\"pl-s1\">msg</span>.<span class=\"pl-en\">getMessageId</span>());\n\n        <span class=\"pl-smi\">Thread</span>.<span class=\"pl-en\">sleep</span>(<span class=\"pl-c1\">1000</span>);\n\n        <span class=\"pl-smi\">Consumer</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">consumer2</span> = <span class=\"pl-s1\">pulsarClient</span>.<span class=\"pl-en\">newConsumer</span>()\n                .<span class=\"pl-en\">topic</span>(<span class=\"pl-s1\">topic</span>)\n                .<span class=\"pl-en\">subscriptionName</span>(<span class=\"pl-s\">\"sub\"</span>)\n                .<span class=\"pl-en\">subscriptionType</span>(<span class=\"pl-smi\">SubscriptionType</span>.<span class=\"pl-s1\">Shared</span>)\n                .<span class=\"pl-en\">subscriptionInitialPosition</span>(<span class=\"pl-smi\">SubscriptionInitialPosition</span>.<span class=\"pl-s1\">Earliest</span>)\n                .<span class=\"pl-en\">maxTotalReceiverQueueSizeAcrossPartitions</span>(<span class=\"pl-c1\">10</span>)\n                .<span class=\"pl-en\">receiverQueueSize</span>(<span class=\"pl-c1\">10</span>)\n                .<span class=\"pl-en\">consumerName</span>(<span class=\"pl-s\">\"B\"</span>)\n                .<span class=\"pl-en\">subscribe</span>();\n\n        <span class=\"pl-s1\">msg</span> = <span class=\"pl-s1\">consumer2</span>.<span class=\"pl-en\">receive</span>(<span class=\"pl-c1\">1000</span>, <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">MILLISECONDS</span>);\n        <span class=\"pl-smi\">Assert</span>.<span class=\"pl-en\">assertNotNull</span>(<span class=\"pl-s1\">msg</span>);\n        <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"Received message: {}\"</span>, <span class=\"pl-s1\">msg</span>.<span class=\"pl-en\">getMessageId</span>());</pre></div>\n<p dir=\"auto\">Here is the patch for the reproduction:<br>\n<a href=\"https://github.com/apache/pulsar/files/13815572/Test_for_maxTotalReceiverQueueSizeAcrossPartitions.patch\">Test_for_maxTotalReceiverQueueSizeAcrossPartitions.patch</a></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">According to the documentation for the  <code class=\"notranslate\">maxTotalReceiverQueueSizeAcrossPartitions</code>:</p>\n<blockquote>\n<p dir=\"auto\">The purpose of this setting is to have an upper-limit on the number<br>\nof messages that a consumer can be pushed at once from a broker, across all<br>\nthe partitions.</p>\n</blockquote>\n<p dir=\"auto\">From my understandings, <code class=\"notranslate\">maxTotalReceiverQueueSizeAcrossPartitions</code> should be able to control the max number of all cached messages in the consumer. Therefore, looking at the above code, the consumer A should only be able to cache a maximum of 10 messages. The consumer B should be able to receive a new message.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">But consumer A has actually cached all 20 messages in the receiver queue(receiverQueueSize+maxTotalReceiverQueueSizeAcrossPartitions). Consumer B can't receive the messages. So the above test would fail.</p>\n<p dir=\"auto\">From the log we can see that consumer A caches all 20 messages(You need to apply the above patch to see the log):</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2024-01-03T11:30:52,032 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 0\n2024-01-03T11:30:52,032 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 1\n2024-01-03T11:30:52,032 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 2\n2024-01-03T11:30:52,033 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 3\n2024-01-03T11:30:52,045 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 4\n2024-01-03T11:30:52,045 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 5\n2024-01-03T11:30:52,045 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 6\n2024-01-03T11:30:52,045 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 7\n2024-01-03T11:30:52,045 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 8\n2024-01-03T11:30:52,045 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 9\n2024-01-03T11:30:52,047 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 10\n2024-01-03T11:30:52,047 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 11\n2024-01-03T11:30:52,058 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 12\n2024-01-03T11:30:52,059 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 13\n2024-01-03T11:30:52,059 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 14\n2024-01-03T11:30:52,059 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 15\n2024-01-03T11:30:52,059 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 16\n2024-01-03T11:30:52,059 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 17\n2024-01-03T11:30:52,061 - INFO  - [main:ConsumeBaseExceptionTest@165] - Received message: 5:0:0\n2024-01-03T11:30:52,071 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 18\n2024-01-03T11:30:52,071 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 19\"><pre class=\"notranslate\"><code class=\"notranslate\">2024-01-03T11:30:52,032 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 0\n2024-01-03T11:30:52,032 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 1\n2024-01-03T11:30:52,032 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 2\n2024-01-03T11:30:52,033 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 3\n2024-01-03T11:30:52,045 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 4\n2024-01-03T11:30:52,045 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 5\n2024-01-03T11:30:52,045 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 6\n2024-01-03T11:30:52,045 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 7\n2024-01-03T11:30:52,045 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 8\n2024-01-03T11:30:52,045 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 9\n2024-01-03T11:30:52,047 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 10\n2024-01-03T11:30:52,047 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 11\n2024-01-03T11:30:52,058 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 12\n2024-01-03T11:30:52,059 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 13\n2024-01-03T11:30:52,059 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 14\n2024-01-03T11:30:52,059 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 15\n2024-01-03T11:30:52,059 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 16\n2024-01-03T11:30:52,059 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 17\n2024-01-03T11:30:52,061 - INFO  - [main:ConsumeBaseExceptionTest@165] - Received message: 5:0:0\n2024-01-03T11:30:52,071 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 18\n2024-01-03T11:30:52,071 - INFO  - [pulsar-client-io-35-5:ConsumerImpl@1283] - [A][sub] Received message from server: 19\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">From the implementation, the maximum number of messages actually cached by multi-topics consumer is approximately receiverQueueSize+maxTotalReceiverQueueSizeAcrossPartitions.This seems to go against the case described in the documentation.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21838",
                "createdAt": "2024-01-03T03:56:12Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker]Fix NonPersistentDispatcherMultipleConsumers ArrayIndexOutOfBoundsException",
        "url": "https://github.com/apache/pulsar/pull/21856",
        "resourcePath": "/apache/pulsar/pull/21856",
        "createdAt": "2024-01-05T01:36:32Z",
        "number": 21856,
        "mergeCommit": {
          "oid": "cea5c931b43cbc5181aaa79dfee09d53cc1389d1",
          "message": "[fix][broker]Fix NonPersistentDispatcherMultipleConsumers ArrayIndexOutOfBoundsException (#21856)",
          "commitUrl": "https://github.com/apache/pulsar/commit/cea5c931b43cbc5181aaa79dfee09d53cc1389d1",
          "parents": {
            "nodes": [
              {
                "oid": "a75dc54e9f3baccdbbcd5e6a9e089b920eb26751",
                "message": "[improve][pip] PIP-326: Create a BOM to ease dependency management (#21747)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentDispatcherMultipleConsumers.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5jReqi2gAoZjMzYWI4Yzg1NWFkY2NhYTNhOGIzNGU3NmNjMTk4YWVmZjIwNjY0OA",
                "url": "https://github.com/apache/pulsar/pull/21856/commits/f33ab8c855adccaa3a8b34e76cc198aeff206648"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20924,
                "url": "https://github.com/apache/pulsar/issues/20924",
                "title": "[Bug] when the broker processes non-persistent Consumers in a multi-threaded \uff0cGot exception: ArrayIndexOutOfBoundsException",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">3.0.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\"><code class=\"notranslate\">2023-07-28T09:13:34,703+0800 [pulsar-io-12-13] WARN  org.apache.pulsar.broker.service.ServerCnx - [/10.65.17.39:65308] Got exception java.lang.ArrayIndexOutOfBoundsException: Index 2 out of bounds for length 2 at java.base/java.util.concurrent.CopyOnWriteArrayList.elementAt(CopyOnWriteArrayList.java:385) at java.base/java.util.concurrent.CopyOnWriteArrayList.get(CopyOnWriteArrayList.java:398) at org.apache.pulsar.broker.service.AbstractDispatcherMultipleConsumers.getNextConsumerFromSameOrLowerLevel(AbstractDispatcherMultipleConsumers.java:192) at org.apache.pulsar.broker.service.AbstractDispatcherMultipleConsumers.getNextConsumer(AbstractDispatcherMultipleConsumers.java:137) at org.apache.pulsar.broker.service.nonpersistent.NonPersistentDispatcherMultipleConsumers.sendMessages(NonPersistentDispatcherMultipleConsumers.java:188) at org.apache.pulsar.broker.service.nonpersistent.NonPersistentTopic.lambda$publishMessage$2(NonPersistentTopic.java:202) at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap$Section.forEach(ConcurrentOpenHashMap.java:554) at org.apache.pulsar.common.util.collections.ConcurrentOpenHashMap.forEach(ConcurrentOpenHashMap.java:277) at org.apache.pulsar.broker.service.nonpersistent.NonPersistentTopic.publishMessage(NonPersistentTopic.java:196) at org.apache.pulsar.broker.service.Producer.publishMessageToTopic(Producer.java:281) at org.apache.pulsar.broker.service.Producer.publishMessage(Producer.java:194) at org.apache.pulsar.broker.service.ServerCnx.handleSend(ServerCnx.java:1733) at org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:222) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) at io.netty.handler.flow.FlowControlHandler.dequeue(FlowControlHandler.java:202) at io.netty.handler.flow.FlowControlHandler.channelRead(FlowControlHandler.java:164) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346) at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) at io.netty.handler.flush.FlushConsolidationHandler.channelRead(FlushConsolidationHandler.java:152) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440) at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:800) at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:499) at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:397) at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997) at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) at java.base/java.lang.Thread.run(Thread.java:833)</code><br>\nmulti-thread invoke<br>\n<code class=\"notranslate\">org.apache.pulsar.broker.service.AbstractDispatcherMultipleConsumers#getNextConsumer</code><br>\nEven if consumerList.size() is checked first, there are still thread safety issues between consumerList.size() and consumerList.get()<br>\n<code class=\"notranslate\">if (currentConsumerRoundRobinIndex &gt;= consumerList.size()) { currentConsumerRoundRobinIndex = 0; } int currentRoundRobinConsumerPriority = consumerList.get(currentConsumerRoundRobinIndex).getPriorityLevel();</code></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Like persistent methods, it is possible to access this method in a thread-safe manner or make the method itself safe</p>\n<p dir=\"auto\">org.apache.pulsar.broker.service.persistent.PersistentDispatcherMultipleConsumers#trySendMessagesToConsumers<br>\n<code class=\"notranslate\">protected synchronized boolean trySendMessagesToConsumers(ReadType readType, List&lt;Entry&gt; entries) { if (needTrimAckedMessages()) { cursor.trimDeletedEntries(entries); }</code></p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\"><a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/OverRide/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/OverRide\">@OverRide</a><br>\npublic void sendMessages(List entries) {<br>\nConsumer consumer = TOTAL_AVAILABLE_PERMITS_UPDATER.get(this) &gt; 0 ? getNextConsumer() : null;<br>\norg.apache.pulsar.broker.service.nonpersistent.NonPersistentDispatcherMultipleConsumers#sendMessages</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20924",
                "createdAt": "2023-08-03T07:26:08Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][bookie] Change majorCompactionThreshold=0.8",
        "url": "https://github.com/apache/pulsar/pull/21864",
        "resourcePath": "/apache/pulsar/pull/21864",
        "createdAt": "2024-01-08T02:36:24Z",
        "number": 21864,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "conf/bookkeeper.conf"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5jbItk2gAoNGJjZTQ5NzAxYzI5MTFjOTM4MWNkODFmYTY1Yzk3YTdjYzZkZTdmYw",
                "url": "https://github.com/apache/pulsar/pull/21864/commits/4bce49701c2911c9381cd81fa65c97a7cc6de7fc"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21861,
                "url": "https://github.com/apache/pulsar/issues/21861",
                "title": "Bookkeeper disc not recovered for a long time",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/15684156/294659173-86460935-7dbf-4731-949c-0fa071924d0f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM0MzMsIm5iZiI6MTcxNDk3MzEzMywicGF0aCI6Ii8xNTY4NDE1Ni8yOTQ2NTkxNzMtODY0NjA5MzUtN2RiZi00NzMxLTk0OWMtMGZhMDcxOTI0ZDBmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjUzM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWM5NmNmOGZjM2NiMDU5YjA5Njk3YzQ0OWEzMDg4YTI3NzU2MDhiMDRhZGE4N2Q5NTI4NGZjMDU2OGU3YjhjMTkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.RpjSxan99q_KpPZdPFHRfW8YUBuQ6i4D3UWiSisXtQY\"><img src=\"https://private-user-images.githubusercontent.com/15684156/294659173-86460935-7dbf-4731-949c-0fa071924d0f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM0MzMsIm5iZiI6MTcxNDk3MzEzMywicGF0aCI6Ii8xNTY4NDE1Ni8yOTQ2NTkxNzMtODY0NjA5MzUtN2RiZi00NzMxLTk0OWMtMGZhMDcxOTI0ZDBmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjUzM1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWM5NmNmOGZjM2NiMDU5YjA5Njk3YzQ0OWEzMDg4YTI3NzU2MDhiMDRhZGE4N2Q5NTI4NGZjMDU2OGU3YjhjMTkmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.RpjSxan99q_KpPZdPFHRfW8YUBuQ6i4D3UWiSisXtQY\" alt=\"image\" style=\"max-width: 100%;\"></a><br>\nWe have a few <code class=\"notranslate\">bk</code> node disk occupation for a long time at 95%</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">After scanning, we found that the value of the <code class=\"notranslate\">majorCompactionThreshold</code> 0.5, not 0.8 in the bookkeeper repo.</p>\n<p dir=\"auto\"><a href=\"https://github.com/apache/bookkeeper/blob/master/conf/bk_server.conf#L565\">https://github.com/apache/bookkeeper/blob/master/conf/bk_server.conf#L565</a></p>\n<p dir=\"auto\"><code class=\"notranslate\">majorCompactionThreshold=0.5</code> is less likely to trigger the GC, and whether to change the default to <code class=\"notranslate\">0.8</code> to be consistent with the bookkeeper.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21861",
                "createdAt": "2024-01-06T08:28:15Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [broker] When sending a message, broker don't verifies the logic of recordSequenceId > highestSequenceId.",
        "url": "https://github.com/apache/pulsar/pull/21887",
        "resourcePath": "/apache/pulsar/pull/21887",
        "createdAt": "2024-01-12T02:32:18Z",
        "number": 21887,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ServerCnx.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5j4Lqs2gAoZTkzYjJlN2RmZjQyMjkzMzcwOWQ0NWI5NTI3ZGMwN2EzODU5NzlkYQ",
                "url": "https://github.com/apache/pulsar/pull/21887/commits/e93b2e7dff422933709d45b9527dc07a385979da"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21886,
                "url": "https://github.com/apache/pulsar/issues/21886",
                "title": "[Bug] When sending a message, broker don't verifies the logic of recordSequenceId > highestSequenceId.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">The latest master branch code</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">This is a question I had after reading the pulsar source code. I\u2019m not sure if it\u2019s a real problem.</p>\n<p dir=\"auto\">In function org.apache.pulsar.broker.service.ServerCnx#handleSend#line 1838\uff0cThere is a logic to verify sequenceId, the code is as follows:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"// Persist the message\nif (send.hasHighestSequenceId() &amp;&amp; send.getSequenceId() &lt;= send.getHighestSequenceId()) {\n    producer.publishMessage(send.getProducerId(), send.getSequenceId(), send.getHighestSequenceId(),\n            headersAndPayload, send.getNumMessages(), send.isIsChunk(), send.isMarker(), position);\n} else {\n    producer.publishMessage(send.getProducerId(), send.getSequenceId(), headersAndPayload,\n            send.getNumMessages(), send.isIsChunk(), send.isMarker(), position);\n}\"><pre class=\"notranslate\"><span class=\"pl-c\">// Persist the message</span>\n<span class=\"pl-k\">if</span> (<span class=\"pl-s1\">send</span>.<span class=\"pl-en\">hasHighestSequenceId</span>() &amp;&amp; <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getSequenceId</span>() &lt;= <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getHighestSequenceId</span>()) {\n    <span class=\"pl-s1\">producer</span>.<span class=\"pl-en\">publishMessage</span>(<span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getProducerId</span>(), <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getSequenceId</span>(), <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getHighestSequenceId</span>(),\n            <span class=\"pl-s1\">headersAndPayload</span>, <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getNumMessages</span>(), <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">isIsChunk</span>(), <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">isMarker</span>(), <span class=\"pl-s1\">position</span>);\n} <span class=\"pl-k\">else</span> {\n    <span class=\"pl-s1\">producer</span>.<span class=\"pl-en\">publishMessage</span>(<span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getProducerId</span>(), <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getSequenceId</span>(), <span class=\"pl-s1\">headersAndPayload</span>,\n            <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getNumMessages</span>(), <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">isIsChunk</span>(), <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">isMarker</span>(), <span class=\"pl-s1\">position</span>);\n}</pre></div>\n<p dir=\"auto\">But he did not check the following logic (if the following situation occurs, an exception should be returned):</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"send.hasHighestSequenceId() &amp;&amp; send.getSequenceId() &gt; send.getHighestSequenceId()\"><pre class=\"notranslate\"><span class=\"pl-s1\">send</span>.<span class=\"pl-en\">hasHighestSequenceId</span>() &amp;&amp; <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getSequenceId</span>() &gt; <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getHighestSequenceId</span>()</pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">I hope to check the following logic (if the following situation occurs, an exception should be returned):</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"send.hasHighestSequenceId() &amp;&amp; send.getSequenceId() &gt; send.getHighestSequenceId()\"><pre class=\"notranslate\"><span class=\"pl-s1\">send</span>.<span class=\"pl-en\">hasHighestSequenceId</span>() &amp;&amp; <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getSequenceId</span>() &gt; <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getHighestSequenceId</span>()</pre></div>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">I find <code class=\"notranslate\">org.apache.pulsar.broker.service.Producer#publishMessage</code> function makes a judgment of <code class=\"notranslate\">lowestSequenceId &gt; highestSequenceId</code>\uff1a</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"public void publishMessage(long producerId, long lowestSequenceId, long highestSequenceId,\n            ByteBuf headersAndPayload, long batchSize, boolean isChunked, boolean isMarker, Position position) {\n        if (lowestSequenceId &gt; highestSequenceId) {\"><pre class=\"notranslate\"><span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">publishMessage</span>(<span class=\"pl-smi\">long</span> <span class=\"pl-s1\">producerId</span>, <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">lowestSequenceId</span>, <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">highestSequenceId</span>,\n            <span class=\"pl-smi\">ByteBuf</span> <span class=\"pl-s1\">headersAndPayload</span>, <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">batchSize</span>, <span class=\"pl-smi\">boolean</span> <span class=\"pl-s1\">isChunked</span>, <span class=\"pl-smi\">boolean</span> <span class=\"pl-s1\">isMarker</span>, <span class=\"pl-smi\">Position</span> <span class=\"pl-s1\">position</span>) {\n        <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">lowestSequenceId</span> &gt; <span class=\"pl-s1\">highestSequenceId</span>) {</pre></div>\n<p dir=\"auto\">so  <code class=\"notranslate\">org.apache.pulsar.broker.service.ServerCnx#handleSend</code> function can be changed to:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"// Persist the message\nif (send.hasHighestSequenceId()) {\n    producer.publishMessage(send.getProducerId(), send.getSequenceId(), send.getHighestSequenceId(),\n            headersAndPayload, send.getNumMessages(), send.isIsChunk(), send.isMarker(), position);\n} else {\n    producer.publishMessage(send.getProducerId(), send.getSequenceId(), headersAndPayload,\n            send.getNumMessages(), send.isIsChunk(), send.isMarker(), position);\n}\"><pre class=\"notranslate\"><span class=\"pl-c\">// Persist the message</span>\n<span class=\"pl-k\">if</span> (<span class=\"pl-s1\">send</span>.<span class=\"pl-en\">hasHighestSequenceId</span>()) {\n    <span class=\"pl-s1\">producer</span>.<span class=\"pl-en\">publishMessage</span>(<span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getProducerId</span>(), <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getSequenceId</span>(), <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getHighestSequenceId</span>(),\n            <span class=\"pl-s1\">headersAndPayload</span>, <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getNumMessages</span>(), <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">isIsChunk</span>(), <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">isMarker</span>(), <span class=\"pl-s1\">position</span>);\n} <span class=\"pl-k\">else</span> {\n    <span class=\"pl-s1\">producer</span>.<span class=\"pl-en\">publishMessage</span>(<span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getProducerId</span>(), <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getSequenceId</span>(), <span class=\"pl-s1\">headersAndPayload</span>,\n            <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">getNumMessages</span>(), <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">isIsChunk</span>(), <span class=\"pl-s1\">send</span>.<span class=\"pl-en\">isMarker</span>(), <span class=\"pl-s1\">position</span>);\n}</pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">no</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21886",
                "createdAt": "2024-01-12T02:30:24Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Fix messages in the batch container timed out unexpectedly",
        "url": "https://github.com/apache/pulsar/pull/21889",
        "resourcePath": "/apache/pulsar/pull/21889",
        "createdAt": "2024-01-12T03:30:07Z",
        "number": 21889,
        "mergeCommit": {
          "oid": "b56e40cd2346f9698e948b76f732c53e00fcd555",
          "message": "[fix][client] Fix messages in the batch container timed out unexpectedly (#21889)",
          "commitUrl": "https://github.com/apache/pulsar/commit/b56e40cd2346f9698e948b76f732c53e00fcd555",
          "parents": {
            "nodes": [
              {
                "oid": "4ebbd2f5244ea2f8c0fd75e4dcb52055568b7fc7",
                "message": " [fix] [broker] Fix break change: could not subscribe partitioned topic with a suffix-matched regexp due to a mistake of PIP-145 (#21885)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/ProducerConsumerInternalTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/AbstractBatchMessageContainer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageContainerBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageContainerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/BatchMessageKeyBasedContainer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5j4Ul42gAoNGM4NjhjMzZiOTdhOGM1MmU3MzgzNTgwOGNkNTg1OTAwM2I4YmUwOQ",
                "url": "https://github.com/apache/pulsar/pull/21889/commits/4c868c36b97a8c52e73835808cd5859003b8be09"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21884,
                "url": "https://github.com/apache/pulsar/issues/21884",
                "title": "[Bug] Send timeout happened immediately when batching is enabled",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">KSN (the private version of the Kafka protocol handler) based on Pulsar 3.1.0.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\"><strong>Background for KSN</strong></p>\n<p dir=\"auto\">There is a partitioned topic <code class=\"notranslate\">public/__kafka/__consumer_offsets</code> with 50 partitions. In KSN, there are 50 producers and 50 readers created on this topic. The producer is created like:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"        this.producerBuilder = client.newProducer(schema).enableBatching(true)\n                .batchingMaxPublishDelay(1, TimeUnit.MILLISECONDS)\n                .maxPendingMessages(maxPendingMessages)\n                .sendTimeout(offsetConfig.offsetCommitTimeoutMs(), TimeUnit.MILLISECONDS)\n                .blockIfQueueFull(true);\"><pre class=\"notranslate\">        <span class=\"pl-smi\">this</span>.<span class=\"pl-s1\">producerBuilder</span> = <span class=\"pl-s1\">client</span>.<span class=\"pl-en\">newProducer</span>(<span class=\"pl-s1\">schema</span>).<span class=\"pl-en\">enableBatching</span>(<span class=\"pl-c1\">true</span>)\n                .<span class=\"pl-en\">batchingMaxPublishDelay</span>(<span class=\"pl-c1\">1</span>, <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">MILLISECONDS</span>)\n                .<span class=\"pl-en\">maxPendingMessages</span>(<span class=\"pl-s1\">maxPendingMessages</span>)\n                .<span class=\"pl-en\">sendTimeout</span>(<span class=\"pl-s1\">offsetConfig</span>.<span class=\"pl-en\">offsetCommitTimeoutMs</span>(), <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">MILLISECONDS</span>)\n                .<span class=\"pl-en\">blockIfQueueFull</span>(<span class=\"pl-c1\">true</span>);</pre></div>\n<p dir=\"auto\">The send timeout is 5 seconds.</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"            final var future = producers.computeIfAbsent(partition, __ -&gt;\n                producerBuilder.clone().topic(getPartition(partition)).createAsync());\"><pre class=\"notranslate\">            <span class=\"pl-k\">final</span> <span class=\"pl-smi\">var</span> <span class=\"pl-s1\">future</span> = <span class=\"pl-s1\">producers</span>.<span class=\"pl-en\">computeIfAbsent</span>(<span class=\"pl-s1\">partition</span>, <span class=\"pl-s1\">__</span> -&gt;\n                <span class=\"pl-s1\">producerBuilder</span>.<span class=\"pl-en\">clone</span>().<span class=\"pl-en\">topic</span>(<span class=\"pl-en\">getPartition</span>(<span class=\"pl-s1\">partition</span>)).<span class=\"pl-en\">createAsync</span>());</pre></div>\n<p dir=\"auto\">I used the Kafka CLI to consume a topic, which committed offsets to <code class=\"notranslate\">__consumer_offsets-partition-38</code> with an interval of 5 seconds. Each time an offset is committed, a message will be sent via a Pulsar producer.</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"        producer.newMessage().keyBytes(key).value(value).eventTime(timestamp).sendAsync().whenComplete(\n                (msgId, e) -&gt; {\n                    if (e == null) {\n                        future.complete(msgId);\n                    } else {\n                        if (e instanceof PulsarClientException.AlreadyClosedException) {\n                            // The producer is already closed, we don't need to close it again.\n                            producers.remove(partition);\n                        } else if (e instanceof PulsarClientException.TimeoutException te) {\n                            log.warn(&quot;Timeout when sending: {}, seq id: {}&quot;, te.getMessage(), te.getSequenceId());\n                        }\n                        future.completeExceptionally(e);\n                    }\n                });\"><pre class=\"notranslate\">        <span class=\"pl-s1\">producer</span>.<span class=\"pl-en\">newMessage</span>().<span class=\"pl-en\">keyBytes</span>(<span class=\"pl-s1\">key</span>).<span class=\"pl-en\">value</span>(<span class=\"pl-s1\">value</span>).<span class=\"pl-en\">eventTime</span>(<span class=\"pl-s1\">timestamp</span>).<span class=\"pl-en\">sendAsync</span>().<span class=\"pl-en\">whenComplete</span>(\n                (<span class=\"pl-s1\">msgId</span>, <span class=\"pl-s1\">e</span>) -&gt; {\n                    <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">e</span> == <span class=\"pl-c1\">null</span>) {\n                        <span class=\"pl-s1\">future</span>.<span class=\"pl-en\">complete</span>(<span class=\"pl-s1\">msgId</span>);\n                    } <span class=\"pl-k\">else</span> {\n                        <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">e</span> <span class=\"pl-k\">instanceof</span> <span class=\"pl-smi\">PulsarClientException</span>.<span class=\"pl-smi\">AlreadyClosedException</span>) {\n                            <span class=\"pl-c\">// The producer is already closed, we don't need to close it again.</span>\n                            <span class=\"pl-s1\">producers</span>.<span class=\"pl-en\">remove</span>(<span class=\"pl-s1\">partition</span>);\n                        } <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">e</span> <span class=\"pl-k\">instanceof</span> <span class=\"pl-smi\">PulsarClientException</span>.<span class=\"pl-smi\">TimeoutException</span> <span class=\"pl-s1\">te</span>) {\n                            <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">warn</span>(<span class=\"pl-s\">\"Timeout when sending: {}, seq id: {}\"</span>, <span class=\"pl-s1\">te</span>.<span class=\"pl-en\">getMessage</span>(), <span class=\"pl-s1\">te</span>.<span class=\"pl-en\">getSequenceId</span>());\n                        }\n                        <span class=\"pl-s1\">future</span>.<span class=\"pl-en\">completeExceptionally</span>(<span class=\"pl-s1\">e</span>);\n                    }\n                });</pre></div>\n<p dir=\"auto\">After some time, the commit offset request failed with timeout error:</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ ./bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic my-topic --group my-group\n[2024-01-11 23:18:00,649] WARN [Consumer clientId=console-consumer, groupId=my-group] Offset commit failed on partition my-topic-0 at offset 0: The request timed out. (org.apache.kafka.clients.consumer.internals.ConsumerCoordinator)\"><pre class=\"notranslate\">$ ./bin/kafka-console-consumer.sh --bootstrap-server localhost:9092 --topic my-topic --group my-group\n[2024-01-11 23:18:00,649] WARN [Consumer clientId<span class=\"pl-k\">=</span>console-consumer, groupId<span class=\"pl-k\">=</span>my-group] Offset commit failed on partition my-topic-0 at offset 0: The request timed out. (org.apache.kafka.clients.consumer.internals.ConsumerCoordinator)</pre></div>\n<p dir=\"auto\">From the broker side logs, we can see:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2024-01-11T23:10:23,628+0800 [pulsar-ph-kafka-224-11] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync GroupMetadata{groupId=my-group, generation=22, protocolType=Optional[consumer], state=Stable, members={console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9=MemberMetadata{memberId=console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9, clientId=console-consumer, clientHost=/127.0.0.1:63244, sessionTimeoutMs=45000, rebalanceTimeoutMs=300000, supportedProtocols=java.util.stream.ReferencePipeline$Head@1031ff46}}} (38) key: 18 bytes\n2024-01-11T23:10:23,630+0800 [pulsar-timer-118-1] INFO  org.apache.pulsar.client.impl.ProducerImpl - [public/__kafka/__consumer_offsets-partition-38] [standalone-2804-81] Message send timed out. Failing 1 messages\n2024-01-11T23:10:23,631+0800 [pulsar-timer-118-1] WARN  io.streamnative.pulsar.handlers.kop.coordinator.CompactedPartitionedTopic - Timeout when sending: The producer standalone-2804-81 can not send message to the topic public/__kafka/__consumer_offsets-partition-38 within given timeout, seq id: -1\"><pre class=\"notranslate\"><code class=\"notranslate\">2024-01-11T23:10:23,628+0800 [pulsar-ph-kafka-224-11] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync GroupMetadata{groupId=my-group, generation=22, protocolType=Optional[consumer], state=Stable, members={console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9=MemberMetadata{memberId=console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9, clientId=console-consumer, clientHost=/127.0.0.1:63244, sessionTimeoutMs=45000, rebalanceTimeoutMs=300000, supportedProtocols=java.util.stream.ReferencePipeline$Head@1031ff46}}} (38) key: 18 bytes\n2024-01-11T23:10:23,630+0800 [pulsar-timer-118-1] INFO  org.apache.pulsar.client.impl.ProducerImpl - [public/__kafka/__consumer_offsets-partition-38] [standalone-2804-81] Message send timed out. Failing 1 messages\n2024-01-11T23:10:23,631+0800 [pulsar-timer-118-1] WARN  io.streamnative.pulsar.handlers.kop.coordinator.CompactedPartitionedTopic - Timeout when sending: The producer standalone-2804-81 can not send message to the topic public/__kafka/__consumer_offsets-partition-38 within given timeout, seq id: -1\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Before the <code class=\"notranslate\">sendAsync</code> method is called, the timestamp is 23:10:23,628. However, when the message timed out, the timestamp is 23:10:23,631. The interval is only 3 milliseconds.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The time duration between <code class=\"notranslate\">XYZ storeOffsetMessageAsync</code> and <code class=\"notranslate\">Timeout when sending</code> should be close to 5 seconds.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">There is nothing strange before the timeout happened.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2024-01-11T23:09:53,619+0800 [pulsar-client-io-87-3] INFO  org.apache.pulsar.client.impl.ProducerImpl - [public/__kafka/__consumer_offsets-partition-38] [standalone-2804-81] Created producer on cnx [id: 0x4d70618b, L:/127.0.0.1:63232 - R:/127.0.0.1:6650]\n2024-01-11T23:09:53,623+0800 [pulsar-client-io-87-3] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync successfully 38 key: 18 bytes\n2024-01-11T23:09:58,622+0800 [pulsar-ph-kafka-224-11] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync GroupMetadata{groupId=my-group, generation=22, protocolType=Optional[consumer], state=Stable, members={console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9=MemberMetadata{memberId=console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9, clientId=console-consumer, clientHost=/127.0.0.1:63244, sessionTimeoutMs=45000, rebalanceTimeoutMs=300000, supportedProtocols=java.util.stream.ReferencePipeline$Head@7346deaf}}} (38) key: 18 bytes\n2024-01-11T23:09:58,630+0800 [pulsar-client-io-87-3] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync successfully 38 key: 18 bytes\n2024-01-11T23:10:03,620+0800 [pulsar-ph-kafka-224-11] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync GroupMetadata{groupId=my-group, generation=22, protocolType=Optional[consumer], state=Stable, members={console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9=MemberMetadata{memberId=console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9, clientId=console-consumer, clientHost=/127.0.0.1:63244, sessionTimeoutMs=45000, rebalanceTimeoutMs=300000, supportedProtocols=java.util.stream.ReferencePipeline$Head@624415e4}}} (38) key: 18 bytes\n2024-01-11T23:10:03,625+0800 [pulsar-client-io-87-3] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync successfully 38 key: 18 bytes\n2024-01-11T23:10:08,624+0800 [pulsar-ph-kafka-224-11] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync GroupMetadata{groupId=my-group, generation=22, protocolType=Optional[consumer], state=Stable, members={console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9=MemberMetadata{memberId=console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9, clientId=console-consumer, clientHost=/127.0.0.1:63244, sessionTimeoutMs=45000, rebalanceTimeoutMs=300000, supportedProtocols=java.util.stream.ReferencePipeline$Head@b35f1bd}}} (38) key: 18 bytes\n2024-01-11T23:10:08,630+0800 [pulsar-client-io-87-3] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync successfully 38 key: 18 bytes\n2024-01-11T23:10:13,621+0800 [pulsar-ph-kafka-224-11] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync GroupMetadata{groupId=my-group, generation=22, protocolType=Optional[consumer], state=Stable, members={console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9=MemberMetadata{memberId=console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9, clientId=console-consumer, clientHost=/127.0.0.1:63244, sessionTimeoutMs=45000, rebalanceTimeoutMs=300000, supportedProtocols=java.util.stream.ReferencePipeline$Head@33f29b11}}} (38) key: 18 bytes\n2024-01-11T23:10:13,626+0800 [pulsar-client-io-87-3] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync successfully 38 key: 18 bytes\n2024-01-11T23:10:17,592+0800 [SyncThread-9-1] INFO  org.apache.bookkeeper.bookie.Journal - garbage collected journal 18cf7e07713.txn\n2024-01-11T23:10:18,624+0800 [pulsar-ph-kafka-224-11] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync GroupMetadata{groupId=my-group, generation=22, protocolType=Optional[consumer], state=Stable, members={console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9=MemberMetadata{memberId=console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9, clientId=console-consumer, clientHost=/127.0.0.1:63244, sessionTimeoutMs=45000, rebalanceTimeoutMs=300000, supportedProtocols=java.util.stream.ReferencePipeline$Head@76848866}}} (38) key: 18 bytes\n2024-01-11T23:10:18,631+0800 [pulsar-client-io-87-3] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync successfully 38 key: 18 bytes\"><pre class=\"notranslate\"><code class=\"notranslate\">2024-01-11T23:09:53,619+0800 [pulsar-client-io-87-3] INFO  org.apache.pulsar.client.impl.ProducerImpl - [public/__kafka/__consumer_offsets-partition-38] [standalone-2804-81] Created producer on cnx [id: 0x4d70618b, L:/127.0.0.1:63232 - R:/127.0.0.1:6650]\n2024-01-11T23:09:53,623+0800 [pulsar-client-io-87-3] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync successfully 38 key: 18 bytes\n2024-01-11T23:09:58,622+0800 [pulsar-ph-kafka-224-11] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync GroupMetadata{groupId=my-group, generation=22, protocolType=Optional[consumer], state=Stable, members={console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9=MemberMetadata{memberId=console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9, clientId=console-consumer, clientHost=/127.0.0.1:63244, sessionTimeoutMs=45000, rebalanceTimeoutMs=300000, supportedProtocols=java.util.stream.ReferencePipeline$Head@7346deaf}}} (38) key: 18 bytes\n2024-01-11T23:09:58,630+0800 [pulsar-client-io-87-3] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync successfully 38 key: 18 bytes\n2024-01-11T23:10:03,620+0800 [pulsar-ph-kafka-224-11] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync GroupMetadata{groupId=my-group, generation=22, protocolType=Optional[consumer], state=Stable, members={console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9=MemberMetadata{memberId=console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9, clientId=console-consumer, clientHost=/127.0.0.1:63244, sessionTimeoutMs=45000, rebalanceTimeoutMs=300000, supportedProtocols=java.util.stream.ReferencePipeline$Head@624415e4}}} (38) key: 18 bytes\n2024-01-11T23:10:03,625+0800 [pulsar-client-io-87-3] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync successfully 38 key: 18 bytes\n2024-01-11T23:10:08,624+0800 [pulsar-ph-kafka-224-11] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync GroupMetadata{groupId=my-group, generation=22, protocolType=Optional[consumer], state=Stable, members={console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9=MemberMetadata{memberId=console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9, clientId=console-consumer, clientHost=/127.0.0.1:63244, sessionTimeoutMs=45000, rebalanceTimeoutMs=300000, supportedProtocols=java.util.stream.ReferencePipeline$Head@b35f1bd}}} (38) key: 18 bytes\n2024-01-11T23:10:08,630+0800 [pulsar-client-io-87-3] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync successfully 38 key: 18 bytes\n2024-01-11T23:10:13,621+0800 [pulsar-ph-kafka-224-11] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync GroupMetadata{groupId=my-group, generation=22, protocolType=Optional[consumer], state=Stable, members={console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9=MemberMetadata{memberId=console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9, clientId=console-consumer, clientHost=/127.0.0.1:63244, sessionTimeoutMs=45000, rebalanceTimeoutMs=300000, supportedProtocols=java.util.stream.ReferencePipeline$Head@33f29b11}}} (38) key: 18 bytes\n2024-01-11T23:10:13,626+0800 [pulsar-client-io-87-3] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync successfully 38 key: 18 bytes\n2024-01-11T23:10:17,592+0800 [SyncThread-9-1] INFO  org.apache.bookkeeper.bookie.Journal - garbage collected journal 18cf7e07713.txn\n2024-01-11T23:10:18,624+0800 [pulsar-ph-kafka-224-11] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync GroupMetadata{groupId=my-group, generation=22, protocolType=Optional[consumer], state=Stable, members={console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9=MemberMetadata{memberId=console-consumer-b18a2e15-6cc8-470a-bf43-d35808ecc6f9, clientId=console-consumer, clientHost=/127.0.0.1:63244, sessionTimeoutMs=45000, rebalanceTimeoutMs=300000, supportedProtocols=java.util.stream.ReferencePipeline$Head@76848866}}} (38) key: 18 bytes\n2024-01-11T23:10:18,631+0800 [pulsar-client-io-87-3] INFO  io.streamnative.pulsar.handlers.kop.coordinator.group.GroupMetadataManager - XYZ storeOffsetMessageAsync successfully 38 key: 18 bytes\n</code></pre></div>\n<p dir=\"auto\">The logs above are all INFO logs before the timeout error. As you can see, the message send interval is 1 message per 5 seconds and other messages succeeded as well.</p>\n<p dir=\"auto\">I printed the sequence id of the <code class=\"notranslate\">TimeoutException</code> and found it's -1.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"024-01-11T23:10:23,631+0800 [pulsar-timer-118-1] WARN  io.streamnative.pulsar.handlers.kop.coordinator.CompactedPartitionedTopic - Timeout when sending: The producer standalone-2804-81 can not send message to the topic public/__kafka/__consumer_offsets-partition-38 within given timeout, seq id: -1\"><pre class=\"notranslate\"><code class=\"notranslate\">024-01-11T23:10:23,631+0800 [pulsar-timer-118-1] WARN  io.streamnative.pulsar.handlers.kop.coordinator.CompactedPartitionedTopic - Timeout when sending: The producer standalone-2804-81 can not send message to the topic public/__kafka/__consumer_offsets-partition-38 within given timeout, seq id: -1\n</code></pre></div>\n<p dir=\"auto\">It means it failed here: </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/176bdeacd309e8c1e49358987a1946abd30ba34a/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java#L2032\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 2032\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/176bdeacd309e8c1e49358987a1946abd30ba34a\">176bdea</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L2032\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"2032\"></td>\n          <td id=\"LC2032\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-en\">failPendingBatchMessages</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">PulsarClientException</span>.<span class=\"pl-smi\">TimeoutException</span>(<span class=\"pl-s1\">msg</span>)); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">If the message is already created as an <code class=\"notranslate\">OpSendMsg</code>, the sequence id should be positive.</p>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/files/13905199/full-logs.tar.gz\">full-logs.tar.gz</a></p>\n<p dir=\"auto\">I suspected there is something wrong with the refactored logic of: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1128129776\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/14185\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/14185/hovercard\" href=\"https://github.com/apache/pulsar/pull/14185\">#14185</a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21884",
                "createdAt": "2024-01-11T15:31:31Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Fix DLQ producer name conflicts when multiples consumers send messages to DLQ",
        "url": "https://github.com/apache/pulsar/pull/21890",
        "resourcePath": "/apache/pulsar/pull/21890",
        "createdAt": "2024-01-12T05:36:26Z",
        "number": 21890,
        "mergeCommit": {
          "oid": "252509e08018eeed189e0d5492c3664a67bced06",
          "message": "[fix][client] Fix DLQ producer name conflicts when multiples consumers send messages to DLQ (#21890)",
          "commitUrl": "https://github.com/apache/pulsar/commit/252509e08018eeed189e0d5492c3664a67bced06",
          "parents": {
            "nodes": [
              {
                "oid": "c834feb459369f497c68cd42dbc1625b11551f72",
                "message": "[improve][broker] PIP-307: Add feature flag config option (#21866)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/DeadLetterTopicTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5j4rWO2gAoZGU3ZDMzZjJmMzM3ZTVmZWJhMGFiMTVlMTNhNjQwNDU4NGU3YzU5Yg",
                "url": "https://github.com/apache/pulsar/pull/21890/commits/de7d33f2f337e5feba0ab15e13a6404584e7c59b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21888,
                "url": "https://github.com/apache/pulsar/issues/21888",
                "title": "[Bug] DLQ producer name conflicts when consumer sends messages to DLQ",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/commit/c834feb459369f497c68cd42dbc1625b11551f72\">c834feb</a></p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Run the test: <a href=\"https://github.com/apache/pulsar/blob/c87cfb3f50b32f5c032b5d1c3a6a0b91cde2bbe9/pulsar-broker/src/test/java/org/apache/pulsar/client/api/DeadLetterTopicTest.java#L872\">testDeadLetterTopicWithInitialSubscriptionAndMultiConsumers</a></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">The test should be passed without any exceptions.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Even though the test is passed, It will throw unexpected execeptions:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2024-01-12T09:55:17,713 - ERROR - [pulsar-client-io-35-5:ConsumerImpl@2155] - Dead letter producer exception with topic: persistent://my-property/my-ns/dead-letter-topic-my-subscription-DLQ\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$ProducerBusyException: {&quot;errorMsg&quot;:&quot;org.apache.pulsar.broker.service.BrokerServiceException$NamingException: Producer with name 'persistent://my-property/my-ns/dead-letter-topic-my-subscription-DLQ' is already connected to topic&quot;,&quot;reqId&quot;:2964198371560761575, &quot;remote&quot;:&quot;localhost/127.0.0.1:63813&quot;, &quot;local&quot;:&quot;/127.0.0.1:63828&quot;}\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:332) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:347) ~[?:?]\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:708) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2194) ~[?:?]\n\tat org.apache.pulsar.client.impl.ProducerImpl.lambda$connectionOpened$16(ProducerImpl.java:1846) ~[classes/:?]\n\tat java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:990) ~[?:?]\n\tat java.util.concurrent.CompletableFuture$UniExceptionally.tryFire(CompletableFuture.java:974) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2194) ~[?:?]\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:794) ~[classes/:?]\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:192) ~[classes/:?]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346) ~[netty-codec-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318) ~[netty-codec-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.handler.flush.FlushConsolidationHandler.channelRead(FlushConsolidationHandler.java:152) ~[netty-handler-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997) ~[netty-common-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[netty-common-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[netty-common-4.1.104.Final.jar:4.1.104.Final]\n\tat java.lang.Thread.run(Thread.java:1583) ~[?:?]\nCaused by: org.apache.pulsar.client.api.PulsarClientException$ProducerBusyException: {&quot;errorMsg&quot;:&quot;org.apache.pulsar.broker.service.BrokerServiceException$NamingException: Producer with name 'persistent://my-property/my-ns/dead-letter-topic-my-subscription-DLQ' is already connected to topic&quot;,&quot;reqId&quot;:2964198371560761575, &quot;remote&quot;:&quot;localhost/127.0.0.1:63813&quot;, &quot;local&quot;:&quot;/127.0.0.1:63828&quot;}\n\tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:1318) ~[classes/:?]\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:795) ~[classes/:?]\n\t... 26 more\"><pre class=\"notranslate\"><code class=\"notranslate\">2024-01-12T09:55:17,713 - ERROR - [pulsar-client-io-35-5:ConsumerImpl@2155] - Dead letter producer exception with topic: persistent://my-property/my-ns/dead-letter-topic-my-subscription-DLQ\njava.util.concurrent.CompletionException: org.apache.pulsar.client.api.PulsarClientException$ProducerBusyException: {\"errorMsg\":\"org.apache.pulsar.broker.service.BrokerServiceException$NamingException: Producer with name 'persistent://my-property/my-ns/dead-letter-topic-my-subscription-DLQ' is already connected to topic\",\"reqId\":2964198371560761575, \"remote\":\"localhost/127.0.0.1:63813\", \"local\":\"/127.0.0.1:63828\"}\n\tat java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:332) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.completeThrowable(CompletableFuture.java:347) ~[?:?]\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:708) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2194) ~[?:?]\n\tat org.apache.pulsar.client.impl.ProducerImpl.lambda$connectionOpened$16(ProducerImpl.java:1846) ~[classes/:?]\n\tat java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:990) ~[?:?]\n\tat java.util.concurrent.CompletableFuture$UniExceptionally.tryFire(CompletableFuture.java:974) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510) ~[?:?]\n\tat java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2194) ~[?:?]\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:794) ~[classes/:?]\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:192) ~[classes/:?]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346) ~[netty-codec-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318) ~[netty-codec-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.handler.flush.FlushConsolidationHandler.channelRead(FlushConsolidationHandler.java:152) ~[netty-handler-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562) ~[netty-transport-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997) ~[netty-common-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[netty-common-4.1.104.Final.jar:4.1.104.Final]\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[netty-common-4.1.104.Final.jar:4.1.104.Final]\n\tat java.lang.Thread.run(Thread.java:1583) ~[?:?]\nCaused by: org.apache.pulsar.client.api.PulsarClientException$ProducerBusyException: {\"errorMsg\":\"org.apache.pulsar.broker.service.BrokerServiceException$NamingException: Producer with name 'persistent://my-property/my-ns/dead-letter-topic-my-subscription-DLQ' is already connected to topic\",\"reqId\":2964198371560761575, \"remote\":\"localhost/127.0.0.1:63813\", \"local\":\"/127.0.0.1:63828\"}\n\tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:1318) ~[classes/:?]\n\tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:795) ~[classes/:?]\n\t... 26 more\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The root cause is that a regression bug is introduced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1998185694\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/21589\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/21589/hovercard\" href=\"https://github.com/apache/pulsar/pull/21589\">#21589</a>. The producer name will be conflicted when multiple consumers in the same topic and subscription send messages to DLQ concurrently.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21888",
                "createdAt": "2024-01-12T02:42:29Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "release/blocker"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix leader broker cannot be determined when the advertised address and advertised listeners are configured",
        "url": "https://github.com/apache/pulsar/pull/21894",
        "resourcePath": "/apache/pulsar/pull/21894",
        "createdAt": "2024-01-13T01:15:12Z",
        "number": 21894,
        "mergeCommit": {
          "oid": "3158fd3550f9e3a0b2c0316c92265318b209f4f5",
          "message": "[fix][broker] Fix leader broker cannot be determined when the advertised address and advertised listeners are configured (#21894)",
          "commitUrl": "https://github.com/apache/pulsar/commit/3158fd3550f9e3a0b2c0316c92265318b209f4f5",
          "parents": {
            "nodes": [
              {
                "oid": "c66167be55e9ed14261174a672952136c6fdb441",
                "message": "[improve][ml] Filter out deleted entries before read entries from ledger. (#21739)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/namespace/NamespaceServiceTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/InactiveTopicDeleteTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/systopic/PartitionedSystemTopicTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/testcontext/PulsarTestContext.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/BrokerServiceLookupTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/compaction/CompactionTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin-api/src/main/java/org/apache/pulsar/common/policies/data/BrokerInfo.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin-api/src/main/java/org/apache/pulsar/common/policies/data/impl/BrokerInfoImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyWithExtensibleLoadManagerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5j_BpE2gAoOTZmZTExYjQwZTkzMGFmNjFkMzA5ZmJjZjQxNzQyOWMxNmUyNTgzYw",
                "url": "https://github.com/apache/pulsar/pull/21894/commits/96fe11b40e930af61d309fbcf417429c16e2583c"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21897,
                "url": "https://github.com/apache/pulsar/issues/21897",
                "title": "[Bug] The leader broker identifier becomes unresolvable if the internal listener is not configured to match the advertised address.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.10.4</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">We are hitting a bug where a leader broker identifier becomes unresolvable when a internalListener is not configured to match the advertised address because the leader broker's identifier uses the internal listener's host name and in all other cases the advertisedAddress is used.</p>\n<p dir=\"auto\">warnings in broker logs:<br>\n<code class=\"notranslate\">05:19:57.541 [pulsar-2-5] WARN  org.apache.pulsar.broker.namespace.NamespaceService - The current leader broker LeaderBroker(serviceUrl=http://xx.yy.zz.xy:8080/) isn't active. Handling load manager decisions in a decentralized way. NamespaceBundle[tenant/ns/0x2fffffff_0x3269f69d] </code></p>\n<p dir=\"auto\">Reason -<br>\n<code class=\"notranslate\">05:19:55.176 [pulsar-2-6] WARN  org.apache.pulsar.broker.namespace.NamespaceService - Broker http://xx.yy.zz.xy:8080/ (xx.yy.zz.xy:8080) couldn't be found in available brokers prod-xx-1-pulsar-broker-10:8080,prod-xx-1-pulsar-broker-yy-7:8080,prod-xx-1-pulsar-broker-zz-5:8080,prod-xx-1-pulsar-broker-7:8080,prod-xx-1-pulsar-broker-zz-2:8080,prod-xx-1-pulsar-broker-yy-1:8080,prod-xx-1-pulsar-broker-yy-4:8080,prod-xx-1-pulsar-broker-2:8080,prod-xx-1-pulsar-broker-12:8080,prod-xx-1-pulsar-broker-yy-2:8080,prod-xx-1-pulsar-broker-15:8080</code></p>\n<p dir=\"auto\">here it seems related to the advertised listerners/address. we are setting the advertisedAddress as a hostname of a stateful set and advertisedListeners as broker pod ips and not setting a internalListenerName</p>\n<p dir=\"auto\">from above logs, we can see that for leader broker's load manager using the (ip:port) because if we dont set the internal Listener Name it picks the first advertised listener as the internalListener Name.</p>\n<p dir=\"auto\">Configs :</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"advertisedAddress=prod-xx-pulsar-broker-0\nadvertisedListeners=public_pulsar:pulsar://xx.yy.zz.xy:6650,public_http:http://xx.yy.zz.xy:8080/    \"><pre class=\"notranslate\"><code class=\"notranslate\">advertisedAddress=prod-xx-pulsar-broker-0\nadvertisedListeners=public_pulsar:pulsar://xx.yy.zz.xy:6650,public_http:http://xx.yy.zz.xy:8080/    \n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">There should be consistent ways for a unique identifier for a broker.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Inconsistency in resolving the leader broker identifier, compared to other brokers, results in incorrect information regarding the unavailability of the leader broker. Consequently, client-side disconnections occur due to the unresolvable information about the leader broker.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21897",
                "createdAt": "2024-01-14T16:42:14Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Remove delta when calculating msgRateRequiredFromUnloadedBundles and msgThroughputRequiredFromUnloadedBundles for UniformLoadShedder",
        "url": "https://github.com/apache/pulsar/pull/21906",
        "resourcePath": "/apache/pulsar/pull/21906",
        "createdAt": "2024-01-16T05:24:31Z",
        "number": 21906,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/impl/UniformLoadShedder.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/impl/UniformLoadShedderTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5kJOuM2gAoY2ZhMjNiMmNiNTM3NTBlZGVmMTczYWFkZjRmMmZlM2U0ZTg3NDVmNA",
                "url": "https://github.com/apache/pulsar/pull/21906/commits/cfa23b2cb53750edef173aadf4f2fe3e4e8745f4"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21905,
                "url": "https://github.com/apache/pulsar/issues/21905",
                "title": "[Bug] The UniformLoadShedder strategy fails when the traffic is less than 1000(delta)",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">3.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">The cluster configuration information is as follows(other load balacnce configurations remain at default values)\uff1a<br>\nloadBalancerEnabled=true<br>\nloadBalancerSheddingEnabled=true<br>\nloadBalancerSheddingGracePeriodMinutes=5<br>\nminUnloadMessage=0<br>\nminUnloadMessageThroughput=0</p>\n<p dir=\"auto\">1\u3001Start the first broker<br>\n2\u3001Create a multi-partition topic and distribute the partitions on different bundles<br>\n3\u3001Send messages to the topic at a speed less than 1000 TPS(for example 600TPS)<br>\n4\u3001After waiting for the send to stabilize, start the second broker node</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">The second broker is only allocated part of the traffic, and the traffic of the brokers is relatively balanced.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">The second broker distributes all traffic.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/16524922/296937588-e6bf6759-d516-448b-9302-c6aed97a223d.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM0ODksIm5iZiI6MTcxNDk3MzE4OSwicGF0aCI6Ii8xNjUyNDkyMi8yOTY5Mzc1ODgtZTZiZjY3NTktZDUxNi00NDhiLTkzMDItYzZhZWQ5N2EyMjNkLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjYyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTA5ZmQ4ZTQxM2E4N2Q1MmIzOTFjYjRiMWFhNGYzYTAyNDhlN2UwN2U1YzVkYzQ3ZGQ5ZDcyYWVhYjIwNTZlNmMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.X0yU6VRaXNT2ff0TGz2PJNKRuFBuAzNPxJtZDO59vsU\"><img src=\"https://private-user-images.githubusercontent.com/16524922/296937588-e6bf6759-d516-448b-9302-c6aed97a223d.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM0ODksIm5iZiI6MTcxNDk3MzE4OSwicGF0aCI6Ii8xNjUyNDkyMi8yOTY5Mzc1ODgtZTZiZjY3NTktZDUxNi00NDhiLTkzMDItYzZhZWQ5N2EyMjNkLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjYyOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTA5ZmQ4ZTQxM2E4N2Q1MmIzOTFjYjRiMWFhNGYzYTAyNDhlN2UwN2U1YzVkYzQ3ZGQ5ZDcyYWVhYjIwNTZlNmMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.X0yU6VRaXNT2ff0TGz2PJNKRuFBuAzNPxJtZDO59vsU\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21905",
                "createdAt": "2024-01-16T05:07:08Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[wip][fix][fn] Add function name and id to producer name to avoid conflict",
        "url": "https://github.com/apache/pulsar/pull/21912",
        "resourcePath": "/apache/pulsar/pull/21912",
        "createdAt": "2024-01-17T11:16:17Z",
        "number": 21912,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/sink/PulsarSink.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5kTSkO2gAoMjQ3YzRhZjQ5MTAxYTg5NzU1ZDkxYTc3ODE2MmRhOWNjMzNlZmM2Mg",
                "url": "https://github.com/apache/pulsar/pull/21912/commits/247c4af49101a89755d91a778162da9cc33efc62"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21911,
                "url": "https://github.com/apache/pulsar/issues/21911",
                "title": "[Bug] Functions failed to recover after a crash if the input topic is partitioned and function is using `EFFECTIVELY_ONCE`",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">3.1.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>\n<p dir=\"auto\">Create a partitioned topic with partition=5</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-admin topics create-partitioned-topic persistent://public/default/test-topic -p 5\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-admin topics create-partitioned-topic persistent://public/default/test-topic -p 5\n</code></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Create a new Function with replicas=5, and semantic to <code class=\"notranslate\">EFFECTIVELY_ONCE</code>(using k8s runtime or function-mesh)</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-admin functions create --jar /pulsar/examples/api-examples.jar --name test-func --className org.apache.pulsar.functions.api.examples.ExclamationFunction --inputs persistent://public/default/test-topic -o persistent://public/default/test-output --processing-guarantees EFFECTIVELY_ONCE --parallelism 5\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-admin functions create --jar /pulsar/examples/api-examples.jar --name test-func --className org.apache.pulsar.functions.api.examples.ExclamationFunction --inputs persistent://public/default/test-topic -o persistent://public/default/test-output --processing-guarantees EFFECTIVELY_ONCE --parallelism 5\n</code></pre></div>\n</li>\n<li>\n<p dir=\"auto\">After all function pods are running, sending some message to the input topic</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-client produce -m &quot;hello&quot; -n 100 persistent://public/default/test-topic \"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-client produce -m \"hello\" -n 100 persistent://public/default/test-topic \n</code></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Delete 1 function pod, such as pod-0 to simulate crash</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"kubectl delete pod test-func-function-0\"><pre class=\"notranslate\"><code class=\"notranslate\">kubectl delete pod test-func-function-0\n</code></pre></div>\n</li>\n<li>\n<p dir=\"auto\">After the pod-0 restarted, sending messges to the input topic again</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-client produce -m &quot;hello&quot; -n 100 persistent://public/default/test-topic \"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-client produce -m \"hello\" -n 100 persistent://public/default/test-topic \n</code></pre></div>\n</li>\n<li>\n<p dir=\"auto\">Check the status of function pods</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"kubectl get pod\"><pre class=\"notranslate\"><code class=\"notranslate\">kubectl get pod\n</code></pre></div>\n</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">All functions pods are running well</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Some of function pods are keeping restarting</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The reason is that with <code class=\"notranslate\">EFFECTIVELY_ONCE</code> semantic, function pods will subscribe to the input topic using <code class=\"notranslate\">FAILOVER</code> mode, at the beginning, the subscription relation is like below:</p>\n<p dir=\"auto\">pod0 -&gt; partition0<br>\npod1 -&gt; partition1<br>\npod2 -&gt; partition2<br>\npod3 -&gt; partition3<br>\npod4 -&gt; partition4</p>\n<p dir=\"auto\">and when pod-0 is deleted, partition-0 will be assigned to another pod, such as pod-4, then pod-4 will create a producer with partition id like <code class=\"notranslate\">persistent://public/default/test-topic-0-0</code> as the name</p>\n<p dir=\"auto\">then when pod-0 restarted, the pulsar broker will do a \"shuffle\" for the subscription, the relation may look like:</p>\n<p dir=\"auto\">pod0 -&gt; partition0<br>\npod1 -&gt; partition3<br>\npod2 -&gt; partition1<br>\npod3 -&gt; partition4<br>\npod4 -&gt; partition2</p>\n<p dir=\"auto\">when new messages come to partition0, the pod0 cannot create a producer with name <code class=\"notranslate\">persistent://public/default/test-topic-0-0</code> since it's already created in pod4, and so are other pods:</p>\n<ul dir=\"auto\">\n<li>pod1 failed to create producer with name <code class=\"notranslate\">persistent://public/default/test-topic-3-0</code> since it's already created in pod3</li>\n<li>pod2 failed to create producer with name <code class=\"notranslate\">persistent://public/default/test-topic-1-0</code> since it's already created in pod1</li>\n<li>pod3 failed to create producer with name <code class=\"notranslate\">persistent://public/default/test-topic-4-0</code> since it's already created in pod4</li>\n<li>pod4 failed to create producer with name <code class=\"notranslate\">persistent://public/default/test-topic-2-0</code> since it's already created in pod2</li>\n</ul>\n<p dir=\"auto\">as an end, no pods are able to start</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21911",
                "createdAt": "2024-01-17T11:11:25Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Producer uses pulsar-client-internal thread to execute callback",
        "url": "https://github.com/apache/pulsar/pull/21913",
        "resourcePath": "/apache/pulsar/pull/21913",
        "createdAt": "2024-01-17T11:27:33Z",
        "number": 21913,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/ProducerCallbackThreadTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5kTWpj2gAoNjAyMGY0MTE0ZWZjYzYwZjM0YjFjMmFmYzUzMjY1ODIwMzI3MzYyNg",
                "url": "https://github.com/apache/pulsar/pull/21913/commits/6020f4114efcc60f34b1c2afc532658203273626"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21900,
                "url": "https://github.com/apache/pulsar/issues/21900",
                "title": "[Bug] create producer thread stuck",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">pulsar client 3.01.<br>\npulsar broker 3.0.1<br>\npuslar proxy 3.0.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">It is hard to reproduce</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">When you use puslar client to create producer objects synchronously, you can trigger a timeout or other exception normally, rather than the thread staying stuck</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Threads keep getting stuck when creating producer objects synchronously using puslar client. To reproduce it, the pulsar cluster is stopped, and a timeout exception is reported when the produce object is created. Therefore, it is not clear how this situation has arisen. At present, it has appeared many times in the production environment.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/19525691/296653041-6877f5de-8d3a-4a0e-91f7-1e67053cef08.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM0OTksIm5iZiI6MTcxNDk3MzE5OSwicGF0aCI6Ii8xOTUyNTY5MS8yOTY2NTMwNDEtNjg3N2Y1ZGUtOGQzYS00YTBlLTkxZjctMWU2NzA1M2NlZjA4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjYzOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWQ4MWRjNzkwMzEyNjg4NzMyYzA5NDlmMDcxYTMzMzBiY2FiMmFiYWRmZTBlYWYwNGIzYTI4NzAwYzUwZTdkY2ImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.dHPLaAZeD-s1IpIMQH8al7WZXAGPqq55Jp2l90VvfgI\"><img src=\"https://private-user-images.githubusercontent.com/19525691/296653041-6877f5de-8d3a-4a0e-91f7-1e67053cef08.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM0OTksIm5iZiI6MTcxNDk3MzE5OSwicGF0aCI6Ii8xOTUyNTY5MS8yOTY2NTMwNDEtNjg3N2Y1ZGUtOGQzYS00YTBlLTkxZjctMWU2NzA1M2NlZjA4LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjYzOVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWQ4MWRjNzkwMzEyNjg4NzMyYzA5NDlmMDcxYTMzMzBiY2FiMmFiYWRmZTBlYWYwNGIzYTI4NzAwYzUwZTdkY2ImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.dHPLaAZeD-s1IpIMQH8al7WZXAGPqq55Jp2l90VvfgI\" alt=\"\u4f01\u4e1a\u5fae\u4fe1\u622a\u56fe_17047919918562\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21900",
                "createdAt": "2024-01-15T04:24:34Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix deadlock while skip non-recoverable ledgers.",
        "url": "https://github.com/apache/pulsar/pull/21915",
        "resourcePath": "/apache/pulsar/pull/21915",
        "createdAt": "2024-01-18T03:31:58Z",
        "number": 21915,
        "mergeCommit": {
          "oid": "5a65e98a66d4628dd95a0d9602370390eb364039",
          "message": "[fix][broker] Fix deadlock while skip non-recoverable ledgers. (#21915)\n\n### Motivation\r\nThe sequence of events leading to the deadlock when methods from org.apache.bookkeeper.mledger.impl.ManagedCursorImpl are invoked concurrently is as follows:\r\n\r\n1. Thread A calls asyncDelete, which then goes on to internally call internalAsyncMarkDelete. This results in acquiring a lock on pendingMarkDeleteOps through synchronized (pendingMarkDeleteOps).\r\n\r\n2. Inside internalAsyncMarkDelete, internalMarkDelete is called which subsequently calls persistPositionToLedger. At the start of persistPositionToLedger, buildIndividualDeletedMessageRanges is invoked, where it tries to acquire a read lock using lock.readLock().lock(). At this point, if the write lock is being held by another thread, Thread A will block waiting for the read lock.\r\n\r\n3. Concurrently, Thread B executes skipNonRecoverableLedger which first obtains a write lock using lock.writeLock().lock() and then proceeds to call asyncDelete.\r\n\r\n4. At this moment, Thread B already holds the write lock and is attempting to acquire the synchronized lock on pendingMarkDeleteOps that Thread A already holds, while Thread A is waiting for the read lock that Thread B needs to release.\r\n\r\nIn code, the deadlock appears as follows:\r\n\r\nThread A: synchronized (pendingMarkDeleteOps) -> lock.readLock().lock() (waiting)\r\nThread B: lock.writeLock().lock() -> synchronized (pendingMarkDeleteOps) (waiting)\r\n\r\n### Modifications\r\n\r\nAvoid using a long-range lock.\r\n\r\nCo-authored-by: ruihongzhou <ruihongzhou@tencent.com>\r\nCo-authored-by: Jiwe Guo <technoboy@apache.org>\r\nCo-authored-by: Lari Hotari <lhotari@apache.org>",
          "commitUrl": "https://github.com/apache/pulsar/commit/5a65e98a66d4628dd95a0d9602370390eb364039",
          "parents": {
            "nodes": [
              {
                "oid": "153cd5e429fdfbde1266b07f57de692805fed538",
                "message": "[fix][broker] Unify topic-level policies enable judgment conditions (#19501)\n\nCo-authored-by: Jiwe Guo <technoboy@apache.org>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5kYNic2gAoMTNiYjliYmQ5OTUzMTQxMzhiZTIyNDU2MmY2Y2E3YTI2NjU2MThlNQ",
                "url": "https://github.com/apache/pulsar/pull/21915/commits/13bb9bbd995314138be224562f6ca7a2665618e5"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21914,
                "url": "https://github.com/apache/pulsar/issues/21914",
                "title": "[Bug] Deadlock occurs when skipping non-recoverable ledger",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">OS: Linux<br>\nPulsar: 3.0.2</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">There are race conditions here and executing the following two methods in parallel may trigger the deadlock:</p>\n<ul dir=\"auto\">\n<li>org.apache.bookkeeper.mledger.impl.ManagedCursorImpl#skipNonRecoverableLedger</li>\n<li>org.apache.bookkeeper.mledger.impl.ManagedCursorImpl#asyncDelete</li>\n</ul>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">no deadlock</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">deadlock occurs.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"====&gt; DEADLOCKS DETECTED &lt;====\n\n\n&quot;BookKeeperClientWorker-OrderedExecutor-6-0&quot; Id=55 in WAITING on lock=java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync@24e08dc4\n     owned by BookKeeperClientWorker-OrderedExecutor-11-0 Id=60\n    at java.base@17.0.9/jdk.internal.misc.Unsafe.park(Native Method)\n    at java.base@17.0.9/java.util.concurrent.locks.LockSupport.park(LockSupport.java:211)\n    at java.base@17.0.9/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:715)\n    at java.base@17.0.9/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:938)\n    at java.base@17.0.9/java.util.concurrent.locks.ReentrantReadWriteLock$WriteLock.lock(ReentrantReadWriteLock.java:959)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$19.operationComplete(ManagedCursorImpl.java:2130)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.lambda$persistPositionToLedger$40(ManagedCursorImpl.java:3097)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$$Lambda$1497/0x00007febacac5ea8.addComplete(Unknown Source)\n    at app//org.apache.bookkeeper.client.AsyncCallback$AddCallback.addCompleteWithLatency(AsyncCallback.java:92)\n    at app//org.apache.bookkeeper.client.PendingAddOp.submitCallback(PendingAddOp.java:406)\n      - locked org.apache.bookkeeper.client.PendingAddOp@3d914523\n    at app//org.apache.bookkeeper.client.LedgerHandle.sendAddSuccessCallbacks(LedgerHandle.java:1835)\n    at app//org.apache.bookkeeper.client.PendingAddOp.sendAddSuccessCallbacks(PendingAddOp.java:390)\n    at app//org.apache.bookkeeper.client.PendingAddOp.writeComplete(PendingAddOp.java:384)\n      - locked org.apache.bookkeeper.client.PendingAddOp@3d914523\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$AddCompletion.writeComplete(PerChannelBookieClient.java:2183)\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$AddCompletion.handleResponse(PerChannelBookieClient.java:2240)\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$AddCompletion.handleV2Response(PerChannelBookieClient.java:2219)\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$ReadV2ResponseCallback.run(PerChannelBookieClient.java:1397)\n    at app//org.apache.bookkeeper.common.util.SingleThreadExecutor.safeRunTask(SingleThreadExecutor.java:137)\n    at app//org.apache.bookkeeper.common.util.SingleThreadExecutor.run(SingleThreadExecutor.java:113)\n    at app//io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n    at java.base@17.0.9/java.lang.Thread.run(Thread.java:840)\n\n    Locked synchronizers: count = 0\n\n\n\n&quot;BookKeeperClientWorker-OrderedExecutor-11-0&quot; Id=60 in BLOCKED on lock=java.util.ArrayDeque@73a768d4\n     owned by BookKeeperClientWorker-OrderedExecutor-60-0 Id=109\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.internalAsyncMarkDelete(ManagedCursorImpl.java:2036)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncDelete(ManagedCursorImpl.java:2387)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncDelete(ManagedCursorImpl.java:2190)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.skipNonRecoverableLedger(ManagedCursorImpl.java:2779)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.skipNonRecoverableLedger(ManagedLedgerImpl.java:1767)\n    at app//org.apache.bookkeeper.mledger.impl.OpReadEntry.readEntriesFailed(OpReadEntry.java:137)\n    at app//org.apache.bookkeeper.mledger.impl.cache.PendingReadsManager$PendingRead.lambda$attach$2(PendingReadsManager.java:299)\n      - locked org.apache.bookkeeper.mledger.impl.cache.PendingReadsManager$PendingRead@35457076\n    at app//org.apache.bookkeeper.mledger.impl.cache.PendingReadsManager$PendingRead$$Lambda$1476/0x00007febacab88c0.apply(Unknown Source)\n    at java.base@17.0.9/java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:990)\n    at java.base@17.0.9/java.util.concurrent.CompletableFuture$UniExceptionally.tryFire(CompletableFuture.java:974)\n    at java.base@17.0.9/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n    at java.base@17.0.9/java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2162)\n    at app//org.apache.bookkeeper.client.PendingReadOp.submitCallback(PendingReadOp.java:653)\n    at app//org.apache.bookkeeper.client.PendingReadOp$LedgerEntryRequest.fail(PendingReadOp.java:175)\n    at app//org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest.sendNextRead(PendingReadOp.java:396)\n      - locked org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest@1d2d4d48\n    at app//org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest.logErrorAndReattemptRead(PendingReadOp.java:439)\n      - locked org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest@1d2d4d48\n    at app//org.apache.bookkeeper.client.PendingReadOp.readEntryComplete(PendingReadOp.java:594)\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion$1.readEntryComplete(PerChannelBookieClient.java:1885)\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion.handleReadResponse(PerChannelBookieClient.java:1967)\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion.handleV2Response(PerChannelBookieClient.java:1919)\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$ReadV2ResponseCallback.run(PerChannelBookieClient.java:1397)\n    at app//org.apache.bookkeeper.common.util.SingleThreadExecutor.safeRunTask(SingleThreadExecutor.java:137)\n    at app//org.apache.bookkeeper.common.util.SingleThreadExecutor.run(SingleThreadExecutor.java:113)\n    at app//io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n    at java.base@17.0.9/java.lang.Thread.run(Thread.java:840)\n\n    Locked synchronizers: count = 1\n      - java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync@24e08dc4\n\n\n\n&quot;BookKeeperClientWorker-OrderedExecutor-60-0&quot; Id=109 in WAITING on lock=java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync@24e08dc4\n     owned by BookKeeperClientWorker-OrderedExecutor-11-0 Id=60\n    at java.base@17.0.9/jdk.internal.misc.Unsafe.park(Native Method)\n    at java.base@17.0.9/java.util.concurrent.locks.LockSupport.park(LockSupport.java:211)\n    at java.base@17.0.9/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:715)\n    at java.base@17.0.9/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireShared(AbstractQueuedSynchronizer.java:1027)\n    at java.base@17.0.9/java.util.concurrent.locks.ReentrantReadWriteLock$ReadLock.lock(ReentrantReadWriteLock.java:738)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.buildIndividualDeletedMessageRanges(ManagedCursorImpl.java:2987)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.persistPositionToLedger(ManagedCursorImpl.java:3069)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.internalMarkDelete(ManagedCursorImpl.java:2179)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.internalAsyncMarkDelete(ManagedCursorImpl.java:2060)\n      - locked java.util.ArrayDeque@73a768d4\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.internalResetCursor(ManagedCursorImpl.java:1359)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.lambda$asyncResetCursor$15(ManagedCursorImpl.java:1395)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$$Lambda$1540/0x00007febacb19710.run(Unknown Source)\n    at app//org.apache.bookkeeper.common.util.SingleThreadExecutor.safeRunTask(SingleThreadExecutor.java:137)\n    at app//org.apache.bookkeeper.common.util.SingleThreadExecutor.run(SingleThreadExecutor.java:107)\n    at app//io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n    at java.base@17.0.9/java.lang.Thread.run(Thread.java:840)\n\n    Locked synchronizers: count = 0\"><pre class=\"notranslate\"><code class=\"notranslate\">====&gt; DEADLOCKS DETECTED &lt;====\n\n\n\"BookKeeperClientWorker-OrderedExecutor-6-0\" Id=55 in WAITING on lock=java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync@24e08dc4\n     owned by BookKeeperClientWorker-OrderedExecutor-11-0 Id=60\n    at java.base@17.0.9/jdk.internal.misc.Unsafe.park(Native Method)\n    at java.base@17.0.9/java.util.concurrent.locks.LockSupport.park(LockSupport.java:211)\n    at java.base@17.0.9/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:715)\n    at java.base@17.0.9/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:938)\n    at java.base@17.0.9/java.util.concurrent.locks.ReentrantReadWriteLock$WriteLock.lock(ReentrantReadWriteLock.java:959)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$19.operationComplete(ManagedCursorImpl.java:2130)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.lambda$persistPositionToLedger$40(ManagedCursorImpl.java:3097)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$$Lambda$1497/0x00007febacac5ea8.addComplete(Unknown Source)\n    at app//org.apache.bookkeeper.client.AsyncCallback$AddCallback.addCompleteWithLatency(AsyncCallback.java:92)\n    at app//org.apache.bookkeeper.client.PendingAddOp.submitCallback(PendingAddOp.java:406)\n      - locked org.apache.bookkeeper.client.PendingAddOp@3d914523\n    at app//org.apache.bookkeeper.client.LedgerHandle.sendAddSuccessCallbacks(LedgerHandle.java:1835)\n    at app//org.apache.bookkeeper.client.PendingAddOp.sendAddSuccessCallbacks(PendingAddOp.java:390)\n    at app//org.apache.bookkeeper.client.PendingAddOp.writeComplete(PendingAddOp.java:384)\n      - locked org.apache.bookkeeper.client.PendingAddOp@3d914523\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$AddCompletion.writeComplete(PerChannelBookieClient.java:2183)\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$AddCompletion.handleResponse(PerChannelBookieClient.java:2240)\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$AddCompletion.handleV2Response(PerChannelBookieClient.java:2219)\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$ReadV2ResponseCallback.run(PerChannelBookieClient.java:1397)\n    at app//org.apache.bookkeeper.common.util.SingleThreadExecutor.safeRunTask(SingleThreadExecutor.java:137)\n    at app//org.apache.bookkeeper.common.util.SingleThreadExecutor.run(SingleThreadExecutor.java:113)\n    at app//io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n    at java.base@17.0.9/java.lang.Thread.run(Thread.java:840)\n\n    Locked synchronizers: count = 0\n\n\n\n\"BookKeeperClientWorker-OrderedExecutor-11-0\" Id=60 in BLOCKED on lock=java.util.ArrayDeque@73a768d4\n     owned by BookKeeperClientWorker-OrderedExecutor-60-0 Id=109\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.internalAsyncMarkDelete(ManagedCursorImpl.java:2036)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncDelete(ManagedCursorImpl.java:2387)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncDelete(ManagedCursorImpl.java:2190)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.skipNonRecoverableLedger(ManagedCursorImpl.java:2779)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.skipNonRecoverableLedger(ManagedLedgerImpl.java:1767)\n    at app//org.apache.bookkeeper.mledger.impl.OpReadEntry.readEntriesFailed(OpReadEntry.java:137)\n    at app//org.apache.bookkeeper.mledger.impl.cache.PendingReadsManager$PendingRead.lambda$attach$2(PendingReadsManager.java:299)\n      - locked org.apache.bookkeeper.mledger.impl.cache.PendingReadsManager$PendingRead@35457076\n    at app//org.apache.bookkeeper.mledger.impl.cache.PendingReadsManager$PendingRead$$Lambda$1476/0x00007febacab88c0.apply(Unknown Source)\n    at java.base@17.0.9/java.util.concurrent.CompletableFuture.uniExceptionally(CompletableFuture.java:990)\n    at java.base@17.0.9/java.util.concurrent.CompletableFuture$UniExceptionally.tryFire(CompletableFuture.java:974)\n    at java.base@17.0.9/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n    at java.base@17.0.9/java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2162)\n    at app//org.apache.bookkeeper.client.PendingReadOp.submitCallback(PendingReadOp.java:653)\n    at app//org.apache.bookkeeper.client.PendingReadOp$LedgerEntryRequest.fail(PendingReadOp.java:175)\n    at app//org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest.sendNextRead(PendingReadOp.java:396)\n      - locked org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest@1d2d4d48\n    at app//org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest.logErrorAndReattemptRead(PendingReadOp.java:439)\n      - locked org.apache.bookkeeper.client.PendingReadOp$SequenceReadRequest@1d2d4d48\n    at app//org.apache.bookkeeper.client.PendingReadOp.readEntryComplete(PendingReadOp.java:594)\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion$1.readEntryComplete(PerChannelBookieClient.java:1885)\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion.handleReadResponse(PerChannelBookieClient.java:1967)\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$ReadCompletion.handleV2Response(PerChannelBookieClient.java:1919)\n    at app//org.apache.bookkeeper.proto.PerChannelBookieClient$ReadV2ResponseCallback.run(PerChannelBookieClient.java:1397)\n    at app//org.apache.bookkeeper.common.util.SingleThreadExecutor.safeRunTask(SingleThreadExecutor.java:137)\n    at app//org.apache.bookkeeper.common.util.SingleThreadExecutor.run(SingleThreadExecutor.java:113)\n    at app//io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n    at java.base@17.0.9/java.lang.Thread.run(Thread.java:840)\n\n    Locked synchronizers: count = 1\n      - java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync@24e08dc4\n\n\n\n\"BookKeeperClientWorker-OrderedExecutor-60-0\" Id=109 in WAITING on lock=java.util.concurrent.locks.ReentrantReadWriteLock$NonfairSync@24e08dc4\n     owned by BookKeeperClientWorker-OrderedExecutor-11-0 Id=60\n    at java.base@17.0.9/jdk.internal.misc.Unsafe.park(Native Method)\n    at java.base@17.0.9/java.util.concurrent.locks.LockSupport.park(LockSupport.java:211)\n    at java.base@17.0.9/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquire(AbstractQueuedSynchronizer.java:715)\n    at java.base@17.0.9/java.util.concurrent.locks.AbstractQueuedSynchronizer.acquireShared(AbstractQueuedSynchronizer.java:1027)\n    at java.base@17.0.9/java.util.concurrent.locks.ReentrantReadWriteLock$ReadLock.lock(ReentrantReadWriteLock.java:738)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.buildIndividualDeletedMessageRanges(ManagedCursorImpl.java:2987)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.persistPositionToLedger(ManagedCursorImpl.java:3069)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.internalMarkDelete(ManagedCursorImpl.java:2179)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.internalAsyncMarkDelete(ManagedCursorImpl.java:2060)\n      - locked java.util.ArrayDeque@73a768d4\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.internalResetCursor(ManagedCursorImpl.java:1359)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.lambda$asyncResetCursor$15(ManagedCursorImpl.java:1395)\n    at app//org.apache.bookkeeper.mledger.impl.ManagedCursorImpl$$Lambda$1540/0x00007febacb19710.run(Unknown Source)\n    at app//org.apache.bookkeeper.common.util.SingleThreadExecutor.safeRunTask(SingleThreadExecutor.java:137)\n    at app//org.apache.bookkeeper.common.util.SingleThreadExecutor.run(SingleThreadExecutor.java:107)\n    at app//io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n    at java.base@17.0.9/java.lang.Thread.run(Thread.java:840)\n\n    Locked synchronizers: count = 0\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The sequence of events leading to the deadlock when methods from org.apache.bookkeeper.mledger.impl.ManagedCursorImpl are invoked concurrently is as follows:</p>\n<ol dir=\"auto\">\n<li>\n<p dir=\"auto\">Thread A calls asyncDelete, which then goes on to internally call internalAsyncMarkDelete. This results in acquiring a lock on pendingMarkDeleteOps through synchronized (pendingMarkDeleteOps).</p>\n</li>\n<li>\n<p dir=\"auto\">Inside internalAsyncMarkDelete, internalMarkDelete is called which subsequently calls persistPositionToLedger. At the start of persistPositionToLedger, buildIndividualDeletedMessageRanges is invoked, where it tries to acquire a read lock using lock.readLock().lock(). At this point, if the write lock is being held by another thread, Thread A will block waiting for the read lock.</p>\n</li>\n<li>\n<p dir=\"auto\">Concurrently, Thread B executes skipNonRecoverableLedger which first obtains a write lock using lock.writeLock().lock() and then proceeds to call asyncDelete.</p>\n</li>\n<li>\n<p dir=\"auto\">At this moment, Thread B already holds the write lock and is attempting to acquire the synchronized lock on pendingMarkDeleteOps that Thread A already holds, while Thread A is waiting for the read lock that Thread B needs to release.</p>\n</li>\n</ol>\n<p dir=\"auto\">In code, the deadlock appears as follows:</p>\n<p dir=\"auto\">Thread A: synchronized (pendingMarkDeleteOps) -&gt; lock.readLock().lock() (waiting)<br>\nThread B: lock.writeLock().lock() -&gt; synchronized (pendingMarkDeleteOps) (waiting)</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21914",
                "createdAt": "2024-01-18T03:14:21Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [broker] fix write all compacted out entry into compacted topic",
        "url": "https://github.com/apache/pulsar/pull/21917",
        "resourcePath": "/apache/pulsar/pull/21917",
        "createdAt": "2024-01-18T07:17:44Z",
        "number": 21917,
        "mergeCommit": {
          "oid": "40eebc0a9eb9352ba31bca0d20d471f16a5515a9",
          "message": "[fix] [broker] Fix write all compacted out entry into compacted topic (#21917)",
          "commitUrl": "https://github.com/apache/pulsar/commit/40eebc0a9eb9352ba31bca0d20d471f16a5515a9",
          "parents": {
            "nodes": [
              {
                "oid": "5cb12a57d6fa9ee2a611c5b1ef7db780fb57ade5",
                "message": "[fix][broker] Fix issue with GetMessageIdByTimestamp can't find match messageId from compacted ledger (#21600)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/client/impl/RawBatchConverter.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/compaction/CompactorTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5kZFOH2gAoNmRlZjY2NjU5ZDNhNDQzNjI4OTM4NDQyYWIyMGE3ZjZiNmZlNDZmZQ",
                "url": "https://github.com/apache/pulsar/pull/21917/commits/6def66659d3a443628938442ab20a7f6b6fe46fe"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21916,
                "url": "https://github.com/apache/pulsar/issues/21916",
                "title": "[Bug] [broker] empty entry writed into the compacted topic",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.9</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">stack:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"18:00:50.888 [pulsar-transaction-executor-17-1] ERROR org.apache.pulsar.broker.transaction.buffer.impl.TopicTransactionBuffer - [persistent://public/default/g-partition-0] Transaction buffer recover fail by read transactionBufferSnapshot timeout!\njava.util.concurrent.TimeoutException: null\n        at java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1886) ~[?:?]\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2021) ~[?:?]\n        at org.apache.pulsar.broker.transaction.buffer.impl.TopicTransactionBuffer$TopicTransactionBufferRecover.lambda$run$0(TopicTransactionBuffer.java:692) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:714) ~[?:?]\n        at java.util.concurrent.CompletableFuture$Completion.run(CompletableFuture.java:478) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.66.Final.jar:4.1.66.Final]\n        at java.lang.Thread.run(Thread.java:834) ~[?:?]\n18:00:50.888 [pulsar-transaction-executor-17-1] WARN  org.apache.pulsar.broker.transaction.buffer.impl.TopicTransactionBuffer - Closing topic persistent://public/default/g-partition-0 due to read transaction buffer snapshot while recovering the transaction buffer throw exception\norg.apache.pulsar.broker.service.BrokerServiceException$ServiceUnitNotReadyException: [persistent://public/default/g-partition-0] Transaction buffer recover fail by read transactionBufferSnapshot timeout!\n        at org.apache.pulsar.broker.transaction.buffer.impl.TopicTransactionBuffer$TopicTransactionBufferRecover.lambda$run$0(TopicTransactionBuffer.java:713) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:714) ~[?:?]\n        at java.util.concurrent.CompletableFuture$Completion.run(CompletableFuture.java:478) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.66.Final.jar:4.1.66.Final]\n        at java.lang.Thread.run(Thread.java:834) ~[?:?]\nCaused by: java.util.concurrent.TimeoutException\n        at java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1886) ~[?:?]\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2021) ~[?:?]\n        at org.apache.pulsar.broker.transaction.buffer.impl.TopicTransactionBuffer$TopicTransactionBufferRecover.lambda$run$0(TopicTransactionBuffer.java:692) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        ... 6 more\n\n18:00:51.189 [pulsar-io-32-32] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/__transaction_buffer_snapshot-partition-2] [multiTopicsReader-ef4f7acfd4] Closed consumer\"><pre class=\"notranslate\"><code class=\"notranslate\">18:00:50.888 [pulsar-transaction-executor-17-1] ERROR org.apache.pulsar.broker.transaction.buffer.impl.TopicTransactionBuffer - [persistent://public/default/g-partition-0] Transaction buffer recover fail by read transactionBufferSnapshot timeout!\njava.util.concurrent.TimeoutException: null\n        at java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1886) ~[?:?]\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2021) ~[?:?]\n        at org.apache.pulsar.broker.transaction.buffer.impl.TopicTransactionBuffer$TopicTransactionBufferRecover.lambda$run$0(TopicTransactionBuffer.java:692) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:714) ~[?:?]\n        at java.util.concurrent.CompletableFuture$Completion.run(CompletableFuture.java:478) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.66.Final.jar:4.1.66.Final]\n        at java.lang.Thread.run(Thread.java:834) ~[?:?]\n18:00:50.888 [pulsar-transaction-executor-17-1] WARN  org.apache.pulsar.broker.transaction.buffer.impl.TopicTransactionBuffer - Closing topic persistent://public/default/g-partition-0 due to read transaction buffer snapshot while recovering the transaction buffer throw exception\norg.apache.pulsar.broker.service.BrokerServiceException$ServiceUnitNotReadyException: [persistent://public/default/g-partition-0] Transaction buffer recover fail by read transactionBufferSnapshot timeout!\n        at org.apache.pulsar.broker.transaction.buffer.impl.TopicTransactionBuffer$TopicTransactionBufferRecover.lambda$run$0(TopicTransactionBuffer.java:713) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        at java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java:714) ~[?:?]\n        at java.util.concurrent.CompletableFuture$Completion.run(CompletableFuture.java:478) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) ~[?:?]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.66.Final.jar:4.1.66.Final]\n        at java.lang.Thread.run(Thread.java:834) ~[?:?]\nCaused by: java.util.concurrent.TimeoutException\n        at java.util.concurrent.CompletableFuture.timedGet(CompletableFuture.java:1886) ~[?:?]\n        at java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2021) ~[?:?]\n        at org.apache.pulsar.broker.transaction.buffer.impl.TopicTransactionBuffer$TopicTransactionBufferRecover.lambda$run$0(TopicTransactionBuffer.java:692) ~[org.apache.pulsar-pulsar-broker-2.9.5.4.jar:2.9.5.4]\n        ... 6 more\n\n18:00:51.189 [pulsar-io-32-32] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/__transaction_buffer_snapshot-partition-2] [multiTopicsReader-ef4f7acfd4] Closed consumer\n</code></pre></div>\n<p dir=\"auto\">topic snapshot recover fail and can't server for client because of the timeout exception for read. But why the read operation will time out? I find that the method <code class=\"notranslate\">reader.hasMessageAvailable()</code> return true, but <code class=\"notranslate\">reader.readNext</code> can't return any messages.</p>\n<p dir=\"auto\">Further, i notice that the reader try to read messages from compacted topic because there is no content in the normal topic backlog. so i find out the compacted ledger id as follows:</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/52550727/297650320-aac6de79-c5c7-4dac-a6b4-ec906f046fde.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM1MDQsIm5iZiI6MTcxNDk3MzIwNCwicGF0aCI6Ii81MjU1MDcyNy8yOTc2NTAzMjAtYWFjNmRlNzktYzVjNy00ZGFjLWE2YjQtZWM5MDZmMDQ2ZmRlLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjY0NFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTE2YmIwNzI2Mjc5MDdhYWRjOGJlMzQ0Y2M0MWYwOWU1NjU0OThmN2YxNjRkZWE1YTg4MjJhY2IxMGI0Y2ZmN2YmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.Isu6n0ueKc6Ln_wm4ctFH0qa5gE1rbM2AE5EJlzVzuQ\"><img src=\"https://private-user-images.githubusercontent.com/52550727/297650320-aac6de79-c5c7-4dac-a6b4-ec906f046fde.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM1MDQsIm5iZiI6MTcxNDk3MzIwNCwicGF0aCI6Ii81MjU1MDcyNy8yOTc2NTAzMjAtYWFjNmRlNzktYzVjNy00ZGFjLWE2YjQtZWM5MDZmMDQ2ZmRlLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjY0NFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTE2YmIwNzI2Mjc5MDdhYWRjOGJlMzQ0Y2M0MWYwOWU1NjU0OThmN2YxNjRkZWE1YTg4MjJhY2IxMGI0Y2ZmN2YmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.Isu6n0ueKc6Ln_wm4ctFH0qa5gE1rbM2AE5EJlzVzuQ\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">I read out the entry of compacted ledger from bookie and deserialize the data, find out that all messages in these 6 entry are <code class=\"notranslate\">compacted out</code>, which means there is no payload in it and will be dropped by client automatically.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/52550727/297651551-f74adfde-8d31-41ad-ae11-2786a4b624e9.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM1MDQsIm5iZiI6MTcxNDk3MzIwNCwicGF0aCI6Ii81MjU1MDcyNy8yOTc2NTE1NTEtZjc0YWRmZGUtOGQzMS00MWFkLWFlMTEtMjc4NmE0YjYyNGU5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjY0NFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTE5NWI1MWU1N2EwYTJkM2FkZGZhZjE4OTM0NDRlMmEwOWUwYTc0MmViYzJjMDFiYzAyYWVhYjRiZGM1MjhjYzMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.NXIs1uzm2xYEaXR1MYIo9FBg_Ik_osQzHU_pckDK6vo\"><img src=\"https://private-user-images.githubusercontent.com/52550727/297651551-f74adfde-8d31-41ad-ae11-2786a4b624e9.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM1MDQsIm5iZiI6MTcxNDk3MzIwNCwicGF0aCI6Ii81MjU1MDcyNy8yOTc2NTE1NTEtZjc0YWRmZGUtOGQzMS00MWFkLWFlMTEtMjc4NmE0YjYyNGU5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjY0NFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTE5NWI1MWU1N2EwYTJkM2FkZGZhZjE4OTM0NDRlMmEwOWUwYTc0MmViYzJjMDFiYzAyYWVhYjRiZGM1MjhjYzMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.NXIs1uzm2xYEaXR1MYIo9FBg_Ik_osQzHU_pckDK6vo\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">So <strong>the reason of the problem is clear:</strong> <code class=\"notranslate\">reader.hasMessageAvailable()</code> get the last message id in the compacted topic, which may be a completely <code class=\"notranslate\">compacted out</code> message, the code pass through the <code class=\"notranslate\">reader.hasMessageAvailable()</code> check, but it will not receive any valid data, so the topic recovery code stuck.</p>\n<p dir=\"auto\">But all messages in one entry is compacted out is beyond expect, because we have some filtering logic in <code class=\"notranslate\">org.apache.pulsar.client.impl.RawBatchConverter#rebatchMessage</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"            if (messagesRetained &gt; 0) {\n                ...\n                return result;\n            } else {\n                return Optional.empty();\n            }\"><pre class=\"notranslate\"><code class=\"notranslate\">            if (messagesRetained &gt; 0) {\n                ...\n                return result;\n            } else {\n                return Optional.empty();\n            }\n</code></pre></div>\n<p dir=\"auto\">If all messages in one entry is compacted out, we the variable <code class=\"notranslate\">messagesRetained</code> should 0, and we should return an empty message back to write.<br>\nBut it did exist some entries with all compacted messages! So there must be a bug in it.</p>\n<p dir=\"auto\">I find out a bug that can result into this situations:</p>\n<ul dir=\"auto\">\n<li>At the first time of compaction, we write a entry with some valid messages and some compacted messages, such as</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Entry1{ msg1{payload}, msg2{empty}}\"><pre class=\"notranslate\"><code class=\"notranslate\">Entry1{ msg1{payload}, msg2{empty}}\n</code></pre></div>\n<ul dir=\"auto\">\n<li>At the second time of compaction, we read <code class=\"notranslate\">Entry1</code> and find that the <code class=\"notranslate\">msg1</code> need to be compacted, so we execute</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Commands.serializeSingleMessageInBatchWithPayload(emptyMetadata,\n                                                                      Unpooled.EMPTY_BUFFER, batchBuffer);\"><pre class=\"notranslate\"><code class=\"notranslate\">Commands.serializeSingleMessageInBatchWithPayload(emptyMetadata,\n                                                                      Unpooled.EMPTY_BUFFER, batchBuffer);\n</code></pre></div>\n<p dir=\"auto\">and keep <code class=\"notranslate\">messagesRetained</code> be 0. Then we meet <code class=\"notranslate\">msg2{empty}</code>, <strong>it do not have the partition key as well!</strong> For example:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/52550727/297653735-c06116f8-70ee-440c-aaff-571b1be89e59.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM1MDQsIm5iZiI6MTcxNDk3MzIwNCwicGF0aCI6Ii81MjU1MDcyNy8yOTc2NTM3MzUtYzA2MTE2ZjgtNzBlZS00NDBjLWFhZmYtNTcxYjFiZTg5ZTU5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjY0NFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWZhNWM3MWI1OWIyNDY2NzI2M2FjZTYzYjc0NjNlODYwNzJlMGI2MzliODQwYTU4MDNlOGIzMjc3MjMzMGQ4ZWMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.yb0v07paAfS7JnEDpFsaDOIruHDxgUUBAROKmkRPKj4\"><img src=\"https://private-user-images.githubusercontent.com/52550727/297653735-c06116f8-70ee-440c-aaff-571b1be89e59.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM1MDQsIm5iZiI6MTcxNDk3MzIwNCwicGF0aCI6Ii81MjU1MDcyNy8yOTc2NTM3MzUtYzA2MTE2ZjgtNzBlZS00NDBjLWFhZmYtNTcxYjFiZTg5ZTU5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjY0NFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWZhNWM3MWI1OWIyNDY2NzI2M2FjZTYzYjc0NjNlODYwNzJlMGI2MzliODQwYTU4MDNlOGIzMjc3MjMzMGQ4ZWMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.yb0v07paAfS7JnEDpFsaDOIruHDxgUUBAROKmkRPKj4\" alt=\"image\" style=\"max-width: 100%;\"></a><br>\nSo we enter following logic:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"                if (!singleMessageMetadata.hasPartitionKey()) {\n                    messagesRetained++;\n                    Commands.serializeSingleMessageInBatchWithPayload(singleMessageMetadata,\n                                                                      singleMessagePayload, batchBuffer);\n                }\"><pre class=\"notranslate\"><code class=\"notranslate\">                if (!singleMessageMetadata.hasPartitionKey()) {\n                    messagesRetained++;\n                    Commands.serializeSingleMessageInBatchWithPayload(singleMessageMetadata,\n                                                                      singleMessagePayload, batchBuffer);\n                }\n</code></pre></div>\n<p dir=\"auto\">We increment the <code class=\"notranslate\">messagesRetained</code> but we write a empty payload! As the <code class=\"notranslate\">messagesRetained</code> is greater than 0, we pass through the check of <code class=\"notranslate\">messagesRetained</code>, we write such a empty entry into the compacted topic.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">~</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">~</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21916",
                "createdAt": "2024-01-18T07:13:23Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[FIX][broker]Fix the issue of incorrect publish time obtained through admin api when encountering anomalies in the broker's timezone.",
        "url": "https://github.com/apache/pulsar/pull/21920",
        "resourcePath": "/apache/pulsar/pull/21920",
        "createdAt": "2024-01-18T11:01:35Z",
        "number": 21920,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/TopicsImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5kaWqV2gAoNjY3MGU0NTFhZmRmYWNhYmYzOWMwN2UzZmNiZDkxZDRhYmZlODZlNQ",
                "url": "https://github.com/apache/pulsar/pull/21920/commits/6670e451afdfacabf39c07e3fcbd91d4abfe86e5"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21891,
                "url": "https://github.com/apache/pulsar/issues/21891",
                "title": "[Bug] The method PulsarAdmin.topics().getMessageById().getPublishTime() returns wrong timestamp when the timezones between broker and client are different.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Nothing with. OS and Pulsar version.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>The broker and the admin client use different timezone while the producer and the admin client use the same timezone;</li>\n<li>Produce one message to pulsar and keep the message id;</li>\n<li>Invoke PulsarAdmin.topics().getMessageById().getPublishTime() to get the publish time of corresponding message, you may find that it is different with the origin publish time created by producer.</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Get correct publish time through admin client though timezones between client and broker are different.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<ul dir=\"auto\">\n<li>There is a  time format operation in org.apache.pulsar.broker.admin.impl.PersistentTopicsBase.java</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"...\nif (metadata.hasPublishTime()) {\n    responseBuilder.header(&quot;X-Pulsar-publish-time&quot;, DateFormatter.format(metadata.getPublishTime()));\n}\n...\"><pre class=\"notranslate\"><code class=\"notranslate\">...\nif (metadata.hasPublishTime()) {\n    responseBuilder.header(\"X-Pulsar-publish-time\", DateFormatter.format(metadata.getPublishTime()));\n}\n...\n</code></pre></div>\n<ul dir=\"auto\">\n<li>There is also a time format operation in org.apache.pulsar.client.admin.internal.TopicsImpl.java</li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"...\nObject tmp = headers.getFirst(PUBLISH_TIME);\nif (tmp != null) {\n    messageMetadata.setPublishTime(DateFormatter.parse(tmp.toString()));\n}\n...\"><pre class=\"notranslate\"><code class=\"notranslate\">...\nObject tmp = headers.getFirst(PUBLISH_TIME);\nif (tmp != null) {\n    messageMetadata.setPublishTime(DateFormatter.parse(tmp.toString()));\n}\n...\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21891",
                "createdAt": "2024-01-12T09:04:34Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Use unified PackageManagement service to download packages",
        "url": "https://github.com/apache/pulsar/pull/21955",
        "resourcePath": "/apache/pulsar/pull/21955",
        "createdAt": "2024-01-23T08:09:12Z",
        "number": 21955,
        "mergeCommit": {
          "oid": "d3b7ca5e964216bc52c436ebeb88357a0aed5948",
          "message": "[fix][fn] Use unified PackageManagement service to download packages (#21955)",
          "commitUrl": "https://github.com/apache/pulsar/commit/d3b7ca5e964216bc52c436ebeb88357a0aed5948",
          "parents": {
            "nodes": [
              {
                "oid": "a702e5a582eaa8292720f9e25fc2dcf858078813",
                "message": "[improve] [test] Remove redudant test code (#21999)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/rest/api/ComponentImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5kzhY62gAoZjc0OWU1NzBiYTQ3YjlkOTNjY2M2NDRhZDI0ZjZjMGZlMTFhYmFhZg",
                "url": "https://github.com/apache/pulsar/pull/21955/commits/f749e570ba47b9d93ccc644ad24f6c0fe11abaaf"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21931,
                "url": "https://github.com/apache/pulsar/issues/21931",
                "title": "[Bug] Update function using package manager response 400 Bad Request",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.11.3</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ul dir=\"auto\">\n<li>Create a function using package from package manager</li>\n<li>Update the function (ex: change parallelism from 1 to 2)</li>\n</ul>\n<p dir=\"auto\">Example payload:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"------WebKitFormBoundary6hEdIldTcUATSkDo\nContent-Disposition: form-data; name=&quot;functionConfig&quot;; filename=&quot;blob&quot;\nContent-Type: application/json\n\n{&quot;parallelism&quot;:1,&quot;cleanupSubscription&quot;:true}\n------WebKitFormBoundary6hEdIldTcUATSkDo--\"><pre class=\"notranslate\"><code class=\"notranslate\">------WebKitFormBoundary6hEdIldTcUATSkDo\nContent-Disposition: form-data; name=\"functionConfig\"; filename=\"blob\"\nContent-Type: application/json\n\n{\"parallelism\":1,\"cleanupSubscription\":true}\n------WebKitFormBoundary6hEdIldTcUATSkDo--\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Response 200 and function successfully updated</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Response 400 with error:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{\n    &quot;reason&quot;: &quot;Invalid stream name : 'Invalid log name \\&quot;/function://public/default/package-pulsar@82804.0\\&quot; caused by empty node name specified @11'&quot;\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">{\n    \"reason\": \"Invalid stream name : 'Invalid log name \\\"/function://public/default/package-pulsar@82804.0\\\" caused by empty node name specified @11'\"\n}\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">This does not happen when update a function which is not using package from package manager (package manager disabled)</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21931",
                "createdAt": "2024-01-19T08:45:01Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [broker] make rest api PersistentTopic#getLastMessageId consistent with binary api ServerCnx#handleGetLastMessageId",
        "url": "https://github.com/apache/pulsar/pull/21967",
        "resourcePath": "/apache/pulsar/pull/21967",
        "createdAt": "2024-01-25T09:15:14Z",
        "number": 21967,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/compaction/GetLastMessageIdCompactedTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5lCldN2gAoZWI2YTMyNzhlOTc5MDM0MmE1MTcyMTFmNTg1MTA1OTkxODFhZTZmMw",
                "url": "https://github.com/apache/pulsar/pull/21967/commits/eb6a3278e9790342a517211f58510599181ae6f3"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21968,
                "url": "https://github.com/apache/pulsar/issues/21968",
                "title": "[Bug] [broker] incorrect last message id from rest api",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">The last message id from binary protocal is <code class=\"notranslate\">1947495:17782</code>.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"17:42:35.775 [main] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/__transaction_buffer_snapshot-partition-2][multiTopicsReader-3b0ae499b9] Get topic last message Id\n17:42:35.781 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/__transaction_buffer_snapshot-partition-2][multiTopicsReader-3b0ae499b9] Successfully getLastMessageId 1947495:17782\"><pre class=\"notranslate\"><code class=\"notranslate\">17:42:35.775 [main] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/__transaction_buffer_snapshot-partition-2][multiTopicsReader-3b0ae499b9] Get topic last message Id\n17:42:35.781 [pulsar-client-io-1-1] INFO  org.apache.pulsar.client.impl.ConsumerImpl - [persistent://public/default/__transaction_buffer_snapshot-partition-2][multiTopicsReader-3b0ae499b9] Successfully getLastMessageId 1947495:17782\n</code></pre></div>\n<p dir=\"auto\">But the  last message id from rest api is <code class=\"notranslate\">269185:-1</code><br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/52550727/299605442-f600143a-aec6-4bac-8c2b-b513d0b1f25a.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM1NzMsIm5iZiI6MTcxNDk3MzI3MywicGF0aCI6Ii81MjU1MDcyNy8yOTk2MDU0NDItZjYwMDE0M2EtYWVjNi00YmFjLThjMmItYjUxM2QwYjFmMjVhLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1Mjc1M1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTU3NGRlNmNiYzgzYTc5N2U5ZDVjMmM0NzMxMWQyN2Y5NzIxYTI4M2VhYjViYWNkZmM0Yjc3MTdlYzJkZDNhMmEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.HwqFVX1mpZLTNK5K_gvGP0LG1zrItwY3UCcVjUWR7_M\"><img width=\"219\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/52550727/299605442-f600143a-aec6-4bac-8c2b-b513d0b1f25a.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM1NzMsIm5iZiI6MTcxNDk3MzI3MywicGF0aCI6Ii81MjU1MDcyNy8yOTk2MDU0NDItZjYwMDE0M2EtYWVjNi00YmFjLThjMmItYjUxM2QwYjFmMjVhLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1Mjc1M1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTU3NGRlNmNiYzgzYTc5N2U5ZDVjMmM0NzMxMWQyN2Y5NzIxYTI4M2VhYjViYWNkZmM0Yjc3MTdlYzJkZDNhMmEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.HwqFVX1mpZLTNK5K_gvGP0LG1zrItwY3UCcVjUWR7_M\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21968",
                "createdAt": "2024-01-25T09:20:59Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][client] Mention partitioning in failover priorityLevel javaDoc",
        "url": "https://github.com/apache/pulsar/pull/21980",
        "resourcePath": "/apache/pulsar/pull/21980",
        "createdAt": "2024-01-27T18:51:17Z",
        "number": 21980,
        "mergeCommit": {
          "oid": "9c7716ce12b1905cbe4c95fb87a623c70b694085",
          "message": "[improve][client] Mention partitioning in failover priorityLevel javaDoc (#21980)\n\nCo-authored-by: Matteo Merli <mmerli@apache.org>",
          "commitUrl": "https://github.com/apache/pulsar/commit/9c7716ce12b1905cbe4c95fb87a623c70b694085",
          "parents": {
            "nodes": [
              {
                "oid": "5dfdcb7b0491bc799b02eb2035579c6072b18415",
                "message": "[fix] [test] Fix flaky test testPerTopicExpiredStat (#22018)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/ConsumerBuilder.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5lO9qB2gAoZDFhZDUzOGFlZGM2ZjI1MGM0MTgwODM0YzAzZDhjMTg5ZjIwMzZiNA",
                "url": "https://github.com/apache/pulsar/pull/21980/commits/d1ad538aedc6f250c4180834c03d8c189f2036b4"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21922,
                "url": "https://github.com/apache/pulsar/issues/21922",
                "title": "[Doc] Priority level documentation incomplete and potentially misleading",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">What issue do you find in Pulsar docs?</h3>\n<p dir=\"auto\">The reference documentation for priority level for the Java SDK at least (<a href=\"https://github.com/apache/pulsar/blob/master/pulsar-client-api/src/main/java/org/apache/pulsar/client/api/ConsumerBuilder.java#L536\">https://github.com/apache/pulsar/blob/master/pulsar-client-api/src/main/java/org/apache/pulsar/client/api/ConsumerBuilder.java#L536</a>) omits prerequisites around topic partitioning for failover subscriptions</p>\n<h3 dir=\"auto\">What is your suggestion?</h3>\n<p dir=\"auto\">Qualify that at least the Failover subscription behavior only applies to partitioned topics (i.e.<br>\n<code class=\"notranslate\">&lt;p&gt;&lt;b&gt;Failover subscription &lt;em&gt;for partitioned topics&lt;/em&gt;&lt;/b&gt;&lt;/p&gt;</code>)</p>\n<h3 dir=\"auto\">Any reference?</h3>\n<ul dir=\"auto\">\n<li>non-partitioned failover behavior comment:<br>\n<a href=\"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractDispatcherSingleActiveConsumer.java#L96\">https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractDispatcherSingleActiveConsumer.java#L96</a></li>\n</ul>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21922",
                "createdAt": "2024-01-18T14:10:12Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "doc"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Fix ConsumerBuilderImpl#subscribe silent stuck when using pulsar-client:3.0.x with jackson-annotations prior to 2.12.0",
        "url": "https://github.com/apache/pulsar/pull/21985",
        "resourcePath": "/apache/pulsar/pull/21985",
        "createdAt": "2024-01-29T04:06:19Z",
        "number": 21985,
        "mergeCommit": {
          "oid": "63f016825a6c833e5a59041902711aced082415d",
          "message": "[fix][client] Fix ConsumerBuilderImpl#subscribe silent stuck when using pulsar-client:3.0.x with jackson-annotations prior to 2.12.0 (#21985)\n\n### Motivation\r\nIn summary, `jackson-annotations:2.12.0` or later is now required for `pulsar-client 3.0.x`, and this also applies to versions `3.1.x` and `3.2.x`.\r\n\r\nOtherwise, `ConsumerBuilderImpl#subscribe` may become stuck without displaying any error message.\r\n\r\n### Modifications\r\n\r\nModify the `whenComplete` to a combination of `thenAccept` and `exceptionally`. The modification is harmless.",
          "commitUrl": "https://github.com/apache/pulsar/commit/63f016825a6c833e5a59041902711aced082415d",
          "parents": {
            "nodes": [
              {
                "oid": "1b4127a6b39cb57c3a9cceb4e05ee5cdb6104c78",
                "message": "[fix][broker] Fix schema deletion error when deleting a partitioned topic with many partitions and schema (#21977)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5lRyTC2gAoMjdhMzFhOGIxZTIxYzMzYWNjNWUyNjM4MDZhZmQ0ZjliYTU2MDliOA",
                "url": "https://github.com/apache/pulsar/pull/21985/commits/27a31a8b1e21c33acc5e263806afd4f9ba5609b8"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21971,
                "url": "https://github.com/apache/pulsar/issues/21971",
                "title": "ConsumerBuilderImpl#subscribe stuck when using pulsar-client:3.0.x with jackson-annotations prior to 2.12.0",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">In summary, <code class=\"notranslate\">jackson-annotations:2.12.0</code> or later is now required for <code class=\"notranslate\">pulsar-client 3.0.x</code>, and this also applies to versions 3.1.x and 3.2.x.</p>\n<p dir=\"auto\">My colleague experienced an issue where the caller thread was blocked at the <code class=\"notranslate\">ConsumerBuilder#subscribe</code> method. Below is the stack trace:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&quot;main&quot; #1 prio=5 os_prio=0 cpu=18400.66ms elapsed=241.20s tid=0x00007f0fd0017800 nid=0x10 waiting on condition  [0x00007f0fd7f17000]\n   java.lang.Thread.State: WAITING (parking)\n\tat jdk.internal.misc.Unsafe.park(java.base@11.0.2/Native Method)\n\t- parking to wait for  &lt;0x00000000f10134d8&gt; (a java.util.concurrent.CompletableFuture$Signaller)\n\tat java.util.concurrent.locks.LockSupport.park(java.base@11.0.2/LockSupport.java:194)\n\tat java.util.concurrent.CompletableFuture$Signaller.block(java.base@11.0.2/CompletableFuture.java:1796)\n\tat java.util.concurrent.ForkJoinPool.managedBlock(java.base@11.0.2/ForkJoinPool.java:3128)\n\tat java.util.concurrent.CompletableFuture.waitingGet(java.base@11.0.2/CompletableFuture.java:1823)\n\tat java.util.concurrent.CompletableFuture.get(java.base@11.0.2/CompletableFuture.java:1998)\n\tat org.apache.pulsar.client.impl.ConsumerBuilderImpl.subscribe(ConsumerBuilderImpl.java:101)\"><pre class=\"notranslate\"><code class=\"notranslate\">\"main\" #1 prio=5 os_prio=0 cpu=18400.66ms elapsed=241.20s tid=0x00007f0fd0017800 nid=0x10 waiting on condition  [0x00007f0fd7f17000]\n   java.lang.Thread.State: WAITING (parking)\n\tat jdk.internal.misc.Unsafe.park(java.base@11.0.2/Native Method)\n\t- parking to wait for  &lt;0x00000000f10134d8&gt; (a java.util.concurrent.CompletableFuture$Signaller)\n\tat java.util.concurrent.locks.LockSupport.park(java.base@11.0.2/LockSupport.java:194)\n\tat java.util.concurrent.CompletableFuture$Signaller.block(java.base@11.0.2/CompletableFuture.java:1796)\n\tat java.util.concurrent.ForkJoinPool.managedBlock(java.base@11.0.2/ForkJoinPool.java:3128)\n\tat java.util.concurrent.CompletableFuture.waitingGet(java.base@11.0.2/CompletableFuture.java:1823)\n\tat java.util.concurrent.CompletableFuture.get(java.base@11.0.2/CompletableFuture.java:1998)\n\tat org.apache.pulsar.client.impl.ConsumerBuilderImpl.subscribe(ConsumerBuilderImpl.java:101)\n</code></pre></div>\n<p dir=\"auto\">The worst part is the absence of any error message; the main thread simply gets blocked indefinitely. After investigating, I identified the root cause mentioned above.</p>\n<p dir=\"auto\">A full example to reproduce this issue can be found here: <a href=\"https://github.com/Shawyeok/pulsarClientSubscribeStuck\">https://github.com/Shawyeok/pulsarClientSubscribeStuck</a></p>\n<p dir=\"auto\">Below is the missing stack trace for <code class=\"notranslate\">ClassNotFoundException</code></p>\n<details>\n<summary>Stacktrace</summary>\n<pre class=\"notranslate\">java.lang.NoClassDefFoundError: com/fasterxml/jackson/annotation/JsonKey\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.introspect.JacksonAnnotationIntrospector.hasAsKey(JacksonAnnotationIntrospector.java:1129)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.introspect.AnnotationIntrospectorPair.hasAsKey(AnnotationIntrospectorPair.java:619)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.introspect.POJOPropertiesCollector._addFields(POJOPropertiesCollector.java:501)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.introspect.POJOPropertiesCollector.collectAll(POJOPropertiesCollector.java:426)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.introspect.POJOPropertiesCollector.getJsonValueAccessor(POJOPropertiesCollector.java:272)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.introspect.BasicBeanDescription.findJsonValueAccessor(BasicBeanDescription.java:258)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.ser.BasicSerializerFactory.findSerializerByAnnotations(BasicSerializerFactory.java:391)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.ser.BeanSerializerFactory._createSerializer2(BeanSerializerFactory.java:225)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.ser.BeanSerializerFactory.createSerializer(BeanSerializerFactory.java:174)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.SerializerProvider._createUntypedSerializer(SerializerProvider.java:1501)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.SerializerProvider._createAndCacheUntypedSerializer(SerializerProvider.java:1449)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.SerializerProvider.findValueSerializer(SerializerProvider.java:550)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.SerializerProvider.findTypedValueSerializer(SerializerProvider.java:828)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.ser.DefaultSerializerProvider.serializeValue(DefaultSerializerProvider.java:308)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.ObjectWriter$Prefetch.serialize(ObjectWriter.java:1572)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.ObjectWriter._writeValueAndClose(ObjectWriter.java:1273)\n\tat org.apache.pulsar.shade.com.fasterxml.jackson.databind.ObjectWriter.writeValueAsString(ObjectWriter.java:1140)\n\tat org.apache.pulsar.client.impl.ConsumerStatsRecorderImpl.init(ConsumerStatsRecorderImpl.java:113)\n\tat org.apache.pulsar.client.impl.ConsumerStatsRecorderImpl.(ConsumerStatsRecorderImpl.java:105)\n\tat org.apache.pulsar.client.impl.ConsumerImpl.(ConsumerImpl.java:294)\n\tat org.apache.pulsar.client.impl.ConsumerImpl.newConsumerImpl(ConsumerImpl.java:252)\n\tat org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.createInternalConsumer(MultiTopicsConsumerImpl.java:1123)\n\tat org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.lambda$doSubscribeTopicPartitions$43(MultiTopicsConsumerImpl.java:1044)\n\tat java.util.stream.IntPipeline$4$1.accept(IntPipeline.java:250)\n\tat java.util.stream.Streams$RangeIntSpliterator.forEachRemaining(Streams.java:110)\n\tat java.util.Spliterator$OfInt.forEachRemaining(Spliterator.java:693)\n\tat java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:482)\n\tat java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:472)\n\tat java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:708)\n\tat java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n\tat java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:499)\n\tat org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.doSubscribeTopicPartitions(MultiTopicsConsumerImpl.java:1056)\n\tat org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.lambda$subscribeTopicPartitions$42(MultiTopicsConsumerImpl.java:1001)\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:774)\n\tat java.util.concurrent.CompletableFuture.uniWhenCompleteStage(CompletableFuture.java:792)\n\tat java.util.concurrent.CompletableFuture.whenComplete(CompletableFuture.java:2153)\n\tat org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.subscribeTopicPartitions(MultiTopicsConsumerImpl.java:999)\n\tat org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.subscribeAsync(MultiTopicsConsumerImpl.java:991)\n\tat org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.lambda$createPartitionedConsumer$39(MultiTopicsConsumerImpl.java:957)\n\tat java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:995)\n\tat java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2137)\n\tat org.apache.pulsar.client.impl.MultiTopicsConsumerImpl.createPartitionedConsumer(MultiTopicsConsumerImpl.java:957)\n\tat org.apache.pulsar.client.impl.PulsarClientImpl.lambda$doSingleTopicSubscribeAsync$5(PulsarClientImpl.java:527)\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:670)\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire$$$capture(CompletableFuture.java:646)\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java)\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975)\n\tat java.util.concurrent.CompletableFuture.uniAccept(CompletableFuture.java:670)\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire$$$capture(CompletableFuture.java:646)\n\tat java.util.concurrent.CompletableFuture$UniAccept.tryFire(CompletableFuture.java)\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975)\n\tat org.apache.pulsar.client.impl.BinaryProtoLookupService.lambda$getPartitionedTopicMetadata$8(BinaryProtoLookupService.java:239)\n\tat java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:774)\n\tat java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:750)\n\tat java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:488)\n\tat java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:1975)\n\tat org.apache.pulsar.client.impl.ClientCnx.handlePartitionResponse(ClientCnx.java:669)\n\tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:144)\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)\n\tat org.apache.pulsar.shade.io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat org.apache.pulsar.shade.io.netty.handler.flush.FlushConsolidationHandler.channelRead(FlushConsolidationHandler.java:152)\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat org.apache.pulsar.shade.io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat org.apache.pulsar.shade.io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n\tat org.apache.pulsar.shade.io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n\tat org.apache.pulsar.shade.io.netty.channel.nio.NioEventLoop.run(NioEventLoop.java:562)\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\n\tat org.apache.pulsar.shade.io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n\tat org.apache.pulsar.shade.io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n\tat java.lang.Thread.run(Thread.java:750)\nCaused by: java.lang.ClassNotFoundException: com.fasterxml.jackson.annotation.JsonKey\n\tat java.net.URLClassLoader.findClass(URLClassLoader.java:387)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:418)\n\tat sun.misc.Launcher$AppClassLoader.loadClass(Launcher.java:355)\n\tat java.lang.ClassLoader.loadClass(ClassLoader.java:351)\n\t... 85 more\n</pre>\n</details>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">ClassNotFoundException</code> is thrown from the <code class=\"notranslate\">doSubscribeTopicPartitions</code> method call, which is nested inside a <code class=\"notranslate\">whenComplete</code> block. As a result, <code class=\"notranslate\">subscribeResult</code> never completes. The relevant code can be found here: </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/434da8b5cc76a08215319be7ab066e1d1c23f6c4/pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java#L1000-L1009\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/MultiTopicsConsumerImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 1000 to 1009\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/434da8b5cc76a08215319be7ab066e1d1c23f6c4\">434da8b</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L1000\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1000\"></td>\n          <td id=\"LC1000\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">private</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">subscribeTopicPartitions</span>(<span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Void</span>&gt; <span class=\"pl-s1\">subscribeResult</span>, <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">topicName</span>, <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">numPartitions</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1001\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1001\"></td>\n          <td id=\"LC1001\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-smi\">boolean</span> <span class=\"pl-s1\">createIfDoesNotExist</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1002\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1002\"></td>\n          <td id=\"LC1002\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">client</span>.<span class=\"pl-en\">preProcessSchemaBeforeSubscribe</span>(<span class=\"pl-s1\">client</span>, <span class=\"pl-s1\">schema</span>, <span class=\"pl-s1\">topicName</span>).<span class=\"pl-en\">whenComplete</span>((<span class=\"pl-s1\">schema</span>, <span class=\"pl-s1\">cause</span>) -&gt; { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1003\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1003\"></td>\n          <td id=\"LC1003\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">if</span> (<span class=\"pl-c1\">null</span> == <span class=\"pl-s1\">cause</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1004\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1004\"></td>\n          <td id=\"LC1004\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-en\">doSubscribeTopicPartitions</span>(<span class=\"pl-s1\">schema</span>, <span class=\"pl-s1\">subscribeResult</span>, <span class=\"pl-s1\">topicName</span>, <span class=\"pl-s1\">numPartitions</span>, <span class=\"pl-s1\">createIfDoesNotExist</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1005\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1005\"></td>\n          <td id=\"LC1005\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1006\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1006\"></td>\n          <td id=\"LC1006\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-s1\">subscribeResult</span>.<span class=\"pl-en\">completeExceptionally</span>(<span class=\"pl-s1\">cause</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1007\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1007\"></td>\n          <td id=\"LC1007\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1008\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1008\"></td>\n          <td id=\"LC1008\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     }); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L1009\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"1009\"></td>\n          <td id=\"LC1009\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">To address this issue, we could modify the <code class=\"notranslate\">whenComplete</code> to a combination of <code class=\"notranslate\">thenAccept</code> and <code class=\"notranslate\">exceptionally</code>. Here's how it could be rewritten:\"</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"client.preProcessSchemaBeforeSubscribe(client, schema, topicName)\n      .thenAccept(schema -&gt; {\n          doSubscribeTopicPartitions(schema, subscribeResult, topicName, numPartitions, createIfDoesNotExist);\n      }).exceptionally(cause -&gt; {\n          subscribeResult.completeExceptionally(cause);\n      });\"><pre class=\"notranslate\"><span class=\"pl-s1\">client</span>.<span class=\"pl-en\">preProcessSchemaBeforeSubscribe</span>(<span class=\"pl-s1\">client</span>, <span class=\"pl-s1\">schema</span>, <span class=\"pl-s1\">topicName</span>)\n      .<span class=\"pl-en\">thenAccept</span>(<span class=\"pl-s1\">schema</span> -&gt; {\n          <span class=\"pl-en\">doSubscribeTopicPartitions</span>(<span class=\"pl-s1\">schema</span>, <span class=\"pl-s1\">subscribeResult</span>, <span class=\"pl-s1\">topicName</span>, <span class=\"pl-s1\">numPartitions</span>, <span class=\"pl-s1\">createIfDoesNotExist</span>);\n      }).<span class=\"pl-en\">exceptionally</span>(<span class=\"pl-s1\">cause</span> -&gt; {\n          <span class=\"pl-s1\">subscribeResult</span>.<span class=\"pl-en\">completeExceptionally</span>(<span class=\"pl-s1\">cause</span>);\n      });</pre></div>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">Here are related discussions:</p>\n<ul dir=\"auto\">\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1575445973\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19458\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19458/hovercard?comment_id=1102070399&amp;comment_type=review_comment\" href=\"https://github.com/apache/pulsar/pull/19458#discussion_r1102070399\">#19458 (comment)</a></li>\n<li><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1575445973\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19458\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19458/hovercard?comment_id=1635371635&amp;comment_type=issue_comment\" href=\"https://github.com/apache/pulsar/pull/19458#issuecomment-1635371635\">#19458 (comment)</a></li>\n</ul>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21971",
                "createdAt": "2024-01-25T15:05:21Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [broker] add timeout for health check read.",
        "url": "https://github.com/apache/pulsar/pull/21990",
        "resourcePath": "/apache/pulsar/pull/21990",
        "createdAt": "2024-01-30T03:32:02Z",
        "number": 21990,
        "mergeCommit": {
          "oid": "925bf2e375b5e18bcd4d93fbed16c96cb72f1e52",
          "message": "[fix] [broker] add timeout for health check read. (#21990)",
          "commitUrl": "https://github.com/apache/pulsar/commit/925bf2e375b5e18bcd4d93fbed16c96cb72f1e52",
          "parents": {
            "nodes": [
              {
                "oid": "1952f94769d9dc80908d159be6e6ce1ff48b83fb",
                "message": "[improve] [proxy] Add a check for brokerServiceURL that does not support multi uri yet (#21972)\n\n### Motivation\r\n\r\nAt the beginning of the design, these two configurations(`brokerServiceURL & brokerServiceURLTLS`) do not support setting multiple broker addresses, which should instead be set to a \u201cdiscovery service provider.\u201d see: https://github.com/apache/pulsar/pull/1002 and https://github.com/apache/pulsar/pull/14682\r\n\r\nUsers will get the below error if they set A to a multi-broker URLs\r\n\r\n```\r\n\"2024-01-09 00:20:10,261 -0800 [pulsar-proxy-io-4-7] WARN  io.netty.channel.DefaultChannelPipeline - An exceptionCaught() event was fired, and it reached at the tail of the pipeline. It usually means the last handler in the pipeline did not handle the exception.\r\njava.lang.IllegalArgumentException: port out of range:-1\r\n        at java.net.InetSocketAddress.checkPort(InetSocketAddress.java:143) ~[?:?]\r\n        at java.net.InetSocketAddress.createUnresolved(InetSocketAddress.java:254) ~[?:?]\r\n        at org.apache.pulsar.proxy.server.LookupProxyHandler.getAddr(LookupProxyHandler.java:432) ~[org.apache.pulsar-pulsar-proxy-2.9.0.jar:2.9.0]\r\n        at org.apache.pulsar.proxy.server.LookupProxyHandler.handleGetSchema(LookupProxyHandler.java:357) ~[org.apache.pulsar-pulsar-proxy-2.9.0.jar:2.9.0]\r\n        at org.apache.pulsar.proxy.server.ProxyConnection.handleGetSchema(ProxyConnection.java:463) ~[org.apache.pulsar-pulsar-proxy-2.9.0.jar:2.9.0]\r\n        at org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:326) ~[io.streamnative-pulsar-common-2.9.2.12.jar:2.9.2.12]\r\n        at org.apache.pulsar.proxy.server.ProxyConnection.channelRead(ProxyConnection.java:221) ~[org.apache.pulsar-pulsar-proxy-2.9.0.jar:2.9.0]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[io.netty-netty-transport-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[io.netty-netty-transport-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[io.netty-netty-transport-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:327) ~[io.netty-netty-codec-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:299) ~[io.netty-netty-codec-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[io.netty-netty-transport-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[io.netty-netty-transport-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[io.netty-netty-transport-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.handler.ssl.SslHandler.unwrap(SslHandler.java:1372) ~[io.netty-netty-handler-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.handler.ssl.SslHandler.decodeNonJdkCompatible(SslHandler.java:1246) ~[io.netty-netty-handler-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.handler.ssl.SslHandler.decode(SslHandler.java:1286) ~[io.netty-netty-handler-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.decodeRemovalReentryProtection(ByteToMessageDecoder.java:510) ~[io.netty-netty-codec-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.callDecode(ByteToMessageDecoder.java:449) ~[io.netty-netty-codec-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:279) ~[io.netty-netty-codec-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[io.netty-netty-transport-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[io.netty-netty-transport-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:357) ~[io.netty-netty-transport-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410) ~[io.netty-netty-transport-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:379) ~[io.netty-netty-transport-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:365) ~[io.netty-netty-transport-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919) ~[io.netty-netty-transport-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:795) ~[io.netty-netty-transport-classes-epoll-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:480) ~[io.netty-netty-transport-classes-epoll-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:378) ~[io.netty-netty-transport-classes-epoll-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:986) ~[io.netty-netty-common-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74) ~[io.netty-netty-common-4.1.74.Final.jar:4.1.74.Final]\r\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.74.Final.jar:4.1.74.Final]\r\n```\r\n\r\n### Modifications\r\n- Improve the description\r\n- Add a check to prevent wrong settings"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/BrokersBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiHealthCheckTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5lZlsP2gAoNTE1MGI4OGE5NWU2Mzk0OTEyYTk4ZGRjMzRiMTRkMzU2NmI1MWRiMQ",
                "url": "https://github.com/apache/pulsar/pull/21990/commits/5150b88a95e6394912a98ddc34b14d3566b51db1"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21989,
                "url": "https://github.com/apache/pulsar/issues/21989",
                "title": "[Bug] Resource Leak when do health check.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">We will do the health check for the cluster by rest api <code class=\"notranslate\">org.apache.pulsar.broker.admin.impl.BrokersBase#healthCheck</code> every 1 min.  But recently we meet a case that the health check fail.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"bin/pulsar-admin --admin-url http://XXX brokers healthcheck\"><pre class=\"notranslate\"><code class=\"notranslate\">bin/pulsar-admin --admin-url http://XXX brokers healthcheck\n</code></pre></div>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/52550727/300669507-d39e50ce-fff4-4ab7-98f0-e5da3bac6417.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM2MDQsIm5iZiI6MTcxNDk3MzMwNCwicGF0aCI6Ii81MjU1MDcyNy8zMDA2Njk1MDctZDM5ZTUwY2UtZmZmNC00YWI3LTk4ZjAtZTVkYTNiYWM2NDE3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjgyNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTE3MzUzNDkyNmViNWE2Y2IzNTI2ZGMxMTRmMjI5OTMwZmU1Nzc1MzE4OTYxYjYxYjQxYzFkNDU5YzgzZjM2ZmEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.3-JH-CCtVXjXZrnenDHhFSM6Vrp4Q89MFMThrGFnViY\"><img width=\"417\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/52550727/300669507-d39e50ce-fff4-4ab7-98f0-e5da3bac6417.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM2MDQsIm5iZiI6MTcxNDk3MzMwNCwicGF0aCI6Ii81MjU1MDcyNy8zMDA2Njk1MDctZDM5ZTUwY2UtZmZmNC00YWI3LTk4ZjAtZTVkYTNiYWM2NDE3LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjgyNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTE3MzUzNDkyNmViNWE2Y2IzNTI2ZGMxMTRmMjI5OTMwZmU1Nzc1MzE4OTYxYjYxYjQxYzFkNDU5YzgzZjM2ZmEmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.3-JH-CCtVXjXZrnenDHhFSM6Vrp4Q89MFMThrGFnViY\" style=\"max-width: 100%;\"></a>\n<p dir=\"auto\">There is no any error log in the broker log, the random message has been produced to the health-check topic, but the reader fail to read it out, so the logic stuck at</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"org.apache.pulsar.broker.admin.impl.BrokersBase#healthCheckRecursiveReadNext\"><pre class=\"notranslate\"><code class=\"notranslate\">org.apache.pulsar.broker.admin.impl.BrokersBase#healthCheckRecursiveReadNext\n</code></pre></div>\n<p dir=\"auto\">, which result into the created producers and readers can't be closed, and the scheduled async tasks can't be completed as well, and the number of these objects increase as time goes by.<br>\nFor example:<br>\n<code class=\"notranslate\">bin/pulsar-admin topics stats persistent://pulsar/XXX/healthcheck</code><br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/52550727/300670299-6482b3e0-5078-4d56-840b-c8650a2a92fa.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM2MDQsIm5iZiI6MTcxNDk3MzMwNCwicGF0aCI6Ii81MjU1MDcyNy8zMDA2NzAyOTktNjQ4MmIzZTAtNTA3OC00ZDU2LTg0MGItYzg2NTBhMmE5MmZhLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjgyNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWYyN2FhNWJhZjQ0MDU1YTMwNzAyODc0YjJmMmE5M2Q4MTQ1OTY4YTNjOGJkOTg0MjJlNWJmNDg5ZmFhNjQ3NGMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0._ZZEgH4tQPhkLZ9MOaCSEhOOvBaOHedXvNLDLeUkz_w\"><img src=\"https://private-user-images.githubusercontent.com/52550727/300670299-6482b3e0-5078-4d56-840b-c8650a2a92fa.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM2MDQsIm5iZiI6MTcxNDk3MzMwNCwicGF0aCI6Ii81MjU1MDcyNy8zMDA2NzAyOTktNjQ4MmIzZTAtNTA3OC00ZDU2LTg0MGItYzg2NTBhMmE5MmZhLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MjgyNFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWYyN2FhNWJhZjQ0MDU1YTMwNzAyODc0YjJmMmE5M2Q4MTQ1OTY4YTNjOGJkOTg0MjJlNWJmNDg5ZmFhNjQ3NGMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0._ZZEgH4tQPhkLZ9MOaCSEhOOvBaOHedXvNLDLeUkz_w\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">1</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">1</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21989",
                "createdAt": "2024-01-30T03:28:07Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Sanitize values before logging in apply-config-from-env.py script",
        "url": "https://github.com/apache/pulsar/pull/22044",
        "resourcePath": "/apache/pulsar/pull/22044",
        "createdAt": "2024-02-08T18:32:30Z",
        "number": 22044,
        "mergeCommit": {
          "oid": "303678364eab538c16041214cae1588a5b2111d9",
          "message": "[fix][broker] Sanitize values before logging in apply-config-from-env.py script (#22044)",
          "commitUrl": "https://github.com/apache/pulsar/commit/303678364eab538c16041214cae1588a5b2111d9",
          "parents": {
            "nodes": [
              {
                "oid": "a83e9ed70323b80319545326716340ce76d690eb",
                "message": "[feat] PIP-335: Add support Oxia as a metadata store (#22007)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/pulsar/scripts/apply-config-from-env-with-prefix.py"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "docker/pulsar/scripts/apply-config-from-env.py"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5maWVe2gAoNjgzNzliMjRmYjgzMmVjOWFkNTM5OWUxMzNiMGI3NDE4NjA4MWExYw",
                "url": "https://github.com/apache/pulsar/pull/22044/commits/68379b24fb832ec9ad5399e133b0b74186081a1c"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22043,
                "url": "https://github.com/apache/pulsar/issues/22043",
                "title": "[Bug] Sensitive information such as brokerClientAuthenticationParameters gets logged in Pulsar Broker",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">All released version</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">When the broker starts, the <code class=\"notranslate\">brokerClientAuthenticationParameters</code> gets logged:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[conf/broker.conf] Applying config brokerClientAuthenticationParameters = eyJhbGciOiAiSFMyNTYiLCAidHlwIjogIkpXVCJ9.eyJzdWIiOiAiMTIzNDU2Nzg5MCIsICJuYW1lIjogIkpvaG4gRG9lIiwgImFkbWluIjogdHJ1ZX0.X\"><pre class=\"notranslate\"><code class=\"notranslate\">[conf/broker.conf] Applying config brokerClientAuthenticationParameters = eyJhbGciOiAiSFMyNTYiLCAidHlwIjogIkpXVCJ9.eyJzdWIiOiAiMTIzNDU2Nzg5MCIsICJuYW1lIjogIkpvaG4gRG9lIiwgImFkbWluIjogdHJ1ZX0.X\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">This should be sanitized in the log</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[conf/broker.conf] Applying config brokerClientAuthenticationParameters = **********************************************************************************************************************\"><pre class=\"notranslate\"><code class=\"notranslate\">[conf/broker.conf] Applying config brokerClientAuthenticationParameters = **********************************************************************************************************************\n</code></pre></div>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">(see repro step for example)</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">When logging configuration parameters, there should be a list of sensitive parameters. When logging those, the value should be replaced with <code class=\"notranslate\">*</code> characters.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22043",
                "createdAt": "2024-02-08T17:39:36Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix hash collision when using a consumer name that ends with a number",
        "url": "https://github.com/apache/pulsar/pull/22053",
        "resourcePath": "/apache/pulsar/pull/22053",
        "createdAt": "2024-02-14T17:49:57Z",
        "number": 22053,
        "mergeCommit": {
          "oid": "7e73967f9daf368562fa0318d4ecb62272d72174",
          "message": "[fix][broker] Fix hash collision when using a consumer name that ends with a number (#22053)",
          "commitUrl": "https://github.com/apache/pulsar/commit/7e73967f9daf368562fa0318d4ecb62272d72174",
          "parents": {
            "nodes": [
              {
                "oid": "beed0cfc52e566f3a5293f7ea37fdcc6e334b0f0",
                "message": "[feat][io] AzureDataExplorer/Kusto Sink for Pulsar (#22006)\n\n- https://learn.microsoft.com/en-us/azure/data-explorer/\r\n\r\nCo-authored-by: Ramachandran A G <106139410+ag-ramachandran@users.noreply.github.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ConsistentHashingStickyKeyConsumerSelector.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/ConsistentHashingStickyKeyConsumerSelectorTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PersistentStickyKeyDispatcherMultipleConsumersTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5m4zuz2gAoM2JjOGU5MjczNjk0MjI2MDY3YmNkM2MyNWRkNzY0ZjgzNjU3YjFhNw",
                "url": "https://github.com/apache/pulsar/pull/22053/commits/3bc8e9273694226067bcd3c25dd764f83657b1a7"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22050,
                "url": "https://github.com/apache/pulsar/issues/22050",
                "title": "[Bug] collision while using ConsistentHashing & consumer name that end by a number",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">pulsar v3.1.1 &amp; ubuntu 22.04</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Consistent hashing enabled in brocker config :<br>\n<code class=\"notranslate\">subscriptionKeySharedUseConsistentHashing=true</code></p>\n<p dir=\"auto\">Create Pulsar consumers in a loop like this :</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"for (int i = 0; i &lt; 40; i++) {\n\n  ConsumerBuilder&lt;GenericRecord&gt; consumerBuilder = client.newConsumer(myschema)\n         .topic(&quot;mytopic&quot;)\n         .consumerName(hostname+&quot;-&quot;+i)\n         .subscriptionName(&quot;mysubcription&quot;)\n         .subscriptionMode(SubscriptionMode.Durable)\n         .subscriptionType(SubscriptionType.Key_Shared)\n         .keySharedPolicy(KeySharedPolicy.autoSplitHashRange().setAllowOutOfOrderDelivery(true))\n         .subscriptionInitialPosition(SubscriptionInitialPosition.Earliest)\n         .receiverQueueSize(1000)\n         .maxAcknowledgmentGroupSize(100)\n         .acknowledgmentGroupTime(100, TimeUnit.MILLISECONDS)\n         .messageListener((MessageListener&lt;GenericRecord&gt;) (consumer, msg) -&gt; {\n            // my consumer code\n          }\n}  \"><pre class=\"notranslate\"><code class=\"notranslate\">for (int i = 0; i &lt; 40; i++) {\n\n  ConsumerBuilder&lt;GenericRecord&gt; consumerBuilder = client.newConsumer(myschema)\n         .topic(\"mytopic\")\n         .consumerName(hostname+\"-\"+i)\n         .subscriptionName(\"mysubcription\")\n         .subscriptionMode(SubscriptionMode.Durable)\n         .subscriptionType(SubscriptionType.Key_Shared)\n         .keySharedPolicy(KeySharedPolicy.autoSplitHashRange().setAllowOutOfOrderDelivery(true))\n         .subscriptionInitialPosition(SubscriptionInitialPosition.Earliest)\n         .receiverQueueSize(1000)\n         .maxAcknowledgmentGroupSize(100)\n         .acknowledgmentGroupTime(100, TimeUnit.MILLISECONDS)\n         .messageListener((MessageListener&lt;GenericRecord&gt;) (consumer, msg) -&gt; {\n            // my consumer code\n          }\n}  \n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">While I'm executing<br>\n<code class=\"notranslate\">pulsar-admin topics stats public/default/mytopic-partition-0</code></p>\n<p dir=\"auto\">if I look keyHashRanges field, I found that the following range \"[1932476396, 1932750362]\"  is associated to two different consumers <code class=\"notranslate\">host2-2</code> and <code class=\"notranslate\">host2-25</code> .</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">While I'm executing<br>\n<code class=\"notranslate\">pulsar-admin topics stats public/default/mytopic</code></p>\n<p dir=\"auto\">if I look keyHashRanges field, I want to found every range associated to only one consumer.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">On slack <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/lhotari/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/lhotari\">@lhotari</a> told me that hash collision that happens with my use case where Ihave a consumerName ending with a number, and pointed me to this code<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/08b28f5c5cbbdc63467455c40106173475ff01e5/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ConsistentHashingStickyKeyConsumerSelector.java#L61-L63\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/ConsistentHashingStickyKeyConsumerSelector.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 61 to 63\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/08b28f5c5cbbdc63467455c40106173475ff01e5\">08b28f5</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L61\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"61\"></td>\n          <td id=\"LC61\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">int</span> <span class=\"pl-s1\">i</span> = <span class=\"pl-c1\">0</span>; <span class=\"pl-s1\">i</span> &lt; <span class=\"pl-s1\">numberOfPoints</span>; <span class=\"pl-s1\">i</span>++) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L62\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"62\"></td>\n          <td id=\"LC62\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">key</span> = <span class=\"pl-s1\">consumer</span>.<span class=\"pl-en\">consumerName</span>() + <span class=\"pl-s1\">i</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L63\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"63\"></td>\n          <td id=\"LC63\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">hash</span> = <span class=\"pl-smi\">Murmur3_32Hash</span>.<span class=\"pl-en\">getInstance</span>().<span class=\"pl-en\">makeHash</span>(<span class=\"pl-s1\">key</span>.<span class=\"pl-en\">getBytes</span>()); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">A simple workaround is to use .consumerName(hostname+\"-\"+i+\"-\"), ie add some character other than a number to the end of the consumer name.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22050",
                "createdAt": "2024-02-13T14:33:36Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Unwrap type from CompletableFuture when getting function's type args",
        "url": "https://github.com/apache/pulsar/pull/22066",
        "resourcePath": "/apache/pulsar/pull/22066",
        "createdAt": "2024-02-18T09:14:25Z",
        "number": 22066,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/utils/src/main/java/org/apache/pulsar/functions/utils/FunctionCommon.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/utils/src/test/java/org/apache/pulsar/functions/utils/FunctionCommonTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5nNaHq2gAoNWJkZDhlNzkzNmE5YTk2OWQxNGQ2NDExMzY2NGExZjYzYjViMDM1NQ",
                "url": "https://github.com/apache/pulsar/pull/22066/commits/5bdd8e7936a9a969d14d64113664a1f63b5b0355"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22067,
                "url": "https://github.com/apache/pulsar/issues/22067",
                "title": "[Bug] Functions get wrong output type for async functions",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\"><a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/apache/pulsar/commit/220a3d601602d67f5f44516c5d9895dfaa270380/hovercard\" href=\"https://github.com/apache/pulsar/commit/220a3d601602d67f5f44516c5d9895dfaa270380\"><tt>220a3d6</tt></a></p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Write an async function like below:</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"package org.apache.pulsar.functions.api.examples;\n\nimport java.util.concurrent.CompletableFuture;\nimport java.util.concurrent.Executors;\nimport org.apache.pulsar.functions.api.Context;\nimport org.apache.pulsar.functions.api.Function;\nimport org.apache.pulsar.functions.api.examples.pojo.AvroTestObject;\n\npublic class AvroAsyncFunction implements Function&lt;AvroTestObject, CompletableFuture&lt;AvroTestObject&gt;&gt; {\n    @Override\n    public CompletableFuture&lt;AvroTestObject&gt; process(AvroTestObject input, Context context) throws Exception {\n        CompletableFuture&lt;AvroTestObject&gt; future = new CompletableFuture();\n\n        Executors.newCachedThreadPool().submit(() -&gt; {\n            try {\n                Thread.sleep(500);\n                input.setBaseValue(input.getBaseValue() + 10);\n                future.complete(input);\n            } catch (Exception e) {\n                future.completeExceptionally(e);\n            }\n        });\n\n        return future;\n    }\n}\n\"><pre class=\"notranslate\"><code class=\"notranslate\">package org.apache.pulsar.functions.api.examples;\n\nimport java.util.concurrent.CompletableFuture;\nimport java.util.concurrent.Executors;\nimport org.apache.pulsar.functions.api.Context;\nimport org.apache.pulsar.functions.api.Function;\nimport org.apache.pulsar.functions.api.examples.pojo.AvroTestObject;\n\npublic class AvroAsyncFunction implements Function&lt;AvroTestObject, CompletableFuture&lt;AvroTestObject&gt;&gt; {\n    @Override\n    public CompletableFuture&lt;AvroTestObject&gt; process(AvroTestObject input, Context context) throws Exception {\n        CompletableFuture&lt;AvroTestObject&gt; future = new CompletableFuture();\n\n        Executors.newCachedThreadPool().submit(() -&gt; {\n            try {\n                Thread.sleep(500);\n                input.setBaseValue(input.getBaseValue() + 10);\n                future.complete(input);\n            } catch (Exception e) {\n                future.completeExceptionally(e);\n            }\n        });\n\n        return future;\n    }\n}\n\n</code></pre></div>\n<ol start=\"2\" dir=\"auto\">\n<li>Create function with the above code:</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"./bin/pulsar-admin functions create --jar /pulsar/examples.jar --name avro-java-fn --className org.apache.pulsar.functions.api.examples.AvroAsyncFunction --inputs persistent://public/default/avro-java-fn-input --output persistent://public/default/avro-java-fn-output --schema-type avro --custom-schema-inputs '{&quot;persistent://public/default/avro-java-fn-input&quot;: &quot;{\\&quot;schemaType\\&quot;: \\&quot;avro\\&quot;}&quot;}'\"><pre class=\"notranslate\"><code class=\"notranslate\">./bin/pulsar-admin functions create --jar /pulsar/examples.jar --name avro-java-fn --className org.apache.pulsar.functions.api.examples.AvroAsyncFunction --inputs persistent://public/default/avro-java-fn-input --output persistent://public/default/avro-java-fn-output --schema-type avro --custom-schema-inputs '{\"persistent://public/default/avro-java-fn-input\": \"{\\\"schemaType\\\": \\\"avro\\\"}\"}'\n</code></pre></div>\n<ol start=\"3\" dir=\"auto\">\n<li>Get the schema of the output topic:</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"./bin/pulsar-admin schemas get persistent://public/default/avro-java-fn-output-partition-0\"><pre class=\"notranslate\"><code class=\"notranslate\">./bin/pulsar-admin schemas get persistent://public/default/avro-java-fn-output-partition-0\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<div class=\"highlight highlight-source-json notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{\n  &quot;version&quot;: 0,\n  &quot;schemaInfo&quot;: {\n    &quot;name&quot;: &quot;avro-java-fn-output-partition-0&quot;,\n    &quot;schema&quot;: {\n      &quot;type&quot;: &quot;record&quot;,\n      &quot;name&quot;: &quot;AvroTestObject&quot;,\n      &quot;namespace&quot;: &quot;org.apache.pulsar.functions.api.examples.pojo&quot;,\n      &quot;fields&quot;: [\n        {\n          &quot;name&quot;: &quot;baseValue&quot;,\n          &quot;type&quot;: [\n            &quot;null&quot;,\n            &quot;int&quot;\n          ]\n        },\n        {\n          &quot;name&quot;: &quot;objectValue&quot;,\n          &quot;type&quot;: [\n            &quot;null&quot;,\n            &quot;string&quot;\n          ]\n        }\n      ]\n    },\n    &quot;type&quot;: &quot;AVRO&quot;,\n    &quot;timestamp&quot;: 1708246141330,\n    &quot;properties&quot;: {\n      &quot;__alwaysAllowNull&quot;: &quot;true&quot;,\n      &quot;__jsr310ConversionEnabled&quot;: &quot;false&quot;\n    }\n  }\n}\"><pre class=\"notranslate\">{\n  <span class=\"pl-ent\">\"version\"</span>: <span class=\"pl-c1\">0</span>,\n  <span class=\"pl-ent\">\"schemaInfo\"</span>: {\n    <span class=\"pl-ent\">\"name\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>avro-java-fn-output-partition-0<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"schema\"</span>: {\n      <span class=\"pl-ent\">\"type\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>record<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"name\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>AvroTestObject<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"namespace\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>org.apache.pulsar.functions.api.examples.pojo<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"fields\"</span>: [\n        {\n          <span class=\"pl-ent\">\"name\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>baseValue<span class=\"pl-pds\">\"</span></span>,\n          <span class=\"pl-ent\">\"type\"</span>: [\n            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>null<span class=\"pl-pds\">\"</span></span>,\n            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>int<span class=\"pl-pds\">\"</span></span>\n          ]\n        },\n        {\n          <span class=\"pl-ent\">\"name\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>objectValue<span class=\"pl-pds\">\"</span></span>,\n          <span class=\"pl-ent\">\"type\"</span>: [\n            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>null<span class=\"pl-pds\">\"</span></span>,\n            <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>string<span class=\"pl-pds\">\"</span></span>\n          ]\n        }\n      ]\n    },\n    <span class=\"pl-ent\">\"type\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>AVRO<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"timestamp\"</span>: <span class=\"pl-c1\">1708246141330</span>,\n    <span class=\"pl-ent\">\"properties\"</span>: {\n      <span class=\"pl-ent\">\"__alwaysAllowNull\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>true<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"__jsr310ConversionEnabled\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>false<span class=\"pl-pds\">\"</span></span>\n    }\n  }\n}</pre></div>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<div class=\"highlight highlight-source-json notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{\n  &quot;version&quot;: 0,\n  &quot;schemaInfo&quot;: {\n    &quot;name&quot;: &quot;avro-java-fn-output-partition-0&quot;,\n    &quot;schema&quot;: {\n      &quot;type&quot;: &quot;record&quot;,\n      &quot;name&quot;: &quot;CompletableFuture&quot;,\n      &quot;namespace&quot;: &quot;java.util.concurrent&quot;,\n      &quot;fields&quot;: []\n    },\n    &quot;type&quot;: &quot;AVRO&quot;,\n    &quot;timestamp&quot;: 1708246140630,\n    &quot;properties&quot;: {\n      &quot;__alwaysAllowNull&quot;: &quot;true&quot;,\n      &quot;__jsr310ConversionEnabled&quot;: &quot;false&quot;\n    }\n  }\n}\"><pre class=\"notranslate\">{\n  <span class=\"pl-ent\">\"version\"</span>: <span class=\"pl-c1\">0</span>,\n  <span class=\"pl-ent\">\"schemaInfo\"</span>: {\n    <span class=\"pl-ent\">\"name\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>avro-java-fn-output-partition-0<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"schema\"</span>: {\n      <span class=\"pl-ent\">\"type\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>record<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"name\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>CompletableFuture<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"namespace\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>java.util.concurrent<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"fields\"</span>: []\n    },\n    <span class=\"pl-ent\">\"type\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>AVRO<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"timestamp\"</span>: <span class=\"pl-c1\">1708246140630</span>,\n    <span class=\"pl-ent\">\"properties\"</span>: {\n      <span class=\"pl-ent\">\"__alwaysAllowNull\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>true<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"__jsr310ConversionEnabled\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>false<span class=\"pl-pds\">\"</span></span>\n    }\n  }\n}</pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The reason is that when infer function type args, it won't unwrap the output type for <code class=\"notranslate\">CompletableFuture</code></p>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22067",
                "createdAt": "2024-02-18T09:19:38Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix Thread.getThreadGroup().getName() NPE",
        "url": "https://github.com/apache/pulsar/pull/22070",
        "resourcePath": "/apache/pulsar/pull/22070",
        "createdAt": "2024-02-19T08:56:54Z",
        "number": 22070,
        "mergeCommit": {
          "oid": "0b6bd70b8d1e7b7cd4d82aa2e0cbfd5e0323d440",
          "message": "[fix][test] Fix Thread.getThreadGroup().getName() NPE (#22070)",
          "commitUrl": "https://github.com/apache/pulsar/commit/0b6bd70b8d1e7b7cd4d82aa2e0cbfd5e0323d440",
          "parents": {
            "nodes": [
              {
                "oid": "b375e869accc5bb4588974025d04edbb0e9911eb",
                "message": "[fix] [broker] Fix can not subscribe partitioned topic with a suffix-matched regexp (#22025)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "buildtools/src/main/java/org/apache/pulsar/tests/ThreadLeakDetectorListener.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5nQq252gAoNGQwMGUwZjE1MjgyYTBlOTZmYjIyZjkwZWRiNWIxNWU4ODE2YTA3YQ",
                "url": "https://github.com/apache/pulsar/pull/22070/commits/4d00e0f15282a0e96fb22f90edb5b15e8816a07a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22056,
                "url": "https://github.com/apache/pulsar/issues/22056",
                "title": "Flaky-test: ThreadLeakDetectorListener",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/7911807641/job/21596798086?pr=22055#step:11:7095\">https://github.com/apache/pulsar/actions/runs/7911807641/job/21596798086?pr=22055#step:11:7095</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.lang.NullPointerException: Cannot invoke &quot;java.lang.ThreadGroup.getName()&quot; because the return value of &quot;java.lang.Thread.getThreadGroup()&quot; is null\n        at org.apache.pulsar.tests.ThreadLeakDetectorListener.shouldSkipThread(ThreadLeakDetectorListener.java:180)\n        at org.apache.pulsar.tests.ThreadLeakDetectorListener.lambda$compareThreads$0(ThreadLeakDetectorListener.java:133)\n        at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:178)\n        at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)\n        at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n        at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n        at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:921)\n        at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n        at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:682)\n        at org.apache.pulsar.tests.ThreadLeakDetectorListener.compareThreads(ThreadLeakDetectorListener.java:135)\n        at org.apache.pulsar.tests.ThreadLeakDetectorListener.onBetweenTestClasses(ThreadLeakDetectorListener.java:78)\n        at org.apache.pulsar.tests.BetweenTestClassesListenerAdapter.onFinish(BetweenTestClassesListenerAdapter.java:48)\n        at org.apache.pulsar.tests.ThreadLeakDetectorListener.onFinish(ThreadLeakDetectorListener.java:47)\n        at org.testng.TestRunner.fireEvent(TestRunner.java:965)\n        at org.testng.TestRunner.afterRun(TestRunner.java:924)\n        at org.testng.TestRunner.run(TestRunner.java:605)\n        at org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n        at org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n        at org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n        at org.testng.SuiteRunner.run(SuiteRunner.java:330)\n        at org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n        at org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n        at org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n        at org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n        at org.testng.TestNG.runSuites(TestNG.java:1099)\n        at org.testng.TestNG.run(TestNG.java:1067)\n        at org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n        at org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n        at org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n        at org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n        at org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n        at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n        at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\"><pre class=\"notranslate\"><code class=\"notranslate\">java.lang.NullPointerException: Cannot invoke \"java.lang.ThreadGroup.getName()\" because the return value of \"java.lang.Thread.getThreadGroup()\" is null\n        at org.apache.pulsar.tests.ThreadLeakDetectorListener.shouldSkipThread(ThreadLeakDetectorListener.java:180)\n        at org.apache.pulsar.tests.ThreadLeakDetectorListener.lambda$compareThreads$0(ThreadLeakDetectorListener.java:133)\n        at java.base/java.util.stream.ReferencePipeline$2$1.accept(ReferencePipeline.java:178)\n        at java.base/java.util.ArrayList$ArrayListSpliterator.forEachRemaining(ArrayList.java:1625)\n        at java.base/java.util.stream.AbstractPipeline.copyInto(AbstractPipeline.java:509)\n        at java.base/java.util.stream.AbstractPipeline.wrapAndCopyInto(AbstractPipeline.java:499)\n        at java.base/java.util.stream.ReduceOps$ReduceOp.evaluateSequential(ReduceOps.java:921)\n        at java.base/java.util.stream.AbstractPipeline.evaluate(AbstractPipeline.java:234)\n        at java.base/java.util.stream.ReferencePipeline.collect(ReferencePipeline.java:682)\n        at org.apache.pulsar.tests.ThreadLeakDetectorListener.compareThreads(ThreadLeakDetectorListener.java:135)\n        at org.apache.pulsar.tests.ThreadLeakDetectorListener.onBetweenTestClasses(ThreadLeakDetectorListener.java:78)\n        at org.apache.pulsar.tests.BetweenTestClassesListenerAdapter.onFinish(BetweenTestClassesListenerAdapter.java:48)\n        at org.apache.pulsar.tests.ThreadLeakDetectorListener.onFinish(ThreadLeakDetectorListener.java:47)\n        at org.testng.TestRunner.fireEvent(TestRunner.java:965)\n        at org.testng.TestRunner.afterRun(TestRunner.java:924)\n        at org.testng.TestRunner.run(TestRunner.java:605)\n        at org.testng.SuiteRunner.runTest(SuiteRunner.java:437)\n        at org.testng.SuiteRunner.runSequentially(SuiteRunner.java:431)\n        at org.testng.SuiteRunner.privateRun(SuiteRunner.java:391)\n        at org.testng.SuiteRunner.run(SuiteRunner.java:330)\n        at org.testng.SuiteRunnerWorker.runSuite(SuiteRunnerWorker.java:52)\n        at org.testng.SuiteRunnerWorker.run(SuiteRunnerWorker.java:95)\n        at org.testng.TestNG.runSuitesSequentially(TestNG.java:1256)\n        at org.testng.TestNG.runSuitesLocally(TestNG.java:1176)\n        at org.testng.TestNG.runSuites(TestNG.java:1099)\n        at org.testng.TestNG.run(TestNG.java:1067)\n        at org.apache.maven.surefire.testng.TestNGExecutor.run(TestNGExecutor.java:155)\n        at org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeSingleClass(TestNGDirectoryTestSuite.java:102)\n        at org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.executeLazy(TestNGDirectoryTestSuite.java:117)\n        at org.apache.maven.surefire.testng.TestNGDirectoryTestSuite.execute(TestNGDirectoryTestSuite.java:86)\n        at org.apache.maven.surefire.testng.TestNGProvider.invoke(TestNGProvider.java:137)\n        at org.apache.maven.surefire.booter.ForkedBooter.runSuitesInProcess(ForkedBooter.java:385)\n        at org.apache.maven.surefire.booter.ForkedBooter.execute(ForkedBooter.java:162)\n        at org.apache.maven.surefire.booter.ForkedBooter.run(ForkedBooter.java:507)\n        at org.apache.maven.surefire.booter.ForkedBooter.main(ForkedBooter.java:495)\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:3.1.0:test (default-test) on project pulsar-transaction-coordinator: \n  Error:  \n  Error:  Please refer to /home/runner/work/pulsar/pulsar/pulsar-transaction/coordinator/target/surefire-reports for the individual test results.\n  Error:  Please refer to dump files (if any exist) [date].dump, [date]-jvmRun[N].dump and [date].dumpstream.\n  Error:  ExecutionException There was an error in the forked process\n  Error:  Cannot invoke &quot;java.lang.ThreadGroup.getName()&quot; because the return value of &quot;java.lang.Thread.getThreadGroup()&quot; is null\n  Error:  org.apache.maven.surefire.booter.SurefireBooterForkException: ExecutionException There was an error in the forked process\n  Error:  Cannot invoke &quot;java.lang.ThreadGroup.getName()&quot; because the return value of &quot;java.lang.Thread.getThreadGroup()&quot; is null\n  Error:  \tat org.apache.maven.plugin.surefire.booterclient.ForkStarter.awaitResultsDone(ForkStarter.java:456)\n  Error:  \tat org.apache.maven.plugin.surefire.booterclient.ForkStarter.runSuitesForkOnceMultiple(ForkStarter.java:358)\n  Error:  \tat org.apache.maven.plugin.surefire.booterclient.ForkStarter.run(ForkStarter.java:296)\n  Error:  \tat org.apache.maven.plugin.surefire.booterclient.ForkStarter.run(ForkStarter.java:250)\n  Error:  \tat org.apache.maven.plugin.surefire.AbstractSurefireMojo.executeProvider(AbstractSurefireMojo.java:1203)\n  Error:  \tat org.apache.maven.plugin.surefire.AbstractSurefireMojo.executeAfterPreconditionsChecked(AbstractSurefireMojo.java:1055)\n  Error:  \tat org.apache.maven.plugin.surefire.AbstractSurefireMojo.execute(AbstractSurefireMojo.java:871)\n  Error:  \tat com.gradle.maven.scan.extension.internal.d.a.executeMojo(SourceFile:114)\n  Error:  \tat org.apache.maven.lifecycle.internal.MojoExecutor.doExecute2(MojoExecutor.java:370)\n  Error:  \tat org.apache.maven.lifecycle.internal.MojoExecutor.doExecute(MojoExecutor.java:351)\n  Error:  \tat org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:215)\n  Error:  \tat org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:171)\n  Error:  \tat org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:163)\n  Error:  \tat org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:117)\n  Error:  \tat org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:81)\n  Error:  \tat org.apache.maven.lifecycle.internal.builder.singlethreaded.SingleThreadedBuilder.build(SingleThreadedBuilder.java:56)\n  Error:  \tat org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:128)\n  Error:  \tat org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:299)\n  Error:  \tat org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:193)\n  Error:  \tat org.apache.maven.DefaultMaven.execute(DefaultMaven.java:106)\n  Error:  \tat org.apache.maven.cli.MavenCli.execute(MavenCli.java:963)\n  Error:  \tat org.apache.maven.cli.MavenCli.doMain(MavenCli.java:296)\n  Error:  \tat org.apache.maven.cli.MavenCli.main(MavenCli.java:199)\n  Error:  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  Error:  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  Error:  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  Error:  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  Error:  \tat org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:282)\n  Error:  \tat org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:225)\n  Error:  \tat org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:406)\n  Error:  \tat org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:347)\n  Error:  Caused by: org.apache.maven.surefire.booter.SurefireBooterForkException: There was an error in the forked process\n  Error:  Cannot invoke &quot;java.lang.ThreadGroup.getName()&quot; because the return value of &quot;java.lang.Thread.getThreadGroup()&quot; is null\n  Error:  \tat org.apache.maven.plugin.surefire.booterclient.ForkStarter.fork(ForkStarter.java:628)\n  Error:  \tat org.apache.maven.plugin.surefire.booterclient.ForkStarter.lambda$null$3(ForkStarter.java:350)\n  Error:  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  Error:  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  Error:  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  Error:  \tat java.base/java.lang.Thread.run(Thread.java:840)\n  Error:  -&gt; [Help 1]\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Failed to execute goal org.apache.maven.plugins:maven-surefire-plugin:3.1.0:test (default-test) on project pulsar-transaction-coordinator: \n  Error:  \n  Error:  Please refer to /home/runner/work/pulsar/pulsar/pulsar-transaction/coordinator/target/surefire-reports for the individual test results.\n  Error:  Please refer to dump files (if any exist) [date].dump, [date]-jvmRun[N].dump and [date].dumpstream.\n  Error:  ExecutionException There was an error in the forked process\n  Error:  Cannot invoke \"java.lang.ThreadGroup.getName()\" because the return value of \"java.lang.Thread.getThreadGroup()\" is null\n  Error:  org.apache.maven.surefire.booter.SurefireBooterForkException: ExecutionException There was an error in the forked process\n  Error:  Cannot invoke \"java.lang.ThreadGroup.getName()\" because the return value of \"java.lang.Thread.getThreadGroup()\" is null\n  Error:  \tat org.apache.maven.plugin.surefire.booterclient.ForkStarter.awaitResultsDone(ForkStarter.java:456)\n  Error:  \tat org.apache.maven.plugin.surefire.booterclient.ForkStarter.runSuitesForkOnceMultiple(ForkStarter.java:358)\n  Error:  \tat org.apache.maven.plugin.surefire.booterclient.ForkStarter.run(ForkStarter.java:296)\n  Error:  \tat org.apache.maven.plugin.surefire.booterclient.ForkStarter.run(ForkStarter.java:250)\n  Error:  \tat org.apache.maven.plugin.surefire.AbstractSurefireMojo.executeProvider(AbstractSurefireMojo.java:1203)\n  Error:  \tat org.apache.maven.plugin.surefire.AbstractSurefireMojo.executeAfterPreconditionsChecked(AbstractSurefireMojo.java:1055)\n  Error:  \tat org.apache.maven.plugin.surefire.AbstractSurefireMojo.execute(AbstractSurefireMojo.java:871)\n  Error:  \tat com.gradle.maven.scan.extension.internal.d.a.executeMojo(SourceFile:114)\n  Error:  \tat org.apache.maven.lifecycle.internal.MojoExecutor.doExecute2(MojoExecutor.java:370)\n  Error:  \tat org.apache.maven.lifecycle.internal.MojoExecutor.doExecute(MojoExecutor.java:351)\n  Error:  \tat org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:215)\n  Error:  \tat org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:171)\n  Error:  \tat org.apache.maven.lifecycle.internal.MojoExecutor.execute(MojoExecutor.java:163)\n  Error:  \tat org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:117)\n  Error:  \tat org.apache.maven.lifecycle.internal.LifecycleModuleBuilder.buildProject(LifecycleModuleBuilder.java:81)\n  Error:  \tat org.apache.maven.lifecycle.internal.builder.singlethreaded.SingleThreadedBuilder.build(SingleThreadedBuilder.java:56)\n  Error:  \tat org.apache.maven.lifecycle.internal.LifecycleStarter.execute(LifecycleStarter.java:128)\n  Error:  \tat org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:299)\n  Error:  \tat org.apache.maven.DefaultMaven.doExecute(DefaultMaven.java:193)\n  Error:  \tat org.apache.maven.DefaultMaven.execute(DefaultMaven.java:106)\n  Error:  \tat org.apache.maven.cli.MavenCli.execute(MavenCli.java:963)\n  Error:  \tat org.apache.maven.cli.MavenCli.doMain(MavenCli.java:296)\n  Error:  \tat org.apache.maven.cli.MavenCli.main(MavenCli.java:199)\n  Error:  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  Error:  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  Error:  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  Error:  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  Error:  \tat org.codehaus.plexus.classworlds.launcher.Launcher.launchEnhanced(Launcher.java:282)\n  Error:  \tat org.codehaus.plexus.classworlds.launcher.Launcher.launch(Launcher.java:225)\n  Error:  \tat org.codehaus.plexus.classworlds.launcher.Launcher.mainWithExitCode(Launcher.java:406)\n  Error:  \tat org.codehaus.plexus.classworlds.launcher.Launcher.main(Launcher.java:347)\n  Error:  Caused by: org.apache.maven.surefire.booter.SurefireBooterForkException: There was an error in the forked process\n  Error:  Cannot invoke \"java.lang.ThreadGroup.getName()\" because the return value of \"java.lang.Thread.getThreadGroup()\" is null\n  Error:  \tat org.apache.maven.plugin.surefire.booterclient.ForkStarter.fork(ForkStarter.java:628)\n  Error:  \tat org.apache.maven.plugin.surefire.booterclient.ForkStarter.lambda$null$3(ForkStarter.java:350)\n  Error:  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  Error:  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  Error:  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  Error:  \tat java.base/java.lang.Thread.run(Thread.java:840)\n  Error:  -&gt; [Help 1]\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22056",
                "createdAt": "2024-02-15T09:06:46Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "help wanted"
                      }
                    },
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Cache the internal writer when sent to system topic.",
        "url": "https://github.com/apache/pulsar/pull/22099",
        "resourcePath": "/apache/pulsar/pull/22099",
        "createdAt": "2024-02-22T14:11:44Z",
        "number": 22099,
        "mergeCommit": {
          "oid": "8607905989081421c452e87db7b1eedececd7977",
          "message": "[improve][broker] Cache the internal writer when sent to system topic. (#22099)",
          "commitUrl": "https://github.com/apache/pulsar/commit/8607905989081421c452e87db7b1eedececd7977",
          "parents": {
            "nodes": [
              {
                "oid": "1c652f5519e013340e08950fc9705da4e54bf22a",
                "message": "[improve] [broker] Do not try to open ML when the topic meta does not exist and do not expect to create a new one. #21995 (#22004)\n\nCo-authored-by: Jiwe Guo <technoboy@apache.org>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/SystemTopicBasedTopicPoliciesService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/systopic/TopicPoliciesSystemTopicClient.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/SystemTopicBasedTopicPoliciesServiceTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5npxIk2gAoMDhhZmMyMzdhMjZiYmI0MzE5ZDczMzgyZmJkOTJkODQzZmFjOTQxNQ",
                "url": "https://github.com/apache/pulsar/pull/22099/commits/08afc237a26bbb4319d73382fbd92d843fac9415"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22087,
                "url": "https://github.com/apache/pulsar/issues/22087",
                "title": "[improve] Reuse the internal writer/reader under the same system topic",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">So far, Pulsar creates an internal producer to send the Pulsar Event and close it after it is sent immediately.</p>\n<p dir=\"auto\">The following Profile was captured when doing much topic creation and deletion.</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/25195800/306516990-aed99a04-51d5-46e9-b471-71285d9191e3.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM3NTMsIm5iZiI6MTcxNDk3MzQ1MywicGF0aCI6Ii8yNTE5NTgwMC8zMDY1MTY5OTAtYWVkOTlhMDQtNTFkNS00NmU5LWI0NzEtNzEyODVkOTE5MWUzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzA1M1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTI0MjUxNjdjMTE4MTc3NmQ4NzgzMzZlNjljMTI5ZmIxOTJiYjAzNDRjYzMzNzMzZDdhMDlmZjdlZjg5YjhkNzImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.PvG3jWkqp1LZHF-oI5UNz7bmymwMQFP6wnp1jevs2OE\"><img src=\"https://private-user-images.githubusercontent.com/25195800/306516990-aed99a04-51d5-46e9-b471-71285d9191e3.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM3NTMsIm5iZiI6MTcxNDk3MzQ1MywicGF0aCI6Ii8yNTE5NTgwMC8zMDY1MTY5OTAtYWVkOTlhMDQtNTFkNS00NmU5LWI0NzEtNzEyODVkOTE5MWUzLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzA1M1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTI0MjUxNjdjMTE4MTc3NmQ4NzgzMzZlNjljMTI5ZmIxOTJiYjAzNDRjYzMzNzMzZDdhMDlmZjdlZjg5YjhkNzImWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.PvG3jWkqp1LZHF-oI5UNz7bmymwMQFP6wnp1jevs2OE\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/25195800/306517760-1f466756-eefd-4334-b8f3-2023f4593806.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM3NTMsIm5iZiI6MTcxNDk3MzQ1MywicGF0aCI6Ii8yNTE5NTgwMC8zMDY1MTc3NjAtMWY0NjY3NTYtZWVmZC00MzM0LWI4ZjMtMjAyM2Y0NTkzODA2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzA1M1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTgzYTg3YmVkNDJiYmIwZWQzNDcwNmE0MDljYTNjMDQyZWQ2NTMxYTAyNTRiZGJlMWMxOWFkNmUwMWMxOGI2YTYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.mes2wQBVUlGubCKrviSgOBU3CzE4ATWCEIv6CLuNZqs\"><img width=\"1886\" alt=\"Screenshot 2024-02-21 at 14 19 30\" src=\"https://private-user-images.githubusercontent.com/25195800/306517760-1f466756-eefd-4334-b8f3-2023f4593806.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM3NTMsIm5iZiI6MTcxNDk3MzQ1MywicGF0aCI6Ii8yNTE5NTgwMC8zMDY1MTc3NjAtMWY0NjY3NTYtZWVmZC00MzM0LWI4ZjMtMjAyM2Y0NTkzODA2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzA1M1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTgzYTg3YmVkNDJiYmIwZWQzNDcwNmE0MDljYTNjMDQyZWQ2NTMxYTAyNTRiZGJlMWMxOWFkNmUwMWMxOGI2YTYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.mes2wQBVUlGubCKrviSgOBU3CzE4ATWCEIv6CLuNZqs\" style=\"max-width: 100%;\"></a>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">We can reuse the same writer/reader to improve the performance.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22087",
                "createdAt": "2024-02-21T06:21:45Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn] Prevent create state table from API calls for non-exists instances",
        "url": "https://github.com/apache/pulsar/pull/22107",
        "resourcePath": "/apache/pulsar/pull/22107",
        "createdAt": "2024-02-23T14:36:53Z",
        "number": 22107,
        "mergeCommit": {
          "oid": "5c44e1b356cf89bd57cb46390e9e890182778c2f",
          "message": "[fix][fn] Prevent create state table from API calls for non-exists instances (#22107)",
          "commitUrl": "https://github.com/apache/pulsar/commit/5c44e1b356cf89bd57cb46390e9e890182778c2f",
          "parents": {
            "nodes": [
              {
                "oid": "8607905989081421c452e87db7b1eedececd7977",
                "message": "[improve][broker] Cache the internal writer when sent to system topic. (#22099)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/rest/api/ComponentImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarStateTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5nw04V2gAoYjg4NWJiYWYwMDgzZTBhMmVlNzcwMjlhNWYwZjFmMmZiMjRhY2ZkZg",
                "url": "https://github.com/apache/pulsar/pull/22107/commits/b885bbaf0083e0a2ee77029a5f0f1f2fb24acfdf"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22108,
                "url": "https://github.com/apache/pulsar/issues/22108",
                "title": "[Bug] State APIs calls create stream table for non-existed instances",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">v3.2.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\"><code class=\"notranslate\">pulsar-admin functions putstate --tenant public --namespace default --name non-exist --state \"{\\\"key\\\":\\\"test-string\\\",\\\"stringValue\\\":\\\"test value\\\"}\"</code></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">should throw error showing the stream table does not exists</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">the stream table was created without any error.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22108",
                "createdAt": "2024-02-23T14:43:36Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[bug][fn] Prevent `putstate` uses empty values",
        "url": "https://github.com/apache/pulsar/pull/22127",
        "resourcePath": "/apache/pulsar/pull/22127",
        "createdAt": "2024-02-26T14:19:37Z",
        "number": 22127,
        "mergeCommit": {
          "oid": "430f4ffddcd61e0997320365b9fc4470b5492494",
          "message": "[bug][fn] Prevent `putstate` uses empty values (#22127)",
          "commitUrl": "https://github.com/apache/pulsar/commit/430f4ffddcd61e0997320365b9fc4470b5492494",
          "parents": {
            "nodes": [
              {
                "oid": "ae050a151f0a00d6d6551e3c77897e48dfe464fd",
                "message": "[improve][ci] Upgrade codecov-action version (#22123)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/worker/src/main/java/org/apache/pulsar/functions/worker/rest/api/ComponentImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "tests/integration/src/test/java/org/apache/pulsar/tests/integration/functions/PulsarStateTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5n7BBz2gAoZWFkNDdmNjQ1ZGExYmYxMmY5YzVlZjZiMjYzMDUwZTA5ZDE4MmY4MA",
                "url": "https://github.com/apache/pulsar/pull/22127/commits/ead47f645da1bf12f9c5ef6b263050e09d182f80"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22126,
                "url": "https://github.com/apache/pulsar/issues/22126",
                "title": "[Bug] `FunctionState` with empty `stringValue` will overwrite the `byteValue`",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">3.2.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ul dir=\"auto\">\n<li>start pulsar 3.2.0 standalone with functions worker enabled</li>\n<li>create a new pulsar function <code class=\"notranslate\">pulsarctl functions create --jar api-examples.jar --classname org.apache.pulsar.functions.api.examples.ExclamationFunction --inputs public/default/input --output public/default/output --name f</code></li>\n<li>generate a bin file: <code class=\"notranslate\">echo -ne '\\x42\\x43\\x44' &gt; file.bin</code></li>\n<li>putstate with pulsarctl with a byte content: <code class=\"notranslate\">pulsarctl functions putstate --tenant public --namespace default --name f test-bytes = data.bin</code></li>\n<li>querystate with pulsarctl: <code class=\"notranslate\">pulsarctl functions querystate --tenant public --namespace default --name f --key test-bytes</code></li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{\n  &quot;key&quot;: &quot;test-bytes&quot;,\n  &quot;stringValue&quot;: &quot;&quot;,\n  &quot;byteValue&quot;: null,\n  &quot;numberValue&quot;: 0,\n  &quot;version&quot;: 2\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">{\n  \"key\": \"test-bytes\",\n  \"stringValue\": \"\",\n  \"byteValue\": null,\n  \"numberValue\": 0,\n  \"version\": 2\n}\n</code></pre></div>\n<ul dir=\"auto\">\n<li>querystate with pulsaradmin: <code class=\"notranslate\">pulsar-admin functions querystate --tenant public --namespace default --name f --key test-bytes</code></li>\n</ul>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{\n  &quot;key&quot;: &quot;test-bytes&quot;,\n  &quot;stringValue&quot;: &quot;&quot;,\n  &quot;version&quot;: 2\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">{\n  \"key\": \"test-bytes\",\n  \"stringValue\": \"\",\n  \"version\": 2\n}\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{\n  &quot;key&quot;: &quot;test-bytes&quot;,\n  &quot;stringValue&quot;: &quot;BCD&quot;,\n  &quot;byteValue&quot;: null,\n  &quot;numberValue&quot;: 0,\n  &quot;version&quot;: 1\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">{\n  \"key\": \"test-bytes\",\n  \"stringValue\": \"BCD\",\n  \"byteValue\": null,\n  \"numberValue\": 0,\n  \"version\": 1\n}\n</code></pre></div>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{\n  &quot;key&quot;: &quot;test-bytes&quot;,\n  &quot;stringValue&quot;: &quot;&quot;,\n  &quot;byteValue&quot;: null,\n  &quot;numberValue&quot;: 0,\n  &quot;version&quot;: 2\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">{\n  \"key\": \"test-bytes\",\n  \"stringValue\": \"\",\n  \"byteValue\": null,\n  \"numberValue\": 0,\n  \"version\": 2\n}\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22126",
                "createdAt": "2024-02-26T14:09:03Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][txn]Fix TopicTransactionBuffer potential thread safety issue",
        "url": "https://github.com/apache/pulsar/pull/22149",
        "resourcePath": "/apache/pulsar/pull/22149",
        "createdAt": "2024-02-28T10:34:09Z",
        "number": 22149,
        "mergeCommit": {
          "oid": "74be3fd4917a2327f2da9b5b55cc572b3c1f4e84",
          "message": "[fix][txn]Fix TopicTransactionBuffer potential thread safety issue (#22149)",
          "commitUrl": "https://github.com/apache/pulsar/commit/74be3fd4917a2327f2da9b5b55cc572b3c1f4e84",
          "parents": {
            "nodes": [
              {
                "oid": "e25c7f045753b949c5ecd492bd7b7a77440c6937",
                "message": "[fix][offload] Fix Offload readHandle cannot close multi times. (#22162)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/impl/TopicTransactionBuffer.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5oJ3ih2gAoYWFlYzQxZjZiNGJjNzQ2YjIzM2ZkMzdlNmQyNWY1Yzc2NDA3NTE3NA",
                "url": "https://github.com/apache/pulsar/pull/22149/commits/aaec41f6b4bc746b233fd37e6d25f5c764075174"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22119,
                "url": "https://github.com/apache/pulsar/issues/22119",
                "title": "[Bug] TopicTransactionBuffer contains potential thread safety issues",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">The <code class=\"notranslate\">ongoingTxns</code> field is a LinkedMap which isn't thread safe.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">thread safe handling in TopicTransactionBuffer</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\"><code class=\"notranslate\">ongoingTxns</code> is handled in a problematic way. There are multiple threads that both mutate and read the collection.<br>\nIt's possible that this isn't a problem, but it's very hard to reason about the thread safetyness of the code currently.</p>\n<p dir=\"auto\">There definitely have been attempts to ensure thread safety. There seems to be an assumption that it's fine to either have <code class=\"notranslate\">synchronized (TopicTransactionBuffer.this) {</code> or run on a single thread such as<br>\n<code class=\"notranslate\">topic.getBrokerService().getPulsar().getTransactionExecutorProvider().getExecutor(this)</code>, to make it thread safe.</p>\n<p dir=\"auto\">One note about <code class=\"notranslate\">topic.getBrokerService().getPulsar().getTransactionExecutorProvider().getExecutor(this)</code> is that <code class=\"notranslate\">this</code> is pointing to different object instances in the code base. It wouldn't be ensuring single threaded access to all accesses of the object instances that are handled.</p>\n<p dir=\"auto\">It is possible that thread safety is achieved through ways that are hard to observe. As long as all accesses form a \"happens-before\" chain, even through \"piggy backing\", it's possible that the code is after all thread safe. The problem is that a small change might break that and the solution is very brittle. Thread safety issues are very hard to notice. The best way to prevent them is to write code that is thread safe.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22119",
                "createdAt": "2024-02-26T07:06:40Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][cli] Fix the bug when set-retention specified size with -T",
        "url": "https://github.com/apache/pulsar/pull/22150",
        "resourcePath": "/apache/pulsar/pull/22150",
        "createdAt": "2024-02-28T10:57:38Z",
        "number": 22150,
        "mergeCommit": {
          "oid": "f33a3f4ad9e477e8b78476640c65314dab62e46a",
          "message": "[fix][cli] Fix the bug when set-retention specified size with -T (#22150)",
          "commitUrl": "https://github.com/apache/pulsar/commit/f33a3f4ad9e477e8b78476640c65314dab62e46a",
          "parents": {
            "nodes": [
              {
                "oid": "15a6c0fa8a82b8c7f6d9b7abbddf216c376b569f",
                "message": "[improve][ci] Only run CodeQL when the PR contains changes to non-test java code (#22146)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/admin/cli/CmdNamespaces.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-client-tools/src/test/java/org/apache/pulsar/admin/cli/TestCmdNamespaces.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5oKBtI2gAoYzNmZDY5MzgwYTBlZjhmNjNlMWNmMTc1YTEzZTU0MGMxNjQzZmUyNA",
                "url": "https://github.com/apache/pulsar/pull/22150/commits/c3fd69380a0ef8f63e1cf175a13e540c1643fe24"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22138,
                "url": "https://github.com/apache/pulsar/issues/22138",
                "title": "[Bug] pulsar-admin set-retention reports an invalid retention policy when size != -1",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar 3.2.0, official x86 Docker image.</p>\n<p dir=\"auto\">Did not see this error on Pulsar 3.1.2.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Have an existing namespace with some existing persistent topics.</li>\n<li><code class=\"notranslate\">kubectl exec -it</code> into a Broker pod <code class=\"notranslate\">bash</code> shell.</li>\n<li>Run <code class=\"notranslate\">./bin/pulsar-admin namespaces set-retention my_tenant/my_namespace -s 5T -t 2h</code></li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">The CLI should produce no output when the command completes successfully, and the retention policy returned with <code class=\"notranslate\">get-retention</code> should reflect the desired size and time parameters.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2024-02-27T17:25:16,809+0000 [AsyncHttpClient-7-1] WARN  org.apache.pulsar.client.admin.internal.BaseResource - [http://localhost:8080/admin/v2/namespaces/my_tenant/my_namespace/retention] Failed to perform http post request: javax.ws.rs.BadRequestException: HTTP 400 {&quot;reason&quot;:&quot;Invalid retention policy: Setting a single time or size limit to 0 is invalid when one of the limits has a non-zero value. Use the value of -1 instead of 0 to ignore a specific limit. To disable retention both limits must be set to 0.&quot;}\nInvalid retention policy: Setting a single time or size limit to 0 is invalid when one of the limits has a non-zero value. Use the value of -1 instead of 0 to ignore a specific limit. To disable retention both limits must be set to 0.\n\nReason: Invalid retention policy: Setting a single time or size limit to 0 is invalid when one of the limits has a non-zero value. Use the value of -1 instead of 0 to ignore a specific limit. To disable retention both limits must be set to 0.\"><pre class=\"notranslate\"><code class=\"notranslate\">2024-02-27T17:25:16,809+0000 [AsyncHttpClient-7-1] WARN  org.apache.pulsar.client.admin.internal.BaseResource - [http://localhost:8080/admin/v2/namespaces/my_tenant/my_namespace/retention] Failed to perform http post request: javax.ws.rs.BadRequestException: HTTP 400 {\"reason\":\"Invalid retention policy: Setting a single time or size limit to 0 is invalid when one of the limits has a non-zero value. Use the value of -1 instead of 0 to ignore a specific limit. To disable retention both limits must be set to 0.\"}\nInvalid retention policy: Setting a single time or size limit to 0 is invalid when one of the limits has a non-zero value. Use the value of -1 instead of 0 to ignore a specific limit. To disable retention both limits must be set to 0.\n\nReason: Invalid retention policy: Setting a single time or size limit to 0 is invalid when one of the limits has a non-zero value. Use the value of -1 instead of 0 to ignore a specific limit. To disable retention both limits must be set to 0.\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">We've run this command on Pulsar 3.1.2 with the same tenant/namespace &amp; identical time and size retention parameters, and it completed successfully. Only after upgrading to 3.2.0 have we started seeing this error. Trying it other tenant/namespaces gives the same error, too.</p>\n<p dir=\"auto\">Importantly for root-causing this, there are <code class=\"notranslate\">set-retention</code> commands that do work.</p>\n<p dir=\"auto\"><em>Working:</em><br>\n<code class=\"notranslate\">./bin/pulsar-admin namespaces set-retention my_tenant/my_namespace -t 12h -s -1</code><br>\n<code class=\"notranslate\">./bin/pulsar-admin namespaces set-retention my_tenant/my_namespace -t 24h -s -1</code><br>\n<code class=\"notranslate\">./bin/pulsar-admin namespaces set-retention my_tenant/my_namespace -t -1 -s -1</code><br>\n<code class=\"notranslate\">./bin/pulsar-admin namespaces set-retention my_tenant/my_namespace -s -1 -t 12h</code></p>\n<p dir=\"auto\"><em>Not working:</em><br>\n<code class=\"notranslate\">./bin/pulsar-admin namespaces set-retention my_tenant/my_namespace -t -1 -s 5T</code><br>\n<code class=\"notranslate\">./bin/pulsar-admin namespaces set-retention my_tenant/my_namespace -s 1000G -t 12h</code></p>\n<p dir=\"auto\">It looks like the command fails whenever <code class=\"notranslate\">size != -1</code>.</p>\n<p dir=\"auto\">I also verified with <code class=\"notranslate\">get-retention</code> that the policy still appears to update when <code class=\"notranslate\">set-retention</code> returns successfully, e.g. for <code class=\"notranslate\">-t 12h -s -1</code>, <code class=\"notranslate\">get-retention</code> returns:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"{\n  &quot;retentionTimeInMinutes&quot; : 720,\n  &quot;retentionSizeInMB&quot; : -1\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">{\n  \"retentionTimeInMinutes\" : 720,\n  \"retentionSizeInMB\" : -1\n}\n</code></pre></div>\n<p dir=\"auto\">In case it matters, this tenant/namespace has a <code class=\"notranslate\">message_age</code> backlog quota enabled. I tried different size/time arguments (with <code class=\"notranslate\">size != -1</code>) relative to the respective backlog parameters and it didn't make a difference.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22138",
                "createdAt": "2024-02-27T17:59:03Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Optimize seeking by timestamp",
        "url": "https://github.com/apache/pulsar/pull/22152",
        "resourcePath": "/apache/pulsar/pull/22152",
        "createdAt": "2024-02-28T14:19:05Z",
        "number": 22152,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentMessageFinder.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/TransactionBuffer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/impl/InMemTransactionBuffer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/impl/TopicTransactionBuffer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/impl/TransactionBufferDisable.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/delayed/MockManagedCursor.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/PersistentTopicTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/SubscriptionSeekTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/transaction/buffer/TransactionBufferTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5oLZnM2gAoM2Q1OWNkYTkxNTE2OWQ5M2M2MTBmYTdlZmE1NTA0YWI4ODRlMTgxNw",
                "url": "https://github.com/apache/pulsar/pull/22152/commits/3d59cda915169d93c610fa7efa5504ab884e1817"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22129,
                "url": "https://github.com/apache/pulsar/issues/22129",
                "title": "Optimise seeking by timestamp",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Right now it seems that seeking a reader or a consumer to a specific timestamp is an unoptimised process that can take many seconds / over a minute for larger topics (single GB data size, tens of messages per second). From a slack comment <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/lhotari/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/lhotari\">@lhotari</a> it appears that seeking via a timestamp is not optimised, and I'm here to propose optimising it as a valuable feature.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Seeking currently works by message ID or by timestamp. I <em>assume</em> (though I could be wrong) that seeking by messageID <em>is</em> optimised. Without going into the implementation details properly and just spitballing ideas, something like binary searching on the time, or creating a treemap from timestamp to message ID (at any level of sparsity) might allow seeking to become far faster</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22129",
                "createdAt": "2024-02-27T08:35:30Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [client] Do no retrying for error subscription not found when disabled allowAutoSubscriptionCreation",
        "url": "https://github.com/apache/pulsar/pull/22164",
        "resourcePath": "/apache/pulsar/pull/22164",
        "createdAt": "2024-02-29T11:18:29Z",
        "number": 22164,
        "mergeCommit": {
          "oid": "ccc2ea67c192b4771c9af30c6eaf994fe01958e5",
          "message": "[fix] [client] Do no retrying for error subscription not found when disabled allowAutoSubscriptionCreation (#22164)\n\nCo-authored-by: zifengmo <38554710+zifengmo@users.noreply.github.com>",
          "commitUrl": "https://github.com/apache/pulsar/commit/ccc2ea67c192b4771c9af30c6eaf994fe01958e5",
          "parents": {
            "nodes": [
              {
                "oid": "74be3fd4917a2327f2da9b5b55cc572b3c1f4e84",
                "message": "[fix][txn]Fix TopicTransactionBuffer potential thread safety issue (#22149)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerServiceException.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/MultiTopicsConsumerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/PulsarClientException.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ClientCnx.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5oR_8J2gAoYjg4ZmU4Y2M0ODI1Zjg4MDUwZTE2ZWE2NTZhZGZhZjcyODY1YjBhMg",
                "url": "https://github.com/apache/pulsar/pull/22164/commits/b88fe8cc4825f88050e16ea656adfaf72865b0a2"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21839,
                "url": "https://github.com/apache/pulsar/issues/21839",
                "title": "The consumer clients created by the Proxy using the WebSocket protocol may cause request blocking.",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">In our usage scenario, the ability to create subscriptions directly through the consumer client has been disabled.<br>\nThis leads to a problem where the Proxy creates consumer clients for consuming topics via WebSocket. In certain exceptional cases, these clients will keep retrying to connect to the broker, such as when encountering a SubscriptionNotFoundException (\"Subscription does not exist\"). However, this exception is considered retryable, causing the Proxy to continuously attempt to connect to the broker for subscription.<br>\nBecause this exception leads to retries and bypasses the consumer quantity verification, it causes the Proxy to continuously retry the subscription, blocking normal requests.<br>\nTherefore, it is desired to have special handling for consumer clients created through the Proxy, or to subtract something specific for retryable exceptions, in order to avoid situations like the one mentioned above where such exceptions trigger retries in the Proxy.</p>\n<p dir=\"auto\">Code Example:<br>\npublic static boolean isRetriableError(Throwable t) {<br>\nif (t instanceof AuthorizationException<br>\n|| t instanceof InvalidServiceURL<br>\n|| t instanceof InvalidConfigurationException<br>\n|| t instanceof NotFoundException<br>\n|| t instanceof IncompatibleSchemaException<br>\n|| t instanceof TopicDoesNotExistException<br>\n|| t instanceof UnsupportedAuthenticationException<br>\n|| t instanceof InvalidMessageException<br>\n|| t instanceof InvalidTopicNameException<br>\n|| t instanceof NotSupportedException<br>\n|| t instanceof NotAllowedException<br>\n|| t instanceof ChecksumException<br>\n|| t instanceof CryptoException<br>\n|| t instanceof ConsumerAssignException<br>\n|| t instanceof MessageAcknowledgeException<br>\n|| t instanceof TransactionConflictException<br>\n|| t instanceof ProducerBusyException<br>\n|| t instanceof ConsumerBusyException<br>\n|| t instanceof TransactionHasOperationFailedException) {<br>\nreturn false;<br>\n}<br>\nreturn true;<br>\n}</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21839",
                "createdAt": "2024-01-03T08:20:16Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][txn] Fix PendingAckHandleImpl potential thread safety issue",
        "url": "https://github.com/apache/pulsar/pull/22166",
        "resourcePath": "/apache/pulsar/pull/22166",
        "createdAt": "2024-02-29T14:54:19Z",
        "number": 22166,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/pendingack/impl/PendingAckHandleImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5oTf5B2gAoZjlmYzg4YjhjN2MwMzY2Zjk1MzI3OGRlYjRmNDUyZjNhY2IzYjQxNg",
                "url": "https://github.com/apache/pulsar/pull/22166/commits/f9fc88b8c7c0366f953278deb4f452f3acb3b416"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21304,
                "url": "https://github.com/apache/pulsar/issues/21304",
                "title": "[Task] Fix thread safety of PendingAckHandleImpl",
                "bodyHTML": "<p dir=\"auto\">PendingAckHandleImpl seems to contain some thread safety issues:<br>\nindividualAckOfTransaction uses org.apache.commons.collections4.map.LinkedMap which is not thread safe.<br>\nAnother thread safety issue is the mutation of MutablePair instance. MutablePair is not thread safe.<br>\nHashMaps are also used as mutable state.<br>\nThis state is mutated without a guarantee that the same thread is reading and writing the state or there's some other way to ensure consistency according to the Java Memory Model.</p>\n<p dir=\"auto\">It seems that the intention would be use a single thread execution model to address this. There's a internalPinnedExecutor in<br>\n<a href=\"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/pendingack/impl/PendingAckHandleImpl.java\">PendingAckHandleImpl</a> which is used to run some operations on the single executor thread.<br>\nHowever, the thread could possibly get switched multiple times in the call chain because of asynchronous method calls.</p>\n<p dir=\"auto\">There's also some code where synchronized blocks are used as a way to ensure consistency such as<br>\n<code class=\"notranslate\">synchronized (org.apache.pulsar.broker.transaction.pendingack.impl.PendingAckHandleImpl.this) {</code> and <code class=\"notranslate\">synchronized (PendingAckHandleImpl.this) {</code>.<br>\nThis is bad since the thread that gets synchronized is whatever thread is completing the asynchronous call. This might for example block threads from the bookkeeper client.</p>",
                "resourcePath": "/apache/pulsar/issues/21304",
                "createdAt": "2023-10-06T10:35:56Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/transaction"
                      }
                    },
                    {
                      "node": {
                        "name": "category/reliability"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][client] add externalListenerThreadName parameter",
        "url": "https://github.com/apache/pulsar/pull/22174",
        "resourcePath": "/apache/pulsar/pull/22174",
        "createdAt": "2024-03-01T11:35:20Z",
        "number": 22174,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/ClientBuilder.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ClientBuilderImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PulsarClientImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/conf/ClientConfigurationData.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/PulsarClientImplTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5oZiTY2gAoMDRhYjNjNzk3YjA4OTU2NzgzODU1NWVkYTNhMTBhNDhiNjEwNDBlOQ",
                "url": "https://github.com/apache/pulsar/pull/22174/commits/04ab3c797b089567838555eda3a10a48b61040e9"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22170,
                "url": "https://github.com/apache/pulsar/issues/22170",
                "title": "Aim to rename prefix 'pulsar-external-listener' in threads java client",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">While consuming a message, code executed by Consumers is done on a thread pool. Thread name are prefixed by <code class=\"notranslate\">pulsar-external-listener-</code>. While logging, we are writing thread name as a prefix of each line.</p>\n<p dir=\"auto\">This hard-coded name 'pulsar-external-listener' is too generic for us and too long. We want to rename it by ourselves.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Add a configuration option in the client to set the external-listener-thread name.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22170",
                "createdAt": "2024-03-01T07:58:16Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky test BrokerServiceAutoSubscriptionCreationTest",
        "url": "https://github.com/apache/pulsar/pull/22190",
        "resourcePath": "/apache/pulsar/pull/22190",
        "createdAt": "2024-03-04T12:27:46Z",
        "number": 22190,
        "mergeCommit": {
          "oid": "8c7c9788119197ac78bb90dfb030b1883139c026",
          "message": "[fix][test] Fix flaky test BrokerServiceAutoSubscriptionCreationTest (#22190)",
          "commitUrl": "https://github.com/apache/pulsar/commit/8c7c9788119197ac78bb90dfb030b1883139c026",
          "parents": {
            "nodes": [
              {
                "oid": "ccc2ea67c192b4771c9af30c6eaf994fe01958e5",
                "message": "[fix] [client] Do no retrying for error subscription not found when disabled allowAutoSubscriptionCreation (#22164)\n\nCo-authored-by: zifengmo <38554710+zifengmo@users.noreply.github.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceAutoSubscriptionCreationTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5olYfa2gAoYjhiMTE1Mzg5OTQzNjU1ODg1MzRiYTY0YmE4ODI3N2Y3NTc3MWE3NQ",
                "url": "https://github.com/apache/pulsar/pull/22190/commits/b8b11538994365588534ba64ba88277f75771a75"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22188,
                "url": "https://github.com/apache/pulsar/issues/22188",
                "title": "Flaky-test: BrokerServiceAutoSubscriptionCreationTest.testDynamicConfigurationTopicAutoSubscriptionCreation",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/8136935185/job/22240350361?pr=22184#step:11:1157\">https://github.com/apache/pulsar/actions/runs/8136935185/job/22240350361?pr=22184#step:11:1157</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 11, Failures: 1, Errors: 0, Skipped: 7, Time elapsed: 10.628 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.BrokerServiceAutoSubscriptionCreationTest\n  Error:  org.apache.pulsar.broker.service.BrokerServiceAutoSubscriptionCreationTest.testDynamicConfigurationTopicAutoSubscriptionCreation  Time elapsed: 0.15 s  &lt;&lt;&lt; FAILURE!\n  org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException$SubscriptionNotFoundException: {&quot;errorMsg&quot;:&quot;Subscription does not exist&quot;,&quot;reqId&quot;:33671419909063575, &quot;remote&quot;:&quot;localhost/127.0.0.1:37895&quot;, &quot;local&quot;:&quot;/127.0.0.1:33662&quot;}\n  \tat org.apache.pulsar.client.api.PulsarClientException.unwrap(PulsarClientException.java:1131)\n  \tat org.apache.pulsar.client.impl.ConsumerBuilderImpl.subscribe(ConsumerBuilderImpl.java:103)\n  \tat org.apache.pulsar.broker.service.BrokerServiceAutoSubscriptionCreationTest.testDynamicConfigurationTopicAutoSubscriptionCreation(BrokerServiceAutoSubscriptionCreationTest.java:169)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:840)\n  Caused by: java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException$SubscriptionNotFoundException: {&quot;errorMsg&quot;:&quot;Subscription does not exist&quot;,&quot;reqId&quot;:33671419909063575, &quot;remote&quot;:&quot;localhost/127.0.0.1:37895&quot;, &quot;local&quot;:&quot;/127.0.0.1:33662&quot;}\n  \tat java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:396)\n  \tat java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2073)\n  \tat org.apache.pulsar.client.impl.ConsumerBuilderImpl.subscribe(ConsumerBuilderImpl.java:101)\n  \t... 13 more\n  Caused by: org.apache.pulsar.client.api.PulsarClientException$SubscriptionNotFoundException: {&quot;errorMsg&quot;:&quot;Subscription does not exist&quot;,&quot;reqId&quot;:33671419909063575, &quot;remote&quot;:&quot;localhost/127.0.0.1:37895&quot;, &quot;local&quot;:&quot;/127.0.0.1:33662&quot;}\n  \tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:1340)\n  \tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:795)\n  \tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:192)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)\n  \tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \tat io.netty.handler.flush.FlushConsolidationHandler.channelRead(FlushConsolidationHandler.java:152)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n  \tat io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:800)\n  \tat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:509)\n  \tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:407)\n  \tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\n  \tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \t... 1 more\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 11, Failures: 1, Errors: 0, Skipped: 7, Time elapsed: 10.628 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.service.BrokerServiceAutoSubscriptionCreationTest\n  Error:  org.apache.pulsar.broker.service.BrokerServiceAutoSubscriptionCreationTest.testDynamicConfigurationTopicAutoSubscriptionCreation  Time elapsed: 0.15 s  &lt;&lt;&lt; FAILURE!\n  org.apache.pulsar.client.api.PulsarClientException: java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException$SubscriptionNotFoundException: {\"errorMsg\":\"Subscription does not exist\",\"reqId\":33671419909063575, \"remote\":\"localhost/127.0.0.1:37895\", \"local\":\"/127.0.0.1:33662\"}\n  \tat org.apache.pulsar.client.api.PulsarClientException.unwrap(PulsarClientException.java:1131)\n  \tat org.apache.pulsar.client.impl.ConsumerBuilderImpl.subscribe(ConsumerBuilderImpl.java:103)\n  \tat org.apache.pulsar.broker.service.BrokerServiceAutoSubscriptionCreationTest.testDynamicConfigurationTopicAutoSubscriptionCreation(BrokerServiceAutoSubscriptionCreationTest.java:169)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:840)\n  Caused by: java.util.concurrent.ExecutionException: org.apache.pulsar.client.api.PulsarClientException$SubscriptionNotFoundException: {\"errorMsg\":\"Subscription does not exist\",\"reqId\":33671419909063575, \"remote\":\"localhost/127.0.0.1:37895\", \"local\":\"/127.0.0.1:33662\"}\n  \tat java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:396)\n  \tat java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2073)\n  \tat org.apache.pulsar.client.impl.ConsumerBuilderImpl.subscribe(ConsumerBuilderImpl.java:101)\n  \t... 13 more\n  Caused by: org.apache.pulsar.client.api.PulsarClientException$SubscriptionNotFoundException: {\"errorMsg\":\"Subscription does not exist\",\"reqId\":33671419909063575, \"remote\":\"localhost/127.0.0.1:37895\", \"local\":\"/127.0.0.1:33662\"}\n  \tat org.apache.pulsar.client.impl.ClientCnx.getPulsarClientException(ClientCnx.java:1340)\n  \tat org.apache.pulsar.client.impl.ClientCnx.handleError(ClientCnx.java:795)\n  \tat org.apache.pulsar.common.protocol.PulsarDecoder.channelRead(PulsarDecoder.java:192)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)\n  \tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \tat io.netty.handler.flush.FlushConsolidationHandler.channelRead(FlushConsolidationHandler.java:152)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n  \tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n  \tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n  \tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n  \tat io.netty.channel.epoll.AbstractEpollStreamChannel$EpollStreamUnsafe.epollInReady(AbstractEpollStreamChannel.java:800)\n  \tat io.netty.channel.epoll.EpollEventLoop.processReady(EpollEventLoop.java:509)\n  \tat io.netty.channel.epoll.EpollEventLoop.run(EpollEventLoop.java:407)\n  \tat io.netty.util.concurrent.SingleThreadEventExecutor$4.run(SingleThreadEventExecutor.java:997)\n  \tat io.netty.util.internal.ThreadExecutorMap$2.run(ThreadExecutorMap.java:74)\n  \tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n  \t... 1 more\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22188",
                "createdAt": "2024-03-04T11:27:17Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Check cursor state before adding it to the `waitingCursors`",
        "url": "https://github.com/apache/pulsar/pull/22191",
        "resourcePath": "/apache/pulsar/pull/22191",
        "createdAt": "2024-03-04T13:47:12Z",
        "number": 22191,
        "mergeCommit": {
          "oid": "b702d440dc5e5a4cfd845bf60d5e310efe665ff5",
          "message": "[fix][broker] Check cursor state before adding it to the `waitingCursors` (#22191)",
          "commitUrl": "https://github.com/apache/pulsar/commit/b702d440dc5e5a4cfd845bf60d5e310efe665ff5",
          "parents": {
            "nodes": [
              {
                "oid": "f77fe5f099f7ecc334509db07bba477c4226cf19",
                "message": "[fix][broker] Avoid expired unclosed ledgers when checking expired messages by ledger closure time (#22335)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PersistentTopicTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ol7Tt2gAoOTFlYzdiOTA1NTlhYzA3Y2QxZTM0MjZlYWY5ODIzZTBmMmY4MDgwYw",
                "url": "https://github.com/apache/pulsar/pull/22191/commits/91ec7b90559ac07cd1e3426eaf9823e0f2f8080c"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22157,
                "url": "https://github.com/apache/pulsar/issues/22157",
                "title": "[Bug] Broker memory leak ",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">v3.1.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">After running for a period of time, the broker memory will gradually increase and eventually lead to a restart.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/21187269/308779914-74c6be15-bc83-448c-bce3-6f948e0884e6.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM4NzcsIm5iZiI6MTcxNDk3MzU3NywicGF0aCI6Ii8yMTE4NzI2OS8zMDg3Nzk5MTQtNzRjNmJlMTUtYmM4My00NDhjLWJjZTMtNmY5NDhlMDg4NGU2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzI1N1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWUzMTZkMWI0ODBlZGJmOTJkM2M0NTgxMWEzYmQ3NzEwNWY5ZWJhN2Q4YzY4MDliMDU2YmIzOWIxMjg3NzU4MTMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.LYUQBvgDKAltCcdEpo-yddWW8nZW7Gbn4WUAIEtwjwA\"><img src=\"https://private-user-images.githubusercontent.com/21187269/308779914-74c6be15-bc83-448c-bce3-6f948e0884e6.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM4NzcsIm5iZiI6MTcxNDk3MzU3NywicGF0aCI6Ii8yMTE4NzI2OS8zMDg3Nzk5MTQtNzRjNmJlMTUtYmM4My00NDhjLWJjZTMtNmY5NDhlMDg4NGU2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzI1N1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWUzMTZkMWI0ODBlZGJmOTJkM2M0NTgxMWEzYmQ3NzEwNWY5ZWJhN2Q4YzY4MDliMDU2YmIzOWIxMjg3NzU4MTMmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.LYUQBvgDKAltCcdEpo-yddWW8nZW7Gbn4WUAIEtwjwA\" alt=\"\u4f01\u4e1a\u5fae\u4fe1\u622a\u56fe_6fc91d9b-5071-41bd-a698-d7c7c8a5b975\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">After the heap dump, it was found that many ManagedLedgerImpl instances were retained in the memory, and these instances occupied most of the memory.</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/21187269/308781056-cfc71bbc-8593-4565-8b97-bd84be15db1f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM4NzcsIm5iZiI6MTcxNDk3MzU3NywicGF0aCI6Ii8yMTE4NzI2OS8zMDg3ODEwNTYtY2ZjNzFiYmMtODU5My00NTY1LThiOTctYmQ4NGJlMTVkYjFmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzI1N1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWVkN2E2OGM0YjY3NzlhYjdjMTkzNDU2NmE1NTQ1NGRhYTdmYmZiYjA3ZDIyMTQzOTcwZjZmODAwNGRjNDQ1NGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.K2rBz12SI_1BwxWLgq5al6bDgmF1olhAumF0UcF_DTs\"><img src=\"https://private-user-images.githubusercontent.com/21187269/308781056-cfc71bbc-8593-4565-8b97-bd84be15db1f.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM4NzcsIm5iZiI6MTcxNDk3MzU3NywicGF0aCI6Ii8yMTE4NzI2OS8zMDg3ODEwNTYtY2ZjNzFiYmMtODU5My00NTY1LThiOTctYmQ4NGJlMTVkYjFmLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzI1N1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWVkN2E2OGM0YjY3NzlhYjdjMTkzNDU2NmE1NTQ1NGRhYTdmYmZiYjA3ZDIyMTQzOTcwZjZmODAwNGRjNDQ1NGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.K2rBz12SI_1BwxWLgq5al6bDgmF1olhAumF0UcF_DTs\" alt=\"\u4f01\u4e1a\u5fae\u4fe1\u622a\u56fe_a61faea0-4ef0-4488-905f-c91d5275cf37\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">Common Path To the Accumulation Point\uff1a<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/21187269/308781306-cae8ad90-e218-430b-b8f0-d57f2a981484.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM4NzcsIm5iZiI6MTcxNDk3MzU3NywicGF0aCI6Ii8yMTE4NzI2OS8zMDg3ODEzMDYtY2FlOGFkOTAtZTIxOC00MzBiLWI4ZjAtZDU3ZjJhOTgxNDg0LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzI1N1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWFiZTIzZmUzZDBlZjFjMWE3OWU4OGVlMWUxNDQwODQzM2NjOGEzNWI4YTNjNDNiZDk4YTZkMTc3YjY3YWI5ZTYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.9lTkjoAj5h269C52M2TJ_y_SOkEsE1B4b5e6klFFu6Q\"><img src=\"https://private-user-images.githubusercontent.com/21187269/308781306-cae8ad90-e218-430b-b8f0-d57f2a981484.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM4NzcsIm5iZiI6MTcxNDk3MzU3NywicGF0aCI6Ii8yMTE4NzI2OS8zMDg3ODEzMDYtY2FlOGFkOTAtZTIxOC00MzBiLWI4ZjAtZDU3ZjJhOTgxNDg0LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzI1N1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWFiZTIzZmUzZDBlZjFjMWE3OWU4OGVlMWUxNDQwODQzM2NjOGEzNWI4YTNjNDNiZDk4YTZkMTc3YjY3YWI5ZTYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.9lTkjoAj5h269C52M2TJ_y_SOkEsE1B4b5e6klFFu6Q\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/21187269/308781462-6cd9c36d-8bba-48dd-89c6-46db03fcb0f2.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM4NzcsIm5iZiI6MTcxNDk3MzU3NywicGF0aCI6Ii8yMTE4NzI2OS8zMDg3ODE0NjItNmNkOWMzNmQtOGJiYS00OGRkLTg5YzYtNDZkYjAzZmNiMGYyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzI1N1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTNjZDQ0MmViZmNlMWVjOGM4YTUxOWQ0Y2E4NTRiODMwZWExNmEwMWZlYzZkY2NiNGQ4ZDJmNDNhOWY1MTU3ODYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.cEfu1sslcO2HFlv0uJA96zX5slMXIcI9qWNVN_T8dKo\"><img src=\"https://private-user-images.githubusercontent.com/21187269/308781462-6cd9c36d-8bba-48dd-89c6-46db03fcb0f2.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzM4NzcsIm5iZiI6MTcxNDk3MzU3NywicGF0aCI6Ii8yMTE4NzI2OS8zMDg3ODE0NjItNmNkOWMzNmQtOGJiYS00OGRkLTg5YzYtNDZkYjAzZmNiMGYyLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzI1N1omWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTNjZDQ0MmViZmNlMWVjOGM4YTUxOWQ0Y2E4NTRiODMwZWExNmEwMWZlYzZkY2NiNGQ4ZDJmNDNhOWY1MTU3ODYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.cEfu1sslcO2HFlv0uJA96zX5slMXIcI9qWNVN_T8dKo\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<ul dir=\"auto\">\n<li>[ ]</li>\n</ul>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Normal memory GC</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">broker restart</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22157",
                "createdAt": "2024-02-29T03:11:13Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "area/broker"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] upgrade jclouds 2.5.0 -> 2.6.0",
        "url": "https://github.com/apache/pulsar/pull/22220",
        "resourcePath": "/apache/pulsar/pull/22220",
        "createdAt": "2024-03-07T16:49:39Z",
        "number": 22220,
        "mergeCommit": {
          "oid": "73dc213d4cec3513a1addbcb3518f441093c57ec",
          "message": "[fix][broker] upgrade jclouds 2.5.0 -> 2.6.0 (#22220)\n\nCo-authored-by: \u9053\u541b <daojun@apache.org>\r\nCo-authored-by: Lari Hotari <lhotari@apache.org>",
          "commitUrl": "https://github.com/apache/pulsar/commit/73dc213d4cec3513a1addbcb3518f441093c57ec",
          "parents": {
            "nodes": [
              {
                "oid": "2ffcf62f628c6f41e78eeb2dd64999d558b6f617",
                "message": "[fix][sec] Upgrade Zookeeper to 3.9.2 to address CVE-2024-23944 (#22275)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "jclouds-shaded/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5o_XgF2gAoMjc2N2U2NjE1NDg1OWY4NThjZjlhODNjOTdhNWQ3ZGNlNzIyMzFhYg",
                "url": "https://github.com/apache/pulsar/pull/22220/commits/2767e66154859f858cf9a83c97a5d7dce72231ab"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 15159,
                "url": "https://github.com/apache/pulsar/issues/15159",
                "title": "Offloading large ledgers (>2GB) fail with Google Cloud Storage",
                "bodyHTML": "<p dir=\"auto\"><strong>Describe the bug</strong></p>\n<p dir=\"auto\">Offloading large ledgers fail with Google Cloud Storage and the default settings. With default settings offloading ledgers over 2GB will fail to GCS since there's a limitation in JClouds (reported as <a href=\"https://issues.apache.org/jira/browse/JCLOUDS-1606\" rel=\"nofollow\">[JCLOUDS-1606] Cannot upload more than 32 parts to GCS</a>) which limits a multipart upload to 32 parts. GCS supports multipart uploads up to 10000 parts, but JClouds doesn't use the API in a way to achieve more than 32 parts.</p>\n<p dir=\"auto\">Here's an example log entry of the problem:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.util.concurrent.CompletionException: org.jclouds.http.HttpResponseException: command: POST https://www.googleapis.com/storage/v1/b/somebucket/o/ff553922-1fa3-4ceb-abcd-60106603b5c8-object-123456/compose HTTP/1.1 failed with response: HTTP/1.1 400 Bad Request; content: [{\n  &quot;error&quot;: {\n    &quot;code&quot;: 400,\n    &quot;message&quot;: &quot;The number of source components provided (35) exceeds the maximum (32)&quot;,\n    &quot;errors&quot;: [\n      {\n        &quot;message&quot;: &quot;The number of source components provided (35) exceeds the maximum (32)&quot;,\n        &quot;domain&quot;: &quot;global&quot;,\n        &quot;reason&quot;: &quot;invalid&quot;\n      }\n    ]\n  }\n}\n]\n        at java.util.concurrent.CompletableFuture.encodeRelay(CompletableFuture.java:367) ~[?:?]\n        at java.util.concurrent.CompletableFuture.completeRelay(CompletableFuture.java:376) ~[?:?]\n        at java.util.concurrent.CompletableFuture$UniRelay.tryFire(CompletableFuture.java:1019) ~[?:?]\n        at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:506) ~[?:?]\n        at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088) ~[?:?]\n        at org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader.lambda$offload$0(BlobStoreManagedLedgerOffloader.java:237) ~[?:?]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\n        at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088) ~[?:?]\n        at org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader.lambda$offload$0(BlobStoreManagedLedgerOffloader.java:237) ~[?:?]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\n        at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:74) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:82) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\n        at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) [?:?]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.74.Final.jar:4.1.74.Final]\n        at java.lang.Thread.run(Thread.java:829) [?:?]\nCaused by: org.jclouds.http.HttpResponseException: command: POST https://www.googleapis.com/storage/v1/b/somebucket/o/ff553922-1fa3-4ceb-abcd-60106603b5c8-object-123456/compose HTTP/1.1 failed with response: HTTP/1.1 400 Bad Request; content: [{\n  &quot;error&quot;: {\n    &quot;code&quot;: 400,\n    &quot;message&quot;: &quot;The number of source components provided (35) exceeds the maximum (32)&quot;,\n    &quot;errors&quot;: [\n      {\n        &quot;message&quot;: &quot;The number of source components provided (35) exceeds the maximum (32)&quot;,\n        &quot;domain&quot;: &quot;global&quot;,\n        &quot;reason&quot;: &quot;invalid&quot;\n      }\n    ]\n  }\n}\n]\n        at org.jclouds.googlecloudstorage.handlers.GoogleCloudStorageErrorHandler.handleError(GoogleCloudStorageErrorHandler.java:40) ~[?:?]\n        at org.jclouds.http.handlers.DelegatingErrorHandler.handleError(DelegatingErrorHandler.java:65) ~[?:?]\n        at org.jclouds.http.internal.BaseHttpCommandExecutorService.shouldContinue(BaseHttpCommandExecutorService.java:138) ~[?:?]\n        at org.jclouds.http.internal.BaseHttpCommandExecutorService.invoke(BaseHttpCommandExecutorService.java:107) ~[?:?]\n        at org.jclouds.rest.internal.InvokeHttpMethod.invoke(InvokeHttpMethod.java:91) ~[?:?]\n        at org.jclouds.rest.internal.InvokeHttpMethod.apply(InvokeHttpMethod.java:74) ~[?:?]\n        at org.jclouds.rest.internal.InvokeHttpMethod.apply(InvokeHttpMethod.java:45) ~[?:?]\n        at org.jclouds.reflect.FunctionalReflection$FunctionalInvocationHandler.handleInvocation(FunctionalReflection.java:117) ~[?:?]\n        at org.apache.pulsar.jcloud.shade.com.google.common.reflect.AbstractInvocationHandler.invoke(AbstractInvocationHandler.java:89) ~[?:?]\n        at com.sun.proxy.$Proxy144.composeObjects(Unknown Source) ~[?:?]\n        at org.jclouds.googlecloudstorage.blobstore.GoogleCloudStorageBlobStore.completeMultipartUpload(GoogleCloudStorageBlobStore.java:405) ~[?:?]\n        at jdk.internal.reflect.GeneratedMethodAccessor373.invoke(Unknown Source) ~[?:?]\n        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n        at java.lang.reflect.Method.invoke(Method.java:566) ~[?:?]\n        at org.apache.pulsar.jcloud.shade.com.google.inject.internal.DelegatingInvocationHandler.invoke(DelegatingInvocationHandler.java:50) ~[?:?]\n        at com.sun.proxy.$Proxy88.completeMultipartUpload(Unknown Source) ~[?:?]\n        at org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader.lambda$offload$0(BlobStoreManagedLedgerOffloader.java:226) ~[?:?]\n        ... 11 more\"><pre class=\"notranslate\"><code class=\"notranslate\">java.util.concurrent.CompletionException: org.jclouds.http.HttpResponseException: command: POST https://www.googleapis.com/storage/v1/b/somebucket/o/ff553922-1fa3-4ceb-abcd-60106603b5c8-object-123456/compose HTTP/1.1 failed with response: HTTP/1.1 400 Bad Request; content: [{\n  \"error\": {\n    \"code\": 400,\n    \"message\": \"The number of source components provided (35) exceeds the maximum (32)\",\n    \"errors\": [\n      {\n        \"message\": \"The number of source components provided (35) exceeds the maximum (32)\",\n        \"domain\": \"global\",\n        \"reason\": \"invalid\"\n      }\n    ]\n  }\n}\n]\n        at java.util.concurrent.CompletableFuture.encodeRelay(CompletableFuture.java:367) ~[?:?]\n        at java.util.concurrent.CompletableFuture.completeRelay(CompletableFuture.java:376) ~[?:?]\n        at java.util.concurrent.CompletableFuture$UniRelay.tryFire(CompletableFuture.java:1019) ~[?:?]\n        at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:506) ~[?:?]\n        at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088) ~[?:?]\n        at org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader.lambda$offload$0(BlobStoreManagedLedgerOffloader.java:237) ~[?:?]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\n        at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088) ~[?:?]\n        at org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader.lambda$offload$0(BlobStoreManagedLedgerOffloader.java:237) ~[?:?]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\n        at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:74) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:82) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\n        at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) [?:?]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.74.Final.jar:4.1.74.Final]\n        at java.lang.Thread.run(Thread.java:829) [?:?]\nCaused by: org.jclouds.http.HttpResponseException: command: POST https://www.googleapis.com/storage/v1/b/somebucket/o/ff553922-1fa3-4ceb-abcd-60106603b5c8-object-123456/compose HTTP/1.1 failed with response: HTTP/1.1 400 Bad Request; content: [{\n  \"error\": {\n    \"code\": 400,\n    \"message\": \"The number of source components provided (35) exceeds the maximum (32)\",\n    \"errors\": [\n      {\n        \"message\": \"The number of source components provided (35) exceeds the maximum (32)\",\n        \"domain\": \"global\",\n        \"reason\": \"invalid\"\n      }\n    ]\n  }\n}\n]\n        at org.jclouds.googlecloudstorage.handlers.GoogleCloudStorageErrorHandler.handleError(GoogleCloudStorageErrorHandler.java:40) ~[?:?]\n        at org.jclouds.http.handlers.DelegatingErrorHandler.handleError(DelegatingErrorHandler.java:65) ~[?:?]\n        at org.jclouds.http.internal.BaseHttpCommandExecutorService.shouldContinue(BaseHttpCommandExecutorService.java:138) ~[?:?]\n        at org.jclouds.http.internal.BaseHttpCommandExecutorService.invoke(BaseHttpCommandExecutorService.java:107) ~[?:?]\n        at org.jclouds.rest.internal.InvokeHttpMethod.invoke(InvokeHttpMethod.java:91) ~[?:?]\n        at org.jclouds.rest.internal.InvokeHttpMethod.apply(InvokeHttpMethod.java:74) ~[?:?]\n        at org.jclouds.rest.internal.InvokeHttpMethod.apply(InvokeHttpMethod.java:45) ~[?:?]\n        at org.jclouds.reflect.FunctionalReflection$FunctionalInvocationHandler.handleInvocation(FunctionalReflection.java:117) ~[?:?]\n        at org.apache.pulsar.jcloud.shade.com.google.common.reflect.AbstractInvocationHandler.invoke(AbstractInvocationHandler.java:89) ~[?:?]\n        at com.sun.proxy.$Proxy144.composeObjects(Unknown Source) ~[?:?]\n        at org.jclouds.googlecloudstorage.blobstore.GoogleCloudStorageBlobStore.completeMultipartUpload(GoogleCloudStorageBlobStore.java:405) ~[?:?]\n        at jdk.internal.reflect.GeneratedMethodAccessor373.invoke(Unknown Source) ~[?:?]\n        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n        at java.lang.reflect.Method.invoke(Method.java:566) ~[?:?]\n        at org.apache.pulsar.jcloud.shade.com.google.inject.internal.DelegatingInvocationHandler.invoke(DelegatingInvocationHandler.java:50) ~[?:?]\n        at com.sun.proxy.$Proxy88.completeMultipartUpload(Unknown Source) ~[?:?]\n        at org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader.lambda$offload$0(BlobStoreManagedLedgerOffloader.java:226) ~[?:?]\n        ... 11 more\n</code></pre></div>\n<p dir=\"auto\"><strong>To Reproduce</strong><br>\nSteps to reproduce the behavior:</p>\n<ol dir=\"auto\">\n<li>Configure offloading to use GCS</li>\n<li>Produce a lot of messages</li>\n<li>Trigger ledger offloading</li>\n</ol>\n<p dir=\"auto\"><strong>Expected behavior</strong></p>\n<p dir=\"auto\">Ledger offloading should work with large ledger sizes</p>\n<p dir=\"auto\"><strong>Workaround</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"# ensure that ledgers don't grow over 1500MB\nmanagedLedgerMaxSizePerLedgerMbytes=1500\nmanagedLedgerMinLedgerRolloverTimeMinutes=0\"><pre class=\"notranslate\"><code class=\"notranslate\"># ensure that ledgers don't grow over 1500MB\nmanagedLedgerMaxSizePerLedgerMbytes=1500\nmanagedLedgerMinLedgerRolloverTimeMinutes=0\n</code></pre></div>\n<p dir=\"auto\">or</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"# increase block size to 128MB, maximum file size doubles to 4GB\ngcsManagedLedgerOffloadMaxBlockSizeInBytes=134217728\"><pre class=\"notranslate\"><code class=\"notranslate\"># increase block size to 128MB, maximum file size doubles to 4GB\ngcsManagedLedgerOffloadMaxBlockSizeInBytes=134217728\n</code></pre></div>\n<p dir=\"auto\"><strong>Additional context</strong></p>\n<p dir=\"auto\">JClouds issue reported as <a href=\"https://issues.apache.org/jira/browse/JCLOUDS-1606\" rel=\"nofollow\">[JCLOUDS-1606] Cannot upload more than 32 parts to GCS</a>.</p>",
                "resourcePath": "/apache/pulsar/issues/15159",
                "createdAt": "2022-04-13T12:31:31Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "lifecycle/stale"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][sec]  Revert \"[fix][sec] Add a check for the input time value (apache#22023)\" ",
        "url": "https://github.com/apache/pulsar/pull/22243",
        "resourcePath": "/apache/pulsar/pull/22243",
        "createdAt": "2024-03-11T14:29:08Z",
        "number": 22243,
        "mergeCommit": {
          "oid": "ffff639a1b73a34bbb5115503d4c7783bb2a2770",
          "message": "[fix][sec]  Revert \"[fix][sec] Add a check for the input time value (apache#22023)\"  (#22243)",
          "commitUrl": "https://github.com/apache/pulsar/commit/ffff639a1b73a34bbb5115503d4c7783bb2a2770",
          "parents": {
            "nodes": [
              {
                "oid": "d15e87dfa592f4a705bd0004ac847cac90b1db2a",
                "message": "[fix][test] fix flaky test shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi (#22249)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBuilderImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ControlledClusterFailover.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ReaderBuilderImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/TransactionMetaStoreHandler.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/TypedMessageBuilderImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/transaction/TransactionBuilderImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/util/ObjectCache.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "testmocks/src/main/java/org/apache/bookkeeper/client/PulsarMockBookKeeper.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "testmocks/src/main/java/org/apache/bookkeeper/client/TestStatsProvider.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5pQFog2gAoMGMyMjc3ZmI0ZjE1OGNlZjljYjU4MjI5ZjFlMWU2NjJkMzkxYzI3Nw",
                "url": "https://github.com/apache/pulsar/pull/22243/commits/0c2277fb4f158cef9cb58229f1e1e662d391c277"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22242,
                "url": "https://github.com/apache/pulsar/issues/22242",
                "title": "[Bug] Pulsar 3.0.3 client doesn't work with Flink connector: IllegalArgumentException: lookupTimeout must not be negative",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar client 3.0.3</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Configure Pulsar connector in Flink and use Flink SQL.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">No exceptions</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[ERROR] Could not execute SQL statement. Reason:\njava.lang.IllegalArgumentException: lookupTimeout must not be negative\"><pre class=\"notranslate\"><code class=\"notranslate\">[ERROR] Could not execute SQL statement. Reason:\njava.lang.IllegalArgumentException: lookupTimeout must not be negative\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Caused by: java.lang.IllegalArgumentException: lookupTimeout must not be negative\n\tat org.apache.pulsar.shade.com.google.common.base.Preconditions.checkArgument(Preconditions.java:143)\n\tat org.apache.pulsar.client.impl.ClientBuilderImpl.lookupTimeout(ClientBuilderImpl.java:169)\n\tat org.apache.flink.connector.pulsar.common.config.PulsarClientFactory.lambda$createClient$1(PulsarClientFactory.java:116)\n\tat org.apache.flink.connector.pulsar.common.config.PulsarConfiguration.useOption(PulsarConfiguration.java:101)\n\tat org.apache.flink.connector.pulsar.common.config.PulsarConfiguration.useOption(PulsarConfiguration.java:91)\n\tat org.apache.flink.connector.pulsar.common.config.PulsarClientFactory.createClient(PulsarClientFactory.java:115)\n\tat org.apache.flink.connector.pulsar.sink.writer.topic.MetadataListener.open(MetadataListener.java:102)\n\tat org.apache.flink.connector.pulsar.sink.writer.PulsarWriter.&lt;init&gt;(PulsarWriter.java:120)\n\tat org.apache.flink.connector.pulsar.sink.PulsarSink.createWriter(PulsarSink.java:134)\n\tat org.apache.flink.connector.pulsar.sink.PulsarSink.createWriter(PulsarSink.java:83)\n\tat org.apache.flink.streaming.runtime.operators.sink.StatelessSinkWriterStateHandler.createWriter(StatelessSinkWriterStateHandler.java:39)\n\tat org.apache.flink.streaming.runtime.operators.sink.SinkWriterOperator.initializeState(SinkWriterOperator.java:149)\n\tat org.apache.flink.streaming.api.operators.StreamOperatorStateHandler.initializeOperatorState(StreamOperatorStateHandler.java:122)\n\tat org.apache.flink.streaming.api.operators.AbstractStreamOperator.initializeState(AbstractStreamOperator.java:274)\n\tat org.apache.flink.streaming.runtime.tasks.RegularOperatorChain.initializeStateAndOpenOperators(RegularOperatorChain.java:106)\n\tat org.apache.flink.streaming.runtime.tasks.StreamTask.restoreGates(StreamTask.java:753)\n\tat org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$1.call(StreamTaskActionExecutor.java:55)\n\tat org.apache.flink.streaming.runtime.tasks.StreamTask.restoreInternal(StreamTask.java:728)\n\tat org.apache.flink.streaming.runtime.tasks.StreamTask.restore(StreamTask.java:693)\n\tat org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:953)\n\tat org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:922)\n\tat org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:746)\n\tat org.apache.flink.runtime.taskmanager.Task.run(Task.java:562)\n\tat java.base/java.lang.Thread.run(Unknown Source)\"><pre class=\"notranslate\"><code class=\"notranslate\">Caused by: java.lang.IllegalArgumentException: lookupTimeout must not be negative\n\tat org.apache.pulsar.shade.com.google.common.base.Preconditions.checkArgument(Preconditions.java:143)\n\tat org.apache.pulsar.client.impl.ClientBuilderImpl.lookupTimeout(ClientBuilderImpl.java:169)\n\tat org.apache.flink.connector.pulsar.common.config.PulsarClientFactory.lambda$createClient$1(PulsarClientFactory.java:116)\n\tat org.apache.flink.connector.pulsar.common.config.PulsarConfiguration.useOption(PulsarConfiguration.java:101)\n\tat org.apache.flink.connector.pulsar.common.config.PulsarConfiguration.useOption(PulsarConfiguration.java:91)\n\tat org.apache.flink.connector.pulsar.common.config.PulsarClientFactory.createClient(PulsarClientFactory.java:115)\n\tat org.apache.flink.connector.pulsar.sink.writer.topic.MetadataListener.open(MetadataListener.java:102)\n\tat org.apache.flink.connector.pulsar.sink.writer.PulsarWriter.&lt;init&gt;(PulsarWriter.java:120)\n\tat org.apache.flink.connector.pulsar.sink.PulsarSink.createWriter(PulsarSink.java:134)\n\tat org.apache.flink.connector.pulsar.sink.PulsarSink.createWriter(PulsarSink.java:83)\n\tat org.apache.flink.streaming.runtime.operators.sink.StatelessSinkWriterStateHandler.createWriter(StatelessSinkWriterStateHandler.java:39)\n\tat org.apache.flink.streaming.runtime.operators.sink.SinkWriterOperator.initializeState(SinkWriterOperator.java:149)\n\tat org.apache.flink.streaming.api.operators.StreamOperatorStateHandler.initializeOperatorState(StreamOperatorStateHandler.java:122)\n\tat org.apache.flink.streaming.api.operators.AbstractStreamOperator.initializeState(AbstractStreamOperator.java:274)\n\tat org.apache.flink.streaming.runtime.tasks.RegularOperatorChain.initializeStateAndOpenOperators(RegularOperatorChain.java:106)\n\tat org.apache.flink.streaming.runtime.tasks.StreamTask.restoreGates(StreamTask.java:753)\n\tat org.apache.flink.streaming.runtime.tasks.StreamTaskActionExecutor$1.call(StreamTaskActionExecutor.java:55)\n\tat org.apache.flink.streaming.runtime.tasks.StreamTask.restoreInternal(StreamTask.java:728)\n\tat org.apache.flink.streaming.runtime.tasks.StreamTask.restore(StreamTask.java:693)\n\tat org.apache.flink.runtime.taskmanager.Task.runWithSystemExitMonitoring(Task.java:953)\n\tat org.apache.flink.runtime.taskmanager.Task.restoreAndInvoke(Task.java:922)\n\tat org.apache.flink.runtime.taskmanager.Task.doRun(Task.java:746)\n\tat org.apache.flink.runtime.taskmanager.Task.run(Task.java:562)\n\tat java.base/java.lang.Thread.run(Unknown Source)\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">This broke with <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2117763391\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/22023\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/22023/hovercard\" href=\"https://github.com/apache/pulsar/pull/22023\">#22023</a> changes.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22242",
                "createdAt": "2024-03-11T13:33:12Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "release/blocker"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] fix flaky test shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi",
        "url": "https://github.com/apache/pulsar/pull/22249",
        "resourcePath": "/apache/pulsar/pull/22249",
        "createdAt": "2024-03-12T09:55:55Z",
        "number": 22249,
        "mergeCommit": {
          "oid": "d15e87dfa592f4a705bd0004ac847cac90b1db2a",
          "message": "[fix][test] fix flaky test shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi (#22249)",
          "commitUrl": "https://github.com/apache/pulsar/commit/d15e87dfa592f4a705bd0004ac847cac90b1db2a",
          "parents": {
            "nodes": [
              {
                "oid": "43f9d2abb9d5cd788fe18da6af7ad6fbfb3bc07b",
                "message": "[fix][test] Fix flaky RGUsageMTAggrWaitForAllMsgsTest (#22252)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/MultiBrokerLeaderElectionTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5pWrHJ2gAoYWY5ZTU5ZjdhMWJmZGRhYjMwNjdhMGRlZTEyNmFiOGE5MzhjYWQ4YQ",
                "url": "https://github.com/apache/pulsar/pull/22249/commits/af9e59f7a1bfddab3067a0dee126ab8a938cad8a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22239,
                "url": "https://github.com/apache/pulsar/issues/22239",
                "title": "Flaky-test: AdvertisedListenersMultiBrokerLeaderElectionTest.shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/8226863359/job/22495219489?pr=22230#step:11:1567\">https://github.com/apache/pulsar/actions/runs/8226863359/job/22495219489?pr=22230#step:11:1567</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 8, Failures: 1, Errors: 0, Skipped: 4, Time elapsed: 230.373 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.loadbalance.AdvertisedListenersMultiBrokerLeaderElectionTest\n  Error:  org.apache.pulsar.broker.loadbalance.AdvertisedListenersMultiBrokerLeaderElectionTest.shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi  Time elapsed: 60.865 s  &lt;&lt;&lt; FAILURE!\n  org.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.broker.loadbalance.MultiBrokerLeaderElectionTest.shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi() didn't finish within the time-out 60000\n  \tat java.base@17.0.10/jdk.internal.misc.Unsafe.park(Native Method)\n  \tat java.base@17.0.10/java.util.concurrent.locks.LockSupport.park(LockSupport.java:211)\n  \tat java.base@17.0.10/java.util.concurrent.FutureTask.awaitDone(FutureTask.java:447)\n  \tat java.base@17.0.10/java.util.concurrent.FutureTask.get(FutureTask.java:190)\n  \tat app//org.apache.pulsar.broker.loadbalance.MultiBrokerLeaderElectionTest.shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi(MultiBrokerLeaderElectionTest.java:134)\n  \tat java.base@17.0.10/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base@17.0.10/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base@17.0.10/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base@17.0.10/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat app//org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base@17.0.10/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base@17.0.10/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base@17.0.10/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base@17.0.10/java.lang.Thread.run(Thread.java:840)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 8, Failures: 1, Errors: 0, Skipped: 4, Time elapsed: 230.373 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.loadbalance.AdvertisedListenersMultiBrokerLeaderElectionTest\n  Error:  org.apache.pulsar.broker.loadbalance.AdvertisedListenersMultiBrokerLeaderElectionTest.shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi  Time elapsed: 60.865 s  &lt;&lt;&lt; FAILURE!\n  org.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.broker.loadbalance.MultiBrokerLeaderElectionTest.shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi() didn't finish within the time-out 60000\n  \tat java.base@17.0.10/jdk.internal.misc.Unsafe.park(Native Method)\n  \tat java.base@17.0.10/java.util.concurrent.locks.LockSupport.park(LockSupport.java:211)\n  \tat java.base@17.0.10/java.util.concurrent.FutureTask.awaitDone(FutureTask.java:447)\n  \tat java.base@17.0.10/java.util.concurrent.FutureTask.get(FutureTask.java:190)\n  \tat app//org.apache.pulsar.broker.loadbalance.MultiBrokerLeaderElectionTest.shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi(MultiBrokerLeaderElectionTest.java:134)\n  \tat java.base@17.0.10/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base@17.0.10/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base@17.0.10/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base@17.0.10/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat app//org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base@17.0.10/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base@17.0.10/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base@17.0.10/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base@17.0.10/java.lang.Thread.run(Thread.java:840)\n</code></pre></div>\n<p dir=\"auto\">logs at <a href=\"https://gist.github.com/lhotari/85729c36d42d5d296dfb39178314aa53\">https://gist.github.com/lhotari/85729c36d42d5d296dfb39178314aa53</a> .</p>\n<p dir=\"auto\">Notice! This might be a real issue since the test is also testing that leader election doesn't starve.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22239",
                "createdAt": "2024-03-11T05:54:06Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][test] Don't configure Mockito spying for MultiBrokerTestZKBaseTest",
        "url": "https://github.com/apache/pulsar/pull/22250",
        "resourcePath": "/apache/pulsar/pull/22250",
        "createdAt": "2024-03-12T10:53:30Z",
        "number": 22250,
        "mergeCommit": {
          "oid": "9f63e2474095f6c78a0585bcb6068276cd6188b1",
          "message": "[improve][test] Don't configure Mockito spying for MultiBrokerTestZKBaseTest (#22250)",
          "commitUrl": "https://github.com/apache/pulsar/commit/9f63e2474095f6c78a0585bcb6068276cd6188b1",
          "parents": {
            "nodes": [
              {
                "oid": "73f62c5aa88a9bb538278b6cf25ed920fe48c235",
                "message": "[improve][pip] PIP-324: Alpine Docker images (#21716)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/MultiBrokerTestZKBaseTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/testcontext/PulsarTestContext.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/testcontext/SpyConfig.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5pXGPS2gAoZjQ5ZmRjYWZkYjM4NmY0NmM5NzVjM2I2NjI4ZTI2NjY0OTljYTBhOQ",
                "url": "https://github.com/apache/pulsar/pull/22250/commits/f49fdcafdb386f46c975c3b6628e2666499ca0a9"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22239,
                "url": "https://github.com/apache/pulsar/issues/22239",
                "title": "Flaky-test: AdvertisedListenersMultiBrokerLeaderElectionTest.shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/8226863359/job/22495219489?pr=22230#step:11:1567\">https://github.com/apache/pulsar/actions/runs/8226863359/job/22495219489?pr=22230#step:11:1567</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 8, Failures: 1, Errors: 0, Skipped: 4, Time elapsed: 230.373 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.loadbalance.AdvertisedListenersMultiBrokerLeaderElectionTest\n  Error:  org.apache.pulsar.broker.loadbalance.AdvertisedListenersMultiBrokerLeaderElectionTest.shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi  Time elapsed: 60.865 s  &lt;&lt;&lt; FAILURE!\n  org.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.broker.loadbalance.MultiBrokerLeaderElectionTest.shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi() didn't finish within the time-out 60000\n  \tat java.base@17.0.10/jdk.internal.misc.Unsafe.park(Native Method)\n  \tat java.base@17.0.10/java.util.concurrent.locks.LockSupport.park(LockSupport.java:211)\n  \tat java.base@17.0.10/java.util.concurrent.FutureTask.awaitDone(FutureTask.java:447)\n  \tat java.base@17.0.10/java.util.concurrent.FutureTask.get(FutureTask.java:190)\n  \tat app//org.apache.pulsar.broker.loadbalance.MultiBrokerLeaderElectionTest.shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi(MultiBrokerLeaderElectionTest.java:134)\n  \tat java.base@17.0.10/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base@17.0.10/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base@17.0.10/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base@17.0.10/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat app//org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base@17.0.10/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base@17.0.10/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base@17.0.10/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base@17.0.10/java.lang.Thread.run(Thread.java:840)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 8, Failures: 1, Errors: 0, Skipped: 4, Time elapsed: 230.373 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.loadbalance.AdvertisedListenersMultiBrokerLeaderElectionTest\n  Error:  org.apache.pulsar.broker.loadbalance.AdvertisedListenersMultiBrokerLeaderElectionTest.shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi  Time elapsed: 60.865 s  &lt;&lt;&lt; FAILURE!\n  org.testng.internal.thread.ThreadTimeoutException: Method org.apache.pulsar.broker.loadbalance.MultiBrokerLeaderElectionTest.shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi() didn't finish within the time-out 60000\n  \tat java.base@17.0.10/jdk.internal.misc.Unsafe.park(Native Method)\n  \tat java.base@17.0.10/java.util.concurrent.locks.LockSupport.park(LockSupport.java:211)\n  \tat java.base@17.0.10/java.util.concurrent.FutureTask.awaitDone(FutureTask.java:447)\n  \tat java.base@17.0.10/java.util.concurrent.FutureTask.get(FutureTask.java:190)\n  \tat app//org.apache.pulsar.broker.loadbalance.MultiBrokerLeaderElectionTest.shouldProvideConsistentAnswerToTopicLookupsUsingAdminApi(MultiBrokerLeaderElectionTest.java:134)\n  \tat java.base@17.0.10/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base@17.0.10/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base@17.0.10/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base@17.0.10/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat app//org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat app//org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base@17.0.10/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base@17.0.10/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base@17.0.10/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base@17.0.10/java.lang.Thread.run(Thread.java:840)\n</code></pre></div>\n<p dir=\"auto\">logs at <a href=\"https://gist.github.com/lhotari/85729c36d42d5d296dfb39178314aa53\">https://gist.github.com/lhotari/85729c36d42d5d296dfb39178314aa53</a> .</p>\n<p dir=\"auto\">Notice! This might be a real issue since the test is also testing that leader election doesn't starve.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22239",
                "createdAt": "2024-03-11T05:54:06Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky RGUsageMTAggrWaitForAllMsgsTest",
        "url": "https://github.com/apache/pulsar/pull/22252",
        "resourcePath": "/apache/pulsar/pull/22252",
        "createdAt": "2024-03-12T13:55:17Z",
        "number": 22252,
        "mergeCommit": {
          "oid": "43f9d2abb9d5cd788fe18da6af7ad6fbfb3bc07b",
          "message": "[fix][test] Fix flaky RGUsageMTAggrWaitForAllMsgsTest (#22252)",
          "commitUrl": "https://github.com/apache/pulsar/commit/43f9d2abb9d5cd788fe18da6af7ad6fbfb3bc07b",
          "parents": {
            "nodes": [
              {
                "oid": "4eb3034ad1dbb02a80786484323a7d5c53fd7689",
                "message": "[improve][test] Reduce logging overhead in tests (#22251)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/resourcegroup/RGUsageMTAggrWaitForAllMsgsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5pYYvY2gAoMDM2ZDVhM2NhYjY1NDFkZjUyYjFjNmUwZTA5YjU0MGMzY2MwNzM4NQ",
                "url": "https://github.com/apache/pulsar/pull/22252/commits/036d5a3cab6541df52b1c6e0e09b540c3cc07385"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 17126,
                "url": "https://github.com/apache/pulsar/issues/17126",
                "title": "Flaky-test: RGUsageMTAggrWaitForAllMsgsTest.testMTProduceConsumeRGUsageNonPersistentTopicNamesSameTenant",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/runs/7870050421?check_suite_focus=true\">https://github.com/apache/pulsar/runs/7870050421?check_suite_focus=true</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  Error:  Tests run: 11, Failures: 1, Errors: 0, Skipped: 9, Time elapsed: 26.062 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.resourcegroup.RGUsageMTAggrWaitForAllMsgsTest\n  Error:  testMTProduceConsumeRGUsageNonPersistentTopicNamesSameTenant(org.apache.pulsar.broker.resourcegroup.RGUsageMTAggrWaitForAllMsgsTest)  Time elapsed: 0.581 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [400] but found [0]\n  \tat org.testng.Assert.fail(Assert.java:99)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1037)\n  \tat org.testng.Assert.assertEqualsImpl(Assert.java:140)\n  \tat org.testng.Assert.assertEquals(Assert.java:122)\n  \tat org.testng.Assert.assertEquals(Assert.java:907)\n  \tat org.testng.Assert.assertEquals(Assert.java:917)\n  \tat org.apache.pulsar.broker.resourcegroup.RGUsageMTAggrWaitForAllMsgsTest.testProduceConsumeUsageOnRG(RGUsageMTAggrWaitForAllMsgsTest.java:463)\n  \tat org.apache.pulsar.broker.resourcegroup.RGUsageMTAggrWaitForAllMsgsTest.testMTProduceConsumeRGUsageNonPersistentTopicNamesSameTenant(RGUsageMTAggrWaitForAllMsgsTest.java:108)\"><pre class=\"notranslate\"><code class=\"notranslate\">  Error:  Tests run: 11, Failures: 1, Errors: 0, Skipped: 9, Time elapsed: 26.062 s &lt;&lt;&lt; FAILURE! - in org.apache.pulsar.broker.resourcegroup.RGUsageMTAggrWaitForAllMsgsTest\n  Error:  testMTProduceConsumeRGUsageNonPersistentTopicNamesSameTenant(org.apache.pulsar.broker.resourcegroup.RGUsageMTAggrWaitForAllMsgsTest)  Time elapsed: 0.581 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [400] but found [0]\n  \tat org.testng.Assert.fail(Assert.java:99)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1037)\n  \tat org.testng.Assert.assertEqualsImpl(Assert.java:140)\n  \tat org.testng.Assert.assertEquals(Assert.java:122)\n  \tat org.testng.Assert.assertEquals(Assert.java:907)\n  \tat org.testng.Assert.assertEquals(Assert.java:917)\n  \tat org.apache.pulsar.broker.resourcegroup.RGUsageMTAggrWaitForAllMsgsTest.testProduceConsumeUsageOnRG(RGUsageMTAggrWaitForAllMsgsTest.java:463)\n  \tat org.apache.pulsar.broker.resourcegroup.RGUsageMTAggrWaitForAllMsgsTest.testMTProduceConsumeRGUsageNonPersistentTopicNamesSameTenant(RGUsageMTAggrWaitForAllMsgsTest.java:108)\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/17126",
                "createdAt": "2022-08-17T02:00:23Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] flaky test: BrokerServiceTest.testBrokerStatsTopicLoadFailed",
        "url": "https://github.com/apache/pulsar/pull/22256",
        "resourcePath": "/apache/pulsar/pull/22256",
        "createdAt": "2024-03-12T19:35:09Z",
        "number": 22256,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/BrokerOperabilityMetrics.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5pbVh-2gAoZWM2NTZiMzE2NGVmNmJjY2VlMTMwY2ZkZmViZjliYjU4OGIyM2E4OQ",
                "url": "https://github.com/apache/pulsar/pull/22256/commits/ec656b3164ef6bccee130cfdfebf9bb588b23a89"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20495,
                "url": "https://github.com/apache/pulsar/issues/20495",
                "title": "Rewrite BrokerServiceTest#testBrokerStatsTopicLoadFailed",
                "bodyHTML": "<p dir=\"auto\">The BrokerServiceTest#testBrokerStatsTopicLoadFailed is disabled by <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1741807907\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20494\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20494/hovercard\" href=\"https://github.com/apache/pulsar/pull/20494\">#20494</a>.</p>\n<blockquote>\n<ol start=\"2\" dir=\"auto\">\n<li>Remove the test case and if the coverage is necessary, file a new ticket to add it back.</li>\n</ol>\n</blockquote>\n<p dir=\"auto\"><em>Originally posted by <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/tisonkun/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tisonkun\">@tisonkun</a> in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1741807907\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20494\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20494/hovercard?comment_id=1462643509&amp;comment_type=review\" href=\"https://github.com/apache/pulsar/pull/20494#pullrequestreview-1462643509\">#20494 (review)</a></em></p>\n<p dir=\"auto\">The test BrokerServiceTest#testBrokerStatsTopicLoadFailed introduced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1533760215\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19236\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19236/hovercard\" href=\"https://github.com/apache/pulsar/pull/19236\">#19236</a> is invalid.</p>\n<ul dir=\"auto\">\n<li>It modifies the current shared state and that causes other tests to fail.</li>\n<li>The test uses Awaitility with a 2 minute timeout. That is too long for unit tests.</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20495",
                "createdAt": "2023-06-05T14:28:54Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][misc] Upgrade checkstyle to 10.14.2",
        "url": "https://github.com/apache/pulsar/pull/22291",
        "resourcePath": "/apache/pulsar/pull/22291",
        "createdAt": "2024-03-18T10:56:29Z",
        "number": 22291,
        "mergeCommit": {
          "oid": "cd512e4da6a04c68d448a452c76b10b49014033d",
          "message": "[improve][misc] Upgrade checkstyle to 10.14.2 (#22291)",
          "commitUrl": "https://github.com/apache/pulsar/commit/cd512e4da6a04c68d448a452c76b10b49014033d",
          "parents": {
            "nodes": [
              {
                "oid": "34f8e0e9456674cd6459105cd7a3619b113b06cf",
                "message": "[improve] [broker] Support create RawReader based on configuration (#22280)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "buildtools/pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "buildtools/src/main/resources/pulsar/checkstyle.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ProducerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/tls/InetAddressUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/LongPairSet.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5p7HCc2gAoMDI1NjJkNjUwMTg2NWEwMGM1OGY1YjYyYTUzYjdmOGRmOWZkZjY1YQ",
                "url": "https://github.com/apache/pulsar/pull/22291/commits/02562d6501865a00c58f5b62a53b7f8df9fdf65a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22286,
                "url": "https://github.com/apache/pulsar/issues/22286",
                "title": "IntelliJ checkstyle plugin dropped support for checkstyle 8.x, upgrade checkstyle to newer version",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\"><a href=\"https://plugins.jetbrains.com/plugin/1065-checkstyle-idea\" rel=\"nofollow\">IntelliJ checkstyle plugin</a> dropped support for checkstyle 8.x in the 5.88.0 version update.</p>\n<p dir=\"auto\">Fails with this error message:</p>\n<blockquote>\n<p dir=\"auto\">The Checkstyle rules file could not be parsed. cannot initialize module TreeWalker - cannot initialize module JavadocMethod - Property 'scope' does not exist, please check the documentation The file has been blocked for 60s</p>\n</blockquote>\n<h3 dir=\"auto\">Solution</h3>\n<ul dir=\"auto\">\n<li>Upgrade <code class=\"notranslate\">buildtools/src/main/resources/pulsar/checkstyle.xml</code> to support newer checkstyle 10.x version</li>\n<li>Upgrade checkstyle to 10.x</li>\n</ul>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22286",
                "createdAt": "2024-03-16T16:24:27Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][fn] Support OAuth2 in Go instance",
        "url": "https://github.com/apache/pulsar/pull/22323",
        "resourcePath": "/apache/pulsar/pull/22323",
        "createdAt": "2024-03-22T03:15:52Z",
        "number": 22323,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/instance.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/instanceConf_test.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/test/java/org/apache/pulsar/functions/runtime/kubernetes/KubernetesRuntimeTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/test/java/org/apache/pulsar/functions/runtime/process/ProcessRuntimeTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5qcPSj2gAoNGMwMDRhOTY5NWJjNDYyYTdlYjE4ZWJmMjJhMmRmYzI3ZTRiZGJkYw",
                "url": "https://github.com/apache/pulsar/pull/22323/commits/4c004a9695bc462a7eb18ebf22a2dfc27e4bdbdc"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22322,
                "url": "https://github.com/apache/pulsar/issues/22322",
                "title": "Support OAuth2 authentication in Go instance of pulsar functions",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">the pulsar go client already supports the OAuth2, it's better to support OAuth2 in the Go instance too</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22322",
                "createdAt": "2024-03-22T03:09:38Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][ml]Expose ledger timestamp ",
        "url": "https://github.com/apache/pulsar/pull/22338",
        "resourcePath": "/apache/pulsar/pull/22338",
        "createdAt": "2024-03-25T09:25:06Z",
        "number": 22338,
        "mergeCommit": {
          "oid": "cd49defc1383175ef32e18c7f0905567f734318c",
          "message": "[fix][ml]Expose ledger timestamp  (#22338)",
          "commitUrl": "https://github.com/apache/pulsar/commit/cd49defc1383175ef32e18c7f0905567f734318c",
          "parents": {
            "nodes": [
              {
                "oid": "023446b73287dea25c22c6db307e5d723306e765",
                "message": "[fix][cli] Fix typos in CmdSinks class (#22358)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerFactoryImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerFactoryTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5qod832gAoNDRjZDRhMDRkZWU0MTZiZDBlM2UwMzczNjQ3ZDk4OTJhODE4NzBlOA",
                "url": "https://github.com/apache/pulsar/pull/22338/commits/44cd4a04dee416bd0e3e0373647d9892a81870e8"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22312,
                "url": "https://github.com/apache/pulsar/issues/22312",
                "title": "Expose timestamp to ledger info",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Apache pulsar supports retention by time. But we can not check what is the current ledger timestamp. We can only check the logs to get the ledger creation time to guess the previous ledger close time.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">We already record it in the ledger info. We only need to expose It when we check the stats. to</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\">IDK.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">no</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22312",
                "createdAt": "2024-03-20T10:07:31Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "help wanted"
                      }
                    },
                    {
                      "node": {
                        "name": "area/broker"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][fn] Pass FunctionDetails to Go instance",
        "url": "https://github.com/apache/pulsar/pull/22350",
        "resourcePath": "/apache/pulsar/pull/22350",
        "createdAt": "2024-03-26T02:01:40Z",
        "number": 22350,
        "mergeCommit": {
          "oid": "7315aeb6258b7adc9d874268d50acb95ffc0cf2b",
          "message": "[improve][fn] Pass FunctionDetails to Go instance (#22350)",
          "commitUrl": "https://github.com/apache/pulsar/commit/7315aeb6258b7adc9d874268d50acb95ffc0cf2b",
          "parents": {
            "nodes": [
              {
                "oid": "0701d7eedcef6aae750b5067139caf8e73434818",
                "message": "[fix][sec] implicit narrowing conversion in compound assignment (#22074)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/conf/conf.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/instanceConf.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-function-go/pf/instanceConf_test.go"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/instance/src/main/java/org/apache/pulsar/functions/instance/go/GoInstanceConfig.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/main/java/org/apache/pulsar/functions/runtime/RuntimeUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/runtime/src/test/java/org/apache/pulsar/functions/runtime/kubernetes/KubernetesRuntimeTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5quoyX2gAoYmMwYzI4ODM5NjY4YTQ4YTg3NTJhZjJiZDkwMDJmOTQzYTYyOWJhMA",
                "url": "https://github.com/apache/pulsar/pull/22350/commits/bc0c28839668a48a8752af2bd9002f943a629ba0"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22349,
                "url": "https://github.com/apache/pulsar/issues/22349",
                "title": "Golang instance of functions missing many fields of the `FunctionDetails`",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">the Go instance is assembling the <code class=\"notranslate\">FunctionDetails</code> manullay:</p>\n<div class=\"highlight highlight-source-go notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"\t\tfuncDetails: pb.FunctionDetails{\n\t\t\tTenant:               cfg.Tenant,\n\t\t\tNamespace:            cfg.NameSpace,\n\t\t\tName:                 cfg.Name,\n\t\t\tLogTopic:             cfg.LogTopic,\n\t\t\tProcessingGuarantees: pb.ProcessingGuarantees(cfg.ProcessingGuarantees),\n\t\t\tSecretsMap:           cfg.SecretsMap,\n\t\t\tRuntime:              pb.FunctionDetails_Runtime(cfg.Runtime),\n\t\t\tAutoAck:              cfg.AutoACK,\n\t\t\tParallelism:          cfg.Parallelism,\n\t\t\tSource: &amp;pb.SourceSpec{\n\t\t\t\tSubscriptionType:     pb.SubscriptionType(cfg.SubscriptionType),\n\t\t\t\tInputSpecs:           inputSpecs,\n\t\t\t\tTimeoutMs:            cfg.TimeoutMs,\n\t\t\t\tSubscriptionName:     cfg.SubscriptionName,\n\t\t\t\tCleanupSubscription:  cfg.CleanupSubscription,\n\t\t\t\tSubscriptionPosition: pb.SubscriptionPosition(cfg.SubscriptionPosition),\n\t\t\t},\n\t\t\tSink: &amp;pb.SinkSpec{\n\t\t\t\tTopic:      cfg.SinkSpecTopic,\n\t\t\t\tSchemaType: cfg.SinkSchemaType,\n\t\t\t},\n\t\t\tResources: &amp;pb.Resources{\n\t\t\t\tCpu:  cfg.Cpu,\n\t\t\t\tRam:  cfg.Ram,\n\t\t\t\tDisk: cfg.Disk,\n\t\t\t},\n\t\t\tRetryDetails: &amp;pb.RetryDetails{\n\t\t\t\tMaxMessageRetries: cfg.MaxMessageRetries,\n\t\t\t\tDeadLetterTopic:   cfg.DeadLetterTopic,\n\t\t\t},\n\t\t\tUserConfig: cfg.UserConfig,\n\t\t},\"><pre class=\"notranslate\">\t\t<span class=\"pl-s1\">funcDetails</span>: pb.<span class=\"pl-smi\">FunctionDetails</span>{\n\t\t\t<span class=\"pl-s1\">Tenant</span>:               <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">Tenant</span>,\n\t\t\t<span class=\"pl-s1\">Namespace</span>:            <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">NameSpace</span>,\n\t\t\t<span class=\"pl-s1\">Name</span>:                 <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">Name</span>,\n\t\t\t<span class=\"pl-s1\">LogTopic</span>:             <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">LogTopic</span>,\n\t\t\t<span class=\"pl-s1\">ProcessingGuarantees</span>: <span class=\"pl-s1\">pb</span>.<span class=\"pl-en\">ProcessingGuarantees</span>(<span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">ProcessingGuarantees</span>),\n\t\t\t<span class=\"pl-s1\">SecretsMap</span>:           <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">SecretsMap</span>,\n\t\t\t<span class=\"pl-s1\">Runtime</span>:              <span class=\"pl-s1\">pb</span>.<span class=\"pl-en\">FunctionDetails_Runtime</span>(<span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">Runtime</span>),\n\t\t\t<span class=\"pl-s1\">AutoAck</span>:              <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">AutoACK</span>,\n\t\t\t<span class=\"pl-s1\">Parallelism</span>:          <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">Parallelism</span>,\n\t\t\t<span class=\"pl-s1\">Source</span>: <span class=\"pl-c1\">&amp;</span>pb.<span class=\"pl-smi\">SourceSpec</span>{\n\t\t\t\t<span class=\"pl-s1\">SubscriptionType</span>:     <span class=\"pl-s1\">pb</span>.<span class=\"pl-en\">SubscriptionType</span>(<span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">SubscriptionType</span>),\n\t\t\t\t<span class=\"pl-s1\">InputSpecs</span>:           <span class=\"pl-s1\">inputSpecs</span>,\n\t\t\t\t<span class=\"pl-s1\">TimeoutMs</span>:            <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">TimeoutMs</span>,\n\t\t\t\t<span class=\"pl-s1\">SubscriptionName</span>:     <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">SubscriptionName</span>,\n\t\t\t\t<span class=\"pl-s1\">CleanupSubscription</span>:  <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">CleanupSubscription</span>,\n\t\t\t\t<span class=\"pl-s1\">SubscriptionPosition</span>: <span class=\"pl-s1\">pb</span>.<span class=\"pl-en\">SubscriptionPosition</span>(<span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">SubscriptionPosition</span>),\n\t\t\t},\n\t\t\t<span class=\"pl-s1\">Sink</span>: <span class=\"pl-c1\">&amp;</span>pb.<span class=\"pl-smi\">SinkSpec</span>{\n\t\t\t\t<span class=\"pl-s1\">Topic</span>:      <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">SinkSpecTopic</span>,\n\t\t\t\t<span class=\"pl-s1\">SchemaType</span>: <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">SinkSchemaType</span>,\n\t\t\t},\n\t\t\t<span class=\"pl-s1\">Resources</span>: <span class=\"pl-c1\">&amp;</span>pb.<span class=\"pl-smi\">Resources</span>{\n\t\t\t\t<span class=\"pl-s1\">Cpu</span>:  <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">Cpu</span>,\n\t\t\t\t<span class=\"pl-s1\">Ram</span>:  <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">Ram</span>,\n\t\t\t\t<span class=\"pl-s1\">Disk</span>: <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">Disk</span>,\n\t\t\t},\n\t\t\t<span class=\"pl-s1\">RetryDetails</span>: <span class=\"pl-c1\">&amp;</span>pb.<span class=\"pl-smi\">RetryDetails</span>{\n\t\t\t\t<span class=\"pl-s1\">MaxMessageRetries</span>: <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">MaxMessageRetries</span>,\n\t\t\t\t<span class=\"pl-s1\">DeadLetterTopic</span>:   <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">DeadLetterTopic</span>,\n\t\t\t},\n\t\t\t<span class=\"pl-s1\">UserConfig</span>: <span class=\"pl-s1\">cfg</span>.<span class=\"pl-c1\">UserConfig</span>,\n\t\t},</pre></div>\n<p dir=\"auto\">Which makes it missed many fields of the <code class=\"notranslate\">FunctionDetails</code>, such as the <code class=\"notranslate\">sink.ProducerSpec</code>, <code class=\"notranslate\">runtimeFlags</code>, and so on, and if the <code class=\"notranslate\">FunctionDetails</code> struct has some updates of fields, we have to modify this code to adapt the change, which is quite inflexible</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">We can pass the <code class=\"notranslate\">FunctionDetails</code> string to Go instance directly, and \"unmarshal\" it to the <code class=\"notranslate\">FunctionDetails</code> struct directly instead of create it manually</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22349",
                "createdAt": "2024-03-26T01:57:03Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Consumer lost message ack due to race condition in acknowledge with batch message",
        "url": "https://github.com/apache/pulsar/pull/22353",
        "resourcePath": "/apache/pulsar/pull/22353",
        "createdAt": "2024-03-26T03:32:58Z",
        "number": 22353,
        "mergeCommit": {
          "oid": "3fa2ae83312ead38a81fe82bc06c1784e6061d6f",
          "message": "[fix][client] Consumer lost message ack due to race condition in acknowledge with batch message (#22353)\n\nCo-authored-by: Yunze Xu <xyzinfernity@163.com>\r\nCo-authored-by: \u6c6a\u82cf\u8bda <sucheng.wang@zhaopin.com.cn>",
          "commitUrl": "https://github.com/apache/pulsar/commit/3fa2ae83312ead38a81fe82bc06c1784e6061d6f",
          "parents": {
            "nodes": [
              {
                "oid": "404c0572a461908ffe09c483092d8df78356eae9",
                "message": "[fix][broker] Fix OpReadEntry.skipCondition NPE issue (#22367)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/MessageIdAdvUtils.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/PersistentAcknowledgmentsGroupingTracker.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/MessageIdAdvUtilsTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/client/api/MessageIdAdv.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5qu7032gAoOWQ3YWMyMDhmZGYxM2EzMzc2ZTE2YmFlNmU3YTIwMjY5YjQ5MzQ5Yg",
                "url": "https://github.com/apache/pulsar/pull/22353/commits/9d7ac208fdf13a3376e16bae6e7a20269b49349b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22352,
                "url": "https://github.com/apache/pulsar/issues/22352",
                "title": "[Bug][Client] Consumer lost message ack due to race condition in acknowledge with batch message",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">pulsar-client: 3.0.3</p>\n<p dir=\"auto\">(This issue may affect pulsar-client version 3.0.0 or later. <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1569180055\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19414\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19414/hovercard\" href=\"https://github.com/apache/pulsar/pull/19414\">#19414</a>)</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>create a partitioned topic with 3 partitions, let's say <code class=\"notranslate\">persistent://public/default/clientBlockTest</code></li>\n<li>produce message with batch enabled</li>\n</ol>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"pulsar-perf produce -r 1000 -b 10 persistent://public/default/clientBlockTest\"><pre class=\"notranslate\"><code class=\"notranslate\">pulsar-perf produce -r 1000 -b 10 persistent://public/default/clientBlockTest\n</code></pre></div>\n<ol start=\"3\" dir=\"auto\">\n<li>start consumer with code below:</li>\n</ol>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"import com.google.common.util.concurrent.ThreadFactoryBuilder;\nimport lombok.extern.slf4j.Slf4j;\nimport org.apache.pulsar.client.api.Consumer;\nimport org.apache.pulsar.client.api.Message;\nimport org.apache.pulsar.client.api.PulsarClient;\nimport org.apache.pulsar.client.api.PulsarClientException;\nimport org.apache.pulsar.client.api.SubscriptionType;\n\nimport java.util.concurrent.CountDownLatch;\nimport java.util.concurrent.ThreadFactory;\nimport java.util.concurrent.TimeUnit;\n\n@Slf4j\npublic class App {\n\n    public static void main(String[] args) throws PulsarClientException, InterruptedException {\n        String serviceUrl = args[0];\n        String topicName = &quot;persistent://public/default/clientBlockTest&quot;;\n        String subscriptionName = &quot;sub0&quot;;\n        PulsarClient client = PulsarClient.builder().serviceUrl(serviceUrl).build();\n        Consumer&lt;byte[]&gt; consumer = client.newConsumer()\n                .topic(topicName)\n                .subscriptionType(SubscriptionType.Shared)\n                .subscriptionName(subscriptionName)\n                .ackTimeout(1, TimeUnit.MINUTES)\n                .subscribe();\n        ThreadFactory threadFactory = new ThreadFactoryBuilder().setNameFormat(&quot;pulsar-consumer-%d&quot;).build();\n        for (int i = 0; i &lt; 16; i++) {\n            threadFactory.newThread(() -&gt; {\n                while (true) {\n                    try {\n                        Message&lt;byte[]&gt; message = consumer.receive();\n                        consumer.acknowledge(message);\n                    } catch (PulsarClientException.AlreadyClosedException e) {\n                        log.info(&quot;Consumer closed&quot;);\n                        break;\n                    } catch (PulsarClientException e) {\n                        log.error(&quot;Failed to receive message&quot;, e);\n                    }\n                }\n            }).start();\n        }\n        new CountDownLatch(1).await();\n    }\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">import</span> <span class=\"pl-s1\">com</span>.<span class=\"pl-s1\">google</span>.<span class=\"pl-s1\">common</span>.<span class=\"pl-s1\">util</span>.<span class=\"pl-s1\">concurrent</span>.<span class=\"pl-s1\">ThreadFactoryBuilder</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">lombok</span>.<span class=\"pl-s1\">extern</span>.<span class=\"pl-s1\">slf4j</span>.<span class=\"pl-s1\">Slf4j</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-s1\">client</span>.<span class=\"pl-s1\">api</span>.<span class=\"pl-s1\">Consumer</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-s1\">client</span>.<span class=\"pl-s1\">api</span>.<span class=\"pl-s1\">Message</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-s1\">client</span>.<span class=\"pl-s1\">api</span>.<span class=\"pl-s1\">PulsarClient</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-s1\">client</span>.<span class=\"pl-s1\">api</span>.<span class=\"pl-s1\">PulsarClientException</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-s1\">client</span>.<span class=\"pl-s1\">api</span>.<span class=\"pl-s1\">SubscriptionType</span>;\n\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">java</span>.<span class=\"pl-s1\">util</span>.<span class=\"pl-s1\">concurrent</span>.<span class=\"pl-s1\">CountDownLatch</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">java</span>.<span class=\"pl-s1\">util</span>.<span class=\"pl-s1\">concurrent</span>.<span class=\"pl-s1\">ThreadFactory</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">java</span>.<span class=\"pl-s1\">util</span>.<span class=\"pl-s1\">concurrent</span>.<span class=\"pl-s1\">TimeUnit</span>;\n\n<span class=\"pl-c1\">@</span><span class=\"pl-c1\">Slf4j</span>\n<span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-smi\">App</span> {\n\n    <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">main</span>(<span class=\"pl-smi\">String</span>[] <span class=\"pl-s1\">args</span>) <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">PulsarClientException</span>, <span class=\"pl-smi\">InterruptedException</span> {\n        <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">serviceUrl</span> = <span class=\"pl-s1\">args</span>[<span class=\"pl-c1\">0</span>];\n        <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">topicName</span> = <span class=\"pl-s\">\"persistent://public/default/clientBlockTest\"</span>;\n        <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">subscriptionName</span> = <span class=\"pl-s\">\"sub0\"</span>;\n        <span class=\"pl-smi\">PulsarClient</span> <span class=\"pl-s1\">client</span> = <span class=\"pl-smi\">PulsarClient</span>.<span class=\"pl-en\">builder</span>().<span class=\"pl-en\">serviceUrl</span>(<span class=\"pl-s1\">serviceUrl</span>).<span class=\"pl-en\">build</span>();\n        <span class=\"pl-smi\">Consumer</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">consumer</span> = <span class=\"pl-s1\">client</span>.<span class=\"pl-en\">newConsumer</span>()\n                .<span class=\"pl-en\">topic</span>(<span class=\"pl-s1\">topicName</span>)\n                .<span class=\"pl-en\">subscriptionType</span>(<span class=\"pl-smi\">SubscriptionType</span>.<span class=\"pl-s1\">Shared</span>)\n                .<span class=\"pl-en\">subscriptionName</span>(<span class=\"pl-s1\">subscriptionName</span>)\n                .<span class=\"pl-en\">ackTimeout</span>(<span class=\"pl-c1\">1</span>, <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">MINUTES</span>)\n                .<span class=\"pl-en\">subscribe</span>();\n        <span class=\"pl-smi\">ThreadFactory</span> <span class=\"pl-s1\">threadFactory</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ThreadFactoryBuilder</span>().<span class=\"pl-en\">setNameFormat</span>(<span class=\"pl-s\">\"pulsar-consumer-%d\"</span>).<span class=\"pl-en\">build</span>();\n        <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">int</span> <span class=\"pl-s1\">i</span> = <span class=\"pl-c1\">0</span>; <span class=\"pl-s1\">i</span> &lt; <span class=\"pl-c1\">16</span>; <span class=\"pl-s1\">i</span>++) {\n            <span class=\"pl-s1\">threadFactory</span>.<span class=\"pl-en\">newThread</span>(() -&gt; {\n                <span class=\"pl-k\">while</span> (<span class=\"pl-c1\">true</span>) {\n                    <span class=\"pl-k\">try</span> {\n                        <span class=\"pl-smi\">Message</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt; <span class=\"pl-s1\">message</span> = <span class=\"pl-s1\">consumer</span>.<span class=\"pl-en\">receive</span>();\n                        <span class=\"pl-s1\">consumer</span>.<span class=\"pl-en\">acknowledge</span>(<span class=\"pl-s1\">message</span>);\n                    } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">PulsarClientException</span>.<span class=\"pl-smi\">AlreadyClosedException</span> <span class=\"pl-s1\">e</span>) {\n                        <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">info</span>(<span class=\"pl-s\">\"Consumer closed\"</span>);\n                        <span class=\"pl-k\">break</span>;\n                    } <span class=\"pl-k\">catch</span> (<span class=\"pl-smi\">PulsarClientException</span> <span class=\"pl-s1\">e</span>) {\n                        <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">error</span>(<span class=\"pl-s\">\"Failed to receive message\"</span>, <span class=\"pl-s1\">e</span>);\n                    }\n                }\n            }).<span class=\"pl-en\">start</span>();\n        }\n        <span class=\"pl-k\">new</span> <span class=\"pl-smi\">CountDownLatch</span>(<span class=\"pl-c1\">1</span>).<span class=\"pl-en\">await</span>();\n    }\n}</pre></div>\n<ol start=\"4\" dir=\"auto\">\n<li>some messages will not be acked, and there will be no redelivery</li>\n<li>consumer will blocked on unacked messages eventually</li>\n</ol>\n<details>\n<summary>topic stats</summary>\n<pre class=\"notranslate\">{\n  \"msgRateIn\": 333.33173299657216,\n  \"msgThroughputIn\": 347088.33361734066,\n  \"msgRateOut\": 0.0,\n  \"msgThroughputOut\": 0.0,\n  \"bytesInCounter\": 552318240,\n  \"msgInCounter\": 530504,\n  \"bytesOutCounter\": 373741143,\n  \"msgOutCounter\": 359001,\n  \"averageMsgSize\": 1041.27,\n  \"msgChunkPublished\": false,\n  \"storageSize\": 552281787,\n  \"backlogSize\": 307736567,\n  \"publishRateLimitedTimes\": 0,\n  \"offloadedStorageSize\": 0,\n  \"lastOffloadLedgerId\": 0,\n  \"lastOffloadSuccessTimeStamp\": 0,\n  \"lastOffloadFailureTimeStamp\": 0,\n  \"publishers\": [\n    {\n      \"accessMode\": \"Shared\",\n      \"msgRateIn\": 333.33173299657216,\n      \"msgThroughputIn\": 347088.33361734066,\n      \"averageMsgSize\": 1041.27,\n      \"chunkedMessageRate\": 0.0,\n      \"producerId\": 0,\n      \"metadata\": { },\n      \"address\": \"/192.168.214.214:63055\",\n      \"connectedSince\": \"2024-03-26T10:29:04.869+08:00\",\n      \"clientVersion\": \"2.8.1.27\",\n      \"producerName\": \"pulsar-cluster-qa-391-23\"\n    }\n  ],\n  \"waitingPublishers\": 0,\n  \"subscriptions\": {\n    \"sub0\": {\n      \"msgRateOut\": 0.0,\n      \"msgThroughputOut\": 0.0,\n      \"bytesOutCounter\": 373741143,\n      \"msgOutCounter\": 359001,\n      \"msgRateRedeliver\": 0.0,\n      \"chunkedMessageRate\": 0,\n      \"msgBacklog\": 18729,\n      \"backlogSize\": 0,\n      \"msgBacklogNoDelayed\": 18729,\n      \"blockedSubscriptionOnUnackedMsgs\": false,\n      \"msgDelayed\": 0,\n      \"unackedMessages\": 502,\n      \"type\": \"Shared\",\n      \"msgRateExpired\": 0.0,\n      \"totalMsgExpired\": 0,\n      \"lastExpireTimestamp\": 1711421636224,\n      \"lastConsumedFlowTimestamp\": 1711421261835,\n      \"lastConsumedTimestamp\": 1711421261864,\n      \"lastAckedTimestamp\": 1711421262238,\n      \"lastMarkDeleteAdvancedTimestamp\": 1711421162509,\n      \"consumers\": [\n        {\n          \"msgRateOut\": 0.0,\n          \"msgThroughputOut\": 0.0,\n          \"bytesOutCounter\": 131805765,\n          \"msgOutCounter\": 126615,\n          \"msgRateRedeliver\": 0.0,\n          \"chunkedMessageRate\": 0.0,\n          \"consumerName\": \"0563b\",\n          \"availablePermits\": 385,\n          \"unackedMessages\": 502,\n          \"avgMessagesPerEntry\": 9,\n          \"blockedConsumerOnUnackedMsgs\": true,\n          \"lastAckedTimestamp\": 1711421262238,\n          \"lastConsumedTimestamp\": 1711421261864,\n          \"metadata\": { },\n          \"address\": \"/192.168.214.214:64708\",\n          \"connectedSince\": \"2024-03-26T10:46:02.2+08:00\",\n          \"clientVersion\": \"Pulsar-Java-v3.0.3\"\n        }\n      ],\n      \"isDurable\": true,\n      \"isReplicated\": false,\n      \"consumersAfterMarkDeletePosition\": { },\n      \"nonContiguousDeletedMessagesRanges\": 46,\n      \"nonContiguousDeletedMessagesRangesSerializedSize\": 1012,\n      \"durable\": true,\n      \"replicated\": false\n    }\n  },\n  \"replication\": { },\n  \"deduplicationStatus\": \"Disabled\",\n  \"nonContiguousDeletedMessagesRanges\": 46,\n  \"nonContiguousDeletedMessagesRangesSerializedSize\": 1012,\n  \"compaction\": {\n    \"lastCompactionRemovedEventCount\": 0,\n    \"lastCompactionSucceedTimestamp\": 0,\n    \"lastCompactionFailedTimestamp\": 0,\n    \"lastCompactionDurationTimeInMills\": 0\n  }\n}\n</pre>\n</details>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">consume normally</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<h3 dir=\"auto\">Symptoms</h3>\n<ul dir=\"auto\">\n<li>for partitioned topic, a few messages cannot be acked, but in consumer view, it seems acked already\n<ul dir=\"auto\">\n<li>consumer will block on unacked messages eventually</li>\n</ul>\n</li>\n<li>for non-partitioned topic, ConsumerImpl will redelivery these messages cause <code class=\"notranslate\">ConsumerImpl#unAckedMessageTracker</code> mechanism still working</li>\n</ul>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">After investigation, I believe that the cause is that we haven't synchronize operations on Bitset in batch message, Consumer#acknowledge will be called from user threads, therefor operations on Bitset should be protected.<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/a52945b1c51fa874667eecb9fea9bf03e5d6153b/pulsar-client/src/main/java/org/apache/pulsar/client/impl/PersistentAcknowledgmentsGroupingTracker.java#L212-L222\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/PersistentAcknowledgmentsGroupingTracker.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 212 to 222\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/a52945b1c51fa874667eecb9fea9bf03e5d6153b\">a52945b</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L212\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"212\"></td>\n          <td id=\"LC212\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">batchMessageId</span> == <span class=\"pl-c1\">null</span> || <span class=\"pl-smi\">MessageIdAdvUtils</span>.<span class=\"pl-en\">acknowledge</span>(<span class=\"pl-s1\">batchMessageId</span>, <span class=\"pl-c1\">true</span>)) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L213\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"213\"></td>\n          <td id=\"LC213\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">consumer</span>.<span class=\"pl-en\">getStats</span>().<span class=\"pl-en\">incrementNumAcksSent</span>((<span class=\"pl-s1\">batchMessageId</span> != <span class=\"pl-c1\">null</span>) ? <span class=\"pl-s1\">batchMessageId</span>.<span class=\"pl-en\">getBatchSize</span>() : <span class=\"pl-c1\">1</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L214\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"214\"></td>\n          <td id=\"LC214\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">consumer</span>.<span class=\"pl-en\">getUnAckedMessageTracker</span>().<span class=\"pl-en\">remove</span>(<span class=\"pl-s1\">msgId</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L215\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"215\"></td>\n          <td id=\"LC215\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">consumer</span>.<span class=\"pl-en\">getPossibleSendToDeadLetterTopicMessages</span>() != <span class=\"pl-c1\">null</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L216\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"216\"></td>\n          <td id=\"LC216\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-s1\">consumer</span>.<span class=\"pl-en\">getPossibleSendToDeadLetterTopicMessages</span>().<span class=\"pl-en\">remove</span>(<span class=\"pl-s1\">msgId</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L217\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"217\"></td>\n          <td id=\"LC217\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L218\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"218\"></td>\n          <td id=\"LC218\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-s1\">individualAckFunction</span>.<span class=\"pl-en\">apply</span>(<span class=\"pl-s1\">msgId</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L219\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"219\"></td>\n          <td id=\"LC219\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } <span class=\"pl-k\">else</span> <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">batchIndexAckEnabled</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L220\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"220\"></td>\n          <td id=\"LC220\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-s1\">batchAckFunction</span>.<span class=\"pl-en\">apply</span>(<span class=\"pl-s1\">batchMessageId</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L221\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"221\"></td>\n          <td id=\"LC221\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L222\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"222\"></td>\n          <td id=\"LC222\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> <span class=\"pl-smi\">CompletableFuture</span>.<span class=\"pl-en\">completedFuture</span>(<span class=\"pl-c1\">null</span>); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/a52945b1c51fa874667eecb9fea9bf03e5d6153b/pulsar-client/src/main/java/org/apache/pulsar/client/impl/MessageIdAdvUtils.java#L53-L59\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/MessageIdAdvUtils.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 53 to 59\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/a52945b1c51fa874667eecb9fea9bf03e5d6153b\">a52945b</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L53\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"53\"></td>\n          <td id=\"LC53\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">batchIndex</span> = <span class=\"pl-s1\">msgId</span>.<span class=\"pl-en\">getBatchIndex</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L54\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"54\"></td>\n          <td id=\"LC54\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">individual</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L55\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"55\"></td>\n          <td id=\"LC55\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">ackSet</span>.<span class=\"pl-en\">clear</span>(<span class=\"pl-s1\">batchIndex</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L56\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"56\"></td>\n          <td id=\"LC56\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } <span class=\"pl-k\">else</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L57\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"57\"></td>\n          <td id=\"LC57\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">ackSet</span>.<span class=\"pl-en\">clear</span>(<span class=\"pl-c1\">0</span>, <span class=\"pl-s1\">batchIndex</span> + <span class=\"pl-c1\">1</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L58\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"58\"></td>\n          <td id=\"LC58\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L59\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"59\"></td>\n          <td id=\"LC59\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">return</span> <span class=\"pl-s1\">ackSet</span>.<span class=\"pl-en\">isEmpty</span>(); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2207171207\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/22353\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/22353/hovercard\" href=\"https://github.com/apache/pulsar/pull/22353\">#22353</a></li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22352",
                "createdAt": "2024-03-26T03:02:13Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[cleanup][broker] Fix PersistentSubscription duplicate implementation interface Subscription",
        "url": "https://github.com/apache/pulsar/pull/22359",
        "resourcePath": "/apache/pulsar/pull/22359",
        "createdAt": "2024-03-26T08:25:02Z",
        "number": 22359,
        "mergeCommit": {
          "oid": "6f9c8e7f70ec201d65c7fc270480bed3aa3b5aba",
          "message": "[fix][broker] Fix PersistentSubscription duplicate implementation interface Subscription (#22359)",
          "commitUrl": "https://github.com/apache/pulsar/commit/6f9c8e7f70ec201d65c7fc270480bed3aa3b5aba",
          "parents": {
            "nodes": [
              {
                "oid": "32037c3b0982aa00a7cb5ee7e17a6b235a8c2d7f",
                "message": "[fix][broker] Fix typos in PersistentTopic class (#22364)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentSubscription.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentSubscription.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5qwRNC2gAoZmNkZTUwNjc1MzZlNTdhNTZlNzdhZjAwOTExNWM3ZTQxZjBiMGE2Yw",
                "url": "https://github.com/apache/pulsar/pull/22359/commits/fcde5067536e57a56e77af009115c7e41f0b0a6c"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22354,
                "url": "https://github.com/apache/pulsar/issues/22354",
                "title": "[Cleanup] PersistentSubscription duplicate implementation interface Subscription",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">branch-3.2</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Code design issues</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/19645523/316745933-8b270ff5-ef38-4a5b-856a-d4bf24d4a7cb.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzQxMDksIm5iZiI6MTcxNDk3MzgwOSwicGF0aCI6Ii8xOTY0NTUyMy8zMTY3NDU5MzMtOGIyNzBmZjUtZWYzOC00YTViLTg1NmEtZDRiZjI0ZDRhN2NiLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzY0OVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVhNzU1NTVjNjlhMDA3MTEyYmNmNzg4MDg2YTI4Y2YxMzc1Yzc5ZWNlOTJhZDMyOTJkYWZjMWQxY2Y3MThkYjYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.vOy9kWwK5aCB0F6LlcMeG0BIZDOGM9GBEVhTpuPFUM0\"><img src=\"https://private-user-images.githubusercontent.com/19645523/316745933-8b270ff5-ef38-4a5b-856a-d4bf24d4a7cb.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzQxMDksIm5iZiI6MTcxNDk3MzgwOSwicGF0aCI6Ii8xOTY0NTUyMy8zMTY3NDU5MzMtOGIyNzBmZjUtZWYzOC00YTViLTg1NmEtZDRiZjI0ZDRhN2NiLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzY0OVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVhNzU1NTVjNjlhMDA3MTEyYmNmNzg4MDg2YTI4Y2YxMzc1Yzc5ZWNlOTJhZDMyOTJkYWZjMWQxY2Y3MThkYjYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.vOy9kWwK5aCB0F6LlcMeG0BIZDOGM9GBEVhTpuPFUM0\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/19645523/316746355-a440ff77-df56-420b-a28d-1a02ef1c308b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzQxMDksIm5iZiI6MTcxNDk3MzgwOSwicGF0aCI6Ii8xOTY0NTUyMy8zMTY3NDYzNTUtYTQ0MGZmNzctZGY1Ni00MjBiLWEyOGQtMWEwMmVmMWMzMDhiLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzY0OVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTlkNTEyMGU5OGE3YjIwODM1YWI5ODA2M2QxMTE3M2NiMzViYThjYWFiMjQwYjFiZWJmOWEzZmI4NzU3YTU3MjYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.LoPNbi8crIL3egUV5NktZoHHfik3tsTpfazDFph7aNA\"><img src=\"https://private-user-images.githubusercontent.com/19645523/316746355-a440ff77-df56-420b-a28d-1a02ef1c308b.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzQxMDksIm5iZiI6MTcxNDk3MzgwOSwicGF0aCI6Ii8xOTY0NTUyMy8zMTY3NDYzNTUtYTQ0MGZmNzctZGY1Ni00MjBiLWEyOGQtMWEwMmVmMWMzMDhiLnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzY0OVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTlkNTEyMGU5OGE3YjIwODM1YWI5ODA2M2QxMTE3M2NiMzViYThjYWFiMjQwYjFiZWJmOWEzZmI4NzU3YTU3MjYmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.LoPNbi8crIL3egUV5NktZoHHfik3tsTpfazDFph7aNA\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">PersistentSubscription implemented Subscription , in this <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/apache/pulsar/commit/07c46fe9ef42a72de18be3267e70a51bbc883678/hovercard\" href=\"https://github.com/apache/pulsar/commit/07c46fe9ef42a72de18be3267e70a51bbc883678\"><tt>07c46fe</tt></a> commit added to extends the AbstractSubscription class, and the AbstractSubscription class implements Subscription resulting in duplicate implementation of the Subscription<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/19645523/316747428-e4986f04-928b-4bf7-a1c1-3d3a4783c8f6.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzQxMDksIm5iZiI6MTcxNDk3MzgwOSwicGF0aCI6Ii8xOTY0NTUyMy8zMTY3NDc0MjgtZTQ5ODZmMDQtOTI4Yi00YmY3LWExYzEtM2QzYTQ3ODNjOGY2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzY0OVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVmNmQ0M2JiNGYyZDRmNjZjZTQyZTZmMTYyMGU5MmQwOWFjYWEwMzE2NTUxYjIxYmQzYWNkYTVkNzk5OGQzMzcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.2gj88ri3z57-KQ0aipO4f_XstrIU43fd9-2lT-kTVCQ\"><img src=\"https://private-user-images.githubusercontent.com/19645523/316747428-e4986f04-928b-4bf7-a1c1-3d3a4783c8f6.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzQxMDksIm5iZiI6MTcxNDk3MzgwOSwicGF0aCI6Ii8xOTY0NTUyMy8zMTY3NDc0MjgtZTQ5ODZmMDQtOTI4Yi00YmY3LWExYzEtM2QzYTQ3ODNjOGY2LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA1MDYlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNTA2VDA1MzY0OVomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPTVmNmQ0M2JiNGYyZDRmNjZjZTQyZTZmMTYyMGU5MmQwOWFjYWEwMzE2NTUxYjIxYmQzYWNkYTVkNzk5OGQzMzcmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.2gj88ri3z57-KQ0aipO4f_XstrIU43fd9-2lT-kTVCQ\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22354",
                "createdAt": "2024-03-26T06:16:17Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][misc] Make ConcurrentBitSet thread safe",
        "url": "https://github.com/apache/pulsar/pull/22361",
        "resourcePath": "/apache/pulsar/pull/22361",
        "createdAt": "2024-03-26T10:29:11Z",
        "number": 22361,
        "mergeCommit": {
          "oid": "edd0076bd83f01a5fcbe81c8396667014f0fc36e",
          "message": "[fix][misc] Make ConcurrentBitSet thread safe (#22361)",
          "commitUrl": "https://github.com/apache/pulsar/commit/edd0076bd83f01a5fcbe81c8396667014f0fc36e",
          "parents": {
            "nodes": [
              {
                "oid": "e4553391f96af3bda3d8252b97cac3de1f39a1b5",
                "message": "[improve][broker] Optimize web interface deleteDynamicConfiguration return error message (#22356)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentBitSet.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5qxSHp2gAoMGNmNmRjNWM5ZWJiYzAyMzQxM2NkMWIzZDI4Y2VhZTU2ZjkwMTNlZg",
                "url": "https://github.com/apache/pulsar/pull/22361/commits/0cf6dc5c9ebbc023413cd1b3d28ceae56f9013ef"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22360,
                "url": "https://github.com/apache/pulsar/issues/22360",
                "title": "[Bug] ConcurrentBitSet is not thread safe",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">ConcurrentBitSet was introduced in Pulsar 2.4.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">ConcurrentBitSet claims to be a multi-thread safe class.</p>\n<p dir=\"auto\">There are several problems:</p>\n<ul dir=\"auto\">\n<li>It contains invalid use of <code class=\"notranslate\">StampedLock</code> class. It isn't using write lock, which makes the use of StampedLock useless.</li>\n<li>Many used methods aren't handled. for example <code class=\"notranslate\">.clear()</code> method.</li>\n</ul>\n<p dir=\"auto\">ConcurrentBitSet.clear is called here: </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/35bb021cdbd9cc9f4f801bd14f95d035a76a0043/pulsar-client/src/main/java/org/apache/pulsar/client/impl/PersistentAcknowledgmentsGroupingTracker.java#L335\">pulsar/pulsar-client/src/main/java/org/apache/pulsar/client/impl/PersistentAcknowledgmentsGroupingTracker.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 335\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/35bb021cdbd9cc9f4f801bd14f95d035a76a0043\">35bb021</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L335\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"335\"></td>\n          <td id=\"LC335\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">bitSet</span>.<span class=\"pl-en\">clear</span>(<span class=\"pl-s1\">msgId</span>.<span class=\"pl-en\">getBatchIndex</span>()); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<ul dir=\"auto\">\n<li>ConcurrentBitSet should properly use StampedLock</li>\n<li>It should make most methods thread safe and prevent usage of other non-thread safe fields.</li>\n</ul>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">ConcurrentBitSet is not thread safe</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">This is related to issue <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2207137171\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/22352\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/22352/hovercard\" href=\"https://github.com/apache/pulsar/issues/22352\">#22352</a></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22360",
                "createdAt": "2024-03-26T09:33:04Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix OpReadEntry.skipCondition NPE issue",
        "url": "https://github.com/apache/pulsar/pull/22367",
        "resourcePath": "/apache/pulsar/pull/22367",
        "createdAt": "2024-03-27T08:54:54Z",
        "number": 22367,
        "mergeCommit": {
          "oid": "404c0572a461908ffe09c483092d8df78356eae9",
          "message": "[fix][broker] Fix OpReadEntry.skipCondition NPE issue (#22367)",
          "commitUrl": "https://github.com/apache/pulsar/commit/404c0572a461908ffe09c483092d8df78356eae9",
          "parents": {
            "nodes": [
              {
                "oid": "149deaa5a79ed8570489bead4215ae213a4e9206",
                "message": "[fix][client] Fix wrong results of hasMessageAvailable and readNext after seeking by timestamp (#22363)\n\nCo-authored-by: Lari Hotari <lhotari@users.noreply.github.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/OpReadEntry.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5q5bQ02gAoYTczYjIxZTE0MTliYzNhOWYxYzM0OWQ4ZTlkMzg0OTZhOTE0NzQxMA",
                "url": "https://github.com/apache/pulsar/pull/22367/commits/a73b21e1419bc3a9f1c349d8e9d38496a9147410"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22365,
                "url": "https://github.com/apache/pulsar/issues/22365",
                "title": "NullPointerException  \"opReadEntry.skipCondition\" is null appears to cause topic to stop delivering messages",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">apache/pulsar-all:3.0.3 container deployed via the apache/pulsar helm chart<br>\nC++ client version 3.4.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">We were attempting to run a stress test using the 3.0.3 release of the pulsar-all image.<br>\nAt the time of the failure, we were running 9 brokers, 6 bookies and 3 zookeepers.  We had around 3.7k topics, 150k producers, 1.3k consumers and 1.3k subscriptions in the local cluster.</p>\n<p dir=\"auto\">There were three other pulsar clusters with global replication enabled, but the failure we ran into didn't appear to have anything to do with replication since the topic and consumer were both local.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Pulsar messages published and consumed consistently from all topics</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">We had two topics stop delivering messages at different times.  They were in different pulsar namespaces and homed on different brokers.  We restarted the workloads consuming from the topics which did not resolve the problem.</p>\n<p dir=\"auto\">Performing a <code class=\"notranslate\">pulsar-admin topics unload</code> for the affected topics got things flowing again and the consumers worked through their backlog.</p>\n<p dir=\"auto\">At the same time as our metrics showed the backlogs starting to grow (+/- 15s), the broker for each topic showed this exception in its log:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.lang.NullPointerException: Cannot invoke &quot;java.util.function.Predicate.test(Object)&quot; because &quot;opReadEntry.skipCondition&quot; is null\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.internalReadFromLedger(ManagedLedgerImpl.java:2100) ~[org.apache.pulsar-managed-ledger-3.0.3.jar:3.0.3]\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.asyncReadEntries(ManagedLedgerImpl.java:1886) ~[org.apache.pulsar-managed-ledger-3.0.3.jar:3.0.3]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncReadEntriesWithSkip(ManagedCursorImpl.java:794) ~[org.apache.pulsar-managed-ledger-3.0.3.jar:3.0.3]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncReadEntriesWithSkipOrWait(ManagedCursorImpl.java:947) ~[org.apache.pulsar-managed-ledger-3.0.3.jar:3.0.3]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncReadEntriesOrWait(ManagedCursorImpl.java:920) ~[org.apache.pulsar-managed-ledger-3.0.3.jar:3.0.3]\n\tat org.apache.pulsar.broker.service.persistent.PersistentDispatcherSingleActiveConsumer.readMoreEntries(PersistentDispatcherSingleActiveConsumer.java:355) ~[org.apache.pulsar-pulsar-broker-3.0.3.jar:3.0.3]\n\tat org.apache.pulsar.broker.service.persistent.PersistentDispatcherSingleActiveConsumer.lambda$dispatchEntriesToConsumer$2(PersistentDispatcherSingleActiveConsumer.java:232) ~[org.apache.pulsar-pulsar-broker-3.0.3.jar:3.0.3]\n\tat org.apache.bookkeeper.common.util.SingleThreadExecutor.safeRunTask(SingleThreadExecutor.java:137) ~[org.apache.bookkeeper-bookkeeper-common-4.16.4.jar:4.16.4]\n\tat org.apache.bookkeeper.common.util.SingleThreadExecutor.run(SingleThreadExecutor.java:113) ~[org.apache.bookkeeper-bookkeeper-common-4.16.4.jar:4.16.4]\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.100.Final.jar:4.1.100.Final]\n\tat java.lang.Thread.run(Thread.java:840) ~[?:?]\"><pre class=\"notranslate\"><code class=\"notranslate\">java.lang.NullPointerException: Cannot invoke \"java.util.function.Predicate.test(Object)\" because \"opReadEntry.skipCondition\" is null\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.internalReadFromLedger(ManagedLedgerImpl.java:2100) ~[org.apache.pulsar-managed-ledger-3.0.3.jar:3.0.3]\n\tat org.apache.bookkeeper.mledger.impl.ManagedLedgerImpl.asyncReadEntries(ManagedLedgerImpl.java:1886) ~[org.apache.pulsar-managed-ledger-3.0.3.jar:3.0.3]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncReadEntriesWithSkip(ManagedCursorImpl.java:794) ~[org.apache.pulsar-managed-ledger-3.0.3.jar:3.0.3]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncReadEntriesWithSkipOrWait(ManagedCursorImpl.java:947) ~[org.apache.pulsar-managed-ledger-3.0.3.jar:3.0.3]\n\tat org.apache.bookkeeper.mledger.impl.ManagedCursorImpl.asyncReadEntriesOrWait(ManagedCursorImpl.java:920) ~[org.apache.pulsar-managed-ledger-3.0.3.jar:3.0.3]\n\tat org.apache.pulsar.broker.service.persistent.PersistentDispatcherSingleActiveConsumer.readMoreEntries(PersistentDispatcherSingleActiveConsumer.java:355) ~[org.apache.pulsar-pulsar-broker-3.0.3.jar:3.0.3]\n\tat org.apache.pulsar.broker.service.persistent.PersistentDispatcherSingleActiveConsumer.lambda$dispatchEntriesToConsumer$2(PersistentDispatcherSingleActiveConsumer.java:232) ~[org.apache.pulsar-pulsar-broker-3.0.3.jar:3.0.3]\n\tat org.apache.bookkeeper.common.util.SingleThreadExecutor.safeRunTask(SingleThreadExecutor.java:137) ~[org.apache.bookkeeper-bookkeeper-common-4.16.4.jar:4.16.4]\n\tat org.apache.bookkeeper.common.util.SingleThreadExecutor.run(SingleThreadExecutor.java:113) ~[org.apache.bookkeeper-bookkeeper-common-4.16.4.jar:4.16.4]\n\tat io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.100.Final.jar:4.1.100.Final]\n\tat java.lang.Thread.run(Thread.java:840) ~[?:?]\n</code></pre></div>\n<p dir=\"auto\">That exception was only present twice in our logs, and only at the times the two affected topics' backlogs started growing.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">We are coming from ~3.0.1 and this is a failure mode we haven't seen before.  We have so far been unable to find the root cause in the underlying code.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22365",
                "createdAt": "2024-03-27T00:37:40Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky ManagedLedgerErrorsTest.recoverAfterZnodeVersionError",
        "url": "https://github.com/apache/pulsar/pull/22368",
        "resourcePath": "/apache/pulsar/pull/22368",
        "createdAt": "2024-03-27T09:17:43Z",
        "number": 22368,
        "mergeCommit": {
          "oid": "c184209bfc5a61f143abfa701e5f1b0be2109d77",
          "message": "[fix][test] Fix flaky ManagedLedgerErrorsTest.recoverAfterZnodeVersionError (#22368)",
          "commitUrl": "https://github.com/apache/pulsar/commit/c184209bfc5a61f143abfa701e5f1b0be2109d77",
          "parents": {
            "nodes": [
              {
                "oid": "fc066d727b52f7e412476297995c2eb2f5ab61bf",
                "message": "[fix] [test] Fix flaky test ManagedLedgerTest.testGetNumberOfEntriesInStorage (#22344)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerErrorsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5q5lqK2gAoYTk1ODdhMmQzNDE5Nzc4NzllNDJmYzg4ZGU0YWRkYjBkYjJhZmIxMg",
                "url": "https://github.com/apache/pulsar/pull/22368/commits/a9587a2d341977879e42fc88de4addb0db2afb12"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22348,
                "url": "https://github.com/apache/pulsar/issues/22348",
                "title": "Flaky-test: ManagedLedgerErrorsTest.recoverAfterZnodeVersionError",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/8415552736/job/23083691179\">https://github.com/apache/pulsar/actions/runs/8415552736/job/23083691179</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"Error:  org.apache.bookkeeper.mledger.impl.ManagedLedgerErrorsTest.recoverAfterZnodeVersionError  Time elapsed: 0.013 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [class org.apache.bookkeeper.mledger.ManagedLedgerException$BadVersionException] but found [class java.lang.Exception]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n  \tat org.testng.Assert.assertEquals(Assert.java:131)\n  \tat org.testng.Assert.assertEquals(Assert.java:643)\n  \tat org.apache.bookkeeper.mledger.impl.ManagedLedgerErrorsTest.recoverAfterZnodeVersionError(ManagedLedgerErrorsTest.java:384)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:840)\n\"><pre class=\"notranslate\"><code class=\"notranslate\">Error:  org.apache.bookkeeper.mledger.impl.ManagedLedgerErrorsTest.recoverAfterZnodeVersionError  Time elapsed: 0.013 s  &lt;&lt;&lt; FAILURE!\n  java.lang.AssertionError: expected [class org.apache.bookkeeper.mledger.ManagedLedgerException$BadVersionException] but found [class java.lang.Exception]\n  \tat org.testng.Assert.fail(Assert.java:110)\n  \tat org.testng.Assert.failNotEquals(Assert.java:1577)\n  \tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n  \tat org.testng.Assert.assertEquals(Assert.java:131)\n  \tat org.testng.Assert.assertEquals(Assert.java:643)\n  \tat org.apache.bookkeeper.mledger.impl.ManagedLedgerErrorsTest.recoverAfterZnodeVersionError(ManagedLedgerErrorsTest.java:384)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n  \tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n  \tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n  \tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n  \tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n  \tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n  \tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n  \tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n  \tat java.base/java.lang.Thread.run(Thread.java:840)\n\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22348",
                "createdAt": "2024-03-26T01:46:56Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "help wanted"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Skip topic.close during unloading if the topic future fails with ownership check, and fix isBundleOwnedByAnyBroker to use ns.checkOwnershipPresentAsync for ExtensibleLoadBalancer",
        "url": "https://github.com/apache/pulsar/pull/22379",
        "resourcePath": "/apache/pulsar/pull/22379",
        "createdAt": "2024-03-28T18:50:17Z",
        "number": 22379,
        "mergeCommit": {
          "oid": "3eb3b1cd23d2cc11424bf882e244d3bc2e92bf27",
          "message": "[fix][broker] Skip topic.close during unloading if the topic future fails with ownership check, and fix isBundleOwnedByAnyBroker to use ns.checkOwnershipPresentAsync for ExtensibleLoadBalancer (#22379)",
          "commitUrl": "https://github.com/apache/pulsar/commit/3eb3b1cd23d2cc11424bf882e244d3bc2e92bf27",
          "parents": {
            "nodes": [
              {
                "oid": "9529738efe2faabe5283f74921f780d8589fb437",
                "message": "[fix][ml] No rollover inactive ledgers when metadata service invalid (#22284)\n\n### Motivation\r\n\r\nWe should not rollover inactive ledgers when metadata service is invailable.\r\n\r\n### Modifications\r\n\r\nChecking metadata service is vailable when schedule `checkInactiveLedgerAndRollOver`"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/manager/UnloadManager.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/web/PulsarWebResource.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/extensions/ExtensibleLoadManagerImplBaseTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/extensions/ExtensibleLoadManagerImplTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/extensions/manager/UnloadManagerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5rFzqN2gAoN2FjNjQxNjQ0OWY4NDc1NDg3MTcwYzdjZGUxOTlhYzAwNTllOTBlYw",
                "url": "https://github.com/apache/pulsar/pull/22379/commits/7ac6416449f8475487170c7cde199ac0059e90ec"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20157,
                "url": "https://github.com/apache/pulsar/issues/20157",
                "title": "Flaky-test: ExtensibleLoadManagerImplTest.initializeState",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failure</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/pulsar/actions/runs/4755217144/jobs/8449646027\">https://github.com/apache/pulsar/actions/runs/4755217144/jobs/8449646027</a></p>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<p dir=\"auto\">don't know how to find stacktrace.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20157",
                "createdAt": "2023-04-20T15:43:18Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "area/test"
                      }
                    },
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[Enhancement]Added a metric for geo replication for tracking replicated subscriptions snapshot timeouts",
        "url": "https://github.com/apache/pulsar/pull/22381",
        "resourcePath": "/apache/pulsar/pull/22381",
        "createdAt": "2024-03-29T06:58:44Z",
        "number": 22381,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/ReplicatedSubscriptionsController.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5rIwqb2gAoNDhmZTQyMGNjODM0ZGQyNjU5OWViM2UzMWYyZmNjMzUwZmZmYmZlYg",
                "url": "https://github.com/apache/pulsar/pull/22381/commits/48fe420cc834dd26599eb3e31f2fcc350fffbfeb"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21793,
                "url": "https://github.com/apache/pulsar/issues/21793",
                "title": "Add a metric for geo replication for tracking replicated subscriptions snapshot timeouts",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Geo replication replicated subscriptions (PIP-33) <a href=\"https://github.com/apache/pulsar/wiki/PIP-33%3A-Replicated-subscriptions#constructing-a-cursor-snapshot\">snapshot creation might time out</a>.<br>\nThe code contains a debug log message when this happens: </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/465fac523da946553b09298e13dc7dfcecfb6c78/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/ReplicatedSubscriptionsController.java#L256\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/ReplicatedSubscriptionsController.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 256\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/465fac523da946553b09298e13dc7dfcecfb6c78\">465fac5</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L256\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"256\"></td>\n          <td id=\"LC256\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">log</span>.<span class=\"pl-en\">debug</span>(<span class=\"pl-s\">\"[{}] Snapshot creation timed out for {}\"</span>, <span class=\"pl-s1\">topic</span>.<span class=\"pl-en\">getName</span>(), <span class=\"pl-s1\">entry</span>.<span class=\"pl-en\">getKey</span>()); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\nWhen this happens, the subscription state won't be reflected on the remote side and a backlog would build up.<br>\nThere's no metric to detect this situation.<p></p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Add a new metric <code class=\"notranslate\">pulsar_replicated_subscriptions_snapshot_timeouts</code> which is a counter (that only resets when the broker restarts).</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">Increasing the timeout threshold <code class=\"notranslate\">replicatedSubscriptionsSnapshotTimeoutSeconds=30</code> -&gt; <code class=\"notranslate\">replicatedSubscriptionsSnapshotTimeoutSeconds=60</code> could help resolve the situation. This metric would help detect when it would be necessary.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21793",
                "createdAt": "2023-12-22T07:42:23Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Fix flaky test LeaderElectionTest.revalidateLeaderWithinSameSession",
        "url": "https://github.com/apache/pulsar/pull/22383",
        "resourcePath": "/apache/pulsar/pull/22383",
        "createdAt": "2024-03-29T09:51:46Z",
        "number": 22383,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/main/java/org/apache/pulsar/metadata/api/MetadataCache.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-metadata/src/test/java/org/apache/pulsar/metadata/BaseMetadataStoreTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5rJlua2gAoZDQ1YTFiYzQyMzRiMDNlOGQwNWM0NjBhZDlmYmFjMDczNjhkNTZlYQ",
                "url": "https://github.com/apache/pulsar/pull/22383/commits/d45a1bc4234b03e8d05c460ad9fbac07368d56ea"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21535,
                "url": "https://github.com/apache/pulsar/issues/21535",
                "title": "Flaky-test: LeaderElectionTest.revalidateLeaderWithinSameSession",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failures</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6725651280/job/18280799117#step:11:1934\">2023-11-01T22:34:20.4026218Z</a></li>\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/6710630191/job/18237677637#step:11:1899\">2023-10-31T18:55:24.5179215Z</a></li>\n</ul>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.lang.AssertionError: expected [Optional[test-2]] but found [Optional.empty]\n\tat org.testng.Assert.fail(Assert.java:110)\n\tat org.testng.Assert.failNotEquals(Assert.java:1577)\n\tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n\tat org.testng.Assert.assertEquals(Assert.java:131)\n\tat org.testng.Assert.assertEquals(Assert.java:643)\n\tat org.apache.pulsar.metadata.BaseMetadataStoreTest.lambda$assertEqualsAndRetry$6(BaseMetadataStoreTest.java:133)\n\tat org.apache.pulsar.metadata.BaseMetadataStoreTest.retryStrategically(BaseMetadataStoreTest.java:141)\n\tat org.apache.pulsar.metadata.BaseMetadataStoreTest.assertEqualsAndRetry(BaseMetadataStoreTest.java:129)\n\tat org.apache.pulsar.metadata.BaseMetadataStoreTest.assertEqualsAndRetry(BaseMetadataStoreTest.java:121)\n\tat org.apache.pulsar.metadata.LeaderElectionTest.revalidateLeaderWithinSameSession(LeaderElectionTest.java:212)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:833)\n\"><pre class=\"notranslate\"><code class=\"notranslate\">java.lang.AssertionError: expected [Optional[test-2]] but found [Optional.empty]\n\tat org.testng.Assert.fail(Assert.java:110)\n\tat org.testng.Assert.failNotEquals(Assert.java:1577)\n\tat org.testng.Assert.assertEqualsImpl(Assert.java:149)\n\tat org.testng.Assert.assertEquals(Assert.java:131)\n\tat org.testng.Assert.assertEquals(Assert.java:643)\n\tat org.apache.pulsar.metadata.BaseMetadataStoreTest.lambda$assertEqualsAndRetry$6(BaseMetadataStoreTest.java:133)\n\tat org.apache.pulsar.metadata.BaseMetadataStoreTest.retryStrategically(BaseMetadataStoreTest.java:141)\n\tat org.apache.pulsar.metadata.BaseMetadataStoreTest.assertEqualsAndRetry(BaseMetadataStoreTest.java:129)\n\tat org.apache.pulsar.metadata.BaseMetadataStoreTest.assertEqualsAndRetry(BaseMetadataStoreTest.java:121)\n\tat org.apache.pulsar.metadata.LeaderElectionTest.revalidateLeaderWithinSameSession(LeaderElectionTest.java:212)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:833)\n\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21535",
                "createdAt": "2023-11-07T12:55:31Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][txn] Fix SnapshotSegmentAbortedTxnProcessorImpl thread safety issue",
        "url": "https://github.com/apache/pulsar/pull/22384",
        "resourcePath": "/apache/pulsar/pull/22384",
        "createdAt": "2024-03-29T10:07:54Z",
        "number": 22384,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/impl/SnapshotSegmentAbortedTxnProcessorImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5rJrH42gAoOTE1ODAzNmY2M2IyN2UwM2ZkYjIxNzg4N2Q3NjYwYzg2MDhmY2YwZg",
                "url": "https://github.com/apache/pulsar/pull/22384/commits/9158036f63b27e03fdb217887d7660c8608fcf0f"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22116,
                "url": "https://github.com/apache/pulsar/issues/22116",
                "title": "[Bug] SnapshotSegmentAbortedTxnProcessorImpl contains thread safety issues",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">There are several thread safety issues in SnapshotSegmentAbortedTxnProcessorImpl class.<br>\nexamples:<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/529e1ab80998143cfe793c018429e9d2bbee5473/pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/impl/SnapshotSegmentAbortedTxnProcessorImpl.java#L374-L376\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/impl/SnapshotSegmentAbortedTxnProcessorImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 374 to 376\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/529e1ab80998143cfe793c018429e9d2bbee5473\">529e1ab</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L374\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"374\"></td>\n          <td id=\"LC374\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">if</span> (<span class=\"pl-s1\">indexes</span>.<span class=\"pl-en\">size</span>() != <span class=\"pl-c1\">0</span>) { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L375\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"375\"></td>\n          <td id=\"LC375\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-s1\">persistentWorker</span>.<span class=\"pl-s1\">sequenceID</span>.<span class=\"pl-en\">set</span>(<span class=\"pl-s1\">indexes</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">indexes</span>.<span class=\"pl-en\">lastKey</span>()).<span class=\"pl-s1\">sequenceID</span> + <span class=\"pl-c1\">1</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L376\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"376\"></td>\n          <td id=\"LC376\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\n<div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/529e1ab80998143cfe793c018429e9d2bbee5473/pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/impl/SnapshotSegmentAbortedTxnProcessorImpl.java#L383\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/impl/SnapshotSegmentAbortedTxnProcessorImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 383\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/529e1ab80998143cfe793c018429e9d2bbee5473\">529e1ab</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L383\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"383\"></td>\n          <td id=\"LC383\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">unsealedTxnIds</span>.<span class=\"pl-en\">forEach</span>(<span class=\"pl-s1\">txnID</span> -&gt; <span class=\"pl-s1\">aborts</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s1\">txnID</span>, <span class=\"pl-s1\">txnID</span>)); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\n<div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/529e1ab80998143cfe793c018429e9d2bbee5473/pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/impl/SnapshotSegmentAbortedTxnProcessorImpl.java#L744\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/transaction/buffer/impl/SnapshotSegmentAbortedTxnProcessorImpl.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 744\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/529e1ab80998143cfe793c018429e9d2bbee5473\">529e1ab</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L744\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"744\"></td>\n          <td id=\"LC744\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">indexes</span>.<span class=\"pl-en\">put</span>(<span class=\"pl-s1\">abortedMarkerPersistentPosition</span>, <span class=\"pl-s1\">index</span>); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Multi-threading code should be thread safe.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Non thread-safe code.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22116",
                "createdAt": "2024-02-26T06:35:10Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker][admin] Fix cannot update properties on NonDurable subscription.",
        "url": "https://github.com/apache/pulsar/pull/22411",
        "resourcePath": "/apache/pulsar/pull/22411",
        "createdAt": "2024-04-03T08:05:00Z",
        "number": 22411,
        "mergeCommit": {
          "oid": "902728ef6590233b87c14d2528590ad7e6fdcc12",
          "message": "[fix][broker][admin] Fix cannot update properties on NonDurable subscription. (#22411)",
          "commitUrl": "https://github.com/apache/pulsar/commit/902728ef6590233b87c14d2528590ad7e6fdcc12",
          "parents": {
            "nodes": [
              {
                "oid": "5f31ec383bb7526eca24b95002f6cd498057fee7",
                "message": "[improve][test] Move most flaky tests to flaky group (#22433)\n\n- also add solution for running test methods added to flaky group since that was missing"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5rh1Dm2gAoOWQ0ODg2MmIwZDhmZjQ5OTczOTk5YWRhNTYyZDJjNTc5MDAzYzQ5Nw",
                "url": "https://github.com/apache/pulsar/pull/22411/commits/9d48862b0d8ff49973999ada562d2c579003c497"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22402,
                "url": "https://github.com/apache/pulsar/issues/22402",
                "title": "[Bug] Unable to update subscription properties on non-durable subscription",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">OS: Ubuntu 23.10<br>\nDocker Pulsar standalone 3.1.2</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Using Java client suggesting that <code class=\"notranslate\">adminClient</code> is of type <code class=\"notranslate\">PulsarAdmin</code>:<br>\ninvoke <code class=\"notranslate\">adminClient.topics().updateSubscriptionProperties(*topicName*, *subName*, *props*)</code> on a persistent topic (on a non-persistent topic it works just fine) and on non-durable subscription (for durable subscriptions updates also).</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Expected to update properties for subscription on a topic</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">I got error:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\" --- An unexpected error occurred in the server ---\n\nMessage: \n --- An unexpected error occurred in the server ---\n\nMessage: Cannot invoke &quot;org.apache.bookkeeper.mledger.proto.MLDataFormats$ManagedCursorInfo.hasCursorsLedgerId()&quot; because &quot;other&quot; is null\n\nStacktrace:\n\njava.lang.NullPointerException: Cannot invoke &quot;org.apache.bookkeeper.mledger.proto.MLDataFormats$ManagedCursorInfo.hasCursorsLedgerId()&quot; because &quot;other&quot; is null\"><pre class=\"notranslate\"><code class=\"notranslate\"> --- An unexpected error occurred in the server ---\n\nMessage: \n --- An unexpected error occurred in the server ---\n\nMessage: Cannot invoke \"org.apache.bookkeeper.mledger.proto.MLDataFormats$ManagedCursorInfo.hasCursorsLedgerId()\" because \"other\" is null\n\nStacktrace:\n\njava.lang.NullPointerException: Cannot invoke \"org.apache.bookkeeper.mledger.proto.MLDataFormats$ManagedCursorInfo.hasCursorsLedgerId()\" because \"other\" is null\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22402",
                "createdAt": "2024-04-02T18:06:32Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix invalid condition in logging exceptions",
        "url": "https://github.com/apache/pulsar/pull/22412",
        "resourcePath": "/apache/pulsar/pull/22412",
        "createdAt": "2024-04-03T08:11:44Z",
        "number": 22412,
        "mergeCommit": {
          "oid": "cd6f53baee7dbe0651e6581cb9bd3570017348c7",
          "message": "[fix][broker] Fix invalid condition in logging exceptions (#22412)",
          "commitUrl": "https://github.com/apache/pulsar/commit/cd6f53baee7dbe0651e6581cb9bd3570017348c7",
          "parents": {
            "nodes": [
              {
                "oid": "7e93d34ee5f9255703ba53a53063a814e2f8e68f",
                "message": "[fix][cli] Fix help option (#22408)\n\nSigned-off-by: Zixuan Liu <nodeces@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v2/NonPersistentTopics.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/v3/Transactions.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5rh5xi2gAoMTdiMWQwN2U4ZDY2MzkxYzg4NTI0NmFjOGEyZDg1MGEwM2MzNjc1YQ",
                "url": "https://github.com/apache/pulsar/pull/22412/commits/17b1d07e8d66391c885246ac8a2d850a03c3675a"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22409,
                "url": "https://github.com/apache/pulsar/issues/22409",
                "title": "[Bug][broker] Broker contains invalid condition for logging exceptions",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Ubuntu 22.04.4, Java 17, Pulsar 3.2.1 (the same bug is also backported to older versions)</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2108435228\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/21995\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/21995/hovercard\" href=\"https://github.com/apache/pulsar/pull/21995\">#21995</a> introduced some search/replace typos.</p>\n<p dir=\"auto\">A new boolean was added:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    protected static boolean isNot307And404Exception(Throwable ex) {\n        return !isRedirectException(ex) &amp;&amp; !isNotFoundException(ex);\n    }\"><pre class=\"notranslate\"><code class=\"notranslate\">    protected static boolean isNot307And404Exception(Throwable ex) {\n        return !isRedirectException(ex) &amp;&amp; !isNotFoundException(ex);\n    }\n</code></pre></div>\n<p dir=\"auto\">In multiple places this new variable was used to replace previous code, but probably because of search/replace mistake exclamation mark was left in front of the new variable.</p>\n<p dir=\"auto\">Correct substitution:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"-                if (!isRedirectException(ex)) {\n +               if (isNot307And404Exception(ex)) {\"><pre class=\"notranslate\"><code class=\"notranslate\">-                if (!isRedirectException(ex)) {\n +               if (isNot307And404Exception(ex)) {\n</code></pre></div>\n<p dir=\"auto\">Incorrect substitution:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"-                   if (!isRedirectException(ex)) {\n+                   if (!isNot307And404Exception(ex)) {\"><pre class=\"notranslate\"><code class=\"notranslate\">-                   if (!isRedirectException(ex)) {\n+                   if (!isNot307And404Exception(ex)) {\n</code></pre></div>\n<p dir=\"auto\">This causes errors in multiple cases. For example:</p>\n<p dir=\"auto\">If this bundle is not in current broker:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"GET https://localhost:8443/admin/v2/non-persistent/tenant/namespace/0x00000000_0x40000000\"><pre class=\"notranslate\"><code class=\"notranslate\">GET https://localhost:8443/admin/v2/non-persistent/tenant/namespace/0x00000000_0x40000000\n</code></pre></div>\n<p dir=\"auto\">API responds correctly, adding Location header and http response code 307:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&lt; HTTP/1.1 307 Temporary Redirect\n&lt; Date: Tue, 02 Apr 2024 11:19:32 GMT\n&lt; Location: https://infra-pulsar-a.staging.eu-central-1.symp:8443/admin/v2/non-persistent/platform/controller/0x00000000_0x40000000?authoritative=false\n&lt; Content-Length: 0\"><pre class=\"notranslate\"><code class=\"notranslate\">&lt; HTTP/1.1 307 Temporary Redirect\n&lt; Date: Tue, 02 Apr 2024 11:19:32 GMT\n&lt; Location: https://infra-pulsar-a.staging.eu-central-1.symp:8443/admin/v2/non-persistent/platform/controller/0x00000000_0x40000000?authoritative=false\n&lt; Content-Length: 0\n</code></pre></div>\n<p dir=\"auto\">But error is logged in broker.log:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"11:18:57.455 [pulsar-web-36-6] ERROR org.apache.pulsar.broker.admin.v2.NonPersistentTopics - [superuser] Failed to list topics on namespace bundle tenant/namespace/0x00000000_0x40000000\njava.util.concurrent.CompletionException: javax.ws.rs.WebApplicationException: HTTP 307 Temporary Redirect\n        at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:315) ~[?:?]\n        at java.util.concurrent.CompletableFuture.uniAcceptNow(CompletableFuture.java:761) ~[?:?]\n        at java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:735) ~[?:?]\n        at java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:2182) ~[?:?]\n        at org.apache.pulsar.broker.web.PulsarWebResource.lambda$validateBundleOwnershipAsync$18(PulsarWebResource.java:723) ~[org.apache.pulsar-pulsar-broker-3.2.1.jar:3.2.1]\n        at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187) ~[?:?]\n        at java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2309) ~[?:?]\n        at org.apache.pulsar.broker.web.PulsarWebResource.validateBundleOwnershipAsync(PulsarWebResource.java:716) ~[org.apache.pulsar-pulsar-broker-3.2.1.jar:3.2.1]\n        at org.apache.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleOwnershipAsync(PulsarWebResource.java:645) ~[org.apache.pulsar-pulsar-broker-3.2.1.jar:3.2.1]\n        at org.apache.pulsar.broker.admin.v2.NonPersistentTopics.lambda$getListFromBundle$11(NonPersistentTopics.java:463) ~[org.apache.pulsar-pulsar-broker-3.2.1.jar:3.2.1]\n        at java.util.concurrent.CompletableFuture.uniAcceptNow(CompletableFuture.java:757) ~[?:?]\n        at java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:735) ~[?:?]\n        at java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:2182) ~[?:?]\n        at org.apache.pulsar.broker.admin.v2.NonPersistentTopics.getListFromBundle(NonPersistentTopics.java:457) ~[org.apache.pulsar-pulsar-broker-3.2.1.jar:3.2.1]\n        at jdk.internal.reflect.GeneratedMethodAccessor25.invoke(Unknown Source) ~[?:?]\n        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n        at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n        at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:52) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:124) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:167) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:159) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:79) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:475) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:397) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:81) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:255) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:248) ~[org.glassfish.jersey.core-jersey-common-2.34.jar:?]\n        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:244) ~[org.glassfish.jersey.core-jersey-common-2.34.jar:?]\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:292) ~[org.glassfish.jersey.core-jersey-common-2.34.jar:?]\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:274) ~[org.glassfish.jersey.core-jersey-common-2.34.jar:?]\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:244) ~[org.glassfish.jersey.core-jersey-common-2.34.jar:?]\n        at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:265) ~[org.glassfish.jersey.core-jersey-common-2.34.jar:?]\n        at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:234) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:680) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:394) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.34.jar:?]\n        at org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:346) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.34.jar:?]\n        at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:366) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.34.jar:?]\n        at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:319) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.34.jar:?]\n        at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:205) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.34.jar:?]\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:799) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.servlet.ServletHandler$ChainEnd.doFilter(ServletHandler.java:1656) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.apache.pulsar.broker.web.AuthenticationFilter.doFilter(AuthenticationFilter.java:73) ~[org.apache.pulsar-pulsar-broker-common-3.2.1.jar:3.2.1]\n        at org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.servlets.QoSFilter.doFilter(QoSFilter.java:202) ~[org.eclipse.jetty-jetty-servlets-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:552) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1624) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1440) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:505) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1594) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1355) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:234) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:181) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.Server.handle(Server.java:516) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.HttpChannel.lambda$handle$1(HttpChannel.java:487) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:732) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:479) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:277) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311) ~[org.eclipse.jetty-jetty-io-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105) ~[org.eclipse.jetty-jetty-io-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.io.ssl.SslConnection$DecryptedEndPoint.onFillable(SslConnection.java:555) ~[org.eclipse.jetty-jetty-io-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:410) ~[org.eclipse.jetty-jetty-io-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.io.ssl.SslConnection$2.succeeded(SslConnection.java:164) ~[org.eclipse.jetty-jetty-io-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105) ~[org.eclipse.jetty-jetty-io-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.io.ChannelEndPoint$1.run(ChannelEndPoint.java:104) ~[org.eclipse.jetty-jetty-io-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:338) ~[org.eclipse.jetty-jetty-util-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:315) ~[org.eclipse.jetty-jetty-util-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:173) ~[org.eclipse.jetty-jetty-util-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:131) ~[org.eclipse.jetty-jetty-util-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:409) ~[org.eclipse.jetty-jetty-util-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[?:?]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.104.Final.jar:4.1.104.Final]\n        at java.lang.Thread.run(Thread.java:840) ~[?:?]\nCaused by: javax.ws.rs.WebApplicationException: HTTP 307 Temporary Redirect\n        at org.apache.pulsar.broker.web.PulsarWebResource.lambda$validateBundleOwnershipAsync$17(PulsarWebResource.java:738) ~[org.apache.pulsar-pulsar-broker-3.2.1.jar:3.2.1]\n        at java.util.concurrent.CompletableFuture.uniAcceptNow(CompletableFuture.java:757) ~[?:?]\n        ... 81 more\"><pre class=\"notranslate\"><code class=\"notranslate\">11:18:57.455 [pulsar-web-36-6] ERROR org.apache.pulsar.broker.admin.v2.NonPersistentTopics - [superuser] Failed to list topics on namespace bundle tenant/namespace/0x00000000_0x40000000\njava.util.concurrent.CompletionException: javax.ws.rs.WebApplicationException: HTTP 307 Temporary Redirect\n        at java.util.concurrent.CompletableFuture.encodeThrowable(CompletableFuture.java:315) ~[?:?]\n        at java.util.concurrent.CompletableFuture.uniAcceptNow(CompletableFuture.java:761) ~[?:?]\n        at java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:735) ~[?:?]\n        at java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:2182) ~[?:?]\n        at org.apache.pulsar.broker.web.PulsarWebResource.lambda$validateBundleOwnershipAsync$18(PulsarWebResource.java:723) ~[org.apache.pulsar-pulsar-broker-3.2.1.jar:3.2.1]\n        at java.util.concurrent.CompletableFuture.uniComposeStage(CompletableFuture.java:1187) ~[?:?]\n        at java.util.concurrent.CompletableFuture.thenCompose(CompletableFuture.java:2309) ~[?:?]\n        at org.apache.pulsar.broker.web.PulsarWebResource.validateBundleOwnershipAsync(PulsarWebResource.java:716) ~[org.apache.pulsar-pulsar-broker-3.2.1.jar:3.2.1]\n        at org.apache.pulsar.broker.web.PulsarWebResource.validateNamespaceBundleOwnershipAsync(PulsarWebResource.java:645) ~[org.apache.pulsar-pulsar-broker-3.2.1.jar:3.2.1]\n        at org.apache.pulsar.broker.admin.v2.NonPersistentTopics.lambda$getListFromBundle$11(NonPersistentTopics.java:463) ~[org.apache.pulsar-pulsar-broker-3.2.1.jar:3.2.1]\n        at java.util.concurrent.CompletableFuture.uniAcceptNow(CompletableFuture.java:757) ~[?:?]\n        at java.util.concurrent.CompletableFuture.uniAcceptStage(CompletableFuture.java:735) ~[?:?]\n        at java.util.concurrent.CompletableFuture.thenAccept(CompletableFuture.java:2182) ~[?:?]\n        at org.apache.pulsar.broker.admin.v2.NonPersistentTopics.getListFromBundle(NonPersistentTopics.java:457) ~[org.apache.pulsar-pulsar-broker-3.2.1.jar:3.2.1]\n        at jdk.internal.reflect.GeneratedMethodAccessor25.invoke(Unknown Source) ~[?:?]\n        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n        at java.lang.reflect.Method.invoke(Method.java:568) ~[?:?]\n        at org.glassfish.jersey.server.model.internal.ResourceMethodInvocationHandlerFactory.lambda$static$0(ResourceMethodInvocationHandlerFactory.java:52) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher$1.run(AbstractJavaResourceMethodDispatcher.java:124) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.invoke(AbstractJavaResourceMethodDispatcher.java:167) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.model.internal.JavaResourceMethodDispatcherProvider$VoidOutInvoker.doDispatch(JavaResourceMethodDispatcherProvider.java:159) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.model.internal.AbstractJavaResourceMethodDispatcher.dispatch(AbstractJavaResourceMethodDispatcher.java:79) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.model.ResourceMethodInvoker.invoke(ResourceMethodInvoker.java:475) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:397) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.model.ResourceMethodInvoker.apply(ResourceMethodInvoker.java:81) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.ServerRuntime$1.run(ServerRuntime.java:255) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:248) ~[org.glassfish.jersey.core-jersey-common-2.34.jar:?]\n        at org.glassfish.jersey.internal.Errors$1.call(Errors.java:244) ~[org.glassfish.jersey.core-jersey-common-2.34.jar:?]\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:292) ~[org.glassfish.jersey.core-jersey-common-2.34.jar:?]\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:274) ~[org.glassfish.jersey.core-jersey-common-2.34.jar:?]\n        at org.glassfish.jersey.internal.Errors.process(Errors.java:244) ~[org.glassfish.jersey.core-jersey-common-2.34.jar:?]\n        at org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:265) ~[org.glassfish.jersey.core-jersey-common-2.34.jar:?]\n        at org.glassfish.jersey.server.ServerRuntime.process(ServerRuntime.java:234) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.server.ApplicationHandler.handle(ApplicationHandler.java:680) ~[org.glassfish.jersey.core-jersey-server-2.34.jar:?]\n        at org.glassfish.jersey.servlet.WebComponent.serviceImpl(WebComponent.java:394) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.34.jar:?]\n        at org.glassfish.jersey.servlet.WebComponent.service(WebComponent.java:346) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.34.jar:?]\n        at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:366) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.34.jar:?]\n        at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:319) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.34.jar:?]\n        at org.glassfish.jersey.servlet.ServletContainer.service(ServletContainer.java:205) ~[org.glassfish.jersey.containers-jersey-container-servlet-core-2.34.jar:?]\n        at org.eclipse.jetty.servlet.ServletHolder.handle(ServletHolder.java:799) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.servlet.ServletHandler$ChainEnd.doFilter(ServletHandler.java:1656) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.apache.pulsar.broker.web.AuthenticationFilter.doFilter(AuthenticationFilter.java:73) ~[org.apache.pulsar-pulsar-broker-common-3.2.1.jar:3.2.1]\n        at org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.servlets.QoSFilter.doFilter(QoSFilter.java:202) ~[org.eclipse.jetty-jetty-servlets-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.servlet.FilterHolder.doFilter(FilterHolder.java:193) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.servlet.ServletHandler$Chain.doFilter(ServletHandler.java:1626) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.servlet.ServletHandler.doHandle(ServletHandler.java:552) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.session.SessionHandler.doHandle(SessionHandler.java:1624) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextHandle(ScopedHandler.java:233) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ContextHandler.doHandle(ContextHandler.java:1440) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:188) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.servlet.ServletHandler.doScope(ServletHandler.java:505) ~[org.eclipse.jetty-jetty-servlet-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.session.SessionHandler.doScope(SessionHandler.java:1594) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ScopedHandler.nextScope(ScopedHandler.java:186) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ContextHandler.doScope(ContextHandler.java:1355) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ScopedHandler.handle(ScopedHandler.java:141) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.ContextHandlerCollection.handle(ContextHandlerCollection.java:234) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.HandlerCollection.handle(HandlerCollection.java:146) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.StatisticsHandler.handle(StatisticsHandler.java:181) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.handler.HandlerWrapper.handle(HandlerWrapper.java:127) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.Server.handle(Server.java:516) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.HttpChannel.lambda$handle$1(HttpChannel.java:487) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.HttpChannel.dispatch(HttpChannel.java:732) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.HttpChannel.handle(HttpChannel.java:479) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.server.HttpConnection.onFillable(HttpConnection.java:277) ~[org.eclipse.jetty-jetty-server-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.io.AbstractConnection$ReadCallback.succeeded(AbstractConnection.java:311) ~[org.eclipse.jetty-jetty-io-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105) ~[org.eclipse.jetty-jetty-io-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.io.ssl.SslConnection$DecryptedEndPoint.onFillable(SslConnection.java:555) ~[org.eclipse.jetty-jetty-io-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.io.ssl.SslConnection.onFillable(SslConnection.java:410) ~[org.eclipse.jetty-jetty-io-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.io.ssl.SslConnection$2.succeeded(SslConnection.java:164) ~[org.eclipse.jetty-jetty-io-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.io.FillInterest.fillable(FillInterest.java:105) ~[org.eclipse.jetty-jetty-io-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.io.ChannelEndPoint$1.run(ChannelEndPoint.java:104) ~[org.eclipse.jetty-jetty-io-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.runTask(EatWhatYouKill.java:338) ~[org.eclipse.jetty-jetty-util-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.doProduce(EatWhatYouKill.java:315) ~[org.eclipse.jetty-jetty-util-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.tryProduce(EatWhatYouKill.java:173) ~[org.eclipse.jetty-jetty-util-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.util.thread.strategy.EatWhatYouKill.run(EatWhatYouKill.java:131) ~[org.eclipse.jetty-jetty-util-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at org.eclipse.jetty.util.thread.ReservedThreadExecutor$ReservedThread.run(ReservedThreadExecutor.java:409) ~[org.eclipse.jetty-jetty-util-9.4.54.v20240208.jar:9.4.54.v20240208]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136) ~[?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635) ~[?:?]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.104.Final.jar:4.1.104.Final]\n        at java.lang.Thread.run(Thread.java:840) ~[?:?]\nCaused by: javax.ws.rs.WebApplicationException: HTTP 307 Temporary Redirect\n        at org.apache.pulsar.broker.web.PulsarWebResource.lambda$validateBundleOwnershipAsync$17(PulsarWebResource.java:738) ~[org.apache.pulsar-pulsar-broker-3.2.1.jar:3.2.1]\n        at java.util.concurrent.CompletableFuture.uniAcceptNow(CompletableFuture.java:757) ~[?:?]\n        ... 81 more\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Do not log error, it is a normal way of handling a missing bundle.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Errors in log</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22409",
                "createdAt": "2024-04-03T06:24:54Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Support OIDC providers with JWK without alg field set in keys",
        "url": "https://github.com/apache/pulsar/pull/22421",
        "resourcePath": "/apache/pulsar/pull/22421",
        "createdAt": "2024-04-04T05:02:37Z",
        "number": 22421,
        "mergeCommit": {
          "oid": "a1970ae0996b2ccaad1251a8ef692faee24b83b8",
          "message": "[fix][broker] Support OIDC providers with JWK without alg field set in keys (#22421)",
          "commitUrl": "https://github.com/apache/pulsar/commit/a1970ae0996b2ccaad1251a8ef692faee24b83b8",
          "parents": {
            "nodes": [
              {
                "oid": "cd6f53baee7dbe0651e6581cb9bd3570017348c7",
                "message": "[fix][broker] Fix invalid condition in logging exceptions (#22412)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-auth-oidc/src/main/java/org/apache/pulsar/broker/authentication/oidc/AuthenticationProviderOpenID.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker-auth-oidc/src/test/java/org/apache/pulsar/broker/authentication/oidc/AuthenticationProviderOpenIDIntegrationTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5rpzzF2gAoYTQwMzc0MDZhZjI2YTY3ZmI0YzNlZTBmNmQ0Njk4MTY0ZDYwMjM2OA",
                "url": "https://github.com/apache/pulsar/pull/22421/commits/a4037406af26a67fb4c3ee0f6d4698164d602368"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22419,
                "url": "https://github.com/apache/pulsar/issues/22419",
                "title": "[Bug] OIDC - Optional alg field being required in Pulsar causes OIDC authentication to fail",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar v3.1.1</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Goal is to enable OIDC in a standalone Pulsar instance via Azure App Registrations.</p>\n<ol dir=\"auto\">\n<li>Create an App registration in Azure in preparation for OIDC</li>\n<li>Bind the necessary args to the standalone.conf file to enable OIDC following official instructions, including admin role binding</li>\n<li>Start instance</li>\n<li>Configure the pulsar admin/shell to use OAuth2 with a credential and make an admin call (ex: tenants list)</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">listed tenants</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">A 401/unauthorized on the client/shell side.<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/151540338/319300682-4b4b96fe-16d8-4890-a9f8-7b431f39d9d6.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzQxOTQsIm5iZiI6MTcxNDk3Mzg5NCwicGF0aCI6Ii8xNTE1NDAzMzgvMzE5MzAwNjgyLTRiNGI5NmZlLTE2ZDgtNDg5MC1hOWY4LTdiNDMxZjM5ZDlkNi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwNTA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDUwNlQwNTM4MTRaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT05YjJjZDFiMjZiODBlN2JmNjhjNmFiY2E0ODE5MTA0MGNiNjViODVkMzYxNzkzYTIxNDg4MWUwZTYwYmIxYTY5JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.Xx8xHLX7uBtqW3AgkGKIP1AZfBs14hVI3NVGbNmXSV8\"><img src=\"https://private-user-images.githubusercontent.com/151540338/319300682-4b4b96fe-16d8-4890-a9f8-7b431f39d9d6.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzQxOTQsIm5iZiI6MTcxNDk3Mzg5NCwicGF0aCI6Ii8xNTE1NDAzMzgvMzE5MzAwNjgyLTRiNGI5NmZlLTE2ZDgtNDg5MC1hOWY4LTdiNDMxZjM5ZDlkNi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwNTA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDUwNlQwNTM4MTRaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT05YjJjZDFiMjZiODBlN2JmNjhjNmFiY2E0ODE5MTA0MGNiNjViODVkMzYxNzkzYTIxNDg4MWUwZTYwYmIxYTY5JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.Xx8xHLX7uBtqW3AgkGKIP1AZfBs14hVI3NVGbNmXSV8\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">An error on the Pulsar broker/instance side: Failed to authenticate HTTP request: <code class=\"notranslate\">Failed to authenticate HTTP request: JWK's alg [null] does not match JWT's alg [RS256]</code></p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/151540338/319304133-da47e952-4e46-4a17-82df-ee52cd38e146.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzQxOTQsIm5iZiI6MTcxNDk3Mzg5NCwicGF0aCI6Ii8xNTE1NDAzMzgvMzE5MzA0MTMzLWRhNDdlOTUyLTRlNDYtNGExNy04MmRmLWVlNTJjZDM4ZTE0Ni5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwNTA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDUwNlQwNTM4MTRaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT03OTgwMjc0NzA3NzYzMzA2ZDg4YjgxMjgyMzk3NGVjOTQ4ODIwYTJhYmI3YmM0YTJhODlkZDMwMmQ4YTcxZGE0JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.fAOHstY0LLi2xsJT2dBwBPZwYpO1g8DjgYyZfNdDm7g\"><img src=\"https://private-user-images.githubusercontent.com/151540338/319304133-da47e952-4e46-4a17-82df-ee52cd38e146.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzQxOTQsIm5iZiI6MTcxNDk3Mzg5NCwicGF0aCI6Ii8xNTE1NDAzMzgvMzE5MzA0MTMzLWRhNDdlOTUyLTRlNDYtNGExNy04MmRmLWVlNTJjZDM4ZTE0Ni5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwNTA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDUwNlQwNTM4MTRaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT03OTgwMjc0NzA3NzYzMzA2ZDg4YjgxMjgyMzk3NGVjOTQ4ODIwYTJhYmI3YmM0YTJhODlkZDMwMmQ4YTcxZGE0JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.fAOHstY0LLi2xsJT2dBwBPZwYpO1g8DjgYyZfNdDm7g\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The 'alg' header is <a href=\"https://datatracker.ietf.org/doc/html/rfc7517#page-8\" rel=\"nofollow\">optional</a>, as per the JWK spec:<br>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/151540338/319296681-ead0f329-ea94-45b3-a0ef-f7fc8bb0ec10.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzQxOTQsIm5iZiI6MTcxNDk3Mzg5NCwicGF0aCI6Ii8xNTE1NDAzMzgvMzE5Mjk2NjgxLWVhZDBmMzI5LWVhOTQtNDViMy1hMGVmLWY3ZmM4YmIwZWMxMC5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwNTA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDUwNlQwNTM4MTRaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT02NmFjM2QwOGI1ZWM0YzExOTkxYzQwNGI1ODVhN2M5OTMyMDczOTQwOGMxNDllZGUyZjljNGQ2YjEyNDQxOWQyJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.BcofvSx7-6U-9rl1cApVvvlt7JvVXVuQ4X29qLsXWF8\"><img src=\"https://private-user-images.githubusercontent.com/151540338/319296681-ead0f329-ea94-45b3-a0ef-f7fc8bb0ec10.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzQxOTQsIm5iZiI6MTcxNDk3Mzg5NCwicGF0aCI6Ii8xNTE1NDAzMzgvMzE5Mjk2NjgxLWVhZDBmMzI5LWVhOTQtNDViMy1hMGVmLWY3ZmM4YmIwZWMxMC5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwNTA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDUwNlQwNTM4MTRaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT02NmFjM2QwOGI1ZWM0YzExOTkxYzQwNGI1ODVhN2M5OTMyMDczOTQwOGMxNDllZGUyZjljNGQ2YjEyNDQxOWQyJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.BcofvSx7-6U-9rl1cApVvvlt7JvVXVuQ4X29qLsXWF8\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\"><a href=\"https://github.com/awslabs/aws-jwt-verify/issues/6\" data-hovercard-type=\"issue\" data-hovercard-url=\"/awslabs/aws-jwt-verify/issues/6/hovercard\">Azure does not return this as field as part of the well known config</a>, but the Pulsar <a href=\"https://github.com/apache/pulsar/blob/cd6f53baee7dbe0651e6581cb9bd3570017348c7/pulsar-broker-auth-oidc/src/main/java/org/apache/pulsar/broker/authentication/oidc/AuthenticationProviderOpenID.java#L307\">OIDC implementation</a> requires this. This validation is failing and results in the error I saw in the Pulsar instance logs:</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/151540338/319297673-651e3bba-1e8f-4dfe-949d-bea06fb55a5c.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzQxOTQsIm5iZiI6MTcxNDk3Mzg5NCwicGF0aCI6Ii8xNTE1NDAzMzgvMzE5Mjk3NjczLTY1MWUzYmJhLTFlOGYtNGRmZS05NDlkLWJlYTA2ZmI1NWE1Yy5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwNTA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDUwNlQwNTM4MTRaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0wOTA4ODIwOTk4MGExMmFiMzdiM2Y1ZGNhMGIxYWZjNjYxMWU0YzFmZjY3NGE0Y2UwYzBmZTUzMDQzODI0ODQ5JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.DYMqh6SE1MbtBHYJwWShQci8WkfKQAab7hQrPyUkg9o\"><img src=\"https://private-user-images.githubusercontent.com/151540338/319297673-651e3bba-1e8f-4dfe-949d-bea06fb55a5c.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTQ5NzQxOTQsIm5iZiI6MTcxNDk3Mzg5NCwicGF0aCI6Ii8xNTE1NDAzMzgvMzE5Mjk3NjczLTY1MWUzYmJhLTFlOGYtNGRmZS05NDlkLWJlYTA2ZmI1NWE1Yy5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwNTA2JTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDUwNlQwNTM4MTRaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT0wOTA4ODIwOTk4MGExMmFiMzdiM2Y1ZGNhMGIxYWZjNjYxMWU0YzFmZjY3NGE0Y2UwYzBmZTUzMDQzODI0ODQ5JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.DYMqh6SE1MbtBHYJwWShQci8WkfKQAab7hQrPyUkg9o\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<p dir=\"auto\">It's also possible I've screwed up the OIDC configuration, but my suspicion above seems to make sense... I can share more of my config if needed.</p>\n<p dir=\"auto\">I'll be glad to do anything I can to help fix this; my guess is this behavior would prevent it from functioning with Azure (if the alg field is missing globally). Short of creating a custom OIDC implementation/authorizer myself, is there anything else I can do in the interim to get around this?</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22419",
                "createdAt": "2024-04-03T18:17:22Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[admin][broker] Fix force delete subscription not working",
        "url": "https://github.com/apache/pulsar/pull/22423",
        "resourcePath": "/apache/pulsar/pull/22423",
        "createdAt": "2024-04-04T07:18:33Z",
        "number": 22423,
        "mergeCommit": {
          "oid": "ba8e8f5e218f01d42f39bc7f62bfc0bcdff99085",
          "message": "[admin][broker] Fix force delete subscription not working (#22423)",
          "commitUrl": "https://github.com/apache/pulsar/commit/ba8e8f5e218f01d42f39bc7f62bfc0bcdff99085",
          "parents": {
            "nodes": [
              {
                "oid": "706b588860c93d2a8a5f54bd3db0d10c004699db",
                "message": "[cleanup][admin] Remove unused methods in PersistentTopicsBase (#22424)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/PersistentTopicsBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/PersistentTopicsTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5rqcQI2gAoMTJmMmYxZGVmNmIzZmJkMWNmZTI2MmViNjAyY2Q0YTIxNjU0NzMxNw",
                "url": "https://github.com/apache/pulsar/pull/22423/commits/12f2f1def6b3fbd1cfe262eb602cd4a216547317"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22404,
                "url": "https://github.com/apache/pulsar/issues/22404",
                "title": "[Bug] Force Delete subscription not working on persistent topics",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">OS: Ubuntu 23.10<br>\nDocker Pulsar standalone 3.1.2</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Using Java client suggesting that <code class=\"notranslate\">adminClient</code> is of type <code class=\"notranslate\">PulsarAdmin</code>:<br>\ninvoke <code class=\"notranslate\">adminClient.topics().deleteSubscription(*topicName*, *subName*, true)</code> which deletes the subscription forcefully on a persistent topic (on a non-persistent topic it works just fine) and on subscription (same for durable and non-durable) with some active consumers.<br>\nIt could be connected with <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"801084364\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/9477\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/pulsar/issues/9477/hovercard\" href=\"https://github.com/apache/pulsar/issues/9477\">#9477</a> also.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Expected to delete subscriptions with active consumers.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">I get an error:<br>\n<code class=\"notranslate\">org.apache.pulsar.client.admin.PulsarAdminException$PreconditionFailedException: Subscription has active connected consumers</code></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22404",
                "createdAt": "2024-04-02T18:39:41Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][admin] Tenant AdminRoles can not contains whitespace in the beginning or end.",
        "url": "https://github.com/apache/pulsar/pull/22450",
        "resourcePath": "/apache/pulsar/pull/22450",
        "createdAt": "2024-04-07T03:28:52Z",
        "number": 22450,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/admin/impl/TenantsBase.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/TenantTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5r7GAz2gAoYTcyZThhMmMyZDQ1NTY5M2IyYjQ2MWJiYTAwMjFhNjBiZmJhZjE5Ng",
                "url": "https://github.com/apache/pulsar/pull/22450/commits/a72e8a2c2d455693b2b461bba0021a60bfbaf196"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21710,
                "url": "https://github.com/apache/pulsar/issues/21710",
                "title": "[Bug] You are able to add a blank string as a tenant admin",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">At least 3.0.1.6. It looks to be on master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Create a tenant admin with a blank string</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">This fails to be accepted</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">You now have a blank tenant admin</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">See the <code class=\"notranslate\">createTenant</code> method, it does not seem to call validation to the string input in the rest api.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21710",
                "createdAt": "2023-12-11T22:31:12Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix consumer stops receiving messages when with large backlogs processing",
        "url": "https://github.com/apache/pulsar/pull/22454",
        "resourcePath": "/apache/pulsar/pull/22454",
        "createdAt": "2024-04-07T12:54:39Z",
        "number": 22454,
        "mergeCommit": {
          "oid": "57a616eaa79096af5b49db89c99cd39ccc94ec00",
          "message": "[fix][broker] Fix consumer stops receiving messages when with large backlogs processing (#22454)",
          "commitUrl": "https://github.com/apache/pulsar/commit/57a616eaa79096af5b49db89c99cd39ccc94ec00",
          "parents": {
            "nodes": [
              {
                "oid": "a51bbdd1480b453d72891b3d68b4afd068ec374a",
                "message": "[improve][broker] Deprecate unused enableNamespaceIsolationUpdateOnTime config (#22449)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedCursorImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentSubscription.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/persistent/PersistentTopicTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5r7xms2gAoZTUwMWZhNTgyODhkZWJiZjBjZmMyM2Y2OTQ2NmQ5YzUwODRlNjAzMg",
                "url": "https://github.com/apache/pulsar/pull/22454/commits/e501fa58288debbf0cfc23f69466d9c5084e6032"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22435,
                "url": "https://github.com/apache/pulsar/issues/22435",
                "title": "[Bug] Consumer Stops Receiving Messages with Large Backlogs Post-Processing",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">3.2.2</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Open consumer on a subscription using very large backlog by passing \"old\" MessageId.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Consume all messages and wait for upcoming messages when the backlog is consumed.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Note that the following paragraph mentions a <code class=\"notranslate\">NonDurable</code> consumer.</p>\n<p dir=\"auto\">Initially, everything functions correctly\u2014the process begins with a backlog of  (let's say) 100,000 messages, which gradually decreases to 0 as we approach the present (\"now\"). However, once the backlog is fully processed, the consumer unexpectedly stops receiving new messages, leading to an increase in the backlog again. The consumer is still connected. This behavior is consistently reproducible with my topics that have a substantial amount of data.<br>\nI've also noticed that when the starting point (since) is relatively close to the current time (now), this problem does not occur.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">We do not know if this bug was introduced by v3.2.2. We didn't see it before. We are currently rollbacking brokers to 3.2.1 to confirm this.</p>\n<p dir=\"auto\">Otherwise, it may be related to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2166890992\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/22191\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/22191/hovercard\" href=\"https://github.com/apache/pulsar/pull/22191\">#22191</a>.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22435",
                "createdAt": "2024-04-04T18:02:10Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][ml] Fix topic retention by size",
        "url": "https://github.com/apache/pulsar/pull/22472",
        "resourcePath": "/apache/pulsar/pull/22472",
        "createdAt": "2024-04-10T08:53:05Z",
        "number": 22472,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ManagedLedgerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5sOBae2gAoZTliNmE1NDc3OWM3YjI3ODY0MzNiNGExYzZmMDk1ZTdiNWFlM2VkYQ",
                "url": "https://github.com/apache/pulsar/pull/22472/commits/e9b6a54779c7b2786433b4a1c6f095e7b5ae3eda"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22473,
                "url": "https://github.com/apache/pulsar/issues/22473",
                "title": "[Bug] [ml] Incorrect behavior of Topic Retention Policy",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master branch</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    public void testRetentionInMB() throws Exception {\n        @Cleanup(&quot;shutdown&quot;)\n        ManagedLedgerFactory factory = new ManagedLedgerFactoryImpl(metadataStore, bkc);\n        ManagedLedgerConfig config = new ManagedLedgerConfig();\n        config.setRetentionSizeInMB(2);\n        config.setRetentionTime(-1, TimeUnit.SECONDS);\n        config.setMaxEntriesPerLedger(2);\n        config.setMinimumRolloverTime(0, TimeUnit.SECONDS);\n\n        @Cleanup\n        ManagedLedgerImpl ml = (ManagedLedgerImpl) factory.open(&quot;retention_test_ledger&quot;, config);\n        @Cleanup\n        ManagedCursor c1 = ml.openCursor(&quot;c1&quot;);\n\n        // 512K per entry, 2 entries per ledger, 1 ledger has 1MB data.\n        byte[] content = new byte[1024 * 512];\n        for (int i = 0; i &lt; 21; i++) {\n            ml.addEntry(content);\n        }\n\n        // should be 11 ledgers.\n        assertEquals(ml.ledgers.size(), (21 / 2) + 1);\n        long firstKey = ml.ledgers.firstKey();\n\n        // ack 5 ledgers.\n        c1.markDelete(new PositionImpl(firstKey + 5, 0));\n\n        // trigger trim ledgers manually\n        CompletableFuture&lt;Void&gt; f = new CompletableFuture&lt;&gt;();\n        ml.trimConsumedLedgersInBackground(false, f);\n        f.get();\n    }\"><pre class=\"notranslate\">    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-s1\">testRetentionInMB</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-s1\">Exception</span> {\n        <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Cleanup</span>(<span class=\"pl-s\">\"shutdown\"</span>)\n        <span class=\"pl-smi\">ManagedLedgerFactory</span> <span class=\"pl-s1\">factory</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ManagedLedgerFactoryImpl</span>(<span class=\"pl-s1\">metadataStore</span>, <span class=\"pl-s1\">bkc</span>);\n        <span class=\"pl-smi\">ManagedLedgerConfig</span> <span class=\"pl-s1\">config</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ManagedLedgerConfig</span>();\n        <span class=\"pl-s1\">config</span>.<span class=\"pl-en\">setRetentionSizeInMB</span>(<span class=\"pl-c1\">2</span>);\n        <span class=\"pl-s1\">config</span>.<span class=\"pl-en\">setRetentionTime</span>(-<span class=\"pl-c1\">1</span>, <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">SECONDS</span>);\n        <span class=\"pl-s1\">config</span>.<span class=\"pl-en\">setMaxEntriesPerLedger</span>(<span class=\"pl-c1\">2</span>);\n        <span class=\"pl-s1\">config</span>.<span class=\"pl-en\">setMinimumRolloverTime</span>(<span class=\"pl-c1\">0</span>, <span class=\"pl-smi\">TimeUnit</span>.<span class=\"pl-c1\">SECONDS</span>);\n\n        <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Cleanup</span>\n        <span class=\"pl-smi\">ManagedLedgerImpl</span> <span class=\"pl-s1\">ml</span> = (<span class=\"pl-smi\">ManagedLedgerImpl</span>) <span class=\"pl-s1\">factory</span>.<span class=\"pl-en\">open</span>(<span class=\"pl-s\">\"retention_test_ledger\"</span>, <span class=\"pl-s1\">config</span>);\n        <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Cleanup</span>\n        <span class=\"pl-smi\">ManagedCursor</span> <span class=\"pl-s1\">c1</span> = <span class=\"pl-s1\">ml</span>.<span class=\"pl-en\">openCursor</span>(<span class=\"pl-s\">\"c1\"</span>);\n\n        <span class=\"pl-c\">// 512K per entry, 2 entries per ledger, 1 ledger has 1MB data.</span>\n        <span class=\"pl-smi\">byte</span>[] <span class=\"pl-s1\">content</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">byte</span>[<span class=\"pl-c1\">1024</span> * <span class=\"pl-c1\">512</span>];\n        <span class=\"pl-k\">for</span> (<span class=\"pl-smi\">int</span> <span class=\"pl-s1\">i</span> = <span class=\"pl-c1\">0</span>; <span class=\"pl-s1\">i</span> &lt; <span class=\"pl-c1\">21</span>; <span class=\"pl-s1\">i</span>++) {\n            <span class=\"pl-s1\">ml</span>.<span class=\"pl-en\">addEntry</span>(<span class=\"pl-s1\">content</span>);\n        }\n\n        <span class=\"pl-c\">// should be 11 ledgers.</span>\n        <span class=\"pl-en\">assertEquals</span>(<span class=\"pl-s1\">ml</span>.<span class=\"pl-s1\">ledgers</span>.<span class=\"pl-en\">size</span>(), (<span class=\"pl-c1\">21</span> / <span class=\"pl-c1\">2</span>) + <span class=\"pl-c1\">1</span>);\n        <span class=\"pl-smi\">long</span> <span class=\"pl-s1\">firstKey</span> = <span class=\"pl-s1\">ml</span>.<span class=\"pl-s1\">ledgers</span>.<span class=\"pl-en\">firstKey</span>();\n\n        <span class=\"pl-c\">// ack 5 ledgers.</span>\n        <span class=\"pl-s1\">c1</span>.<span class=\"pl-en\">markDelete</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">PositionImpl</span>(<span class=\"pl-s1\">firstKey</span> + <span class=\"pl-c1\">5</span>, <span class=\"pl-c1\">0</span>));\n\n        <span class=\"pl-c\">// trigger trim ledgers manually</span>\n        <span class=\"pl-smi\">CompletableFuture</span>&lt;<span class=\"pl-smi\">Void</span>&gt; <span class=\"pl-s1\">f</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">CompletableFuture</span>&lt;&gt;();\n        <span class=\"pl-s1\">ml</span>.<span class=\"pl-en\">trimConsumedLedgersInBackground</span>(<span class=\"pl-c1\">false</span>, <span class=\"pl-s1\">f</span>);\n        <span class=\"pl-s1\">f</span>.<span class=\"pl-en\">get</span>();\n    }</pre></div>\n<ol dir=\"auto\">\n<li>For the test, we set the retention policy by size(2MB); 2 entries per ledger and each entry 512KB, each ledger is 1MB.</li>\n<li>Add 21 entries to the ManagedLedger, it will open 11 ledgers(I assume these ledger ID are <strong>[1, 11]</strong>).</li>\n<li>Set markDeletePosition to <strong>6:0</strong>, which means <strong>[1, 5]</strong> ledgers are consumed</li>\n<li>Trigger trim ledger task manually</li>\n<li>Wait until trim task finish</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Ledgers <strong>[1, 3]</strong> deleted.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Ledgers <strong>[1, 5]</strong> deleted</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22473",
                "createdAt": "2024-04-10T10:26:41Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][misc] Upgrade to Bookkeeper 4.16.5",
        "url": "https://github.com/apache/pulsar/pull/22484",
        "resourcePath": "/apache/pulsar/pull/22484",
        "createdAt": "2024-04-11T14:27:44Z",
        "number": 22484,
        "mergeCommit": {
          "oid": "4a5400f0c66dab2c3fbb0050c8f537952fef1951",
          "message": "[improve][misc] Upgrade to Bookkeeper 4.16.5 (#22484)",
          "commitUrl": "https://github.com/apache/pulsar/commit/4a5400f0c66dab2c3fbb0050c8f537952fef1951",
          "parents": {
            "nodes": [
              {
                "oid": "094742d5fa6f07b5ceed581876c45564fa0379bd",
                "message": "[fix][broker] Do not migrate internal topics during Blue-Green Migration when ExtensibleLoadBalancer is used (#22478)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "distribution/server/src/assemble/LICENSE.bin.txt"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "distribution/shell/src/assemble/LICENSE.bin.txt"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5sXjh62gAoMGYwZmNiMjJmMGI0MjFkOTNmYTNlMmE0ZDY2MTZiNTRhY2YwMTliZg",
                "url": "https://github.com/apache/pulsar/pull/22484/commits/0f0fcb22f0b421d93fa3e2a4d6616b54acf019bf"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21421,
                "url": "https://github.com/apache/pulsar/issues/21421",
                "title": "[Bug] Bookkeeper returns mac mismatch while reading",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">2.11.3 to 3.1.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">N/A</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">No error</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">After bumped I got a lot of exceptions as:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"2023-10-23T15:01:29,964+0000 [BookKeeperClientWorker-OrderedExecutor-7-0] INFO  org.apache.bookkeeper.client.PendingReadOp - Mac mismatch while reading L16702 E0 from bookie: yo-bookkeeper-c3-n3\n2023-10-23T15:01:29,965+0000 [BookKeeperClientWorker-OrderedExecutor-7-0] ERROR org.apache.bookkeeper.client.PendingReadOp - Read of ledger entry failed: L16702 E0-E0, Sent to [yo-bookkeeper-c3-n14, yo-bookkeeper-c3-n3, yo-bookkeeper-c3-n7], Heard from [yo-bookkeeper-c3-n14, yo-bookkeeper-c3-n3, yo-bookkeeper-c3-n7] : bitset = {0, 1, 2}, Error = 'Entry digest does not match'. First unread entry is (-1, rc = null)\n2023-10-23T15:01:29,966+0000 [main] ERROR org.apache.bookkeeper.client.BookKeeperAdmin - Error reading entry 0 from ledger 16702\norg.apache.bookkeeper.client.BKException$BKDigestMatchException: Entry digest does not match\n        at org.apache.bookkeeper.client.SyncCallbackUtils.finish(SyncCallbackUtils.java:83) ~[org.apache.bookkeeper-bookkeeper-server-4.16.2.jar:4.16.2]\n        at org.apache.bookkeeper.client.SyncCallbackUtils$SyncReadCallback.readComplete(SyncCallbackUtils.java:229) ~[org.apache.bookkeeper-bookkeeper-server-4.16.2.jar:4.16.2]\n        at org.apache.bookkeeper.client.LedgerHandle$4.onFailure(LedgerHandle.java:818) ~[org.apache.bookkeeper-bookkeeper-server-4.16.2.jar:4.16.2]\n        at org.apache.bookkeeper.common.concurrent.FutureEventListener.accept(FutureEventListener.java:38) ~[org.apache.bookkeeper-bookkeeper-common-4.16.2.jar:4.16.2]\n        at org.apache.bookkeeper.common.concurrent.FutureEventListener.accept(FutureEventListener.java:26) ~[org.apache.bookkeeper-bookkeeper-common-4.16.2.jar:4.16.2]\n        at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863) ~[?:?]\n        at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841) ~[?:?]\n        at java.util.concurrent.CompletableFuture$Completion.run(CompletableFuture.java:482) ~[?:?]\n        at org.apache.bookkeeper.common.util.SingleThreadExecutor.safeRunTask(SingleThreadExecutor.java:137) ~[org.apache.bookkeeper-bookkeeper-common-4.16.2.jar:4.16.2]\n        at org.apache.bookkeeper.common.util.SingleThreadExecutor.run(SingleThreadExecutor.java:107) ~[org.apache.bookkeeper-bookkeeper-common-4.16.2.jar:4.16.2]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.94.Final.jar:4.1.94.Final]\n        at java.lang.Thread.run(Thread.java:833) ~[?:?]\"><pre class=\"notranslate\"><code class=\"notranslate\">2023-10-23T15:01:29,964+0000 [BookKeeperClientWorker-OrderedExecutor-7-0] INFO  org.apache.bookkeeper.client.PendingReadOp - Mac mismatch while reading L16702 E0 from bookie: yo-bookkeeper-c3-n3\n2023-10-23T15:01:29,965+0000 [BookKeeperClientWorker-OrderedExecutor-7-0] ERROR org.apache.bookkeeper.client.PendingReadOp - Read of ledger entry failed: L16702 E0-E0, Sent to [yo-bookkeeper-c3-n14, yo-bookkeeper-c3-n3, yo-bookkeeper-c3-n7], Heard from [yo-bookkeeper-c3-n14, yo-bookkeeper-c3-n3, yo-bookkeeper-c3-n7] : bitset = {0, 1, 2}, Error = 'Entry digest does not match'. First unread entry is (-1, rc = null)\n2023-10-23T15:01:29,966+0000 [main] ERROR org.apache.bookkeeper.client.BookKeeperAdmin - Error reading entry 0 from ledger 16702\norg.apache.bookkeeper.client.BKException$BKDigestMatchException: Entry digest does not match\n        at org.apache.bookkeeper.client.SyncCallbackUtils.finish(SyncCallbackUtils.java:83) ~[org.apache.bookkeeper-bookkeeper-server-4.16.2.jar:4.16.2]\n        at org.apache.bookkeeper.client.SyncCallbackUtils$SyncReadCallback.readComplete(SyncCallbackUtils.java:229) ~[org.apache.bookkeeper-bookkeeper-server-4.16.2.jar:4.16.2]\n        at org.apache.bookkeeper.client.LedgerHandle$4.onFailure(LedgerHandle.java:818) ~[org.apache.bookkeeper-bookkeeper-server-4.16.2.jar:4.16.2]\n        at org.apache.bookkeeper.common.concurrent.FutureEventListener.accept(FutureEventListener.java:38) ~[org.apache.bookkeeper-bookkeeper-common-4.16.2.jar:4.16.2]\n        at org.apache.bookkeeper.common.concurrent.FutureEventListener.accept(FutureEventListener.java:26) ~[org.apache.bookkeeper-bookkeeper-common-4.16.2.jar:4.16.2]\n        at java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863) ~[?:?]\n        at java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841) ~[?:?]\n        at java.util.concurrent.CompletableFuture$Completion.run(CompletableFuture.java:482) ~[?:?]\n        at org.apache.bookkeeper.common.util.SingleThreadExecutor.safeRunTask(SingleThreadExecutor.java:137) ~[org.apache.bookkeeper-bookkeeper-common-4.16.2.jar:4.16.2]\n        at org.apache.bookkeeper.common.util.SingleThreadExecutor.run(SingleThreadExecutor.java:107) ~[org.apache.bookkeeper-bookkeeper-common-4.16.2.jar:4.16.2]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) ~[io.netty-netty-common-4.1.94.Final.jar:4.1.94.Final]\n        at java.lang.Thread.run(Thread.java:833) ~[?:?]\n</code></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"org.apache.pulsar.broker.service.schema.exceptions.SchemaException: Entry digest does not match -  ledger=103622248 - operation=Failed to read entry - entry=0\n        at org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.bkException(BookkeeperSchemaStorage.java:711)\n        at org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage$Functions.lambda$getLedgerEntry$0(BookkeeperSchemaStorage.java:655)\n        at org.apache.bookkeeper.client.LedgerHandle$4.onFailure(LedgerHandle.java:818)\n        at org.apache.bookkeeper.common.concurrent.FutureEventListener.accept(FutureEventListener.java:38)\n        at org.apache.bookkeeper.common.concurrent.FutureEventListener.accept(FutureEventListener.java:26)\n        at java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n        at java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n        at java.base/java.util.concurrent.CompletableFuture$Completion.run(CompletableFuture.java:482)\n        at org.apache.bookkeeper.common.util.SingleThreadExecutor.safeRunTask(SingleThreadExecutor.java:137)\n        at org.apache.bookkeeper.common.util.SingleThreadExecutor.run(SingleThreadExecutor.java:107)\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n        at java.base/java.lang.Thread.run(Thread.java:833)\"><pre class=\"notranslate\"><code class=\"notranslate\">org.apache.pulsar.broker.service.schema.exceptions.SchemaException: Entry digest does not match -  ledger=103622248 - operation=Failed to read entry - entry=0\n        at org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage.bkException(BookkeeperSchemaStorage.java:711)\n        at org.apache.pulsar.broker.service.schema.BookkeeperSchemaStorage$Functions.lambda$getLedgerEntry$0(BookkeeperSchemaStorage.java:655)\n        at org.apache.bookkeeper.client.LedgerHandle$4.onFailure(LedgerHandle.java:818)\n        at org.apache.bookkeeper.common.concurrent.FutureEventListener.accept(FutureEventListener.java:38)\n        at org.apache.bookkeeper.common.concurrent.FutureEventListener.accept(FutureEventListener.java:26)\n        at java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n        at java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n        at java.base/java.util.concurrent.CompletableFuture$Completion.run(CompletableFuture.java:482)\n        at org.apache.bookkeeper.common.util.SingleThreadExecutor.safeRunTask(SingleThreadExecutor.java:137)\n        at org.apache.bookkeeper.common.util.SingleThreadExecutor.run(SingleThreadExecutor.java:107)\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30)\n        at java.base/java.lang.Thread.run(Thread.java:833)\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21421",
                "createdAt": "2023-10-23T15:08:56Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] backlog quota exceed limit log replaced with `debug`",
        "url": "https://github.com/apache/pulsar/pull/22488",
        "resourcePath": "/apache/pulsar/pull/22488",
        "createdAt": "2024-04-12T07:49:53Z",
        "number": 22488,
        "mergeCommit": {
          "oid": "b85730069ee4c5f96406a075e354d0592fdab434",
          "message": "[improve][broker] backlog quota exceed limit log replaced with `debug` (#22488)",
          "commitUrl": "https://github.com/apache/pulsar/commit/b85730069ee4c5f96406a075e354d0592fdab434",
          "parents": {
            "nodes": [
              {
                "oid": "dbe1a4816c12535da2013ed5da5ee7796d8b4638",
                "message": "[improve][broker] Reduce the duplicated null check for LeaderElectionService (#22465)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5sckM72gAoZjVjYTJjMzgzM2IyMmVkNGU1NWJjOTNjMzA4NGIwYTcxZTVhMGE0Nw",
                "url": "https://github.com/apache/pulsar/pull/22488/commits/f5ca2c3833b22ed4e55bc93c3084b0a71e5a0a47"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22474,
                "url": "https://github.com/apache/pulsar/issues/22474",
                "title": "backlog quota exceed limit generates lot of logs within short period of time",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Currently, when backlog quota limit exceeded and producers still send message, it generates lot of logs in short period of time. The log is logged with info. We can use debug instead of info.</p>\n<p dir=\"auto\">Code Reference:</p>\n<ol dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/blob/4d8a1d8bc6a2d88d0fa82f390ae57bf4c5541d54/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java#L2941\">PersistentTopic.java#L2941</a></li>\n<li><a href=\"https://github.com/apache/pulsar/blob/4d8a1d8bc6a2d88d0fa82f390ae57bf4c5541d54/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java#L2948\">PersistentTopic.java#L2948</a></li>\n</ol>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">We can use debug instead of info.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22474",
                "createdAt": "2024-04-10T10:28:36Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Optimize /metrics, fix unbounded request queue issue and fix race conditions in metricsBufferResponse mode",
        "url": "https://github.com/apache/pulsar/pull/22494",
        "resourcePath": "/apache/pulsar/pull/22494",
        "createdAt": "2024-04-12T15:18:23Z",
        "number": 22494,
        "mergeCommit": {
          "oid": "7009071b6d53bbc3d740ea99cdc0c010692679ab",
          "message": "[fix][broker] Optimize /metrics, fix unbounded request queue issue and fix race conditions in metricsBufferResponse mode (#22494)",
          "commitUrl": "https://github.com/apache/pulsar/commit/7009071b6d53bbc3d740ea99cdc0c010692679ab",
          "parents": {
            "nodes": [
              {
                "oid": "51ecd0235ce5d5ad03c563a3338b29c6a117d216",
                "message": "[cleanup][broker] Remove unused NamespaceBundleFactory parameter when creating OwnershipCache (#22482)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/stats/SubscriptionStatsTest.java"
              }
            },
            {
              "node": {
                "changeType": "DELETED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/stats/TimeWindowTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/stats/TransactionMetricsTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/transaction/buffer/TransactionBufferClientTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/transaction/pendingack/PendingAckPersistentTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/web/WebServiceTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/SimpleTextOutputStream.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyConfiguration.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyServiceStarter.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5sgPU62gAoYjk5ZmQyODJmMTk1Nzg1NmYzMzkxYjIyNjhiMDIzM2Q4NGIwZmMwYw",
                "url": "https://github.com/apache/pulsar/pull/22494/commits/b99fd282f1957856f3391b2268b0233d84b0fc0c"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22477,
                "url": "https://github.com/apache/pulsar/issues/22477",
                "title": "[Bug] /metrics endpoint processes requests one-by-one and seems to queue up waiting requests infinitely, ignoring the request timeout",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Applies to at least 3.0.x and 3.2.x versions of the Broker.</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">TBD. I believe this could be done with a http performance testing tool such as k6 or wrk2. Will follow up later. This might also require a large amount of topics so that the metrics size is significant.</p>\n<p dir=\"auto\">This problem reproduces also with the <code class=\"notranslate\">metricsBufferResponse=true</code> setting which is expected to cache the results and allow concurrent requests.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Calling the /metrics endpoint should be possible concurrently and should generate the metrics results once and share it across the concurrent requests. The expiration of the cached result should be configurable.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">requests queue up until there there's a failure about reaching the connection limit<br>\n<code class=\"notranslate\">INFO org.eclipse.jetty.server.ConnectionLimit - Connection Limit(2048) reached for [ServerConnector@.........{HTTP/1.1, (http/1.1)}{0.0.0.0:8080}]</code></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The problem is partially mitigated by enabling Gzip compression with <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2024250380\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/21667\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/21667/hovercard\" href=\"https://github.com/apache/pulsar/pull/21667\">#21667</a>, however it doesn't address the root cause.<br>\nThere has been a previous attempt to address performance problems in the <code class=\"notranslate\">/metrics</code> endpoint with <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1149201219\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/14453\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/14453/hovercard\" href=\"https://github.com/apache/pulsar/pull/14453\">#14453</a>.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22477",
                "createdAt": "2024-04-10T17:16:32Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] SchemaMap in AutoConsumeSchema has been reused",
        "url": "https://github.com/apache/pulsar/pull/22500",
        "resourcePath": "/apache/pulsar/pull/22500",
        "createdAt": "2024-04-14T15:38:31Z",
        "number": 22500,
        "mergeCommit": {
          "oid": "ffdfc0c4e0881c682132e79c3cbf9768b1ab4f89",
          "message": "[fix][test] SchemaMap in AutoConsumeSchema has been reused (#22500)",
          "commitUrl": "https://github.com/apache/pulsar/commit/ffdfc0c4e0881c682132e79c3cbf9768b1ab4f89",
          "parents": {
            "nodes": [
              {
                "oid": "70b401b1de9df685283140cff1f83252abc27045",
                "message": "[improve][fn] Expose `RuntimeFlags` as CLI option for Pulsar Functions and Connectors (#22514)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5smZjC2gAoOTgyZDk0ZDE1NDY1ZmY1ZmNlYTE5MmU5YThiNmIyNWQyZDFjNTViNg",
                "url": "https://github.com/apache/pulsar/pull/22500/commits/982d94d15465ff5fcea192e9a8b6b25d2d1c55b6"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22470,
                "url": "https://github.com/apache/pulsar/issues/22470",
                "title": "[Bug] [branch-3.0] The test SimpleProducerConsumerTest.testAccessAvroSchemaMetadata always fails",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Branch-3.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Run the test <code class=\"notranslate\">SimpleProducerConsumerTest.testAccessAvroSchemaMetadata</code></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">It should pass.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">It always fails.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22470",
                "createdAt": "2024-04-10T07:42:24Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Add topic name to emitted error messages.",
        "url": "https://github.com/apache/pulsar/pull/22506",
        "resourcePath": "/apache/pulsar/pull/22506",
        "createdAt": "2024-04-15T09:12:49Z",
        "number": 22506,
        "mergeCommit": {
          "oid": "d5b36da9a2e0d4f17bea8e033180e494e93dc442",
          "message": "[improve][broker] Add topic name to emitted error messages. (#22506)",
          "commitUrl": "https://github.com/apache/pulsar/commit/d5b36da9a2e0d4f17bea8e033180e494e93dc442",
          "parents": {
            "nodes": [
              {
                "oid": "4ca4e2855267e3b36ee1a27f7144b89ba9194821",
                "message": "[improve] Make the config `metricsBufferResponse` description more effective (#22490)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApi2Test.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5spagX2gAoNjIwYmRhYjhhNWRkMGRlMDk4YjdiZjE2YTU0ODkwZWE0NWRhMDdlOQ",
                "url": "https://github.com/apache/pulsar/pull/22506/commits/620bdab8a5dd0de098b7bf16a54890ea45da07e9"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22505,
                "url": "https://github.com/apache/pulsar/issues/22505",
                "title": "Add topic name to emitted error messages",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">The error messages the server emits in <a href=\"https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java\">https://github.com/apache/pulsar/blob/master/pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java</a> do not contain the topic name.</p>\n<p dir=\"auto\">Both the Java client and the .NET client simply use these error messages without adding any additional context, making it harder to understand what is going on as the end-user.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Adding the topic to the error messages would aid in debugging issues as a end-user:</p>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Current</th>\n<th>Proposed</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td>Producer with name 'Test' is already connected to topic</td>\n<td>Producer with name 'Test' is already connected to topic 'SomeTopic'</td>\n</tr>\n<tr>\n<td>Topic reached max same address producers limit</td>\n<td>Topic 'SomeTopic' reached max same address producers limit</td>\n</tr>\n<tr>\n<td>Topic reached max producers limit</td>\n<td>Topic 'SomeTopic' reached max producers limit</td>\n</tr>\n</tbody>\n</table>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\">Alternatively the clients should refrain from simply forwarding the error messages but add the additional context instead. In this case, it becomes up to each client on how to phrase the errors and may provide a less uniform experience across Pulsar clients.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22505",
                "createdAt": "2024-04-15T07:47:19Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][cli]Support for pulsar-shell persistent modes",
        "url": "https://github.com/apache/pulsar/pull/22522",
        "resourcePath": "/apache/pulsar/pull/22522",
        "createdAt": "2024-04-17T09:15:03Z",
        "number": 22522,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-tools/src/main/java/org/apache/pulsar/shell/PulsarShell.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5s5YdF2gAoNmNmM2Y3NzcxOWZlZDhiMzM5ZGU5YTFmYWJjNzE2MGQ4Yzk1ZWZjOQ",
                "url": "https://github.com/apache/pulsar/pull/22522/commits/6cf3f77719fed8b339de9a1fabc7160d8c95efc9"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21194,
                "url": "https://github.com/apache/pulsar/issues/21194",
                "title": "pulsar-shell persistent modes",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Using pulsar-shell interactively, it's kind of a pain to prefix everything with<code class=\"notranslate\">admin</code>. I think it would be nice if the command accepted <code class=\"notranslate\">admin</code> and <code class=\"notranslate\">client</code> on their own as special commands that put the command into that mode with an implicit prefix.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Allow <code class=\"notranslate\">admin</code> and <code class=\"notranslate\">client</code>, when passed on their own to enter into admin or client mode respectively, with the addition of one more command <code class=\"notranslate\">exitmode</code> to return to the base state. These modes would not persist between sessions.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"configname(hostname)&gt; admin\nconfigname(hostname) admin&gt; help\nUsage: pulsar-admin [options] [command] [command options]\n  Options:\n    --admin-url\n      Admin Service URL to which to connect.\n      Default: https://pulsar.eks.intel.cs.sys:443\n&lt;SNIP&gt;\n    namespaces      Operations about namespaces\n      Usage: namespaces [options]\n\nconfigname(hostname) admin&gt; exitmode\nconfigname(hostname)&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">configname(hostname)&gt; admin\nconfigname(hostname) admin&gt; help\nUsage: pulsar-admin [options] [command] [command options]\n  Options:\n    --admin-url\n      Admin Service URL to which to connect.\n      Default: https://pulsar.eks.intel.cs.sys:443\n&lt;SNIP&gt;\n    namespaces      Operations about namespaces\n      Usage: namespaces [options]\n\nconfigname(hostname) admin&gt; exitmode\nconfigname(hostname)&gt;\n</code></pre></div>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21194",
                "createdAt": "2023-09-16T21:35:44Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    },
                    {
                      "node": {
                        "name": "help wanted"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][fn]Support for pulsar.service.url in the Local Run Mode for Debezium IO connectors",
        "url": "https://github.com/apache/pulsar/pull/22523",
        "resourcePath": "/apache/pulsar/pull/22523",
        "createdAt": "2024-04-17T10:54:16Z",
        "number": 22523,
        "mergeCommit": null,
        "potentialMergeCommit": {
          "oid": "91b9d0f348c75bb1ed9d775edab22a1f5b135af0",
          "message": "Merge c5082ed0c19295b41e7424166bcec5dca292ab9d into eee3694f00e269eef0f75d791521d0d35d8ff411",
          "commitUrl": "https://github.com/apache/pulsar/commit/91b9d0f348c75bb1ed9d775edab22a1f5b135af0",
          "parents": {
            "nodes": [
              {
                "oid": "eee3694f00e269eef0f75d791521d0d35d8ff411",
                "message": "[fix][storage] ReadonlyManagedLedger initialization does not fill in the properties (#22630)"
              },
              {
                "oid": "c5082ed0c19295b41e7424166bcec5dca292ab9d",
                "message": "refactoring added spaces where required"
              }
            ]
          }
        },
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-functions/localrun/src/main/java/org/apache/pulsar/functions/LocalRunner.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5s6EoL2gAoYzUwODJlZDBjMTkyOTViNDFlNzQyNDE2NmJjZWM1ZGNhMjkyYWI5ZA",
                "url": "https://github.com/apache/pulsar/pull/22523/commits/c5082ed0c19295b41e7424166bcec5dca292ab9d"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21276,
                "url": "https://github.com/apache/pulsar/issues/21276",
                "title": "[Bug] Cannot use non-default value for pulsar.service url ",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Pulsar 3.1</p>\n<p dir=\"auto\">Tested in both MacOS and Docker-compose</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Follow the steps in<br>\n<a href=\"https://pulsar.apache.org/docs/3.1.x/io-cdc-debezium/#configuration-2\" rel=\"nofollow\">https://pulsar.apache.org/docs/3.1.x/io-cdc-debezium/#configuration-2</a></p>\n<p dir=\"auto\">but change pulsar.service.url to something else, e.g. <code class=\"notranslate\">pulsar://pulsar-server:6650</code> for docker-compose</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Its is always \"pulsar://localhost:6650\" no matter what I change the config to\u2026</p>\n<p dir=\"auto\">I can see logs:<br>\n2023-09-28T16:31:36,502-0700 [pulsar-client-io-1-3] INFO  org.apache.pulsar.client.impl.ConsumerStatsRecorderImpl - Pulsar client config: {\"serviceUrl\":\"pulsar://localhost:6650\",\"authPluginClassName\":null,\"authParams\":null,\"authParamMap\":null,\"operationTimeoutMs\":30000,\"lookupTimeoutMs\":30000,\"statsIntervalSeconds\":60,\"numIoThreads\":8,\"numListenerThreads\":8,\"<br>\nand<br>\n2023-09-28 16:33:46 2023-09-28T23:33:46,136+0000 [pulsar-client-io-1-2] WARN  org.apache.pulsar.client.impl.ConnectionPool - Failed to open connection to localhost/:6650 : io.netty.channel.AbstractChannel$AnnotatedConnectException: Connection refused: localhost/127.0.0.1:6650<br>\nI need to change the url to something else so that I can work in docker-compose or production.</p>\n<p dir=\"auto\">Thanks!</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">I had to use <code class=\"notranslate\">network_mode: host</code> for now as workaround in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1918374289\" data-permission-text=\"Title is private\" data-url=\"https://github.com/xcherryio/xcherry/issues/25\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/xcherryio/xcherry/pull/25/hovercard\" href=\"https://github.com/xcherryio/xcherry/pull/25\">xcherryio/xcherry#25</a></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21276",
                "createdAt": "2023-09-29T01:04:35Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Support X-Forwarded-For and HA Proxy Protocol for resolving original client IP of http/https requests",
        "url": "https://github.com/apache/pulsar/pull/22524",
        "resourcePath": "/apache/pulsar/pull/22524",
        "createdAt": "2024-04-17T13:49:40Z",
        "number": 22524,
        "mergeCommit": {
          "oid": "4a887217d835629cafb393ddf331441b484d4e2c",
          "message": "[improve][broker] Support X-Forwarded-For and HA Proxy Protocol for resolving original client IP of http/https requests (#22524)",
          "commitUrl": "https://github.com/apache/pulsar/commit/4a887217d835629cafb393ddf331441b484d4e2c",
          "parents": {
            "nodes": [
              {
                "oid": "21647a1fc69ff46e65b6eaa37dd6d435e9f8eaef",
                "message": "[fix] Bump golang.org/x/net from 0.17.0 to 0.23.0 in /pulsar-function-go (#22540)\n\nSigned-off-by: dependabot[bot] <support@github.com>\r\nCo-authored-by: dependabot[bot] <49699333+dependabot[bot]@users.noreply.github.com>\r\nCo-authored-by: Matteo Merli <mmerli@apache.org>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyConfiguration.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/ProxyServiceStarter.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/main/java/org/apache/pulsar/proxy/server/WebServer.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyOriginalClientIPTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyServiceStarterDisableZeroCopyTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyServiceStarterTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-proxy/src/test/java/org/apache/pulsar/proxy/server/ProxyServiceTlsStarterTest.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-proxy/src/test/resources/log4j2.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/main/java/org/apache/pulsar/websocket/service/ProxyServer.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-websocket/src/main/java/org/apache/pulsar/websocket/service/WebSocketProxyConfiguration.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5s7Sh-2gAoZDE1YjBiNWQ1ZDczZTFkZWQ2N2UwMTJhYThkZDYwNjU2M2U4M2UzNQ",
                "url": "https://github.com/apache/pulsar/pull/22524/commits/d15b0b5d5d73e1ded67e012aa8dd606563e83e35"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22512,
                "url": "https://github.com/apache/pulsar/issues/22512",
                "title": "[improve] Parse the XFF header to get real client IP when behind reverse proxy",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">When a broker or proxy is deployed behind a reverse proxy, the origin IP of requests will always be IP of the proxy, Therefore the XFF(X-Forwarded-For) request header is often used to preserve the real client IPs, its a de-facto standard. However, the broker and proxy do not currently handle this.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">Configure <a href=\"https://eclipse.dev/jetty/javadoc/jetty-12/org/eclipse/jetty/server/ForwardedRequestCustomizer.html\" rel=\"nofollow\">ForwardedRequestCustomizer</a> for jetty <a href=\"https://github.com/apache/pulsar/blob/20915d1c438783c05778d98a3b77ec485b79d79d/pulsar-broker/src/main/java/org/apache/pulsar/broker/web/WebService.java#L105\">httpConfiguration</a> to handle these headers and support this feature.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22512",
                "createdAt": "2024-04-15T16:47:35Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix broken topic policy implementation compatibility with old pulsar version",
        "url": "https://github.com/apache/pulsar/pull/22535",
        "resourcePath": "/apache/pulsar/pull/22535",
        "createdAt": "2024-04-18T18:36:35Z",
        "number": 22535,
        "mergeCommit": {
          "oid": "59daac64c210f539e733f883edad09d08333aa62",
          "message": "[fix][broker] Fix broken topic policy implementation compatibility with old pulsar version (#22535)",
          "commitUrl": "https://github.com/apache/pulsar/commit/59daac64c210f539e733f883edad09d08333aa62",
          "parents": {
            "nodes": [
              {
                "oid": "fbf4cb71a3f3ed08786205dc5e60b810f3d62605",
                "message": "[improve][offload] Apply autoSkipNonRecoverableData configuration to tiered storage (#22531)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/AbstractTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerInternalClientConfigurationOverrideTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5tFXZy2gAoMzU4YmZmNDM2ZWRiMGQ2MzYwOWExOGZjMTBkMmIzZGE4M2JiNGIyOA",
                "url": "https://github.com/apache/pulsar/pull/22535/commits/358bff436edb0d63609a18fc10d2b3da83bb4b28"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22534,
                "url": "https://github.com/apache/pulsar/issues/22534",
                "title": "[Bug] Broker is not blocking the dispatch even after reaching max unack-message limit per subscription",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">After upgrading from Pulsar-2.7 to &gt;= Pulsar-2.10 broker, broker is not considering various broker configuration threshold and one of them is <code class=\"notranslate\">maxUnackedMessagesPerSubscription</code>. We have broker configured with <code class=\"notranslate\">MaxUnackedMessagesPerSubscription=200000</code> and after sub reaches 200K unack messages, broker blocks the dispatching. It was working fine till broker-2.7 but it stopped working after upgrading to Pulsar-2.10 and higher version.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"subscriptions&quot; : {\n    &quot;UnackMsgConsumersSubscription&quot; : {\n      &quot;msgRateOut&quot; : 41.66667806597534,\n      &quot;msgThroughputOut&quot; : 63924.01748854578,\n      &quot;bytesOutCounter&quot; : 9813637567183,\n      &quot;msgOutCounter&quot; : 6346168888,\n      &quot;msgRateRedeliver&quot; : 1825.0005374626583,\n      &quot;chuckedMessageRate&quot; : 0,\n      &quot;msgBacklog&quot; : 63122123,\n      &quot;backlogSize&quot; : 0,\n      &quot;msgBacklogNoDelayed&quot; : 63122123,\n      &quot;blockedSubscriptionOnUnackedMsgs&quot; : false,\n      &quot;msgDelayed&quot; : 0,\n      &quot;unackedMessages&quot; : 614260,\n      &quot;type&quot; : &quot;Shared&quot;,\n      &quot;msgRateExpired&quot; : 0.0,\n      &quot;totalMsgExpired&quot; : 0,\n      &quot;lastExpireTimestamp&quot; : 0,\n      &quot;lastConsumedFlowTimestamp&quot; : 1712610077925,\n      &quot;lastConsumedTimestamp&quot; : 1712610077938,\n      &quot;lastAckedTimestamp&quot; : 1712610088862,\n      &quot;lastMarkDeleteAdvancedTimestamp&quot; : 1712609791878,\n      &quot;consumers&quot; : [ {\n        &quot;msgRateOut&quot; : 41.66667806597534,\n        &quot;msgThroughputOut&quot; : 63924.01748854578,\n        &quot;bytesOutCounter&quot; : 5106838658,\n        &quot;msgOutCounter&quot; : 3324500,\n        &quot;msgRateRedeliver&quot; : 1825.0005374626583,\n        &quot;chuckedMessageRate&quot; : 0.0,\n        &quot;consumerName&quot; : &quot;0f455&quot;,\n        &quot;availablePermits&quot; : 0,\n        &quot;unackedMessages&quot; : 614260,\n        &quot;avgMessagesPerEntry&quot; : 1,\n        &quot;blockedConsumerOnUnackedMsgs&quot; : false,\n        &quot;lastAckedTimestamp&quot; : 1712610088862,\n        &quot;lastConsumedTimestamp&quot; : 1712610077938,\n        &quot;metadata&quot; : { },\n        &quot;connectedSince&quot; : &quot;2024-04-08T20:52:27.525995Z&quot;,\"><pre class=\"notranslate\"><code class=\"notranslate\">subscriptions\" : {\n    \"UnackMsgConsumersSubscription\" : {\n      \"msgRateOut\" : 41.66667806597534,\n      \"msgThroughputOut\" : 63924.01748854578,\n      \"bytesOutCounter\" : 9813637567183,\n      \"msgOutCounter\" : 6346168888,\n      \"msgRateRedeliver\" : 1825.0005374626583,\n      \"chuckedMessageRate\" : 0,\n      \"msgBacklog\" : 63122123,\n      \"backlogSize\" : 0,\n      \"msgBacklogNoDelayed\" : 63122123,\n      \"blockedSubscriptionOnUnackedMsgs\" : false,\n      \"msgDelayed\" : 0,\n      \"unackedMessages\" : 614260,\n      \"type\" : \"Shared\",\n      \"msgRateExpired\" : 0.0,\n      \"totalMsgExpired\" : 0,\n      \"lastExpireTimestamp\" : 0,\n      \"lastConsumedFlowTimestamp\" : 1712610077925,\n      \"lastConsumedTimestamp\" : 1712610077938,\n      \"lastAckedTimestamp\" : 1712610088862,\n      \"lastMarkDeleteAdvancedTimestamp\" : 1712609791878,\n      \"consumers\" : [ {\n        \"msgRateOut\" : 41.66667806597534,\n        \"msgThroughputOut\" : 63924.01748854578,\n        \"bytesOutCounter\" : 5106838658,\n        \"msgOutCounter\" : 3324500,\n        \"msgRateRedeliver\" : 1825.0005374626583,\n        \"chuckedMessageRate\" : 0.0,\n        \"consumerName\" : \"0f455\",\n        \"availablePermits\" : 0,\n        \"unackedMessages\" : 614260,\n        \"avgMessagesPerEntry\" : 1,\n        \"blockedConsumerOnUnackedMsgs\" : false,\n        \"lastAckedTimestamp\" : 1712610088862,\n        \"lastConsumedTimestamp\" : 1712610077938,\n        \"metadata\" : { },\n        \"connectedSince\" : \"2024-04-08T20:52:27.525995Z\",\n</code></pre></div>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Create namespace and topics with version &lt;= Pulsar-2.7</li>\n<li>Upgrade broker 2.10 and configure <code class=\"notranslate\">maxUnackedMessagesPerSubscription=200000</code></li>\n<li>Create sub with unack messages more than 200K and broker will still not block the dispatching</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Broker should follow max threshold for various resources</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Broker is not following max threshold for various resources</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22534",
                "createdAt": "2024-04-18T18:22:08Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][client] Add maxConnectionsPerHost and connectionMaxIdleSeconds to PulsarAdminBuilder",
        "url": "https://github.com/apache/pulsar/pull/22541",
        "resourcePath": "/apache/pulsar/pull/22541",
        "createdAt": "2024-04-19T13:17:19Z",
        "number": 22541,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin-api/src/main/java/org/apache/pulsar/client/admin/PulsarAdminBuilder.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/PulsarAdminBuilderImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/PulsarAdminImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/http/AsyncHttpConnector.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/http/AsyncHttpConnectorProvider.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-admin/src/test/java/org/apache/pulsar/client/admin/internal/PulsarAdminBuilderImplTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client-api/src/main/java/org/apache/pulsar/client/api/ClientBuilder.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConnectionPool.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/conf/ClientConfigurationData.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5tLCAb2gAoZWFkYTA3YTNhZDczZjY2NDFkNzMxMjAyNjEzZWZkMjNhMTQyZWJiMA",
                "url": "https://github.com/apache/pulsar/pull/22541/commits/eada07a3ad73f6641d731202613efd23a142ebb0"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22041,
                "url": "https://github.com/apache/pulsar/issues/22041",
                "title": "Set limits for number of opened HTTP connections for Pulsar Admin client",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">The Pulsar Admin client uses connection pooling (keep alive) without limiting the number of connections.<br>\nWhen HTTP calls get queued up on the brokers for some reason, the client will keep on opening more connections.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">The AsyncHttpClient used in pulsar-admin-client should be configured to limit the number of connections.<br>\nThis could happen somewhere here:<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/e3debb9ad867cb9b977e8bb1b21aab66387b3c5d/pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/http/AsyncHttpConnector.java#L99-L108\">pulsar/pulsar-client-admin/src/main/java/org/apache/pulsar/client/admin/internal/http/AsyncHttpConnector.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 99 to 108\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/e3debb9ad867cb9b977e8bb1b21aab66387b3c5d\">e3debb9</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L99\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"99\"></td>\n          <td id=\"LC99\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-smi\">DefaultAsyncHttpClientConfig</span>.<span class=\"pl-smi\">Builder</span> <span class=\"pl-s1\">confBuilder</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">DefaultAsyncHttpClientConfig</span>.<span class=\"pl-smi\">Builder</span>(); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L100\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"100\"></td>\n          <td id=\"LC100\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">confBuilder</span>.<span class=\"pl-en\">setUseProxyProperties</span>(<span class=\"pl-c1\">true</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L101\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"101\"></td>\n          <td id=\"LC101\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">confBuilder</span>.<span class=\"pl-en\">setFollowRedirect</span>(<span class=\"pl-c1\">true</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L102\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"102\"></td>\n          <td id=\"LC102\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">confBuilder</span>.<span class=\"pl-en\">setRequestTimeout</span>(<span class=\"pl-s1\">conf</span>.<span class=\"pl-en\">getRequestTimeoutMs</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L103\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"103\"></td>\n          <td id=\"LC103\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">confBuilder</span>.<span class=\"pl-en\">setConnectTimeout</span>(<span class=\"pl-s1\">connectTimeoutMs</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L104\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"104\"></td>\n          <td id=\"LC104\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">confBuilder</span>.<span class=\"pl-en\">setReadTimeout</span>(<span class=\"pl-s1\">readTimeoutMs</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L105\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"105\"></td>\n          <td id=\"LC105\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">confBuilder</span>.<span class=\"pl-en\">setUserAgent</span>(<span class=\"pl-smi\">String</span>.<span class=\"pl-en\">format</span>(<span class=\"pl-s\">\"Pulsar-Java-v%s\"</span>, <span class=\"pl-smi\">PulsarVersion</span>.<span class=\"pl-en\">getVersion</span>())); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L106\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"106\"></td>\n          <td id=\"LC106\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">confBuilder</span>.<span class=\"pl-en\">setRequestTimeout</span>(<span class=\"pl-s1\">requestTimeoutMs</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L107\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"107\"></td>\n          <td id=\"LC107\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">confBuilder</span>.<span class=\"pl-en\">setIoThreadsCount</span>(<span class=\"pl-s1\">conf</span>.<span class=\"pl-en\">getNumIoThreads</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L108\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"108\"></td>\n          <td id=\"LC108\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">confBuilder</span>.<span class=\"pl-en\">setKeepAliveStrategy</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">DefaultKeepAliveStrategy</span>() { </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\n<code class=\"notranslate\">setMaxConnections</code> and <code class=\"notranslate\">setMaxConnectionsPerHost</code> would have to be configured.<br>\nIn addition, it would be useful to use <code class=\"notranslate\">setPooledConnectionIdleTimeout</code> to set the timeout to 25 seconds so that pooled connections don't exceed timeouts in typical firewall configurations. The default of 60 seconds conflicts with many firewall idle connection defaults.<p></p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22041",
                "createdAt": "2024-02-08T13:16:29Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][offload] Increase file upload limit from 2048MiB to 4096MiB for GCP/GCS offloading",
        "url": "https://github.com/apache/pulsar/pull/22554",
        "resourcePath": "/apache/pulsar/pull/22554",
        "createdAt": "2024-04-22T13:21:49Z",
        "number": 22554,
        "mergeCommit": {
          "oid": "e81f37000ec212676c5daffa17faad8fc604ff77",
          "message": "[fix][offload] Increase file upload limit from 2048MiB to 4096MiB for GCP/GCS offloading (#22554)",
          "commitUrl": "https://github.com/apache/pulsar/commit/e81f37000ec212676c5daffa17faad8fc604ff77",
          "parents": {
            "nodes": [
              {
                "oid": "3a0f908e80d0863920a1258362fd782e95fe8f17",
                "message": "[improve][test] Add topic policy test for topic API (#22546)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "conf/broker.conf"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/policies/data/OffloadPoliciesImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5tWbdH2gAoNTljZmE0YjZiMDY1ZGY0Nzc4OTg2ZmU1N2VmYTFhZWNlZWM0MDM1Yg",
                "url": "https://github.com/apache/pulsar/pull/22554/commits/59cfa4b6b065df4778986fe57efa1aeceec4035b"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 15159,
                "url": "https://github.com/apache/pulsar/issues/15159",
                "title": "Offloading large ledgers (>2GB) fail with Google Cloud Storage",
                "bodyHTML": "<p dir=\"auto\"><strong>Describe the bug</strong></p>\n<p dir=\"auto\">Offloading large ledgers fail with Google Cloud Storage and the default settings. With default settings offloading ledgers over 2GB will fail to GCS since there's a limitation in JClouds (reported as <a href=\"https://issues.apache.org/jira/browse/JCLOUDS-1606\" rel=\"nofollow\">[JCLOUDS-1606] Cannot upload more than 32 parts to GCS</a>) which limits a multipart upload to 32 parts. GCS supports multipart uploads up to 10000 parts, but JClouds doesn't use the API in a way to achieve more than 32 parts.</p>\n<p dir=\"auto\">Here's an example log entry of the problem:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.util.concurrent.CompletionException: org.jclouds.http.HttpResponseException: command: POST https://www.googleapis.com/storage/v1/b/somebucket/o/ff553922-1fa3-4ceb-abcd-60106603b5c8-object-123456/compose HTTP/1.1 failed with response: HTTP/1.1 400 Bad Request; content: [{\n  &quot;error&quot;: {\n    &quot;code&quot;: 400,\n    &quot;message&quot;: &quot;The number of source components provided (35) exceeds the maximum (32)&quot;,\n    &quot;errors&quot;: [\n      {\n        &quot;message&quot;: &quot;The number of source components provided (35) exceeds the maximum (32)&quot;,\n        &quot;domain&quot;: &quot;global&quot;,\n        &quot;reason&quot;: &quot;invalid&quot;\n      }\n    ]\n  }\n}\n]\n        at java.util.concurrent.CompletableFuture.encodeRelay(CompletableFuture.java:367) ~[?:?]\n        at java.util.concurrent.CompletableFuture.completeRelay(CompletableFuture.java:376) ~[?:?]\n        at java.util.concurrent.CompletableFuture$UniRelay.tryFire(CompletableFuture.java:1019) ~[?:?]\n        at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:506) ~[?:?]\n        at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088) ~[?:?]\n        at org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader.lambda$offload$0(BlobStoreManagedLedgerOffloader.java:237) ~[?:?]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\n        at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088) ~[?:?]\n        at org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader.lambda$offload$0(BlobStoreManagedLedgerOffloader.java:237) ~[?:?]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\n        at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:74) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:82) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\n        at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) [?:?]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.74.Final.jar:4.1.74.Final]\n        at java.lang.Thread.run(Thread.java:829) [?:?]\nCaused by: org.jclouds.http.HttpResponseException: command: POST https://www.googleapis.com/storage/v1/b/somebucket/o/ff553922-1fa3-4ceb-abcd-60106603b5c8-object-123456/compose HTTP/1.1 failed with response: HTTP/1.1 400 Bad Request; content: [{\n  &quot;error&quot;: {\n    &quot;code&quot;: 400,\n    &quot;message&quot;: &quot;The number of source components provided (35) exceeds the maximum (32)&quot;,\n    &quot;errors&quot;: [\n      {\n        &quot;message&quot;: &quot;The number of source components provided (35) exceeds the maximum (32)&quot;,\n        &quot;domain&quot;: &quot;global&quot;,\n        &quot;reason&quot;: &quot;invalid&quot;\n      }\n    ]\n  }\n}\n]\n        at org.jclouds.googlecloudstorage.handlers.GoogleCloudStorageErrorHandler.handleError(GoogleCloudStorageErrorHandler.java:40) ~[?:?]\n        at org.jclouds.http.handlers.DelegatingErrorHandler.handleError(DelegatingErrorHandler.java:65) ~[?:?]\n        at org.jclouds.http.internal.BaseHttpCommandExecutorService.shouldContinue(BaseHttpCommandExecutorService.java:138) ~[?:?]\n        at org.jclouds.http.internal.BaseHttpCommandExecutorService.invoke(BaseHttpCommandExecutorService.java:107) ~[?:?]\n        at org.jclouds.rest.internal.InvokeHttpMethod.invoke(InvokeHttpMethod.java:91) ~[?:?]\n        at org.jclouds.rest.internal.InvokeHttpMethod.apply(InvokeHttpMethod.java:74) ~[?:?]\n        at org.jclouds.rest.internal.InvokeHttpMethod.apply(InvokeHttpMethod.java:45) ~[?:?]\n        at org.jclouds.reflect.FunctionalReflection$FunctionalInvocationHandler.handleInvocation(FunctionalReflection.java:117) ~[?:?]\n        at org.apache.pulsar.jcloud.shade.com.google.common.reflect.AbstractInvocationHandler.invoke(AbstractInvocationHandler.java:89) ~[?:?]\n        at com.sun.proxy.$Proxy144.composeObjects(Unknown Source) ~[?:?]\n        at org.jclouds.googlecloudstorage.blobstore.GoogleCloudStorageBlobStore.completeMultipartUpload(GoogleCloudStorageBlobStore.java:405) ~[?:?]\n        at jdk.internal.reflect.GeneratedMethodAccessor373.invoke(Unknown Source) ~[?:?]\n        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n        at java.lang.reflect.Method.invoke(Method.java:566) ~[?:?]\n        at org.apache.pulsar.jcloud.shade.com.google.inject.internal.DelegatingInvocationHandler.invoke(DelegatingInvocationHandler.java:50) ~[?:?]\n        at com.sun.proxy.$Proxy88.completeMultipartUpload(Unknown Source) ~[?:?]\n        at org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader.lambda$offload$0(BlobStoreManagedLedgerOffloader.java:226) ~[?:?]\n        ... 11 more\"><pre class=\"notranslate\"><code class=\"notranslate\">java.util.concurrent.CompletionException: org.jclouds.http.HttpResponseException: command: POST https://www.googleapis.com/storage/v1/b/somebucket/o/ff553922-1fa3-4ceb-abcd-60106603b5c8-object-123456/compose HTTP/1.1 failed with response: HTTP/1.1 400 Bad Request; content: [{\n  \"error\": {\n    \"code\": 400,\n    \"message\": \"The number of source components provided (35) exceeds the maximum (32)\",\n    \"errors\": [\n      {\n        \"message\": \"The number of source components provided (35) exceeds the maximum (32)\",\n        \"domain\": \"global\",\n        \"reason\": \"invalid\"\n      }\n    ]\n  }\n}\n]\n        at java.util.concurrent.CompletableFuture.encodeRelay(CompletableFuture.java:367) ~[?:?]\n        at java.util.concurrent.CompletableFuture.completeRelay(CompletableFuture.java:376) ~[?:?]\n        at java.util.concurrent.CompletableFuture$UniRelay.tryFire(CompletableFuture.java:1019) ~[?:?]\n        at java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:506) ~[?:?]\n        at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088) ~[?:?]\n        at org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader.lambda$offload$0(BlobStoreManagedLedgerOffloader.java:237) ~[?:?]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\n        at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at java.util.concurrent.CompletableFuture.completeExceptionally(CompletableFuture.java:2088) ~[?:?]\n        at org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader.lambda$offload$0(BlobStoreManagedLedgerOffloader.java:237) ~[?:?]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\n        at com.google.common.util.concurrent.TrustedListenableFutureTask$TrustedFutureInterruptibleTask.runInterruptibly(TrustedListenableFutureTask.java:131) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at com.google.common.util.concurrent.InterruptibleTask.run(InterruptibleTask.java:74) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at com.google.common.util.concurrent.TrustedListenableFutureTask.run(TrustedListenableFutureTask.java:82) [com.google.guava-guava-31.0.1-jre.jar:?]\n        at java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:515) [?:?]\n        at java.util.concurrent.FutureTask.run(FutureTask.java:264) [?:?]\n        at java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:304) [?:?]\n        at java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1128) [?:?]\n        at java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:628) [?:?]\n        at io.netty.util.concurrent.FastThreadLocalRunnable.run(FastThreadLocalRunnable.java:30) [io.netty-netty-common-4.1.74.Final.jar:4.1.74.Final]\n        at java.lang.Thread.run(Thread.java:829) [?:?]\nCaused by: org.jclouds.http.HttpResponseException: command: POST https://www.googleapis.com/storage/v1/b/somebucket/o/ff553922-1fa3-4ceb-abcd-60106603b5c8-object-123456/compose HTTP/1.1 failed with response: HTTP/1.1 400 Bad Request; content: [{\n  \"error\": {\n    \"code\": 400,\n    \"message\": \"The number of source components provided (35) exceeds the maximum (32)\",\n    \"errors\": [\n      {\n        \"message\": \"The number of source components provided (35) exceeds the maximum (32)\",\n        \"domain\": \"global\",\n        \"reason\": \"invalid\"\n      }\n    ]\n  }\n}\n]\n        at org.jclouds.googlecloudstorage.handlers.GoogleCloudStorageErrorHandler.handleError(GoogleCloudStorageErrorHandler.java:40) ~[?:?]\n        at org.jclouds.http.handlers.DelegatingErrorHandler.handleError(DelegatingErrorHandler.java:65) ~[?:?]\n        at org.jclouds.http.internal.BaseHttpCommandExecutorService.shouldContinue(BaseHttpCommandExecutorService.java:138) ~[?:?]\n        at org.jclouds.http.internal.BaseHttpCommandExecutorService.invoke(BaseHttpCommandExecutorService.java:107) ~[?:?]\n        at org.jclouds.rest.internal.InvokeHttpMethod.invoke(InvokeHttpMethod.java:91) ~[?:?]\n        at org.jclouds.rest.internal.InvokeHttpMethod.apply(InvokeHttpMethod.java:74) ~[?:?]\n        at org.jclouds.rest.internal.InvokeHttpMethod.apply(InvokeHttpMethod.java:45) ~[?:?]\n        at org.jclouds.reflect.FunctionalReflection$FunctionalInvocationHandler.handleInvocation(FunctionalReflection.java:117) ~[?:?]\n        at org.apache.pulsar.jcloud.shade.com.google.common.reflect.AbstractInvocationHandler.invoke(AbstractInvocationHandler.java:89) ~[?:?]\n        at com.sun.proxy.$Proxy144.composeObjects(Unknown Source) ~[?:?]\n        at org.jclouds.googlecloudstorage.blobstore.GoogleCloudStorageBlobStore.completeMultipartUpload(GoogleCloudStorageBlobStore.java:405) ~[?:?]\n        at jdk.internal.reflect.GeneratedMethodAccessor373.invoke(Unknown Source) ~[?:?]\n        at jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43) ~[?:?]\n        at java.lang.reflect.Method.invoke(Method.java:566) ~[?:?]\n        at org.apache.pulsar.jcloud.shade.com.google.inject.internal.DelegatingInvocationHandler.invoke(DelegatingInvocationHandler.java:50) ~[?:?]\n        at com.sun.proxy.$Proxy88.completeMultipartUpload(Unknown Source) ~[?:?]\n        at org.apache.bookkeeper.mledger.offload.jcloud.impl.BlobStoreManagedLedgerOffloader.lambda$offload$0(BlobStoreManagedLedgerOffloader.java:226) ~[?:?]\n        ... 11 more\n</code></pre></div>\n<p dir=\"auto\"><strong>To Reproduce</strong><br>\nSteps to reproduce the behavior:</p>\n<ol dir=\"auto\">\n<li>Configure offloading to use GCS</li>\n<li>Produce a lot of messages</li>\n<li>Trigger ledger offloading</li>\n</ol>\n<p dir=\"auto\"><strong>Expected behavior</strong></p>\n<p dir=\"auto\">Ledger offloading should work with large ledger sizes</p>\n<p dir=\"auto\"><strong>Workaround</strong></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"# ensure that ledgers don't grow over 1500MB\nmanagedLedgerMaxSizePerLedgerMbytes=1500\nmanagedLedgerMinLedgerRolloverTimeMinutes=0\"><pre class=\"notranslate\"><code class=\"notranslate\"># ensure that ledgers don't grow over 1500MB\nmanagedLedgerMaxSizePerLedgerMbytes=1500\nmanagedLedgerMinLedgerRolloverTimeMinutes=0\n</code></pre></div>\n<p dir=\"auto\">or</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"# increase block size to 128MB, maximum file size doubles to 4GB\ngcsManagedLedgerOffloadMaxBlockSizeInBytes=134217728\"><pre class=\"notranslate\"><code class=\"notranslate\"># increase block size to 128MB, maximum file size doubles to 4GB\ngcsManagedLedgerOffloadMaxBlockSizeInBytes=134217728\n</code></pre></div>\n<p dir=\"auto\"><strong>Additional context</strong></p>\n<p dir=\"auto\">JClouds issue reported as <a href=\"https://issues.apache.org/jira/browse/JCLOUDS-1606\" rel=\"nofollow\">[JCLOUDS-1606] Cannot upload more than 32 parts to GCS</a>.</p>",
                "resourcePath": "/apache/pulsar/issues/15159",
                "createdAt": "2022-04-13T12:31:31Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    },
                    {
                      "node": {
                        "name": "lifecycle/stale"
                      }
                    },
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[improve][broker] Exclude producers for geo-replication from publishers field of topic stats",
        "url": "https://github.com/apache/pulsar/pull/22556",
        "resourcePath": "/apache/pulsar/pull/22556",
        "createdAt": "2024-04-22T14:20:37Z",
        "number": 22556,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/nonpersistent/NonPersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/persistent/PersistentTopic.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/OneWayReplicatorTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5tW6kK2gAoMTRhNGU4YjljZDU0MzRjNGJhOWQ4MGVjYjMyMjgzMjdmM2Y2NWRlZA",
                "url": "https://github.com/apache/pulsar/pull/22556/commits/14a4e8b9cd5434c4ba9d80ecb3228327f3f65ded"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22442,
                "url": "https://github.com/apache/pulsar/issues/22442",
                "title": "Producers for geo-replication should be excluded from the `publishers` field of topic stats",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">After upgrading the version of Pulsar used at our company, the <code class=\"notranslate\">publishers</code> field of topic stats now includes producers whose names start with <code class=\"notranslate\">pulsar.repl.</code>, which were not included before. These are producers created by brokers in other clusters for geo-replication.</p>\n<div class=\"highlight highlight-source-json notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"&quot;publishers&quot; : [ {\n  &quot;accessMode&quot; : &quot;Shared&quot;,\n  &quot;msgRateIn&quot; : 0.0,\n  &quot;msgThroughputIn&quot; : 0.0,\n  &quot;averageMsgSize&quot; : 0.0,\n  &quot;chunkedMessageRate&quot; : 0.0,\n  &quot;producerId&quot; : 0,\n  &quot;supportsPartialProducer&quot; : false,\n  &quot;metadata&quot; : { },\n  &quot;address&quot; : &quot;/xxx.xxx.xxx.xxx:37102&quot;,\n  &quot;connectedSince&quot; : &quot;2024-04-04T14:23:33.666865+09:00&quot;,\n  &quot;clientVersion&quot; : &quot;2.10.5&quot;,\n  &quot;producerName&quot; : &quot;pulsar.repl.dev&quot;\n} ],\"><pre class=\"notranslate\"><span class=\"pl-ent\">\"publishers\"</span> : [ {\n  <span class=\"pl-ent\">\"accessMode\"</span> : <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Shared<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-ent\">\"msgRateIn\"</span> : <span class=\"pl-c1\">0.0</span>,\n  <span class=\"pl-ent\">\"msgThroughputIn\"</span> : <span class=\"pl-c1\">0.0</span>,\n  <span class=\"pl-ent\">\"averageMsgSize\"</span> : <span class=\"pl-c1\">0.0</span>,\n  <span class=\"pl-ent\">\"chunkedMessageRate\"</span> : <span class=\"pl-c1\">0.0</span>,\n  <span class=\"pl-ent\">\"producerId\"</span> : <span class=\"pl-c1\">0</span>,\n  <span class=\"pl-ent\">\"supportsPartialProducer\"</span> : <span class=\"pl-c1\">false</span>,\n  <span class=\"pl-ent\">\"metadata\"</span> : { },\n  <span class=\"pl-ent\">\"address\"</span> : <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/xxx.xxx.xxx.xxx:37102<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-ent\">\"connectedSince\"</span> : <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>2024-04-04T14:23:33.666865+09:00<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-ent\">\"clientVersion\"</span> : <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>2.10.5<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-ent\">\"producerName\"</span> : <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>pulsar.repl.dev<span class=\"pl-pds\">\"</span></span>\n} ],</pre></div>\n<p dir=\"auto\">Producers for geo-replication started to appear in <code class=\"notranslate\">publishers</code> due to the following PR:<br>\n<a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1697218132\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20229\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20229/hovercard\" href=\"https://github.com/apache/pulsar/pull/20229\">#20229</a></p>\n<p dir=\"auto\">Although this PR is treated as a bug fix, it seems that the exclusion of geo-replication producers from <code class=\"notranslate\">publishers</code> was intentional, so I think this is a specification change.</p>\n<p dir=\"auto\">I think geo-replication producers should be excluded from <code class=\"notranslate\">publishers</code>. These are unknown producers to normal users, so they confuse users who look at topic stats. I think that the mechanism for achieving geo-replication should be hidden from users as much as possible.</p>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">I would like to revert <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1697218132\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20229\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20229/hovercard\" href=\"https://github.com/apache/pulsar/pull/20229\">#20229</a>. In addition to that, the <code class=\"notranslate\">publishers</code> and <code class=\"notranslate\">producerCount</code> fields in broker stats also include the number of geo-replication producers, so I'd like to exclude that from them too if possible.</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\">If <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1697218132\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20229\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20229/hovercard\" href=\"https://github.com/apache/pulsar/pull/20229\">#20229</a> should not be completely reverted, there is an option to add a query parameter to the REST APIs for retrieving topic stats/broker stats to determine whether <code class=\"notranslate\">publishers</code> should include geo-replication producers. Even in this case, I'd like to hide geo-replication producers by default. I suggest <code class=\"notranslate\">showReplicatorProducers</code> as the name of the query parameter.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22442",
                "createdAt": "2024-04-05T09:31:40Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/enhancement"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] Include swagger annotations in shaded client lib",
        "url": "https://github.com/apache/pulsar/pull/22570",
        "resourcePath": "/apache/pulsar/pull/22570",
        "createdAt": "2024-04-23T23:28:23Z",
        "number": 22570,
        "mergeCommit": {
          "oid": "77a99ed287cd2c85590f9734190faceb8a50532c",
          "message": "[fix] Include swagger annotations in shaded client lib (#22570)",
          "commitUrl": "https://github.com/apache/pulsar/commit/77a99ed287cd2c85590f9734190faceb8a50532c",
          "parents": {
            "nodes": [
              {
                "oid": "d5c72312ff4d03291e1ea2eb37464250c85bf401",
                "message": "[fix][admin] Fix can't delete tenant for v1 (#22550)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "distribution/shell/src/assemble/LICENSE.bin.txt"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5tiFRv2gAoYTY0MGY1ZmY1YmNhMjBjNThiZjE2NTU2NWM3ZjQ0MTQwM2EyZTYzMw",
                "url": "https://github.com/apache/pulsar/pull/22570/commits/a640f5ff5bca20c58bf165565c7f441403a2e633"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21962,
                "url": "https://github.com/apache/pulsar/issues/21962",
                "title": "Missing shade io.swagger classes in org.apache.pulsar:pulsar-client jar ",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">pulsar version: 3.1.2</p>\n<p dir=\"auto\">when I work with pulsar client and build by gradle,<br>\nWe don't allow any compile warning message<br>\nbut we get many warning</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/Users/yinchin.chen/.gradle/caches/modules-2/files-2.1/org.apache.pulsar/pulsar-client/3.1.2/1f5e746cd01aae20b2e8fd4bf61c09c41c8f9137/pulsar-client-3.1.2.jar(/org/apache/pulsar/client/impl/conf/ConsumerConfigurationData.class): warning: Cannot find annotation method 'name()' in type 'ApiModelProperty'\n/Users/yinchin.chen/.gradle/caches/modules-2/files-2.1/org.apache.pulsar/pulsar-client/3.1.2/1f5e746cd01aae20b2e8fd4bf61c09c41c8f9137/pulsar-client-3.1.2.jar(/org/apache/pulsar/client/impl/conf/ConsumerConfigurationData.class): warning: Cannot find annotation method 'value()' in type 'ApiModelProperty'\nerror: warnings found and -Werror specified\"><pre class=\"notranslate\"><code class=\"notranslate\">/Users/yinchin.chen/.gradle/caches/modules-2/files-2.1/org.apache.pulsar/pulsar-client/3.1.2/1f5e746cd01aae20b2e8fd4bf61c09c41c8f9137/pulsar-client-3.1.2.jar(/org/apache/pulsar/client/impl/conf/ConsumerConfigurationData.class): warning: Cannot find annotation method 'name()' in type 'ApiModelProperty'\n/Users/yinchin.chen/.gradle/caches/modules-2/files-2.1/org.apache.pulsar/pulsar-client/3.1.2/1f5e746cd01aae20b2e8fd4bf61c09c41c8f9137/pulsar-client-3.1.2.jar(/org/apache/pulsar/client/impl/conf/ConsumerConfigurationData.class): warning: Cannot find annotation method 'value()' in type 'ApiModelProperty'\nerror: warnings found and -Werror specified\n</code></pre></div>\n<p dir=\"auto\">it's because shaded swagger package is missing in pulsar-client-3.1.2.jar<br>\neg: org.apache.pulsar.shade.io.swagger.annotations.ApiModelProperty;</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"jar tfv pulsar-client-3.1.2.jar |grep sawgger\"><pre class=\"notranslate\"><code class=\"notranslate\">jar tfv pulsar-client-3.1.2.jar |grep sawgger\n</code></pre></div>\n<h3 dir=\"auto\">Solution</h3>\n<p dir=\"auto\">pulsar-client/pom.xml<br>\nmaybe</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    &lt;dependency&gt;\n      &lt;groupId&gt;io.swagger&lt;/groupId&gt;\n      &lt;artifactId&gt;swagger-annotations&lt;/artifactId&gt;\n      &lt;scope&gt;provided&lt;/scope&gt; &lt;==== remove this \n    &lt;/dependency&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">    &lt;dependency&gt;\n      &lt;groupId&gt;io.swagger&lt;/groupId&gt;\n      &lt;artifactId&gt;swagger-annotations&lt;/artifactId&gt;\n      &lt;scope&gt;provided&lt;/scope&gt; &lt;==== remove this \n    &lt;/dependency&gt;\n</code></pre></div>\n<p dir=\"auto\">or<br>\ndon't shaded swagger</p>\n<h3 dir=\"auto\">Alternatives</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21962",
                "createdAt": "2024-01-24T02:50:59Z",
                "labels": {
                  "edges": []
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Avoid being stuck when closing the broker with extensible load manager",
        "url": "https://github.com/apache/pulsar/pull/22573",
        "resourcePath": "/apache/pulsar/pull/22573",
        "createdAt": "2024-04-24T12:23:53Z",
        "number": 22573,
        "mergeCommit": {
          "oid": "f411e3c0f26eef98382c7d06ea1676781247149b",
          "message": "[fix][broker] Avoid being stuck when closing the broker with extensible load manager (#22573)",
          "commitUrl": "https://github.com/apache/pulsar/commit/f411e3c0f26eef98382c7d06ea1676781247149b",
          "parents": {
            "nodes": [
              {
                "oid": "3b9602c04db5a6577e2dc2fabddbf7a6e1d1a4a2",
                "message": "[improve][broker] Propagate cause exception in TopicBusyException when applicable (#22596)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/PulsarService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/loadbalance/extensions/store/TableViewLoadDataStoreImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/loadbalance/extensions/ExtensibleLoadManagerCloseTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5tmKiG2gAoY2JhYjIzMzMwMmMwYzFiYWRhMmJiYWFlYzI1Y2RmNDk5MjhmYzc5OA",
                "url": "https://github.com/apache/pulsar/pull/22573/commits/cbab233302c0c1bada2bbaaec25cdf49928fc798"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22569,
                "url": "https://github.com/apache/pulsar/issues/22569",
                "title": "[Bug] Broker could take 30+ seconds to close with extensible load manager",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master (<a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/apache/pulsar/commit/89b201ed8a49877e0a7148b060af945b29074b02/hovercard\" href=\"https://github.com/apache/pulsar/commit/89b201ed8a49877e0a7148b060af945b29074b02\"><tt>89b201e</tt></a>)</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"public class ExtensibleLoadManagerCloseTest extends MultiBrokerBaseTest {\n\n    @Override\n    protected void startBroker() throws Exception {\n        addCustomConfigs(conf);\n        super.startBroker();\n    }\n\n    @Override\n    protected ServiceConfiguration createConfForAdditionalBroker(int additionalBrokerIndex) {\n        return addCustomConfigs(getDefaultConf());\n    }\n\n    private static ServiceConfiguration addCustomConfigs(ServiceConfiguration config) {\n        config.setLoadManagerClassName(ExtensibleLoadManagerImpl.class.getName());\n        config.setDefaultNumberOfNamespaceBundles(16);\n        config.setLoadBalancerAutoBundleSplitEnabled(false);\n        config.setLoadBalancerDebugModeEnabled(true);\n        return config;\n    }\n\n    @Test\n    public void test() throws Exception {\n        final var topic = &quot;test&quot;;\n        admin.topics().createPartitionedTopic(topic, 20);\n        admin.lookups().lookupPartitionedTopic(topic);\n        @Cleanup final var client = PulsarClient.builder().serviceUrl(pulsar.getBrokerServiceUrl()).build();\n        @Cleanup final var producer = (PartitionedProducerImpl&lt;byte[]&gt;) client.newProducer().topic(topic).create();\n    }\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-smi\">ExtensibleLoadManagerCloseTest</span> <span class=\"pl-k\">extends</span> <span class=\"pl-smi\">MultiBrokerBaseTest</span> {\n\n    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Override</span>\n    <span class=\"pl-k\">protected</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">startBroker</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">Exception</span> {\n        <span class=\"pl-en\">addCustomConfigs</span>(<span class=\"pl-s1\">conf</span>);\n        <span class=\"pl-en\">super</span>.<span class=\"pl-en\">startBroker</span>();\n    }\n\n    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Override</span>\n    <span class=\"pl-k\">protected</span> <span class=\"pl-smi\">ServiceConfiguration</span> <span class=\"pl-en\">createConfForAdditionalBroker</span>(<span class=\"pl-smi\">int</span> <span class=\"pl-s1\">additionalBrokerIndex</span>) {\n        <span class=\"pl-k\">return</span> <span class=\"pl-en\">addCustomConfigs</span>(<span class=\"pl-en\">getDefaultConf</span>());\n    }\n\n    <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">ServiceConfiguration</span> <span class=\"pl-en\">addCustomConfigs</span>(<span class=\"pl-smi\">ServiceConfiguration</span> <span class=\"pl-s1\">config</span>) {\n        <span class=\"pl-s1\">config</span>.<span class=\"pl-en\">setLoadManagerClassName</span>(<span class=\"pl-smi\">ExtensibleLoadManagerImpl</span>.<span class=\"pl-k\">class</span>.<span class=\"pl-en\">getName</span>());\n        <span class=\"pl-s1\">config</span>.<span class=\"pl-en\">setDefaultNumberOfNamespaceBundles</span>(<span class=\"pl-c1\">16</span>);\n        <span class=\"pl-s1\">config</span>.<span class=\"pl-en\">setLoadBalancerAutoBundleSplitEnabled</span>(<span class=\"pl-c1\">false</span>);\n        <span class=\"pl-s1\">config</span>.<span class=\"pl-en\">setLoadBalancerDebugModeEnabled</span>(<span class=\"pl-c1\">true</span>);\n        <span class=\"pl-k\">return</span> <span class=\"pl-s1\">config</span>;\n    }\n\n    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Test</span>\n    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">test</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">Exception</span> {\n        <span class=\"pl-k\">final</span> <span class=\"pl-smi\">var</span> <span class=\"pl-s1\">topic</span> = <span class=\"pl-s\">\"test\"</span>;\n        <span class=\"pl-s1\">admin</span>.<span class=\"pl-en\">topics</span>().<span class=\"pl-en\">createPartitionedTopic</span>(<span class=\"pl-s1\">topic</span>, <span class=\"pl-c1\">20</span>);\n        <span class=\"pl-s1\">admin</span>.<span class=\"pl-en\">lookups</span>().<span class=\"pl-en\">lookupPartitionedTopic</span>(<span class=\"pl-s1\">topic</span>);\n        <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Cleanup</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">var</span> <span class=\"pl-s1\">client</span> = <span class=\"pl-smi\">PulsarClient</span>.<span class=\"pl-en\">builder</span>().<span class=\"pl-en\">serviceUrl</span>(<span class=\"pl-s1\">pulsar</span>.<span class=\"pl-en\">getBrokerServiceUrl</span>()).<span class=\"pl-en\">build</span>();\n        <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Cleanup</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">var</span> <span class=\"pl-s1\">producer</span> = (<span class=\"pl-smi\">PartitionedProducerImpl</span>&lt;<span class=\"pl-smi\">byte</span>[]&gt;) <span class=\"pl-s1\">client</span>.<span class=\"pl-en\">newProducer</span>().<span class=\"pl-en\">topic</span>(<span class=\"pl-s1\">topic</span>).<span class=\"pl-en\">create</span>();\n    }\n}</pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">It should not takes too long to complete.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">It sometimes took about 54 seconds to complete and sometimes 22 seconds.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">With the default load manager, it only takes about 15 seconds to complete.</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22569",
                "createdAt": "2024-04-23T14:03:38Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][broker] Fix BufferOverflowException and EOFException bugs in /metrics gzip compression",
        "url": "https://github.com/apache/pulsar/pull/22576",
        "resourcePath": "/apache/pulsar/pull/22576",
        "createdAt": "2024-04-24T14:30:51Z",
        "number": 22576,
        "mergeCommit": {
          "oid": "997c8b95e1798cee08c56d92b77eb70056dfca8f",
          "message": "[fix][broker] Fix BufferOverflowException and EOFException bugs in /metrics gzip compression (#22576)",
          "commitUrl": "https://github.com/apache/pulsar/commit/997c8b95e1798cee08c56d92b77eb70056dfca8f",
          "parents": {
            "nodes": [
              {
                "oid": "0c097ef2c6c85efbb91d388ffe839ec542e82278",
                "message": "[improve][misc] Upgrade slf4j to 2.0.13 (#22391)\n\nSigned-off-by: Zixuan Liu <nodeces@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/PrometheusMetricsGenerator.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/stats/prometheus/PrometheusMetricsGeneratorTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5tnHhH2gAoNGJkNTg4OGYzMmJkOTZhMGNmMWVkMzZmMmQzYWNmMjhmMTYyMTJjNA",
                "url": "https://github.com/apache/pulsar/pull/22576/commits/4bd5888f32bd96a0cf1ed36f2d3acf28f16212c4"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22575,
                "url": "https://github.com/apache/pulsar/issues/22575",
                "title": "[Bug] /metrics gzip compression sporadically fails with error 500 caused by java.nio.BufferOverflowException",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">TBD</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">getting /metrics with gzip compression shouldn't fail</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">it sometimes fails</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">The problem in the code is here: </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/apache/pulsar/blob/94f6c7ccd2bf8bc261d45ab41f6c7f123359fa47/pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/PrometheusMetricsGenerator.java#L236-L241\">pulsar/pulsar-broker/src/main/java/org/apache/pulsar/broker/stats/prometheus/PrometheusMetricsGenerator.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 236 to 241\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/apache/pulsar/commit/94f6c7ccd2bf8bc261d45ab41f6c7f123359fa47\">94f6c7c</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L236\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"236\"></td>\n          <td id=\"LC236\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\">// write gzip footer, integer values are in little endian byte order</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L237\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"237\"></td>\n          <td id=\"LC237\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">compressBuffer</span>.<span class=\"pl-en\">order</span>(<span class=\"pl-smi\">ByteOrder</span>.<span class=\"pl-c1\">LITTLE_ENDIAN</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L238\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"238\"></td>\n          <td id=\"LC238\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\">// write CRC32 checksum</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L239\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"239\"></td>\n          <td id=\"LC239\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">compressBuffer</span>.<span class=\"pl-en\">putInt</span>((<span class=\"pl-smi\">int</span>) <span class=\"pl-s1\">crc</span>.<span class=\"pl-en\">getValue</span>()); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L240\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"240\"></td>\n          <td id=\"LC240\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\">// write uncompressed size</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L241\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"241\"></td>\n          <td id=\"LC241\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">compressBuffer</span>.<span class=\"pl-en\">putInt</span>(<span class=\"pl-s1\">deflater</span>.<span class=\"pl-en\">getTotalIn</span>()); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<br>\nputInts will fail if the compress buffer doesn't have remaining space.<p></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22575",
                "createdAt": "2024-04-24T14:15:22Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [broker] Fix metrics pulsar_topic_load_failed_count is 0 when load non-persistent topic fails and fix the flaky test testBrokerStatsTopicLoadFailed",
        "url": "https://github.com/apache/pulsar/pull/22580",
        "resourcePath": "/apache/pulsar/pull/22580",
        "createdAt": "2024-04-25T04:50:48Z",
        "number": 22580,
        "mergeCommit": {
          "oid": "340d60df0be32ed26586f292a8d24a8a6663aba2",
          "message": "[fix] [broker] Fix metrics pulsar_topic_load_failed_count is 0 when load non-persistent topic fails and fix the flaky test testBrokerStatsTopicLoadFailed (#22580)",
          "commitUrl": "https://github.com/apache/pulsar/commit/340d60df0be32ed26586f292a8d24a8a6663aba2",
          "parents": {
            "nodes": [
              {
                "oid": "6fdc0e31bff906446e70965531671389d57e6cda",
                "message": "[fix] [test] Fix flaky test ReplicatorTest (#22594)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/main/java/org/apache/pulsar/broker/service/BrokerService.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/service/BrokerServiceTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5trNDP2gAoODNlMGRjZTE3NmE5NzMxZjk4NzVkOTI3ZWYwODhkNmU2ZGI1ODYxYw",
                "url": "https://github.com/apache/pulsar/pull/22580/commits/83e0dce176a9731f9875d927ef088d6e6db5861c"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 20495,
                "url": "https://github.com/apache/pulsar/issues/20495",
                "title": "Rewrite BrokerServiceTest#testBrokerStatsTopicLoadFailed",
                "bodyHTML": "<p dir=\"auto\">The BrokerServiceTest#testBrokerStatsTopicLoadFailed is disabled by <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1741807907\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20494\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20494/hovercard\" href=\"https://github.com/apache/pulsar/pull/20494\">#20494</a>.</p>\n<blockquote>\n<ol start=\"2\" dir=\"auto\">\n<li>Remove the test case and if the coverage is necessary, file a new ticket to add it back.</li>\n</ol>\n</blockquote>\n<p dir=\"auto\"><em>Originally posted by <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/tisonkun/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/tisonkun\">@tisonkun</a> in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1741807907\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/20494\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/20494/hovercard?comment_id=1462643509&amp;comment_type=review\" href=\"https://github.com/apache/pulsar/pull/20494#pullrequestreview-1462643509\">#20494 (review)</a></em></p>\n<p dir=\"auto\">The test BrokerServiceTest#testBrokerStatsTopicLoadFailed introduced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1533760215\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/19236\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/19236/hovercard\" href=\"https://github.com/apache/pulsar/pull/19236\">#19236</a> is invalid.</p>\n<ul dir=\"auto\">\n<li>It modifies the current shared state and that causes other tests to fail.</li>\n<li>The test uses Awaitility with a 2 minute timeout. That is too long for unit tests.</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/20495",
                "createdAt": "2023-06-05T14:28:54Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "Stale"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][test] Flaky-test: AdminApiMultiBrokersTest.testForceDeletePartitionedTopicWithSub",
        "url": "https://github.com/apache/pulsar/pull/22592",
        "resourcePath": "/apache/pulsar/pull/22592",
        "createdAt": "2024-04-26T02:22:05Z",
        "number": 22592,
        "mergeCommit": null,
        "potentialMergeCommit": {
          "oid": "975b037f43ad050bf79cca1baae1eb2893932780",
          "message": "Merge 2e4dd05b480ace2e97d10a623c202af912272d07 into eee3694f00e269eef0f75d791521d0d35d8ff411",
          "commitUrl": "https://github.com/apache/pulsar/commit/975b037f43ad050bf79cca1baae1eb2893932780",
          "parents": {
            "nodes": [
              {
                "oid": "eee3694f00e269eef0f75d791521d0d35d8ff411",
                "message": "[fix][storage] ReadonlyManagedLedger initialization does not fill in the properties (#22630)"
              },
              {
                "oid": "2e4dd05b480ace2e97d10a623c202af912272d07",
                "message": "fix-22428"
              }
            ]
          }
        },
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/broker/admin/AdminApiMultiBrokersTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5tysDV2gAoMmU0ZGQwNWI0ODBhY2UyZTk3ZDEwYTYyM2MyMDJhZjkxMjI3MmQwNw",
                "url": "https://github.com/apache/pulsar/pull/22592/commits/2e4dd05b480ace2e97d10a623c202af912272d07"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22428,
                "url": "https://github.com/apache/pulsar/issues/22428",
                "title": "Flaky-test: AdminApiMultiBrokersTest.testForceDeletePartitionedTopicWithSub",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Example failures</h3>\n<ul dir=\"auto\">\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/8490597203/job/23261977280#step:10:1066\">2024-03-30T12:21:15.1518446Z</a></li>\n<li><a href=\"https://github.com/apache/pulsar/actions/runs/8401646017/job/23010402799#step:11:1050\">2024-03-23T12:23:18.1135840Z</a></li>\n</ul>\n<h3 dir=\"auto\">Exception stacktrace</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.util.concurrent.ExecutionException: org.apache.pulsar.client.admin.PulsarAdminException$ConflictException: This topic already exists\n\tat java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:396)\n\tat java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2073)\n\tat org.apache.pulsar.broker.admin.AdminApiMultiBrokersTest.testForceDeletePartitionedTopicWithSub(AdminApiMultiBrokersTest.java:208)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:840)\nCaused by: org.apache.pulsar.client.admin.PulsarAdminException$ConflictException: This topic already exists\n\tat org.apache.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:287)\n\tat org.apache.pulsar.client.admin.internal.BaseResource$1.failed(BaseResource.java:136)\n\tat org.glassfish.jersey.client.JerseyInvocation$1.failed(JerseyInvocation.java:882)\n\tat org.glassfish.jersey.client.JerseyInvocation$1.completed(JerseyInvocation.java:863)\n\tat org.glassfish.jersey.client.ClientRuntime.processResponse(ClientRuntime.java:232)\n\tat org.glassfish.jersey.client.ClientRuntime.access$200(ClientRuntime.java:62)\n\tat org.glassfish.jersey.client.ClientRuntime$2.lambda$response$0(ClientRuntime.java:176)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:292)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:274)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:244)\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:288)\n\tat org.glassfish.jersey.client.ClientRuntime$2.response(ClientRuntime.java:176)\n\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$apply$1(AsyncHttpConnector.java:254)\n\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$retryOperation$4(AsyncHttpConnector.java:296)\n\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n\tat org.asynchttpclient.netty.NettyResponseFuture.loadContent(NettyResponseFuture.java:222)\n\tat org.asynchttpclient.netty.NettyResponseFuture.done(NettyResponseFuture.java:257)\n\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.finishUpdate(AsyncHttpClientHandler.java:241)\n\tat org.asynchttpclient.netty.handler.HttpHandler.handleChunk(HttpHandler.java:114)\n\tat org.asynchttpclient.netty.handler.HttpHandler.handleRead(HttpHandler.java:143)\n\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.channelRead(AsyncHttpClientHandler.java:78)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelRead(CombinedChannelDuplexHandler.java:436)\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)\n\tat io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:251)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\"><pre class=\"notranslate\"><code class=\"notranslate\">java.util.concurrent.ExecutionException: org.apache.pulsar.client.admin.PulsarAdminException$ConflictException: This topic already exists\n\tat java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:396)\n\tat java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2073)\n\tat org.apache.pulsar.broker.admin.AdminApiMultiBrokersTest.testForceDeletePartitionedTopicWithSub(AdminApiMultiBrokersTest.java:208)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke0(Native Method)\n\tat java.base/jdk.internal.reflect.NativeMethodAccessorImpl.invoke(NativeMethodAccessorImpl.java:77)\n\tat java.base/jdk.internal.reflect.DelegatingMethodAccessorImpl.invoke(DelegatingMethodAccessorImpl.java:43)\n\tat java.base/java.lang.reflect.Method.invoke(Method.java:568)\n\tat org.testng.internal.invokers.MethodInvocationHelper.invokeMethod(MethodInvocationHelper.java:139)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.runOne(InvokeMethodRunnable.java:47)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:76)\n\tat org.testng.internal.invokers.InvokeMethodRunnable.call(InvokeMethodRunnable.java:11)\n\tat java.base/java.util.concurrent.FutureTask.run(FutureTask.java:264)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1136)\n\tat java.base/java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:635)\n\tat java.base/java.lang.Thread.run(Thread.java:840)\nCaused by: org.apache.pulsar.client.admin.PulsarAdminException$ConflictException: This topic already exists\n\tat org.apache.pulsar.client.admin.internal.BaseResource.getApiException(BaseResource.java:287)\n\tat org.apache.pulsar.client.admin.internal.BaseResource$1.failed(BaseResource.java:136)\n\tat org.glassfish.jersey.client.JerseyInvocation$1.failed(JerseyInvocation.java:882)\n\tat org.glassfish.jersey.client.JerseyInvocation$1.completed(JerseyInvocation.java:863)\n\tat org.glassfish.jersey.client.ClientRuntime.processResponse(ClientRuntime.java:232)\n\tat org.glassfish.jersey.client.ClientRuntime.access$200(ClientRuntime.java:62)\n\tat org.glassfish.jersey.client.ClientRuntime$2.lambda$response$0(ClientRuntime.java:176)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:248)\n\tat org.glassfish.jersey.internal.Errors$1.call(Errors.java:244)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:292)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:274)\n\tat org.glassfish.jersey.internal.Errors.process(Errors.java:244)\n\tat org.glassfish.jersey.process.internal.RequestScope.runInScope(RequestScope.java:288)\n\tat org.glassfish.jersey.client.ClientRuntime$2.response(ClientRuntime.java:176)\n\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$apply$1(AsyncHttpConnector.java:254)\n\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n\tat org.apache.pulsar.client.admin.internal.http.AsyncHttpConnector.lambda$retryOperation$4(AsyncHttpConnector.java:296)\n\tat java.base/java.util.concurrent.CompletableFuture.uniWhenComplete(CompletableFuture.java:863)\n\tat java.base/java.util.concurrent.CompletableFuture$UniWhenComplete.tryFire(CompletableFuture.java:841)\n\tat java.base/java.util.concurrent.CompletableFuture.postComplete(CompletableFuture.java:510)\n\tat java.base/java.util.concurrent.CompletableFuture.complete(CompletableFuture.java:2147)\n\tat org.asynchttpclient.netty.NettyResponseFuture.loadContent(NettyResponseFuture.java:222)\n\tat org.asynchttpclient.netty.NettyResponseFuture.done(NettyResponseFuture.java:257)\n\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.finishUpdate(AsyncHttpClientHandler.java:241)\n\tat org.asynchttpclient.netty.handler.HttpHandler.handleChunk(HttpHandler.java:114)\n\tat org.asynchttpclient.netty.handler.HttpHandler.handleRead(HttpHandler.java:143)\n\tat org.asynchttpclient.netty.handler.AsyncHttpClientHandler.channelRead(AsyncHttpClientHandler.java:78)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.handler.codec.MessageToMessageDecoder.channelRead(MessageToMessageDecoder.java:103)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:444)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.CombinedChannelDuplexHandler$DelegatingChannelHandlerContext.fireChannelRead(CombinedChannelDuplexHandler.java:436)\n\tat io.netty.handler.codec.ByteToMessageDecoder.fireChannelRead(ByteToMessageDecoder.java:346)\n\tat io.netty.handler.codec.ByteToMessageDecoder.channelRead(ByteToMessageDecoder.java:318)\n\tat io.netty.channel.CombinedChannelDuplexHandler.channelRead(CombinedChannelDuplexHandler.java:251)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:442)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.AbstractChannelHandlerContext.fireChannelRead(AbstractChannelHandlerContext.java:412)\n\tat io.netty.channel.DefaultChannelPipeline$HeadContext.channelRead(DefaultChannelPipeline.java:1410)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:440)\n\tat io.netty.channel.AbstractChannelHandlerContext.invokeChannelRead(AbstractChannelHandlerContext.java:420)\n\tat io.netty.channel.DefaultChannelPipeline.fireChannelRead(DefaultChannelPipeline.java:919)\n\tat io.netty.channel.nio.AbstractNioByteChannel$NioByteUnsafe.read(AbstractNioByteChannel.java:166)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKey(NioEventLoop.java:788)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeysOptimized(NioEventLoop.java:724)\n\tat io.netty.channel.nio.NioEventLoop.processSelectedKeys(NioEventLoop.java:650)\n</code></pre></div>",
                "resourcePath": "/apache/pulsar/issues/22428",
                "createdAt": "2024-04-04T14:36:22Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/flaky-tests"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] Fix concurrent containers concurrency issue",
        "url": "https://github.com/apache/pulsar/pull/22604",
        "resourcePath": "/apache/pulsar/pull/22604",
        "createdAt": "2024-04-27T03:16:49Z",
        "number": 22604,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentLongHashMap.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentLongLongPairHashMap.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentLongPairSet.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentOpenHashMap.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-common/src/main/java/org/apache/pulsar/common/util/collections/ConcurrentOpenHashSet.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5t5WQK2gAoM2EyYzI0YTQ1NWZlMjIyMjQ4YjQzNDFiOTM0MDM0M2ViYjcwMWEyNA",
                "url": "https://github.com/apache/pulsar/pull/22604/commits/3a2c24a455fe222248b4341b9340343ebb701a24"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22603,
                "url": "https://github.com/apache/pulsar/issues/22603",
                "title": "[Bug] Pulsar concurrent containers has concurrency issues",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">master branch</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">This issue introduced by <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1154358327\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/pulsar/issues/14497\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/pulsar/pull/14497/hovercard\" href=\"https://github.com/apache/pulsar/pull/14497\">#14497</a><br>\nSee: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2266654252\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/bookkeeper/issues/4318\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/bookkeeper/issues/4318/hovercard\" href=\"https://github.com/apache/bookkeeper/issues/4318\">apache/bookkeeper#4318</a></p>\n<p dir=\"auto\"><code class=\"notranslate\">ConcurrentLongHashMap</code>, <code class=\"notranslate\">ConcurrentLongLongPairHashMap</code>, <code class=\"notranslate\">ConcurrentLongPairSet</code>, <code class=\"notranslate\">ConcurrentOpenHashMap</code>, <code class=\"notranslate\">ConcurrentOpenHashSet</code> under <code class=\"notranslate\">org.apache.pulsar.common.util.collections</code> package are involved.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">NONE</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">NONE</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22603",
                "createdAt": "2024-04-27T01:43:25Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix] [client] Fix Consumer should return configured batch receive max messages",
        "url": "https://github.com/apache/pulsar/pull/22619",
        "resourcePath": "/apache/pulsar/pull/22619",
        "createdAt": "2024-04-30T03:57:15Z",
        "number": 22619,
        "mergeCommit": {
          "oid": "0219921b5b7cd157092ac8f2d86ab7e60787d36c",
          "message": "[fix] [client] Fix Consumer should return configured batch receive max messages (#22619)",
          "commitUrl": "https://github.com/apache/pulsar/commit/0219921b5b7cd157092ac8f2d86ab7e60787d36c",
          "parents": {
            "nodes": [
              {
                "oid": "41f633f81e53bfc35ad37bb13e62def5c0dcb11d",
                "message": "[fix][misc] NPE during standalone shutdown (#22636)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/ConsumerBatchReceiveTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/api/SimpleProducerConsumerTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ConsumerBuilderImpl.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5uFvuN2gAoZDUzN2VhYzMyNTc3MGRmMTJlZGUxODU4MWI4ZjdhM2JkODc0NTY5OQ",
                "url": "https://github.com/apache/pulsar/pull/22619/commits/d537eac325770df12ede18581b8f7a3bd8745699"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22618,
                "url": "https://github.com/apache/pulsar/issues/22618",
                "title": "[Bug] Consumer doesn't consider batch max number of messages configuration and return less number of messages",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">any version</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<ol dir=\"auto\">\n<li>Create consumer with <code class=\"notranslate\">BatchReceivePolicy</code> with <code class=\"notranslate\">maxNumMessages=2000</code> and higher <code class=\"notranslate\">maxNumBytes</code> and <code class=\"notranslate\">timeout</code> config values.</li>\n<li>Producer publishes &gt; 2000 messages but still consumer <code class=\"notranslate\">batchReceive</code>  always return 1000 messages even if consumer application wants to consume based on given configuration.</li>\n</ol>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Consumer applications should expect a number of batch messages based on the batch-receive policy regardless of tuning other configurations as users are not aware of any internal implementation of the Pulsar client lib.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Consumer application always sees less number of batch messages than the configured batch policy.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22618",
                "createdAt": "2024-04-30T03:44:21Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][storage] ReadonlyManagedLedger initialization does not fill in the properties",
        "url": "https://github.com/apache/pulsar/pull/22630",
        "resourcePath": "/apache/pulsar/pull/22630",
        "createdAt": "2024-05-01T15:47:31Z",
        "number": 22630,
        "mergeCommit": {
          "oid": "eee3694f00e269eef0f75d791521d0d35d8ff411",
          "message": "[fix][storage] ReadonlyManagedLedger initialization does not fill in the properties (#22630)",
          "commitUrl": "https://github.com/apache/pulsar/commit/eee3694f00e269eef0f75d791521d0d35d8ff411",
          "parents": {
            "nodes": [
              {
                "oid": "2821afad7a1fff056e4f04f71934dcd8c01fbcb1",
                "message": "[improve][build] Upgrade OTel library versions (#22649)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "managed-ledger/src/main/java/org/apache/bookkeeper/mledger/impl/ReadOnlyManagedLedgerImpl.java"
              }
            },
            {
              "node": {
                "changeType": "ADDED",
                "path": "managed-ledger/src/test/java/org/apache/bookkeeper/mledger/impl/ReadOnlyManagedLedgerImplTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5uQ0rT2gAoMWRjMGNhMGQ3YzM5Nzc2YWRiYjYzYTM1M2QwZjE4MDM5ZTFjNzA0OA",
                "url": "https://github.com/apache/pulsar/pull/22630/commits/1dc0ca0d7c39776adbb63a353d0f18039e1c7048"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22606,
                "url": "https://github.com/apache/pulsar/issues/22606",
                "title": "[Bug] ReadonlyManagedLedger initialization does not fill in the properties",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">OS:MacOS 14.4.1 (23E224),JDK:jdk17, pulsar: branch-3.0</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Setting properties in managedLedger cannot be read using readOnlyManagedLedger</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">ReadonlyManagedLedger initialization  fill in the properties</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Setting properties in managedLedger cannot be read using readOnlyManagedLedger</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22606",
                "createdAt": "2024-04-27T13:18:28Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][sec] Upgrade aws-sdk.version to avoid CVE-2024-21634",
        "url": "https://github.com/apache/pulsar/pull/22633",
        "resourcePath": "/apache/pulsar/pull/22633",
        "createdAt": "2024-05-02T06:14:35Z",
        "number": 22633,
        "mergeCommit": {
          "oid": "bc44280e88e98fdf0a815fa384a0f52508ca4b8e",
          "message": "[fix][sec] Upgrade aws-sdk.version to avoid CVE-2024-21634 (#22633)",
          "commitUrl": "https://github.com/apache/pulsar/commit/bc44280e88e98fdf0a815fa384a0f52508ca4b8e",
          "parents": {
            "nodes": [
              {
                "oid": "6f75569f960e82a4ccb4b95a3297727eb311865f",
                "message": "[improve][cli] PIP-343: Refactor pulsar-perf to subcommand (#22388)\n\nCo-authored-by: Zixuan Liu <nodeces@gmail.com>"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5uUH6O2gAoMDIwNDk0NGJiZjlkNTI1NWQ2NDczN2NmYjk5NGRiZDhmMjU5NTFjYQ",
                "url": "https://github.com/apache/pulsar/pull/22633/commits/0204944bbf9d5255d64737cfb994dbd8f25951ca"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22632,
                "url": "https://github.com/apache/pulsar/issues/22632",
                "title": "[Bug] Amazon Ion-Java has a vulnerability CVE-2024-21634",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Version - 3.3.0-SNAPSHOT<br>\nBranch - master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Ran security scan on pulsar-io-kinesis connector<br>\n<a href=\"https://security.snyk.io/vuln/SNYK-JAVA-SOFTWAREAMAZONION-6153869\" rel=\"nofollow\">https://security.snyk.io/vuln/SNYK-JAVA-SOFTWAREAMAZONION-6153869</a></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">No Vulnerabilities</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Found a High Vulnerability on software.amazon.ion:ion-java version 1.0.2<br>\n<a href=\"https://nvd.nist.gov/vuln/detail/CVE-2024-21634\" rel=\"nofollow\">CVE-2024-21634</a><br>\nGithub Advisory link - <a title=\"GHSA-264p-99wq-f4j6\" data-hovercard-type=\"advisory\" data-hovercard-url=\"/advisories/GHSA-264p-99wq-f4j6/hovercard\" href=\"https://github.com/advisories/GHSA-264p-99wq-f4j6\">GHSA-264p-99wq-f4j6</a>)</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">Pulsar doesn't have a direct dependency on Ion-java<br>\nPulsar has a dependency on aws-java-sdk-core</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&lt;groupId&gt;com.amazonaws&lt;/groupId&gt;\n&lt;artifactId&gt;aws-java-sdk-core&lt;/artifactId&gt;\n&lt;version&gt;1.12.262&lt;/version&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">&lt;groupId&gt;com.amazonaws&lt;/groupId&gt;\n&lt;artifactId&gt;aws-java-sdk-core&lt;/artifactId&gt;\n&lt;version&gt;1.12.262&lt;/version&gt;\n</code></pre></div>\n<p dir=\"auto\">Which in-turn has a dependency on ion-java</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&lt;groupId&gt;software.amazon.ion&lt;/groupId&gt;\n&lt;artifactId&gt;ion-java&lt;/artifactId&gt;\n&lt;version&gt;1.0.2&lt;/version&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">&lt;groupId&gt;software.amazon.ion&lt;/groupId&gt;\n&lt;artifactId&gt;ion-java&lt;/artifactId&gt;\n&lt;version&gt;1.0.2&lt;/version&gt;\n</code></pre></div>\n<p dir=\"auto\">The patch is for ion-java included in 1.10.5 version as mentioned <a href=\"https://github.com/amazon-ion/ion-java/issues/695#issuecomment-1889741797\" data-hovercard-type=\"issue\" data-hovercard-url=\"/amazon-ion/ion-java/issues/695/hovercard\">here</a></p>\n<p dir=\"auto\">The domain name has changed from <code class=\"notranslate\">software.amazon.ion</code> to <code class=\"notranslate\">com.amazon.ion</code><br>\n<a href=\"https://mvnrepository.com/artifact/com.amazon.ion/ion-java/1.10.5\" rel=\"nofollow\">https://mvnrepository.com/artifact/com.amazon.ion/ion-java/1.10.5</a></p>\n<p dir=\"auto\">Aws-sdk-java-core has dropped the ion dependency in <a href=\"https://github.com/aws/aws-sdk-java/issues/3077#issuecomment-1896650670\" data-hovercard-type=\"issue\" data-hovercard-url=\"/aws/aws-sdk-java/issues/3077/hovercard\">v1.12.638</a></p>\n<p dir=\"auto\">The fix would be to update the aws-sdk-java-core version to <code class=\"notranslate\">&lt;version&gt;1.12.638&lt;/version&gt;</code> in pulsar</p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22632",
                "createdAt": "2024-05-02T05:09:45Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][sec] Upgrade postgresql version to avoid CVE-2024-1597",
        "url": "https://github.com/apache/pulsar/pull/22635",
        "resourcePath": "/apache/pulsar/pull/22635",
        "createdAt": "2024-05-02T13:39:15Z",
        "number": 22635,
        "mergeCommit": null,
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5uXH3O2gAoMjZhYzQ0NzU5M2I1Y2E3OWVjNTgxODE4N2Q2MzY2OWIwNGE0NzQ4Ng",
                "url": "https://github.com/apache/pulsar/pull/22635/commits/26ac447593b5ca79ec5818187d63669b04a47486"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22625,
                "url": "https://github.com/apache/pulsar/issues/22625",
                "title": "[Bug] Postgresql has a vulnerability CVE-2024-1597",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Version - <code class=\"notranslate\">3.3.0-SNAPSHOT</code><br>\nBranch - <code class=\"notranslate\">master</code></p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Ran owasp-dependency-check</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">No Vulnerabilities</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[ERROR] postgresql-42.5.0.jar: CVE-2024-1597(9.8)\n[ERROR] postgresql-42.5.1.jar: CVE-2024-1597(9.8)\"><pre class=\"notranslate\"><code class=\"notranslate\">[ERROR] postgresql-42.5.0.jar: CVE-2024-1597(9.8)\n[ERROR] postgresql-42.5.1.jar: CVE-2024-1597(9.8)\n</code></pre></div>\n<p dir=\"auto\">Found a <strong>Critical</strong> Vulnerability on org.postgresql:postgresql version 42.5.1 (used for jdbc connector) &amp; 42.5.0 (used for debezium connector)<br>\n<a href=\"https://nvd.nist.gov/vuln/detail/CVE-2024-1597\" rel=\"nofollow\">CVE-2024-1597</a><br>\nGithub Advisory link - <a title=\"GHSA-24rp-q3w6-vc56\" data-hovercard-type=\"advisory\" data-hovercard-url=\"/advisories/GHSA-24rp-q3w6-vc56/hovercard\" href=\"https://github.com/advisories/GHSA-24rp-q3w6-vc56\">GHSA-24rp-q3w6-vc56</a></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22625",
                "createdAt": "2024-05-01T07:06:29Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][client] Fix ReaderBuilder doest not give illegalArgument on connection failure retry",
        "url": "https://github.com/apache/pulsar/pull/22639",
        "resourcePath": "/apache/pulsar/pull/22639",
        "createdAt": "2024-05-02T23:17:06Z",
        "number": 22639,
        "mergeCommit": null,
        "potentialMergeCommit": {
          "oid": "deae9781b9a76f5725abe24d660ac45e3c0dad3b",
          "message": "Merge 989c58f06b119560857dc9dcf0b0649e9d000cc1 into eee3694f00e269eef0f75d791521d0d35d8ff411",
          "commitUrl": "https://github.com/apache/pulsar/commit/deae9781b9a76f5725abe24d660ac45e3c0dad3b",
          "parents": {
            "nodes": [
              {
                "oid": "eee3694f00e269eef0f75d791521d0d35d8ff411",
                "message": "[fix][storage] ReadonlyManagedLedger initialization does not fill in the properties (#22630)"
              },
              {
                "oid": "989c58f06b119560857dc9dcf0b0649e9d000cc1",
                "message": "fix format"
              }
            ]
          }
        },
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-broker/src/test/java/org/apache/pulsar/client/impl/ReaderTest.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/main/java/org/apache/pulsar/client/impl/ReaderBuilderImpl.java"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-client/src/test/java/org/apache/pulsar/client/impl/BuildersTest.java"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ua2742gAoOTg5YzU4ZjA2YjExOTU2MDg1N2RjOWRjZjBiMDY0OWU5ZDAwMGNjMQ",
                "url": "https://github.com/apache/pulsar/pull/22639/commits/989c58f06b119560857dc9dcf0b0649e9d000cc1"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22638,
                "url": "https://github.com/apache/pulsar/issues/22638",
                "title": "[Bug] ReaderBuilder changes config state during reader creation failure due to server connection failure",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">any client version</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"@Test\npublic void createAsyncChangeStateIssue() throws Exception {\n\n ClientBuilder clientBuilder = PulsarClient.builder();\n clientBuilder.serviceUrl(&quot;pulsar://badUrl&quot;);\n PulsarClient client = clientBuilder.build();\n ReaderBuilder&lt;byte[]&gt; readerBuilder = client.newReader()\n   .topic(&quot;persistent://tenant/ns1/t1&quot;).startMessageFromRollbackDuration(100, TimeUnit.SECONDS);\n try {\n  readerBuilder.createAsync().get(1, TimeUnit.SECONDS);\n } catch (TimeoutException e) {\n  log.info(&quot;Got expected timeout exception exception, retrying&quot;);\n  // The retry results in an IllegalArgumentException with message:\n  //   Start message id or start message from roll back must be specified\n  //   but they cannot be specified at the same time\n  readerBuilder.createAsync().get(1, TimeUnit.SECONDS);\n }\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">@Test\npublic void createAsyncChangeStateIssue() throws Exception {\n\n ClientBuilder clientBuilder = PulsarClient.builder();\n clientBuilder.serviceUrl(\"pulsar://badUrl\");\n PulsarClient client = clientBuilder.build();\n ReaderBuilder&lt;byte[]&gt; readerBuilder = client.newReader()\n   .topic(\"persistent://tenant/ns1/t1\").startMessageFromRollbackDuration(100, TimeUnit.SECONDS);\n try {\n  readerBuilder.createAsync().get(1, TimeUnit.SECONDS);\n } catch (TimeoutException e) {\n  log.info(\"Got expected timeout exception exception, retrying\");\n  // The retry results in an IllegalArgumentException with message:\n  //   Start message id or start message from roll back must be specified\n  //   but they cannot be specified at the same time\n  readerBuilder.createAsync().get(1, TimeUnit.SECONDS);\n }\n}\n</code></pre></div>\n<p dir=\"auto\">Output:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java.util.concurrent.ExecutionException: java.lang.IllegalArgumentException: Start message id or start message from roll back must be specified but they cannot be specified at the same time\n\tat java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:396)\n\tat java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2096)\nCaused by: java.lang.IllegalArgumentException: Start message id or start message from roll back must be specified but they cannot be specified at the same time\n\tat org.apache.pulsar.client.impl.ReaderBuilderImpl.createAsync(ReaderBuilderImpl.java:93)\"><pre class=\"notranslate\"><code class=\"notranslate\">java.util.concurrent.ExecutionException: java.lang.IllegalArgumentException: Start message id or start message from roll back must be specified but they cannot be specified at the same time\n\tat java.base/java.util.concurrent.CompletableFuture.reportGet(CompletableFuture.java:396)\n\tat java.base/java.util.concurrent.CompletableFuture.get(CompletableFuture.java:2096)\nCaused by: java.lang.IllegalArgumentException: Start message id or start message from roll back must be specified but they cannot be specified at the same time\n\tat org.apache.pulsar.client.impl.ReaderBuilderImpl.createAsync(ReaderBuilderImpl.java:93)\n</code></pre></div>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">By any chance if ReaderBuilder fails to create Reader due to connection issue and if application retries then it should not receive <code class=\"notranslate\">java.lang.IllegalArgumentException</code> because there is no such argument was given to ReaderImpl Builder. Instead Builder should not corrupt the arguments and create Reader to avoid creating lot of objects in memory and avoid memory pressure creation.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Client gives <code class=\"notranslate\">java.lang.IllegalArgumentException</code> even though there is no such illegal argument into the Reader Builder.</p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22638",
                "createdAt": "2024-05-02T23:10:49Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][sec] Upgrade elasticsearch-java version to avoid CVE-2023-4043",
        "url": "https://github.com/apache/pulsar/pull/22640",
        "resourcePath": "/apache/pulsar/pull/22640",
        "createdAt": "2024-05-03T06:51:14Z",
        "number": 22640,
        "mergeCommit": {
          "oid": "3ca4ddfc8fecab633b473e48e1a6f78adcfbd4df",
          "message": "[fix][sec] Upgrade elasticsearch-java version to avoid CVE-2023-4043 (#22640)",
          "commitUrl": "https://github.com/apache/pulsar/commit/3ca4ddfc8fecab633b473e48e1a6f78adcfbd4df",
          "parents": {
            "nodes": [
              {
                "oid": "4a5953640fd93f8ecac39c7713851ac4c1ab902b",
                "message": "[fix][sec] Upgrade Debezium oracle connector version to avoid CVE-2023-4586 (#22641)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ucKFl2gAoY2JjMTRhOTc5ZmJlYjE3NGI4NjUxY2ZiZDlmY2M1ZjQxZTExY2Q1Mw",
                "url": "https://github.com/apache/pulsar/pull/22640/commits/cbc14a979fbeb174b8651cfbd9fcc5f41e11cd53"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 21783,
                "url": "https://github.com/apache/pulsar/issues/21783",
                "title": "[Bug] Eclipse Parsson has a vulnerability CVE-2023-4043",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">For pulsar version: <code class=\"notranslate\">3.1.2</code> on branch: <code class=\"notranslate\">branch-3.1</code> facing moderate vulnerability <a href=\"https://github.com/advisories/GHSA-g8p6-p27c-52fx\">CVE-2023-4043</a>, related to packages:</p>\n<ul dir=\"auto\">\n<li>org.eclipse.parsson:project</li>\n</ul>\n<p dir=\"auto\">Maven Dependency</p>\n<ul dir=\"auto\">\n<li>pulsar - org.apache.pulsar 3.1.2</li>\n<li>org.eclipse.parsson:parsson@1.0.0</li>\n</ul>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Run Pulsar CI workflow on pulsar branch - <code class=\"notranslate\">branch-3.1</code></p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">Expected to pass the <code class=\"notranslate\">OWASP dependency check</code> under <code class=\"notranslate\">Pulsar CI</code> workflow.</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Vulnerability</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\" Error:  Failed to execute goal org.owasp:dependency-check-maven:8.2.1:aggregate (default) on project pulsar: \n Error:  \n Error:  One or more dependencies were identified with vulnerabilities that have a CVSS score greater than or equal to '7.0': \n Error:  \n Error:  parsson-1.0.0.jar: CVE-2023-4043(7.5)\"><pre class=\"notranslate\"><code class=\"notranslate\"> Error:  Failed to execute goal org.owasp:dependency-check-maven:8.2.1:aggregate (default) on project pulsar: \n Error:  \n Error:  One or more dependencies were identified with vulnerabilities that have a CVSS score greater than or equal to '7.0': \n Error:  \n Error:  parsson-1.0.0.jar: CVE-2023-4043(7.5)\n</code></pre></div>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/21783",
                "createdAt": "2023-12-21T13:36:11Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  },
  {
    "repository": {
      "pullRequest": {
        "title": "[fix][sec] Upgrade Debezium oracle connector version to avoid CVE-2023-4586",
        "url": "https://github.com/apache/pulsar/pull/22641",
        "resourcePath": "/apache/pulsar/pull/22641",
        "createdAt": "2024-05-03T07:01:51Z",
        "number": 22641,
        "mergeCommit": {
          "oid": "4a5953640fd93f8ecac39c7713851ac4c1ab902b",
          "message": "[fix][sec] Upgrade Debezium oracle connector version to avoid CVE-2023-4586 (#22641)",
          "commitUrl": "https://github.com/apache/pulsar/commit/4a5953640fd93f8ecac39c7713851ac4c1ab902b",
          "parents": {
            "nodes": [
              {
                "oid": "7a8c4549639d67182049bca9f714c0f4b3061236",
                "message": "[improve][broker] Add logging to leader election (#22645)"
              }
            ]
          }
        },
        "potentialMergeCommit": null,
        "files": {
          "edges": [
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pom.xml"
              }
            },
            {
              "node": {
                "changeType": "MODIFIED",
                "path": "pulsar-io/debezium/oracle/pom.xml"
              }
            }
          ]
        },
        "commits": {
          "edges": [
            {
              "node": {
                "id": "PURC_lADOA7PXtM5ucNRQ2gAoYjAwYTYwZGQ1ZWNhMzUyNTMzYjA4MTNjY2I0MTdlMmEyNmU2M2M0MQ",
                "url": "https://github.com/apache/pulsar/pull/22641/commits/b00a60dd5eca352533b0813ccb417e2a26e63c41"
              }
            }
          ]
        },
        "closingIssuesReferences": {
          "edges": [
            {
              "node": {
                "number": 22626,
                "url": "https://github.com/apache/pulsar/issues/22626",
                "title": "[Bug] Infinispan Client Hotrod has a vulnerability CVE-2023-4586",
                "bodyHTML": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/apache/pulsar/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Read release policy</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I understand that unsupported versions don't get bug fixes. I will attempt to reproduce the issue on a supported version of Pulsar client and Pulsar broker.</li>\n</ul>\n<h3 dir=\"auto\">Version</h3>\n<p dir=\"auto\">Version - 3.3.0-SNAPSHOT<br>\nBranch - master</p>\n<h3 dir=\"auto\">Minimal reproduce step</h3>\n<p dir=\"auto\">Found vulnerability online.</p>\n<h3 dir=\"auto\">What did you expect to see?</h3>\n<p dir=\"auto\">No Vulnerabilites</p>\n<h3 dir=\"auto\">What did you see instead?</h3>\n<p dir=\"auto\">Found a High Vulnerability on org.infinispan:infinispan-client-hotrod version 12.1.6.Final<br>\n<a href=\"https://nvd.nist.gov/vuln/detail/CVE-2023-4586\" rel=\"nofollow\">CVE-2023-4586</a></p>\n<h3 dir=\"auto\">Anything else?</h3>\n<p dir=\"auto\">Pulsar doesn't have a direct dependency on Infinispan-client-hotrod.<br>\nPulsar has a dependency on debezium-oracle connector</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&lt;groupId&gt;io.debezium&lt;/groupId&gt;\n&lt;artifactId&gt;debezium-connector-oracle&lt;/artifactId&gt;\n&lt;version&gt;1.9.7.Final&lt;/version&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">&lt;groupId&gt;io.debezium&lt;/groupId&gt;\n&lt;artifactId&gt;debezium-connector-oracle&lt;/artifactId&gt;\n&lt;version&gt;1.9.7.Final&lt;/version&gt;\n</code></pre></div>\n<p dir=\"auto\">Which in-turn has a dependency on <a href=\"mailto:infinispan-client-hotrod@12.1.6.Final\">infinispan-client-hotrod@12.1.6.Final</a></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"&lt;groupId&gt;org.infinispan&lt;/groupId&gt;\n&lt;artifactId&gt;infinispan-client-hotrod&lt;/artifactId&gt;\n&lt;version&gt;12.1.6.Final&lt;/version&gt;\"><pre class=\"notranslate\"><code class=\"notranslate\">&lt;groupId&gt;org.infinispan&lt;/groupId&gt;\n&lt;artifactId&gt;infinispan-client-hotrod&lt;/artifactId&gt;\n&lt;version&gt;12.1.6.Final&lt;/version&gt;\n</code></pre></div>\n<h3 dir=\"auto\">Are you willing to submit a PR?</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> I'm willing to submit a PR!</li>\n</ul>",
                "resourcePath": "/apache/pulsar/issues/22626",
                "createdAt": "2024-05-01T08:20:11Z",
                "labels": {
                  "edges": [
                    {
                      "node": {
                        "name": "type/bug"
                      }
                    }
                  ]
                }
              }
            }
          ]
        }
      }
    }
  }
]