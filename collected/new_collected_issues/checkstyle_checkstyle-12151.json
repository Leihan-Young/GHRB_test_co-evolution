{
  "issue_id": 11939,
  "issue_url": "https://github.com/checkstyle/checkstyle/issues/11939",
  "title": "New filter: SuppressWithNearbyTextFilter to suppress checks with inline comments in any file type",
  "description": "<p dir=\"auto\">From <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1299993572\" data-permission-text=\"Title is private\" data-url=\"https://github.com/checkstyle/checkstyle/issues/11884\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/checkstyle/checkstyle/pull/11884/hovercard\" href=\"https://github.com/checkstyle/checkstyle/pull/11884\">#11884</a></p>\n<h2 dir=\"auto\">Description</h2>\n<p dir=\"auto\">The filter should work exactly like <a href=\"https://checkstyle.sourceforge.io/config_filters.html#SuppressWithNearbyCommentFilter\" rel=\"nofollow\">SuppressWithNearbyCommentFilter</a>. The only difference is that it should be able to filter different file types(i.e. have <code class=\"notranslate\">Checker</code> as parent module instead of <code class=\"notranslate\">TreeWalker</code>) - <code class=\"notranslate\">java</code>, <code class=\"notranslate\">xml</code>, <code class=\"notranslate\">js</code>, <code class=\"notranslate\">properties</code>, <code class=\"notranslate\">sql</code>, etc. It shoud have the following properties:</p>\n<table role=\"table\">\n<thead>\n<tr>\n<th>Name</th>\n<th>Description</th>\n<th>Default value</th>\n</tr>\n</thead>\n<tbody>\n<tr>\n<td><code class=\"notranslate\">commentFormat</code></td>\n<td>Specify comment pattern to trigger filter to begin suppression.</td>\n<td>\"SUPPRESS CHECKSTYLE (\\w+)\"</td>\n</tr>\n<tr>\n<td><code class=\"notranslate\">checkFormat</code></td>\n<td>Specify check pattern to suppress.</td>\n<td>\".*\"</td>\n</tr>\n<tr>\n<td><code class=\"notranslate\">messageFormat</code></td>\n<td>Define message pattern to suppress.</td>\n<td>null</td>\n</tr>\n<tr>\n<td><code class=\"notranslate\">idFormat</code></td>\n<td>Specify check ID pattern to suppress.</td>\n<td>null</td>\n</tr>\n<tr>\n<td><code class=\"notranslate\">influenceFormat</code></td>\n<td>Specify negative/zero/positive value that defines the number of lines preceding/at/following the suppression comment.</td>\n<td>\"0\"</td>\n</tr>\n</tbody>\n</table>\n<h2 dir=\"auto\">How it should work</h2>\n<p dir=\"auto\">This is just an example config with 3 files to show what is expected. Configuration of properties should be the same as the above mentioned filter. Their behaviour is well-documented there.</p>\n<h3 dir=\"auto\">Config</h3>\n<div class=\"highlight highlight-text-xml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"<?xml version=\"1.0\"?>\n<!DOCTYPE module PUBLIC\n          \"-//Puppy Crawl//DTD Check Configuration 1.3//EN\"\n          \"https://checkstyle.org/dtds/configuration_1_3.dtd\">\n\n<module name=\"Checker\">\n    <property name=\"charset\" value=\"UTF-8\"/>\n\t\n    <module name=\"NewFilter\"/>\n\t\n    <module name=\"LineLength\">\n         <property name=\"max\" value=\"2\"/>\n    </module>\n</module>\"><pre class=\"notranslate\"><?<span class=\"pl-ent\">xml</span><span class=\"pl-e\"> version</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>1.0<span class=\"pl-pds\">\"</span></span>?>\n<!<span class=\"pl-ent\">DOCTYPE</span> <span class=\"pl-e\">module</span> PUBLIC\n          \"-//Puppy Crawl//DTD Check Configuration 1.3//EN\"\n          \"https://checkstyle.org/dtds/configuration_1_3.dtd\">\n\n<<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Checker<span class=\"pl-pds\">\"</span></span>>\n    <<span class=\"pl-ent\">property</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>charset<span class=\"pl-pds\">\"</span></span> <span class=\"pl-e\">value</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>UTF-8<span class=\"pl-pds\">\"</span></span>/>\n\t\n    <<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>NewFilter<span class=\"pl-pds\">\"</span></span>/>\n\t\n    <<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>LineLength<span class=\"pl-pds\">\"</span></span>>\n         <<span class=\"pl-ent\">property</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>max<span class=\"pl-pds\">\"</span></span> <span class=\"pl-e\">value</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>2<span class=\"pl-pds\">\"</span></span>/>\n    </<span class=\"pl-ent\">module</span>>\n</<span class=\"pl-ent\">module</span>></pre></div>\n<h3 dir=\"auto\">XML</h3>\n<div class=\"highlight highlight-text-xml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"<something/> <!-- SUPPRESS CHECKSTYLE LineLengthCheck --> // ok\n<somethingelse/> // violation\"><pre class=\"notranslate\"><<span class=\"pl-ent\">something</span>/> <span class=\"pl-c\"><span class=\"pl-c\"><!--</span> SUPPRESS CHECKSTYLE LineLengthCheck <span class=\"pl-c\">--></span></span> // ok\n<<span class=\"pl-ent\">somethingelse</span>/> // violation</pre></div>\n<h4 dir=\"auto\">Expected output</h4>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ java -jar checkstyle-all.jar -c config.xml file.xml\n[ERROR] file.xml:3:0: Line is longer than 2 characters (found 16). [LineLength]\"><pre class=\"notranslate\">$ java -jar checkstyle-all.jar -c config.xml file.xml\n[ERROR] file.xml:3:0: Line is longer than 2 characters (found 16). [LineLength]</pre></div>\n<h3 dir=\"auto\">SQL</h3>\n<div class=\"highlight highlight-source-sql notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"SELECT COUNT(1) FROM filters; -- SUPPRESS CHECKSTYLE LineLengthCheck // ok\nSELECT COUNT(1) FROM checks; // violation\"><pre class=\"notranslate\"><span class=\"pl-k\">SELECT</span> <span class=\"pl-c1\">COUNT</span>(<span class=\"pl-c1\">1</span>) <span class=\"pl-k\">FROM</span> filters; <span class=\"pl-c\"><span class=\"pl-c\">--</span> SUPPRESS CHECKSTYLE LineLengthCheck // ok</span>\n<span class=\"pl-k\">SELECT</span> <span class=\"pl-c1\">COUNT</span>(<span class=\"pl-c1\">1</span>) <span class=\"pl-k\">FROM</span> checks; <span class=\"pl-k\">//</span> violation</pre></div>\n<h4 dir=\"auto\">Expected output</h4>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ java -jar checkstyle-all.jar -c config.xml file.sql\n[ERROR] file.sql:2:0: Line is longer than 2 characters (found 28). [LineLength]\"><pre class=\"notranslate\">$ java -jar checkstyle-all.jar -c config.xml file.sql\n[ERROR] file.sql:2:0: Line is longer than 2 characters (found 28). [LineLength]</pre></div>\n<h3 dir=\"auto\">Java</h3>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"int a = 5; // SUPPRESS CHECKSTYLE LineLengthCheck // ok\nint b = 3; // violation\"><pre class=\"notranslate\"><span class=\"pl-smi\">int</span> <span class=\"pl-s1\">a</span> = <span class=\"pl-c1\">5</span>; <span class=\"pl-c\">// SUPPRESS CHECKSTYLE LineLengthCheck // ok</span>\n<span class=\"pl-smi\">int</span> <span class=\"pl-s1\">b</span> = <span class=\"pl-c1\">3</span>; <span class=\"pl-c\">// violation</span></pre></div>\n<h4 dir=\"auto\">Expected output</h4>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"$ java -jar checkstyle-all.jar -c config.xml file.java\n[ERROR] file.java:2:0: Line is longer than 2 characters (found 10). [LineLength]\"><pre class=\"notranslate\">$ java -jar checkstyle-all.jar -c config.xml file.java\n[ERROR] file.java:2:0: Line is longer than 2 characters (found 10). [LineLength]</pre></div>\n<hr>\n<h3 dir=\"auto\">Config with <code class=\"notranslate\">influenceFormat</code></h3>\n<div class=\"highlight highlight-text-xml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"<?xml version=\"1.0\"?>\n<!DOCTYPE module PUBLIC\n          \"-//Puppy Crawl//DTD Check Configuration 1.3//EN\"\n          \"https://checkstyle.org/dtds/configuration_1_3.dtd\">\n\n<module name=\"Checker\">\n    <property name=\"charset\" value=\"UTF-8\"/>\n\t\n    <module name=\"NewFilter\">\n        <property name=\"influenceFormat\" value=\"2\"/>\n    </module>\n\n\t\n    <module name=\"LineLength\">\n        <property name=\"max\" value=\"2\"/>\n    </module>\n</module>\"><pre class=\"notranslate\"><?<span class=\"pl-ent\">xml</span><span class=\"pl-e\"> version</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>1.0<span class=\"pl-pds\">\"</span></span>?>\n<!<span class=\"pl-ent\">DOCTYPE</span> <span class=\"pl-e\">module</span> PUBLIC\n          \"-//Puppy Crawl//DTD Check Configuration 1.3//EN\"\n          \"https://checkstyle.org/dtds/configuration_1_3.dtd\">\n\n<<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Checker<span class=\"pl-pds\">\"</span></span>>\n    <<span class=\"pl-ent\">property</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>charset<span class=\"pl-pds\">\"</span></span> <span class=\"pl-e\">value</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>UTF-8<span class=\"pl-pds\">\"</span></span>/>\n\t\n    <<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>NewFilter<span class=\"pl-pds\">\"</span></span>>\n        <<span class=\"pl-ent\">property</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>influenceFormat<span class=\"pl-pds\">\"</span></span> <span class=\"pl-e\">value</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>2<span class=\"pl-pds\">\"</span></span>/>\n    </<span class=\"pl-ent\">module</span>>\n\n\t\n    <<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>LineLength<span class=\"pl-pds\">\"</span></span>>\n        <<span class=\"pl-ent\">property</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>max<span class=\"pl-pds\">\"</span></span> <span class=\"pl-e\">value</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>2<span class=\"pl-pds\">\"</span></span>/>\n    </<span class=\"pl-ent\">module</span>>\n</<span class=\"pl-ent\">module</span>></pre></div>\n<h3 dir=\"auto\">XML</h3>\n<div class=\"highlight highlight-text-xml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"<something/> <!-- SUPPRESS CHECKSTYLE LineLengthCheck --> // ok\n<somethingelse/> // ok\n<somethingelse1/> //ok\n<somethingelse2/> // violation\"><pre class=\"notranslate\"><<span class=\"pl-ent\">something</span>/> <span class=\"pl-c\"><span class=\"pl-c\"><!--</span> SUPPRESS CHECKSTYLE LineLengthCheck <span class=\"pl-c\">--></span></span> // ok\n<<span class=\"pl-ent\">somethingelse</span>/> // ok\n<<span class=\"pl-ent\">somethingelse1</span>/> //ok\n<<span class=\"pl-ent\">somethingelse2</span>/> // violation</pre></div>\n<hr>\n<p dir=\"auto\">An aggreement on name needs to be made. For the demo purpose I just called it <code class=\"notranslate\">NewFilter</code>.</p>",
  "description_text": "From #11884\nDescription\nThe filter should work exactly like SuppressWithNearbyCommentFilter. The only difference is that it should be able to filter different file types(i.e. have Checker as parent module instead of TreeWalker) - java, xml, js, properties, sql, etc. It shoud have the following properties:\n\n\n\nName\nDescription\nDefault value\n\n\n\n\ncommentFormat\nSpecify comment pattern to trigger filter to begin suppression.\n\"SUPPRESS CHECKSTYLE (\\w+)\"\n\n\ncheckFormat\nSpecify check pattern to suppress.\n\".*\"\n\n\nmessageFormat\nDefine message pattern to suppress.\nnull\n\n\nidFormat\nSpecify check ID pattern to suppress.\nnull\n\n\ninfluenceFormat\nSpecify negative/zero/positive value that defines the number of lines preceding/at/following the suppression comment.\n\"0\"\n\n\n\nHow it should work\nThis is just an example config with 3 files to show what is expected. Configuration of properties should be the same as the above mentioned filter. Their behaviour is well-documented there.\nConfig\n\n\n\n\n\n\n\n\n\">xml version=\"1.0\"?>\nDOCTYPE module PUBLIC\n          \"-//Puppy Crawl//DTD Check Configuration 1.3//EN\"\n          \"https://checkstyle.org/dtds/configuration_1_3.dtd\">\n\n<module name=\"Checker\">\n    <property name=\"charset\" value=\"UTF-8\"/>\n\t\n    <module name=\"NewFilter\"/>\n\t\n    <module name=\"LineLength\">\n         <property name=\"max\" value=\"2\"/>\n    module>\nmodule>\nXML\n<something/>  // ok\n<somethingelse/> // violation\nExpected output\n$ java -jar checkstyle-all.jar -c config.xml file.xml\n[ERROR] file.xml:3:0: Line is longer than 2 characters (found 16). [LineLength]\nSQL\nSELECT COUNT(1) FROM filters; -- SUPPRESS CHECKSTYLE LineLengthCheck // ok\nSELECT COUNT(1) FROM checks; // violation\nExpected output\n$ java -jar checkstyle-all.jar -c config.xml file.sql\n[ERROR] file.sql:2:0: Line is longer than 2 characters (found 28). [LineLength]\nJava\nint a = 5; // SUPPRESS CHECKSTYLE LineLengthCheck // ok\nint b = 3; // violation\nExpected output\n$ java -jar checkstyle-all.jar -c config.xml file.java\n[ERROR] file.java:2:0: Line is longer than 2 characters (found 10). [LineLength]\n\nConfig with influenceFormat\n\n\n\n\n\n\n\n\n\n\n\">xml version=\"1.0\"?>\nDOCTYPE module PUBLIC\n          \"-//Puppy Crawl//DTD Check Configuration 1.3//EN\"\n          \"https://checkstyle.org/dtds/configuration_1_3.dtd\">\n\n<module name=\"Checker\">\n    <property name=\"charset\" value=\"UTF-8\"/>\n\t\n    <module name=\"NewFilter\">\n        <property name=\"influenceFormat\" value=\"2\"/>\n    module>\n\n\t\n    <module name=\"LineLength\">\n        <property name=\"max\" value=\"2\"/>\n    module>\nmodule>\nXML\n<something/>  // ok\n<somethingelse/> // ok\n<somethingelse1/> //ok\n<somethingelse2/> // violation\n\nAn aggreement on name needs to be made. For the demo purpose I just called it NewFilter."
}