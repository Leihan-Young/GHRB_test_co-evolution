{
  "issue_id": 344,
  "issue_url": "https://github.com/Hakky54/sslcontext-kickstart/issues/344",
  "title": "InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty on Windows",
  "description": "<p dir=\"auto\">Hi <a class=\"user-mention notranslate\" data-hovercard-type=\"user\" data-hovercard-url=\"/users/Hakky54/hovercard\" data-octo-click=\"hovercard-link-click\" data-octo-dimensions=\"link_type:self\" href=\"https://github.com/Hakky54\">@Hakky54</a></p>\n<p dir=\"auto\">With the latest version 8.1.0, our QA pipeline failed on Windows (sorry, I made all my previous tests on Linux) with:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"javax.net.ssl.SSLException: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession.convert(SSLIOSession.java:317)\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession.doWrap(SSLIOSession.java:324)\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession.doHandshake(SSLIOSession.java:367)\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession.access$100(SSLIOSession.java:74)\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession$1.inputReady(SSLIOSession.java:201)\n\tat org.apache.hc.core5.reactor.InternalDataChannel.onIOEvent(InternalDataChannel.java:142)\n\tat org.apache.hc.core5.reactor.InternalChannel.handleIOEvent(InternalChannel.java:51)\n\t... 5 more\nCaused by: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty\n\tat java.base/java.security.cert.PKIXParameters.setTrustAnchors(PKIXParameters.java:200)\n\tat java.base/java.security.cert.PKIXParameters.<init>(PKIXParameters.java:120)\n\tat java.base/java.security.cert.PKIXBuilderParameters.<init>(PKIXBuilderParameters.java:104)\n\tat java.base/sun.security.validator.PKIXValidator.<init>(PKIXValidator.java:99)\n\tat java.base/sun.security.validator.Validator.getInstance(Validator.java:181)\n\tat java.base/sun.security.ssl.X509TrustManagerImpl.getValidator(X509TrustManagerImpl.java:300)\n\tat java.base/sun.security.ssl.X509TrustManagerImpl.checkTrustedInit(X509TrustManagerImpl.java:176)\n\tat java.base/sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:246)\n\tat java.base/sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:141)\n\tat nl.altindag.ssl.trustmanager.CompositeX509ExtendedTrustManager.lambda$checkServerTrusted$5(CompositeX509ExtendedTrustManager.java:91)\n\tat nl.altindag.ssl.trustmanager.CombinableX509TrustManager.checkTrusted(CombinableX509TrustManager.java:40)\n\tat nl.altindag.ssl.trustmanager.CompositeX509ExtendedTrustManager.checkServerTrusted(CompositeX509ExtendedTrustManager.java:91)\n\tat java.base/sun.security.ssl.CertificateMessage$T13CertificateConsumer.checkServerCerts(CertificateMessage.java:1335)\"><pre class=\"notranslate\"><code class=\"notranslate\">javax.net.ssl.SSLException: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession.convert(SSLIOSession.java:317)\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession.doWrap(SSLIOSession.java:324)\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession.doHandshake(SSLIOSession.java:367)\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession.access$100(SSLIOSession.java:74)\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession$1.inputReady(SSLIOSession.java:201)\n\tat org.apache.hc.core5.reactor.InternalDataChannel.onIOEvent(InternalDataChannel.java:142)\n\tat org.apache.hc.core5.reactor.InternalChannel.handleIOEvent(InternalChannel.java:51)\n\t... 5 more\nCaused by: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty\n\tat java.base/java.security.cert.PKIXParameters.setTrustAnchors(PKIXParameters.java:200)\n\tat java.base/java.security.cert.PKIXParameters.<init>(PKIXParameters.java:120)\n\tat java.base/java.security.cert.PKIXBuilderParameters.<init>(PKIXBuilderParameters.java:104)\n\tat java.base/sun.security.validator.PKIXValidator.<init>(PKIXValidator.java:99)\n\tat java.base/sun.security.validator.Validator.getInstance(Validator.java:181)\n\tat java.base/sun.security.ssl.X509TrustManagerImpl.getValidator(X509TrustManagerImpl.java:300)\n\tat java.base/sun.security.ssl.X509TrustManagerImpl.checkTrustedInit(X509TrustManagerImpl.java:176)\n\tat java.base/sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:246)\n\tat java.base/sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:141)\n\tat nl.altindag.ssl.trustmanager.CompositeX509ExtendedTrustManager.lambda$checkServerTrusted$5(CompositeX509ExtendedTrustManager.java:91)\n\tat nl.altindag.ssl.trustmanager.CombinableX509TrustManager.checkTrusted(CombinableX509TrustManager.java:40)\n\tat nl.altindag.ssl.trustmanager.CompositeX509ExtendedTrustManager.checkServerTrusted(CompositeX509ExtendedTrustManager.java:91)\n\tat java.base/sun.security.ssl.CertificateMessage$T13CertificateConsumer.checkServerCerts(CertificateMessage.java:1335)\n</code></pre></div>\n<p dir=\"auto\">Not sure what is the problem...</p>\n<p dir=\"auto\">The failing test is here:<br>\n<a href=\"https://github.com/SonarSource/sonarlint-core/blob/130de06eb43f48452138145a05bd4f4647dcdd7d/core/src/test/java/mediumtest/SslMediumTests.java#L110\">https://github.com/SonarSource/sonarlint-core/blob/130de06eb43f48452138145a05bd4f4647dcdd7d/core/src/test/java/mediumtest/SslMediumTests.java#L110</a></p>\n<p dir=\"auto\">And this is how we setup the SSLFactory:<br>\n<a href=\"https://github.com/SonarSource/sonarlint-core/blob/130de06eb43f48452138145a05bd4f4647dcdd7d/http/src/main/java/org/sonarsource/sonarlint/core/http/HttpClientProvider.java#L57\">https://github.com/SonarSource/sonarlint-core/blob/130de06eb43f48452138145a05bd4f4647dcdd7d/http/src/main/java/org/sonarsource/sonarlint/core/http/HttpClientProvider.java#L57</a></p>",
  "description_text": "Hi @Hakky54\nWith the latest version 8.1.0, our QA pipeline failed on Windows (sorry, I made all my previous tests on Linux) with:\njavax.net.ssl.SSLException: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession.convert(SSLIOSession.java:317)\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession.doWrap(SSLIOSession.java:324)\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession.doHandshake(SSLIOSession.java:367)\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession.access$100(SSLIOSession.java:74)\n\tat org.apache.hc.core5.reactor.ssl.SSLIOSession$1.inputReady(SSLIOSession.java:201)\n\tat org.apache.hc.core5.reactor.InternalDataChannel.onIOEvent(InternalDataChannel.java:142)\n\tat org.apache.hc.core5.reactor.InternalChannel.handleIOEvent(InternalChannel.java:51)\n\t... 5 more\nCaused by: java.security.InvalidAlgorithmParameterException: the trustAnchors parameter must be non-empty\n\tat java.base/java.security.cert.PKIXParameters.setTrustAnchors(PKIXParameters.java:200)\n\tat java.base/java.security.cert.PKIXParameters.(PKIXParameters.java:120)\n\tat java.base/java.security.cert.PKIXBuilderParameters.(PKIXBuilderParameters.java:104)\n\tat java.base/sun.security.validator.PKIXValidator.(PKIXValidator.java:99)\n\tat java.base/sun.security.validator.Validator.getInstance(Validator.java:181)\n\tat java.base/sun.security.ssl.X509TrustManagerImpl.getValidator(X509TrustManagerImpl.java:300)\n\tat java.base/sun.security.ssl.X509TrustManagerImpl.checkTrustedInit(X509TrustManagerImpl.java:176)\n\tat java.base/sun.security.ssl.X509TrustManagerImpl.checkTrusted(X509TrustManagerImpl.java:246)\n\tat java.base/sun.security.ssl.X509TrustManagerImpl.checkServerTrusted(X509TrustManagerImpl.java:141)\n\tat nl.altindag.ssl.trustmanager.CompositeX509ExtendedTrustManager.lambda$checkServerTrusted$5(CompositeX509ExtendedTrustManager.java:91)\n\tat nl.altindag.ssl.trustmanager.CombinableX509TrustManager.checkTrusted(CombinableX509TrustManager.java:40)\n\tat nl.altindag.ssl.trustmanager.CompositeX509ExtendedTrustManager.checkServerTrusted(CompositeX509ExtendedTrustManager.java:91)\n\tat java.base/sun.security.ssl.CertificateMessage$T13CertificateConsumer.checkServerCerts(CertificateMessage.java:1335)\n\nNot sure what is the problem...\nThe failing test is here:\nhttps://github.com/SonarSource/sonarlint-core/blob/130de06eb43f48452138145a05bd4f4647dcdd7d/core/src/test/java/mediumtest/SslMediumTests.java#L110\nAnd this is how we setup the SSLFactory:\nhttps://github.com/SonarSource/sonarlint-core/blob/130de06eb43f48452138145a05bd4f4647dcdd7d/http/src/main/java/org/sonarsource/sonarlint/core/http/HttpClientProvider.java#L57"
}