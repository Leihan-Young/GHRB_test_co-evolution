{
  "issue_id": 2958,
  "issue_url": "https://github.com/mockito/mockito/issues/2958",
  "title": "ClassCastException when combining InjectMocks with generified Mock field",
  "description": "<p dir=\"auto\">When calling <code class=\"notranslate\">MockitoAnnotations.openMocks(this);</code> on a class that contains an <code class=\"notranslate\">@InjectMocks</code> target, a ClassCastException occurs when the target has a field that is generified and provided by one of the mocks in said class.</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"public class OpenMocksTest\n{\n\t@InjectMocks\n\tprotected ConcreteJob job;\n\n\t@Mock\n\tJobInstance<ConcreteJob> instance;\n\n\t@BeforeEach\n\tpublic void initMocks()\n\t{\n\t\topenMocks(this);\n\t}\n\n\t@Test\n\tpublic void testMockExists()\n\t{\n\t\tassertNotNull(job);\n\t}\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-smi\">OpenMocksTest</span>\n{\n\t<span class=\"pl-c1\">@</span><span class=\"pl-c1\">InjectMocks</span>\n\t<span class=\"pl-k\">protected</span> <span class=\"pl-smi\">ConcreteJob</span> <span class=\"pl-s1\">job</span>;\n\n\t<span class=\"pl-c1\">@</span><span class=\"pl-c1\">Mock</span>\n\t<span class=\"pl-smi\">JobInstance</span><<span class=\"pl-smi\">ConcreteJob</span>> <span class=\"pl-s1\">instance</span>;\n\n\t<span class=\"pl-c1\">@</span><span class=\"pl-c1\">BeforeEach</span>\n\t<span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">initMocks</span>()\n\t{\n\t\t<span class=\"pl-en\">openMocks</span>(<span class=\"pl-smi\">this</span>);\n\t}\n\n\t<span class=\"pl-c1\">@</span><span class=\"pl-c1\">Test</span>\n\t<span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">testMockExists</span>()\n\t{\n\t\t<span class=\"pl-en\">assertNotNull</span>(<span class=\"pl-s1\">job</span>);\n\t}\n}</pre></div>\n<p dir=\"auto\">I've attached a Maven project which demonstrates this flaw. Downgrading the Mockito version to <code class=\"notranslate\">5.1.1</code> fixes the issue.</p>\n<p dir=\"auto\"><a href=\"https://github.com/mockito/mockito/files/11123059/mockito-5.2.0-bug.zip\">mockito-5.2.0-bug.zip</a></p>",
  "description_text": "When calling MockitoAnnotations.openMocks(this); on a class that contains an @InjectMocks target, a ClassCastException occurs when the target has a field that is generified and provided by one of the mocks in said class.\npublic class OpenMocksTest\n{\n\t@InjectMocks\n\tprotected ConcreteJob job;\n\n\t@Mock\n\tJobInstance<ConcreteJob> instance;\n\n\t@BeforeEach\n\tpublic void initMocks()\n\t{\n\t\topenMocks(this);\n\t}\n\n\t@Test\n\tpublic void testMockExists()\n\t{\n\t\tassertNotNull(job);\n\t}\n}\nI've attached a Maven project which demonstrates this flaw. Downgrading the Mockito version to 5.1.1 fixes the issue.\nmockito-5.2.0-bug.zip"
}