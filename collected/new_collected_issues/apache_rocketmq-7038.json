{
  "issue_id": 7035,
  "issue_url": "https://github.com/apache/rocketmq/issues/7035",
  "title": "[Bug] Fix correct min offset behavior in tiered storage",
  "description": "<h3 dir=\"auto\">Before Creating the Bug Report</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\">\n<p dir=\"auto\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I found a bug, not just asking a question, which should be created in <a href=\"https://github.com/apache/rocketmq/discussions\">GitHub Discussions</a>.</p>\n</li>\n<li class=\"task-list-item\">\n<p dir=\"auto\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I have searched the <a href=\"https://github.com/apache/rocketmq/issues\">GitHub Issues</a> and <a href=\"https://github.com/apache/rocketmq/discussions\">GitHub Discussions</a>  of this repository and believe that this is not a duplicate.</p>\n</li>\n<li class=\"task-list-item\">\n<p dir=\"auto\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I have confirmed that this bug belongs to the current repository, not other repositories of RocketMQ.</p>\n</li>\n</ul>\n<h3 dir=\"auto\">Runtime platform environment</h3>\n<p dir=\"auto\">MacOS, JDK 11</p>\n<h3 dir=\"auto\">RocketMQ version</h3>\n<p dir=\"auto\">branch: develop latest</p>\n<h3 dir=\"auto\">JDK Version</h3>\n<p dir=\"auto\">JDK11</p>\n<h3 dir=\"auto\">Describe the Bug</h3>\n<p dir=\"auto\">When resetting the consumer's offset to an earlier time to start consuming data from tiered storage, we use \"clean expired\" to remove older data because commitlog and consume queue file have their own lifecycles. However, it is possible for cq file to still exist while the commitlog no longer exists. In this scenario, the data pointed to by cq unit is empty and there is no reasonable \"next begin offset\" to provide, preventing the client from correcting the position and self-healing the consumption process.</p>\n<h3 dir=\"auto\">Steps to Reproduce</h3>\n<p dir=\"auto\">No.</p>\n<h3 dir=\"auto\">What Did You Expect to See?</h3>\n<p dir=\"auto\">Fix offset success.</p>\n<h3 dir=\"auto\">What Did You See Instead?</h3>\n<p dir=\"auto\">No.</p>\n<h3 dir=\"auto\">Additional Context</h3>\n<p dir=\"auto\"><em>No response</em></p>",
  "description_text": "Before Creating the Bug Report\n\n\n I found a bug, not just asking a question, which should be created in GitHub Discussions.\n\n\n I have searched the GitHub Issues and GitHub Discussions  of this repository and believe that this is not a duplicate.\n\n\n I have confirmed that this bug belongs to the current repository, not other repositories of RocketMQ.\n\n\nRuntime platform environment\nMacOS, JDK 11\nRocketMQ version\nbranch: develop latest\nJDK Version\nJDK11\nDescribe the Bug\nWhen resetting the consumer's offset to an earlier time to start consuming data from tiered storage, we use \"clean expired\" to remove older data because commitlog and consume queue file have their own lifecycles. However, it is possible for cq file to still exist while the commitlog no longer exists. In this scenario, the data pointed to by cq unit is empty and there is no reasonable \"next begin offset\" to provide, preventing the client from correcting the position and self-healing the consumption process.\nSteps to Reproduce\nNo.\nWhat Did You Expect to See?\nFix offset success.\nWhat Did You See Instead?\nNo.\nAdditional Context\nNo response"
}