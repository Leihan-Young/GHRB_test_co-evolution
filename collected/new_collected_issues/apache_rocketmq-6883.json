{
  "issue_id": 6879,
  "issue_url": "https://github.com/apache/rocketmq/issues/6879",
  "title": "[Bug] ConcurrentHashMapUtils fails to solve the loop bug in JDK8.",
  "description": "<h3 dir=\"auto\">Before Creating the Bug Report</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\">\n<p dir=\"auto\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I found a bug, not just asking a question, which should be created in <a href=\"https://github.com/apache/rocketmq/discussions\">GitHub Discussions</a>.</p>\n</li>\n<li class=\"task-list-item\">\n<p dir=\"auto\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I have searched the <a href=\"https://github.com/apache/rocketmq/issues\">GitHub Issues</a> and <a href=\"https://github.com/apache/rocketmq/discussions\">GitHub Discussions</a>  of this repository and believe that this is not a duplicate.</p>\n</li>\n<li class=\"task-list-item\">\n<p dir=\"auto\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I have confirmed that this bug belongs to the current repository, not other repositories of RocketMQ.</p>\n</li>\n</ul>\n<h3 dir=\"auto\">Runtime platform environment</h3>\n<p dir=\"auto\">Mac  OS 13.0</p>\n<h3 dir=\"auto\">RocketMQ version</h3>\n<p dir=\"auto\">branch: (develop|tag 5.1.1) version: 5.1.1</p>\n<h3 dir=\"auto\">JDK Version</h3>\n<p dir=\"auto\">jdk8</p>\n<h3 dir=\"auto\">Describe the Bug</h3>\n<p dir=\"auto\"><a href=\"https://github.com/apache/rocketmq/blob/develop/common/src/main/java/org/apache/rocketmq/common/utils/ConcurrentHashMapUtils.java\">ConcurrentHashMapUtils</a> \u4e2d\u63d0\u4f9b\u7684computeIfAbsent\u65b9\u6cd5\u6ca1\u6709\u89e3\u51b3jdk8\u7684\u5faa\u73af\u95ee\u9898\uff0c\u590d\u73b0\u4ee3\u7801\u5982\u4e0b</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"@Test\n    public void computeIfAbsent() {\n        ConcurrentHashMap<String, String> map = new ConcurrentHashMap<>();\n//        map.computeIfAbsent(\"AaAa\", key->map.computeIfAbsent(\"BBBB\",key2->\"42\"));\n        ConcurrentHashMapUtils.computeIfAbsent(map, \"AaAa\", key -> map.computeIfAbsent(\"BBBB\", key2 -> \"42\"));\n    }\"><pre class=\"notranslate\"><code class=\"notranslate\">@Test\n    public void computeIfAbsent() {\n        ConcurrentHashMap<String, String> map = new ConcurrentHashMap<>();\n//        map.computeIfAbsent(\"AaAa\", key->map.computeIfAbsent(\"BBBB\",key2->\"42\"));\n        ConcurrentHashMapUtils.computeIfAbsent(map, \"AaAa\", key -> map.computeIfAbsent(\"BBBB\", key2 -> \"42\"));\n    }\n</code></pre></div>",
  "description_text": "Before Creating the Bug Report\n\n\n I found a bug, not just asking a question, which should be created in GitHub Discussions.\n\n\n I have searched the GitHub Issues and GitHub Discussions  of this repository and believe that this is not a duplicate.\n\n\n I have confirmed that this bug belongs to the current repository, not other repositories of RocketMQ.\n\n\nRuntime platform environment\nMac  OS 13.0\nRocketMQ version\nbranch: (develop|tag 5.1.1) version: 5.1.1\nJDK Version\njdk8\nDescribe the Bug\nConcurrentHashMapUtils \u4e2d\u63d0\u4f9b\u7684computeIfAbsent\u65b9\u6cd5\u6ca1\u6709\u89e3\u51b3jdk8\u7684\u5faa\u73af\u95ee\u9898\uff0c\u590d\u73b0\u4ee3\u7801\u5982\u4e0b\nmap.computeIfAbsent(\"BBBB\",key2->\"42\"));\n        ConcurrentHashMapUtils.computeIfAbsent(map, \"AaAa\", key -> map.computeIfAbsent(\"BBBB\", key2 -> \"42\"));\n    }\">@Test\n    public void computeIfAbsent() {\n        ConcurrentHashMap map = new ConcurrentHashMap<>();\n//        map.computeIfAbsent(\"AaAa\", key->map.computeIfAbsent(\"BBBB\",key2->\"42\"));\n        ConcurrentHashMapUtils.computeIfAbsent(map, \"AaAa\", key -> map.computeIfAbsent(\"BBBB\", key2 -> \"42\"));\n    }\n"
}