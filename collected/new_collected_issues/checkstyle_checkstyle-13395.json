{
  "issue_id": 13389,
  "issue_url": "https://github.com/checkstyle/checkstyle/issues/13389",
  "title": "Extend `getXdocsFilePaths` to gather `.xml.vm` files and get rid of `getAllXdocFilePaths`",
  "description": "<p dir=\"auto\">In <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1789742444\" data-permission-text=\"Title is private\" data-url=\"https://github.com/checkstyle/checkstyle/issues/13362\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/checkstyle/checkstyle/pull/13362/hovercard\" href=\"https://github.com/checkstyle/checkstyle/pull/13362\">#13362</a> we add new method in <code class=\"notranslate\">XdocUtil</code> - <code class=\"notranslate\">getAllXdocFilePaths</code>. The method is almost identical to <code class=\"notranslate\">getXdocsFilePaths</code> except that it also gets <code class=\"notranslate\">.xml.vm</code> files.</p>\n<p dir=\"auto\">If we extend <code class=\"notranslate\">getXdocsFilePaths</code> to include <code class=\"notranslate\">.xml.vm</code> files, 3 tests break:</p>\n<div class=\"highlight highlight-source-diff notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    public static Set<Path> getXdocsFilePaths() throws IOException {\n        final Path directory = Paths.get(DIRECTORY_PATH);\n        try (Stream<Path> stream = Files.find(directory, Integer.MAX_VALUE,\n-                (path, attr) -> attr.isRegularFile() && path.toString().endsWith(\".xml\"))) {\n+                (path, attr) -> {\n+                   return attr.isRegularFile()\n+                            && path.toString().endsWith(\".xml\")\n+                            || path.toString().endsWith(\".xml.vm\");\n+                })) {\n            return stream.collect(Collectors.toSet());\n        }\n    }\n\"><pre class=\"notranslate\">    public static Set<Path> getXdocsFilePaths() throws IOException {\n        final Path directory = Paths.get(DIRECTORY_PATH);\n        try (Stream<Path> stream = Files.find(directory, Integer.MAX_VALUE,\n<span class=\"pl-md\"><span class=\"pl-md\">-</span>                (path, attr) -> attr.isRegularFile() && path.toString().endsWith(\".xml\"))) {</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>                (path, attr) -> {</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>                   return attr.isRegularFile()</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>                            && path.toString().endsWith(\".xml\")</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>                            || path.toString().endsWith(\".xml.vm\");</span>\n<span class=\"pl-mi1\"><span class=\"pl-mi1\">+</span>                })) {</span>\n            return stream.collect(Collectors.toSet());\n        }\n    }\n</pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[ERROR] Failures: \n[ERROR]   XdocsMobileWrapperTest.testAllCheckSectionMobileWrapper:67->iterateNode:80 writingjavadocchecks.xml.vm/HTML Code In Javadoc Comments: Tag 'table' in 'section' needs a wrapping <span> or <div> with the class 'wrapper'.\nexpected any of: [div, span]\nbut was        : section\n[ERROR]   XdocsPagesTest.testAllSubSections:399 index.xml.vm sub-section Inactive / Old Tools for section Related Tools must match\nexpected: Related_Tools_Inactive_/_Old_Tools\nbut was : Related_Tools_Inactive_Old_Tools\n[ERROR] Errors: \n[ERROR]   XdocsPagesTest.testAllXmlExamples:431->isValidCheckstyleXml:507 Checkstyle writingjavadocchecks.xml.vm has invalid Checkstyle xml (unable to parse configuration stream - Element type \"audio\" must be declared.:5:8): <audio><source src=\"horse.ogg\" type=\"audio/ogg\"/></audio>\n[INFO] \n[ERROR] Tests run: 4202, Failures: 2, Errors: 1, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n\"><pre class=\"notranslate\"><code class=\"notranslate\">[ERROR] Failures: \n[ERROR]   XdocsMobileWrapperTest.testAllCheckSectionMobileWrapper:67->iterateNode:80 writingjavadocchecks.xml.vm/HTML Code In Javadoc Comments: Tag 'table' in 'section' needs a wrapping <span> or <div> with the class 'wrapper'.\nexpected any of: [div, span]\nbut was        : section\n[ERROR]   XdocsPagesTest.testAllSubSections:399 index.xml.vm sub-section Inactive / Old Tools for section Related Tools must match\nexpected: Related_Tools_Inactive_/_Old_Tools\nbut was : Related_Tools_Inactive_Old_Tools\n[ERROR] Errors: \n[ERROR]   XdocsPagesTest.testAllXmlExamples:431->isValidCheckstyleXml:507 Checkstyle writingjavadocchecks.xml.vm has invalid Checkstyle xml (unable to parse configuration stream - Element type \"audio\" must be declared.:5:8): <audio><source src=\"horse.ogg\" type=\"audio/ogg\"/></audio>\n[INFO] \n[ERROR] Tests run: 4202, Failures: 2, Errors: 1, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n\n</code></pre></div>",
  "description_text": "In #13362 we add new method in XdocUtil - getAllXdocFilePaths. The method is almost identical to getXdocsFilePaths except that it also gets .xml.vm files.\nIf we extend getXdocsFilePaths to include .xml.vm files, 3 tests break:\n {\n+                   return attr.isRegularFile()\n+                            && path.toString().endsWith(\".xml\")\n+                            || path.toString().endsWith(\".xml.vm\");\n+                })) {\n            return stream.collect(Collectors.toSet());\n        }\n    }\n\">    public static Set getXdocsFilePaths() throws IOException {\n        final Path directory = Paths.get(DIRECTORY_PATH);\n        try (Stream stream = Files.find(directory, Integer.MAX_VALUE,\n-                (path, attr) -> attr.isRegularFile() && path.toString().endsWith(\".xml\"))) {\n+                (path, attr) -> {\n+                   return attr.isRegularFile()\n+                            && path.toString().endsWith(\".xml\")\n+                            || path.toString().endsWith(\".xml.vm\");\n+                })) {\n            return stream.collect(Collectors.toSet());\n        }\n    }\n\n\n[INFO] \n[ERROR] Tests run: 4202, Failures: 2, Errors: 1, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n\">[ERROR] Failures: \n[ERROR]   XdocsMobileWrapperTest.testAllCheckSectionMobileWrapper:67->iterateNode:80 writingjavadocchecks.xml.vm/HTML Code In Javadoc Comments: Tag 'table' in 'section' needs a wrapping  or  with the class 'wrapper'.\nexpected any of: [div, span]\nbut was        : section\n[ERROR]   XdocsPagesTest.testAllSubSections:399 index.xml.vm sub-section Inactive / Old Tools for section Related Tools must match\nexpected: Related_Tools_Inactive_/_Old_Tools\nbut was : Related_Tools_Inactive_Old_Tools\n[ERROR] Errors: \n[ERROR]   XdocsPagesTest.testAllXmlExamples:431->isValidCheckstyleXml:507 Checkstyle writingjavadocchecks.xml.vm has invalid Checkstyle xml (unable to parse configuration stream - Element type \"audio\" must be declared.:5:8): \n[INFO] \n[ERROR] Tests run: 4202, Failures: 2, Errors: 1, Skipped: 0\n[INFO] \n[INFO] ------------------------------------------------------------------------\n[INFO] BUILD FAILURE\n\n"
}