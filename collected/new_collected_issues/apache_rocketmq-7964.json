{
  "issue_id": 7963,
  "issue_url": "https://github.com/apache/rocketmq/issues/7963",
  "title": "[Enhancement] Check the existence of consumer group in updateConsumerOffset to prevent dirty consumer offsets",
  "description": "<h3 dir=\"auto\">Before Creating the Enhancement Request</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I have confirmed that this should be classified as an enhancement rather than a bug/feature.</li>\n</ul>\n<h3 dir=\"auto\">Summary</h3>\n<p dir=\"auto\">Check the existence of consumer group in command updateConsumerOffset. Return SUBSCRIPTION_GROUP_NOT_EXIST if the group has been deleted.</p>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">In scenarios where consumer group need to be deleted, if deleteSubscriptionGroup admin is called before shutting down the online consumer clients, the consumer offset records, which is dirty, might be kept in broker. This could raise some problems, such as getting incorrect data when calling queryTopicConsumeByWho.</p>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/103550934/316478344-d8f6a4ca-56c1-47af-b1c5-e9642d5cb2fb.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTIwNTY2MzEsIm5iZiI6MTcxMjA1NjMzMSwicGF0aCI6Ii8xMDM1NTA5MzQvMzE2NDc4MzQ0LWQ4ZjZhNGNhLTU2YzEtNDdhZi1iMWM1LWU5NjQyZDVjYjJmYi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwNDAyJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDQwMlQxMTEyMTFaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT01ODljZmMyMTEzOWMwNjQwYzJkZTA3ODMyNDU5NTA5YTc3NjAwOWRjM2RmMmE0MTA1N2Y0NjdhOWFiMWE1M2I4JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.fGOia42FIS7G00v94ZUATtHOzEIzy7MfBCVJxchB2J0\"><img width=\"1725\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/103550934/316478344-d8f6a4ca-56c1-47af-b1c5-e9642d5cb2fb.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTIwNTY2MzEsIm5iZiI6MTcxMjA1NjMzMSwicGF0aCI6Ii8xMDM1NTA5MzQvMzE2NDc4MzQ0LWQ4ZjZhNGNhLTU2YzEtNDdhZi1iMWM1LWU5NjQyZDVjYjJmYi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwNDAyJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDQwMlQxMTEyMTFaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT01ODljZmMyMTEzOWMwNjQwYzJkZTA3ODMyNDU5NTA5YTc3NjAwOWRjM2RmMmE0MTA1N2Y0NjdhOWFiMWE1M2I4JlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.fGOia42FIS7G00v94ZUATtHOzEIzy7MfBCVJxchB2J0\" style=\"max-width: 100%;\"></a>\n<a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/103550934/316482507-20689d44-c44e-49d8-87f7-4cc39a56ff42.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTIwNTY2MzEsIm5iZiI6MTcxMjA1NjMzMSwicGF0aCI6Ii8xMDM1NTA5MzQvMzE2NDgyNTA3LTIwNjg5ZDQ0LWM0NGUtNDlkOC04N2Y3LTRjYzM5YTU2ZmY0Mi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwNDAyJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDQwMlQxMTEyMTFaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1kNjBhNjQ1MWM0MTMxMjQzYzc4MGNjYTAzMzNjYmVkYTg5NWRkYTliMDBkMmFlYmY0NzNmYmYzMTk4ZmZmMTcwJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.HPLhFFhHbCEFAeuxA_LU8QZYvKzrB2VxjF6X-H-EvX4\"><img width=\"579\" alt=\"image\" src=\"https://private-user-images.githubusercontent.com/103550934/316482507-20689d44-c44e-49d8-87f7-4cc39a56ff42.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTIwNTY2MzEsIm5iZiI6MTcxMjA1NjMzMSwicGF0aCI6Ii8xMDM1NTA5MzQvMzE2NDgyNTA3LTIwNjg5ZDQ0LWM0NGUtNDlkOC04N2Y3LTRjYzM5YTU2ZmY0Mi5wbmc_WC1BbXotQWxnb3JpdGhtPUFXUzQtSE1BQy1TSEEyNTYmWC1BbXotQ3JlZGVudGlhbD1BS0lBVkNPRFlMU0E1M1BRSzRaQSUyRjIwMjQwNDAyJTJGdXMtZWFzdC0xJTJGczMlMkZhd3M0X3JlcXVlc3QmWC1BbXotRGF0ZT0yMDI0MDQwMlQxMTEyMTFaJlgtQW16LUV4cGlyZXM9MzAwJlgtQW16LVNpZ25hdHVyZT1kNjBhNjQ1MWM0MTMxMjQzYzc4MGNjYTAzMzNjYmVkYTg5NWRkYTliMDBkMmFlYmY0NzNmYmYzMTk4ZmZmMTcwJlgtQW16LVNpZ25lZEhlYWRlcnM9aG9zdCZhY3Rvcl9pZD0wJmtleV9pZD0wJnJlcG9faWQ9MCJ9.HPLhFFhHbCEFAeuxA_LU8QZYvKzrB2VxjF6X-H-EvX4\" style=\"max-width: 100%;\"></a>\n<p dir=\"auto\">This is not the good way to use rmq, but it would occur, and be uncontrollable to broker.</p>\n<h3 dir=\"auto\">Describe the Solution You'd Like</h3>\n<p dir=\"auto\">Check the existence of consumer group in command updateConsumerOffset. Return SUBSCRIPTION_GROUP_NOT_EXIST if the group has been deleted.</p>\n<h3 dir=\"auto\">Describe Alternatives You've Considered</h3>\n<p dir=\"auto\">/</p>\n<h3 dir=\"auto\">Additional Context</h3>\n<p dir=\"auto\"><em>No response</em></p>",
  "description_text": "Before Creating the Enhancement Request\n\n I have confirmed that this should be classified as an enhancement rather than a bug/feature.\n\nSummary\nCheck the existence of consumer group in command updateConsumerOffset. Return SUBSCRIPTION_GROUP_NOT_EXIST if the group has been deleted.\nMotivation\nIn scenarios where consumer group need to be deleted, if deleteSubscriptionGroup admin is called before shutting down the online consumer clients, the consumer offset records, which is dirty, might be kept in broker. This could raise some problems, such as getting incorrect data when calling queryTopicConsumeByWho.\n\n\nThis is not the good way to use rmq, but it would occur, and be uncontrollable to broker.\nDescribe the Solution You'd Like\nCheck the existence of consumer group in command updateConsumerOffset. Return SUBSCRIPTION_GROUP_NOT_EXIST if the group has been deleted.\nDescribe Alternatives You've Considered\n/\nAdditional Context\nNo response"
}