{
  "issue_id": 7345,
  "issue_url": "https://github.com/apache/rocketmq/issues/7345",
  "title": "[Bug] wrong result of searchOffset in tiered storage",
  "description": "<h3 dir=\"auto\">Before Creating the Bug Report</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\">\n<p dir=\"auto\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I found a bug, not just asking a question, which should be created in <a href=\"https://github.com/apache/rocketmq/discussions\">GitHub Discussions</a>.</p>\n</li>\n<li class=\"task-list-item\">\n<p dir=\"auto\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I have searched the <a href=\"https://github.com/apache/rocketmq/issues\">GitHub Issues</a> and <a href=\"https://github.com/apache/rocketmq/discussions\">GitHub Discussions</a>  of this repository and believe that this is not a duplicate.</p>\n</li>\n<li class=\"task-list-item\">\n<p dir=\"auto\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I have confirmed that this bug belongs to the current repository, not other repositories of RocketMQ.</p>\n</li>\n</ul>\n<h3 dir=\"auto\">Runtime platform environment</h3>\n<p dir=\"auto\">Ubuntu</p>\n<h3 dir=\"auto\">RocketMQ version</h3>\n<p dir=\"auto\">5.1.0</p>\n<h3 dir=\"auto\">JDK Version</h3>\n<p dir=\"auto\">1.8.0</p>\n<h3 dir=\"auto\">Describe the Bug</h3>\n<p dir=\"auto\">There are 3 segments in fileSegmentList, TieredFlatFile.getFileByTime(timestamp=0, boundaryType=LOWER) should return the first segment, but now returns the last segment.</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer\" href=\"https://private-user-images.githubusercontent.com/14816818/267064184-61133d1e-27b2-4f04-a781-a17f91d7c939.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTIwNTYxMzAsIm5iZiI6MTcxMjA1NTgzMCwicGF0aCI6Ii8xNDgxNjgxOC8yNjcwNjQxODQtNjExMzNkMWUtMjdiMi00ZjA0LWE3ODEtYTE3ZjkxZDdjOTM5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA0MDIlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNDAyVDExMDM1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWVjMzI3NmNmZWU2ZTI2NmEzMWRkOTk3YjcxYTEyNzRjYzMzODVhMWMxMDRmNDY3ZjY3ZTgzM2ExMDI5M2FlNGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.GkIrXIfy-nbIh0mQBBTEMOwYH0xUWXh2YALGDZ1uCrM\"><img src=\"https://private-user-images.githubusercontent.com/14816818/267064184-61133d1e-27b2-4f04-a781-a17f91d7c939.png?jwt=eyJhbGciOiJIUzI1NiIsInR5cCI6IkpXVCJ9.eyJpc3MiOiJnaXRodWIuY29tIiwiYXVkIjoicmF3LmdpdGh1YnVzZXJjb250ZW50LmNvbSIsImtleSI6ImtleTUiLCJleHAiOjE3MTIwNTYxMzAsIm5iZiI6MTcxMjA1NTgzMCwicGF0aCI6Ii8xNDgxNjgxOC8yNjcwNjQxODQtNjExMzNkMWUtMjdiMi00ZjA0LWE3ODEtYTE3ZjkxZDdjOTM5LnBuZz9YLUFtei1BbGdvcml0aG09QVdTNC1ITUFDLVNIQTI1NiZYLUFtei1DcmVkZW50aWFsPUFLSUFWQ09EWUxTQTUzUFFLNFpBJTJGMjAyNDA0MDIlMkZ1cy1lYXN0LTElMkZzMyUyRmF3czRfcmVxdWVzdCZYLUFtei1EYXRlPTIwMjQwNDAyVDExMDM1MFomWC1BbXotRXhwaXJlcz0zMDAmWC1BbXotU2lnbmF0dXJlPWVjMzI3NmNmZWU2ZTI2NmEzMWRkOTk3YjcxYTEyNzRjYzMzODVhMWMxMDRmNDY3ZjY3ZTgzM2ExMDI5M2FlNGUmWC1BbXotU2lnbmVkSGVhZGVycz1ob3N0JmFjdG9yX2lkPTAma2V5X2lkPTAmcmVwb19pZD0wIn0.GkIrXIfy-nbIh0mQBBTEMOwYH0xUWXh2YALGDZ1uCrM\" alt=\"image\" style=\"max-width: 100%;\"></a></p>\n<h3 dir=\"auto\">Steps to Reproduce</h3>\n<ol dir=\"auto\">\n<li>start broker with tiered storage</li>\n<li>send some messages.</li>\n<li>use consumer.searchOffset to search offset with parameter timestamp=0, boundaryType=LOWER</li>\n</ol>\n<h3 dir=\"auto\">What Did You Expect to See?</h3>\n<p dir=\"auto\">searchOffset  should return min offset.</p>\n<h3 dir=\"auto\">What Did You See Instead?</h3>\n<p dir=\"auto\">searchOffset not returns min offset.</p>\n<h3 dir=\"auto\">Additional Context</h3>\n<p dir=\"auto\"><em>No response</em></p>",
  "description_text": "Before Creating the Bug Report\n\n\n I found a bug, not just asking a question, which should be created in GitHub Discussions.\n\n\n I have searched the GitHub Issues and GitHub Discussions  of this repository and believe that this is not a duplicate.\n\n\n I have confirmed that this bug belongs to the current repository, not other repositories of RocketMQ.\n\n\nRuntime platform environment\nUbuntu\nRocketMQ version\n5.1.0\nJDK Version\n1.8.0\nDescribe the Bug\nThere are 3 segments in fileSegmentList, TieredFlatFile.getFileByTime(timestamp=0, boundaryType=LOWER) should return the first segment, but now returns the last segment.\n\nSteps to Reproduce\n\nstart broker with tiered storage\nsend some messages.\nuse consumer.searchOffset to search offset with parameter timestamp=0, boundaryType=LOWER\n\nWhat Did You Expect to See?\nsearchOffset  should return min offset.\nWhat Did You See Instead?\nsearchOffset not returns min offset.\nAdditional Context\nNo response"
}