{
  "issue_id": 2701,
  "issue_url": "https://github.com/iBotPeaches/Apktool/issues/2701",
  "title": "[BUG] ArrayIndexOutOfBoundsException exception for APK without resources produced with AGP7",
  "description": "<h3 dir=\"auto\">Information</h3>\n<ol dir=\"auto\">\n<li><strong>Apktool Version (<code class=\"notranslate\">apktool -version</code>)</strong> - 2.6.0</li>\n<li><strong>Operating System (Mac, Linux, Windows)</strong> - Mac</li>\n<li><strong>APK From? (Playstore, ROM, Other)</strong> - Other</li>\n</ol>\n<h3 dir=\"auto\">Stacktrace/Logcat</h3>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"~/Downloads ./apktool -f d demo-app-debug-androidTest.apk \nI: Using Apktool 2.6.0 on demo-app-debug-androidTest.apk\nI: Loading resource table...\nException in thread \"main\" java.lang.ArrayIndexOutOfBoundsException: Index 0 out of bounds for length 0\n\tat brut.androlib.res.AndrolibResources.selectPkgWithMostResSpecs(AndrolibResources.java:103)\n\tat brut.androlib.res.AndrolibResources.loadMainPkg(AndrolibResources.java:76)\n\tat brut.androlib.res.AndrolibResources.getResTable(AndrolibResources.java:56)\n\tat brut.androlib.Androlib.getResTable(Androlib.java:69)\n\tat brut.androlib.ApkDecoder.getResTable(ApkDecoder.java:247)\n\tat brut.androlib.ApkDecoder.decode(ApkDecoder.java:109)\n\tat brut.apktool.Main.cmdDecode(Main.java:175)\n\tat brut.apktool.Main.main(Main.java:78)\"><pre class=\"notranslate\"><code class=\"notranslate\">~/Downloads ./apktool -f d demo-app-debug-androidTest.apk \nI: Using Apktool 2.6.0 on demo-app-debug-androidTest.apk\nI: Loading resource table...\nException in thread \"main\" java.lang.ArrayIndexOutOfBoundsException: Index 0 out of bounds for length 0\n\tat brut.androlib.res.AndrolibResources.selectPkgWithMostResSpecs(AndrolibResources.java:103)\n\tat brut.androlib.res.AndrolibResources.loadMainPkg(AndrolibResources.java:76)\n\tat brut.androlib.res.AndrolibResources.getResTable(AndrolibResources.java:56)\n\tat brut.androlib.Androlib.getResTable(Androlib.java:69)\n\tat brut.androlib.ApkDecoder.getResTable(ApkDecoder.java:247)\n\tat brut.androlib.ApkDecoder.decode(ApkDecoder.java:109)\n\tat brut.apktool.Main.cmdDecode(Main.java:175)\n\tat brut.apktool.Main.main(Main.java:78)\n</code></pre></div>\n<h3 dir=\"auto\">Steps to Reproduce</h3>\n<ol dir=\"auto\">\n<li><code class=\"notranslate\">apktool -f d demo-app-debug-androidTest.apk</code></li>\n</ol>\n<p dir=\"auto\">APK produced with AGP < 7:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"~/Downloads unzip -l demo-app-debug-androidTest.apk \nArchive:  demo-app-debug-androidTest.apk\n  Length      Date    Time    Name\n---------  ---------- -----   ----\n  4145064  01-01-1981 01:01   classes.dex\n    25220  01-01-1981 01:01   classes2.dex\n    11376  01-01-1981 01:01   LICENSE-junit.txt\n       34  01-01-1981 01:01   META-INF/services/kotlin.test.AsserterContributor\n      964  01-01-1981 01:01   junit/runner/logo.gif\n      883  01-01-1981 01:01   junit/runner/smalllogo.gif\n     3328  01-01-1981 01:01   AndroidManifest.xml\n      384  01-01-1981 01:01   resources.arsc\n      901  01-01-1981 01:01   META-INF/CERT.SF\n     1400  01-01-1981 01:01   META-INF/CERT.RSA\n      827  01-01-1981 01:01   META-INF/MANIFEST.MF\n---------                     -------\n  4190381                     11 files\"><pre class=\"notranslate\"><code class=\"notranslate\">~/Downloads unzip -l demo-app-debug-androidTest.apk \nArchive:  demo-app-debug-androidTest.apk\n  Length      Date    Time    Name\n---------  ---------- -----   ----\n  4145064  01-01-1981 01:01   classes.dex\n    25220  01-01-1981 01:01   classes2.dex\n    11376  01-01-1981 01:01   LICENSE-junit.txt\n       34  01-01-1981 01:01   META-INF/services/kotlin.test.AsserterContributor\n      964  01-01-1981 01:01   junit/runner/logo.gif\n      883  01-01-1981 01:01   junit/runner/smalllogo.gif\n     3328  01-01-1981 01:01   AndroidManifest.xml\n      384  01-01-1981 01:01   resources.arsc\n      901  01-01-1981 01:01   META-INF/CERT.SF\n     1400  01-01-1981 01:01   META-INF/CERT.RSA\n      827  01-01-1981 01:01   META-INF/MANIFEST.MF\n---------                     -------\n  4190381                     11 files\n</code></pre></div>\n<p dir=\"auto\">APK produced with AGP 7</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"~/Downloads unzip -l demo-app-debug-androidTest.apk \nArchive:  demo-app-debug-androidTest.apk\n  Length      Date    Time    Name\n---------  ---------- -----   ----\n  4145044  01-01-1981 01:01   classes.dex\n    24964  01-01-1981 01:01   classes2.dex\n    11376  01-01-1981 01:01   LICENSE-junit.txt\n       34  01-01-1981 01:01   META-INF/services/kotlin.test.AsserterContributor\n      964  01-01-1981 01:01   junit/runner/logo.gif\n      883  01-01-1981 01:01   junit/runner/smalllogo.gif\n     3328  01-01-1981 01:01   AndroidManifest.xml\n       40  01-01-1981 01:01   resources.arsc\n      901  01-01-1981 01:01   META-INF/CERT.SF\n     1400  01-01-1981 01:01   META-INF/CERT.RSA\n      827  01-01-1981 01:01   META-INF/MANIFEST.MF\n---------                     -------\n  4189761                     11 files\"><pre class=\"notranslate\"><code class=\"notranslate\">~/Downloads unzip -l demo-app-debug-androidTest.apk \nArchive:  demo-app-debug-androidTest.apk\n  Length      Date    Time    Name\n---------  ---------- -----   ----\n  4145044  01-01-1981 01:01   classes.dex\n    24964  01-01-1981 01:01   classes2.dex\n    11376  01-01-1981 01:01   LICENSE-junit.txt\n       34  01-01-1981 01:01   META-INF/services/kotlin.test.AsserterContributor\n      964  01-01-1981 01:01   junit/runner/logo.gif\n      883  01-01-1981 01:01   junit/runner/smalllogo.gif\n     3328  01-01-1981 01:01   AndroidManifest.xml\n       40  01-01-1981 01:01   resources.arsc\n      901  01-01-1981 01:01   META-INF/CERT.SF\n     1400  01-01-1981 01:01   META-INF/CERT.RSA\n      827  01-01-1981 01:01   META-INF/MANIFEST.MF\n---------                     -------\n  4189761                     11 files\n</code></pre></div>",
  "description_text": "Information\n\nApktool Version (apktool -version) - 2.6.0\nOperating System (Mac, Linux, Windows) - Mac\nAPK From? (Playstore, ROM, Other) - Other\n\nStacktrace/Logcat\n~/Downloads ./apktool -f d demo-app-debug-androidTest.apk \nI: Using Apktool 2.6.0 on demo-app-debug-androidTest.apk\nI: Loading resource table...\nException in thread \"main\" java.lang.ArrayIndexOutOfBoundsException: Index 0 out of bounds for length 0\n\tat brut.androlib.res.AndrolibResources.selectPkgWithMostResSpecs(AndrolibResources.java:103)\n\tat brut.androlib.res.AndrolibResources.loadMainPkg(AndrolibResources.java:76)\n\tat brut.androlib.res.AndrolibResources.getResTable(AndrolibResources.java:56)\n\tat brut.androlib.Androlib.getResTable(Androlib.java:69)\n\tat brut.androlib.ApkDecoder.getResTable(ApkDecoder.java:247)\n\tat brut.androlib.ApkDecoder.decode(ApkDecoder.java:109)\n\tat brut.apktool.Main.cmdDecode(Main.java:175)\n\tat brut.apktool.Main.main(Main.java:78)\n\nSteps to Reproduce\n\napktool -f d demo-app-debug-androidTest.apk\n\nAPK produced with AGP < 7:\n~/Downloads unzip -l demo-app-debug-androidTest.apk \nArchive:  demo-app-debug-androidTest.apk\n  Length      Date    Time    Name\n---------  ---------- -----   ----\n  4145064  01-01-1981 01:01   classes.dex\n    25220  01-01-1981 01:01   classes2.dex\n    11376  01-01-1981 01:01   LICENSE-junit.txt\n       34  01-01-1981 01:01   META-INF/services/kotlin.test.AsserterContributor\n      964  01-01-1981 01:01   junit/runner/logo.gif\n      883  01-01-1981 01:01   junit/runner/smalllogo.gif\n     3328  01-01-1981 01:01   AndroidManifest.xml\n      384  01-01-1981 01:01   resources.arsc\n      901  01-01-1981 01:01   META-INF/CERT.SF\n     1400  01-01-1981 01:01   META-INF/CERT.RSA\n      827  01-01-1981 01:01   META-INF/MANIFEST.MF\n---------                     -------\n  4190381                     11 files\n\nAPK produced with AGP 7\n~/Downloads unzip -l demo-app-debug-androidTest.apk \nArchive:  demo-app-debug-androidTest.apk\n  Length      Date    Time    Name\n---------  ---------- -----   ----\n  4145044  01-01-1981 01:01   classes.dex\n    24964  01-01-1981 01:01   classes2.dex\n    11376  01-01-1981 01:01   LICENSE-junit.txt\n       34  01-01-1981 01:01   META-INF/services/kotlin.test.AsserterContributor\n      964  01-01-1981 01:01   junit/runner/logo.gif\n      883  01-01-1981 01:01   junit/runner/smalllogo.gif\n     3328  01-01-1981 01:01   AndroidManifest.xml\n       40  01-01-1981 01:01   resources.arsc\n      901  01-01-1981 01:01   META-INF/CERT.SF\n     1400  01-01-1981 01:01   META-INF/CERT.RSA\n      827  01-01-1981 01:01   META-INF/MANIFEST.MF\n---------                     -------\n  4189761                     11 files\n"
}