{
  "issue_id": 14435,
  "issue_url": "https://github.com/checkstyle/checkstyle/issues/14435",
  "title": "AbstractXpathTestSupport does not support generating multiple xpath suppressions",
  "description": "<p dir=\"auto\">Discovered at: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2103790777\" data-permission-text=\"Title is private\" data-url=\"https://github.com/checkstyle/checkstyle/issues/14367\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/checkstyle/checkstyle/pull/14367/hovercard?comment_id=1469973273&comment_type=review_comment\" href=\"https://github.com/checkstyle/checkstyle/pull/14367#discussion_r1469973273\">#14367 (comment)</a></p>\n<p dir=\"auto\"><code class=\"notranslate\">AbstractXpathTestSupport.runVerifications(..)</code> does not support verifying XPath queries when an input file contains multiple violations.<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/checkstyle/checkstyle/blob/ff18405433c594182d92df06c71a2d86d6cd35e9/src/it/java/org/checkstyle/suppressionxpathfilter/AbstractXpathTestSupport.java#L198-L205\">checkstyle/src/it/java/org/checkstyle/suppressionxpathfilter/AbstractXpathTestSupport.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 198 to 205\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/checkstyle/checkstyle/commit/ff18405433c594182d92df06c71a2d86d6cd35e9\">ff18405</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L198\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"198\"></td>\n          <td id=\"LC198\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">protected</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">runVerifications</span>(<span class=\"pl-smi\">DefaultConfiguration</span> <span class=\"pl-s1\">moduleConfig</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L199\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"199\"></td>\n          <td id=\"LC199\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                               <span class=\"pl-smi\">File</span> <span class=\"pl-s1\">fileToProcess</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L200\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"200\"></td>\n          <td id=\"LC200\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                               <span class=\"pl-smi\">String</span>[] <span class=\"pl-s1\">expectedViolations</span>, </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L201\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"201\"></td>\n          <td id=\"LC201\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">                               <span class=\"pl-smi\">List</span><<span class=\"pl-smi\">String</span>> <span class=\"pl-s1\">expectedXpathQueries</span>) <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">Exception</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L202\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"202\"></td>\n          <td id=\"LC202\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">final</span> <span class=\"pl-smi\">ViolationPosition</span> <span class=\"pl-s1\">position</span> = </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L203\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"203\"></td>\n          <td id=\"LC203\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-en\">extractLineAndColumnNumber</span>(<span class=\"pl-s1\">expectedViolations</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L204\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"204\"></td>\n          <td id=\"LC204\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">final</span> <span class=\"pl-smi\">List</span><<span class=\"pl-smi\">String</span>> <span class=\"pl-s1\">generatedXpathQueries</span> = </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L205\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"205\"></td>\n          <td id=\"LC205\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">             <span class=\"pl-en\">generateXpathQueries</span>(<span class=\"pl-s1\">fileToProcess</span>, <span class=\"pl-s1\">position</span>); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\"><code class=\"notranslate\">ViolationPosition</code> is a single violation, and XPath Queries would only be generated for that particular violation. Either we should fix the verification method or explicitly disallow multiple violations per file for XPath Suppression tests.</p>\n<p dir=\"auto\">Results of long discussion: disallow it by throwing exception.</p>",
  "description_text": "Discovered at: #14367 (comment)\nAbstractXpathTestSupport.runVerifications(..) does not support verifying XPath queries when an input file contains multiple violations.\n\n\n\ncheckstyle/src/it/java/org/checkstyle/suppressionxpathfilter/AbstractXpathTestSupport.java\n\n\n        Lines 198 to 205\n      in\n      ff18405\n\n\n\n\n\n\n protected void runVerifications(DefaultConfiguration moduleConfig, \n\n\n\n File fileToProcess, \n\n\n\n String[] expectedViolations, \n\n\n\n List<String> expectedXpathQueries) throws Exception { \n\n\n\n final ViolationPosition position = \n\n\n\n extractLineAndColumnNumber(expectedViolations); \n\n\n\n final List<String> generatedXpathQueries = \n\n\n\n generateXpathQueries(fileToProcess, position); \n\n\n\n\n\nViolationPosition is a single violation, and XPath Queries would only be generated for that particular violation. Either we should fix the verification method or explicitly disallow multiple violations per file for XPath Suppression tests.\nResults of long discussion: disallow it by throwing exception."
}