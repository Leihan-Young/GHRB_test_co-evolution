{
  "issue_id": 17048,
  "issue_url": "https://github.com/OpenAPITools/openapi-generator/issues/17048",
  "title": "[BUG] `allOf` with single `$ref` element implementation doesn't respect sibling properties like `deprecated` etc.",
  "description": "<h4 dir=\"auto\">Bug Report Checklist</h4>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you provided a full/minimal spec to reproduce the issue?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you validated the input using an OpenAPI validator (<a href=\"https://apidevtools.org/swagger-parser/online/\" rel=\"nofollow\">example</a>)?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you <a href=\"https://github.com/OpenAPITools/openapi-generator/wiki/FAQ#how-to-test-with-the-latest-master-of-openapi-generator\">tested with the latest master</a> to confirm the issue still exists?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you searched for related issues/PRs?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> What's the actual output vs expected output?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> [Optional] Sponsorship to speed up the bug fix or feature request (<a href=\"https://github.com/OpenAPITools/openapi-generator/issues/6178\" data-hovercard-type=\"issue\" data-hovercard-url=\"/OpenAPITools/openapi-generator/issues/6178/hovercard\">example</a>)</li>\n</ul>\n\n<h5 dir=\"auto\">Description</h5>\n<p dir=\"auto\"><code class=\"notranslate\">allOf</code> can have sibling json properties like <code class=\"notranslate\">deprecated</code>, <code class=\"notranslate\">readOnly</code>, <code class=\"notranslate\">nuallable</code> etc.<br>\n<code class=\"notranslate\">allOf</code> with single<code class=\"notranslate\">$ref</code> is treated differently: <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1804066195\" data-permission-text=\"Title is private\" data-url=\"https://github.com/OpenAPITools/openapi-generator/issues/16096\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/OpenAPITools/openapi-generator/pull/16096/hovercard\" href=\"https://github.com/OpenAPITools/openapi-generator/pull/16096\">#16096</a><br>\n<code class=\"notranslate\">allOf</code> with single <code class=\"notranslate\">$ref</code> doesn't respect sibling property behaviour.<br>\nWhereas <code class=\"notranslate\">allOf</code> with more than one <code class=\"notranslate\">$ref</code> respects sibling properties.</p>\n<p dir=\"auto\">OpenAPI spec with <code class=\"notranslate\">allOf</code> & single <code class=\"notranslate\">$ref</code>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"\"components\":{\n  \"schemas\": {\n    \"AssetFrame\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"test\": {\n          \"type\": \"string\",\n          \"deprecated\": true\n        },\n        \"machineDetails\": {\n          \"deprecated\": true,\n          \"allOf\": [\n            {\n              \"$ref\": \"#/components/schemas/MachineDetails\"\n            }\n          ]\n        }\n      }\n    }\n  }\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">\"components\":{\n  \"schemas\": {\n    \"AssetFrame\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"test\": {\n          \"type\": \"string\",\n          \"deprecated\": true\n        },\n        \"machineDetails\": {\n          \"deprecated\": true,\n          \"allOf\": [\n            {\n              \"$ref\": \"#/components/schemas/MachineDetails\"\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n</code></pre></div>\n<p dir=\"auto\">Generates below java code:<br>\nSnippet of AssetFrame.java</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  @SerializedName(SERIALIZED_NAME_MACHINE_DETAILS)\n  private AssetFrameMachineDetails machineDetails;\"><pre class=\"notranslate\"><code class=\"notranslate\">  @SerializedName(SERIALIZED_NAME_MACHINE_DETAILS)\n  private AssetFrameMachineDetails machineDetails;\n</code></pre></div>\n<p dir=\"auto\">OpenAPI spec with <code class=\"notranslate\">allOf</code> & more man one <code class=\"notranslate\">$ref</code></p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"\"components\":{\n  \"schemas\": {\n    \"AssetFrame\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"test\": {\n          \"type\": \"string\",\n          \"deprecated\": true\n        },\n        \"machineDetails\": {\n          \"deprecated\": true,\n          \"allOf\": [\n            {\n              \"$ref\": \"#/components/schemas/MachineDetails\"\n            },\n            {\n              \"$ref\": \"#/components/schemas/Shelf\"\n            }\n          ]\n        }\n      }\n    }\n  }\n}\"><pre class=\"notranslate\"><code class=\"notranslate\">\"components\":{\n  \"schemas\": {\n    \"AssetFrame\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"test\": {\n          \"type\": \"string\",\n          \"deprecated\": true\n        },\n        \"machineDetails\": {\n          \"deprecated\": true,\n          \"allOf\": [\n            {\n              \"$ref\": \"#/components/schemas/MachineDetails\"\n            },\n            {\n              \"$ref\": \"#/components/schemas/Shelf\"\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n</code></pre></div>\n<p dir=\"auto\">Snippet of AssetFrame.java</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  @Deprecated\n  @SerializedName(SERIALIZED_NAME_MACHINE_DETAILS)\n  private AssetFrameMachineDetails machineDetails;\"><pre class=\"notranslate\"><code class=\"notranslate\">  @Deprecated\n  @SerializedName(SERIALIZED_NAME_MACHINE_DETAILS)\n  private AssetFrameMachineDetails machineDetails;\n</code></pre></div>\n<h5 dir=\"auto\">openapi-generator version</h5>\n<p dir=\"auto\">3.0.0</p>\n<h5 dir=\"auto\">Expectation</h5>\n<p dir=\"auto\"><code class=\"notranslate\">allOf</code> with single <code class=\"notranslate\">$ref</code> should respect <code class=\"notranslate\">deprecated</code> property and should have <code class=\"notranslate\">@Deprecated</code> annotation.</p>\n<h5 dir=\"auto\">Steps to reproduce</h5>\n<p dir=\"auto\">java -jar ./modules/openapi-generator-cli/target/openapi-generator-cli.jar generate -i ./library_openapi.json -g java -o ~/Documents/library/</p>\n<h5 dir=\"auto\">Related issues/PRs</h5>\n<p dir=\"auto\">None found</p>\n<h5 dir=\"auto\">Suggest a fix</h5>\n<p dir=\"auto\">Probably fix will be in [modules/openapi-generator/src/main/java/org/openapitools/codegen/InlineModelResolver.java#L235](</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/OpenAPITools/openapi-generator/blob/c9f7af752fe12df3d3a96ff7ba290a90f3ccb0d5/modules/openapi-generator/src/main/java/org/openapitools/codegen/InlineModelResolver.java#L235\">openapi-generator/modules/openapi-generator/src/main/java/org/openapitools/codegen/InlineModelResolver.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 235\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/OpenAPITools/openapi-generator/commit/c9f7af752fe12df3d3a96ff7ba290a90f3ccb0d5\">c9f7af7</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L235\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"235\"></td>\n          <td id=\"LC235\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\">// single allOf and it's a ref</span> </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n block.<br>\nNeed to set properties before/after execution.<br>\nneed go through the code to find the code fix location.<p></p>",
  "description_text": "Bug Report Checklist\n\n Have you provided a full/minimal spec to reproduce the issue?\n Have you validated the input using an OpenAPI validator (example)?\n Have you tested with the latest master to confirm the issue still exists?\n Have you searched for related issues/PRs?\n What's the actual output vs expected output?\n [Optional] Sponsorship to speed up the bug fix or feature request (example)\n\nDescription\nallOf can have sibling json properties like deprecated, readOnly, nuallable etc.\nallOf with single$ref is treated differently: #16096\nallOf with single $ref doesn't respect sibling property behaviour.\nWhereas allOf with more than one $ref respects sibling properties.\nOpenAPI spec with allOf & single $ref:\n\"components\":{\n  \"schemas\": {\n    \"AssetFrame\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"test\": {\n          \"type\": \"string\",\n          \"deprecated\": true\n        },\n        \"machineDetails\": {\n          \"deprecated\": true,\n          \"allOf\": [\n            {\n              \"$ref\": \"#/components/schemas/MachineDetails\"\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n\nGenerates below java code:\nSnippet of AssetFrame.java\n  @SerializedName(SERIALIZED_NAME_MACHINE_DETAILS)\n  private AssetFrameMachineDetails machineDetails;\n\nOpenAPI spec with allOf & more man one $ref\n\"components\":{\n  \"schemas\": {\n    \"AssetFrame\": {\n      \"type\": \"object\",\n      \"properties\": {\n        \"test\": {\n          \"type\": \"string\",\n          \"deprecated\": true\n        },\n        \"machineDetails\": {\n          \"deprecated\": true,\n          \"allOf\": [\n            {\n              \"$ref\": \"#/components/schemas/MachineDetails\"\n            },\n            {\n              \"$ref\": \"#/components/schemas/Shelf\"\n            }\n          ]\n        }\n      }\n    }\n  }\n}\n\nSnippet of AssetFrame.java\n  @Deprecated\n  @SerializedName(SERIALIZED_NAME_MACHINE_DETAILS)\n  private AssetFrameMachineDetails machineDetails;\n\nopenapi-generator version\n3.0.0\nExpectation\nallOf with single $ref should respect deprecated property and should have @Deprecated annotation.\nSteps to reproduce\njava -jar ./modules/openapi-generator-cli/target/openapi-generator-cli.jar generate -i ./library_openapi.json -g java -o ~/Documents/library/\nRelated issues/PRs\nNone found\nSuggest a fix\nProbably fix will be in [modules/openapi-generator/src/main/java/org/openapitools/codegen/InlineModelResolver.java#L235](\n\n\nopenapi-generator/modules/openapi-generator/src/main/java/org/openapitools/codegen/InlineModelResolver.java\n\n\n         Line 235\n      in\n      c9f7af7\n\n\n\n\n\n\n // single allOf and it's a ref \n\n\n\n\n block.\nNeed to set properties before/after execution.\nneed go through the code to find the code fix location."
}