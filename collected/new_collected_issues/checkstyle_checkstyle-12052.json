{
  "issue_id": 11973,
  "issue_url": "https://github.com/checkstyle/checkstyle/issues/11973",
  "title": "VariableDeclarationUsageDistance throws NPE on empty switch statements",
  "description": "<p dir=\"auto\">I have read check documentation: <a href=\"https://checkstyle.org/config_coding.html#VariableDeclarationUsageDistance\" rel=\"nofollow\">https://checkstyle.org/config_coding.html#VariableDeclarationUsageDistance</a><br>\nI have downloaded the latest checkstyle from: <a href=\"https://checkstyle.org/cmdline.html#Download_and_Run\" rel=\"nofollow\">https://checkstyle.org/cmdline.html#Download_and_Run</a><br>\nI have executed the cli and showed it below, as cli describes the problem better than 1,000 words</p>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"/var/tmp $ javac Test.java\"><pre class=\"notranslate\">/var/tmp $ javac Test.java</pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/var/tmp $ cat config.xml\"><pre class=\"notranslate\"><code class=\"notranslate\">/var/tmp $ cat config.xml\n</code></pre></div>\n<div class=\"highlight highlight-text-xml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"<!DOCTYPE module PUBLIC\n        \"-//Puppy Crawl//DTD Check Configuration 1.2//EN\"\n        \"http://www.puppycrawl.com/dtds/configuration_1_2.dtd\">\n\n<module name=\"Checker\">\n  <module name=\"TreeWalker\">\n    <module name=\"VariableDeclarationUsageDistance\">\n      <property name=\"validateBetweenScopes\" value=\"true\"/>\n      <property name=\"allowedDistance\" value=\"1\"/>\n    </module>\n  </module>\n</module>\"><pre class=\"notranslate\"><!<span class=\"pl-ent\">DOCTYPE</span> <span class=\"pl-e\">module</span> PUBLIC\n        \"-//Puppy Crawl//DTD Check Configuration 1.2//EN\"\n        \"http://www.puppycrawl.com/dtds/configuration_1_2.dtd\">\n\n<<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Checker<span class=\"pl-pds\">\"</span></span>>\n  <<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>TreeWalker<span class=\"pl-pds\">\"</span></span>>\n    <<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>VariableDeclarationUsageDistance<span class=\"pl-pds\">\"</span></span>>\n      <<span class=\"pl-ent\">property</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>validateBetweenScopes<span class=\"pl-pds\">\"</span></span> <span class=\"pl-e\">value</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>true<span class=\"pl-pds\">\"</span></span>/>\n      <<span class=\"pl-ent\">property</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>allowedDistance<span class=\"pl-pds\">\"</span></span> <span class=\"pl-e\">value</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>1<span class=\"pl-pds\">\"</span></span>/>\n    </<span class=\"pl-ent\">module</span>>\n  </<span class=\"pl-ent\">module</span>>\n</<span class=\"pl-ent\">module</span>></pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/var/tmp $ cat Test.java\"><pre class=\"notranslate\"><code class=\"notranslate\">/var/tmp $ cat Test.java\n</code></pre></div>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"public class Test {\n    void method() {\n        int i = -1;\n        switch (i) {\n        }\n    }\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-smi\">Test</span> {\n    <span class=\"pl-smi\">void</span> <span class=\"pl-en\">method</span>() {\n        <span class=\"pl-smi\">int</span> <span class=\"pl-s1\">i</span> = -<span class=\"pl-c1\">1</span>;\n        <span class=\"pl-k\">switch</span> (<span class=\"pl-s1\">i</span>) {\n        }\n    }\n}</pre></div>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"/var/tmp $ RUN_LOCALE=\"-Duser.language=en -Duser.country=US\"\n/var/tmp $ java $RUN_LOCALE -jar checkstyle-10.3.1-all.jar -c config.xml Test.java\nStarting audit...\ncom.puppycrawl.tools.checkstyle.api.CheckstyleException: Exception was thrown while processing Test.java\n        at com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:307)\n        at com.puppycrawl.tools.checkstyle.Checker.process(Checker.java:224)\n        at com.puppycrawl.tools.checkstyle.Main.runCheckstyle(Main.java:407)\n        at com.puppycrawl.tools.checkstyle.Main.runCli(Main.java:330)\n        at com.puppycrawl.tools.checkstyle.Main.execute(Main.java:189)\n        at com.puppycrawl.tools.checkstyle.Main.main(Main.java:126)\nCaused by: java.lang.NullPointerException\n        at com.puppycrawl.tools.checkstyle.checks.coding.VariableDeclarationUsageDistanceCheck.getFirstNodeInsideSwitchBlock(VariableDeclarationUsageDistanceCheck.java:836)\n        at com.puppycrawl.tools.checkstyle.checks.coding.VariableDeclarationUsageDistanceCheck.calculateDistanceBetweenScopes(VariableDeclarationUsageDistanceCheck.java:651)\n        at com.puppycrawl.tools.checkstyle.checks.coding.VariableDeclarationUsageDistanceCheck.visitToken(VariableDeclarationUsageDistanceCheck.java:410)\n        at com.puppycrawl.tools.checkstyle.TreeWalker.notifyVisit(TreeWalker.java:335)\n        at com.puppycrawl.tools.checkstyle.TreeWalker.processIter(TreeWalker.java:406)\n        at com.puppycrawl.tools.checkstyle.TreeWalker.walk(TreeWalker.java:273)\n        at com.puppycrawl.tools.checkstyle.TreeWalker.processFiltered(TreeWalker.java:154)\n        at com.puppycrawl.tools.checkstyle.api.AbstractFileSetCheck.process(AbstractFileSetCheck.java:92)\n        at com.puppycrawl.tools.checkstyle.Checker.processFile(Checker.java:333)\n        at com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:294)\n        ... 5 more\nCheckstyle ends with 1 errors.\"><pre class=\"notranslate\"><code class=\"notranslate\">/var/tmp $ RUN_LOCALE=\"-Duser.language=en -Duser.country=US\"\n/var/tmp $ java $RUN_LOCALE -jar checkstyle-10.3.1-all.jar -c config.xml Test.java\nStarting audit...\ncom.puppycrawl.tools.checkstyle.api.CheckstyleException: Exception was thrown while processing Test.java\n        at com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:307)\n        at com.puppycrawl.tools.checkstyle.Checker.process(Checker.java:224)\n        at com.puppycrawl.tools.checkstyle.Main.runCheckstyle(Main.java:407)\n        at com.puppycrawl.tools.checkstyle.Main.runCli(Main.java:330)\n        at com.puppycrawl.tools.checkstyle.Main.execute(Main.java:189)\n        at com.puppycrawl.tools.checkstyle.Main.main(Main.java:126)\nCaused by: java.lang.NullPointerException\n        at com.puppycrawl.tools.checkstyle.checks.coding.VariableDeclarationUsageDistanceCheck.getFirstNodeInsideSwitchBlock(VariableDeclarationUsageDistanceCheck.java:836)\n        at com.puppycrawl.tools.checkstyle.checks.coding.VariableDeclarationUsageDistanceCheck.calculateDistanceBetweenScopes(VariableDeclarationUsageDistanceCheck.java:651)\n        at com.puppycrawl.tools.checkstyle.checks.coding.VariableDeclarationUsageDistanceCheck.visitToken(VariableDeclarationUsageDistanceCheck.java:410)\n        at com.puppycrawl.tools.checkstyle.TreeWalker.notifyVisit(TreeWalker.java:335)\n        at com.puppycrawl.tools.checkstyle.TreeWalker.processIter(TreeWalker.java:406)\n        at com.puppycrawl.tools.checkstyle.TreeWalker.walk(TreeWalker.java:273)\n        at com.puppycrawl.tools.checkstyle.TreeWalker.processFiltered(TreeWalker.java:154)\n        at com.puppycrawl.tools.checkstyle.api.AbstractFileSetCheck.process(AbstractFileSetCheck.java:92)\n        at com.puppycrawl.tools.checkstyle.Checker.processFile(Checker.java:333)\n        at com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:294)\n        ... 5 more\nCheckstyle ends with 1 errors.\n</code></pre></div>",
  "description_text": "I have read check documentation: https://checkstyle.org/config_coding.html#VariableDeclarationUsageDistance\nI have downloaded the latest checkstyle from: https://checkstyle.org/cmdline.html#Download_and_Run\nI have executed the cli and showed it below, as cli describes the problem better than 1,000 words\n/var/tmp $ javac Test.java\n/var/tmp $ cat config.xml\n\n\n\n\n\n\n\n\n\n\">DOCTYPE module PUBLIC\n        \"-//Puppy Crawl//DTD Check Configuration 1.2//EN\"\n        \"http://www.puppycrawl.com/dtds/configuration_1_2.dtd\">\n\n<module name=\"Checker\">\n  <module name=\"TreeWalker\">\n    <module name=\"VariableDeclarationUsageDistance\">\n      <property name=\"validateBetweenScopes\" value=\"true\"/>\n      <property name=\"allowedDistance\" value=\"1\"/>\n    module>\n  module>\nmodule>\n/var/tmp $ cat Test.java\n\npublic class Test {\n    void method() {\n        int i = -1;\n        switch (i) {\n        }\n    }\n}\n/var/tmp $ RUN_LOCALE=\"-Duser.language=en -Duser.country=US\"\n/var/tmp $ java $RUN_LOCALE -jar checkstyle-10.3.1-all.jar -c config.xml Test.java\nStarting audit...\ncom.puppycrawl.tools.checkstyle.api.CheckstyleException: Exception was thrown while processing Test.java\n        at com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:307)\n        at com.puppycrawl.tools.checkstyle.Checker.process(Checker.java:224)\n        at com.puppycrawl.tools.checkstyle.Main.runCheckstyle(Main.java:407)\n        at com.puppycrawl.tools.checkstyle.Main.runCli(Main.java:330)\n        at com.puppycrawl.tools.checkstyle.Main.execute(Main.java:189)\n        at com.puppycrawl.tools.checkstyle.Main.main(Main.java:126)\nCaused by: java.lang.NullPointerException\n        at com.puppycrawl.tools.checkstyle.checks.coding.VariableDeclarationUsageDistanceCheck.getFirstNodeInsideSwitchBlock(VariableDeclarationUsageDistanceCheck.java:836)\n        at com.puppycrawl.tools.checkstyle.checks.coding.VariableDeclarationUsageDistanceCheck.calculateDistanceBetweenScopes(VariableDeclarationUsageDistanceCheck.java:651)\n        at com.puppycrawl.tools.checkstyle.checks.coding.VariableDeclarationUsageDistanceCheck.visitToken(VariableDeclarationUsageDistanceCheck.java:410)\n        at com.puppycrawl.tools.checkstyle.TreeWalker.notifyVisit(TreeWalker.java:335)\n        at com.puppycrawl.tools.checkstyle.TreeWalker.processIter(TreeWalker.java:406)\n        at com.puppycrawl.tools.checkstyle.TreeWalker.walk(TreeWalker.java:273)\n        at com.puppycrawl.tools.checkstyle.TreeWalker.processFiltered(TreeWalker.java:154)\n        at com.puppycrawl.tools.checkstyle.api.AbstractFileSetCheck.process(AbstractFileSetCheck.java:92)\n        at com.puppycrawl.tools.checkstyle.Checker.processFile(Checker.java:333)\n        at com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:294)\n        ... 5 more\nCheckstyle ends with 1 errors.\n"
}