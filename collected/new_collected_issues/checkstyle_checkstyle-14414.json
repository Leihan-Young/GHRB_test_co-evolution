{
  "issue_id": 14220,
  "issue_url": "https://github.com/checkstyle/checkstyle/issues/14220",
  "title": "Forbid Files.createTempDirectory in Checkstyle and replace with @TempDir",
  "description": "<p dir=\"auto\"><code class=\"notranslate\">Files.createTempDirectory</code> does not obey the system property <code class=\"notranslate\">java.io.tmpdir</code> and does not attempt to clean up the temporary directory on completion of the run.</p>\n<p dir=\"auto\">I override <code class=\"notranslate\">java.io.tmpdir</code> when running Checkstyle to avoid writing to my SSD for test runs, and instead point it to an in-memory hard drive that is allowed to write, delete, and fill up to its content.</p>\n<p dir=\"auto\"><code class=\"notranslate\">PropertyCacheFileTest</code> is currently the only test that uses a different temporary directory creation method, which was just recently introduced in <a class=\"commit-link\" data-hovercard-type=\"commit\" data-hovercard-url=\"https://github.com/checkstyle/checkstyle/commit/2e99389ba88a7b802383eb79c48b611237ec7de9/hovercard\" href=\"https://github.com/checkstyle/checkstyle/commit/2e99389ba88a7b802383eb79c48b611237ec7de9\"><tt>2e99389</tt></a> .</p>\n<p dir=\"auto\">We should switch the tests to <code class=\"notranslate\">@TempDir</code>, which is already used in other parts of our repo. It obeys the system property and will attempt to do clean up so the directory doesn't get bloated.</p>\n<p dir=\"auto\">Possible example configs to add are:</p>\n<p dir=\"auto\">Regexp:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"  <module name=\"RegexpSingleline\">\n    <property name=\"format\" value=\"Files\\.createTempDirectory\"/>\n    <property name=\"fileExtensions\" value=\"java\"/>\n    <property name=\"message\"\n              value=\"Use @TempDir for better temporary directory control\"/>\n  </module>\"><pre class=\"notranslate\"><code class=\"notranslate\">  <module name=\"RegexpSingleline\">\n    <property name=\"format\" value=\"Files\\.createTempDirectory\"/>\n    <property name=\"fileExtensions\" value=\"java\"/>\n    <property name=\"message\"\n              value=\"Use @TempDir for better temporary directory control\"/>\n  </module>\n</code></pre></div>\n<p dir=\"auto\">ForbidCertainMethodCheck:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    <module name=\"com.github.sevntu.checkstyle.checks.coding.ForbidCertainMethodCheck\">\n      <property name=\"methodName\" value=\"createTempDirectory\"/>\n      <property name=\"argumentCount\" value=\"1\"/>\n    </module>\"><pre class=\"notranslate\"><code class=\"notranslate\">    <module name=\"com.github.sevntu.checkstyle.checks.coding.ForbidCertainMethodCheck\">\n      <property name=\"methodName\" value=\"createTempDirectory\"/>\n      <property name=\"argumentCount\" value=\"1\"/>\n    </module>\n</code></pre></div>",
  "description_text": "Files.createTempDirectory does not obey the system property java.io.tmpdir and does not attempt to clean up the temporary directory on completion of the run.\nI override java.io.tmpdir when running Checkstyle to avoid writing to my SSD for test runs, and instead point it to an in-memory hard drive that is allowed to write, delete, and fill up to its content.\nPropertyCacheFileTest is currently the only test that uses a different temporary directory creation method, which was just recently introduced in 2e99389 .\nWe should switch the tests to @TempDir, which is already used in other parts of our repo. It obeys the system property and will attempt to do clean up so the directory doesn't get bloated.\nPossible example configs to add are:\nRegexp:\n\n\n\n\n\">  \n    \n    \n    \n  \n\nForbidCertainMethodCheck:\n\n\n\n\">    \n      \n      \n    \n"
}