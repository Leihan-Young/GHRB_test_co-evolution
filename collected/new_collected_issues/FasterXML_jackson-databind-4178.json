{
  "issue_id": 4175,
  "issue_url": "https://github.com/FasterXML/jackson-databind/issues/4175",
  "title": "Exception when deserialization of `private` record with default constructor",
  "description": "<h3 dir=\"auto\">Search before asking</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I searched in the <a href=\"https://github.com/FasterXML/jackson-databind/issues\">issues</a> and found nothing similar.</li>\n</ul>\n<h3 dir=\"auto\">Describe the bug</h3>\n<p dir=\"auto\">When deserializing a record, jackson fails with</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"com.fasterxml.jackson.databind.exc.InvalidDefinitionException: Cannot construct instance of ... (no Creators, like default constructor, exist): cannot deserialize from Object value (no delegate- or property-based Creator)\"><pre class=\"notranslate\"><code class=\"notranslate\">com.fasterxml.jackson.databind.exc.InvalidDefinitionException: Cannot construct instance of ... (no Creators, like default constructor, exist): cannot deserialize from Object value (no delegate- or property-based Creator)\n</code></pre></div>\n<p dir=\"auto\">It looks like jackson does not see default constructor.</p>\n<h3 dir=\"auto\">Version Information</h3>\n<p dir=\"auto\">2.16.0-rc1</p>\n<h3 dir=\"auto\">Reproduction</h3>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"import com.fasterxml.jackson.core.JsonProcessingException;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport org.junit.jupiter.api.Assertions;\nimport org.junit.jupiter.api.Tag;\nimport org.junit.jupiter.api.Test;\n\nclass TestObjectTest {\n\n    @Test\n    public void shouldDeserialize() throws JsonProcessingException {\n        TestObject testObject = new ObjectMapper().readValue(\"{\\\"text\\\":\\\"anything\\\"}\", TestObject.class);\n        Assertions.assertEquals(\"anything\", testObject.text());\n    }\n\n    private record TestObject(String text) {}\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">import</span> <span class=\"pl-s1\">com</span>.<span class=\"pl-s1\">fasterxml</span>.<span class=\"pl-s1\">jackson</span>.<span class=\"pl-s1\">core</span>.<span class=\"pl-s1\">JsonProcessingException</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">com</span>.<span class=\"pl-s1\">fasterxml</span>.<span class=\"pl-s1\">jackson</span>.<span class=\"pl-s1\">databind</span>.<span class=\"pl-s1\">ObjectMapper</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">junit</span>.<span class=\"pl-s1\">jupiter</span>.<span class=\"pl-s1\">api</span>.<span class=\"pl-s1\">Assertions</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">junit</span>.<span class=\"pl-s1\">jupiter</span>.<span class=\"pl-s1\">api</span>.<span class=\"pl-s1\">Tag</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">junit</span>.<span class=\"pl-s1\">jupiter</span>.<span class=\"pl-s1\">api</span>.<span class=\"pl-s1\">Test</span>;\n\n<span class=\"pl-k\">class</span> <span class=\"pl-smi\">TestObjectTest</span> {\n\n    <span class=\"pl-c1\">@</span><span class=\"pl-c1\">Test</span>\n    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">shouldDeserialize</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">JsonProcessingException</span> {\n        <span class=\"pl-smi\">TestObject</span> <span class=\"pl-s1\">testObject</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ObjectMapper</span>().<span class=\"pl-en\">readValue</span>(<span class=\"pl-s\">\"{<span class=\"pl-cce\">\\\"</span>text<span class=\"pl-cce\">\\\"</span>:<span class=\"pl-cce\">\\\"</span>anything<span class=\"pl-cce\">\\\"</span>}\"</span>, <span class=\"pl-smi\">TestObject</span>.<span class=\"pl-k\">class</span>);\n        <span class=\"pl-smi\">Assertions</span>.<span class=\"pl-en\">assertEquals</span>(<span class=\"pl-s\">\"anything\"</span>, <span class=\"pl-s1\">testObject</span>.<span class=\"pl-en\">text</span>());\n    }\n\n    <span class=\"pl-k\">private</span> record <span class=\"pl-s1\">TestObject</span>(<span class=\"pl-smi\">String</span> <span class=\"pl-s1\">text</span>) {}\n}</pre></div>\n<p dir=\"auto\">When I add compact constructor with <code class=\"notranslate\">@JsonCreator</code> to TestObject, it works correctly:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    private record TestObject(String text) {\n        @JsonCreator\n        private TestObject {\n        }\n    }\"><pre class=\"notranslate\">    <span class=\"pl-k\">private</span> record <span class=\"pl-s1\">TestObject</span>(<span class=\"pl-smi\">String</span> <span class=\"pl-s1\">text</span>) {\n        <span class=\"pl-c1\">@</span><span class=\"pl-c1\">JsonCreator</span>\n        <span class=\"pl-k\">private</span> <span class=\"pl-s1\">TestObject</span> {\n        }\n    }</pre></div>\n<h3 dir=\"auto\">Additional context</h3>\n<ul dir=\"auto\">\n<li>It works correctly in version 2.15.3</li>\n<li>tested on java 21</li>\n<li>May be related to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1902818147\" data-permission-text=\"Title is private\" data-url=\"https://github.com/FasterXML/jackson-databind/issues/4119\" data-hovercard-type=\"issue\" data-hovercard-url=\"/FasterXML/jackson-databind/issues/4119/hovercard\" href=\"https://github.com/FasterXML/jackson-databind/issues/4119\">#4119</a></li>\n</ul>",
  "description_text": "Search before asking\n\n I searched in the issues and found nothing similar.\n\nDescribe the bug\nWhen deserializing a record, jackson fails with\ncom.fasterxml.jackson.databind.exc.InvalidDefinitionException: Cannot construct instance of ... (no Creators, like default constructor, exist): cannot deserialize from Object value (no delegate- or property-based Creator)\n\nIt looks like jackson does not see default constructor.\nVersion Information\n2.16.0-rc1\nReproduction\nimport com.fasterxml.jackson.core.JsonProcessingException;\nimport com.fasterxml.jackson.databind.ObjectMapper;\nimport org.junit.jupiter.api.Assertions;\nimport org.junit.jupiter.api.Tag;\nimport org.junit.jupiter.api.Test;\n\nclass TestObjectTest {\n\n    @Test\n    public void shouldDeserialize() throws JsonProcessingException {\n        TestObject testObject = new ObjectMapper().readValue(\"{\\\"text\\\":\\\"anything\\\"}\", TestObject.class);\n        Assertions.assertEquals(\"anything\", testObject.text());\n    }\n\n    private record TestObject(String text) {}\n}\nWhen I add compact constructor with @JsonCreator to TestObject, it works correctly:\n    private record TestObject(String text) {\n        @JsonCreator\n        private TestObject {\n        }\n    }\nAdditional context\n\nIt works correctly in version 2.15.3\ntested on java 21\nMay be related to #4119\n"
}