{
  "issue_id": 2823,
  "issue_url": "https://github.com/mockito/mockito/issues/2823",
  "title": "AssertionError in `MockUtil.getMockHandlerOrNull` in our regression test suite",
  "description": "<p dir=\"auto\">We appear to be hitting the following assertion in our test suites: </p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/mockito/mockito/blob/e2e628918518b73de7381692f28556ac6caa4710/src/main/java/org/mockito/internal/util/MockUtil.java#L160\">mockito/src/main/java/org/mockito/internal/util/MockUtil.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n         Line 160\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/mockito/mockito/commit/e2e628918518b73de7381692f28556ac6caa4710\">e2e6289</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L160\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"160\"></td>\n          <td id=\"LC160\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">assert</span> <span class=\"pl-en\">getMockMaker</span>(<span class=\"pl-s1\">handler</span>.<span class=\"pl-en\">getMockSettings</span>().<span class=\"pl-en\">getMockMaker</span>()) == <span class=\"pl-s1\">mockMaker</span>; </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">Example error from <a href=\"https://github.com/mockito/mockito/actions/runs/3612965923/jobs/6088416494#logs\">the logs</a>:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"org.mockito.StaticMockingExperimentTest > stubbing_new FAILED\n    java.lang.AssertionError\n        at org.mockito.internal.util.MockUtil.getMockHandlerOrNull(MockUtil.java:160)\n        at org.mockito.internal.util.MockUtil.isMock(MockUtil.java:147)\n        at org.mockito.internal.util.DefaultMockingDetails.isMock(DefaultMockingDetails.java:32)\n        at org.mockito.internal.util.DefaultMockingDetails.assertGoodMock(DefaultMockingDetails.java:85)\n        at org.mockito.internal.util.DefaultMockingDetails.mockHandler(DefaultMockingDetails.java:77)\n        at org.mockito.internal.util.DefaultMockingDetails.getMockHandler(DefaultMockingDetails.java:68)\n        at org.mockito.StaticMockingExperimentTest.<init>(StaticMockingExperimentTest.java:44)\"><pre class=\"notranslate\"><code class=\"notranslate\">org.mockito.StaticMockingExperimentTest > stubbing_new FAILED\n    java.lang.AssertionError\n        at org.mockito.internal.util.MockUtil.getMockHandlerOrNull(MockUtil.java:160)\n        at org.mockito.internal.util.MockUtil.isMock(MockUtil.java:147)\n        at org.mockito.internal.util.DefaultMockingDetails.isMock(DefaultMockingDetails.java:32)\n        at org.mockito.internal.util.DefaultMockingDetails.assertGoodMock(DefaultMockingDetails.java:85)\n        at org.mockito.internal.util.DefaultMockingDetails.mockHandler(DefaultMockingDetails.java:77)\n        at org.mockito.internal.util.DefaultMockingDetails.getMockHandler(DefaultMockingDetails.java:68)\n        at org.mockito.StaticMockingExperimentTest.<init>(StaticMockingExperimentTest.java:44)\n</code></pre></div>\n<p dir=\"auto\">The assertion was introduced in <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1293522067\" data-permission-text=\"Title is private\" data-url=\"https://github.com/mockito/mockito/issues/2701\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/mockito/mockito/pull/2701/hovercard\" href=\"https://github.com/mockito/mockito/pull/2701\">#2701</a></p>",
  "description_text": "We appear to be hitting the following assertion in our test suites: \n\n\nmockito/src/main/java/org/mockito/internal/util/MockUtil.java\n\n\n         Line 160\n      in\n      e2e6289\n\n\n\n\n\n\n assert getMockMaker(handler.getMockSettings().getMockMaker()) == mockMaker; \n\n\n\n\n\nExample error from the logs:\norg.mockito.StaticMockingExperimentTest > stubbing_new FAILED\n    java.lang.AssertionError\n        at org.mockito.internal.util.MockUtil.getMockHandlerOrNull(MockUtil.java:160)\n        at org.mockito.internal.util.MockUtil.isMock(MockUtil.java:147)\n        at org.mockito.internal.util.DefaultMockingDetails.isMock(DefaultMockingDetails.java:32)\n        at org.mockito.internal.util.DefaultMockingDetails.assertGoodMock(DefaultMockingDetails.java:85)\n        at org.mockito.internal.util.DefaultMockingDetails.mockHandler(DefaultMockingDetails.java:77)\n        at org.mockito.internal.util.DefaultMockingDetails.getMockHandler(DefaultMockingDetails.java:68)\n        at org.mockito.StaticMockingExperimentTest.(StaticMockingExperimentTest.java:44)\n\nThe assertion was introduced in #2701"
}