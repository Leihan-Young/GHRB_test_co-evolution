{
  "issue_id": 12443,
  "issue_url": "https://github.com/checkstyle/checkstyle/issues/12443",
  "title": "checkstyle 10.3.3 and newer throws NullPointerException on annotated generic types from IllegalType rule",
  "description": "<p dir=\"auto\">I minimized my repro to narrow down the cause.</p>\n<p dir=\"auto\">The config:</p>\n<p dir=\"auto\"><code class=\"notranslate\">\u276f /bin/cat checkstyle-configuration.xml</code></p>\n<div class=\"highlight highlight-text-xml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"<?xml version=\"1.0\"?>\n<!DOCTYPE module PUBLIC\n        \"-//Checkstyle//DTD Checkstyle Configuration 1.3//EN\"\n        \"https://checkstyle.org/dtds/configuration_1_3.dtd\">\n\n<module name=\"Checker\">\n    <module name=\"TreeWalker\">\n        <module name=\"IllegalType\">\n            <property name=\"illegalClassNames\"\n                    value=\"java.lang.StringBuffer, \" />\n        </module>\n    </module>\n</module>\"><pre class=\"notranslate\"><?<span class=\"pl-ent\">xml</span><span class=\"pl-e\"> version</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>1.0<span class=\"pl-pds\">\"</span></span>?>\n<!<span class=\"pl-ent\">DOCTYPE</span> <span class=\"pl-e\">module</span> PUBLIC\n        \"-//Checkstyle//DTD Checkstyle Configuration 1.3//EN\"\n        \"https://checkstyle.org/dtds/configuration_1_3.dtd\">\n\n<<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Checker<span class=\"pl-pds\">\"</span></span>>\n    <<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>TreeWalker<span class=\"pl-pds\">\"</span></span>>\n        <<span class=\"pl-ent\">module</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>IllegalType<span class=\"pl-pds\">\"</span></span>>\n            <<span class=\"pl-ent\">property</span> <span class=\"pl-e\">name</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>illegalClassNames<span class=\"pl-pds\">\"</span></span>\n                    <span class=\"pl-e\">value</span>=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>java.lang.StringBuffer, <span class=\"pl-pds\">\"</span></span> />\n        </<span class=\"pl-ent\">module</span>>\n    </<span class=\"pl-ent\">module</span>>\n</<span class=\"pl-ent\">module</span>></pre></div>\n<p dir=\"auto\">The code:</p>\n<p dir=\"auto\"><code class=\"notranslate\">\u276f cat ExampleClass.java</code></p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"package com.example;\n\nimport java.util.List;\n\nimport javax.validation.constraints.Pattern;\n\npublic class ExampleClass\n{\n    public void example(List<@Pattern String> strings)\n    {\n    }\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">package</span> <span class=\"pl-s1\">com</span>.<span class=\"pl-s1\">example</span>;\n\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">java</span>.<span class=\"pl-s1\">util</span>.<span class=\"pl-s1\">List</span>;\n\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">javax</span>.<span class=\"pl-s1\">validation</span>.<span class=\"pl-s1\">constraints</span>.<span class=\"pl-s1\">Pattern</span>;\n\n<span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-smi\">ExampleClass</span>\n{\n    <span class=\"pl-k\">public</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">example</span>(<span class=\"pl-smi\">List</span><<span class=\"pl-c1\">@</span><span class=\"pl-c1\">Pattern</span> <span class=\"pl-smi\">String</span>> <span class=\"pl-s1\">strings</span>)\n    {\n    }\n}</pre></div>\n<div class=\"highlight highlight-source-shell notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"\u276f RUN_LOCALE=\"-Duser.language=en -Duser.country=US\"\n\u276f java $RUN_LOCALE -jar checkstyle-10.3.3-all.jar -c checkstyle-configuration.xml ExampleClass.java \nStarting audit...\ncom.puppycrawl.tools.checkstyle.api.CheckstyleException: Exception was thrown while processing ExampleClass.java\n\tat com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:307)\n\tat com.puppycrawl.tools.checkstyle.Checker.process(Checker.java:224)\n\tat com.puppycrawl.tools.checkstyle.Main.runCheckstyle(Main.java:416)\n\tat com.puppycrawl.tools.checkstyle.Main.runCli(Main.java:339)\n\tat com.puppycrawl.tools.checkstyle.Main.execute(Main.java:196)\n\tat com.puppycrawl.tools.checkstyle.Main.main(Main.java:131)\nCaused by: java.lang.NullPointerException: Cannot invoke \"com.puppycrawl.tools.checkstyle.api.DetailAST.getLineNo()\" because \"ast\" is null\n\tat com.puppycrawl.tools.checkstyle.api.AbstractCheck.log(AbstractCheck.java:276)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkIdent(IllegalTypeCheck.java:645)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkType(IllegalTypeCheck.java:674)\n\tat com.puppycrawl.tools.checkstyle.utils.TokenUtil.forEachChild(TokenUtil.java:244)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkTypeArguments(IllegalTypeCheck.java:719)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkType(IllegalTypeCheck.java:675)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkClassName(IllegalTypeCheck.java:633)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.visitParameterDef(IllegalTypeCheck.java:563)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.visitToken(IllegalTypeCheck.java:478)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.notifyVisit(TreeWalker.java:336)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.processIter(TreeWalker.java:407)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.walk(TreeWalker.java:274)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.processFiltered(TreeWalker.java:155)\n\tat com.puppycrawl.tools.checkstyle.api.AbstractFileSetCheck.process(AbstractFileSetCheck.java:98)\n\tat com.puppycrawl.tools.checkstyle.Checker.processFile(Checker.java:335)\n\tat com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:294)\n\t... 5 more\nCheckstyle ends with 1 errors.\n\n\u276f java $RUN_LOCALE -jar checkstyle-10.3.2-all.jar -c checkstyle-configuration.xml ExampleClass.java\nStarting audit...\nAudit done.\"><pre class=\"notranslate\">\u276f RUN_LOCALE=<span class=\"pl-s\"><span class=\"pl-pds\">\"</span>-Duser.language=en -Duser.country=US<span class=\"pl-pds\">\"</span></span>\n\u276f java <span class=\"pl-smi\">$RUN_LOCALE</span> -jar checkstyle-10.3.3-all.jar -c checkstyle-configuration.xml ExampleClass.java \nStarting audit...\ncom.puppycrawl.tools.checkstyle.api.CheckstyleException: Exception was thrown <span class=\"pl-k\">while</span> processing ExampleClass.java\n\tat com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:307)\n\tat com.puppycrawl.tools.checkstyle.Checker.process(Checker.java:224)\n\tat com.puppycrawl.tools.checkstyle.Main.runCheckstyle(Main.java:416)\n\tat com.puppycrawl.tools.checkstyle.Main.runCli(Main.java:339)\n\tat com.puppycrawl.tools.checkstyle.Main.execute(Main.java:196)\n\tat com.puppycrawl.tools.checkstyle.Main.main(Main.java:131)\nCaused by: java.lang.NullPointerException: Cannot invoke <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>com.puppycrawl.tools.checkstyle.api.DetailAST.getLineNo()<span class=\"pl-pds\">\"</span></span> because <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>ast<span class=\"pl-pds\">\"</span></span> is null\n\tat com.puppycrawl.tools.checkstyle.api.AbstractCheck.log(AbstractCheck.java:276)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkIdent(IllegalTypeCheck.java:645)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkType(IllegalTypeCheck.java:674)\n\tat com.puppycrawl.tools.checkstyle.utils.TokenUtil.forEachChild(TokenUtil.java:244)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkTypeArguments(IllegalTypeCheck.java:719)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkType(IllegalTypeCheck.java:675)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkClassName(IllegalTypeCheck.java:633)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.visitParameterDef(IllegalTypeCheck.java:563)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.visitToken(IllegalTypeCheck.java:478)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.notifyVisit(TreeWalker.java:336)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.processIter(TreeWalker.java:407)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.walk(TreeWalker.java:274)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.processFiltered(TreeWalker.java:155)\n\tat com.puppycrawl.tools.checkstyle.api.AbstractFileSetCheck.process(AbstractFileSetCheck.java:98)\n\tat com.puppycrawl.tools.checkstyle.Checker.processFile(Checker.java:335)\n\tat com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:294)\n\t... 5 more\nCheckstyle ends with 1 errors.\n\n\u276f java <span class=\"pl-smi\">$RUN_LOCALE</span> -jar checkstyle-10.3.2-all.jar -c checkstyle-configuration.xml ExampleClass.java\nStarting audit...\nAudit done.</pre></div>\n<hr>\n<p dir=\"auto\">Note that any little change to the config file prevents this problem. Even getting rid of the trailing comma or space at the end of StringBuffer in <code class=\"notranslate\"><property name=\"illegalClassNames\" value=\"java.lang.StringBuffer, \" /></code> prevents the problem.</p>\n<hr>",
  "description_text": "I minimized my repro to narrow down the cause.\nThe config:\n\u276f /bin/cat checkstyle-configuration.xml\n\n\n\n\n\n\n\n\n\">xml version=\"1.0\"?>\nDOCTYPE module PUBLIC\n        \"-//Checkstyle//DTD Checkstyle Configuration 1.3//EN\"\n        \"https://checkstyle.org/dtds/configuration_1_3.dtd\">\n\n<module name=\"Checker\">\n    <module name=\"TreeWalker\">\n        <module name=\"IllegalType\">\n            <property name=\"illegalClassNames\"\n                    value=\"java.lang.StringBuffer, \" />\n        module>\n    module>\nmodule>\nThe code:\n\u276f cat ExampleClass.java\npackage com.example;\n\nimport java.util.List;\n\nimport javax.validation.constraints.Pattern;\n\npublic class ExampleClass\n{\n    public void example(List<@Pattern String> strings)\n    {\n    }\n}\n\u276f RUN_LOCALE=\"-Duser.language=en -Duser.country=US\"\n\u276f java $RUN_LOCALE -jar checkstyle-10.3.3-all.jar -c checkstyle-configuration.xml ExampleClass.java \nStarting audit...\ncom.puppycrawl.tools.checkstyle.api.CheckstyleException: Exception was thrown while processing ExampleClass.java\n\tat com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:307)\n\tat com.puppycrawl.tools.checkstyle.Checker.process(Checker.java:224)\n\tat com.puppycrawl.tools.checkstyle.Main.runCheckstyle(Main.java:416)\n\tat com.puppycrawl.tools.checkstyle.Main.runCli(Main.java:339)\n\tat com.puppycrawl.tools.checkstyle.Main.execute(Main.java:196)\n\tat com.puppycrawl.tools.checkstyle.Main.main(Main.java:131)\nCaused by: java.lang.NullPointerException: Cannot invoke \"com.puppycrawl.tools.checkstyle.api.DetailAST.getLineNo()\" because \"ast\" is null\n\tat com.puppycrawl.tools.checkstyle.api.AbstractCheck.log(AbstractCheck.java:276)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkIdent(IllegalTypeCheck.java:645)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkType(IllegalTypeCheck.java:674)\n\tat com.puppycrawl.tools.checkstyle.utils.TokenUtil.forEachChild(TokenUtil.java:244)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkTypeArguments(IllegalTypeCheck.java:719)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkType(IllegalTypeCheck.java:675)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.checkClassName(IllegalTypeCheck.java:633)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.visitParameterDef(IllegalTypeCheck.java:563)\n\tat com.puppycrawl.tools.checkstyle.checks.coding.IllegalTypeCheck.visitToken(IllegalTypeCheck.java:478)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.notifyVisit(TreeWalker.java:336)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.processIter(TreeWalker.java:407)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.walk(TreeWalker.java:274)\n\tat com.puppycrawl.tools.checkstyle.TreeWalker.processFiltered(TreeWalker.java:155)\n\tat com.puppycrawl.tools.checkstyle.api.AbstractFileSetCheck.process(AbstractFileSetCheck.java:98)\n\tat com.puppycrawl.tools.checkstyle.Checker.processFile(Checker.java:335)\n\tat com.puppycrawl.tools.checkstyle.Checker.processFiles(Checker.java:294)\n\t... 5 more\nCheckstyle ends with 1 errors.\n\n\u276f java $RUN_LOCALE -jar checkstyle-10.3.2-all.jar -c checkstyle-configuration.xml ExampleClass.java\nStarting audit...\nAudit done.\n\nNote that any little change to the config file prevents this problem. Even getting rid of the trailing comma or space at the end of StringBuffer in  prevents the problem.\n"
}