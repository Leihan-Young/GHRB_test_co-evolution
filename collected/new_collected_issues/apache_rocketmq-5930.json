{
  "issue_id": 5929,
  "issue_url": "https://github.com/apache/rocketmq/issues/5929",
  "title": " The broker send heartbeat to controller frequently causing thread blocking when the network partition",
  "description": "<p dir=\"auto\">The issue tracker is used for bug reporting purposes <strong>ONLY</strong> whereas feature request needs to follow the <a href=\"https://github.com/apache/rocketmq/wiki/RocketMQ-Improvement-Proposal\">RIP process</a>. To avoid unnecessary duplication, please check whether there is a previous issue before filing a new one.</p>\n<p dir=\"auto\">It is recommended to start a discussion thread in the <a href=\"http://rocketmq.apache.org/about/contact/\" rel=\"nofollow\">mailing lists</a> in cases of discussing your deployment plan, API clarification, and other non-bug-reporting issues.<br>\nWe welcome any friendly suggestions, bug fixes, collaboration, and other improvements.</p>\n<p dir=\"auto\">Please ensure that your bug report is clear and self-contained. Otherwise, it would take additional rounds of communication, thus more time, to understand the problem itself.</p>\n<p dir=\"auto\">Generally, fixing an issue goes through the following steps:</p>\n<ol dir=\"auto\">\n<li>Understand the issue reported;</li>\n<li>Reproduce the unexpected behavior locally;</li>\n<li>Perform root cause analysis to identify the underlying problem;</li>\n<li>Create test cases to cover the identified problem;</li>\n<li>Work out a solution to rectify the behavior and make the newly created test cases pass;</li>\n<li>Make a pull request and go through peer review;</li>\n</ol>\n<p dir=\"auto\">As a result, it would be very helpful yet challenging if you could provide an isolated project reproducing your reported issue. Anyway, please ensure your issue report is informative enough for the community to pick up. At a minimum, include the following hints:</p>\n<p dir=\"auto\"><strong>BUG REPORT</strong></p>\n<ol dir=\"auto\">\n<li>Please describe the issue you observed:</li>\n</ol>\n<ul dir=\"auto\">\n<li>What did you do (The steps to reproduce)?</li>\n</ul>\n<p dir=\"auto\">Simulate the network partition of brokers and individual controllers</p>\n<ul dir=\"auto\">\n<li>What is expected to see?</li>\n</ul>\n<p dir=\"auto\">The heartbeat works normally</p>\n<ul dir=\"auto\">\n<li>What did you see instead?</li>\n</ul>\n<p dir=\"auto\">Heartbeat timeout occurred</p>\n<ol start=\"2\" dir=\"auto\">\n<li>\n<p dir=\"auto\">Please tell us about your environment:</p>\n</li>\n<li>\n<p dir=\"auto\">Other information (e.g. detailed explanation, logs, related issues, suggestions on how to fix, etc):</p>\n</li>\n</ol>\n<p dir=\"auto\">Although the heartbeat uses invokeOneWay, the network partition causes the connection to be broken. Every time the connection is established, there will still be a synchronized 3s timeout, which will cause the thread in the thread pool to be blocked.</p>\n<p dir=\"auto\"><a target=\"_blank\" rel=\"noopener noreferrer nofollow\" href=\"https://user-images.githubusercontent.com/21963954/214749464-4476b7a5-ee57-4dfb-8d9f-b0372767766e.png\"><img src=\"https://user-images.githubusercontent.com/21963954/214749464-4476b7a5-ee57-4dfb-8d9f-b0372767766e.png\" alt=\"image\" style=\"max-width: 100%;\"></a></p>",
  "description_text": "The issue tracker is used for bug reporting purposes ONLY whereas feature request needs to follow the RIP process. To avoid unnecessary duplication, please check whether there is a previous issue before filing a new one.\nIt is recommended to start a discussion thread in the mailing lists in cases of discussing your deployment plan, API clarification, and other non-bug-reporting issues.\nWe welcome any friendly suggestions, bug fixes, collaboration, and other improvements.\nPlease ensure that your bug report is clear and self-contained. Otherwise, it would take additional rounds of communication, thus more time, to understand the problem itself.\nGenerally, fixing an issue goes through the following steps:\n\nUnderstand the issue reported;\nReproduce the unexpected behavior locally;\nPerform root cause analysis to identify the underlying problem;\nCreate test cases to cover the identified problem;\nWork out a solution to rectify the behavior and make the newly created test cases pass;\nMake a pull request and go through peer review;\n\nAs a result, it would be very helpful yet challenging if you could provide an isolated project reproducing your reported issue. Anyway, please ensure your issue report is informative enough for the community to pick up. At a minimum, include the following hints:\nBUG REPORT\n\nPlease describe the issue you observed:\n\n\nWhat did you do (The steps to reproduce)?\n\nSimulate the network partition of brokers and individual controllers\n\nWhat is expected to see?\n\nThe heartbeat works normally\n\nWhat did you see instead?\n\nHeartbeat timeout occurred\n\n\nPlease tell us about your environment:\n\n\nOther information (e.g. detailed explanation, logs, related issues, suggestions on how to fix, etc):\n\n\nAlthough the heartbeat uses invokeOneWay, the network partition causes the connection to be broken. Every time the connection is established, there will still be a synchronized 3s timeout, which will cause the thread in the thread pool to be blocked.\n"
}