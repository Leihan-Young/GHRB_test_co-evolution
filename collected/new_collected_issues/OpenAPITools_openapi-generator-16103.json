{
  "issue_id": 9444,
  "issue_url": "https://github.com/OpenAPITools/openapi-generator/issues/9444",
  "title": "[JAVA] Bug generating model when discrimator is \"_type\" and a property called \"type\" also present in response schema",
  "description": "<h4 dir=\"auto\">Bug Report Checklist</h4>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you provided a full/minimal spec to reproduce the issue?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you validated the input using an OpenAPI validator (<a href=\"https://apidevtools.org/swagger-parser/online/\" rel=\"nofollow\">example</a>)?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you <a href=\"https://github.com/OpenAPITools/openapi-generator/wiki/FAQ#how-to-test-with-the-latest-master-of-openapi-generator\">tested with the latest master</a> to confirm the issue still exists?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you searched for related issues/PRs?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> What's the actual output vs expected output?</li>\n</ul>\n<h5 dir=\"auto\">Description</h5>\n<p dir=\"auto\">So I am posting a snippet of a message from my schema. The problem with this schema is that the discriminator begins with an underscore followed by a name that is also a property in this particular message i.e. _type and type are present in this schema.</p>\n<p dir=\"auto\">I can't change the discriminator to some other value as this will break existing client codes and we don't want to break existing client at the cost of being freshly able to generate open api clients.</p>\n<p dir=\"auto\">So when I generate the code for my open-api specifications, I get an uncompilable java code.</p>\n<h5 dir=\"auto\">openapi-generator version</h5>\n<p dir=\"auto\">openapi-generator-cli-5.1.1</p>\n<h5 dir=\"auto\">OpenAPI declaration file content or url</h5>\n<p dir=\"auto\">Following is a cut down definition that demonstrates my problem:</p>\n<div class=\"highlight highlight-source-yaml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"openapi: 3.0.1\ninfo:\n  title: Rest API\n  description: \"This is the Restful API server.\"\n  version: 1.0.0\nservers:\n- url: http://localhost:8080/\n  description: Generated server url\npaths:\n  /test:\n    get:\n      summary: Summary\n      description: Description\n      operationId: test\n      responses:\n        \"200\":\n          description: OK\n          content:\n            '*/*':\n              schema:\n                $ref: '#/components/schemas/Message'\ncomponents:\n  schemas:\n    Message:\n      required:\n      - _type\n      - text\n      type: object\n      properties:\n        type:\n          type: string\n          description: Type of this message.\n          enum:\n          - STATUS\n          - TEXT\n          - ERROR\n          - PROGRESS\n        subType:\n          type: string\n          description: Sub-type of this message.\n          enum:\n          - STATUS\n          - LOCK\n          - UNKNOWN\n        _type:\n          type: string\n      discriminator:\n        propertyName: _type\n\n\"><pre class=\"notranslate\"><span class=\"pl-ent\">openapi</span>: <span class=\"pl-s\">3.0.1</span>\n<span class=\"pl-ent\">info</span>:\n  <span class=\"pl-ent\">title</span>: <span class=\"pl-s\">Rest API</span>\n  <span class=\"pl-ent\">description</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>This is the Restful API server.<span class=\"pl-pds\">\"</span></span>\n  <span class=\"pl-ent\">version</span>: <span class=\"pl-s\">1.0.0</span>\n<span class=\"pl-ent\">servers</span>:\n- <span class=\"pl-ent\">url</span>: <span class=\"pl-s\">http://localhost:8080/</span>\n  <span class=\"pl-ent\">description</span>: <span class=\"pl-s\">Generated server url</span>\n<span class=\"pl-ent\">paths</span>:\n  <span class=\"pl-ent\">/test</span>:\n    <span class=\"pl-ent\">get</span>:\n      <span class=\"pl-ent\">summary</span>: <span class=\"pl-s\">Summary</span>\n      <span class=\"pl-ent\">description</span>: <span class=\"pl-s\">Description</span>\n      <span class=\"pl-ent\">operationId</span>: <span class=\"pl-s\">test</span>\n      <span class=\"pl-ent\">responses</span>:\n        <span class=\"pl-s\"><span class=\"pl-pds\">\"</span><span class=\"pl-ent\">200</span><span class=\"pl-pds\">\"</span></span>:\n          <span class=\"pl-ent\">description</span>: <span class=\"pl-s\">OK</span>\n          <span class=\"pl-ent\">content</span>:\n            <span class=\"pl-s\"><span class=\"pl-pds\">'</span><span class=\"pl-ent\">*/*</span><span class=\"pl-pds\">'</span></span>:\n              <span class=\"pl-ent\">schema</span>:\n                <span class=\"pl-ent\">$ref</span>: <span class=\"pl-s\"><span class=\"pl-pds\">'</span>#/components/schemas/Message<span class=\"pl-pds\">'</span></span>\n<span class=\"pl-ent\">components</span>:\n  <span class=\"pl-ent\">schemas</span>:\n    <span class=\"pl-ent\">Message</span>:\n      <span class=\"pl-ent\">required</span>:\n      - <span class=\"pl-s\">_type</span>\n      - <span class=\"pl-s\">text</span>\n      <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">object</span>\n      <span class=\"pl-ent\">properties</span>:\n        <span class=\"pl-ent\">type</span>:\n          <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">string</span>\n          <span class=\"pl-ent\">description</span>: <span class=\"pl-s\">Type of this message.</span>\n          <span class=\"pl-ent\">enum</span>:\n          - <span class=\"pl-s\">STATUS</span>\n          - <span class=\"pl-s\">TEXT</span>\n          - <span class=\"pl-s\">ERROR</span>\n          - <span class=\"pl-s\">PROGRESS</span>\n        <span class=\"pl-ent\">subType</span>:\n          <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">string</span>\n          <span class=\"pl-ent\">description</span>: <span class=\"pl-s\">Sub-type of this message.</span>\n          <span class=\"pl-ent\">enum</span>:\n          - <span class=\"pl-s\">STATUS</span>\n          - <span class=\"pl-s\">LOCK</span>\n          - <span class=\"pl-s\">UNKNOWN</span>\n        <span class=\"pl-ent\">_type</span>:\n          <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">string</span>\n      <span class=\"pl-ent\">discriminator</span>:\n        <span class=\"pl-ent\">propertyName</span>: <span class=\"pl-s\">_type</span>\n\n</pre></div>\n<h5 dir=\"auto\">Command line used for generation</h5>\n<p dir=\"auto\">openapi-generator-cli generate <br>\n--input-spec \"${DIR}\"/api-docs.yaml <br>\n--generator-name java <br>\n--output \"${JAVA_SRC_DIR}\"/rest_client_with_resttemplate <br>\n--verbose <br>\n--config \"${JAVA_CONFIG_DIR}\"/resttemplate.json <br>\n--global-property debugModels=true</p>\n<div class=\"highlight highlight-source-json notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"Contents of resttemplate.json: \n{\n  \"dateLibrary\": \"java8\",\n  \"library\": \"resttemplate\",\n  \"modelPackage\": \"model\",\n  \"apiPackage\": \"api\",\n  \"invokerPackage\": \"restapi.client\"\n}\"><pre class=\"notranslate\"><span class=\"pl-ii\">Contents of resttemplate.json: </span>\n{\n  <span class=\"pl-ent\">\"dateLibrary\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>java8<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-ent\">\"library\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>resttemplate<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-ent\">\"modelPackage\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>model<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-ent\">\"apiPackage\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>api<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-ent\">\"invokerPackage\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>restapi.client<span class=\"pl-pds\">\"</span></span>\n}</pre></div>\n<h5 dir=\"auto\">Steps to reproduce</h5>\n<p dir=\"auto\">Generate the code given the command line and load the project in any editor. The Message.java file generated will show the problem how it is uncompilable,</p>\n<h5 dir=\"auto\">Generated Code Description</h5>\n<p dir=\"auto\">The generated code is tripping on _type and type.</p>\n<p dir=\"auto\">It generates wrongly as below:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@JsonPropertyOrder({\n  Message.JSON_PROPERTY_TYPE,\n  Message.JSON_PROPERTY_SUB_TYPE,\n  Message.JSON_PROPERTY_TYPE\n})\n  public static final String JSON_PROPERTY_TYPE = \"type\";\n  private TypeEnum type;\n  public static final String JSON_PROPERTY_TYPE = \"_type\";\n  protected String type;\n\n  public String getType() {\n    return type;\n  }\n  public String getType() {\n    return type;\n  }\"><pre class=\"notranslate\"><span class=\"pl-c1\">@</span><span class=\"pl-c1\">JsonPropertyOrder</span>({\n  <span class=\"pl-smi\">Message</span>.<span class=\"pl-c1\">JSON_PROPERTY_TYPE</span>,\n  <span class=\"pl-smi\">Message</span>.<span class=\"pl-c1\">JSON_PROPERTY_SUB_TYPE</span>,\n  <span class=\"pl-smi\">Message</span>.<span class=\"pl-c1\">JSON_PROPERTY_TYPE</span>\n})\n  <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-c1\">JSON_PROPERTY_TYPE</span> = <span class=\"pl-s\">\"type\"</span>;\n  <span class=\"pl-k\">private</span> <span class=\"pl-smi\">TypeEnum</span> <span class=\"pl-s1\">type</span>;\n  <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-c1\">JSON_PROPERTY_TYPE</span> = <span class=\"pl-s\">\"_type\"</span>;\n  <span class=\"pl-k\">protected</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">type</span>;\n\n  <span class=\"pl-k\">public</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">getType</span>() {\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">type</span>;\n  }\n  <span class=\"pl-k\">public</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">getType</span>() {\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">type</span>;\n  }</pre></div>\n<p dir=\"auto\">whereas it should be maybe something like:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"@JsonPropertyOrder({\n  Message.JSON_PROPERTY_TYPE,\n  Message.JSON_PROPERTY_SUB_TYPE,\n  Message.JSON_PROPERTY__TYPE\n})\n  public static final String JSON_PROPERTY_TYPE = \"type\";\n  private TypeEnum type;\n  public static final String JSON_PROPERTY__TYPE = \"_type\";\n  protected String _type;\n\n  public TypeEnum getType() {\n    return type;\n  }\n  public String get_Type() {\n    return _type;\n  }\"><pre class=\"notranslate\"><span class=\"pl-c1\">@</span><span class=\"pl-c1\">JsonPropertyOrder</span>({\n  <span class=\"pl-smi\">Message</span>.<span class=\"pl-c1\">JSON_PROPERTY_TYPE</span>,\n  <span class=\"pl-smi\">Message</span>.<span class=\"pl-c1\">JSON_PROPERTY_SUB_TYPE</span>,\n  <span class=\"pl-smi\">Message</span>.<span class=\"pl-c1\">JSON_PROPERTY__TYPE</span>\n})\n  <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-c1\">JSON_PROPERTY_TYPE</span> = <span class=\"pl-s\">\"type\"</span>;\n  <span class=\"pl-k\">private</span> <span class=\"pl-smi\">TypeEnum</span> <span class=\"pl-s1\">type</span>;\n  <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-k\">final</span> <span class=\"pl-smi\">String</span> <span class=\"pl-c1\">JSON_PROPERTY__TYPE</span> = <span class=\"pl-s\">\"_type\"</span>;\n  <span class=\"pl-k\">protected</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">_type</span>;\n\n  <span class=\"pl-k\">public</span> <span class=\"pl-smi\">TypeEnum</span> <span class=\"pl-s1\">getType</span>() {\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">type</span>;\n  }\n  <span class=\"pl-k\">public</span> <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">get_Type</span>() {\n    <span class=\"pl-k\">return</span> <span class=\"pl-s1\">_type</span>;\n  }</pre></div>\n<h5 dir=\"auto\">Suggest a fix/enhancement</h5>\n<p dir=\"auto\">I looked at the moustache templates. No expert here, but maybe the \"nameInSnakeCase\" is the culprit in pojo.moustasche. I just searched the string \"JSON_PROPERTY_\" and the following lines poped up:</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"  {{classname}}.JSON_PROPERTY_{{nameInSnakeCase}}{{^-last}},{{/-last}}\"><pre class=\"notranslate\">  {{<span class=\"pl-s1\">classname</span>}}.<span class=\"pl-c1\">JSON_PROPERTY_</span>{{<span class=\"pl-s1\">nameInSnakeCase</span>}}{{^-<span class=\"pl-s1\">last</span>}},{{/-<span class=\"pl-s1\">last</span>}}</pre></div>\n<p dir=\"auto\">Must be other places also as variable is wrong at a couple of places.</p>\n<p dir=\"auto\">Let me know if something is missing in bug report.</p>",
  "description_text": "Bug Report Checklist\n\n Have you provided a full/minimal spec to reproduce the issue?\n Have you validated the input using an OpenAPI validator (example)?\n Have you tested with the latest master to confirm the issue still exists?\n Have you searched for related issues/PRs?\n What's the actual output vs expected output?\n\nDescription\nSo I am posting a snippet of a message from my schema. The problem with this schema is that the discriminator begins with an underscore followed by a name that is also a property in this particular message i.e. _type and type are present in this schema.\nI can't change the discriminator to some other value as this will break existing client codes and we don't want to break existing client at the cost of being freshly able to generate open api clients.\nSo when I generate the code for my open-api specifications, I get an uncompilable java code.\nopenapi-generator version\nopenapi-generator-cli-5.1.1\nOpenAPI declaration file content or url\nFollowing is a cut down definition that demonstrates my problem:\nopenapi: 3.0.1\ninfo:\n  title: Rest API\n  description: \"This is the Restful API server.\"\n  version: 1.0.0\nservers:\n- url: http://localhost:8080/\n  description: Generated server url\npaths:\n  /test:\n    get:\n      summary: Summary\n      description: Description\n      operationId: test\n      responses:\n        \"200\":\n          description: OK\n          content:\n            '*/*':\n              schema:\n                $ref: '#/components/schemas/Message'\ncomponents:\n  schemas:\n    Message:\n      required:\n      - _type\n      - text\n      type: object\n      properties:\n        type:\n          type: string\n          description: Type of this message.\n          enum:\n          - STATUS\n          - TEXT\n          - ERROR\n          - PROGRESS\n        subType:\n          type: string\n          description: Sub-type of this message.\n          enum:\n          - STATUS\n          - LOCK\n          - UNKNOWN\n        _type:\n          type: string\n      discriminator:\n        propertyName: _type\n\n\nCommand line used for generation\nopenapi-generator-cli generate \n--input-spec \"${DIR}\"/api-docs.yaml \n--generator-name java \n--output \"${JAVA_SRC_DIR}\"/rest_client_with_resttemplate \n--verbose \n--config \"${JAVA_CONFIG_DIR}\"/resttemplate.json \n--global-property debugModels=true\nContents of resttemplate.json: \n{\n  \"dateLibrary\": \"java8\",\n  \"library\": \"resttemplate\",\n  \"modelPackage\": \"model\",\n  \"apiPackage\": \"api\",\n  \"invokerPackage\": \"restapi.client\"\n}\nSteps to reproduce\nGenerate the code given the command line and load the project in any editor. The Message.java file generated will show the problem how it is uncompilable,\nGenerated Code Description\nThe generated code is tripping on _type and type.\nIt generates wrongly as below:\n@JsonPropertyOrder({\n  Message.JSON_PROPERTY_TYPE,\n  Message.JSON_PROPERTY_SUB_TYPE,\n  Message.JSON_PROPERTY_TYPE\n})\n  public static final String JSON_PROPERTY_TYPE = \"type\";\n  private TypeEnum type;\n  public static final String JSON_PROPERTY_TYPE = \"_type\";\n  protected String type;\n\n  public String getType() {\n    return type;\n  }\n  public String getType() {\n    return type;\n  }\nwhereas it should be maybe something like:\n@JsonPropertyOrder({\n  Message.JSON_PROPERTY_TYPE,\n  Message.JSON_PROPERTY_SUB_TYPE,\n  Message.JSON_PROPERTY__TYPE\n})\n  public static final String JSON_PROPERTY_TYPE = \"type\";\n  private TypeEnum type;\n  public static final String JSON_PROPERTY__TYPE = \"_type\";\n  protected String _type;\n\n  public TypeEnum getType() {\n    return type;\n  }\n  public String get_Type() {\n    return _type;\n  }\nSuggest a fix/enhancement\nI looked at the moustache templates. No expert here, but maybe the \"nameInSnakeCase\" is the culprit in pojo.moustasche. I just searched the string \"JSON_PROPERTY_\" and the following lines poped up:\n  {{classname}}.JSON_PROPERTY_{{nameInSnakeCase}}{{^-last}},{{/-last}}\nMust be other places also as variable is wrong at a couple of places.\nLet me know if something is missing in bug report."
}