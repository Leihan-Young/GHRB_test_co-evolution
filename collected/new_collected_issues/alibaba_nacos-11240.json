{
  "issue_id": 11231,
  "issue_url": "https://github.com/alibaba/nacos/issues/11231",
  "title": "Why is reflection used in the PropertiesUtil method?",
  "description": "<p dir=\"auto\"></p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/alibaba/nacos/blob/f3fb4284524222b752cefbc98e93f64101e632f3/sys/src/main/java/com/alibaba/nacos/sys/utils/PropertiesUtil.java#L53-L63\">nacos/sys/src/main/java/com/alibaba/nacos/sys/utils/PropertiesUtil.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 53 to 63\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/alibaba/nacos/commit/f3fb4284524222b752cefbc98e93f64101e632f3\">f3fb428</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L53\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"53\"></td>\n          <td id=\"LC53\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <<span class=\"pl-smi\">T</span>> <span class=\"pl-smi\">T</span> <span class=\"pl-en\">handleSpringBinder</span>(<span class=\"pl-smi\">Environment</span> <span class=\"pl-s1\">environment</span>, <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">prefix</span>, <span class=\"pl-smi\">Class</span><<span class=\"pl-smi\">T</span>> <span class=\"pl-s1\">targetClass</span>) </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L54\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"54\"></td>\n          <td id=\"LC54\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">         <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">NoSuchMethodException</span>, <span class=\"pl-smi\">IllegalAccessException</span>, <span class=\"pl-smi\">InvocationTargetException</span>, <span class=\"pl-smi\">ClassNotFoundException</span> { </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L55\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"55\"></td>\n          <td id=\"LC55\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">Class</span><?> <span class=\"pl-s1\">binderClass</span> = <span class=\"pl-smi\">Class</span>.<span class=\"pl-en\">forName</span>(<span class=\"pl-s\">\"org.springframework.boot.context.properties.bind.Binder\"</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L56\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"56\"></td>\n          <td id=\"LC56\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">Method</span> <span class=\"pl-s1\">getMethod</span> = <span class=\"pl-s1\">binderClass</span>.<span class=\"pl-en\">getDeclaredMethod</span>(<span class=\"pl-s\">\"get\"</span>, <span class=\"pl-smi\">Environment</span>.<span class=\"pl-k\">class</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L57\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"57\"></td>\n          <td id=\"LC57\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">Method</span> <span class=\"pl-s1\">bindMethod</span> = <span class=\"pl-s1\">binderClass</span>.<span class=\"pl-en\">getDeclaredMethod</span>(<span class=\"pl-s\">\"bind\"</span>, <span class=\"pl-smi\">String</span>.<span class=\"pl-k\">class</span>, <span class=\"pl-smi\">Class</span>.<span class=\"pl-k\">class</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L58\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"58\"></td>\n          <td id=\"LC58\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">Object</span> <span class=\"pl-s1\">binderObject</span> = <span class=\"pl-s1\">getMethod</span>.<span class=\"pl-en\">invoke</span>(<span class=\"pl-c1\">null</span>, <span class=\"pl-s1\">environment</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L59\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"59\"></td>\n          <td id=\"LC59\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">prefixParam</span> = <span class=\"pl-s1\">prefix</span>.<span class=\"pl-en\">endsWith</span>(<span class=\"pl-s\">\".\"</span>) ? <span class=\"pl-s1\">prefix</span>.<span class=\"pl-en\">substring</span>(<span class=\"pl-c1\">0</span>, <span class=\"pl-s1\">prefix</span>.<span class=\"pl-en\">length</span>() - <span class=\"pl-c1\">1</span>) : <span class=\"pl-s1\">prefix</span>; </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L60\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"60\"></td>\n          <td id=\"LC60\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">Object</span> <span class=\"pl-s1\">bindResultObject</span> = <span class=\"pl-s1\">bindMethod</span>.<span class=\"pl-en\">invoke</span>(<span class=\"pl-s1\">binderObject</span>, <span class=\"pl-s1\">prefixParam</span>, <span class=\"pl-s1\">targetClass</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L61\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"61\"></td>\n          <td id=\"LC61\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-smi\">Method</span> <span class=\"pl-s1\">resultGetMethod</span> = <span class=\"pl-s1\">bindResultObject</span>.<span class=\"pl-en\">getClass</span>().<span class=\"pl-en\">getDeclaredMethod</span>(<span class=\"pl-s\">\"get\"</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L62\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"62\"></td>\n          <td id=\"LC62\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\">     <span class=\"pl-k\">return</span> (<span class=\"pl-smi\">T</span>) <span class=\"pl-s1\">resultGetMethod</span>.<span class=\"pl-en\">invoke</span>(<span class=\"pl-s1\">bindResultObject</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L63\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"63\"></td>\n          <td id=\"LC63\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> } </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">Wouldn't it be better to replace it this way?</p>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    public static <T> T handleSpringBinder(Environment environment, String prefix, Class<T> targetClass)\n            throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, ClassNotFoundException {\n        String prefixParam = prefix.endsWith(\".\") ? prefix.substring(0, prefix.length() - 1) : prefix;\n        Binder binder = Binder.get(environment);\n        return binder.bind(prefixParam, targetClass).orElse(null);\n    }\"><pre class=\"notranslate\">    <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <<span class=\"pl-smi\">T</span>> <span class=\"pl-s1\">T</span> <span class=\"pl-en\">handleSpringBinder</span>(<span class=\"pl-smi\">Environment</span> <span class=\"pl-s1\">environment</span>, <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">prefix</span>, <span class=\"pl-s1\">Class</span><<span class=\"pl-s1\">T</span>> <span class=\"pl-s1\">targetClass</span>)\n            <span class=\"pl-smi\">throws</span> <span class=\"pl-s1\">NoSuchMethodException</span>, <span class=\"pl-s1\">IllegalAccessException</span>, <span class=\"pl-s1\">InvocationTargetException</span>, <span class=\"pl-s1\">ClassNotFoundException</span> {\n        <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">prefixParam</span> = <span class=\"pl-s1\">prefix</span>.<span class=\"pl-en\">endsWith</span>(<span class=\"pl-s\">\".\"</span>) ? <span class=\"pl-s1\">prefix</span>.<span class=\"pl-en\">substring</span>(<span class=\"pl-c1\">0</span>, <span class=\"pl-s1\">prefix</span>.<span class=\"pl-en\">length</span>() - <span class=\"pl-c1\">1</span>) : <span class=\"pl-s1\">prefix</span>;\n        <span class=\"pl-smi\">Binder</span> <span class=\"pl-s1\">binder</span> = <span class=\"pl-smi\">Binder</span>.<span class=\"pl-en\">get</span>(<span class=\"pl-s1\">environment</span>);\n        <span class=\"pl-k\">return</span> <span class=\"pl-s1\">binder</span>.<span class=\"pl-en\">bind</span>(<span class=\"pl-s1\">prefixParam</span>, <span class=\"pl-s1\">targetClass</span>).<span class=\"pl-en\">orElse</span>(<span class=\"pl-c1\">null</span>);\n    }</pre></div>",
  "description_text": "\n\n\nnacos/sys/src/main/java/com/alibaba/nacos/sys/utils/PropertiesUtil.java\n\n\n        Lines 53 to 63\n      in\n      f3fb428\n\n\n\n\n\n\n public static <T> T handleSpringBinder(Environment environment, String prefix, Class<T> targetClass) \n\n\n\n throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, ClassNotFoundException { \n\n\n\n Class binderClass = Class.forName(\"org.springframework.boot.context.properties.bind.Binder\"); \n\n\n\n Method getMethod = binderClass.getDeclaredMethod(\"get\", Environment.class); \n\n\n\n Method bindMethod = binderClass.getDeclaredMethod(\"bind\", String.class, Class.class); \n\n\n\n Object binderObject = getMethod.invoke(null, environment); \n\n\n\n String prefixParam = prefix.endsWith(\".\") ? prefix.substring(0, prefix.length() - 1) : prefix; \n\n\n\n Object bindResultObject = bindMethod.invoke(binderObject, prefixParam, targetClass); \n\n\n\n Method resultGetMethod = bindResultObject.getClass().getDeclaredMethod(\"get\"); \n\n\n\n return (T) resultGetMethod.invoke(bindResultObject); \n\n\n\n } \n\n\n\n\n\nWouldn't it be better to replace it this way?\n    public static <T> T handleSpringBinder(Environment environment, String prefix, Class<T> targetClass)\n            throws NoSuchMethodException, IllegalAccessException, InvocationTargetException, ClassNotFoundException {\n        String prefixParam = prefix.endsWith(\".\") ? prefix.substring(0, prefix.length() - 1) : prefix;\n        Binder binder = Binder.get(environment);\n        return binder.bind(prefixParam, targetClass).orElse(null);\n    }"
}