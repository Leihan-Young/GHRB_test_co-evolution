{
  "issue_id": 17523,
  "issue_url": "https://github.com/OpenAPITools/openapi-generator/issues/17523",
  "title": "[BUG] [Python] anyOf array of string is handled incorrectly in 3.1.0 regression",
  "description": "<h4 dir=\"auto\">Bug Report Checklist</h4>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you provided a full/minimal spec to reproduce the issue?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you validated the input using an OpenAPI validator (<a href=\"https://apidevtools.org/swagger-parser/online/\" rel=\"nofollow\">example</a>)?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you <a href=\"https://github.com/OpenAPITools/openapi-generator/wiki/FAQ#how-to-test-with-the-latest-master-of-openapi-generator\">tested with the latest master</a> to confirm the issue still exists?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you searched for related issues/PRs?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> What's the actual output vs expected output?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> [Optional] Sponsorship to speed up the bug fix or feature request (<a href=\"https://github.com/OpenAPITools/openapi-generator/issues/6178\" data-hovercard-type=\"issue\" data-hovercard-url=\"/OpenAPITools/openapi-generator/issues/6178/hovercard\">example</a>)</li>\n</ul>\n<h5 dir=\"auto\">Description</h5>\n<p dir=\"auto\">This appears to be a regression from handling 3.0 specs. If I switch the openapi version from 3.1.0 to 3.0.0 then the correct output is produced.</p>\n<p dir=\"auto\">When a field is of type</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"anyOf:\n  - type: string\n  - type: array\n    items:\n      type: string\"><pre class=\"notranslate\"><code class=\"notranslate\">anyOf:\n  - type: string\n  - type: array\n    items:\n      type: string\n</code></pre></div>\n<p dir=\"auto\">The generated code ignores the array and produces</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    field: Optional[StrictStr] = Field(...)\"><pre class=\"notranslate\"><code class=\"notranslate\">    field: Optional[StrictStr] = Field(...)\n</code></pre></div>\n<p dir=\"auto\">It does the right thing when it's</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"anyOf:\n  - type: string\n  - type: number\"><pre class=\"notranslate\"><code class=\"notranslate\">anyOf:\n  - type: string\n  - type: number\n</code></pre></div>\n<p dir=\"auto\">Producing</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    field: Field = Field(...)\"><pre class=\"notranslate\"><code class=\"notranslate\">    field: Field = Field(...)\n</code></pre></div>\n<h5 dir=\"auto\">openapi-generator version</h5>\n<p dir=\"auto\">latest/7.2.0</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"docker pull openapitools/openapi-generator-cli:latest\nlatest: Pulling from openapitools/openapi-generator-cli\nDigest: sha256:7bfcb402ec4fef3af86c5ff38cec26c772db138120f931755da4a63a3cec5189\"><pre class=\"notranslate\"><code class=\"notranslate\">docker pull openapitools/openapi-generator-cli:latest\nlatest: Pulling from openapitools/openapi-generator-cli\nDigest: sha256:7bfcb402ec4fef3af86c5ff38cec26c772db138120f931755da4a63a3cec5189\n</code></pre></div>\n<h5 dir=\"auto\">OpenAPI declaration file content or url</h5>\n<div class=\"highlight highlight-source-yaml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"openapi: 3.1.0\npaths: {}\ninfo:\n  version: 1.0.0\n  title: Swagger Petstore\ncomponents:\n  schemas:\n    Cat:\n      type: object\n      title: Cat\n      description: a cat\n      required: [field]\n      properties:\n        field:\n          title: field\n          anyOf:\n          - type: string\n          - items:\n              type: string\"><pre class=\"notranslate\"><span class=\"pl-ent\">openapi</span>: <span class=\"pl-s\">3.1.0</span>\n<span class=\"pl-ent\">paths</span>: <span class=\"pl-s\">{}</span>\n<span class=\"pl-ent\">info</span>:\n  <span class=\"pl-ent\">version</span>: <span class=\"pl-s\">1.0.0</span>\n  <span class=\"pl-ent\">title</span>: <span class=\"pl-s\">Swagger Petstore</span>\n<span class=\"pl-ent\">components</span>:\n  <span class=\"pl-ent\">schemas</span>:\n    <span class=\"pl-ent\">Cat</span>:\n      <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">object</span>\n      <span class=\"pl-ent\">title</span>: <span class=\"pl-s\">Cat</span>\n      <span class=\"pl-ent\">description</span>: <span class=\"pl-s\">a cat</span>\n      <span class=\"pl-ent\">required</span>: <span class=\"pl-s\">[field]</span>\n      <span class=\"pl-ent\">properties</span>:\n        <span class=\"pl-ent\">field</span>:\n          <span class=\"pl-ent\">title</span>: <span class=\"pl-s\">field</span>\n          <span class=\"pl-ent\">anyOf</span>:\n          - <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">string</span>\n          - <span class=\"pl-ent\">items</span>:\n              <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">string</span></pre></div>\n<h5 dir=\"auto\">Generation Details</h5>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"$ pip install openapi-spec-validator\n$ openapi-spec-validator openapi.yaml\nopenapi.yaml: OK\n\n$ docker run --rm -v ${PWD}:/local openapitools/openapi-generator-cli:latest generate -g python --additional-properties=generateSourceCodeOnly=true,packageName=client -o /local/ -i /local/openapi.yaml \"><pre class=\"notranslate\"><code class=\"notranslate\">$ pip install openapi-spec-validator\n$ openapi-spec-validator openapi.yaml\nopenapi.yaml: OK\n\n$ docker run --rm -v ${PWD}:/local openapitools/openapi-generator-cli:latest generate -g python --additional-properties=generateSourceCodeOnly=true,packageName=client -o /local/ -i /local/openapi.yaml \n</code></pre></div>\n<p dir=\"auto\">Output has no warnings/errors.</p>\n<h5 dir=\"auto\">Steps to reproduce</h5>\n<ol dir=\"auto\">\n<li>Create openapi.yaml and generate code</li>\n<li>Look in client/model/cat.py and observe list[str] is missing in the type of field</li>\n<li>Switch to 3.0.0 in yaml</li>\n<li>Regenerate code and observe the field now points to a new type which correctly expresses the union type</li>\n</ol>\n<h5 dir=\"auto\">Related issues/PRs</h5>\n<p dir=\"auto\">None that I could find.</p>\n<h5 dir=\"auto\">Suggest a fix</h5>\n<p dir=\"auto\">It seems like the array handling logic is incorrect.</p>",
  "description_text": "Bug Report Checklist\n\n Have you provided a full/minimal spec to reproduce the issue?\n Have you validated the input using an OpenAPI validator (example)?\n Have you tested with the latest master to confirm the issue still exists?\n Have you searched for related issues/PRs?\n What's the actual output vs expected output?\n [Optional] Sponsorship to speed up the bug fix or feature request (example)\n\nDescription\nThis appears to be a regression from handling 3.0 specs. If I switch the openapi version from 3.1.0 to 3.0.0 then the correct output is produced.\nWhen a field is of type\nanyOf:\n  - type: string\n  - type: array\n    items:\n      type: string\n\nThe generated code ignores the array and produces\n    field: Optional[StrictStr] = Field(...)\n\nIt does the right thing when it's\nanyOf:\n  - type: string\n  - type: number\n\nProducing\n    field: Field = Field(...)\n\nopenapi-generator version\nlatest/7.2.0\ndocker pull openapitools/openapi-generator-cli:latest\nlatest: Pulling from openapitools/openapi-generator-cli\nDigest: sha256:7bfcb402ec4fef3af86c5ff38cec26c772db138120f931755da4a63a3cec5189\n\nOpenAPI declaration file content or url\nopenapi: 3.1.0\npaths: {}\ninfo:\n  version: 1.0.0\n  title: Swagger Petstore\ncomponents:\n  schemas:\n    Cat:\n      type: object\n      title: Cat\n      description: a cat\n      required: [field]\n      properties:\n        field:\n          title: field\n          anyOf:\n          - type: string\n          - items:\n              type: string\nGeneration Details\n$ pip install openapi-spec-validator\n$ openapi-spec-validator openapi.yaml\nopenapi.yaml: OK\n\n$ docker run --rm -v ${PWD}:/local openapitools/openapi-generator-cli:latest generate -g python --additional-properties=generateSourceCodeOnly=true,packageName=client -o /local/ -i /local/openapi.yaml \n\nOutput has no warnings/errors.\nSteps to reproduce\n\nCreate openapi.yaml and generate code\nLook in client/model/cat.py and observe list[str] is missing in the type of field\nSwitch to 3.0.0 in yaml\nRegenerate code and observe the field now points to a new type which correctly expresses the union type\n\nRelated issues/PRs\nNone that I could find.\nSuggest a fix\nIt seems like the array handling logic is incorrect."
}