{
  "issue_id": 565,
  "issue_url": "https://github.com/mockito/mockito/issues/565",
  "title": "ArgumentCaptor should be type aware",
  "description": "<p dir=\"auto\">Assume we have the following test.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\" @Mock\n private Consumer<Collection<?>> consumer;\n\n @Test\n public void test() throws Exception {\n\n    consumer.accept(new HashSet<>());\n    consumer.accept(new ArrayList<>());\n\n    ArgumentCaptor<ArrayList<?>> captor = ArgumentCaptor.forClass(ArrayList.class);\n    verify(consumer).accept(captor.capture());\n }\"><pre class=\"notranslate\"><code class=\"notranslate\"> @Mock\n private Consumer<Collection<?>> consumer;\n\n @Test\n public void test() throws Exception {\n\n    consumer.accept(new HashSet<>());\n    consumer.accept(new ArrayList<>());\n\n    ArgumentCaptor<ArrayList<?>> captor = ArgumentCaptor.forClass(ArrayList.class);\n    verify(consumer).accept(captor.capture());\n }\n</code></pre></div>\n<p dir=\"auto\">The test fails with:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"org.mockito.exceptions.verification.TooManyActualInvocations:\nconsumer.accept(<Capturing argument>);\nWanted 1 time:\n-> at foo.TestClass.testName(TestClass.java:64)\nBut was 2 times. Undesired invocation:\n-> at agh.TestClass.testName(TestClass.java:61)\n\n    at foo.TestClass.test(TestClass.java:64)\n    [..]\"><pre class=\"notranslate\"><code class=\"notranslate\">org.mockito.exceptions.verification.TooManyActualInvocations:\nconsumer.accept(<Capturing argument>);\nWanted 1 time:\n-> at foo.TestClass.testName(TestClass.java:64)\nBut was 2 times. Undesired invocation:\n-> at agh.TestClass.testName(TestClass.java:61)\n\n    at foo.TestClass.test(TestClass.java:64)\n    [..]\n</code></pre></div>\n<p dir=\"auto\">The problem here is that ArgumentCaptor is not type aware. That should be fixed.</p>\n<p dir=\"auto\">This issue was extracted from <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"134572872\" data-permission-text=\"Title is private\" data-url=\"https://github.com/mockito/mockito/issues/358\" data-hovercard-type=\"issue\" data-hovercard-url=\"/mockito/mockito/issues/358/hovercard\" href=\"https://github.com/mockito/mockito/issues/358\">#358</a> and relates to <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"161045110\" data-permission-text=\"Title is private\" data-url=\"https://github.com/mockito/mockito/issues/439\" data-hovercard-type=\"issue\" data-hovercard-url=\"/mockito/mockito/issues/439/hovercard\" href=\"https://github.com/mockito/mockito/issues/439\">#439</a>.</p>",
  "description_text": "Assume we have the following test.\n @Mock\n private Consumer> consumer;\n\n @Test\n public void test() throws Exception {\n\n    consumer.accept(new HashSet<>());\n    consumer.accept(new ArrayList<>());\n\n    ArgumentCaptor> captor = ArgumentCaptor.forClass(ArrayList.class);\n    verify(consumer).accept(captor.capture());\n }\n\nThe test fails with:\norg.mockito.exceptions.verification.TooManyActualInvocations:\nconsumer.accept();\nWanted 1 time:\n-> at foo.TestClass.testName(TestClass.java:64)\nBut was 2 times. Undesired invocation:\n-> at agh.TestClass.testName(TestClass.java:61)\n\n    at foo.TestClass.test(TestClass.java:64)\n    [..]\n\nThe problem here is that ArgumentCaptor is not type aware. That should be fixed.\nThis issue was extracted from #358 and relates to #439."
}