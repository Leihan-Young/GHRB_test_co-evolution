{
  "issue_id": 11159,
  "issue_url": "https://github.com/apache/dubbo/issues/11159",
  "title": "[3.1] Configurations cannot be loaded correctly unless set in `SystemProperty`",
  "description": "\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I have searched the <a href=\"https://github.com/apache/dubbo/issues\">issues</a> of this repository and believe that this is not a duplicate.</li>\n</ul>\n<h3 dir=\"auto\">Environment</h3>\n<ul dir=\"auto\">\n<li>Dubbo version: branch 3.1</li>\n<li>Operating System version: any</li>\n<li>Java version: any</li>\n</ul>\n<h3 dir=\"auto\">Steps to reproduce this issue</h3>\n<ol dir=\"auto\">\n<li>Set sysetm env <code class=\"notranslate\">export a=\"b\"</code></li>\n<li>Edit file <code class=\"notranslate\">dubbo-demo/dubbo-demo-api/dubbo-demo-api-provider/src/main/java/org/apache/dubbo/demo/provider/Application.java</code></li>\n</ol>\n<div class=\"highlight highlight-source-java notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"package org.apache.dubbo.demo.provider;\n\nimport org.apache.dubbo.common.config.ConfigurationUtils;\nimport org.apache.dubbo.common.utils.Assert;\nimport org.apache.dubbo.config.ApplicationConfig;\nimport org.apache.dubbo.config.MetadataReportConfig;\nimport org.apache.dubbo.config.RegistryConfig;\nimport org.apache.dubbo.config.ServiceConfig;\nimport org.apache.dubbo.demo.DemoService;\n\npublic class Application {\n    public static void main(String[] args) throws Exception {\n        startWithExport();\n    }\n\n    private static void startWithExport() throws InterruptedException {\n        ServiceConfig<DemoServiceImpl> service = new ServiceConfig<>();\n        service.setInterface(DemoService.class);\n        service.setRef(new DemoServiceImpl());\n        service.setApplication(new ApplicationConfig(\"dubbo-demo-api-provider\"));\n        service.setRegistry(new RegistryConfig(\"zookeeper://127.0.0.1:2181\"));\n        service.setMetadataReportConfig(new MetadataReportConfig(\"zookeeper://127.0.0.1:2181\"));\n        service.export();\n\n        String val = ConfigurationUtils.getProperty(service.getScopeModel(), \"a\", \"c\");\n        Assert.assertTrue(\"b\".equals(val), \"bad value\");\n    }\n}\"><pre class=\"notranslate\"><span class=\"pl-k\">package</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">dubbo</span>.<span class=\"pl-s1\">demo</span>.<span class=\"pl-s1\">provider</span>;\n\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">dubbo</span>.<span class=\"pl-s1\">common</span>.<span class=\"pl-s1\">config</span>.<span class=\"pl-s1\">ConfigurationUtils</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">dubbo</span>.<span class=\"pl-s1\">common</span>.<span class=\"pl-s1\">utils</span>.<span class=\"pl-s1\">Assert</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">dubbo</span>.<span class=\"pl-s1\">config</span>.<span class=\"pl-s1\">ApplicationConfig</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">dubbo</span>.<span class=\"pl-s1\">config</span>.<span class=\"pl-s1\">MetadataReportConfig</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">dubbo</span>.<span class=\"pl-s1\">config</span>.<span class=\"pl-s1\">RegistryConfig</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">dubbo</span>.<span class=\"pl-s1\">config</span>.<span class=\"pl-s1\">ServiceConfig</span>;\n<span class=\"pl-k\">import</span> <span class=\"pl-s1\">org</span>.<span class=\"pl-s1\">apache</span>.<span class=\"pl-s1\">dubbo</span>.<span class=\"pl-s1\">demo</span>.<span class=\"pl-s1\">DemoService</span>;\n\n<span class=\"pl-k\">public</span> <span class=\"pl-k\">class</span> <span class=\"pl-smi\">Application</span> {\n    <span class=\"pl-k\">public</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">main</span>(<span class=\"pl-smi\">String</span>[] <span class=\"pl-s1\">args</span>) <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">Exception</span> {\n        <span class=\"pl-en\">startWithExport</span>();\n    }\n\n    <span class=\"pl-k\">private</span> <span class=\"pl-k\">static</span> <span class=\"pl-smi\">void</span> <span class=\"pl-en\">startWithExport</span>() <span class=\"pl-k\">throws</span> <span class=\"pl-smi\">InterruptedException</span> {\n        <span class=\"pl-smi\">ServiceConfig</span><<span class=\"pl-smi\">DemoServiceImpl</span>> <span class=\"pl-s1\">service</span> = <span class=\"pl-k\">new</span> <span class=\"pl-smi\">ServiceConfig</span><>();\n        <span class=\"pl-s1\">service</span>.<span class=\"pl-en\">setInterface</span>(<span class=\"pl-smi\">DemoService</span>.<span class=\"pl-k\">class</span>);\n        <span class=\"pl-s1\">service</span>.<span class=\"pl-en\">setRef</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">DemoServiceImpl</span>());\n        <span class=\"pl-s1\">service</span>.<span class=\"pl-en\">setApplication</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">ApplicationConfig</span>(<span class=\"pl-s\">\"dubbo-demo-api-provider\"</span>));\n        <span class=\"pl-s1\">service</span>.<span class=\"pl-en\">setRegistry</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">RegistryConfig</span>(<span class=\"pl-s\">\"zookeeper://127.0.0.1:2181\"</span>));\n        <span class=\"pl-s1\">service</span>.<span class=\"pl-en\">setMetadataReportConfig</span>(<span class=\"pl-k\">new</span> <span class=\"pl-smi\">MetadataReportConfig</span>(<span class=\"pl-s\">\"zookeeper://127.0.0.1:2181\"</span>));\n        <span class=\"pl-s1\">service</span>.<span class=\"pl-en\">export</span>();\n\n        <span class=\"pl-smi\">String</span> <span class=\"pl-s1\">val</span> = <span class=\"pl-smi\">ConfigurationUtils</span>.<span class=\"pl-en\">getProperty</span>(<span class=\"pl-s1\">service</span>.<span class=\"pl-en\">getScopeModel</span>(), <span class=\"pl-s\">\"a\"</span>, <span class=\"pl-s\">\"c\"</span>);\n        <span class=\"pl-smi\">Assert</span>.<span class=\"pl-en\">assertTrue</span>(<span class=\"pl-s\">\"b\"</span>.<span class=\"pl-en\">equals</span>(<span class=\"pl-s1\">val</span>), <span class=\"pl-s\">\"bad value\"</span>);\n    }\n}</pre></div>\n<ol start=\"3\" dir=\"auto\">\n<li>Run it</li>\n</ol>\n<h3 dir=\"auto\">Expected Behavior</h3>\n<p dir=\"auto\">\"b\"</p>\n<h3 dir=\"auto\">Actual Behavior</h3>\n<p dir=\"auto\">\"c\"</p>\n<p dir=\"auto\">This BUG is very <strong>SERIOUS</strong>  and could lead to production problems.</p>",
  "description_text": "\n\n I have searched the issues of this repository and believe that this is not a duplicate.\n\nEnvironment\n\nDubbo version: branch 3.1\nOperating System version: any\nJava version: any\n\nSteps to reproduce this issue\n\nSet sysetm env export a=\"b\"\nEdit file dubbo-demo/dubbo-demo-api/dubbo-demo-api-provider/src/main/java/org/apache/dubbo/demo/provider/Application.java\n\npackage org.apache.dubbo.demo.provider;\n\nimport org.apache.dubbo.common.config.ConfigurationUtils;\nimport org.apache.dubbo.common.utils.Assert;\nimport org.apache.dubbo.config.ApplicationConfig;\nimport org.apache.dubbo.config.MetadataReportConfig;\nimport org.apache.dubbo.config.RegistryConfig;\nimport org.apache.dubbo.config.ServiceConfig;\nimport org.apache.dubbo.demo.DemoService;\n\npublic class Application {\n    public static void main(String[] args) throws Exception {\n        startWithExport();\n    }\n\n    private static void startWithExport() throws InterruptedException {\n        ServiceConfig<DemoServiceImpl> service = new ServiceConfig<>();\n        service.setInterface(DemoService.class);\n        service.setRef(new DemoServiceImpl());\n        service.setApplication(new ApplicationConfig(\"dubbo-demo-api-provider\"));\n        service.setRegistry(new RegistryConfig(\"zookeeper://127.0.0.1:2181\"));\n        service.setMetadataReportConfig(new MetadataReportConfig(\"zookeeper://127.0.0.1:2181\"));\n        service.export();\n\n        String val = ConfigurationUtils.getProperty(service.getScopeModel(), \"a\", \"c\");\n        Assert.assertTrue(\"b\".equals(val), \"bad value\");\n    }\n}\n\nRun it\n\nExpected Behavior\n\"b\"\nActual Behavior\n\"c\"\nThis BUG is very SERIOUS  and could lead to production problems."
}