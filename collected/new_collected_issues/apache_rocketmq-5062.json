{
  "issue_id": 5012,
  "issue_url": "https://github.com/apache/rocketmq/issues/5012",
  "title": "Support escaping transactional messages in slave-acting-master mode",
  "description": "<p dir=\"auto\"><strong>FEATURE REQUEST</strong></p>\n<p dir=\"auto\">In <a href=\"https://github.com/apache/rocketmq/wiki/RIP-32-Slave-Acting-Master-Mode\">RIP-32</a>, Slave Acting Master Mode is supported and the escape of the transactional messages need to be supported.</p>\n<p dir=\"auto\">Below is a simple implementation of escaping transactional messages:</p>\n<p dir=\"auto\">If a slave node is acting as master,</p>\n<ul dir=\"auto\">\n<li>EndTransaction requests (including commit and rollback) are denied.</li>\n<li>When checking status of half messages, escape half messages to an available master directly, without checking transaction status actually. There is a small trick: If a half message is sent to a local master, just append it to half topic; if sent to a remote master, the half message should be restored to original real message, because sending messages to a system topic is forbidden.</li>\n</ul>\n<p dir=\"auto\">This implemetation keeps read-only sematics of slaves, so that no new half messages or op messages will be created in slave acting as master, all actual checking processes of half messages are delivered to master.</p>\n<p dir=\"auto\">Previously there are several proposals, such as <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1262911540\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/rocketmq/issues/4427\" data-hovercard-type=\"issue\" data-hovercard-url=\"/apache/rocketmq/issues/4427/hovercard\" href=\"https://github.com/apache/rocketmq/issues/4427\">#4427</a>, <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"1275664759\" data-permission-text=\"Title is private\" data-url=\"https://github.com/apache/rocketmq/issues/4477\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/apache/rocketmq/pull/4477/hovercard\" href=\"https://github.com/apache/rocketmq/pull/4477\">#4477</a>, etc. They do provide good references and I truly appreciate the authors.</p>",
  "description_text": "FEATURE REQUEST\nIn RIP-32, Slave Acting Master Mode is supported and the escape of the transactional messages need to be supported.\nBelow is a simple implementation of escaping transactional messages:\nIf a slave node is acting as master,\n\nEndTransaction requests (including commit and rollback) are denied.\nWhen checking status of half messages, escape half messages to an available master directly, without checking transaction status actually. There is a small trick: If a half message is sent to a local master, just append it to half topic; if sent to a remote master, the half message should be restored to original real message, because sending messages to a system topic is forbidden.\n\nThis implemetation keeps read-only sematics of slaves, so that no new half messages or op messages will be created in slave acting as master, all actual checking processes of half messages are delivered to master.\nPreviously there are several proposals, such as #4427, #4477, etc. They do provide good references and I truly appreciate the authors."
}