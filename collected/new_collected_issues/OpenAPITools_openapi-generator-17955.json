{
  "issue_id": 17923,
  "issue_url": "https://github.com/OpenAPITools/openapi-generator/issues/17923",
  "title": "OpenAPI 3.1 normalization fails with schema specifying only prefixItems in array",
  "description": "<h5 dir=\"auto\">Description</h5>\n<p dir=\"auto\">Observe this schema is valid for 3.1 but does not have <code class=\"notranslate\">items</code>:</p>\n<div class=\"highlight highlight-source-yaml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    QueueTuple:\n      type: array\n      description: |\n        An item that was added to the queue.\n      minItems: 3\n      maxItems: 5\n      prefixItems:\n        - type: number\n          description: Queue priority.\n        - type: string\n          description: The hash id of the prompt object. This should be the the prompt ID.\n        - $ref: \"#/components/schemas/Prompt\"\n        - $ref: \"#/components/schemas/ExtraData\"\n        - type: array\n          description: A list of \"good output\" node IDs in the prompt.\n          items:\n            type: string\"><pre class=\"notranslate\">    <span class=\"pl-ent\">QueueTuple</span>:\n      <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">array</span>\n      <span class=\"pl-ent\">description</span>: <span class=\"pl-s\">|</span>\n<span class=\"pl-s\">        An item that was added to the queue.</span>\n<span class=\"pl-s\"></span>      <span class=\"pl-ent\">minItems</span>: <span class=\"pl-c1\">3</span>\n      <span class=\"pl-ent\">maxItems</span>: <span class=\"pl-c1\">5</span>\n      <span class=\"pl-ent\">prefixItems</span>:\n        - <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">number</span>\n          <span class=\"pl-ent\">description</span>: <span class=\"pl-s\">Queue priority.</span>\n        - <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">string</span>\n          <span class=\"pl-ent\">description</span>: <span class=\"pl-s\">The hash id of the prompt object. This should be the the prompt ID.</span>\n        - <span class=\"pl-ent\">$ref</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>#/components/schemas/Prompt<span class=\"pl-pds\">\"</span></span>\n        - <span class=\"pl-ent\">$ref</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>#/components/schemas/ExtraData<span class=\"pl-pds\">\"</span></span>\n        - <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">array</span>\n          <span class=\"pl-ent\">description</span>: <span class=\"pl-s\">A list of \"good output\" node IDs in the prompt.</span>\n          <span class=\"pl-ent\">items</span>:\n            <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">string</span></pre></div>\n<p dir=\"auto\">This causes the exception in generation:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"[main] ERROR o.o.codegen.DefaultGenerator - An exception occurred in OpenAPI Normalizer. Please report the issue via https://github.com/openapitools/openapi-generator/issues/new/: \njava.lang.NullPointerException\n\tat org.openapitools.codegen.OpenAPINormalizer.processNormalize31Spec(OpenAPINormalizer.java:1040)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSimpleSchema(OpenAPINormalizer.java:502)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSchema(OpenAPINormalizer.java:493)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeOneOf(OpenAPINormalizer.java:561)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSchema(OpenAPINormalizer.java:452)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSchema(OpenAPINormalizer.java:450)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeProperties(OpenAPINormalizer.java:519)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSchema(OpenAPINormalizer.java:487)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeComponentsSchemas(OpenAPINormalizer.java:419)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalize(OpenAPINormalizer.java:222)\n\tat org.openapitools.codegen.DefaultGenerator.configureGeneratorProperties(DefaultGenerator.java:274)\n\tat org.openapitools.codegen.DefaultGenerator.generate(DefaultGenerator.java:1212)\n\tat org.openapitools.codegen.cmd.Generate.execute(Generate.java:535)\n\tat org.openapitools.codegen.cmd.OpenApiGeneratorCommand.run(OpenApiGeneratorCommand.java:32)\n\tat org.openapitools.codegen.OpenAPIGenerator.main(OpenAPIGenerator.java:66)\"><pre class=\"notranslate\"><code class=\"notranslate\">[main] ERROR o.o.codegen.DefaultGenerator - An exception occurred in OpenAPI Normalizer. Please report the issue via https://github.com/openapitools/openapi-generator/issues/new/: \njava.lang.NullPointerException\n\tat org.openapitools.codegen.OpenAPINormalizer.processNormalize31Spec(OpenAPINormalizer.java:1040)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSimpleSchema(OpenAPINormalizer.java:502)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSchema(OpenAPINormalizer.java:493)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeOneOf(OpenAPINormalizer.java:561)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSchema(OpenAPINormalizer.java:452)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSchema(OpenAPINormalizer.java:450)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeProperties(OpenAPINormalizer.java:519)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSchema(OpenAPINormalizer.java:487)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeComponentsSchemas(OpenAPINormalizer.java:419)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalize(OpenAPINormalizer.java:222)\n\tat org.openapitools.codegen.DefaultGenerator.configureGeneratorProperties(DefaultGenerator.java:274)\n\tat org.openapitools.codegen.DefaultGenerator.generate(DefaultGenerator.java:1212)\n\tat org.openapitools.codegen.cmd.Generate.execute(Generate.java:535)\n\tat org.openapitools.codegen.cmd.OpenApiGeneratorCommand.run(OpenApiGeneratorCommand.java:32)\n\tat org.openapitools.codegen.OpenAPIGenerator.main(OpenAPIGenerator.java:66)\n</code></pre></div>\n<p dir=\"auto\">The referenced line is here, which causes the exception because items doesn't exist.<br>\n<a href=\"https://github.com/OpenAPITools/openapi-generator/blob/f1919042974ec17821d66a5529e4a8df5d3b3ac7/modules/openapi-generator/src/main/java/org/openapitools/codegen/OpenAPINormalizer.java#L1040C1-L1040C75\">https://github.com/OpenAPITools/openapi-generator/blob/f1919042974ec17821d66a5529e4a8df5d3b3ac7/modules/openapi-generator/src/main/java/org/openapitools/codegen/OpenAPINormalizer.java#L1040C1-L1040C75</a></p>\n<p dir=\"auto\">See reproduction in Google Colab with latest master at:<br>\n<a href=\"https://colab.research.google.com/drive/18sXET4mnQLMrsxru2vumN7iuk1fVJEVr?usp=sharing\" rel=\"nofollow\">https://colab.research.google.com/drive/18sXET4mnQLMrsxru2vumN7iuk1fVJEVr?usp=sharing</a></p>\n<h5 dir=\"auto\">openapi-generator version</h5>\n<p dir=\"auto\"><code class=\"notranslate\">master</code></p>\n<h5 dir=\"auto\">OpenAPI declaration file content or url</h5>\n<div class=\"highlight highlight-source-yaml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"    QueueTuple:\n      type: array\n      description: |\n        An item that was added to the queue.\n      minItems: 3\n      maxItems: 5\n      prefixItems:\n        - type: number\n          description: Queue priority.\n        - type: string\n          description: The hash id of the prompt object. This should be the the prompt ID.\n        - $ref: \"#/components/schemas/Prompt\"\n        - $ref: \"#/components/schemas/ExtraData\"\n        - type: array\n          description: A list of \"good output\" node IDs in the prompt.\n          items:\n            type: string\"><pre class=\"notranslate\">    <span class=\"pl-ent\">QueueTuple</span>:\n      <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">array</span>\n      <span class=\"pl-ent\">description</span>: <span class=\"pl-s\">|</span>\n<span class=\"pl-s\">        An item that was added to the queue.</span>\n<span class=\"pl-s\"></span>      <span class=\"pl-ent\">minItems</span>: <span class=\"pl-c1\">3</span>\n      <span class=\"pl-ent\">maxItems</span>: <span class=\"pl-c1\">5</span>\n      <span class=\"pl-ent\">prefixItems</span>:\n        - <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">number</span>\n          <span class=\"pl-ent\">description</span>: <span class=\"pl-s\">Queue priority.</span>\n        - <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">string</span>\n          <span class=\"pl-ent\">description</span>: <span class=\"pl-s\">The hash id of the prompt object. This should be the the prompt ID.</span>\n        - <span class=\"pl-ent\">$ref</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>#/components/schemas/Prompt<span class=\"pl-pds\">\"</span></span>\n        - <span class=\"pl-ent\">$ref</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>#/components/schemas/ExtraData<span class=\"pl-pds\">\"</span></span>\n        - <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">array</span>\n          <span class=\"pl-ent\">description</span>: <span class=\"pl-s\">A list of \"good output\" node IDs in the prompt.</span>\n          <span class=\"pl-ent\">items</span>:\n            <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">string</span></pre></div>\n<h5 dir=\"auto\">Command line used for generation</h5>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"java --add-opens java.base/java.io=ALL-UNNAMED --add-opens java.base/java.util=ALL-UNNAMED --add-opens java.base/java.lang=ALL-UNNAMED -jar ../openapi-generator/modules/openapi-generator-cli/target/openapi-generator-cli.jar generate --input-spec ./comfy/api/openapi.yaml --global-property models --config ./comfy/api/openapi_python_config.yaml\"><pre class=\"notranslate\"><code class=\"notranslate\">java --add-opens java.base/java.io=ALL-UNNAMED --add-opens java.base/java.util=ALL-UNNAMED --add-opens java.base/java.lang=ALL-UNNAMED -jar ../openapi-generator/modules/openapi-generator-cli/target/openapi-generator-cli.jar generate --input-spec ./comfy/api/openapi.yaml --global-property models --config ./comfy/api/openapi_python_config.yaml\n</code></pre></div>\n<h5 dir=\"auto\">Steps to reproduce</h5>\n<p dir=\"auto\"><a href=\"https://colab.research.google.com/drive/18sXET4mnQLMrsxru2vumN7iuk1fVJEVr?usp=sharing\" rel=\"nofollow\">unambiguous set of steps to reproduce the bug.</a></p>\n<h5 dir=\"auto\">Related issues/PRs</h5>\n<p dir=\"auto\"><a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2110650383\" data-permission-text=\"Title is private\" data-url=\"https://github.com/OpenAPITools/openapi-generator/issues/17755\" data-hovercard-type=\"issue\" data-hovercard-url=\"/OpenAPITools/openapi-generator/issues/17755/hovercard\" href=\"https://github.com/OpenAPITools/openapi-generator/issues/17755\">#17755</a></p>\n<h5 dir=\"auto\">Suggest a fix/enhancement</h5>\n<p dir=\"auto\">Not sure, the referenced snippet needs to deal with no items and only prefixItems correctly.</p>",
  "description_text": "Description\nObserve this schema is valid for 3.1 but does not have items:\n    QueueTuple:\n      type: array\n      description: |\n        An item that was added to the queue.\n      minItems: 3\n      maxItems: 5\n      prefixItems:\n        - type: number\n          description: Queue priority.\n        - type: string\n          description: The hash id of the prompt object. This should be the the prompt ID.\n        - $ref: \"#/components/schemas/Prompt\"\n        - $ref: \"#/components/schemas/ExtraData\"\n        - type: array\n          description: A list of \"good output\" node IDs in the prompt.\n          items:\n            type: string\nThis causes the exception in generation:\n[main] ERROR o.o.codegen.DefaultGenerator - An exception occurred in OpenAPI Normalizer. Please report the issue via https://github.com/openapitools/openapi-generator/issues/new/: \njava.lang.NullPointerException\n\tat org.openapitools.codegen.OpenAPINormalizer.processNormalize31Spec(OpenAPINormalizer.java:1040)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSimpleSchema(OpenAPINormalizer.java:502)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSchema(OpenAPINormalizer.java:493)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeOneOf(OpenAPINormalizer.java:561)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSchema(OpenAPINormalizer.java:452)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSchema(OpenAPINormalizer.java:450)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeProperties(OpenAPINormalizer.java:519)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeSchema(OpenAPINormalizer.java:487)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalizeComponentsSchemas(OpenAPINormalizer.java:419)\n\tat org.openapitools.codegen.OpenAPINormalizer.normalize(OpenAPINormalizer.java:222)\n\tat org.openapitools.codegen.DefaultGenerator.configureGeneratorProperties(DefaultGenerator.java:274)\n\tat org.openapitools.codegen.DefaultGenerator.generate(DefaultGenerator.java:1212)\n\tat org.openapitools.codegen.cmd.Generate.execute(Generate.java:535)\n\tat org.openapitools.codegen.cmd.OpenApiGeneratorCommand.run(OpenApiGeneratorCommand.java:32)\n\tat org.openapitools.codegen.OpenAPIGenerator.main(OpenAPIGenerator.java:66)\n\nThe referenced line is here, which causes the exception because items doesn't exist.\nhttps://github.com/OpenAPITools/openapi-generator/blob/f1919042974ec17821d66a5529e4a8df5d3b3ac7/modules/openapi-generator/src/main/java/org/openapitools/codegen/OpenAPINormalizer.java#L1040C1-L1040C75\nSee reproduction in Google Colab with latest master at:\nhttps://colab.research.google.com/drive/18sXET4mnQLMrsxru2vumN7iuk1fVJEVr?usp=sharing\nopenapi-generator version\nmaster\nOpenAPI declaration file content or url\n    QueueTuple:\n      type: array\n      description: |\n        An item that was added to the queue.\n      minItems: 3\n      maxItems: 5\n      prefixItems:\n        - type: number\n          description: Queue priority.\n        - type: string\n          description: The hash id of the prompt object. This should be the the prompt ID.\n        - $ref: \"#/components/schemas/Prompt\"\n        - $ref: \"#/components/schemas/ExtraData\"\n        - type: array\n          description: A list of \"good output\" node IDs in the prompt.\n          items:\n            type: string\nCommand line used for generation\njava --add-opens java.base/java.io=ALL-UNNAMED --add-opens java.base/java.util=ALL-UNNAMED --add-opens java.base/java.lang=ALL-UNNAMED -jar ../openapi-generator/modules/openapi-generator-cli/target/openapi-generator-cli.jar generate --input-spec ./comfy/api/openapi.yaml --global-property models --config ./comfy/api/openapi_python_config.yaml\n\nSteps to reproduce\nunambiguous set of steps to reproduce the bug.\nRelated issues/PRs\n#17755\nSuggest a fix/enhancement\nNot sure, the referenced snippet needs to deal with no items and only prefixItems correctly."
}