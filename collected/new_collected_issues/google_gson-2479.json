{
  "issue_id": 2436,
  "issue_url": "https://github.com/google/gson/issues/2436",
  "title": "`GsonBuilder` should throw exception when trying to register adapter for `Object` or `JsonElement`",
  "description": "<h1 dir=\"auto\">Problem solved by the feature</h1>\n<p dir=\"auto\"><code class=\"notranslate\">GsonBuilder</code> does not support overwriting the built-in adapters for <code class=\"notranslate\">Object</code> and for <code class=\"notranslate\">JsonElement</code> (and subclasses). This might not be obvious to users (see <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"267915657\" data-permission-text=\"Title is private\" data-url=\"https://github.com/google/gson/issues/1177\" data-hovercard-type=\"issue\" data-hovercard-url=\"/google/gson/issues/1177/hovercard\" href=\"https://github.com/google/gson/issues/1177\">#1177</a>).<br>\n</p><div class=\"Box Box--condensed my-2\">\n  <div class=\"Box-header f6\">\n    <p class=\"mb-0 text-bold\">\n      <a href=\"https://github.com/google/gson/blob/6d9c3566b71900c54644a9f71ce028696ee5d4bd/gson/src/main/java/com/google/gson/Gson.java#L283-L285\">gson/gson/src/main/java/com/google/gson/Gson.java</a>\n    </p>\n    <p class=\"mb-0 color-fg-muted\">\n        Lines 283 to 285\n      in\n      <a data-pjax=\"true\" class=\"commit-tease-sha Link--inTextBlock\" href=\"/google/gson/commit/6d9c3566b71900c54644a9f71ce028696ee5d4bd\">6d9c356</a>\n    </p>\n  </div>\n  <div itemprop=\"text\" class=\"Box-body p-0 blob-wrapper blob-wrapper-embedded data\">\n    <table class=\"highlight tab-size mb-0 js-file-line-container\" data-tab-size=\"8\" data-paste-markdown-skip=\"\">\n\n        <tbody><tr class=\"border-0\">\n          <td id=\"L283\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"283\"></td>\n          <td id=\"LC283\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-c\">// built-in type adapters that cannot be overridden</span> </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L284\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"284\"></td>\n          <td id=\"LC284\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">factories</span>.<span class=\"pl-en\">add</span>(<span class=\"pl-smi\">TypeAdapters</span>.<span class=\"pl-c1\">JSON_ELEMENT_FACTORY</span>); </td>\n        </tr>\n\n        <tr class=\"border-0\">\n          <td id=\"L285\" class=\"blob-num border-0 px-3 py-0 color-bg-default\" data-line-number=\"285\"></td>\n          <td id=\"LC285\" class=\"blob-code border-0 px-3 py-0 color-bg-default blob-code-inner js-file-line\"> <span class=\"pl-s1\">factories</span>.<span class=\"pl-en\">add</span>(<span class=\"pl-smi\">ObjectTypeAdapter</span>.<span class=\"pl-en\">getFactory</span>(<span class=\"pl-s1\">objectToNumberStrategy</span>)); </td>\n        </tr>\n    </tbody></table>\n  </div>\n</div>\n<p></p>\n<p dir=\"auto\">(Side note: This only affects <code class=\"notranslate\">GsonBuilder</code>; it is possible to overwrite these adapters when using <code class=\"notranslate\">@JsonAdapter</code> on a field.)</p>\n<h1 dir=\"auto\">Feature description</h1>\n<ul dir=\"auto\">\n<li><code class=\"notranslate\">GsonBuilder.registerTypeAdapter</code> should throw an exception when the type is <code class=\"notranslate\">Object</code> or <code class=\"notranslate\">JsonElement</code> or a subclass of it</li>\n<li><code class=\"notranslate\">GsonBuilder.registerTypeHierarchyAdapter</code> should throw an exception when the type is <code class=\"notranslate\">JsonElement</code> or a subclass of it</li>\n</ul>\n<p dir=\"auto\">Additionally for both methods the documentation should be extended to specify that overwriting these adapters is not possible (but maybe mention that <code class=\"notranslate\">@JsonAdapter</code> can be used instead).</p>\n<h1 dir=\"auto\">Alternatives / workarounds</h1>\n<p dir=\"auto\">Only adjust the documentation (and Troubleshooting Guide) to mention that these adapters cannot be overwritten.</p>\n<p dir=\"auto\">Or as proposed by <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"267915657\" data-permission-text=\"Title is private\" data-url=\"https://github.com/google/gson/issues/1177\" data-hovercard-type=\"issue\" data-hovercard-url=\"/google/gson/issues/1177/hovercard\" href=\"https://github.com/google/gson/issues/1177\">#1177</a> let users overwrite the built-in adapters for these types.</p>",
  "description_text": "Problem solved by the feature\nGsonBuilder does not support overwriting the built-in adapters for Object and for JsonElement (and subclasses). This might not be obvious to users (see #1177).\n\n\n\ngson/gson/src/main/java/com/google/gson/Gson.java\n\n\n        Lines 283 to 285\n      in\n      6d9c356\n\n\n\n\n\n\n // built-in type adapters that cannot be overridden \n\n\n\n factories.add(TypeAdapters.JSON_ELEMENT_FACTORY); \n\n\n\n factories.add(ObjectTypeAdapter.getFactory(objectToNumberStrategy)); \n\n\n\n\n\n(Side note: This only affects GsonBuilder; it is possible to overwrite these adapters when using @JsonAdapter on a field.)\nFeature description\n\nGsonBuilder.registerTypeAdapter should throw an exception when the type is Object or JsonElement or a subclass of it\nGsonBuilder.registerTypeHierarchyAdapter should throw an exception when the type is JsonElement or a subclass of it\n\nAdditionally for both methods the documentation should be extended to specify that overwriting these adapters is not possible (but maybe mention that @JsonAdapter can be used instead).\nAlternatives / workarounds\nOnly adjust the documentation (and Troubleshooting Guide) to mention that these adapters cannot be overwritten.\nOr as proposed by #1177 let users overwrite the built-in adapters for these types."
}