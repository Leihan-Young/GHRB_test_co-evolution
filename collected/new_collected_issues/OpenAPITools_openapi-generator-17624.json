{
  "issue_id": 17320,
  "issue_url": "https://github.com/OpenAPITools/openapi-generator/issues/17320",
  "title": "[BUG] [Python] Wrong model when using dicts",
  "description": "<h4 dir=\"auto\">Bug Report Checklist</h4>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you provided a full/minimal spec to reproduce the issue?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you validated the input using an OpenAPI validator (<a href=\"https://apidevtools.org/swagger-parser/online/\" rel=\"nofollow\">example</a>)?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you <a href=\"https://github.com/OpenAPITools/openapi-generator/wiki/FAQ#how-to-test-with-the-latest-master-of-openapi-generator\">tested with the latest master</a> to confirm the issue still exists?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you searched for related issues/PRs?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> What's the actual output vs expected output?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> [Optional] Sponsorship to speed up the bug fix or feature request (<a href=\"https://github.com/OpenAPITools/openapi-generator/issues/6178\" data-hovercard-type=\"issue\" data-hovercard-url=\"/OpenAPITools/openapi-generator/issues/6178/hovercard\">example</a>)</li>\n</ul>\n<h5 dir=\"auto\">Description</h5>\n<p dir=\"auto\">Having a spec that should include a dict property it becomes a <code class=\"notranslate\">Optional[Any]</code> type instead in the generated model. Using the same spec and just modifying the \"openapi\" attribute by changing it to \"3.0.0\" instead generated a model with type <code class=\"notranslate\">Dict[str, StrictStr]</code> as expected.</p>\n<p dir=\"auto\">Should be:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"class MyConfigValue(BaseModel):\n    \"\"\"\n    Some description.\n    \"\"\" # noqa: E501\n    myprop: Dict[str, StrictStr]\n    __properties: ClassVar[List[str]] = [\"myprop\"]\n\n    model_config = {\n        \"populate_by_name\": True,\n        \"validate_assignment\": True\n    }\"><pre class=\"notranslate\"><code class=\"notranslate\">class MyConfigValue(BaseModel):\n    \"\"\"\n    Some description.\n    \"\"\" # noqa: E501\n    myprop: Dict[str, StrictStr]\n    __properties: ClassVar[List[str]] = [\"myprop\"]\n\n    model_config = {\n        \"populate_by_name\": True,\n        \"validate_assignment\": True\n    }\n</code></pre></div>\n<p dir=\"auto\">is</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"class MyConfigValue(BaseModel):\n    \"\"\"\n    Some description.\n    \"\"\" # noqa: E501\n    myprop: Optional[Any]\n    __properties: ClassVar[List[str]] = [\"myprop\"]\n\n    model_config = {\n        \"populate_by_name\": True,\n        \"validate_assignment\": True\n    }\"><pre class=\"notranslate\"><code class=\"notranslate\">class MyConfigValue(BaseModel):\n    \"\"\"\n    Some description.\n    \"\"\" # noqa: E501\n    myprop: Optional[Any]\n    __properties: ClassVar[List[str]] = [\"myprop\"]\n\n    model_config = {\n        \"populate_by_name\": True,\n        \"validate_assignment\": True\n    }\n</code></pre></div>\n<h5 dir=\"auto\">openapi-generator version</h5>\n<p dir=\"auto\">7.1.0 (also tried snapshot of 7.2.0)</p>\n<h5 dir=\"auto\">OpenAPI declaration file content or url</h5>\n<div class=\"highlight highlight-source-json notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"{\n  \"openapi\": \"3.1.0\",\n  \"info\": {\n    \"title\": \"MY.FANCY.API\",\n    \"version\": \"0.1.0\"\n  },\n  \"servers\": [\n    {\n      \"url\": \"/\",\n      \"description\": \"Local\"\n    }\n  ],\n  \"paths\": {\n    \"/config/get_config_value\": {\n      \"post\": {\n        \"tags\": [\n          \"My Configurations\"\n        ],\n        \"summary\": \"Get Config Value\",\n        \"description\": \"Some description.\",\n        \"operationId\": \"get_config_value_config_get_config_value_post\",\n        \"requestBody\": {\n          \"content\": {\n            \"application/json\": {\n              \"schema\": {\n                \"$ref\": \"#/components/schemas/GetMyConfigValueRequest\"\n              }\n            }\n          },\n          \"required\": true\n        },\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful Response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {\n                  \"$ref\": \"#/components/schemas/MyConfigValue\"\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  \"components\": {\n    \"schemas\": {\n      \"MyConfigValue\": {\n        \"properties\": {\n          \"myprop\": {\n            \"additionalProperties\": {\n              \"type\": \"string\"\n            },\n            \"type\": \"object\",\n            \"title\": \"Myprop\"\n          }\n        },\n        \"type\": \"object\",\n        \"required\": [\n          \"myprop\"\n        ],\n        \"title\": \"MyConfigValue\",\n        \"description\": \"Some description.\"\n      },\n      \"GetMyConfigValueRequest\": {\n        \"properties\": {\n          \"config_path\": {\n            \"type\": \"string\",\n            \"title\": \"Config Path\"\n          },\n          \"file_in_config\": {\n            \"type\": \"string\",\n            \"title\": \"File In Config\"\n          },\n          \"nested_keys\": {\n            \"items\": {\n              \"type\": \"string\"\n            },\n            \"type\": \"array\",\n            \"title\": \"Nested Keys\"\n          }\n        },\n        \"type\": \"object\",\n        \"required\": [\n          \"config_path\",\n          \"file_in_config\",\n          \"nested_keys\"\n        ],\n        \"title\": \"GetMyConfigValueRequest\",\n        \"description\": \"Request to get a nested value from a config.\"\n      }\n    }\n  }\n}\"><pre class=\"notranslate\">{\n  <span class=\"pl-ent\">\"openapi\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>3.1.0<span class=\"pl-pds\">\"</span></span>,\n  <span class=\"pl-ent\">\"info\"</span>: {\n    <span class=\"pl-ent\">\"title\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>MY.FANCY.API<span class=\"pl-pds\">\"</span></span>,\n    <span class=\"pl-ent\">\"version\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>0.1.0<span class=\"pl-pds\">\"</span></span>\n  },\n  <span class=\"pl-ent\">\"servers\"</span>: [\n    {\n      <span class=\"pl-ent\">\"url\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>/<span class=\"pl-pds\">\"</span></span>,\n      <span class=\"pl-ent\">\"description\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Local<span class=\"pl-pds\">\"</span></span>\n    }\n  ],\n  <span class=\"pl-ent\">\"paths\"</span>: {\n    <span class=\"pl-ent\">\"/config/get_config_value\"</span>: {\n      <span class=\"pl-ent\">\"post\"</span>: {\n        <span class=\"pl-ent\">\"tags\"</span>: [\n          <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>My Configurations<span class=\"pl-pds\">\"</span></span>\n        ],\n        <span class=\"pl-ent\">\"summary\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Get Config Value<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-ent\">\"description\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Some description.<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-ent\">\"operationId\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>get_config_value_config_get_config_value_post<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-ent\">\"requestBody\"</span>: {\n          <span class=\"pl-ent\">\"content\"</span>: {\n            <span class=\"pl-ent\">\"application/json\"</span>: {\n              <span class=\"pl-ent\">\"schema\"</span>: {\n                <span class=\"pl-ent\">\"$ref\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>#/components/schemas/GetMyConfigValueRequest<span class=\"pl-pds\">\"</span></span>\n              }\n            }\n          },\n          <span class=\"pl-ent\">\"required\"</span>: <span class=\"pl-c1\">true</span>\n        },\n        <span class=\"pl-ent\">\"responses\"</span>: {\n          <span class=\"pl-ent\">\"200\"</span>: {\n            <span class=\"pl-ent\">\"description\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Successful Response<span class=\"pl-pds\">\"</span></span>,\n            <span class=\"pl-ent\">\"content\"</span>: {\n              <span class=\"pl-ent\">\"application/json\"</span>: {\n                <span class=\"pl-ent\">\"schema\"</span>: {\n                  <span class=\"pl-ent\">\"$ref\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>#/components/schemas/MyConfigValue<span class=\"pl-pds\">\"</span></span>\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  <span class=\"pl-ent\">\"components\"</span>: {\n    <span class=\"pl-ent\">\"schemas\"</span>: {\n      <span class=\"pl-ent\">\"MyConfigValue\"</span>: {\n        <span class=\"pl-ent\">\"properties\"</span>: {\n          <span class=\"pl-ent\">\"myprop\"</span>: {\n            <span class=\"pl-ent\">\"additionalProperties\"</span>: {\n              <span class=\"pl-ent\">\"type\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>string<span class=\"pl-pds\">\"</span></span>\n            },\n            <span class=\"pl-ent\">\"type\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>object<span class=\"pl-pds\">\"</span></span>,\n            <span class=\"pl-ent\">\"title\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Myprop<span class=\"pl-pds\">\"</span></span>\n          }\n        },\n        <span class=\"pl-ent\">\"type\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>object<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-ent\">\"required\"</span>: [\n          <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>myprop<span class=\"pl-pds\">\"</span></span>\n        ],\n        <span class=\"pl-ent\">\"title\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>MyConfigValue<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-ent\">\"description\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Some description.<span class=\"pl-pds\">\"</span></span>\n      },\n      <span class=\"pl-ent\">\"GetMyConfigValueRequest\"</span>: {\n        <span class=\"pl-ent\">\"properties\"</span>: {\n          <span class=\"pl-ent\">\"config_path\"</span>: {\n            <span class=\"pl-ent\">\"type\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>string<span class=\"pl-pds\">\"</span></span>,\n            <span class=\"pl-ent\">\"title\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Config Path<span class=\"pl-pds\">\"</span></span>\n          },\n          <span class=\"pl-ent\">\"file_in_config\"</span>: {\n            <span class=\"pl-ent\">\"type\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>string<span class=\"pl-pds\">\"</span></span>,\n            <span class=\"pl-ent\">\"title\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>File In Config<span class=\"pl-pds\">\"</span></span>\n          },\n          <span class=\"pl-ent\">\"nested_keys\"</span>: {\n            <span class=\"pl-ent\">\"items\"</span>: {\n              <span class=\"pl-ent\">\"type\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>string<span class=\"pl-pds\">\"</span></span>\n            },\n            <span class=\"pl-ent\">\"type\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>array<span class=\"pl-pds\">\"</span></span>,\n            <span class=\"pl-ent\">\"title\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Nested Keys<span class=\"pl-pds\">\"</span></span>\n          }\n        },\n        <span class=\"pl-ent\">\"type\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>object<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-ent\">\"required\"</span>: [\n          <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>config_path<span class=\"pl-pds\">\"</span></span>,\n          <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>file_in_config<span class=\"pl-pds\">\"</span></span>,\n          <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>nested_keys<span class=\"pl-pds\">\"</span></span>\n        ],\n        <span class=\"pl-ent\">\"title\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>GetMyConfigValueRequest<span class=\"pl-pds\">\"</span></span>,\n        <span class=\"pl-ent\">\"description\"</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>Request to get a nested value from a config.<span class=\"pl-pds\">\"</span></span>\n      }\n    }\n  }\n}</pre></div>\n<h5 dir=\"auto\">Generation Details</h5>\n<p dir=\"auto\">npx @openapitools/openapi-generator-cli generate -i 'C:\\xxx\\my_api_openapi.json' -g python -o 'C:\\xxx\\python\\dev\\my_client' -p library=asyncio -p packageName=communication.my_rest_client --skip-validate-spec</p>\n<h5 dir=\"auto\">Steps to reproduce</h5>\n<p dir=\"auto\">Just call the generator with provided spec</p>\n<h5 dir=\"auto\">Related issues/PRs</h5>\n<p dir=\"auto\">Did not find any</p>\n<h5 dir=\"auto\">Suggest a fix</h5>\n<ul dir=\"auto\">\n<li></li>\n</ul>",
  "description_text": "Bug Report Checklist\n\n Have you provided a full/minimal spec to reproduce the issue?\n Have you validated the input using an OpenAPI validator (example)?\n Have you tested with the latest master to confirm the issue still exists?\n Have you searched for related issues/PRs?\n What's the actual output vs expected output?\n [Optional] Sponsorship to speed up the bug fix or feature request (example)\n\nDescription\nHaving a spec that should include a dict property it becomes a Optional[Any] type instead in the generated model. Using the same spec and just modifying the \"openapi\" attribute by changing it to \"3.0.0\" instead generated a model with type Dict[str, StrictStr] as expected.\nShould be:\nclass MyConfigValue(BaseModel):\n    \"\"\"\n    Some description.\n    \"\"\" # noqa: E501\n    myprop: Dict[str, StrictStr]\n    __properties: ClassVar[List[str]] = [\"myprop\"]\n\n    model_config = {\n        \"populate_by_name\": True,\n        \"validate_assignment\": True\n    }\n\nis\nclass MyConfigValue(BaseModel):\n    \"\"\"\n    Some description.\n    \"\"\" # noqa: E501\n    myprop: Optional[Any]\n    __properties: ClassVar[List[str]] = [\"myprop\"]\n\n    model_config = {\n        \"populate_by_name\": True,\n        \"validate_assignment\": True\n    }\n\nopenapi-generator version\n7.1.0 (also tried snapshot of 7.2.0)\nOpenAPI declaration file content or url\n{\n  \"openapi\": \"3.1.0\",\n  \"info\": {\n    \"title\": \"MY.FANCY.API\",\n    \"version\": \"0.1.0\"\n  },\n  \"servers\": [\n    {\n      \"url\": \"/\",\n      \"description\": \"Local\"\n    }\n  ],\n  \"paths\": {\n    \"/config/get_config_value\": {\n      \"post\": {\n        \"tags\": [\n          \"My Configurations\"\n        ],\n        \"summary\": \"Get Config Value\",\n        \"description\": \"Some description.\",\n        \"operationId\": \"get_config_value_config_get_config_value_post\",\n        \"requestBody\": {\n          \"content\": {\n            \"application/json\": {\n              \"schema\": {\n                \"$ref\": \"#/components/schemas/GetMyConfigValueRequest\"\n              }\n            }\n          },\n          \"required\": true\n        },\n        \"responses\": {\n          \"200\": {\n            \"description\": \"Successful Response\",\n            \"content\": {\n              \"application/json\": {\n                \"schema\": {\n                  \"$ref\": \"#/components/schemas/MyConfigValue\"\n                }\n              }\n            }\n          }\n        }\n      }\n    }\n  },\n  \"components\": {\n    \"schemas\": {\n      \"MyConfigValue\": {\n        \"properties\": {\n          \"myprop\": {\n            \"additionalProperties\": {\n              \"type\": \"string\"\n            },\n            \"type\": \"object\",\n            \"title\": \"Myprop\"\n          }\n        },\n        \"type\": \"object\",\n        \"required\": [\n          \"myprop\"\n        ],\n        \"title\": \"MyConfigValue\",\n        \"description\": \"Some description.\"\n      },\n      \"GetMyConfigValueRequest\": {\n        \"properties\": {\n          \"config_path\": {\n            \"type\": \"string\",\n            \"title\": \"Config Path\"\n          },\n          \"file_in_config\": {\n            \"type\": \"string\",\n            \"title\": \"File In Config\"\n          },\n          \"nested_keys\": {\n            \"items\": {\n              \"type\": \"string\"\n            },\n            \"type\": \"array\",\n            \"title\": \"Nested Keys\"\n          }\n        },\n        \"type\": \"object\",\n        \"required\": [\n          \"config_path\",\n          \"file_in_config\",\n          \"nested_keys\"\n        ],\n        \"title\": \"GetMyConfigValueRequest\",\n        \"description\": \"Request to get a nested value from a config.\"\n      }\n    }\n  }\n}\nGeneration Details\nnpx @openapitools/openapi-generator-cli generate -i 'C:\\xxx\\my_api_openapi.json' -g python -o 'C:\\xxx\\python\\dev\\my_client' -p library=asyncio -p packageName=communication.my_rest_client --skip-validate-spec\nSteps to reproduce\nJust call the generator with provided spec\nRelated issues/PRs\nDid not find any\nSuggest a fix\n\n\n"
}