{
  "issue_id": 5876,
  "issue_url": "https://github.com/apache/rocketmq/issues/5876",
  "title": "Fix resource leak in DefaultLitePullConsumerTest",
  "description": "<p dir=\"auto\">Currently, there are many IllegalStateException in the test log. This is because the MQClientInstance created in DefaultLitePullConsumerTest is not destroyed.</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"03:28:59.891 [MQClientFactoryScheduledThread] ERROR o.a.r.c.i.c.DefaultLitePullConsumerImpl - Persist consumer offset error for group: LitePullConsumerGroup1673580414539 \njava.lang.IllegalStateException: The consumer not running, please start it first.\n\tat org.apache.rocketmq.client.impl.consumer.DefaultLitePullConsumerImpl.checkServiceState(DefaultLitePullConsumerImpl.java:205)\n\tat org.apache.rocketmq.client.impl.consumer.DefaultLitePullConsumerImpl.persistConsumerOffset(DefaultLitePullConsumerImpl.java:1115)\n\tat org.apache.rocketmq.client.impl.factory.MQClientInstance.persistAllConsumerOffset(MQClientInstance.java:479)\n\tat org.apache.rocketmq.client.impl.factory.MQClientInstance.lambda$startScheduledTask$5(MQClientInstance.java:310)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat java.lang.Thread.run(Thread.java:750)\n\"><pre class=\"notranslate\"><code class=\"notranslate\">03:28:59.891 [MQClientFactoryScheduledThread] ERROR o.a.r.c.i.c.DefaultLitePullConsumerImpl - Persist consumer offset error for group: LitePullConsumerGroup1673580414539 \njava.lang.IllegalStateException: The consumer not running, please start it first.\n\tat org.apache.rocketmq.client.impl.consumer.DefaultLitePullConsumerImpl.checkServiceState(DefaultLitePullConsumerImpl.java:205)\n\tat org.apache.rocketmq.client.impl.consumer.DefaultLitePullConsumerImpl.persistConsumerOffset(DefaultLitePullConsumerImpl.java:1115)\n\tat org.apache.rocketmq.client.impl.factory.MQClientInstance.persistAllConsumerOffset(MQClientInstance.java:479)\n\tat org.apache.rocketmq.client.impl.factory.MQClientInstance.lambda$startScheduledTask$5(MQClientInstance.java:310)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat java.lang.Thread.run(Thread.java:750)\n\n</code></pre></div>",
  "description_text": "Currently, there are many IllegalStateException in the test log. This is because the MQClientInstance created in DefaultLitePullConsumerTest is not destroyed.\n03:28:59.891 [MQClientFactoryScheduledThread] ERROR o.a.r.c.i.c.DefaultLitePullConsumerImpl - Persist consumer offset error for group: LitePullConsumerGroup1673580414539 \njava.lang.IllegalStateException: The consumer not running, please start it first.\n\tat org.apache.rocketmq.client.impl.consumer.DefaultLitePullConsumerImpl.checkServiceState(DefaultLitePullConsumerImpl.java:205)\n\tat org.apache.rocketmq.client.impl.consumer.DefaultLitePullConsumerImpl.persistConsumerOffset(DefaultLitePullConsumerImpl.java:1115)\n\tat org.apache.rocketmq.client.impl.factory.MQClientInstance.persistAllConsumerOffset(MQClientInstance.java:479)\n\tat org.apache.rocketmq.client.impl.factory.MQClientInstance.lambda$startScheduledTask$5(MQClientInstance.java:310)\n\tat java.util.concurrent.Executors$RunnableAdapter.call(Executors.java:511)\n\tat java.util.concurrent.FutureTask.runAndReset(FutureTask.java:308)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.access$301(ScheduledThreadPoolExecutor.java:180)\n\tat java.util.concurrent.ScheduledThreadPoolExecutor$ScheduledFutureTask.run(ScheduledThreadPoolExecutor.java:294)\n\tat java.util.concurrent.ThreadPoolExecutor.runWorker(ThreadPoolExecutor.java:1149)\n\tat java.util.concurrent.ThreadPoolExecutor$Worker.run(ThreadPoolExecutor.java:624)\n\tat java.lang.Thread.run(Thread.java:750)\n\n"
}