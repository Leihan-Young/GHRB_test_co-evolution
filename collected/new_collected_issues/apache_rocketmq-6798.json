{
  "issue_id": 6797,
  "issue_url": "https://github.com/apache/rocketmq/issues/6797",
  "title": "[Enhancement] Support batch ack when reput buffer ak to store in PopBufferMergeService",
  "description": "<h3 dir=\"auto\">Before Creating the Enhancement Request</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I have confirmed that this should be classified as an enhancement rather than a bug/feature.</li>\n</ul>\n<h3 dir=\"auto\">Summary</h3>\n<p dir=\"auto\">If enablePopBufferMerge is enabled, CK and AK will be matched first in memory. For CKs that do not match exactly, a message needs to be sent and stored in the Revive Topic after a timeout. At this time, when some messages in a batch of messages in the CK have been ACKed, but the departmental messages have not been ACKed, it is necessary to generate a message for the ACKed messages and send it to the REVIVE Topic. In this case, if there are N messages that have been ACKed, you need to send N messages to the Revive topic. This leads to a large number of messages being rotated in MQ, and we can make some optimizations here.</p>\n<h3 dir=\"auto\">Motivation</h3>\n<p dir=\"auto\">Support batch ACK to reduce the number of message rotation.<br>\nFor a batch of messages in CK, when some messages have been ACKed and some messages have not been ACKed. We only send one message to the revive topic to indicate all ACKed messages. Therefore, this message needs to store the indexes of all ACKed messages. And in the PopReviveService, the corresponding processing.</p>\n<h3 dir=\"auto\">Describe the Solution You'd Like</h3>\n<p dir=\"auto\">Support batch ack</p>\n<h3 dir=\"auto\">Describe Alternatives You've Considered</h3>\n<p dir=\"auto\">Support batch ack</p>\n<h3 dir=\"auto\">Additional Context</h3>\n<p dir=\"auto\"><em>No response</em></p>",
  "description_text": "Before Creating the Enhancement Request\n\n I have confirmed that this should be classified as an enhancement rather than a bug/feature.\n\nSummary\nIf enablePopBufferMerge is enabled, CK and AK will be matched first in memory. For CKs that do not match exactly, a message needs to be sent and stored in the Revive Topic after a timeout. At this time, when some messages in a batch of messages in the CK have been ACKed, but the departmental messages have not been ACKed, it is necessary to generate a message for the ACKed messages and send it to the REVIVE Topic. In this case, if there are N messages that have been ACKed, you need to send N messages to the Revive topic. This leads to a large number of messages being rotated in MQ, and we can make some optimizations here.\nMotivation\nSupport batch ACK to reduce the number of message rotation.\nFor a batch of messages in CK, when some messages have been ACKed and some messages have not been ACKed. We only send one message to the revive topic to indicate all ACKed messages. Therefore, this message needs to store the indexes of all ACKed messages. And in the PopReviveService, the corresponding processing.\nDescribe the Solution You'd Like\nSupport batch ack\nDescribe Alternatives You've Considered\nSupport batch ack\nAdditional Context\nNo response"
}