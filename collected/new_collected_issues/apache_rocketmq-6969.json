{
  "issue_id": 6968,
  "issue_url": "https://github.com/apache/rocketmq/issues/6968",
  "title": "[Bug] Proxy ACL grpc parse PlainAccessResource wrong.",
  "description": "<h3 dir=\"auto\">Before Creating the Bug Report</h3>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\">\n<p dir=\"auto\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I found a bug, not just asking a question, which should be created in <a href=\"https://github.com/apache/rocketmq/discussions\">GitHub Discussions</a>.</p>\n</li>\n<li class=\"task-list-item\">\n<p dir=\"auto\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I have searched the <a href=\"https://github.com/apache/rocketmq/issues\">GitHub Issues</a> and <a href=\"https://github.com/apache/rocketmq/discussions\">GitHub Discussions</a>  of this repository and believe that this is not a duplicate.</p>\n</li>\n<li class=\"task-list-item\">\n<p dir=\"auto\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> I have confirmed that this bug belongs to the current repository, not other repositories of RocketMQ.</p>\n</li>\n</ul>\n<h3 dir=\"auto\">Runtime platform environment</h3>\n<p dir=\"auto\">mac ubuntu etc.</p>\n<h3 dir=\"auto\">RocketMQ version</h3>\n<p dir=\"auto\">5.x</p>\n<h3 dir=\"auto\">JDK Version</h3>\n<p dir=\"auto\"><em>No response</em></p>\n<h3 dir=\"auto\">Describe the Bug</h3>\n<h3 dir=\"auto\">1. PlainAccessResource parse wrong impl for grpc protocol</h3>\n<p dir=\"auto\">When parse to PlainAccessResource in remoting protocol<br>\n<code class=\"notranslate\">org.apache.rocketmq.acl.plain.PlainAccessResource#parse(org.apache.rocketmq.remoting.protocol.RemotingCommand, java.lang.String)</code><br>\nit turns group into RetryTopic and add it as resource name.<br>\nHowever, when it comes to grpc protocol, the related <code class=\"notranslate\">parse</code> method does not handle group as mention as mentioned above.<br>\nAlso seen in the acl module, parse to PlainAccessResource in remoting protocol has abundant unit test, but parse method for grpc has 0 unit test, which is worth adding.</p>\n<h3 dir=\"auto\">2. lack of spi AccessValidator in proxy remoting protocol impl</h3>\n<p dir=\"auto\">Need to add a common method for both remoting & grpc in proxy to get AccessValidator.</p>\n<h3 dir=\"auto\">Steps to Reproduce</h3>\n<div class=\"highlight highlight-source-yaml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"accounts:\n- accessKey: 3nRqUIKd1g\n  secretKey: 10q6nUi31odLGzxuvc7Ckk\n  admin: false\n  defaultTopicPerm: DENY\n  defaultGroupPerm: DENY\n  topicPerms:\n  - TopicA=SUB\n  groupPerms:\n  - GroupA=SUB\"><pre class=\"notranslate\"><span class=\"pl-ent\">accounts</span>:\n- <span class=\"pl-ent\">accessKey</span>: <span class=\"pl-s\">3nRqUIKd1g</span>\n  <span class=\"pl-ent\">secretKey</span>: <span class=\"pl-s\">10q6nUi31odLGzxuvc7Ckk</span>\n  <span class=\"pl-ent\">admin</span>: <span class=\"pl-c1\">false</span>\n  <span class=\"pl-ent\">defaultTopicPerm</span>: <span class=\"pl-s\">DENY</span>\n  <span class=\"pl-ent\">defaultGroupPerm</span>: <span class=\"pl-s\">DENY</span>\n  <span class=\"pl-ent\">topicPerms</span>:\n  - <span class=\"pl-s\">TopicA=SUB</span>\n  <span class=\"pl-ent\">groupPerms</span>:\n  - <span class=\"pl-s\">GroupA=SUB</span></pre></div>\n<p dir=\"auto\">use this accout and 5.0 grpc consumer client, you will be denied for NO PERMISSION.</p>\n<h3 dir=\"auto\">What Did You Expect to See?</h3>\n<p dir=\"auto\">expected that the grpc consumer client can consume normally</p>\n<h3 dir=\"auto\">What Did You See Instead?</h3>\n<p dir=\"auto\">or more discussion?</p>\n<h3 dir=\"auto\">Additional Context</h3>\n<p dir=\"auto\">no</p>",
  "description_text": "Before Creating the Bug Report\n\n\n I found a bug, not just asking a question, which should be created in GitHub Discussions.\n\n\n I have searched the GitHub Issues and GitHub Discussions  of this repository and believe that this is not a duplicate.\n\n\n I have confirmed that this bug belongs to the current repository, not other repositories of RocketMQ.\n\n\nRuntime platform environment\nmac ubuntu etc.\nRocketMQ version\n5.x\nJDK Version\nNo response\nDescribe the Bug\n1. PlainAccessResource parse wrong impl for grpc protocol\nWhen parse to PlainAccessResource in remoting protocol\norg.apache.rocketmq.acl.plain.PlainAccessResource#parse(org.apache.rocketmq.remoting.protocol.RemotingCommand, java.lang.String)\nit turns group into RetryTopic and add it as resource name.\nHowever, when it comes to grpc protocol, the related parse method does not handle group as mention as mentioned above.\nAlso seen in the acl module, parse to PlainAccessResource in remoting protocol has abundant unit test, but parse method for grpc has 0 unit test, which is worth adding.\n2. lack of spi AccessValidator in proxy remoting protocol impl\nNeed to add a common method for both remoting & grpc in proxy to get AccessValidator.\nSteps to Reproduce\naccounts:\n- accessKey: 3nRqUIKd1g\n  secretKey: 10q6nUi31odLGzxuvc7Ckk\n  admin: false\n  defaultTopicPerm: DENY\n  defaultGroupPerm: DENY\n  topicPerms:\n  - TopicA=SUB\n  groupPerms:\n  - GroupA=SUB\nuse this accout and 5.0 grpc consumer client, you will be denied for NO PERMISSION.\nWhat Did You Expect to See?\nexpected that the grpc consumer client can consume normally\nWhat Did You See Instead?\nor more discussion?\nAdditional Context\nno"
}