{
  "issue_id": 17726,
  "issue_url": "https://github.com/OpenAPITools/openapi-generator/issues/17726",
  "title": "[BUG][KOTLIN] OAS 3.1.0 handle any sibling property of $ref in a schema object",
  "description": "<h4 dir=\"auto\">Bug Report Checklist</h4>\n<ul class=\"contains-task-list\">\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you provided a full/minimal spec to reproduce the issue?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you validated the input using an OpenAPI validator (<a href=\"https://apidevtools.org/swagger-parser/online/\" rel=\"nofollow\">example</a>)?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> Have you <a href=\"https://github.com/OpenAPITools/openapi-generator/wiki/FAQ#how-to-test-with-the-latest-master-of-openapi-generator\">tested with the latest master</a> to confirm the issue still exists?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> Have you searched for related issues/PRs? => related <a class=\"issue-link js-issue-link\" data-error-text=\"Failed to load title\" data-id=\"2095145575\" data-permission-text=\"Title is private\" data-url=\"https://github.com/OpenAPITools/openapi-generator/issues/17683\" data-hovercard-type=\"pull_request\" data-hovercard-url=\"/OpenAPITools/openapi-generator/pull/17683/hovercard\" href=\"https://github.com/OpenAPITools/openapi-generator/pull/17683\">#17683</a></li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\" checked=\"\"> What's the actual output vs expected output?</li>\n<li class=\"task-list-item\"><input type=\"checkbox\" id=\"\" disabled=\"\" class=\"task-list-item-checkbox\"> [Optional] Sponsorship to speed up the bug fix or feature request (<a href=\"https://github.com/OpenAPITools/openapi-generator/issues/6178\" data-hovercard-type=\"issue\" data-hovercard-url=\"/OpenAPITools/openapi-generator/issues/6178/hovercard\">example</a>)</li>\n</ul>\n\n<h5 dir=\"auto\">Description</h5>\n\n<p dir=\"auto\">Currently, it seems like every property next to $ref is ignored (as it was specified for openapi 3.0.4). However, with openapi 3.1.0 it should be possible to define sibling properties of $ref, which I think is possible (I don't get a validation error at least) but they still seem to be ignored, are not reflected in the output. (<em>Edit</em> I realised that the kotlin-generator is not compatible with 3.1.0 at all most likely due to change in OAS 3.1.0 that <code class=\"notranslate\">type</code> is now an array)</p>\n<p dir=\"auto\">See example below, in the end I would expect that the <code class=\"notranslate\">Order</code> data class has a property along the line of</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    @field:Valid\n    @get:Size(max=50)\n    @get:JsonProperty(\"address\") val address: Address? = null,\"><pre class=\"notranslate\"><code class=\"notranslate\">    @field:Valid\n    @get:Size(max=50)\n    @get:JsonProperty(\"address\") val address: Address? = null,\n</code></pre></div>\n<p dir=\"auto\">But I only get (size is missing):</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    @field:Valid\n    @get:JsonProperty(\"address\") val address: Address? = null,\"><pre class=\"notranslate\"><code class=\"notranslate\">    @field:Valid\n    @get:JsonProperty(\"address\") val address: Address? = null,\n</code></pre></div>\n<h5 dir=\"auto\">openapi-generator version</h5>\n\n<p dir=\"auto\">openapi-generator-maven-plugin 7.2.0<br>\ngeneratorName: kotlin-spring<br>\nuseSpringBoot3: true</p>\n<p dir=\"auto\">It is a regression in the sense of, if one is using the <code class=\"notranslate\">allOf</code> workaround with 7.2.0 then:</p>\n<ol dir=\"auto\">\n<li>an own data class is created (before the data type in $ref was used)</li>\n<li>the validation is no longer included.</li>\n</ol>\n<p dir=\"auto\">As an example, the workaround looked as follows:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"        address:\n          allOf:\n            - $ref: '#/components/schemas/Address'\n            - maxLength: 50\"><pre class=\"notranslate\"><code class=\"notranslate\">        address:\n          allOf:\n            - $ref: '#/components/schemas/Address'\n            - maxLength: 50\n</code></pre></div>\n<p dir=\"auto\">Now results in a property as follows:</p>\n<div class=\"snippet-clipboard-content notranslate position-relative overflow-auto\" data-snippet-clipboard-copy-content=\"    @field:Valid\n    @get:JsonProperty(\"address\") val address: OrderAllOfAddress? = null,\"><pre class=\"notranslate\"><code class=\"notranslate\">    @field:Valid\n    @get:JsonProperty(\"address\") val address: OrderAllOfAddress? = null,\n</code></pre></div>\n<p dir=\"auto\">Before (openapi-generator-maven-plugin 6.4.0 and openapi 3.0.4) I got the expected result shown above</p>\n<h5 dir=\"auto\">OpenAPI declaration file content or url</h5>\n<div class=\"highlight highlight-source-yaml notranslate position-relative overflow-auto\" dir=\"auto\" data-snippet-clipboard-copy-content=\"openapi: 3.1.0\ninfo:\n    title: dummy\n    version: \"1.0\"\npaths:\n  /users/{id}:\n    summary: Represents a user\ncomponents:\n  schemas:\n    Order:\n      type: object\n      required:\n      - name\n      properties:\n        name:\n          type: string\n        address:\n          $ref: '#/components/schemas/Address'\n          maxLength: 50\n    Address:\n        type: object\n        properties: \n            firstName: \n                type: string\"><pre class=\"notranslate\"><span class=\"pl-ent\">openapi</span>: <span class=\"pl-s\">3.1.0</span>\n<span class=\"pl-ent\">info</span>:\n    <span class=\"pl-ent\">title</span>: <span class=\"pl-s\">dummy</span>\n    <span class=\"pl-ent\">version</span>: <span class=\"pl-s\"><span class=\"pl-pds\">\"</span>1.0<span class=\"pl-pds\">\"</span></span>\n<span class=\"pl-ent\">paths</span>:\n  <span class=\"pl-ent\">/users/{id}</span>:\n    <span class=\"pl-ent\">summary</span>: <span class=\"pl-s\">Represents a user</span>\n<span class=\"pl-ent\">components</span>:\n  <span class=\"pl-ent\">schemas</span>:\n    <span class=\"pl-ent\">Order</span>:\n      <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">object</span>\n      <span class=\"pl-ent\">required</span>:\n      - <span class=\"pl-s\">name</span>\n      <span class=\"pl-ent\">properties</span>:\n        <span class=\"pl-ent\">name</span>:\n          <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">string</span>\n        <span class=\"pl-ent\">address</span>:\n          <span class=\"pl-ent\">$ref</span>: <span class=\"pl-s\"><span class=\"pl-pds\">'</span>#/components/schemas/Address<span class=\"pl-pds\">'</span></span>\n          <span class=\"pl-ent\">maxLength</span>: <span class=\"pl-c1\">50</span>\n    <span class=\"pl-ent\">Address</span>:\n        <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">object</span>\n        <span class=\"pl-ent\">properties</span>: \n            <span class=\"pl-ent\">firstName</span>: \n                <span class=\"pl-ent\">type</span>: <span class=\"pl-s\">string</span></pre></div>\n<h5 dir=\"auto\">Generation Details</h5>\n\n<h5 dir=\"auto\">Steps to reproduce</h5>\n\n<h5 dir=\"auto\">Related issues/PRs</h5>\n\n<h5 dir=\"auto\">Suggest a fix</h5>\n",
  "description_text": "Bug Report Checklist\n\n Have you provided a full/minimal spec to reproduce the issue?\n Have you validated the input using an OpenAPI validator (example)?\n Have you tested with the latest master to confirm the issue still exists?\n Have you searched for related issues/PRs? => related #17683\n What's the actual output vs expected output?\n [Optional] Sponsorship to speed up the bug fix or feature request (example)\n\nDescription\nCurrently, it seems like every property next to $ref is ignored (as it was specified for openapi 3.0.4). However, with openapi 3.1.0 it should be possible to define sibling properties of $ref, which I think is possible (I don't get a validation error at least) but they still seem to be ignored, are not reflected in the output. (Edit I realised that the kotlin-generator is not compatible with 3.1.0 at all most likely due to change in OAS 3.1.0 that type is now an array)\nSee example below, in the end I would expect that the Order data class has a property along the line of\n    @field:Valid\n    @get:Size(max=50)\n    @get:JsonProperty(\"address\") val address: Address? = null,\n\nBut I only get (size is missing):\n    @field:Valid\n    @get:JsonProperty(\"address\") val address: Address? = null,\n\nopenapi-generator version\nopenapi-generator-maven-plugin 7.2.0\ngeneratorName: kotlin-spring\nuseSpringBoot3: true\nIt is a regression in the sense of, if one is using the allOf workaround with 7.2.0 then:\n\nan own data class is created (before the data type in $ref was used)\nthe validation is no longer included.\n\nAs an example, the workaround looked as follows:\n        address:\n          allOf:\n            - $ref: '#/components/schemas/Address'\n            - maxLength: 50\n\nNow results in a property as follows:\n    @field:Valid\n    @get:JsonProperty(\"address\") val address: OrderAllOfAddress? = null,\n\nBefore (openapi-generator-maven-plugin 6.4.0 and openapi 3.0.4) I got the expected result shown above\nOpenAPI declaration file content or url\nopenapi: 3.1.0\ninfo:\n    title: dummy\n    version: \"1.0\"\npaths:\n  /users/{id}:\n    summary: Represents a user\ncomponents:\n  schemas:\n    Order:\n      type: object\n      required:\n      - name\n      properties:\n        name:\n          type: string\n        address:\n          $ref: '#/components/schemas/Address'\n          maxLength: 50\n    Address:\n        type: object\n        properties: \n            firstName: \n                type: string\nGeneration Details\nSteps to reproduce\nRelated issues/PRs\nSuggest a fix\n"
}