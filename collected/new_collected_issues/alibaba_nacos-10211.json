{
  "issue_id": 10208,
  "issue_url": "https://github.com/alibaba/nacos/issues/10208",
  "title": "DefaultSettingPropertySource make the client get properties error.",
  "description": "<p dir=\"auto\"><strong>Describe the bug</strong><br>\nIn 2.2.0, The client Add <code class=\"notranslate\">PropertySource</code> to get properties with a search way from <code class=\"notranslate\">properties -> jvm -> system env</code>. And users can set the order of search way.</p>\n<p dir=\"auto\">And after no search result from the previous <code class=\"notranslate\">Source</code>, it will use <code class=\"notranslate\">DefaultSettingPropertySource</code> to get properties.</p>\n<p dir=\"auto\">It seems no problem, but <code class=\"notranslate\">PropertySource</code> provide <code class=\"notranslate\">getProperty(key, defaultValue)</code> method to specified defaultValue when miss search key.</p>\n<p dir=\"auto\">The problem is when <code class=\"notranslate\">defaultValue</code> is different with <code class=\"notranslate\">DefaultSettingPropertySource</code>, It will return the value in <code class=\"notranslate\">DefaultSettingPropertySource</code>, which will cause different result with expect.</p>\n<p dir=\"auto\">Such as <code class=\"notranslate\">com.alibaba.nacos.client.naming.utils.InitUtils#initEndpoint</code>, I set <code class=\"notranslate\">-Dnacos.use.endpoint.parsing.rule=false</code> in jvm, but the <code class=\"notranslate\">initEndpoint</code> will get <code class=\"notranslate\">isUseEndpointRuleParsing</code> as true, because the  <code class=\"notranslate\">DefaultSettingPropertySource</code> contain <code class=\"notranslate\">isUseEndpointParsingRule</code> and the value is <code class=\"notranslate\">true</code>.</p>\n<p dir=\"auto\"><strong>Expected behavior</strong><br>\nUse specified default value when missing search properties.</p>\n<p dir=\"auto\"><strong>Actually behavior</strong><br>\nUse <code class=\"notranslate\">DefaultSettingPropertySource</code> value when missing search properties.</p>\n<p dir=\"auto\"><strong>How to Reproduce</strong><br>\nSteps to reproduce the behavior:</p>\n<ol dir=\"auto\">\n<li>Set <code class=\"notranslate\">-Dnacos.use.endpoint.parsing.rule=false</code></li>\n<li>Run with debug mode in <code class=\"notranslate\">com.alibaba.nacos.client.naming.utils.InitUtils#initEndpoint</code></li>\n<li>See <code class=\"notranslate\">isUseEndpointRuleParsing</code> value</li>\n</ol>\n<p dir=\"auto\"><strong>Desktop (please complete the following information):</strong></p>\n<ul dir=\"auto\">\n<li>Version nacos-client 2.2.0~2.2.1</li>\n<li>Module client</li>\n</ul>\n<p dir=\"auto\"><strong>Additional context</strong><br>\nI think the <code class=\"notranslate\">DefaultSettingPropertySource</code>  is not a good design, The search properties is searching the values from some source that users can modified or changed, but <code class=\"notranslate\">DefaultSettingPropertySource</code> is a <strong>Immutable</strong> files, use it as default value will cause hard to understand the defaultValue and how the properties get.</p>\n<p dir=\"auto\">So I think we should remove <code class=\"notranslate\">DefaultSettingPropertySource</code> .</p>",
  "description_text": "Describe the bug\nIn 2.2.0, The client Add PropertySource to get properties with a search way from properties -> jvm -> system env. And users can set the order of search way.\nAnd after no search result from the previous Source, it will use DefaultSettingPropertySource to get properties.\nIt seems no problem, but PropertySource provide getProperty(key, defaultValue) method to specified defaultValue when miss search key.\nThe problem is when defaultValue is different with DefaultSettingPropertySource, It will return the value in DefaultSettingPropertySource, which will cause different result with expect.\nSuch as com.alibaba.nacos.client.naming.utils.InitUtils#initEndpoint, I set -Dnacos.use.endpoint.parsing.rule=false in jvm, but the initEndpoint will get isUseEndpointRuleParsing as true, because the  DefaultSettingPropertySource contain isUseEndpointParsingRule and the value is true.\nExpected behavior\nUse specified default value when missing search properties.\nActually behavior\nUse DefaultSettingPropertySource value when missing search properties.\nHow to Reproduce\nSteps to reproduce the behavior:\n\nSet -Dnacos.use.endpoint.parsing.rule=false\nRun with debug mode in com.alibaba.nacos.client.naming.utils.InitUtils#initEndpoint\nSee isUseEndpointRuleParsing value\n\nDesktop (please complete the following information):\n\nVersion nacos-client 2.2.0~2.2.1\nModule client\n\nAdditional context\nI think the DefaultSettingPropertySource  is not a good design, The search properties is searching the values from some source that users can modified or changed, but DefaultSettingPropertySource is a Immutable files, use it as default value will cause hard to understand the defaultValue and how the properties get.\nSo I think we should remove DefaultSettingPropertySource ."
}